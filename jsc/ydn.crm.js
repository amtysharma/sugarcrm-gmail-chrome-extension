(function(){var k,aa=aa||{},r=this;function ba(a){a=a.split(".");for(var b=r,c;c=a.shift();)if(null!=b[c])b=b[c];else return null;return b}function ca(){}
function da(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function t(a){return void 0!==a}function u(a){return"array"==da(a)}function v(a){var b=da(a);return"array"==b||"object"==b&&"number"==typeof a.length}function w(a){return"string"==typeof a}function ea(a){return"boolean"==typeof a}function x(a){return"number"==typeof a}function fa(a){return"function"==da(a)}function z(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}
var ha="closure_uid_"+(1E9*Math.random()>>>0),ia=0;function ja(a,b,c){return a.call.apply(a.bind,arguments)}function la(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function B(a,b,c){B=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ja:la;return B.apply(null,arguments)}function ma(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var C=Date.now||function(){return+new Date};
function na(a,b){var c=a.split("."),d=r;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function D(a,b){function c(){}c.prototype=b.prototype;a.q=b.prototype;a.prototype=new c;a.Wd=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};function oa(a){Error.captureStackTrace?Error.captureStackTrace(this,oa):this.stack=Error().stack||"";a&&(this.message=String(a))}D(oa,Error);oa.prototype.name="CustomError";var pa;function qa(a,b){return 0==a.lastIndexOf(b,0)}function ra(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}function sa(a){return/^[\s\xa0]*$/.test(a)}function ta(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}function ua(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")}
function va(a){if(!wa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(xa,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(ya,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(za,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Aa,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ba,"&#39;"));return a}var xa=/&/g,ya=/</g,za=/>/g,Aa=/"/g,Ba=/'/g,wa=/[&<>"']/;function Ca(a){return ua(a.replace(/  /g," &#160;"),void 0)}
function Da(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a}var Ea={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"},Fa={"'":"\\'"};
function Ga(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0),f=b,g=c+1,h;if(!(h=Ea[d])){if(!(31<e&&127>e))if(d in Fa)d=Fa[d];else if(d in Ea)d=Fa[d]=Ea[d];else{e=d;h=d.charCodeAt(0);if(31<h&&127>h)e=d;else{if(256>h){if(e="\\x",16>h||256<h)e+="0"}else e="\\u",4096>h&&(e+="0");e+=h.toString(16).toUpperCase()}d=Fa[d]=e}h=d}f[g]=h}b.push('"');return b.join("")}function Ha(a,b){return a<b?-1:a>b?1:0};function Ia(a,b){b.unshift(a);oa.call(this,ra.apply(null,b));b.shift()}D(Ia,oa);Ia.prototype.name="AssertionError";function Ja(a,b){throw new Ia("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};var Ka=Array.prototype,La=Ka.indexOf?function(a,b,c){return Ka.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(w(a))return w(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ma=Ka.forEach?function(a,b,c){Ka.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=w(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Na=Ka.filter?function(a,b,c){return Ka.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=
0,g=w(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var l=g[h];b.call(c,l,h,a)&&(e[f++]=l)}return e},Oa=Ka.map?function(a,b,c){return Ka.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=w(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},Pa=Ka.some?function(a,b,c){return Ka.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=w(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},Qa=Ka.every?function(a,b,c){return Ka.every.call(a,b,c)}:function(a,
b,c){for(var d=a.length,e=w(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};function Ra(a,b){var c=Sa(a,b,void 0);return 0>c?null:w(a)?a.charAt(c):a[c]}function Sa(a,b,c){for(var d=a.length,e=w(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Ta(a,b){return 0<=La(a,b)}function Ua(a){if(!u(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Va(a,b){var c=La(a,b),d;(d=0<=c)&&Ka.splice.call(a,c,1);return d}
function Wa(a){return Ka.concat.apply(Ka,arguments)}function Xa(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function Ya(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(u(d)||(e=v(d))&&Object.prototype.hasOwnProperty.call(d,"callee"))a.push.apply(a,d);else if(e)for(var f=a.length,g=d.length,h=0;h<g;h++)a[f+h]=d[h];else a.push(d)}}function Za(a,b,c){return 2>=arguments.length?Ka.slice.call(a,b):Ka.slice.call(a,b,c)}
function $a(a,b){if(!v(a)||!v(b)||a.length!=b.length)return!1;for(var c=a.length,d=ab,e=0;e<c;e++)if(!d(a[e],b[e]))return!1;return!0}function ab(a,b){return a===b};function bb(a){return function(){throw a;}};/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
function E(a,b){this.l=[];this.G=a;this.u=b||null}k=E.prototype;k.qa=!1;k.Fa=!1;k.hb=!1;k.Zc=!1;k.Nc=!1;k.yb=0;function cb(a,b){if(a.qa)a.j instanceof E&&cb(a.j);else{if(a.h){var c=a.h;delete a.h;b?cb(c,b):(c.yb--,0>=c.yb&&cb(c))}a.G?a.G.call(a.u,a):a.Nc=!0;a.qa||a.s(new db)}}k.Eb=function(a,b){this.hb=!1;eb(this,a,b)};function eb(a,b,c){a.qa=!0;a.j=c;a.Fa=!b;a.tc()}function fb(a){if(a.qa){if(!a.Nc)throw new gb;a.Nc=!1}}k.p=function(a){fb(this);eb(this,!0,a)};k.s=function(a){fb(this);eb(this,!1,a)};
k.F=function(a,b){return this.t(a,null,b)};k.gb=function(a,b){return this.t(null,a,b)};k.Q=function(a,b){return this.t(a,a,b)};k.t=function(a,b,c){this.l.push([a,b,c]);this.qa&&this.tc();return this};function hb(a,b){a.t(b.p,b.s,b)}function ib(a){return Pa(a.l,function(a){return fa(a[1])})}
k.tc=function(){this.m&&this.qa&&ib(this)&&(r.clearTimeout(this.m),delete this.m);this.h&&(this.h.yb--,delete this.h);for(var a=this.j,b=!1,c=!1;this.l.length&&!this.hb;){var d=this.l.shift(),e=d[0],f=d[1],d=d[2];if(e=this.Fa?f:e)try{var g=e.call(d||this.u,a);t(g)&&(this.Fa=this.Fa&&(g==a||g instanceof Error),this.j=a=g);a instanceof E&&(this.hb=c=!0)}catch(h){a=h,this.Fa=!0,ib(this)||(b=!0)}}this.j=a;c&&(a.t(B(this.Eb,this,!0),B(this.Eb,this,!1)),a.Zc=!0);b&&(this.m=r.setTimeout(bb(a),0))};
function jb(a){var b=new E;b.p(a);return b}function kb(a){var b=new E;b.s(a);return b}function lb(a){Error.captureStackTrace?Error.captureStackTrace(this,lb):this.stack=Error().stack||"";a&&(this.message=String(a))}D(lb,Error);function gb(){lb.call(this)}D(gb,lb);gb.prototype.message="Deferred has already fired";gb.prototype.name="AlreadyCalledError";function db(){lb.call(this)}D(db,lb);db.prototype.message="Deferred was canceled";db.prototype.name="CanceledError";function mb(){0!=nb&&(ob[this[ha]||(this[ha]=++ia)]=this)}var nb=0,ob={};mb.prototype.ia=!1;mb.prototype.Da=function(){if(!this.ia&&(this.ia=!0,this.I(),0!=nb)){var a=this[ha]||(this[ha]=++ia);delete ob[a]}};mb.prototype.I=function(){if(this.ub)for(;this.ub.length;)this.ub.shift()()};var pb,qb,rb,sb;function ub(){return r.navigator?r.navigator.userAgent:null}sb=rb=qb=pb=!1;var vb;if(vb=ub()){var wb=r.navigator;pb=qa(vb,"Opera");qb=!pb&&(-1!=vb.indexOf("MSIE")||-1!=vb.indexOf("Trident"));rb=!pb&&-1!=vb.indexOf("WebKit");sb=!pb&&!rb&&!qb&&"Gecko"==wb.product}var xb=pb,yb=qb,zb=sb,Ab=rb;function Bb(){var a=r.document;return a?a.documentMode:void 0}var Cb;
a:{var Db="",Eb;if(xb&&r.opera)var Fb=r.opera.version,Db="function"==typeof Fb?Fb():Fb;else if(zb?Eb=/rv\:([^\);]+)(\)|;)/:yb?Eb=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:Ab&&(Eb=/WebKit\/(\S+)/),Eb)var Gb=Eb.exec(ub()),Db=Gb?Gb[1]:"";if(yb){var Hb=Bb();if(Hb>parseFloat(Db)){Cb=String(Hb);break a}}Cb=Db}var Ib={};
function Jb(a){var b;if(!(b=Ib[a])){b=0;for(var c=ta(String(Cb)).split("."),d=ta(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",l=/(\d*)(\D*)/g,m=/(\d*)(\D*)/g;do{var n=l.exec(g)||["","",""],p=m.exec(h)||["","",""];if(0==n[0].length&&0==p[0].length)break;b=Ha(0==n[1].length?0:parseInt(n[1],10),0==p[1].length?0:parseInt(p[1],10))||Ha(0==n[2].length,0==p[2].length)||Ha(n[2],p[2])}while(0==b)}b=Ib[a]=0<=b}return b}
var Kb=r.document,Lb=Kb&&yb?Bb()||("CSS1Compat"==Kb.compatMode?parseInt(Cb,10):5):void 0;var Mb=!yb||yb&&9<=Lb,Nb=yb&&!Jb("9");!Ab||Jb("528");zb&&Jb("1.9b")||yb&&Jb("8")||xb&&Jb("9.5")||Ab&&Jb("528");zb&&!Jb("8")||yb&&Jb("9");function F(a,b){this.type=a;this.g=this.target=b}F.prototype.Da=function(){};F.prototype.h=!1;F.prototype.nd=!0;F.prototype.preventDefault=function(){this.nd=!1};function Pb(a){Pb[" "](a);return a}Pb[" "]=ca;function Qb(a,b){F.call(this,a?a.type:"");this.g=this.target=null;this.clientY=this.clientX=0;this.j=null;a&&this.init(a,b)}D(Qb,F);Qb.prototype.init=function(a,b){this.type=a.type;this.target=a.target||a.srcElement;this.g=b;var c=a.relatedTarget;if(c&&zb)try{Pb(c.nodeName)}catch(d){}this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.j=a;a.defaultPrevented&&this.preventDefault();delete this.h};
Qb.prototype.preventDefault=function(){Qb.q.preventDefault.call(this);var a=this.j;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Nb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Rb="closure_listenable_"+(1E6*Math.random()|0);function Sb(a){try{return!(!a||!a[Rb])}catch(b){return!1}}var Tb=0;function Ub(a,b,c,d,e){this.Ma=a;this.proxy=null;this.src=b;this.type=c;this.Ab=!!d;this.Mb=e;this.key=++Tb;this.removed=this.zb=!1}function Vb(a){a.removed=!0;a.Ma=null;a.proxy=null;a.src=null;a.Mb=null};function Wb(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function Xb(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Yb(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Zb(a,b){for(var c=v(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],t(a));c++);return a}function $b(a){var b={},c;for(c in a)b[c]=a[c];return b}var ac="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function bc(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<ac.length;f++)c=ac[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function cc(a){this.src=a;this.g={};this.h=0}cc.prototype.add=function(a,b,c,d,e){var f=this.g[a];f||(f=this.g[a]=[],this.h++);var g=dc(f,b,d,e);-1<g?(a=f[g],c||(a.zb=!1)):(a=new Ub(b,this.src,a,!!d,e),a.zb=c,f.push(a));return a};cc.prototype.remove=function(a,b,c,d){if(!(a in this.g))return!1;var e=this.g[a];b=dc(e,b,c,d);return-1<b?(Vb(e[b]),Ka.splice.call(e,b,1),0==e.length&&(delete this.g[a],this.h--),!0):!1};
function ec(a,b){var c=b.type;if(!(c in a.g))return!1;var d=Va(a.g[c],b);d&&(Vb(b),0==a.g[c].length&&(delete a.g[c],a.h--));return d}cc.prototype.removeAll=function(a){var b=0,c;for(c in this.g)if(!a||c==a){for(var d=this.g[c],e=0;e<d.length;e++)++b,Vb(d[e]);delete this.g[c];this.h--}return b};function fc(a,b,c,d,e){a=a.g[b];b=-1;a&&(b=dc(a,c,d,e));return-1<b?a[b]:null}function dc(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.Ma==b&&f.Ab==!!c&&f.Mb==d)return e}return-1};var gc="closure_lm_"+(1E6*Math.random()|0),hc={},ic=0;function jc(a,b,c,d,e){if(u(b)){for(var f=0;f<b.length;f++)jc(a,b[f],c,d,e);return null}c=kc(c);return Sb(a)?a.listen(b,c,d,e):lc(a,b,c,!1,d,e)}function lc(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=mc(a);h||(a[gc]=h=new cc(a));c=h.add(b,c,d,e,f);if(c.proxy)return c;d=nc();c.proxy=d;d.src=a;d.Ma=c;a.addEventListener?a.addEventListener(b,d,g):a.attachEvent(b in hc?hc[b]:hc[b]="on"+b,d);ic++;return c}
function nc(){var a=oc,b=Mb?function(c){return a.call(b.src,b.Ma,c)}:function(c){c=a.call(b.src,b.Ma,c);if(!c)return c};return b}function pc(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)pc(a,b[f],c,d,e);else c=kc(c),Sb(a)?a.pa.add(String(b),c,!0,d,e):lc(a,b,c,!0,d,e)}function qc(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)qc(a,b[f],c,d,e);else c=kc(c),Sb(a)?a.ob(b,c,d,e):a&&(a=mc(a))&&(b=fc(a,b,c,!!d,e))&&sc(b)}
function sc(a){if(x(a)||!a||a.removed)return!1;var b=a.src;if(Sb(b))return ec(b.pa,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.Ab):b.detachEvent&&b.detachEvent(c in hc?hc[c]:hc[c]="on"+c,d);ic--;(c=mc(b))?(ec(c,a),0==c.h&&(c.src=null,b[gc]=null)):Vb(a);return!0}function tc(a,b,c,d){var e=1;if(a=mc(a))if(b=a.g[b])for(b=Xa(b),a=0;a<b.length;a++){var f=b[a];f&&f.Ab==c&&!f.removed&&(e&=!1!==uc(f,d))}return Boolean(e)}
function uc(a,b){var c=a.Ma,d=a.Mb||a.src;a.zb&&sc(a);return c.call(d,b)}
function oc(a,b){if(a.removed)return!0;if(!Mb){var c=b||ba("window.event"),d=new Qb(c,this),e=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(g){f=!0}if(f||void 0==c.returnValue)c.returnValue=!0}c=[];for(f=d.g;f;f=f.parentNode)c.push(f);for(var f=a.type,h=c.length-1;!d.h&&0<=h;h--)d.g=c[h],e&=tc(c[h],f,!0,d);for(h=0;!d.h&&h<c.length;h++)d.g=c[h],e&=tc(c[h],f,!1,d)}return e}return uc(a,new Qb(b,this))}
function mc(a){a=a[gc];return a instanceof cc?a:null}var vc="__closure_events_fn_"+(1E9*Math.random()>>>0);function kc(a){return fa(a)?a:a[vc]||(a[vc]=function(b){return a.handleEvent(b)})};function wc(){mb.call(this);this.pa=new cc(this);this.vb=this}D(wc,mb);wc.prototype[Rb]=!0;k=wc.prototype;k.Kc=null;k.removeEventListener=function(a,b,c,d){qc(this,a,b,c,d)};
k.dispatchEvent=function(a){var b,c=this.Kc;if(c)for(b=[];c;c=c.Kc)b.push(c);var c=this.vb,d=a.type||a;if(w(a))a=new F(a,c);else if(a instanceof F)a.target=a.target||c;else{var e=a;a=new F(d,c);bc(a,e)}var e=!0,f;if(b)for(var g=b.length-1;!a.h&&0<=g;g--)f=a.g=b[g],e=xc(f,d,!0,a)&&e;a.h||(f=a.g=c,e=xc(f,d,!0,a)&&e,a.h||(e=xc(f,d,!1,a)&&e));if(b)for(g=0;!a.h&&g<b.length;g++)f=a.g=b[g],e=xc(f,d,!1,a)&&e;return e};k.I=function(){wc.q.I.call(this);this.pa&&this.pa.removeAll(void 0);this.Kc=null};
k.listen=function(a,b,c,d){return this.pa.add(String(a),b,!1,c,d)};k.ob=function(a,b,c,d){return this.pa.remove(String(a),b,c,d)};function xc(a,b,c,d){b=a.pa.g[String(b)];if(!b)return!0;b=Xa(b);for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.removed&&g.Ab==c){var h=g.Ma,l=g.Mb||g.src;g.zb&&ec(a.pa,g);e=!1!==h.call(l,d)&&e}}return e&&!1!=d.nd};function I(a){oa.call(this,a);this.name="ydn.error.ArgumentException"}D(I,oa);function yc(a){oa.call(this,a);this.name="ydn.error.NotSupportedException"}D(yc,oa);function zc(a){oa.call(this,a);this.name="ydn.error.NotImplementedException"}D(zc,oa);function Ac(a){oa.call(this,a);this.name="ydn.error.InvalidOperationException"}D(Ac,oa);
function Bc(a){Error.captureStackTrace?Error.captureStackTrace(this,Bc):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}D(Bc,Error);Bc.prototype.name="ydn.error.InternalError";function Cc(a,b){E.call(this,a,b);this.k=[]}D(Cc,E);function Dc(a,b){for(var c=0;c<a.k.length;c++)a.k[c][0].call(a.k[c][1],b)}Cc.prototype.p=function(a){this.k.length=0;Cc.q.p.call(this,a)};Cc.prototype.s=function(a){this.k.length=0;Cc.q.s.call(this,a)};function Ec(a){this.id="i"+this.count();this.req=a;this.j=!0;this.g=this.h=null;this.k=new Cc;this.l=NaN}var Fc=0;Ec.prototype.count=function(){Fc++;return Fc};
Ec.prototype.listen=function(a){if(a&&a.id==this.id){this.h=a.data;var b=a.error;b&&(b instanceof Error?this.g=b:z(b)?(this.g=Error(b.message),this.g.name=b.name,this.g.source=b,this.g.result=this.h):(this.g=Error(b),this.g.name="UnknownError"));a.done?(this.j=!1,this.g?this.k.s(this.g):this.k.p(this.h),window.clearTimeout(this.l)):Dc(this.k,a.data);return!0}return!1};Ec.prototype.toString=function(){return"Message:"+this.id+(this.j?"*":"")};
Ec.prototype.toJSON=function(){var a=this;this.l=window.setTimeout(function(){if(a.j){var b=Error("message timeout");b.name="TimeOutError";a.listen({id:a.id,req:a.req,error:b})}},5E3);return{id:this.id,req:this.req,group:this.m,name:this.n,data:this.h}};function Gc(a){wc.call(this);var b=w(a)?null:a;this.name=w(a)?a:a.name;this.g=[];this.l=b;this.h=null;this.j={}}D(Gc,wc);Gc.prototype.I=function(){if(this.h){var a=this;this.h.disconnect(function(){a.h=null;a.g.length=0})}else this.g.length=0};function Hc(a){F.call(this,"post");this.message=a}D(Hc,F);Hc.prototype.getMessage=function(){return this.message};
Gc.prototype.k=function(a){if(a)if(a.id)for(var b=this.g.length-1;0<=b;b--){if(this.g[b].id==a.id&&this.g[b].listen(a)){this.g[b].j?25<b&&(a=this.g.splice(b,1),this.g.unshift(a[0])):this.g.splice(b,1);break}}else"info"==a.req?(a.data=this.l,this.h.postMessage(a)):this.dispatchEvent(new Hc(a))};Gc.prototype.toString=function(){return"Pipe:"+this.name};
function Ic(a){if(!a.h){a.h=chrome.runtime.connect({name:a.name});var b=B(a.k,a);a.h.onMessage.addListener(b);a.h.onDisconnect.addListener(function(){a.h.onMessage.removeListener(b);a.h=null;a.g.length=0})}return a.h}var Jc=null,Kc=["gmail","host-permission","popup","options"];function Lc(a,b,c){this.g=a;this.h=b;this.j=c}
Lc.prototype.send=function(a,b){var c=new Ec(a),d=this.j;c.m=this.h;c.n=d;b&&(c.h=b);var d=c.k,e=this.g,f=c.toJSON();Ic(e).postMessage(f);e.g.push(c);50<e.g.length&&(e.g.length-=1);return d};function Mc(a){if("function"==typeof a.U)return a.U();if(w(a))return a.split("");if(v(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Xb(a)}function Nc(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(v(a)||w(a))Ma(a,b,c);else{var d;if("function"==typeof a.aa)d=a.aa();else if("function"!=typeof a.U)if(v(a)||w(a)){d=[];for(var e=a.length,f=0;f<e;f++)d.push(f)}else d=Yb(a);else d=void 0;for(var e=Mc(a),f=e.length,g=0;g<f;g++)b.call(c,e[g],d&&d[g],a)}};var Oc="StopIteration"in r?r.StopIteration:Error("StopIteration");function Pc(){}Pc.prototype.g=function(){throw Oc;};Pc.prototype.oa=function(){return this};function Qc(a){if(a instanceof Pc)return a;if("function"==typeof a.oa)return a.oa(!1);if(v(a)){var b=0,c=new Pc;c.g=function(){for(;;){if(b>=a.length)throw Oc;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");}
function Rc(a,b,c){if(v(a))try{Ma(a,b,c)}catch(d){if(d!==Oc)throw d;}else{a=Qc(a);try{for(;;)b.call(c,a.g(),void 0,a)}catch(e){if(e!==Oc)throw e;}}}function Sc(a){if(v(a))return Xa(a);a=Qc(a);var b=[];Rc(a,function(a){b.push(a)});return b};function Tc(a,b){this.h={};this.g=[];this.k=this.j=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof Tc?(c=a.aa(),d=a.U()):(c=Yb(a),d=Xb(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}k=Tc.prototype;k.K=function(){return this.j};k.U=function(){Uc(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a};k.aa=function(){Uc(this);return this.g.concat()};
k.va=function(){return 0==this.j};k.clear=function(){this.h={};this.k=this.j=this.g.length=0};k.remove=function(a){return Vc(this.h,a)?(delete this.h[a],this.j--,this.k++,this.g.length>2*this.j&&Uc(this),!0):!1};function Uc(a){if(a.j!=a.g.length){for(var b=0,c=0;b<a.g.length;){var d=a.g[b];Vc(a.h,d)&&(a.g[c++]=d);b++}a.g.length=c}if(a.j!=a.g.length){for(var e={},c=b=0;b<a.g.length;)d=a.g[b],Vc(e,d)||(a.g[c++]=d,e[d]=1),b++;a.g.length=c}}k.get=function(a,b){return Vc(this.h,a)?this.h[a]:b};
k.set=function(a,b){Vc(this.h,a)||(this.j++,this.g.push(a),this.k++);this.h[a]=b};k.T=function(){return new Tc(this)};k.oa=function(a){Uc(this);var b=0,c=this.g,d=this.h,e=this.k,f=this,g=new Pc;g.g=function(){for(;;){if(e!=f.k)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw Oc;var g=c[b++];return a?g:d[g]}};return g};function Vc(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var Wc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function Xc(a){if(Yc){Yc=!1;var b=r.location;if(b){var c=b.href;if(c&&(c=(c=Xc(c)[3]||null)&&decodeURIComponent(c))&&c!=b.hostname)throw Yc=!0,Error();}}return a.match(Wc)}var Yc=Ab;function Zc(a,b){var c;if(a instanceof Zc)this.La=t(b)?b:a.La,$c(this,a.Sa),this.$b=a.$b,ad(this,a.Ea),bd(this,a.Kb),cd(this,a.Qa),dd(this,a.g.T()),ed(this,a.uc);else if(a&&(c=Xc(String(a)))){this.La=!!b;$c(this,c[1]||"",!0);var d=c[2]||"";this.$b=d?decodeURIComponent(d):"";ad(this,c[3]||"",!0);bd(this,c[4]);cd(this,c[5]||"",!0);dd(this,c[6]||"",!0);ed(this,c[7]||"",!0)}else this.La=!!b,this.g=new fd(null,0,this.La)}k=Zc.prototype;k.Sa="";k.$b="";k.Ea="";k.Kb=null;k.Qa="";k.uc="";k.La=!1;
k.toString=function(){var a=[],b=this.Sa;b&&a.push(gd(b,hd),":");if(b=this.Ea){a.push("//");var c=this.$b;c&&a.push(gd(c,hd),"@");a.push(encodeURIComponent(String(b)));b=this.Kb;null!=b&&a.push(":",String(b))}if(b=this.Qa)this.Ea&&"/"!=b.charAt(0)&&a.push("/"),a.push(gd(b,"/"==b.charAt(0)?id:jd));(b=this.g.toString())&&a.push("?",b);(b=this.uc)&&a.push("#",gd(b,kd));return a.join("")};k.T=function(){return new Zc(this)};
function $c(a,b,c){a.Sa=c?b?decodeURIComponent(b):"":b;a.Sa&&(a.Sa=a.Sa.replace(/:$/,""));return a}function ld(a){return a.Ea}function ad(a,b,c){a.Ea=c?b?decodeURIComponent(b):"":b;return a}function bd(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Kb=b}else a.Kb=null}function cd(a,b,c){a.Qa=c?b?decodeURIComponent(b):"":b}function dd(a,b,c){b instanceof fd?(a.g=b,md(a.g,a.La)):(c||(b=gd(b,nd)),a.g=new fd(b,0,a.La))}
function ed(a,b,c){a.uc=c?b?decodeURIComponent(b):"":b}function gd(a,b){return w(a)?encodeURI(a).replace(b,od):null}function od(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var hd=/[#\/\?@]/g,jd=/[\#\?:]/g,id=/[\#\?]/g,nd=/[\#\?@]/g,kd=/#/g;function fd(a,b,c){this.g=a||null;this.h=!!c}
function pd(a){if(!a.M&&(a.M=new Tc,a.Y=0,a.g))for(var b=a.g.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=null,f=null;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c];e=decodeURIComponent(e.replace(/\+/g," "));e=qd(a,e);a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}k=fd.prototype;k.M=null;k.Y=null;k.K=function(){pd(this);return this.Y};k.add=function(a,b){pd(this);this.g=null;a=qd(this,a);var c=this.M.get(a);c||this.M.set(a,c=[]);c.push(b);this.Y++;return this};
k.remove=function(a){pd(this);a=qd(this,a);return Vc(this.M.h,a)?(this.g=null,this.Y-=this.M.get(a).length,this.M.remove(a)):!1};k.clear=function(){this.M=this.g=null;this.Y=0};k.va=function(){pd(this);return 0==this.Y};function rd(a,b){pd(a);b=qd(a,b);return Vc(a.M.h,b)}k.aa=function(){pd(this);for(var a=this.M.U(),b=this.M.aa(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};
k.U=function(a){pd(this);var b=[];if(w(a))rd(this,a)&&(b=Wa(b,this.M.get(qd(this,a))));else{a=this.M.U();for(var c=0;c<a.length;c++)b=Wa(b,a[c])}return b};k.set=function(a,b){pd(this);this.g=null;a=qd(this,a);rd(this,a)&&(this.Y-=this.M.get(a).length);this.M.set(a,[b]);this.Y++;return this};k.get=function(a,b){var c=a?this.U(a):[];return 0<c.length?String(c[0]):b};
k.toString=function(){if(this.g)return this.g;if(!this.M)return"";for(var a=[],b=this.M.aa(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.U(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f])));a.push(g)}return this.g=a.join("&")};k.T=function(){var a=new fd;a.g=this.g;this.M&&(a.M=this.M.T(),a.Y=this.Y);return a};function qd(a,b){var c=String(b);a.h&&(c=c.toLowerCase());return c}
function md(a,b){b&&!a.h&&(pd(a),a.g=null,Nc(a.M,function(a,b){var e=b.toLowerCase();b!=e&&(this.remove(b),this.remove(e),0<a.length&&(this.g=null,this.M.set(qd(this,e),Xa(a)),this.Y+=a.length))},a));a.h=b};function sd(a){this.g=new Tc;if(a){a=Mc(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])}}function td(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+(a[ha]||(a[ha]=++ia)):b.substr(0,1)+a}k=sd.prototype;k.K=function(){return this.g.K()};k.add=function(a){this.g.set(td(a),a)};k.removeAll=function(a){a=Mc(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};k.remove=function(a){return this.g.remove(td(a))};k.clear=function(){this.g.clear()};k.va=function(){return this.g.va()};
k.contains=function(a){a=td(a);return Vc(this.g.h,a)};k.U=function(){return this.g.U()};k.T=function(){return new sd(this)};k.oa=function(){return this.g.oa(!1)};function ud(a){return vd(a||arguments.callee.caller,[])}
function vd(a,b){var c=[];if(Ta(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(wd(a)+"(");for(var d=a.arguments,e=0;e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=wd(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(vd(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?
c.push("[...long stack...]"):c.push("[end]");return c.join("")}function wd(a){if(xd[a])return xd[a];a=String(a);if(!xd[a]){var b=/function ([^\(]+)/.exec(a);xd[a]=b?b[1]:"[Anonymous]"}return xd[a]}var xd={};function yd(a,b,c,d,e){"number"==typeof e||zd++;this.l=d||C();this.k=a;this.m=b;this.j=c;delete this.h;delete this.g}yd.prototype.h=null;yd.prototype.g=null;var zd=0;yd.prototype.getMessage=function(){return this.m};function Ad(a){this.l=a}Ad.prototype.j=null;Ad.prototype.h=null;Ad.prototype.k=null;Ad.prototype.g=null;function Bd(a,b){this.name=a;this.value=b}Bd.prototype.toString=function(){return this.name};var Cd=new Bd("SHOUT",1200),Dd=new Bd("SEVERE",1E3),Ed=new Bd("WARNING",900),Fd=new Bd("INFO",800),Gd=new Bd("CONFIG",700),Hd=new Bd("FINE",500),Id=new Bd("FINER",400),Jd=new Bd("FINEST",300),Kd=[new Bd("OFF",Infinity),Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,new Bd("ALL",0)],Ld=null;k=Ad.prototype;k.getName=function(){return this.l};
k.getParent=function(){return this.j};k.getChildren=function(){this.k||(this.k={});return this.k};function Md(a){if(a.h)return a.h;if(a.j)return Md(a.j);Ja("Root logger has no level set.");return null}
k.log=function(a,b,c){if(a.value>=Md(this).value)for(fa(b)&&(b=b()),a=this.zd(a,b,c),b="log:"+a.getMessage(),r.console&&(r.console.timeStamp?r.console.timeStamp(b):r.console.markTimeline&&r.console.markTimeline(b)),r.msWriteProfilerMark&&r.msWriteProfilerMark(b),b=this;b;){c=b;var d=a;if(c.g)for(var e=0,f=void 0;f=c.g[e];e++)f(d);b=b.getParent()}};
k.zd=function(a,b,c){var d=new yd(a,String(b),this.l);if(c){d.h=c;var e;var f=arguments.callee.caller;try{var g;var h=ba("window.location.href");if(w(c))g={message:c,name:"Unknown error",lineNumber:"Not available",fileName:h,stack:"Not available"};else{var l,m,n=!1;try{l=c.lineNumber||c.Yd||"Not available"}catch(p){l="Not available",n=!0}try{m=c.fileName||c.filename||c.sourceURL||r.$googDebugFname||h}catch(q){m="Not available",n=!0}g=!n&&c.lineNumber&&c.fileName&&c.stack&&c.message&&c.name?c:{message:c.message||
"Not available",name:c.name||"UnknownError",lineNumber:l,fileName:m,stack:c.stack||"Not available"}}e="Message: "+va(g.message)+'\nUrl: <a href="view-source:'+g.fileName+'" target="_new">'+g.fileName+"</a>\nLine: "+g.lineNumber+"\n\nBrowser stack:\n"+va(g.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+va(ud(f)+"-> ")}catch(s){e="Exception trying to expose exception! You win, we lose. "+s}d.g=e}return d};function K(a,b,c){a.log(Ed,b,c)}k.info=function(a,b){this.log(Fd,a,b)};
function L(a,b,c){a.log(Hd,b,c)}function M(a,b){a.log(Id,b,void 0)}function N(a,b){a.log(Jd,b,void 0)}var Nd={},Od=null;function Pd(){Od||(Od=new Ad(""),Nd[""]=Od,Od.h=Gd)}function Qd(){Pd();return Od}function P(a){Pd();var b;if(!(b=Nd[a])){b=new Ad(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=P(a.substr(0,c));c.getChildren()[d]=b;b.j=c;Nd[a]=b}return b};function Rd(a){mb.call(this);this.h=a;this.g={}}D(Rd,mb);var Sd=[];k=Rd.prototype;k.listen=function(a,b,c,d){u(b)||(Sd[0]=b,b=Sd);for(var e=0;e<b.length;e++){var f=jc(a,b[e],c||this.handleEvent,d||!1,this.h||this);if(!f)break;this.g[f.key]=f}return this};k.ob=function(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)this.ob(a,b[f],c,d,e);else c=c||this.handleEvent,e=e||this.h||this,c=kc(c),d=!!d,b=Sb(a)?fc(a.pa,String(b),c,d,e):a?(a=mc(a))?fc(a,b,c,d,e):null:null,b&&(sc(b),delete this.g[b.key]);return this};
k.removeAll=function(){Wb(this.g,sc);this.g={}};k.I=function(){Rd.q.I.call(this);this.removeAll()};k.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};function Td(a,b,c){if(fa(a))c&&(a=B(a,c));else if(a&&"function"==typeof a.handleEvent)a=B(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<b?-1:r.setTimeout(a,b||0)};function Ud(a){a=String(a);if(/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return JSON.parse(a)}catch(b){}throw Error("Invalid JSON string: "+a);}function Vd(){}function Wd(a,b){var c=[];Xd(a,b,c);return c.join("")}
function Xd(a,b,c){switch(typeof b){case "string":Yd(b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case "boolean":c.push(b);break;case "undefined":c.push("null");break;case "object":if(null==b){c.push("null");break}if(u(b)){var d=b.length;c.push("[");for(var e="",f=0;f<d;f++)c.push(e),Xd(a,b[f],c),e=",";c.push("]");break}c.push("{");d="";for(e in b)Object.prototype.hasOwnProperty.call(b,e)&&(f=b[e],"function"!=typeof f&&(c.push(d),Yd(e,c),c.push(":"),Xd(a,f,c),d=","));c.push("}");
break;case "function":break;default:throw Error("Unknown type: "+typeof b);}}var Zd={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},$d=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Yd(a,b){b.push('"',a.replace($d,function(a){if(a in Zd)return Zd[a];var b=a.charCodeAt(0),e="\\u";16>b?e+="000":256>b?e+="00":4096>b&&(e+="0");return Zd[a]=e+b.toString(16)}),'"')};function ae(a,b){a&&L(a,b,void 0)};function be(){}be.prototype.g=null;function ce(a){var b;(b=a.g)||(b={},de(a)&&(b[0]=!0,b[1]=!0),b=a.g=b);return b};var ee;function fe(){}D(fe,be);function ge(a){return(a=de(a))?new ActiveXObject(a):new XMLHttpRequest}function de(a){if(!a.h&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.h=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return a.h}ee=new fe;function he(a){wc.call(this);this.headers=new Tc;this.N=a||null;this.h=!1;this.H=this.D=null;this.Ca=this.o="";this.m=0;this.n="";this.j=this.da=this.u=this.ca=!1;this.l=0;this.B=null;this.k=ie;this.G=this.lc=!1}D(he,wc);var ie="";he.prototype.g=P("goog.net.XhrIo");var je=/^https?$/i,ke=["POST","PUT"];k=he.prototype;k.fd=function(){return this.k};
k.send=function(a,b,c,d){if(this.D)throw Error("[goog.net.XhrIo] Object is active with another request="+this.o+"; newUri="+a);b=b?b.toUpperCase():"GET";this.o=a;this.n="";this.m=0;this.Ca=b;this.ca=!1;this.h=!0;this.D=this.N?ge(this.N):ge(ee);this.H=this.N?ce(this.N):ce(ee);this.D.onreadystatechange=B(this.ld,this);try{ae(this.g,le(this,"Opening Xhr")),this.da=!0,this.D.open(b,a,!0),this.da=!1}catch(e){ae(this.g,le(this,"Error opening Xhr: "+e.message));me(this,e);return}a=c||"";var f=this.headers.T();
d&&Nc(d,function(a,b){f.set(b,a)});d=Ra(f.aa(),ne);c=r.FormData&&a instanceof r.FormData;!Ta(ke,b)||d||c||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");Nc(f,function(a,b){this.D.setRequestHeader(b,a)},this);this.k&&(this.D.responseType=this.k);"withCredentials"in this.D&&(this.D.withCredentials=this.lc);try{oe(this),0<this.l&&(this.G=pe(this.D),ae(this.g,le(this,"Will abort after "+this.l+"ms if incomplete, xhr2 "+this.G)),this.G?(this.D.timeout=this.l,this.D.ontimeout=B(this.pd,
this)):this.B=Td(this.pd,this.l,this)),ae(this.g,le(this,"Sending request")),this.u=!0,this.D.send(a),this.u=!1}catch(g){ae(this.g,le(this,"Send error: "+g.message)),me(this,g)}};function pe(a){return yb&&Jb(9)&&x(a.timeout)&&t(a.ontimeout)}function ne(a){return"content-type"==a.toLowerCase()}k.pd=function(){"undefined"!=typeof aa&&this.D&&(this.n="Timed out after "+this.l+"ms, aborting",this.m=8,ae(this.g,le(this,this.n)),this.dispatchEvent("timeout"),this.abort(8))};
function me(a,b){a.h=!1;a.D&&(a.j=!0,a.D.abort(),a.j=!1);a.n=b;a.m=5;qe(a);re(a)}function qe(a){a.ca||(a.ca=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}k.abort=function(a){this.D&&this.h&&(ae(this.g,le(this,"Aborting")),this.h=!1,this.j=!0,this.D.abort(),this.j=!1,this.m=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),re(this))};k.I=function(){this.D&&(this.h&&(this.h=!1,this.j=!0,this.D.abort(),this.j=!1),re(this,!0));he.q.I.call(this)};
k.ld=function(){this.ia||(this.da||this.u||this.j?se(this):this.Fd())};k.Fd=function(){se(this)};function se(a){if(a.h&&"undefined"!=typeof aa)if(a.H[1]&&4==te(a)&&2==a.C())ae(a.g,le(a,"Local request error detected and ignored"));else if(a.u&&4==te(a))Td(a.ld,0,a);else if(a.dispatchEvent("readystatechange"),4==te(a)){ae(a.g,le(a,"Request complete"));a.h=!1;try{a.Z()?(a.dispatchEvent("complete"),a.dispatchEvent("success")):(a.m=6,a.n=a.ba()+" ["+a.C()+"]",qe(a))}finally{re(a)}}}
function re(a,b){if(a.D){oe(a);var c=a.D,d=a.H[0]?ca:null;a.D=null;a.H=null;b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){(c=a.g)&&c.log(Dd,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function oe(a){a.D&&a.G&&(a.D.ontimeout=null);x(a.B)&&(r.clearTimeout(a.B),a.B=null)}
k.Z=function(){var a=this.C(),b;a:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:b=!0;break a;default:b=!1}if(!b){if(a=0===a)a=Xc(String(this.o))[1]||null,!a&&self.location&&(a=self.location.protocol,a=a.substr(0,a.length-1)),a=!je.test(a?a.toLowerCase():"");b=a}return b};function te(a){return a.D?a.D.readyState:0}k.C=function(){try{return 2<te(this)?this.D.status:-1}catch(a){var b=this.g;b&&K(b,"Can not get status: "+a.message,void 0);return-1}};
k.ba=function(){try{return 2<te(this)?this.D.statusText:""}catch(a){return ae(this.g,"Can not get status: "+a.message),""}};
function ue(a){try{if(!a.D)return null;if("response"in a.D)return a.D.response;switch(a.k){case ie:case "text":return a.D.responseText;case "arraybuffer":if("mozResponseArrayBuffer"in a.D)return a.D.mozResponseArrayBuffer}var b=a.g;b&&b.log(Dd,"Response type "+a.k+" is not supported on this browser",void 0);return null}catch(c){return ae(a.g,"Can not get response: "+c.message),null}}function le(a,b){return b+" ["+a.Ca+" "+a.o+" "+a.C()+"]"};function ve(){this.j=this.h=0;this.g=[]}function we(a){if(a.h!=a.j){var b=a.g[a.h];delete a.g[a.h];a.h++;return b}}k=ve.prototype;k.K=function(){return this.j-this.h};k.va=function(){return 0==this.j-this.h};k.clear=function(){this.j=this.h=this.g.length=0};k.contains=function(a){return Ta(this.g,a)};k.remove=function(a){a=La(this.g,a);if(0>a)return!1;a==this.h?we(this):(Ka.splice.call(this.g,a,1),this.j--);return!0};k.U=function(){return this.g.slice(this.h,this.j)};function xe(a,b){mb.call(this);this.m=a||0;this.j=b||10;if(this.m>this.j)throw Error(ye);this.g=new ve;this.h=new sd;this.l=null;this.wb()}D(xe,mb);var ye="[goog.structs.Pool] Min can not be greater than max";k=xe.prototype;k.Lb=function(){var a=C();if(!(null!=this.l&&0>a-this.l)){for(var b;0<this.g.K()&&(b=we(this.g),!this.Jc(b));)this.wb();!b&&this.K()<this.j&&(b=this.Dc());b&&(this.l=a,this.h.add(b));return b}};k.Ub=function(a){return this.h.remove(a)?(this.mc(a),!0):!1};
k.mc=function(a){this.h.remove(a);if(this.Jc(a)&&this.K()<this.j){var b=this.g;b.g[b.j++]=a}else ze(a)};k.wb=function(){for(var a=this.g;this.K()<this.m;){var b=this.Dc();a.g[a.j++]=b}for(;this.K()>this.j&&0<this.g.K();)ze(we(a))};k.Dc=function(){return{}};function ze(a){if("function"==typeof a.Da)a.Da();else for(var b in a)a[b]=null}k.Jc=function(a){return"function"==typeof a.wd?a.wd():!0};k.contains=function(a){return this.g.contains(a)||this.h.contains(a)};k.K=function(){return this.g.K()+this.h.K()};
k.va=function(){return this.g.va()&&this.h.va()};k.I=function(){xe.q.I.call(this);if(0<this.h.K())throw Error("[goog.structs.Pool] Objects not released");delete this.h;for(var a=this.g;!a.va();)ze(we(a));delete this.g};function Ae(a,b){this.g=a;this.h=b}Ae.prototype.T=function(){return new Ae(this.g,this.h)};function Be(a){this.g=[];if(a)a:{var b,c;if(a instanceof Be){if(b=a.aa(),c=a.U(),0>=a.K()){a=this.g;for(var d=0;d<b.length;d++)a.push(new Ae(b[d],c[d]));break a}}else b=Yb(a),c=Xb(a);for(d=0;d<b.length;d++)Ce(this,b[d],c[d])}}function Ce(a,b,c){var d=a.g;d.push(new Ae(b,c));b=d.length-1;a=a.g;for(c=a[b];0<b;)if(d=b-1>>1,a[d].g>c.g)a[b]=a[d],b=d;else break;a[b]=c}k=Be.prototype;
k.remove=function(){var a=this.g,b=a.length,c=a[0];if(!(0>=b)){if(1==b)Ua(a);else{a[0]=a.pop();for(var a=0,b=this.g,d=b.length,e=b[a];a<d>>1;){var f=2*a+1,g=2*a+2,f=g<d&&b[g].g<b[f].g?g:f;if(b[f].g>e.g)break;b[a]=b[f];a=f}b[a]=e}return c.h}};k.U=function(){for(var a=this.g,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].h);return b};k.aa=function(){for(var a=this.g,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].g);return b};k.T=function(){return new Be(this)};k.K=function(){return this.g.length};
k.va=function(){return 0==this.g.length};k.clear=function(){Ua(this.g)};function De(){Be.call(this)}D(De,Be);function Ee(a,b){this.k=new De;xe.call(this,a,b)}D(Ee,xe);k=Ee.prototype;k.Lb=function(a,b){if(!a)return Ee.q.Lb.call(this);Ce(this.k,t(b)?b:100,a);this.Ec()};k.Ec=function(){for(var a=this.k;0<a.K();){var b=this.Lb();if(b)a.remove().apply(this,[b]);else break}};k.mc=function(a){Ee.q.mc.call(this,a);this.Ec()};k.wb=function(){Ee.q.wb.call(this);this.Ec()};k.I=function(){Ee.q.I.call(this);r.clearTimeout(void 0);this.k.clear();this.k=null};function Fe(a,b,c){Ee.call(this,b,c);this.n=a}D(Fe,Ee);Fe.prototype.Dc=function(){var a=new he,b=this.n;b&&Nc(b,function(b,d){a.headers.set(d,b)});return a};Fe.prototype.Jc=function(a){return!a.ia&&!a.D};function Ge(a,b,c,d,e){wc.call(this);this.j=t(a)?a:1;this.k=t(e)?Math.max(0,e):0;this.eb=new Fe(b,c,d);this.g=new Tc;this.h=new Rd(this)}D(Ge,wc);var He="ready complete success error abort timeout".split(" ");k=Ge.prototype;k.send=function(a,b,c,d,e,f,g,h,l){if(this.g.get(a))throw Error("[goog.net.XhrManager] ID in use");b=new Ie(b,B(this.Bd,this,a),c,d,e,g,t(h)?h:this.j,l);this.g.set(a,b);a=B(this.Ad,this,a);this.eb.Lb(a,f);return b};
k.abort=function(a,b){var c=this.g.get(a);if(c){var d=c.bc;c.Xc=!0;b&&(d&&(this.h.ob(d,He,c.ac),pc(d,"ready",function(){this.eb.Ub(d)},!1,this)),this.g.remove(a));d&&d.abort()}};k.Ad=function(a,b){var c=this.g.get(a);c&&!c.bc?(this.h.listen(b,He,c.ac),b.l=Math.max(0,this.k),b.k=c.fd(),c.bc=b,this.dispatchEvent(new Je("ready",this,a,b)),Ke(this,a,b),c.Xc&&b.abort()):this.eb.Ub(b)};
k.Bd=function(a,b){var c=b.target;switch(b.type){case "ready":Ke(this,a,c);break;case "complete":a:{var d=this.g.get(a);if(7==c.m||c.Z()||d.xb>d.Ac)if(this.dispatchEvent(new Je("complete",this,a,c)),d&&(d.bd=!0,d.pc)){c=d.pc.call(c,b);break a}c=null}return c;case "success":this.dispatchEvent(new Je("success",this,a,c));break;case "timeout":case "error":d=this.g.get(a);d.xb>d.Ac&&this.dispatchEvent(new Je("error",this,a,c));break;case "abort":this.dispatchEvent(new Je("abort",this,a,c))}return null};
function Ke(a,b,c){var d=a.g.get(b);!d||d.bd||d.xb>d.Ac?(d&&(a.h.ob(c,He,d.ac),a.g.remove(b)),a.eb.Ub(c)):(d.xb++,c.send(d.Hd,d.zc(),d.Jb(),d.Za()))}k.I=function(){Ge.q.I.call(this);this.eb.Da();this.eb=null;this.h.Da();this.h=null;var a=this.g;Nc(a,function(a){a.Da()});a.clear();this.g=null};function Je(a,b,c,d){F.call(this,a,b);this.id=c;this.bc=d}D(Je,F);
function Ie(a,b,c,d,e,f,g,h){mb.call(this);this.Hd=a;this.j=c||"GET";this.g=d;this.h=e||null;this.Ac=t(g)?g:1;this.xb=0;this.Xc=this.bd=!1;this.ac=b;this.pc=f;this.k=h||ie;this.bc=null}D(Ie,mb);k=Ie.prototype;k.zc=function(){return this.j};k.Jb=function(){return this.g};k.Za=function(){return this.h};k.fd=function(){return this.k};k.I=function(){Ie.q.I.call(this);delete this.ac;delete this.pc};function Le(a){for(var b=[],c=0,d=0;d<a.length;d++){for(var e=a.charCodeAt(d);255<e;)b[c++]=e&255,e>>=8;b[c++]=e}return b};function Me(){this.j=[];this.h=this.g=0};function Ne(){};function Oe(){this.g=[];this.l=[];this.o=[];this.j=[];this.j[0]=128;for(var a=1;64>a;++a)this.j[a]=0;this.m()}D(Oe,Ne);Oe.prototype.m=function(){this.g[0]=1732584193;this.g[1]=4023233417;this.g[2]=2562383102;this.g[3]=271733878;this.g[4]=3285377520;this.n=this.h=0};
function Pe(a,b,c){c||(c=0);var d=a.o;if(w(b))for(var e=0;16>e;e++)d[e]=b.charCodeAt(c)<<24|b.charCodeAt(c+1)<<16|b.charCodeAt(c+2)<<8|b.charCodeAt(c+3),c+=4;else for(e=0;16>e;e++)d[e]=b[c]<<24|b[c+1]<<16|b[c+2]<<8|b[c+3],c+=4;for(e=16;80>e;e++){var f=d[e-3]^d[e-8]^d[e-14]^d[e-16];d[e]=(f<<1|f>>>31)&4294967295}b=a.g[0];c=a.g[1];for(var g=a.g[2],h=a.g[3],l=a.g[4],m,e=0;80>e;e++)40>e?20>e?(f=h^c&(g^h),m=1518500249):(f=c^g^h,m=1859775393):60>e?(f=c&g|h&(c|g),m=2400959708):(f=c^g^h,m=3395469782),f=(b<<
5|b>>>27)+f+l+m+d[e]&4294967295,l=h,h=g,g=(c<<30|c>>>2)&4294967295,c=b,b=f;a.g[0]=a.g[0]+b&4294967295;a.g[1]=a.g[1]+c&4294967295;a.g[2]=a.g[2]+g&4294967295;a.g[3]=a.g[3]+h&4294967295;a.g[4]=a.g[4]+l&4294967295}
Oe.prototype.update=function(a,b){t(b)||(b=a.length);for(var c=b-64,d=0,e=this.l,f=this.h;d<b;){if(0==f)for(;d<=c;)Pe(this,a,d),d+=64;if(w(a))for(;d<b;){if(e[f]=a.charCodeAt(d),++f,++d,64==f){Pe(this,e);f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,64==f){Pe(this,e);f=0;break}}this.h=f;this.n+=b};
Oe.prototype.k=function(){var a=[],b=8*this.n;56>this.h?this.update(this.j,56-this.h):this.update(this.j,64-(this.h-56));for(var c=63;56<=c;c--)this.l[c]=b&255,b/=256;Pe(this,this.l);for(c=b=0;5>c;c++)for(var d=24;0<=d;d-=8)a[b]=this.g[c]>>d&255,++b;return a};var Qe=null,Re=null;function Se(a){this.g=a;this.h=new Vd}Se.prototype.set=function(a,b){t(b)?this.g.set(a,Wd(this.h,b)):this.g.remove(a)};Se.prototype.get=function(a){var b;try{b=this.g.get(a)}catch(c){return}if(null!==b)try{return Ud(b)}catch(d){throw"Storage: Invalid value was encountered";}};Se.prototype.remove=function(a){this.g.remove(a)};function Te(){};function Ue(a){Se.call(this,a)}D(Ue,Se);function Ve(a){this.data=a}function We(a){return!t(a)||a instanceof Ve?a:new Ve(a)}function Xe(a){a=a.data;if(!t(a))throw"Storage: Invalid value was encountered";return a}Ue.prototype.set=function(a,b){Ue.q.set.call(this,a,We(b))};Ue.prototype.$a=function(a){a=Ue.q.get.call(this,a);if(!t(a)||a instanceof Object)return a;throw"Storage: Invalid value was encountered";};Ue.prototype.get=function(a){return(a=this.$a(a))?Xe(a):void 0};function Ye(a){Se.call(this,a)}D(Ye,Ue);function Ze(a){var b=a.creation;a=a.expiration;return!!a&&a<C()||!!b&&b>C()}Ye.prototype.set=function(a,b,c){if(b=We(b)){if(c){if(c<C()){Ye.prototype.remove.call(this,a);return}b.expiration=c}b.creation=C()}Ye.q.set.call(this,a,b)};Ye.prototype.$a=function(a,b){var c=Ye.q.$a.call(this,a);if(c)if(!b&&Ze(c))Ye.prototype.remove.call(this,a);else return c};function $e(a){Se.call(this,a)}D($e,Ye);function af(a,b,c){var d=[];Rc(b,function(a){var b;try{b=$e.prototype.$a.call(this,a,!0)}catch(g){if("Storage: Invalid value was encountered"==g){c&&d.push(a);return}throw g;}if(!t(b))d.push(a);else if(Ze(b))d.push(a);else if(c)try{Xe(b)}catch(h){if("Storage: Invalid value was encountered"==h)d.push(a);else throw h;}},a);return d}function bf(a,b,c){b=af(a,b,c);Ma(b,function(a){$e.prototype.remove.call(this,a)},a)}
$e.prototype.Cb=function(a){bf(this,this.g.oa(!0),a)};function cf(){}D(cf,Te);cf.prototype.K=function(){var a=0;Rc(this.oa(!0),function(){a++});return a};cf.prototype.clear=function(){var a=Sc(this.oa(!0)),b=this;Ma(a,function(a){b.remove(a)})};function df(a,b){Se.call(this,a);this.Bc=Le(b);this.$c=new Vd}D(df,$e);k=df.prototype;k.Bc=null;k.$c=null;
function ef(a,b){var c=new Oe;c.update(Le(b));c.update(a.Bc);c=c.k();if(!v(c))throw Error("encodeByteArray takes an array as a parameter");if(!Qe){Qe={};Re={};for(var d=0;65>d;d++)Qe[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d),Re[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(d)}for(var d=Re,e=[],f=0;f<c.length;f+=3){var g=c[f],h=f+1<c.length,l=h?c[f+1]:0,m=f+2<c.length,n=m?c[f+2]:0,p=g>>2,g=(g&3)<<4|l>>4,l=(l&15)<<2|n>>6,n=n&63;
m||(n=64,h||(l=64));e.push(d[p],d[g],d[l],d[n])}return e.join("")}
function ff(a,b,c,d){if(!(0<b.length))throw Error("Non-empty salt must be provided");var e=new Oe;e.update(Le(c));e.update(b);e.update(a.Bc);a=new Me;var e=e.k(),f;f||(f=e.length);b=a.j;for(c=0;256>c;++c)b[c]=c;var g=0;for(c=0;256>c;++c){var g=g+b[c]+e[c%f]&255,h=b[c];b[c]=b[g];b[g]=h}a.g=0;a.h=0;f=a.g;e=a.h;b=a.j;for(c=0;1536>c;++c)f=f+1&255,e=e+b[f]&255,g=b[f],b[f]=b[e],b[e]=g;a.g=f;a.h=e;d=Le(d);var l;l||(l=d.length);f=a.g;e=a.h;b=a.j;for(c=0;c<l;++c)f=f+1&255,e=e+b[f]&255,g=b[f],b[f]=b[e],b[e]=
g,d[c]^=b[b[f]+b[e]&255];a.g=f;a.h=e;return String.fromCharCode.apply(null,d)}k.set=function(a,b,c){if(t(b)){for(var d=[],e=0;8>e;++e)d[e]=Math.floor(256*Math.random());b=new Ve(ff(this,d,a,Wd(this.$c,b)));b.salt=d;df.q.set.call(this,ef(this,a),b,c)}else df.prototype.remove.call(this,a)};
k.$a=function(a,b){var c=df.q.$a.call(this,ef(this,a),b);if(c){var d=Xe(c),e=c.salt;if(!w(d)||!u(e)||!e.length)throw"Storage: Invalid value was encountered";d=ff(this,e,a,d);try{c.data=Ud(d)}catch(f){throw"Storage: The value could not be decrypted";}return c}};k.remove=function(a){df.q.remove.call(this,ef(this,a))};function gf(a){this.g=a}D(gf,cf);k=gf.prototype;k.set=function(a,b){try{this.g.setItem(a,b)}catch(c){if(0==this.g.length)throw"Storage mechanism: Storage disabled";throw"Storage mechanism: Quota exceeded";}};k.get=function(a){a=this.g.getItem(a);if(!w(a)&&null!==a)throw"Storage mechanism: Invalid value was encountered";return a};k.remove=function(a){this.g.removeItem(a)};k.K=function(){return this.g.length};
k.oa=function(a){var b=0,c=this.g,d=new Pc;d.g=function(){if(b>=c.length)throw Oc;var d=c.key(b++);if(a)return d;d=c.getItem(d);if(!w(d))throw"Storage mechanism: Invalid value was encountered";return d};return d};k.clear=function(){this.g.clear()};k.key=function(a){return this.g.key(a)};function hf(){var a=null;try{a=window.localStorage||null}catch(b){}this.g=a}D(hf,gf);var jf=!yb||yb&&9<=Lb,kf=!zb&&!yb||yb&&yb&&9<=Lb||zb&&Jb("1.9.1");yb&&Jb("9");function lf(a,b){var c;c=a.className;c=w(c)&&c.match(/\S+/g)||[];for(var d=Za(arguments,1),e=c.length+d.length,f=c,g=0;g<d.length;g++)Ta(f,d[g])||f.push(d[g]);a.className=c.join(" ");return c.length==e};function mf(a){return a?new nf(9==a.nodeType?a:a.ownerDocument||a.document):pa||(pa=new nf)}function of(a,b){var c=b||document,d=null;c.querySelectorAll&&c.querySelector?d=c.querySelector("."+a):(c=b||document,d=(c.querySelectorAll&&c.querySelector?c.querySelectorAll("."+a):c.getElementsByClassName?c.getElementsByClassName(a):pf(document,"*",a,b))[0]);return d||null}
function pf(a,b,c,d){a=d||a;b=b&&"*"!=b?b.toUpperCase():"";if(a.querySelectorAll&&a.querySelector&&(b||c))return a.querySelectorAll(b+(c?"."+c:""));if(c&&a.getElementsByClassName){a=a.getElementsByClassName(c);if(b){d={};for(var e=0,f=0,g;g=a[f];f++)b==g.nodeName&&(d[e++]=g);d.length=e;return d}return a}a=a.getElementsByTagName(b||"*");if(c){d={};for(f=e=0;g=a[f];f++)b=g.className,"function"==typeof b.split&&Ta(b.split(/\s+/),c)&&(d[e++]=g);d.length=e;return d}return a}
function qf(a,b){Wb(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in rf?a.setAttribute(rf[d],b):qa(d,"aria-")||qa(d,"data-")?a.setAttribute(d,b):a[d]=b})}var rf={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function sf(a,b,c){function d(c){c&&b.appendChild(w(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!v(f)||z(f)&&0<f.nodeType?d(f):Ma(tf(f)?Xa(f):f,d)}}function tf(a){if(a&&"number"==typeof a.length){if(z(a))return"function"==typeof a.item||"string"==typeof a.item;if(fa(a))return"function"==typeof a.item}return!1}function nf(a){this.g=a||r.document||document}k=nf.prototype;
k.cd=function(a,b,c){var d=this.g,e=arguments,f=e[0],g=e[1];if(!jf&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',va(g.name),'"');if(g.type){f.push(' type="',va(g.type),'"');var h={};bc(h,g);delete h.type;g=h}f.push(">");f=f.join("")}f=d.createElement(f);g&&(w(g)?f.className=g:u(g)?lf.apply(null,[f].concat(g)):qf(f,g));2<e.length&&sf(d,f,e);return f};k.createElement=function(a){return this.g.createElement(a)};k.appendChild=function(a,b){a.appendChild(b)};
k.getChildren=function(a){return kf&&void 0!=a.children?a.children:Na(a.childNodes,function(a){return 1==a.nodeType})};k.contains=function(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};yb&&Jb(8);function uf(a){if(!z(a))return String(a);Ja("Soy template output is unsafe for use as HTML: "+a);return"zSoyz"}var vf=/^<(body|caption|col|colgroup|head|html|tr|td|tbody|thead|tfoot)>/i;function wf(a,b){null!=a&&this.Cc.apply(this,arguments)}k=wf.prototype;k.W="";k.set=function(a){this.W=""+a};k.Cc=function(a,b,c){this.W+=a;if(null!=b)for(var d=1;d<arguments.length;d++)this.W+=arguments[d];return this};k.clear=function(){this.W=""};k.toString=function(){return this.W};function xf(a,b,c){mb.call(this);this.h=a;this.m=b||0;this.j=c;this.l=B(this.k,this)}D(xf,mb);xf.prototype.g=0;xf.prototype.I=function(){xf.q.I.call(this);this.stop();delete this.h;delete this.j};function yf(a){a.stop();a.g=Td(a.l,t(void 0)?void 0:a.m)}xf.prototype.stop=function(){0!=this.g&&r.clearTimeout(this.g);this.g=0};function zf(a){a.stop();a.k()}xf.prototype.k=function(){this.g=0;this.h&&this.h.call(this.j)};function Af(a,b,c){mb.call(this);this.k=a;this.j=b;this.h=c;this.g=B(this.Gd,this)}D(Af,mb);k=Af.prototype;k.Yb=!1;k.cb=null;k.stop=function(){this.cb&&(r.clearTimeout(this.cb),this.cb=null,this.Yb=!1)};k.I=function(){Af.q.I.call(this);this.stop()};k.Gd=function(){this.cb=null;this.Yb&&(this.Yb=!1,Bf(this))};function Bf(a){a.cb=Td(a.g,a.j);a.k.call(a.h)};P("ydn");var Cf=Math.pow(2,3),Df=Math.pow(2,6);function Ef(){wc.call(this);this.key=this.g=void 0}D(Ef,wc);Ef.prototype.O=function(a,b){if("boolean"!=typeof b)throw Error("Invalid value");if("number"!=typeof a||0>a)throw Error("Invalid state");"undefined"==typeof this.g&&(this.g=0);this.g=b?this.g|a:this.g&~a};function Ff(a){a.O(Cf,!0);Td(function(){this.dispatchEvent(Gf)},0,a)}var Gf="a";function Hf(a,b,c){F.call(this,a,b);this.url=c}D(Hf,F);P("ydn");function If(a){return!w(a)||sa(a)?{}:JSON.parse(a)}function Jf(a){var b;try{b=Q(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""}function Q(a){return JSON.stringify(a,void 0,void 0)};P("ydn.Store");function Kf(a,b){if(b&&!a)throw Error("Can't create document with namespace and no root tag");if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(b||"",a||"",null);if("undefined"!=typeof ActiveXObject){var c=Lf();if(c)return a&&c.appendChild(c.createNode(1,a,b||"")),c}throw Error("Your browser does not support creating new documents");}
function Mf(a){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(a,"application/xml");if("undefined"!=typeof ActiveXObject){var b=Lf();b.loadXML(a);return b}throw Error("Your browser does not support loading xml documents");}function Nf(a){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(a);if(a=a.xml)return a;throw Error("Your browser does not support serializing XML documents");}
function Lf(){var a=new ActiveXObject("MSXML2.DOMDocument");if(a){a.resolveExternals=!1;a.validateOnParse=!1;try{a.setProperty("ProhibitDTD",!0),a.setProperty("MaxXMLSize",2048),a.setProperty("MaxElementDepth",256)}catch(b){}}return a};function Pf(a){Error.captureStackTrace?Error.captureStackTrace(this,Pf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"}D(Pf,Error);function Qf(a){Error.captureStackTrace?Error.captureStackTrace(this,Qf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotSupportedException"}D(Pf,Error);Qf.prototype.name="ydn.error.NotSupportedException";
function Rf(a){Error.captureStackTrace?Error.captureStackTrace(this,Rf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"}D(Rf,Error);function Sf(a){Error.captureStackTrace?Error.captureStackTrace(this,Sf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}D(Sf,Error);Sf.prototype.name="ydn.InternalError";
function Tf(a){Error.captureStackTrace?Error.captureStackTrace(this,Tf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"}D(Tf,Error);Tf.prototype.name="ydn.error.ConstraintError";function Uf(a){Error.captureStackTrace?Error.captureStackTrace(this,Uf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"}D(Pf,Error);
function Vf(a){Error.captureStackTrace?Error.captureStackTrace(this,Vf):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"}D(Vf,Error);function Wf(){Ef.call(this);this.h=null;jc(this,"user-login",this.md,!1,this);jc(this,"user-logout",this.md,!1,this);this.n=window.top.location.href.replace(/[?#]\S+/,"")}D(Wf,Ef);function Xf(a){var b=chrome.extension.getURL(Yf);a.n=b}k=Wf.prototype;k.i=P("ydn.api.AbstractUser");k.md=function(){this.display?(this.display.j(this.l||""),this.isLogin()?this.k&&this.display.h(this.k):this.j&&this.display.g(this.j),N(this.i,"Refreshed.")):N(this.i,"No UI refreshed.")};
k.toJSON=function(){return{nickname:this.m,email:this.l,is_login:this.h,login_url:this.j,logout_url:this.k,user_id:this.user_id}};k.isLogin=function(){return!0===this.h};k.toString=function(){return"User:"+(!0===this.h?this.l:!1===this.h?"logout":"?")};function Zf(a,b,c){Hf.call(this,a,b,c)}D(Zf,Hf);function $f(){Wf.call(this)}D($f,Wf);$f.prototype.i=P("ydn.api.User");
$f.prototype.load=function(a){L(this.i,"getting user info");if(a.logout_url)return this.m=a.nickname,this.l=a.email,this.user_id=a.user_id,this.h=a.is_login,this.k=a.logout_url,this.j=a.login_url,L(this.i,a.email+" login"),this.k=a.logout_url,this.user_id=a.Id?a.Id.$t:void 0,this.h=!0,this.j=void 0,this.O(Df,!0),Ff(this),!0;a.login_url&&(L(this.i,"NO user"),this.j=a.login_url,this.h=!1,this.l=this.user_id=this.k=this.m=void 0,this.O(Df,!0),Ff(this));return!1};
$f.prototype.u=function(a,b){N(this.i,"Receiving "+(b.Z()?"":"fail")+" login info from server.");if(b.Z()){var c=a.User;if(c){var d;d=this.load(c)?new Zf("user-login",this,this.k):new Zf("user-logout",this,this.j);Td(function(){this.dispatchEvent(d)},0,this)}}else K(this.i,"Server return error with: "+b.ba());this.o&&this.o.stop()};
function ag(a,b){var c=new E,d=bg(cg);if(!d)return kb("login server not available.");var e={pm:a.n,state:Math.random().toString().substr(2,6)};if(b)for(var f in b)e[f]=b[f];d.request(new dg("/rpc_login","GET",e)).execute(function(a,b){a?c.p(a.User):c.s(b)},a);return c}$f.prototype.Rb=function(){L(this.i,"Sending login request.");var a=bg(cg),b=window.top.location.href.replace(/[?#]\S+/,"");a.request(new dg("/rpc_login","GET",{url:b})).execute(B(this.u,this));return!1};function eg(){this.g=C()}var fg=new eg;eg.prototype.set=function(a){this.g=a};eg.prototype.get=function(){return this.g};function gg(a){this.k=a||"";this.l=fg}gg.prototype.g=!0;gg.prototype.h=!1;function hg(a){a=new Date(a.l);return ig(a.getFullYear()-2E3)+ig(a.getMonth()+1)+ig(a.getDate())+" "+ig(a.getHours())+":"+ig(a.getMinutes())+":"+ig(a.getSeconds())+"."+ig(Math.floor(a.getMilliseconds()/10))}function ig(a){return 10>a?"0"+a:String(a)}function jg(a,b){var c=(a.l-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d}function kg(a){gg.call(this,a)}D(kg,gg);kg.prototype.h=!0;
kg.prototype.j=function(a){var b;switch(a.k.value){case Cd.value:b="dbg-sh";break;case Dd.value:b="dbg-sev";break;case Ed.value:b="dbg-w";break;case Fd.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.k," ");this.g&&c.push("[",hg(a),"] ");c.push("[",Ca(jg(a,this.l.get())),"s] ");c.push("[",va(a.j),"] ");c.push('<span class="',b,'">',ua(Ca(va(a.getMessage()))));this.h&&a.h&&c.push("<br>",ua(Ca(a.g||"")));c.push("</span>");c.push("<br>");return c.join("")};
function lg(a){gg.call(this,a)}D(lg,gg);lg.prototype.j=function(a){var b=[];b.push(this.k," ");this.g&&b.push("[",hg(a),"] ");b.push("[",jg(a,this.l.get()),"s] ");b.push("[",a.j,"] ");b.push(a.getMessage());this.h&&a.h&&b.push("\n",a.g);b.push("\n");return b.join("")};function mg(){this.l=B(this.m,this);this.g=new lg;this.g.g=!1;this.h=this.g.h=!1;this.j="";this.k={}}mg.prototype.m=function(a){if(!this.k[a.j]){var b=this.g.j(a),c=ng;if(c)switch(a.k){case Cd:og(c,"info",b);break;case Dd:og(c,"error",b);break;case Ed:og(c,"warn",b);break;default:og(c,"debug",b)}else window.opera?window.opera.postError(b):this.j+=b}};var ng=window.console;function og(a,b,c){if(a[b])a[b](c);else a.log(c)};function pg(a){this.l=B(this.m,this);this.h=new kg;this.j=this.h.g=!1;this.g=a;this.k=this.g.ownerDocument||this.g.document;a=mf(this.g);var b=null,c=a.g;if(yb&&c.createStyleSheet)a=b=c.createStyleSheet(),yb&&t(a.cssText)?a.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":
a.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}";else{c=pf(a.g,"head",void 0,void 0)[0];c||(b=pf(a.g,"body",void 0,void 0)[0],c=a.cd("head"),b.parentNode.insertBefore(c,b));var d=b=a.cd("style");yb&&t(d.cssText)?d.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":
d.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}";a.appendChild(c,b)}this.g.className+=" logdiv"}
pg.prototype.m=function(a){var b=100>=this.g.scrollHeight-this.g.scrollTop-this.g.clientHeight,c=this.k.createElement("div");c.className="logmsg";c.innerHTML=this.h.j(a);this.g.appendChild(c);b&&(this.g.scrollTop=this.g.scrollHeight)};pg.prototype.clear=function(){this.g.innerHTML=""};var qg=null,rg=null;P("ydn.debug");function sg(a,b,c){if(x(b))b=new Bd("log",b);else if(w(b)){b=b.toUpperCase();if(!Ld){Ld={};for(var d=0,e;e=Kd[d];d++)Ld[e.value]=e,Ld[e.name]=e}b=Ld[b]||null}else b=Hd;P(a||"ydn").h=b;t(c)?rg||(a=rg=new pg(c),!0!=a.j&&(c=Qd(),b=a.l,c.g||(c.g=[]),c.g.push(b),a.j=!0),Qd().h=Ed):qg||rg||(a=qg=new mg,!0!=a.h&&(c=Qd(),b=a.l,c.g||(c.g=[]),c.g.push(b),a.h=!0),Qd().h=Ed)}var tg=null;function ug(a){tg&&setTimeout(function(){tg.log(a)},10)};var cg="login",vg=P("ydn.http"),wg={},xg=[];function yg(a){if(!t(a))return wg["default"];for(var b=a,c=0;c<xg.length;c++){var d=(0,xg[c])(a);if(d){b=d;break}}N(vg,"Resolving "+a+" to "+b);return wg[b]||null};var zg,Ag={},Bg=[];function Cg(a,b){Ag[b||"default"]=a}function bg(a){if(!t(a))return Ag["default"];for(var b=a,c=0;c<Bg.length;c++){var d=(0,Bg[c])(a);if(d){b=d;break}}return Ag[b]||null}function Dg(){zg||(zg=new Ge);return zg}function Eg(a,b,c,d){w(a)?this.bb=a:(this.bb=null,this.status=a,this.body=b,this.headers=c||{},this.g=d)}function Fg(a){if(a.bb){var b=If(a.bb);b.gapiRequest&&(b=b.gapiRequest.data);a.status=b.status;a.g=b.statusText;a.headers=b.headers;a.body=b.body;a.bb=null}}
Eg.prototype.C=function(){Fg(this);return this.status};Eg.prototype.Z=function(){Fg(this);return 200<=this.status&&400>this.status};Eg.prototype.ba=function(){Fg(this);return this.g||""};function Gg(a){Fg(a);return a.body}function Hg(a,b){Fg(a);return a.headers[b]}Eg.prototype.Za=function(){Fg(this);return this.headers};
function Ig(a){var b;Fg(a);"application/json"==Hg(a,"content-type")?b=!0:(b=a.body,b=w(b)&&!sa(b)?/^[\],:{}\s]*$/.test(b.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")):!1);return b&&w(a.body)?JSON.parse(a.body):a.body}function Jg(a){return a instanceof Eg?a:w(a)?new Eg(a):new Eg(a.status,a.body,a.headers,a.statusText)}
function dg(a,b,c,d,e){this.path=a;this.method=b?b.toUpperCase():"GET";this.params=c||{};this.headers=d||{};this.body=e}var Kg=null;function Lg(a,b,c,d){this.l=t(b)?b:Dg();this.k="sr"+Mg++;this.m=c||0;this.n=!!d;this.g=a}var Mg=0;
Lg.prototype.execute=function(a,b){var c=this.g,d=new Zc(c.path),e;for(e in c.params)d.g.set(e,c.params[e]);this.l.send(this.k,d.toString(),c.method,c.body,c.headers,void 0,function(d){d=d.target;for(var e=(d.D&&4==te(d)?d.D.getAllResponseHeaders():"").split("\n"),h={},l=0;l<e.length;l++){var m=e[l].indexOf(":");0<m&&(h[e[l].substr(0,m).toLowerCase()]=e[l].substr(m+1).trim())}e=l=ue(d);if(h["content-type"]&&/json/.test(h["content-type"]))if(z(l))e=l;else if(w(l))try{e=If(l)}catch(n){e=l}h=new Eg(d.C(),
l,h,d.ba());Kg&&!h.Z()&&Kg.log({"class":"ydn.gdata.Entry",method:"commit",context:"HTTP request",HttpRequestData:{path:c.path,uri:String(d.o),method:c.method,params:c.params,headers:c.headers,body:c.body},HttpRespondData:{status:h.C(),statusText:h.ba(),body:Gg(h),headers:h.Za()}});a&&(a.call(b,e,h),a=null)},this.m,void 0,this.n);this.l=null};Lg.prototype.toString=function(){return"HTTPRequest:"+this.k};function Ng(a,b,c){this.h=a;this.j=b;this.g=null;this.Jd=t(c)?c:!0}Ng.prototype.request=function(a){return new Og(a,this)};function Og(a,b){Lg.call(this,a,b.j);this.parent=b}D(Og,Lg);var Pg=new Eg(0,null,null,"No access token");
Og.prototype.execute=function(a,b){function c(){this.Jd?d.g.headers.Authorization="Bearer "+d.parent.g.access_token:d.g.params.access_token=d.parent.g.access_token}var d=this;d.parent.g&&d.parent.g.expires>C()?(c(),Og.q.execute.call(this,function(e,f){401==f.C()?Qg(d.parent.h).t(function(e){d.parent.g=e;c();Og.q.execute.call(d,a,b)},function(){d.parent.g=null;a.call(b,null,Pg)},d):a.call(b,e,f)},this)):Qg(this.parent.h).t(function(e){d.parent.g=e;c();Og.q.execute.call(this,a,b)},function(){d.parent.g=
null;a.call(b,null,Pg)},this)};var Yf=("chrome-extension://fmhdpfhfppingdiiefgnanjceieflpkj/"==chrome.extension.getURL("")?"crm-ex/":"")+"option-page.html";function Rg(){var a=new E;chrome.storage.sync.get("user-setting",function(b){a.p(b["user-setting"])});return a};function Sg(){}Sg.prototype.i=P("ydn.crm.Client");function Tg(a,b,c){this.client=a;this.g=b;this.h=c}Tg.prototype.request=function(a){a=this.g.call(this.h,a);return this.client.request(a)};function Ug(a,b,c){this.h=a;this.j=b;this.g=c}Ug.prototype.request=function(a){return this.h(a)?this.j.request(a):this.g.request(a)};function Vg(a,b){this.client=a;this.h=b;this.mb=NaN;this.j=[];this.g=!1}Vg.prototype.request=function(a){return new Wg(a,this)};function Wg(a,b){a.path=b.h+a.path;this.req=b.client.request(a);this.parent=b;this.j=null;this.h=void 0}D(Wg,Lg);
Wg.prototype.execute=function(a,b){if(this.parent.g)this.j=a,this.h=b,this.parent.j.push(this);else{this.parent.g=!0;var c=function(c,d){var g=Hg(d,"retry-after");g?(this.parent.mb=/[^0-9|\.]/.test(g)?(new Date(g)).getTime():1E3*parseFloat(g)+C(),r.console.info("Next retry "+this.parent.mb+", now "+C())):this.parent.mb=NaN;a&&a.call(b,c,d);this.parent.g=!1;if(g=this.parent.j.pop())g.execute(g.j,g.h),g.j=null,g.h=null},d=this.parent.mb-C();0<d?(r.console.info("Proxy will call after "+d+" ms"),Td(function(){this.parent.mb=
NaN;this.req.execute(c,this)},d,this)):this.req.execute(c,this)}};function Xg(a,b,c,d,e){this.l=t(a)?a:Dg();this.g=b;this.h=c;this.j=d||0;this.k=!!e}Xg.prototype.request=function(a){if(this.g){a.headers||(a.headers={});for(var b in this.g)a.headers[b]=this.g[b]}this.h&&(a.path=this.h+a.path);return new Lg(a,this.l,this.j,this.k)};function Yg(a,b,c){this.j=t(a)?a:Dg();this.g=b;this.h=c}Yg.prototype.request=function(a){if(this.g){a.headers||(a.headers={});for(var b in this.g)a.headers[b]=this.g[b]}this.h&&(a.path=this.h+a.path);return new Lg(a,this.j)};function R(a,b,c,d){this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d;fa(Object.freeze)&&Object.freeze(this)}R.prototype.lower=void 0;R.prototype.upper=void 0;R.prototype.toJSON=function(){return Zg(this)};function $g(a){return ah(a)}R.only=function(a){return new R(a,a,!1,!1)};R.bound=function(a,b,c,d){return new R(a,b,c,d)};R.upperBound=function(a,b){return new R(void 0,a,void 0,!!b)};R.lowerBound=function(a,b){return new R(a,void 0,!!b,void 0)};
function Zg(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}}function bh(a){if(null==a)return null;if(a instanceof R)return a;if(z(a))return new R(a.lower,a.upper,a.lowerOpen,a.upperOpen);throw new I("Invalid key range: "+a+" of type "+typeof a);}
function ah(a){return null!=a?null!=a.upper&&null!=a.lower?ch.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):null!=a.upper?ch.upperBound(a.upper,a.upperOpen):null!=a.lower?ch.lowerBound(a.lower,a.lowerOpen):null:null}function dh(a){if(a instanceof R)return"";if(null!=a){if(z(a)){for(var b in a)if(a.hasOwnProperty(b)&&!Ta(["lower","upper","lowerOpen","upperOpen"],b))return'invalid attribute "'+b+'" in key range object';return""}return"key range must be an object"}return""}
R.prototype.nc=function(a){var b=this.lower,c=this.upper,d=this.lowerOpen,e=this.upperOpen;null!=a.lower&&(null==this.lower||a.lower>=this.lower)&&(b=a.lower,d=a.lowerOpen||this.lowerOpen);null!=a.upper&&(null==this.upper||a.upper<=this.upper)&&(c=a.upper,e=a.upperOpen||this.upperOpen);return R.bound(b,c,d,e)};function eh(a){if(!a)return"";var b=a.lowerOpen?"(":"[";null!=a.lower&&(b+=a.lower+", ");null!=a.upper&&(b+=a.upper);return b+=a.upperOpen?")":"]"}
function fh(a,b,c,d,e){if(c)if(c.lowerOpen||c.upperOpen||null==c.lower||null==c.upper||0!==S(c.lower,c.upper)){if(null!=c.lower){var f=c.lowerOpen?" > ":" >= ";d.push(a+f+"?");e.push(gh(c.lower,b))}null!=c.upper&&(f=c.upperOpen?" < ":" <= ",d.push(a+f+"?"),e.push(gh(c.upper,b)))}else d.push(a+" = ?"),e.push(gh(c.lower,b))}var ch=r.IDBKeyRange||r.webkitIDBKeyRange||R;function hh(a,b){var c,d;2==arguments.length&&w(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=v(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],t(a));c++);return a}function ih(a,b,c){if(a)if(-1==b.indexOf("."))a[b]=c;else{b=b.split(".");for(var d=b.pop(),e;e=b.shift();)z(a[e])||(a[e]={}),a=a[e];a[d]=c}}var jh={};
function kh(a){a=[a];for(var b=new lh,c=0,d,e;void 0!==(e=a.pop());){0===c%4&&12<c+4&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=4,0<e.length){a.push(jh);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=1,b.write(c),mh(b,e);else if(e instanceof Date)c+=2,b.write(c),mh(b,e.valueOf());else if("string"===d){c+=3;b.write(c);c=b;for(d=0;d<e.length;d++){var f=e.charCodeAt(d);126>=f?c.write(f+1):16510>=f?(f-=127,c.write(128|f>>8,f&255)):c.write(192|f>>10,f>>
2|255,(f|3)<<6)}c.write(0)}else if(e===jh)b.write(0);else return"";c=0}return b.trim().toString()}function nh(a){for(var b=[],c=b,d=[],e,f,g=new oh(a);null!=g.read();)if(0===g.current)c=d.pop();else{if(null===g.current)break;do{e=g.current/4|0;a=g.current%4;for(var h=0;h<e;h++)f=[],c.push(f),d.push(c),c=f;if(0===a&&12<g.current+4)g.read();else break}while(1);1===a?c.push(ph(g)):2===a?c.push(new Date(ph(g))):3===a?c.push(qh(g)):0===a&&(c=d.pop())}return b[0]}
function mh(a,b){var c,d,e;c=b;var f=e=d=0;if(0!==c)if(isFinite(c)){0>c&&(d=1,c=-c);f=0;if(2.2250738585072014E-308<=c){for(e=c;1>e;)f--,e*=2;for(;2<=e;)f++,e/=2;e=f+1023}f=e?Math.floor(4503599627370496*(c/Math.pow(2,f)-1)):Math.floor(c/4.9E-324)}else e=2047,isNaN(c)?f=0x8000000000000:-Infinity===c&&(d=1);c=d;d=e;e=f;c&&(e=0xfffffffffffff-e,d=2047-d);a.write((c?0:128)|d>>4);a.write((d&15)<<4|0|e/281474976710656);e%=281474976710656;c=0|e/4294967296;a.write(c>>8,c&255);e%=4294967296;c=0|e/65536;a.write(c>>
8,c&255);c=e%65536;a.write(c>>8,c&255)}function ph(a){var b=a.read()|0,c=b>>7?!1:!0,d=c?-1:1,e=(b&127)<<4,b=a.read()|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(a.read()|0):a.read()|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d}
function qh(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=a.read();if(0===f||null==f)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")}function oh(a){this.current=null;this.g=a;this.h=this.g.length-1;this.index=-1}
oh.prototype.read=function(){return this.current=this.index<this.h?parseInt(this.g[++this.index]+this.g[++this.index],16):null};function lh(){this.g=[];this.h=void 0}lh.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.h=arguments[b].toString(16),this.g.push(2===this.h.length?this.h:this.h="0"+this.h)};lh.prototype.trim=function(){for(var a=this.g.length;"00"===this.g[--a];);this.g.length=++a;return this};lh.prototype.toString=function(){return this.g.length?this.g.join(""):""};
function rh(a,b){var c=kh(a),d=kh(b);return c>d?1:c==d?0:-1};function sh(a,b,c,d,e){if(!(b instanceof R))if(w(b)&&t(c)){var f,g,h,l;if("starts"==b||"^"==b)b:{b=c;if(u(b))c=Xa(b),c.push("\uffff");else if(w(b))c=b+"\uffff";else if(x(b))c=b+2.220460492503131E-16,b-=2.220460492503131E-16;else{b=R.only(b);break b}b=R.bound(b,c,!1,!0)}else{if("<"==b||"<="==b)f=c,h="<"==b;else if(">"==b||">="==b)g=c,l=">"==b;else if("="==b||"=="==b)f=g=c;else throw new I("invalid op: "+b);if("<"==d||"<="==d)f=e,h="<"==d;else if(">"==d||">="==d)g=e,l=">"==d;else if(t(d))throw new I("invalid op2: "+
d);b=R.bound(g,f,l,h)}}else b=bh(b);this.g=b;this.Ka=a}sh.prototype.Ka="";sh.prototype.nc=function(a){if(this.Ka!=a.Ka)return null;a=null!=this.g&&null!=a.g?this.g.nc(a.g):this.g||a.g;return new sh(this.Ka,a)};var th={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},uh=r.IDBRequest&&"LOADING"in r.IDBRequest?r.IDBTransaction:r.webkitIDBRequest&&"LOADING"in r.webkitIDBRequest&&1===r.webkitIDBTransaction.READ_WRITE?r.webkitIDBTransaction:th,vh=uh.READ_ONLY,T=uh.READ_WRITE,wh=uh.VERSION_CHANGE,xh=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.moz_indexedDB||r.msIndexedDB;function yh(a,b,c,d){mb.call(this);this.j=c;this.w=c.getName();this.ua=void 0;this.k=!1;this.J=null;this.m=a;this.lc=b;this.Ca=0;this.da=this.G=!1;this.ca=d||4;this.n=this.h=this.g=void 0;this.B=function(){throw new Bc;};this.H=function(){throw new Bc;};this.vb=function(){}}D(yh,mb);k=yh.prototype;
k.init=function(a,b,c,d,e){if(t(b)){a=this.j;var f,g=b;u(b)?(f=zh(a,b),g=b.join(", ")):f=Ah(a,b);if(!f)throw new I('require index "'+g+'" not found in store "'+a.getName()+'"');this.ua=f.getName()}this.k=w(this.ua);this.J=c||null;this.Ca=0;this.da=this.G=!1;this.reverse="prev"==d||"prevunique"==d;this.unique="nextunique"==d||"prevunique"==d;this.Aa=d;this.kb=e;this.n=this.h=this.g=void 0};k.Aa="";k.J=null;k.unique=!1;k.reverse=!1;k.kb=!0;k.i=P("ydn.db.core.req.AbstractCursor");
k.Oa=function(a,b,c){null==a&&(M(this.i,this+" finished."),this.G=!0);this.g=a;this.h=b;this.n=c;this.Ca++;this.G?(N(this.i,this+" DONE."),this.B(),Bh(this)):(N(this.i,this+" new cursor position {"+(this.k?this.g+", "+this.h:this.g)+"}"),this.B(this.g))};k.I=function(){this.m=null};k.toString=function(){return"Cursor:"+this.w+(t(this.ua)?":"+this.ua:"")+"["+(this.m?"":"~")+this.lc+"]"};function Bh(a){null!=a.h?a.h=Ch(a.h):a.h=void 0;null!=a.g?a.g=Ch(a.g):a.g=void 0;a.vb(a.da,a.g,a.h)}
function Dh(a){a.da=!0;N(a.i,a+": exit");Bh(a)}k.K=function(){return this.Ca};k.na=function(){return this.k?this.h:this.g};k.ic=function(){return this.kb?this.na():this.n};k.Db=function(){};function Eh(){};function Fh(a,b,c,d,e,f,g){if(!w(a))throw new TypeError("store name must be a string, but "+a+" found.");this.g=a;this.j=b;this.m=g;this.n=!!this.j;if(t(d)&&!ea(d))throw new I("reverse value must be a boolean, but "+typeof d+" found");if(t(e)&&!ea(e))throw new I("unique value must be a boolean, but "+typeof e+" found");if(t(f)&&!ea(f))throw new I("key_only value must be a boolean, but "+typeof f+" found");this.h=t(f)?f:!!w(this.j);a="next";d&&e?a="prevunique":d?a="prev":e&&(a="nextunique");this.l=
a;if(d=dh(c))throw new I("Invalid key range: "+d);this.k=ah(c);this.o=Gh;this.G=NaN}D(Fh,Eh);Fh.prototype.h=!0;function Hh(a,b,c,d,e){if(!w(b))throw new I("index name must be string");Fh.call(this,a,b,c,d,e,!0)}D(Hh,Fh);function Ih(a,b,c){if(3<arguments.length)throw new I("too many argument");Fh.call(this,a,void 0,b,c,void 0,!1)}D(Ih,Fh);function Jh(a,b,c,d,e){if(!w(b))throw new I("index name must be string");Fh.call(this,a,b,c,d,e,!1)}D(Jh,Fh);var Gh="init";k=Fh.prototype;k.i=P("ydn.db.Iterator");
k.T=function(){var a=new Fh(this.g,this.j,this.k,Kh(this),Lh(this),this.h,this.m);a.G=this.G;return a};k.unique=function(a){return new Fh(this.g,this.j,this.k,Kh(this),a,this.h,this.m)};k.toJSON=function(){return{store:this.g,index:this.j,keyRange:this.k?Zg(this.k):null,direction:this.l}};
k.toString=function(){var a=t(this.m)?":"+this.m.join(","):t(this.j)?":"+this.j:"",a=a+eh(this.k);this.o!=Gh&&(a+=this.o+"{"+this.u,this.n&&(a+=", "+this.B),a+="}");var b=this.n?"Index":"",b=b+(this.h?"Key":"Value");return b+"Iterator:"+this.g+a};k.reverse=function(){return new Fh(this.g,this.j,this.k,!Kh(this),Lh(this),this.h,this.m)};function Kh(a){return"prev"===a.l||"prevunique"===a.l}function Lh(a){return"nextunique"===a.l||"prevunique"===a.l}
k.load=function(a){a=a[0];a.init(this.g,this.m||this.j,this.k,this.l,this.h);this.o="busy";var b=this;a.vb=function(a,d,e){b.u=d;b.B=e;b.o=a?"rest":"done"};a.openCursor(this.u,this.B);return a};k.stores=function(){return[this.g]};function Mh(a,b,c){Cc.call(this,b,c);this.o=a;this.k=[];this.n=[];this.H=[];this.g=null;this.ma="";this.B=0}D(Mh,Cc);k=Mh.prototype;k.ma="";k.i=P("ydn.db.Request");function Nh(a,b,c){a.g=b;a.ma=c;M(a.i,a+" BEGIN");if(b){for(c=0;c<a.n.length;c++)a.n[c][0].call(a.n[c][1],b);a.n.length=0}M(a.i,a+" END")}function Oh(a){var b=new Mh(a.o);a.B++;Nh(b,a.g,a.ma+"C"+a.B);return b}k.zc=function(){return this.o};
k.abort=function(){if(this.g)if(M(this.i,this+" aborting"),fa(this.g.abort))this.g.abort();else if(fa(this.g.executeSql))this.g.executeSql("ABORT",[],function(){},function(){return!0});else throw new yc;else throw new Ph("No active transaction");};function U(a,b,c){var d=a.H.shift();c=!!c;d?d[0].call(d[1],b,c,function(b,c){U(a,b,c)}):c?a.s(b):a.p(b)}function Qh(a,b,c){a.H.push([b,c])}function V(a,b,c){a.g?b.call(c,a.g):a.n.push([b,c])}
k.p=function(a){M(this.i,this+" SUCCESS");Mh.q.p.call(this,a);this.g=null;this.ma=this.ma};k.s=function(a){M(this.i,this+" ERROR");Mh.q.s.call(this,a);this.g=null;this.ma=this.ma};function W(a){var b="";a.ma&&(b=a.g?"*":"",b="["+a.ma+b+"]");return a.o+b}function Rh(a,b){var c=new Mh(a);U(c,b);return c}k.toString=function(){return"Request:"+W(this)};
k.tc=function(){this.m&&this.qa&&ib(this)&&(r.clearTimeout(this.m),delete this.m);this.h&&(this.h.yb--,delete this.h);for(var a=this.j,b=!1;this.l.length&&!this.hb;){var c=this.l.shift(),d=c[0],e=c[1],c=c[2];if(d=this.Fa?e:d)d=d.call(c||this.u,a),t(d)&&(this.Fa=this.Fa&&(d==a||d instanceof Error),this.j=a=d),a instanceof E&&(this.hb=b=!0)}this.j=a;b&&(a.t(B(this.Eb,this,!0),B(this.Eb,this,!1)),a.Zc=!0)};
k.toJSON=function(){var a=(this.ma||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.o?this.o.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};var S=xh&&xh.cmp?B(xh.cmp,xh):rh,Sh=[];(function(a){if(null!=a&&!("push"in a))throw new Pf('output receiver object must have "push" method.');}).prototype.i=P("ydn.db.algo.AbstractSolver");function Th(a){Error.captureStackTrace?Error.captureStackTrace(this,Th):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ConstraintError"}D(Th,Error);Th.prototype.name="ConstraintError";Th.prototype.toString=function(){return this.name+": "+this.message};function Uh(a){Error.captureStackTrace?Error.captureStackTrace(this,Uh):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"}D(Uh,Error);
Uh.prototype.toString=function(){return this.name+": "+this.message};function Vh(a){Error.captureStackTrace?Error.captureStackTrace(this,Vh):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.VersionError"}D(Vh,Error);Vh.prototype.name="ydn.db.VersionError";Vh.prototype.toString=function(){return this.name+": "+this.message};function Wh(a){Error.captureStackTrace?Error.captureStackTrace(this,Wh):this.stack=Error().stack||"";a&&(this.message=String(a))}D(Wh,Error);
Wh.prototype.name="ydn.db.InternalError";function Ph(a){Error.captureStackTrace?Error.captureStackTrace(this,Ph):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"}D(Ph,Error);function Xh(a){Error.captureStackTrace?Error.captureStackTrace(this,Xh):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"}D(Xh,Error);
function Yh(a){Error.captureStackTrace?Error.captureStackTrace(this,Yh):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"}D(Yh,Error);Yh.prototype.name="NotFoundError";Yh.prototype.toString=function(){return this.name+": "+this.message};function Zh(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Zh):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"}D(Zh,Error);
Zh.prototype.toString=function(){return this.name+": "+this.message};function $h(a,b){Error.captureStackTrace?Error.captureStackTrace(this,$h):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"}D($h,Error);$h.prototype.toString=function(){return this.name+": "+this.message};function ai(a){Error.captureStackTrace?Error.captureStackTrace(this,ai):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.SqlParseError"}
D(ai,Error);function bi(a){Error.captureStackTrace?Error.captureStackTrace(this,bi):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"}D(bi,Error);function X(a,b,c){var d;if(z(a))d=a.store,b=a.id,null!=a.parent&&(c=new X(a.parent));else if(t(b))d=a;else if(d=a.lastIndexOf("^|"),b=a,0<d&&(b=a.substr(d),c=new X(a.substring(0,d))),b=b.split("^:"),d=b[0],b=b[1],!t(b))throw Error("Invalid key value: "+a);this.w=d;this.id=b;this.parent=c||null}X.prototype.toJSON=function(){var a={store:this.w,id:this.id};this.parent&&(a.parent=this.parent.toJSON());return a};
X.prototype.valueOf=function(){return(this.parent?this.parent.valueOf()+"^|":"")+this.w+"^:"+this.id};X.prototype.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};function ci(a){return u(a.id)?a.id.join("^|"):a.id instanceof Date?+a.id:a.id}X.prototype.getParent=function(){return this.parent};function Ch(a){if(v(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};function di(a,b){this.g=b}di.prototype.i=P("ydn.db.crud.req.RequestExecuto");di.prototype.toString=function(){return"RequestExecutor"};function ei(a,b,c,d,e,f){this.da=a;this.Ca=b;this.g=this.j=0;this.ia=d;this.N=e;this.l=c||fi;this.G=f||0;this.o=!1;this.u=0}k=ei.prototype;k.i=P("ydn.db.tr.Thread");k.Ed=function(a){if("complete"==a||"abort"==a)this.o?(N(this.i,"tx "+this.j+" committed"),this.o=!1):(N(this.i,"Generator done "+this.o),U(null,this.j,"complete"!=a))};
k.Xa=function(){if(t(this.B))if(this.B)N(this.i,"Receive to commit tx "+this.j+" on yield "+this.u),this.o=!0;else throw new Ac("Coroutine transaction thread has been ended");else throw new Ac("Transaction thread not running in a generator");};function gi(a,b){a.o?(N(a.i,"waiting tx to be committed for yielding "+a.u),setTimeout(function(){a.Ha(function(){N(a.i,"sending result to yield "+a.u);a.B.next(b)},a.ia,a.N,B(a.Ed,a))},4)):(N(a.i,"sending result to yield "+a.u),a.B.next(b));a.u++}
k.request=function(a){a=new Mh(a);this.B&&a.t(function(a){gi(this,a)},function(a){var c=a;a instanceof Error||(c=Error(),c.error=a);gi(this,c)},this);return a};k.type=function(){return ii(this.da)};k.A=function(){return this.da};k.$=function(){return"B"+this.Ca+"T"+this.j};var fi="single";function ji(a){if(a)if(fa(a.abort))a.abort();else if(fa(a.executeSql))a.executeSql("ABORT",[],null,function(){return!0});else throw new yc;else throw new Ph("No active transaction");};function ki(a){this.j=a;this.g=null;this.h=0}ki.prototype.i=P("ydn.db.tr.Mutex");ki.prototype.ja=null;function li(a){return!!a.g&&!a.k}ki.prototype.ga=null;ki.prototype.toString=function(){return"Mutex:"+("B"+this.j+"T"+this.h)+(this.g?"*":"")};function mi(a,b,c,d,e,f){ei.call(this,a,b,c,d,e,f);this.k=[];this.m=[];this.n=null;this.h=new ki(b);this.H=f||0;this.ca=!1}D(mi,ei);k=mi.prototype;k.i=P("ydn.db.tr.Serial");
function ni(a,b,c){if("multi"==a.l)a:if(a=a.h,!a.ja||!a.mode||c!=a.mode&&(a.mode!=T||c!=vh)||b.length>a.ja.length)b=!1;else{for(c=0;c<b.length;c++)if(-1==a.ja.indexOf(b[c])){b=!1;break a}b=!0}else if("repeat"==a.l)a:if(a=a.h,a.ja&&a.mode&&c==a.mode&&a.ja.length==b.length){for(c=0;c<b.length;c++)if(-1==a.ja.indexOf(b[c])){b=!1;break a}b=!0}else b=!1;else b="all"==a.l?!0:!1;return b}
function oi(a){var b=0<a.k.length?a.k[0].ja:null,c=0<a.k.length?a.k[0].mode:null;return null!=b&&null!=c?ni(a,b,c):!1}function pi(a,b,c,d,e){N(a.i,"push tx queue["+a.k.length+"]");a.k.push({Hb:b,ja:c,mode:d,ga:e})}k.abort=function(){M(this.i,this+": aborting");ji(this.n)};
k.Ha=function(a,b,c,d){var e=w(b)?[b]:b;if(v(e)){if(0==e.length)throw new I("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!w(e[f]))throw new I("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.ub&&!Ta(this.ub,e[f]))throw new I('store name "'+f+e[f]+'" in scope of '+this);}}else throw new I("store names must be an array");var g=t(c)?c:vh,h=this;if(this.h.g||!qi(this.A())&&this.ca)pi(this,a,b,g,d);else{var l=this.$();d&&this.m.push(d);if(this.H&&
this.j>=this.H)throw new Ac("Exceed maximum number of transactions of "+this.H);this.ca=!0;ri(this.A(),function(c){var d=h.h;d.g=c;d.k=!1;d.ja=b;d.mode=g;d.h++;d.ga=null;l=h.$();L(h.i,l+" BEGIN "+Q(b)+" "+g);a(h);for(a=null;oi(h);)c=h.k.shift(),c.ga&&h.m.push(c.ga),N(h.i,"pop tx queue"+(h.k.length+1)+" reusing T"+h.j),c.Hb()},e,g,function(a,b){L(h.i,l+" "+a);var c=h.h;c.g?(c.g=null,c.ja=null,c.mode=null,fa(c.ga)&&c.ga(a,b),c.ga=null):K(c.i,c+" has no TX to be unlocked for "+a);for(c=0;c<h.m.length;c++)(0,h.m[c])(a,
b);h.m.length=0;(c=h.k.shift())&&h.Ha(c.Hb,c.ja,c.mode,c.ga);h.g=0})}};k.$=function(){var a=this.h;return"B"+a.j+"T"+a.h};k.request=function(a,b,c,d){var e=mi.q.request.call(this,a,b,c,d);a=c||vh;var f=this;li(this.h)&&ni(this,b,a)?(b=this.h.g,this.g++,Nh(e,b,this.$()+"R"+this.g),d&&this.m.push(d)):f.Ha(function(){var a=f.h.g;f.g++;Nh(e,a,f.$()+"R"+f.g)},b,a,d);return e};
k.Ua=function(a,b,c,d,e){d=d||vh;var f=this,g;if(li(f.h)&&ni(this,c,d)){var h=f.h.g;f.g++;g=f.$()+"R"+f.g;M(f.i,g+" BEGIN");b(h,g,function(b,c){f.n=h;c?(M(f.i,g+" ERROR"),a.s(b)):(M(f.i,g+" SUCCESS"),a.p(b));f.n=null});M(f.i,g+" END");b=null}else f.Ha(function(){var c=f.h.g;f.g++;g=f.$()+"R"+f.g;M(f.i,g+" BEGIN");b(c,g,function(b,d){f.n=c;d?(M(f.i,g+" ERROR"),a.s(b)):(M(f.i,g+" SUCCESS"),a.p(b));f.n=null});M(f.i,g+" END");b=null},c,d,e)};k.getName=function(){return this.A().getName()};
k.toString=function(){return"Serial:"+this.$()+(this.n?"*":"")};function si(a,b){mi.call(this,a,b)}D(si,mi);si.prototype.i=P("ydn.db.tr.AtomicSerial");si.prototype.request=function(a,b,c){var d,e,f,g=si.q.request.call(this,a,b,c,function(a,b){g.g=null;if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new bi;U(g,c,!0)}});Qh(g,function(a,b,c){f=b;e=a;d=c});return g};
si.prototype.Ua=function(a,b,c,d,e){var f,g,h=new E;h.t(function(a){g=!1;f=a},function(a){g=!0;f=a});si.q.Ua.call(this,h,b,c,d,function(b,c){if("complete"!=b)a.s(c);else if(!0===g)a.s(f);else if(!1===g)a.p(f);else{var d=new bi;a.s(d)}e&&(e(b,c),e=void 0)})};si.prototype.toString=function(){return"Atomic"+si.q.toString.call(this)};function ti(a,b,c,d){this.k=a;this.h=b;this.g=c;this.ka=d;this.j=null}k=ti.prototype;k.i=P("ydn.db.tr.DbOperator");k.abort=function(){this.g.abort()};function Y(a){a.j||(a.j=a.k.u());return a.j}k.A=function(){return this.k};k.Xa=function(){this.g.Xa()};
function ui(a,b){var c=a.A(),d=b instanceof vi?b:wi(b),e=b.name,f=Z(c.h,e);if(0==xi(d,f).length)jb(!1);else if(f=f?"update":"add",c.h instanceof yi)zi(c.h,d),c.j?(c.j.ec(),c.j=null,Ai(c)):jb(!1);else throw new Tf("Cannot "+f+" store: "+e+". Not auto schema generation mode.");}k.toString=function(){return"TxStorage:"+this.A().getName()};function Bi(a,b,c,d){ti.call(this,a,b,c,d)}D(Bi,ti);k=Bi.prototype;k.i=P("ydn.db.crud.DbOperator");
k.count=function(a,b,c,d){var e,f,g,h;if(null!=a)if(u(a)){if(t(c)||t(b))throw new I("too many arguments.");f=a;for(var l=0;l<f.length;l++)if(!Ci(this.h,f[l]))throw new I('store name "'+f[l]+'" at '+l+" not found.");M(this.i,"countStores: "+Q(f));e=this.g.request("count",f);V(e,function(){Y(this).Fb(e,f)},this)}else if(w(a)){l=Z(this.h,a);if(!l)throw new I('store name "'+a+'" not found.');if(t(d)&&!ea(d))throw new I('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(w(b))if(g=
b,z(c)){var m=dh(c);if(m)throw new I("invalid key range: "+Jf(c)+" "+m);h=ah(c)}else{if(null!=c)throw new I("invalid key range: "+Jf(c)+" of type "+typeof c);h=null}else if(z(b)||null==b)if(z(b)){if(m=dh(b))throw new I("invalid key range: "+Jf(b)+" "+m);h=ah(b)}else{if(null!=b)throw new I("key range must be  an object but found "+Jf(b)+" of type "+typeof b);h=null}else throw new I('invalid second argument for count "'+Jf(c)+'" of type '+typeof b);M(this.i,"countKeyRange: "+a+" "+(g?g:"")+Q(h));e=
this.g.request("count",f);Di(l,e,arguments);V(e,function(){Y(this).ib(e,f[0],h,g,!!d)},this)}else throw new I("Invalid store name or store names.");else K(this.i,"count method requires store name(s)"),l=Ei(this.h),e=this.g.request("count",l),Qh(e,function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),V(e,function(){Y(this).Fb(e,f)},this);return e};
k.get=function(a,b){var c=this,d;if(a instanceof X){var e=a,f=e.w,g=Z(this.h,f);if(!g){if(this.h.g()){if(qi(this.A()))return Rh("get",void 0);d=new Mh("get");this.A().ab(function(){c.get(a,b).t(function(a){d.p(a)},function(a){d.s(a)})});return d}throw new I("Store: "+f+" not found.");}var h=e.id;M(this.i,"getByKey: "+f+":"+h);d=this.g.request("get:key",[f]);Di(g,d,arguments,void 0,this);V(d,function(){Y(this).Ib(d,f,h)},this)}else if(w(a)&&t(b)){var l=a,g=Z(this.h,l);if(!g){if(this.h.g()){if(qi(this.A()))return Rh("get",
void 0);d=new Mh("get");this.A().ab(function(){c.get(a,b).t(function(a){d.p(a)},function(a){d.s(a)})});return d}throw new I('Store name "'+l+'" not found.');}var m=b;M(this.i,"getById: "+l+":"+m);d=this.g.request("get",[l]);Di(g,d,arguments,void 0,this);V(d,function(){Y(this).Ib(d,l,m)},this)}else throw new I("get require valid input arguments.");return d};
k.keys=function(a,b,c,d,e,f,g){var h,l,m=null,n=!1,p=!1,q=a,s=Z(this.h,q);if(!w(q))throw new I("store name must be a string, but "+q+" of type "+typeof q+" is not.");if(!this.h.g()){if(!s)throw new I('store name "'+q+'" not found.');if(w(b)&&!Ah(s,b))throw new I('index "'+b+'" not found in store "'+q+'".');}if(this.h.g()&&!s)return Rh("keys",[]);var y;if(w(b)){var A=b,G=dh(c);if(G)throw new I("invalid key range: "+c+" "+G);m=ah(c);if(x(d))h=d;else{if(t(d))throw new I("limit must be a number");h=100}if(x(e))l=
e;else{if(t(e))throw new I("offset must be a number");l=0}if(t(f))if(ea(f))n=f;else throw new I("reverse must be a boolean");if(t(g))if(ea(g))p=g;else throw new I("unique must be a boolean");M(this.i,"keysByIndexKeyRange: "+q);y=this.g.request("keys:iter:index",[q]);Di(s,y,arguments);V(y,function(){Y(this).list(y,2,q,A,m,h,l,n,p)},this)}else{if(z(b)){if(G=dh(b))throw new I("invalid key range: "+Jf(b)+" "+G);m=ah(b)}else{if(null!=b)throw new I("invalid key range: "+Jf(b)+" of type "+typeof b);m=null}if(x(c))h=
c;else{if(t(c))throw new I("limit must be a number");h=100}if(x(d))l=d;else{if(t(d))throw new I("offset must be a number");l=0}if(t(e))if(ea(e))n=e;else throw new I("reverse must be a boolean");M(this.i,"keysByKeyRange: "+q);y=this.g.request("keys",[q]);Di(s,y,arguments);V(y,function(){Y(this).list(y,2,q,null,m,h,l,n,!1)},this)}return y};
k.values=function(a,b,c,d,e,f,g){var h=this,l,m,n,p=!1,q=!1;if(w(a)){var s=a,y=Z(this.h,s);if(!y){if(this.h.g()){if(qi(this.A()))return Rh("values",[]);l=new Mh("values");this.A().ab(function(){h.values(a,b,c,d,e,f).t(function(a){l.p(a)},function(a){l.s(a)})});return l}throw new Yh(s);}if(u(b)){if(t(c)||t(d))throw new I("too many input arguments");var A=b;M(this.i,"listByIds: "+s+" "+A.length+" ids");l=this.g.request("values:array",[s]);Di(y,l,arguments,void 0,this);V(l,function(){Y(this).Hc(l,s,
A)},this)}else if(w(b)){var G=b;if(!Fi(y,G))throw new I('index "'+G+'" not found in store "'+s+'"');var H=dh(c);if(H)throw new I("invalid key range: "+c+" "+H);var J=ah(c);if(t(d))if(x(d))m=d;else throw new I("limit must be a number.");else m=100;if(t(e))if(x(e))n=e;else throw new I("offset must be a number.");else n=0;if(ea(f))p=f;else if(t(f))throw new I("reverse must be a boolean, but "+f);if(t(g))if(ea(g))q=g;else throw new I("unique must be a boolean");M(this.i,"listByIndexKeyRange: "+s+":"+
G);l=this.g.request("values:iter:index",[s]);Di(y,l,arguments);V(l,function(){Y(this).list(l,4,s,G,J,m,n,p,q)},this)}else{J=null;if(z(b)){if(H=dh(b))throw new I("invalid key range: "+b+" "+H);J=ah(b)}else if(null!=b)throw new I('expect key range object, but found "'+Jf(b)+'" of type '+typeof b);if(t(c))if(x(c))m=c;else throw new I("limit must be a number, but "+c+" is "+typeof c);else m=100;if(t(d))if(x(d))n=d;else throw new I("offset must be a number, but "+d+" is "+typeof d);else n=0;if(t(e))if(ea(e))p=
e;else throw new I("reverse must be a boolean, but "+e+" is "+typeof e);M(this.i,(J?"listByKeyRange: ":"listByStore: ")+s);l=this.g.request("values",[s]);Di(y,l,arguments);V(l,function(){Y(this).list(l,4,s,null,J,m,n,p,!1)},this)}}else if(u(a))if(a[0]instanceof X){for(var y=[],O=a,H=0;H<O.length;H++){var ga=O[H].w;if(!Ci(this.h,ga)){if(this.h.g())return y=[],y[O.length-1]=void 0,Rh("get",y);throw new I("Store: "+ga+" not found.");}Ta(y,ga)||y.push(ga)}M(this.i,"listByKeys: "+Q(y)+" "+O.length+" keys");
l=this.g.request("values:keys",y);V(l,function(){Y(this).Pb(l,O)},this)}else throw new I("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found.");else throw new I("first argument "+a+" is invalid.");return l};
k.list=function(a,b,c,d,e,f,g,h,l){var m=Z(this.h,b);if(!m){if(this.h.g())return Rh("get",[]);throw new Yh(b);}var n;if(c&&!Fi(m,c))throw new I('index "'+c+'" not found in store "'+b+'"');if(m=dh(d))throw new I("invalid key range: "+d+" "+m);var p=ah(d),q=100;if(x(e))q=e;else if(null!=e)throw new I('limit must be a number but "'+e+'" of type '+typeof e+" found.");var s=0;if(x(f))s=f;else if(null!=f)throw new I('offset must be a number but "'+f+'" of type '+typeof f+" found.");var y=!1;if(ea(g))y=
g;else if(null!=g)throw new I('reverse must be a boolean but "'+g+'" of type '+typeof g+" found.");var A=!1;if(ea(h))A=h;else if(null!=h)throw new I('unique must be a boolean but "'+h+'" of type '+typeof h+" found.");if(s&&l&&t(l[0]))throw new I("offset must not given when initial cursor position is defined");M(this.i,a+": "+b+":"+c);n=this.g.request("values:iter:index",[b]);V(n,function(){Y(this).list(n,a,b,c||null,p,q,s,y,A,l)},this);return n};
k.add=function(a,b,c){var d=w(a)?a:z(a)?a.name:void 0;if(!w(d))throw new I("store name "+d+" must be a string, but "+typeof d);var e=Z(this.h,d);if(!e){if(!this.h.g())throw new I('store name "'+d+'" not found.');e=wi(z(a)?a:{name:d});M(this.i,"Adding object store: "+d);ui(this,e)}else if(this.h.g()&&z(a)&&(a=wi(a),a=xi(e,a)))throw new yc(a);var f;if(!e)throw new I('store name "'+d+'" not found.');if(w(e.keyPath)&&t(c))throw new I("key must not be provided while the store uses in-line key.");if(!e.keyPath&&
!e.h&&!t(c))throw new I("out-of-line key must be provided.");if(u(b)){M(this.i,"addObjects: "+d+" "+b.length+" objects");for(a=0;a<b.length;a++)Gi(e,b[a]);f=this.g.request("add:array",[d],T);V(f,function(){Y(this).la(f,!1,!1,d,b,c)},this);e.Ia&&f.F(function(a){a=new Hi(Ii,this.A(),e.getName(),a,b);this.A().fa(a)},this)}else if(z(b))a="store: "+d+" key: "+Ji(e,b,c),M(this.i,"addObject: "+a),Gi(e,b),f=this.g.request("add",[d],T),V(f,function(){Y(this).la(f,!1,!0,d,[b],[c])},this),e.Ia&&f.F(function(a){a=
new Ki(Ii,this.A(),e.getName(),a,b);this.A().fa(a)},this);else throw new I("record must be an object or array list of objects, but "+b+" of type "+typeof b+" found.");return f};function Li(a,b){var c=w(b)?b:z(b)?b.name:void 0;if(!w(c))throw new I("store name must be a string");var d=Z(a.h,c);if(!d){if(!a.h.g())throw new Yh(c);d=wi(z(b)?b:{name:c});M(a.i,"Adding object store: "+c);ui(a,d)}else if(a.h.g()&&z(b)){var e=wi(b);if(e=xi(d,e))throw new yc(e);}if(!d)throw new Yh(c);return d}
k.load=function(a,b,c){var d=c||",",e=Li(this,a).getName();a=this.g.request("load",[e]);var f=this;this.g.Ua(a,function(a,c,l){Y(f).Lc(a,c,l,e,b,d)},[e],T);return a};k.search=function(a){var b=a.g();N(this.i,"query "+a);a=this.g.request("search",b,vh);V(a,function(){Y(this)},this);return a};
k.put=function(a,b,c){var d,e=this;if(a instanceof X){var f=a,g=f.w,h=Z(this.h,g);if(!h)throw new I('store "'+g+'" not found.');if(h.keyPath){var l=Ji(h,b);if(null!=l){if(0!=S(l,f.id))throw new I("Inline key must be "+f+" but "+l+" found.");}else Mi(h,b,f.id);return this.put(g,b)}return this.put(g,b,f.id)}if(u(a)){if(t(c))throw new I("too many arguments");var m=a;if(!t(b))throw new I("record values required");for(var n=b,f=[],g=0,h=m.length;g<h;g++){l=m[g].w;-1==La(f,l)&&f.push(l);var p=Z(this.h,
l);if(!p)throw new I('store "'+l+'" not found.');p.keyPath&&Mi(p,n[g],m[g].id)}M(this.i,"putByKeys: to "+Q(f)+" "+n.length+" objects");for(g=0;g<n.length;g++)Gi(p,n[g]);d=this.g.request("put:keys",f,T);Di(p,d,arguments);V(d,function(){Y(e).Tb(d,n,m)},this)}else if(w(a)||z(a)){var p=Li(this,a),q=p.getName();if(p.keyPath&&t(c))throw new I("key must not be provided while the store uses in-line key.");if(!p.keyPath&&!p.h&&!t(c))throw new I("out-of-line key must be provided.");if(u(b)){var s=b,y=c;M(this.i,
"putObjects: "+q+" "+s.length+" objects");for(g=0;g<s.length;g++)Gi(p,s[g]);d=this.g.request("put:array",[q],T);Di(p,d,arguments);V(d,function(){Y(this).la(d,!0,!1,q,s,y)},this);p.Ia&&d.F(function(a){a=new Hi(Ni,this.A(),q,a,s);this.A().fa(a)},this)}else if(z(b)){var A=b,G=c;M(this.i,"putObject: "+q+" "+G);if(t(r.Blob)&&A instanceof Blob&&p.Ta&&!p.keyPath&&0==p.indexes.length&&Ab)d=new Mh("put"),f=new FileReader,f.onload=function(a){var b=a.target.result,c=e.g.request("put",[q],T);Di(p,c,[q,A,G]);
V(c,function(){Y(e).la(c,!0,!0,q,[b],[G])},this);c.t(function(a){d.p(a)},function(a){d.s(a)})},f.onerror=function(a){d.s(a)},f.onabort=function(a){d.s(a)},f.readAsDataURL(A);else{Gi(p,A);d=this.g.request("put",[q],T);var H=[q,A,G];Di(p,d,H);V(d,function(){var a=t(G)?[H[2]]:void 0;Y(e).la(d,!0,!0,q,[H[1]],a)},this)}p.Ia&&d.F(function(a){a=new Ki(Ni,this.A(),q,a,A);this.A().fa(a)},this)}else throw new I("put record value must be Object or array of Objects");}else throw new I("the first argument of put must be store name, store schema or array of keys.");
return d};
function Oi(a,b,c,d){var e=a.ka,f,g;if(w(b)){var h=Z(a.h,b);if(h){if(!h.keyPath&&!h.h&&null==d)throw new I('key required for store "'+b+'"');}else throw new Yh(b);for(var l=0;l<c.length;l++)Gi(h,c[l]);f=[b]}else{g=b;f=[];for(var l=0,m=g.length;l<m;l++){var n=g[l].w,h=Z(a.h,n);-1==La(f,n)&&f.push(n);if(!h)throw new Yh(n);Gi(h,c[l])}}var p;w(b)?(h=Z(a.h,b),p=e.request("put:array",f,T),V(p,function(){Y(this).la(p,!0,!1,b,c,d)},a)):(p=e.request("put:keys",f,T),V(p,function(){Y(this).Tb(p,c,g)},a));return p}
function Pi(a,b){for(var c=[],d=0,e=b.length;d<e;d++){var f=b[d].w;-1==La(c,f)&&c.push(f);if(!Ci(a.h,f))throw new Yh(f);}var g=a.ka.request("rm:keys",c,T);V(g,function(){Y(this).Xb(g,b)},a);return g}
function Qi(a,b,c,d,e,f,g){f=f||100;var h,l=g||0;if(g=Z(a.h,b)){if(c&&!Fi(g,c))throw new Yh('index "'+c+'" in store "'+b+'"');}else throw new Yh(b);var m=ah(d);w(c)?(h=a.ka.request("values:iter:index",[b]),V(h,function(){Y(this).list(h,4,b,c,m,f,l,e,!1)},a)):(h=a.ka.request("values",[b]),V(h,function(){Y(this).list(h,4,b,null,m,f,l,e,!1)},a));return h}
function Ri(a,b){var c=[],d=b.length;if(0==d)return Rh("keys",[]);for(var e=0;e<d;e++){var f=b[e].w;-1==La(c,f)&&c.push(f);if(!Ci(a.h,f))throw new Yh(f);}var g=a.ka.request("keys",c);V(g,function(){Y(a).Pb(g,b)},a);return g}
function Si(a,b,c,d,e,f,g,h){var l;e=e||100;var m=Z(a.h,b);if(m){if(c&&!Fi(m,c))throw new Yh('index "'+c+'" in store "'+b+'"');}else throw new Yh(b);w(c)?(l=a.ka.request("keys:iter:index",[b]),V(l,function(){Y(this).list(l,2,b,c,d,e,f,g,h)},a)):(l=a.ka.request("keys",[b]),V(l,function(){Y(this).list(l,2,b,null,d,e,f,g,h)},a));return l}
k.clear=function(a,b,c){if(t(c))throw new I("too many input arguments");var d;if(w(a)){c=Z(this.h,a);if(!c)throw new I('store name "'+a+'" not found.');if(z(b)){var e=ah(b);if(null===e)throw new I("clear method requires a valid non-null KeyRange object.");M(this.i,"clearByKeyRange: "+a+":"+Q(e));d=this.g.request("clear",[a],T);Di(c,d,[a,e]);V(d,function(){Y(this).oc(d,a,e)},this)}else{if(t(b))throw new I("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+
typeof b);M(this.i,"clearByStore: "+a);d=this.g.request("clear",[a],T);V(d,function(){Y(this).Bb(d,[a])},this)}}else if(!t(a)||u(a)&&w(a[0])){var f=a||Ei(this.h);M(this.i,"clearByStores: "+Q(f));d=this.g.request("clear",f,T);V(d,function(){Y(this).Bb(d,f)},this)}else throw new I('first argument "'+a+'" is invalid.');return d};
k.remove=function(a,b,c){var d;if(w(a)){var e=Z(this.h,a);if(!e)throw new I('store name "'+a+'" not found.');if(t(c))if(w(b)){var f=Ah(e,b);if(!f)throw new I("index: "+b+" not found in "+a);if(z(c)||null===c){var g=ah(c);M(this.i,"removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.g.request("rm:iter:index",[a],T);V(d,function(){Y(this).Mc(d,a,f.getName(),g)},this)}else throw new I("key range "+c+' is invalid type "'+typeof c+'".');}else throw new I('index name "'+b+'" must be a string, but '+
typeof b+" found.");else if(w(b)||x(b)||v(b)||b instanceof Date){M(this.i,"removeById: "+a+":"+b);d=this.g.request("rm",[a],T);var h=[a,b];Di(e,d,h);V(d,function(){Y(this).Vb(d,a,h[1])},this);e.Ia&&d.F(function(b){b=new Ki(Ti,this.A(),a,b,void 0);this.A().fa(b)},this)}else if(z(b))g=ah(b),M(this.i,"removeByKeyRange: "+a+":"+Q(g)),d=this.g.request("rm:iter",[a],T),Di(e,d,[a,g]),V(d,function(){Y(this).Wb(d,a,g)},this),e.Ia&&d.F(function(b){b=new Hi(Ti,this.A(),a,b,void 0);this.A().fa(b)},this);else throw new I('Invalid key or key range "'+
b+'" of type '+typeof b);}else if(a instanceof X){var l=a.w,e=Z(this.h,l);d=this.g.request("rm",[l],T);var m=[l,a.id];Di(e,d,m);V(d,function(){Y(this).Vb(d,l,m[1])},this)}else if(u(a)){b=[];c=0;for(e=a.length;c<e;c++){if(!(a[c]instanceof X))throw new I("key list element at "+c+" of "+e+' must be yn.db.Key, but "'+Jf(a[c])+'" ('+da(a[c])+") is not ydn.db.Key.");var n=a[c].w;-1==La(b,n)&&b.push(n)}if(1>b.length)throw new I('at least one valid key required in key list "'+Jf(a)+'"');d=this.g.request("rm:keys",
b,T);V(d,function(){Y(this).Xb(d,a)},this)}else throw new I('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+Jf(a)+'" ('+da(a)+") found.");return d};k.toString=function(){return"DbOperator:"+this.A().getName()};function Ui(a,b,c,d){ti.call(this,a,b,c,d)}D(Ui,Bi);k=Ui.prototype;k.i=P("ydn.db.core.DbOperator");k.get=function(a,b){if(a instanceof Fh){var c=a.g,d=Z(this.h,c);if(!d)throw new I('store "'+c+'" not found.');var e=a.j;if(t(e)&&!Fi(d,e))throw new I('index "'+e+'" not found in store "'+c+'".');M(this.i,"getByIterator:"+a);var f=this.g.request("get:iter",[c]);V(f,function(){Vi(this,5,f,a,1)},this);return f}return Ui.q.get.call(this,a,b)};
k.keys=function(a,b,c,d,e,f,g){if(a instanceof Fh){var h=100;if(x(b)){if(h=b,1>h)throw new I("limit must be a positive value, but "+b);}else if(t(b))throw new I("limit must be a number,  but "+b);if(t(c))throw new I("offset must not be specified");M(this.i,"keysByIterator:"+a);var l=this.g.request("keys:iter",[a.g]);V(l,function(){a.n?Vi(this,1,l,a,h):Vi(this,2,l,a,h)},this);return l}return Ui.q.keys.call(this,a,b,c,d,e,f,g)};
k.count=function(a,b,c,d){if(a instanceof Fh){if(t(b)||t(c))throw new I("too many arguments.");M(this.i,"countIterator:"+a);var e=this.g.request("count",[a.g]);V(e,function(){Vi(this,6,e,a)},this);return e}return Ui.q.count.call(this,a,b,c,d)};
k.values=function(a,b,c,d,e,f){if(a instanceof Fh){var g;if(x(b)){if(g=b,1>g)throw new I("limit must be a positive value, but "+g);}else if(t(b))throw new I("limit must be a number, but "+b);if(t(c))throw new I("offset must not be specified");M(this.i,"listByIterator:"+a);var h=this.g.request("values:iter",[a.g]);V(h,function(){a.h?Vi(this,2,h,a,g):Vi(this,4,h,a,g)},this);return h}return Ui.q.values.call(this,a,b,c,d,e,f)};
k.map=function(a,b){for(var c=this,d=a.stores(),e,f=0;e=d[f];f++)if(!e)throw new I('Store "'+e+'" not found.');e=this.g.request("map",d);N(this.i,"map:"+a);this.g.Ua(e,function(d,e,f){N(c.i,e+" iterating "+a);for(var m=a.stores(),n=[],p=0;p<m.length;p++)n[p]=Y(c).h(d,e,m[p]);var q=a.load(n);q.H=function(a){f(a,!1)};q.B=function(c){if(null!=c){var d;a.n?a.h?d=c:d=q.na():a.h?d=c:d=q.ic();b(d);q.advance(1)}else f(void 0),b=null}},d,vh);return e};
function Vi(a,b,c,d,e){var f=[],g=c.g,h=W(c),l=h+" "+b+"ByIterator "+d;0<e&&(l+=" limit "+e);M(a.i,l);for(var m=Y(a),n=[],p=d.stores(),q=0;q<p.length;q++)n[q]=m.h(g,h,p[q]);var s=d.load(n);s.H=function(a){Dh(s);U(c,a,!0)};var y=0,A=!1;s.B=function(d){A||(N(a.i,l+" starting"),A=!0);null!=d?(s.na(),y++,1==b?f.push(d):2==b?f.push(s.na()):3==b?f.push([d,s.na()]):6!=b&&f.push(s.ic()),5==b?(Dh(s),U(c,f[0])):6==b||!t(e)||y<e?s.Db():(M(a.i,"success:"+l+" yields "+f.length+" records"),Dh(s),U(c,f))):(M(a.i,
"success:"+l+" yields "+f.length+" records"),Dh(s),U(c,5==b?f[0]:6==b?y:f))}};var Ii="created",Ti="deleted",Ni="updated";function Wi(a,b){F.call(this,a,b)}D(Wi,F);function Xi(a,b,c){F.call(this,a,b);this.version=c}D(Xi,Wi);Xi.prototype.name="ReadyEvent";Xi.prototype.version=NaN;function Yi(a,b,c){F.call(this,c||"error",a);this.error=b}D(Yi,Wi);Yi.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};Yi.prototype.name="ErrorEvent";Yi.prototype.error=null;function Zi(a,b){Yi.call(this,a,b,"fail")}D(Zi,Yi);Zi.prototype.name="FailEvent";
function Ki(a,b,c,d,e){F.call(this,a,b);this.w=c;this.key=d;this.value=e}D(Ki,Wi);Ki.prototype.name="RecordEvent";function Hi(a,b,c,d,e){F.call(this,a,b);this.w=c;this.keys=d;this.values=e}D(Hi,Wi);Hi.prototype.name="StoreEvent";Hi.prototype.aa=function(){return this.keys};Hi.prototype.U=function(){return this.values};function $i(a,b,c,d,e,f){t(e)||(e=u(a)?a.join(", "):a);if(null!=a&&!w(a)&&!v(a))throw new I("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);u(a)&&Object.freeze&&Object.freeze(a);!t(a)&&t(e)&&(a=e);this.keyPath=a;this.m=v(this.keyPath);this.h=e;this.type=aj(b);if(t(b)){if(!t(this.type))throw new I("type invalid in index: "+this.h);if(u(this.keyPath))throw new I('composite key for store "'+this.h+'" must not specified type');}this.unique=!!c;this.multiEntry=!!d;this.n=w(this.type)?
this.type:bj;this.k=w(e)?e:u(a)?this.keyPath.join(","):a;this.j=Ga(this.k);this.g=this.m?null:this.keyPath.split(".");this.l=f||null}function cj(a,b){if(null!=b){if(v(a.keyPath)){for(var c=[],d=0,e=a.keyPath.length;d<e;d++){var f=hh(b,a.keyPath[d]);c[d]=f}return c}return hh(b,a.keyPath)}}function dj(a,b,c){for(var d=0;d<a.g.length;d++)d==a.g.length-1?b[a.g[d]]=c:z(b[a.g[d]])||(b[a.g[d]]={})}var bj="TEXT";function gh(a,b){if("DATE"==b){if(a instanceof Date)return+a}else return null!=b?a:kh(a)}
function ej(a,b){return"DATE"==b?new Date(a):t(b)?a:nh(a)}var fj=["BLOB","DATE","INTEGER","NUMERIC",bj];function aj(a){if(w(a))return a=La(fj,a),fj[a]}k=$i.prototype;k.getName=function(){return this.h};k.toJSON=function(){return{name:this.h,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};k.T=function(){var a=u(this.keyPath)?Xa(this.keyPath):this.keyPath;return new $i(a,this.type,this.unique,this.multiEntry,this.h,this.l)};
function gj(a,b){return null!=a||null!=b?null!=a?null!=b?v(a)&&v(b)?$a(a,b)?null:"expect: "+a+", but: "+b:hj(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null}k.hint=function(a){if(!a)return this;var b=u(this.keyPath)?Xa(this.keyPath):this.keyPath,c=this.type;t(a.type)||"TEXT"!=c||(c=void 0);return new $i(b,c,this.unique,this.multiEntry,a.h)};function ij(a,b){a.l=b}
k.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.g&&1<this.g.length&&(a+="Compound");return a+"Index:"+this.h};function vi(a,b,c,d,e,f,g,h){this.j=a;if(!w(this.j))throw new I("store name must be a string");this.keyPath=t(b)?b:null;this.o=v(this.keyPath);if(null!==this.keyPath&&!w(this.keyPath)&&!this.o)throw new I("keyPath must be a string or array");this.h=c;var l;if(null!=d){l=aj(d);if(!t(l))throw new I('type "'+d+'" for primary key in store "'+this.j+'" is invalid.');if(this.o)throw new I('composite key for store "'+this.j+'" must not specified type');}this.type=null!=l?l:this.h?"INTEGER":void 0;this.m=
w(this.keyPath)?this.keyPath.split("."):[];this.indexes=e||[];this.Ia=!!f;this.Ta=!!g;this.B=w(this.type)?this.type:bj;this.l=u(this.keyPath)?this.keyPath.join(","):w(this.keyPath)?this.keyPath:"_ROWID_";this.k=Ga(this.l);if(this.u=!!h){if(this.keyPath)throw new I('encrypted store "'+this.j+'" must not use inline key');if(this.h)throw new I('encrypted store "'+this.j+'" must not use key generator');}this.n=[]}k=vi.prototype;k.Ia=!1;k.Ta=!1;
k.toJSON=function(){for(var a=[],b=0;b<this.indexes.length;b++)a.push(this.indexes[b].toJSON());return{name:this.j,keyPath:this.keyPath,autoIncrement:this.h,type:this.type,indexes:a}};
function wi(a){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==La(b,c))throw new I('Unknown attribute "'+c+'"');b=[];c=a.indexes||[];if(u(c))for(var d=0;d<c.length;d++){var e;e=c[d];var f="name unique type keyPath multiEntry generator".split(" "),g=void 0;for(g in e)if(e.hasOwnProperty(g)&&-1==La(f,g))throw new I("Unknown field: "+g+" in "+Q(e));e=new $i(e.keyPath,e.type,e.unique,e.multiEntry,e.name,e.generator);
t(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new vi(a.name,a.keyPath,a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)}function jj(a,b,c,d,e,f,g){a=kj(a,b,c,d,e,f,g);b="";0!=c&&(b+="SELECT "+a.select);b+=" FROM "+a.jb;a.R&&(b+=" WHERE "+a.R);a.group&&(b+=" GROUP BY "+a.group);a.Pa&&(b+=" ORDER BY "+a.Pa);return b}
function kj(a,b,c,d,e,f,g){var h={select:"",jb:"",R:"",group:"",Pa:""},l=a.l,m=a.k,n=null;d!==l&&w(d)&&(n=Ah(a,d));var p=!!n,q=d||l,s=Ga(q),y=p?n.type:a.type,A=p&&n.multiEntry;h.jb=lj(a);6===c?h.select="COUNT("+m+")":3===c||1===c||2===c?(h.select=m,null!=d&&d!=l&&(h.select+=", "+s)):h.select="*";d=g?"DISTINCT ":"";l=[];A?(A=Ga("ydn.db.me:"+a.getName()+":"+n.getName()),h.select=6===c?"COUNT("+d+A+"."+s+")":3===c||1===c||2===c?"DISTINCT "+lj(a)+"."+m+", "+A+"."+s+" AS "+q:"DISTINCT "+lj(a)+".*, "+A+
"."+s+" AS "+q,h.jb=A+" INNER JOIN "+lj(a)+" USING ("+m+")",null!=e&&(fh(A+"."+s,y,e,l,b),0<l.length&&(h.R=h.R?h.R+(" AND "+l.join(" AND ")):l.join(" AND ")))):null!=e&&(fh(s,y,e,l,b),0<l.length&&(h.R=h.R?h.R+(" AND "+l.join(" AND ")):l.join(" AND ")));p&&!n.unique&&g&&(h.group=s);a=f?"DESC":"ASC";h.Pa=s+" "+a;p&&(h.Pa+=", "+m+" "+a);return h}
function mj(a,b,c,d,e,f,g,h,l){var m,n,p,q;null!=e?(m=e.lower,n=e.upper,p=e.lowerOpen,q=e.upperOpen,f?null!=n?(e=S(h,n),-1==e?(n=h,q=l):0==e&&(q=l||q)):(n=h,q=l):null!=m?(e=S(h,m),1==e?(m=h,p=l):0==e&&(p=l||p)):(m=h,p=l)):f?(n=h,q=l):(m=h,p=l);e=new R(m,n,!!p,!!q);d=d?Ah(a,d):null;b=kj(a,c,b,d?d.k:a.l,e,f,g);b="SELECT "+b.select+" FROM "+b.jb+(b.R?" WHERE "+b.R:"")+(b.group?" GROUP BY "+b.group:"")+" ORDER BY "+b.Pa;d&&(b+=", "+a.k+(f?"DESC":"ASC"));return b}
function nj(a,b,c,d,e,f,g,h,l,m){var n=Ah(a,d),p=n.k;d=n.j;var q=a.k,s=l?" <":" >",s=g?s+" ":s+"= ";g=gh(f,n.type);h=gh(h,a.type);n="";e?(a=kj(a,c,b,p,e,l,m),a.R+=" AND ",n=d+s+"?",c.push(g)):(e=l?R.upperBound(f,!0):R.lowerBound(f,!0),a=kj(a,c,b,p,e,l,m),n=a.R,a.R="");a.R+="("+n+" OR ("+d+" = ? AND "+q+s+"?))";c.push(g);c.push(h);return"SELECT "+a.select+" FROM "+a.jb+" WHERE "+a.R+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.Pa}k.T=function(){return wi(this.toJSON())};
k.index=function(a){return this.indexes[a]||null};function Ah(a,b){return Ra(a.indexes,function(a){return a.getName()==b})}function zh(a,b){for(var c=0;c<a.indexes.length;c++)if(!gj(a.indexes[c].keyPath,b))return a.indexes[c];return null}function Fi(a,b){return b===a.keyPath?!0:Pa(a.indexes,function(a){return a.getName()==b})}function lj(a){return Ga(a.j)}
function oj(a,b){if(!b)return a;var c=a.h,d=u(a.keyPath)?Xa(a.keyPath):a.keyPath,e=a.type,f=Oa(a.indexes,function(a){return a.T()});t(b.type)||"TEXT"!=e||(e=void 0);u(b.keyPath)&&w(d)&&d==b.keyPath.join(",")&&(d=Xa(b.keyPath));for(var g=0,h=b.indexes.length;g<h;g++)if(b.indexes[g].m)for(var l=b.indexes[g].getName(),m=f.length-1;0<=m;m--)if(0<=l.indexOf(f[m].getName())){f[m]=b.indexes[g].T();break}for(g=0;g<f.length;g++)(h=Ah(b,f[g].getName()))&&(f[g]=f[g].hint(h));return new vi(b.j,d,c,e,f)}
k.getName=function(){return this.j};function pj(a){return!!a.keyPath}function Ji(a,b,c){if(b){if(!a.keyPath&&null!=c)return c;if(a.o){c=[];for(var d=0;d<a.keyPath.length;d++)c.push(hh(b,a.keyPath[d]));return c}if(a.keyPath)return Zb(b,a.m)}}function Mi(a,b,c){for(var d=0;d<a.m.length;d++){var e=a.m[d];if(d==a.m.length-1){b[e]=c;break}t(b[e])||(b[e]={});b=b[e]}}
function qj(a,b,c){var d=[],e=[];c=t(c)?c:Ji(a,b);t(c)&&(e.push(a.k),d.push(gh(c,a.type)));for(var f=0;f<a.indexes.length;f++){var g=a.indexes[f];if(!g.multiEntry&&g.getName()!==a.keyPath&&"_default_"!=g.getName()){var h=cj(g,b);null!=h&&(d.push(gh(h,g.type)),e.push(g.j))}}a.Ta?a.Ta&&!a.keyPath&&0==a.indexes.length&&(w(b)&&-1==b.indexOf(";base64,")?d.push(b):d.push(Q(b)),e.push("_default_")):(d.push(Q(b)),e.push("_default_"));a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{ad:e,od:a,values:d,key:c}}
function xi(a,b){if(!b)return"missing store: "+a.j;if(a.j!=b.j)return"store name, expect: "+a.j+", but: "+b.j;var c=gj(a.keyPath,b.keyPath);if(c)return"keyPath, "+c;if(t(a.h)&&t(b.h)&&a.h!=b.h)return"autoIncrement, expect:  "+a.h+", but: "+b.h;if(a.indexes.length!=b.indexes.length)return"indexes length, expect:  "+a.indexes.length+", but: "+b.indexes.length;if(t(a.type)&&t(b.type)&&(v(a.type)?!$a(a.type,b.type):a.type!=b.type))return"data type, expect:  "+a.type+", but: "+b.type;for(c=0;c<a.indexes.length;c++){var d=
Ah(b,a.indexes[c].getName()),e;e=a.indexes[c];if(d)if(e.h!=d.h)e="name, expect: "+e.h+", but: "+d.h;else{var f=gj(e.keyPath,d.keyPath);e=f?"keyPath, "+f:null!=e.unique&&null!=d.unique&&e.unique!=d.unique?"unique, expect: "+e.unique+", but: "+d.unique:null!=e.multiEntry&&null!=d.multiEntry&&e.multiEntry!=d.multiEntry?"multiEntry, expect: "+e.multiEntry+", but: "+d.multiEntry:t(e.type)&&t(d.type)&&(v(e.type)?!$a(e.type,d.type):e.type!=d.type)?"data type, expect: "+e.type+", but: "+d.type:""}else e=
"no index for "+e.h;if(0<e.length)return'index "'+a.indexes[c].getName()+'" '+e}return""}function Gi(a,b){if(b)for(var c=0;c<a.indexes.length;c++){var d=a.indexes[c],e=b;if(d.l){var f=d.l(e),g=typeof f;if("string"==g||"number"==g||f instanceof Date||u(f)){for(g=0;g<d.g.length-1;g++)z(e[d.g[g]])||(e[d.g[g]]={});e[d.g[d.g.length-1]]=f}}}}function rj(a,b){a.n.push(b)}function Di(a,b,c,d,e){for(var f=0;f<a.n.length;f++)d!==f&&a.n[f].call(e,b,c)}
k.toString=function(){return"Store:"+this.j+"["+this.indexes.length+"index]"};function sj(a,b){if(!a||sa(a))throw new I("store_name must be provided for primary full text index");if(!b||sa(b))throw new I("index_name must be provided for primary full text index");this.w=a};function tj(a,b,c){this.name=a;this.indexes=b;this.g=c||"";if(-1==["","en","fr"].indexOf(this.g))throw new I('Unsupported lang "'+c+" for full text search index "+a);}tj.prototype.getName=function(){return this.name};tj.prototype.count=function(){return this.indexes.length};tj.prototype.index=function(a){return this.indexes[a]};
function uj(a){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==La(b,c))throw new I("Unknown field: "+c+" in "+Q(a));if(!u(a.sources))throw new I("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==La(b,c))throw new I("Unknown field: "+c+" in "+Jf(a));return new sj(a.storeName,a.keyPath)});return new tj(a.name,
b,a.lang)};function vj(a,b){var c,d,e=b;if(z(a)){d=a;c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==La(c,f))throw new I("Unknown field: "+f+" in schema.");c=d.version;var e=[],g=d.stores||[];if(!u(g))throw new I("stores must be array");for(f=0;f<g.length;f++){var h=wi(g[f]);if(-1!=Sa(e,function(a){return a.name==h.getName()}))throw new I('duplicate store name "'+h.getName()+'".');e.push(h)}}else w(a)?c=0==a.length?void 0:parseFloat(a):x(a)&&(c=a);if(t(c)){if(!x(c)||0>c)throw new I("Invalid version: "+
c+" ("+a+")");isNaN(c)&&(c=void 0)}if(t(b)&&(!u(b)||0<b.length&&!(b[0]instanceof vi)))throw new I("stores");this.version=c;this.h=!t(this.version);this.stores=e||[];c=[];if(d&&d.fullTextCatalogs)for(f=0;f<d.fullTextCatalogs.length;f++)e=uj(d.fullTextCatalogs[f]),c[f]=e,Z(this,e.getName())||(g=[new $i("k",bj),new $i("v",bj)],e=new vi(e.getName(),"id",!1,void 0,g),this.stores.push(e));this.j=c}
vj.prototype.toJSON=function(){var a=Oa(this.stores,function(a){return a.toJSON()}),b={};b.stores=a;t(this.version)&&(b.version=this.version);return b};vj.prototype.h=!1;vj.prototype.g=function(){return!1};function Ei(a){return Oa(a.stores,function(a){return a.getName()})}vj.prototype.count=function(){return this.stores.length};function Z(a,b){return Ra(a.stores,function(a){return a.getName()==b})}function Ci(a,b){return Pa(a.stores,function(a){return a.getName()==b})}
function wj(a,b,c,d){if(!b||a.stores.length!=b.stores.length)return"Number of store: "+a.stores.length+" vs "+b.stores.length;for(var e=0;e<a.stores.length;e++){var f=Z(b,a.stores[e].getName());if(f){c&&(f=oj(f,a.stores[e]));if(d)for(var g=f,h=a.stores[e],l=0;l<h.indexes.length;l++){var m=h.indexes[l];Fi(g,m.getName())||"BLOB"!=m.type||(m=new $i(m.keyPath,m.type,m.unique,m.multiEntry,m.getName()),g.indexes.push(m))}f=xi(a.stores[e],f);if(0<f.length)return'store: "'+a.stores[e].getName()+'" '+f}else return'missing object store "'+
a.stores[e].getName()+'"'}return""};function yi(a,b){vj.call(this,a,b)}D(yi,vj);yi.prototype.g=function(){return!0};function zi(a,b){a.stores.push(b)};function xj(a){return If(Q(a))}function hj(a,b){var c;c=c||{};if(null!=a&&null!=b){if(v(a)&&v(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(-1==Ra(b,function(b){return hj(b,a[d])}))return!1;return!0}if(v(a))return 1==a.length&&hj(a[0],b);if(v(b))return 1==b.length&&hj(b[0],a);if(z(a)&&z(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=hj(a[e],b[e]);if(!f)return!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=hj(a[e],b[e]),!f))return!1;return!0}return a===b}return!1}
function yj(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return a[b]};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function zj(a,b,c){c=c||{};var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==La(d,e))throw new I('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!u(c.mechanisms))throw new I("mechanisms attribute must be an array but "+da(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!Ta(Aj,c.mechanisms[e]))throw new I('Invalid mechanism "'+c.mechanisms[e]+'"');}this.G=c.mechanisms||Aj;this.B=c.size;this.H=
t(c.connectionTimeout)?c.connectionTimeout:3E4;this.j=null;this.k=[];this.Ob=!1;var f;if(b instanceof vj)f=b;else if(z(b))for(c.autoSchema||!t(b.stores)?f=new yi(b):f=new vj(b),c=b.stores?b.stores.length:0,e=0;e<c;e++)d=Z(f,b.stores[e].name),b.stores[e].Sync&&this.Yc(d,b.stores[e].Sync);else f=new yi;this.h=f;for(e=0;e<this.h.count();e++)if((this.h.stores[e]||null).u)throw Error("encryption option must be defined");t(a)&&Bj(this,a);this.n=null;this.m=new E}zj.prototype.i=P("ydn.db.con.Storage");
function Bj(a,b){if(a.j)throw new Ac("Already connected with "+a.o);a.o=b;Ai(a)}zj.prototype.getName=function(){return this.o};var Aj="indexeddb websql localstorage sessionstorage userdata memory".split(" ");k=zj.prototype;k.sc=function(){return null};
function Ai(a){function b(b,e){b?(N(a.i,a+": ready."),a.hd=NaN,d.qb=function(b){a.fa(new Yi(a,b))},d.hc=function(b){a.fa(new Zi(a,b));a.j=null},d.Sb=function(b){a.fa(b)},setTimeout(function(){Cj(a,e);Dj(a)},10),c.p(e)):(K(a.i,a+": database connection fail "+e.name),setTimeout(function(){Cj(a,new Zi(a,e));if(a.k){a.i.info("Purging "+a.k.length+" transactions request.");for(var b;b=a.k.shift();)b.ga&&b.ga("error",e)}},10),c.s(e))}for(var c=new E,d=null,e=a.G,f=0;f<e.length;f++){var g=e[f].toLowerCase();
if(d=a.sc(g)){d=a.sc(g);break}}null===d?(e=new Tf("No storage mechanism found."),b(!1,new Zi(a,e))):(a.init(),d.connect(a.o,a.h).t(function(){this.j=d;b(!0,new Xi("ready",this,parseFloat(d.fc())))},function(a){K(this.i,this+": opening fail");b(!1,a)},a))}function ii(a){if(a.j)return a.j.fb()}k.ab=function(a,b){this.m.Q(a,b)};function Cj(a,b){setTimeout(function(){b instanceof Yi?a.m.s(b.error):a.m.p();a.fa(b)},4)}function qi(a){return!!a.j&&a.j.gc()}k.init=function(){};
function Ej(){var a=Fj;a.j&&(a.j.ec(),a.j=null,N(a.i,a+" closed"))}k.hd=NaN;function Dj(a){var b=a.k.shift();b&&(N(a.i,"pop tx queue["+(a.k.length+1)+"]"),ri(a,b.Hb,b.scopes,b.mode,b.ga));a.hd=C()}function Gj(a,b,c,d,e){N(a.i,"push tx queue["+a.k.length+"]");a.k.push({Hb:b,scopes:c,mode:d,ga:e});100<a.k.length&&0==a.k.length%100&&K(a.i,"Transaction queue stack size is "+a.k.length+". It is too large, possibility due to incorrect usage.")}k.Ob=!1;
function ri(a,b,c,d,e){var f=c;if(w(c))f=[c];else if(null!=c)if(v(c)){if(0==c.length)throw new I("number of store names must more than 0");for(var g=0;g<c.length;g++)if(!w(c[g]))throw new I("store name at "+g+" must be string but found "+typeof c[g]);}else throw new I("store names must be an array");else f=null;if(a.j&&a.j.gc()&&!a.Ob){var h=t(d)?d:vh;h==wh&&(a.Ob=!0);a.j.Gb(function(a){b(a);b=null},f,h,function(b,c){fa(e)&&(e(b,c),e=void 0);h==wh&&(a.Ob=!1);Dj(a)})}else Gj(a,b,f,d,e)}
k.Yc=function(a){K(this.i,"Synchronization option for "+a.getName()+" ignored.")};k.fa=function(){};k.toString=function(){return"Storage:"+this.j};function Hj(a,b,c,d){this.k=a;this.l=b;this.g=Xa(c);this.h=d;this.j=[]}Hj.prototype.k=null;Hj.prototype.onCompleted=function(a,b){for(var c=0;c<this.j.length;c++)this.j[c](a,b);this.j.length=0;this.j=this.g=this.k=null};function Ij(a,b,c){if(a.k)c&&a.j.push(c),b(a.k);else throw new Bc("tx committed on ParallelTxExecutor");}Hj.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.l+" mode:"+this.h+" scopes:"+Q(this.g)};function Jj(a,b,c,d,e,f){ei.call(this,a,b,c,d,e,f);this.k=this.h=null}D(Jj,ei);k=Jj.prototype;k.i=P("ydn.db.tr.Parallel");k.abort=function(){M(this.i,this+": aborting");ji(this.k)};
k.rd=function(a,b){var c;if("multi"==this.l)a:if(c=this.h,!c.g||!c.h||b!=c.h&&(c.h!=T||b!=vh)||a.length>c.g.length)c=!1;else{for(var d=0;d<a.length;d++)if(-1==c.g.indexOf(a[d])){c=!1;break a}c=!0}else if("repeat"==this.l)a:if(c=this.h,c.g&&c.h&&b==c.h&&c.g.length==a.length){for(d=0;d<a.length;d++)if(-1==c.g.indexOf(a[d])){c=!1;break a}c=!0}else c=!1;else c="all"==this.l?!0:!1;return c};
k.Ha=function(a,b,c,d){function e(c){l.j++;m=new Hj(c,l.j,b,h);g=l.$();L(l.i,g+" BEGIN "+Q(b)+" "+h);l.h=m;Ij(l.h,a,d)}function f(a,b){L(l.i,g+" "+a);if(m)m.onCompleted(a,b);l.g=0}var g;this.ia&&(b=this.ia);this.N&&(c=this.N);var h=t(c)?c:vh,l=this,m;if(this.h&&this.h.k&&this.rd(b,h))Ij(this.h,a,d);else{if(this.G&&this.j>=this.G)throw new Ac("Exceed maximum number of transactions of "+this.G);ri(this.A(),e,b,h,f)}};
k.request=function(a,b,c,d){var e=Jj.q.request.call(this,a,b,c,d),f=this;this.Ha(function(a){f.g++;Nh(e,a,f.$()+"R"+f.g)},b,c||vh,d);return e};k.Ua=function(a,b,c,d,e){var f=this,g;this.Ha(function(c){f.g++;g=f.$()+"R"+f.g;M(f.i,g+" BEGIN");b(c,g,function(b,d){f.k=c;g=f.$()+"R"+f.g;d?(M(f.i,g+" ERROR"),a.s(b)):(M(f.i,g+" SUCCESS"),a.p(b));f.k=null});b=null;M(f.i,g+" END")},c,d,e)};k.toString=function(){return"Parallel:"+this.l+":"+this.$()+(this.k?"*":"")};function Kj(a,b){Jj.call(this,a,b,fi)}D(Kj,Jj);k=Kj.prototype;k.i=P("ydn.db.tr.AtomicParallel");k.rd=function(){return!1};k.request=function(a,b,c){var d,e,f,g=this,h=Kj.q.request.call(this,a,b,c,function(a,b){h.g=null;M(g.i,"transaction "+a);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new bi;U(h,c,!0)}});Qh(h,function(a,b,c){f=b;e=a;d=c});return h};
k.Ua=function(a,b,c,d,e){var f,g,h=new E;h.t(function(a){g=!1;f=a},function(a){g=!0;f=a});Kj.q.Ua.call(this,h,b,c,d,function(b,c){if("complete"!=b)a.s(c);else if(!0===g)a.s(f);else if(!1===g)a.p(f);else{var d=new bi;a.s(d)}e&&(e(b,c),e=void 0)})};k.toString=function(){return"Atomic"+Kj.q.toString.call(this)};function Lj(a,b,c){zj.call(this,a,b,c);this.l=0;a=!0;b=fi;c&&(t(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=Mj(this,b,a);this.ka=Mj(this,"atomic",!1);this.g=this.lb(c,this.ka)}D(Lj,zj);Lj.prototype.l=0;Lj.prototype.lb=function(a,b){return new ti(this,this.h,a,b)};
function Mj(a,b,c,d,e,f){if(c){if("multi"==b||"repeat"==b||"all"==b||b==fi)return new mi(a,a.l++,b,d,e,f);if("atomic"==b)return new si(a,a.l++);throw new I('Invalid requestType "'+b+'"');}if("multi"==b||"repeat"==b||"all"==b||b==fi)return new Jj(a,a.l++,b,d,e,f);if("atomic"==b)return new Kj(a,a.l++);throw new I('Invalid requestType "'+b+'"');}
Lj.prototype.N=function(a,b,c){if(3<arguments.length)throw new I("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.l++;var d=b||Ei(this.h),e=vh;if(c)if("readwrite"==c)e=T;else if("readonly"!=c)throw new I('Invalid transaction mode "'+c+'"');var f=Mj(this,"all",!1,d,e,1),g=this.lb(f,this.ka),h=new Mh("run"),l=this;f.Ha(function(b){N(l.i,"executing run in transaction on "+f);Nh(h,b,f.$()+"R0");a(g)},d,e,function(a){h.g=null;U(h,f.j,"complete"!==
a)});return h};function Nj(a,b,c){Lj.call(this,a,b,c);a=this.h;for(b=0;b<a.j.length;b++){c=a.j[b];var d=Z(a,c.getName());if(d){if(!Fi(d,"k"))throw new I('full text index store "'+d.getName()+'" must have "keyword" index');if(!Fi(d,"v"))throw new I('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.keyPath)throw new I('full text index store "'+d.getName()+'" must use "id" as key path.');}else throw new I('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=
c.index(d),f=Z(a,e.w);if(f)K(this.i,"Full text indexer option for "+f.getName()+" ignored.");else throw new I('full text source store "'+e.w+'" does not exist for full text index "'+c.getName()+'"');}}}D(Nj,Lj);k=Nj.prototype;k.init=function(){Nj.q.init.call(this)};k.lb=function(a,b){return new Bi(this,this.h,a,b)};k.add=function(a,b,c){return this.g.add(a,b,c)};k.count=function(a,b,c,d){return this.g.count(a,b,c,d)};k.get=function(a,b){return this.g.get(a,b)};
k.keys=function(a,b,c,d,e,f,g){return this.g.keys(a,b,c,d,e,f,g)};k.values=function(a,b,c,d,e,f){return this.g.values(a,b,c,d,e,f)};k.list=function(a,b,c,d,e,f,g,h,l){return this.g.list(a,b,c,d,e,f,g,h,l)};k.load=function(a,b,c){return this.g.load(a,b,c)};k.put=function(a,b,c){return this.g.put(a,b,c)};k.clear=function(a,b,c){return this.g.clear(a,b,c)};k.remove=function(a,b,c){return this.g.remove(a,b,c)};k.toString=function(){var a="Storage:"+this.getName();qi(this)&&(a+=" ["+ii(this)+"]");return a};function Oj(a,b,c){Nj.call(this,a,b,c)}D(Oj,Nj);Oj.prototype.lb=function(a,b){return new Ui(this,this.h,a,b)};Oj.prototype.map=function(a,b){return this.g.map(a,b)};function Pj(a,b,c,d){yh.call(this,a,b,c,d);this.l=null}D(Pj,yh);k=Pj.prototype;k.i=P("ydn.db.core.req.IDBCursor");k.dd=function(a){(a=a.target.result)?this.Oa(a.key,a.primaryKey,a.value):this.Oa()};
k.openCursor=function(a,b){function c(a,b,c){p.l=n;p.l.onsuccess=B(p.dd,p);p.Oa(a,p.k?b:void 0,c);n=null}var d=this+" opening ";null!=a&&(d+="{"+a,d=null!=b?d+(";"+b+"}"):d+"}");N(this.i,d);var e=this.J,d=this.m.objectStore(this.w),f=w(this.ua)?d.index(this.ua):null;if(t(a))var g=f?!t(b):!0,h=e?e.lower:void 0,l=e?e.upper:void 0,m=e?!!e.lowerOpen:!1,e=e?!!e.upperOpen:!1,e=$g(this.reverse?new R(h,a,m,g):new R(a,l,g,e));var n;this.kb?f?n=null!=this.Aa?f.openKeyCursor(e,this.Aa):null!=e?f.openKeyCursor(e):
f.openKeyCursor():n=null!=this.Aa?d.openCursor(e,this.Aa):null!=e?d.openCursor(e):d.openCursor():f?n=null!=this.Aa?f.openCursor(e,this.Aa):null!=e?f.openCursor(e):f.openCursor():n=null!=this.Aa?d.openCursor(e,this.Aa):null!=e?d.openCursor(e):d.openCursor();var p=this;n.onerror=function(a){var b=n.error;a.preventDefault();p.H(b);Bh(p);p.G=!0};null!=a?n.onsuccess=function(d){if(d=d.target.result){var e=xh.cmp(d.key,a),f=p.reverse?-1:1;if(e==f)c(d.key,d.primaryKey,d.value);else if(e==-f)d["continue"](a);
else if(null!=b)if(xh.cmp(d.primaryKey,b)==f)c(d.key,d.primaryKey,d.value);else d["continue"]();else d["continue"]()}else c()}:(p.l=n,p.l.onsuccess=B(p.dd,p))};k.Nb=function(){return!!this.l};k.update=function(a){var b=this.l.result;if(b){var c=new E;a=b.update(a);a.onsuccess=function(a){c.p(a.target.result)};a.onerror=function(a){a.preventDefault();c.s(a)};return c}throw new Xh("cursor gone");};
k.clear=function(){var a=this.l.result;if(a){var b=new E,a=a["delete"]();a.onsuccess=function(){b.p(1)};a.onerror=function(a){a.preventDefault();b.s(a)};return b}throw new Xh("cursor gone");};k.advance=function(a){var b=this.l.result;if(1==a)b["continue"]();else b.advance(a)};k.Db=function(a){var b=this.l.result;if(null!=a)b["continue"](a);else b["continue"]()};k.I=function(){Pj.q.I.call(this);this.l=null};k.toString=function(){return"IDB"+Pj.q.toString.call(this)};function Qj(a,b,c,d,e,f){E.call(this,e,f);this.k=a;this.g=[];this.n=!!b;this.N=!!c;this.H=!!d;for(b=this.B=0;b<a.length;b++)a[b].t(B(this.o,this,b,!0),B(this.o,this,b,!1));0!=a.length||this.n||this.p(this.g)}D(Qj,E);Qj.prototype.o=function(a,b,c){this.B++;this.g[a]=[b,c];this.qa||(this.n&&b?this.p([a,c]):this.N&&!b?this.s(c):this.B==this.k.length&&this.p(this.g));this.H&&!b&&(c=null);return c};Qj.prototype.s=function(a){Qj.q.s.call(this,a);for(a=0;a<this.k.length;a++)cb(this.k[a])};function Rj(a,b){this.g=b}D(Rj,di);k=Rj.prototype;k.i=P("ydn.db.crud.req.IndexedDb");k.Fb=function(a,b){function c(e){var f=a.g.objectStore(b[e]).count();f.onsuccess=function(f){d[e]=f.target.result;e++;e==b.length?U(a,d):c(e)};f.onerror=function(b){b.preventDefault();U(a,f.error,!0)}}var d=[];0==b.length?U(a,[]):c(0)};
k.la=function(a,b,c,d,e,f){function g(s){if(null==e[s])if(N(n.i,"empty object at "+s+" of "+e.length),l++,l==e.length)U(a,h,m);else{var A=s+10;A<e.length&&g(A)}var G,A=e[s];G=null!=f?b?q.put(A,f[s]):q.add(A,f[s]):b?q.put(A):q.add(A);G.onsuccess=function(b){l++;h[s]=b.target.result;l==e.length?U(a,c?h[0]:h,m):(b=s+10,b<e.length&&g(b))};G.onerror=function(b){l++;var f=G.error;N(n.i,W(a)+p+' request to "'+d+'" cause '+f.name+' for object "'+Jf(e[s])+'" at index '+s+" of "+e.length+" objects.");h[s]=
f;m=!0;b.preventDefault();l==e.length?U(a,c?h[0]:h,m):(b=s+10,b<e.length&&g(b))}}var h=[],l=0,m=!1,n=this,p=b?"put":"add",q=a.g.objectStore(d);N(this.i,W(a)+" "+p+" "+e.length+' objects to store "'+d+'"');if(0<e.length)for(var s=0;10>s&&s<e.length;s++)g(s);else U(a,[])};
k.Tb=function(a,b,c){function d(l){var n=c[l],p=n.w,q=a.g.objectStore(p),s;s=null===q.keyPath?q.put(b[l],n.id):q.put(b[l]);s.onsuccess=function(c){f++;e[l]=c.target.result;f==b.length?U(a,e,g):(c=l+10,c<b.length&&d(c))};s.onerror=function(c){f++;K(h.i,"request result "+c.name+' error when put keys to "'+p+'" for object "'+Jf(b[l])+'" at index '+l+" of "+b.length+" objects.");e[l]=s.error;g=!0;c.preventDefault();f==b.length?U(a,e,g):(c=l+10,c<b.length&&d(c))}}var e=[],f=0,g=!1,h=this;N(this.i,W(a)+
" putByKeys: of "+b.length+" objects");if(0<b.length)for(var l=0;10>l&&l<b.length;l++)d(l);else U(a,e,g)};
k.Lc=function(a,b,c,d,e,f){function g(){var a={},b=e.indexOf("\n",n),d=!1,s;-1==b?(d=!0,s=e.substring(n)):(s=e.substring(n,b),n=b+1);for(var b=s.split(f),J=0;J<p.length;J++){var O=b[J];q[J]&&(q[J]==bj?O=Da(O,'"'):"INTEGER"==q[J]?O=parseInt(O,10):"NUMERIC"==q[J]&&(O=parseFloat(O)));a[p[J]]=O}var ga=l.put(a);ga.onsuccess=function(a){m.push(a.target.result);d?c(m):g()};ga.onerror=function(a){"DataError"==a.name&&(a=new Uh(h+": "+s.substring(0,70)));a.preventDefault();c(ga.error,!0)}}var h=Z(this.g,d),
l=a.objectStore(d),m=[],n=e.indexOf("\n"),p=e.substr(0,n).split(f),q=[];for(a=0;a<p.length;a++){var s=Ah(h,p[a]);s?q[a]=s.type:p[a]==h.keyPath&&(q[a]=h.type)}n++;N(this.i,b+" Loading data  of "+p.length+"-fields record to "+d);g()};
k.Vb=function(a,b,c){var d=a.g.objectStore(b);N(this.i,W(a)+" clearById: "+b+" "+c);var e=d.openCursor(ch.only(c));e.onsuccess=function(b){if(b=b.target.result){var c=b["delete"]();c.onsuccess=function(){U(a,1)};c.onerror=function(){U(a,c.error,!0)}}else U(a,0)};e.onerror=function(b){b.preventDefault();U(a,e.error,!0)}};
k.Xb=function(a,b){function c(h){h++;if(h>=b.length)0<g.length?U(a,g,!0):U(a,d);else{b[h].w!=e&&(e=b[h].w,f=a.g.objectStore(e));var l=f["delete"](b[h].id);l.onsuccess=function(){d++;c(h)};l.onerror=function(a){a.preventDefault();g[h]=l.error;c(h)}}}var d=0,e,f;N(this.i,W(a)+" removeByKeys: "+b.length+" keys");var g=[];c(-1)};
k.Wb=function(a,b,c){var d=a.g.objectStore(b),e=d.count(c);N(this.i,W(a)+" clearByKeyRange: "+b+" "+c);e.onsuccess=function(b){var e=b.target.result,h=d["delete"](c);h.onsuccess=function(){U(a,e)};h.onerror=function(){U(a,h.error,!0)}};e.onerror=function(b){b.preventDefault();U(a,e.error,!0)}};k.oc=function(a,b,c){var d=a.g.objectStore(b);N(this.i,W(a)+" "+b+" "+c);var e=d["delete"](c);e.onsuccess=function(){U(a,void 0)};e.onerror=function(b){b.preventDefault();U(a,e.error,!0)}};
k.Mc=function(a,b,c,d){var e=a.g.objectStore(b).index(c);N(this.i,W(a)+" clearByIndexKeyRange: "+b+":"+c+" "+d);var f=[],g=e.openCursor(d),h=0;g.onsuccess=function(b){var c=b.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){h++;c["continue"]()};d.onerror=function(a){f.push(d.error);a.preventDefault();c["continue"]()}}else 0<f.length?U(a,f,!0):U(a,h)};g.onerror=function(b){b.preventDefault();U(a,g.error,!0)}};
k.Bb=function(a,b){var c=b.length,d=0;N(this.i,W(a)+" clearByStores: "+b);for(var e=0;e<c;e++){var f=a.g.objectStore(b[e]).clear();f.onsuccess=function(){d++;d==c&&U(a,d)};f.onerror=function(b){d++;b.preventDefault();d==c&&U(a,f.error,!0)}}};
k.Ib=function(a,b,c){var d=this;N(this.i,W(a)+b+":"+c);var e=a.g.objectStore(b),f=e.get(c);f.onsuccess=function(b){N(d.i,W(a)+" record "+c+(null!=b.target.result?" ":" not ")+" exists.");var f=b.target.result;if(!e.keyPath&&0==e.indexNames.length&&Ab&&w(f)&&0<=f.indexOf(";base64,")){'"'==f.charAt(0)&&'"'==f.charAt(f.length-1)&&(f=f.substr(1,f.length-2));f=f.split(";base64,");b=f[0].split(":")[1];for(var f=window.atob(f[1]),l=f.length,m=new Uint8Array(l),n=0;n<l;++n)m[n]=f.charCodeAt(n);U(a,new Blob([m.buffer],
{type:b}))}else U(a,b.target.result)};f.onerror=function(b){b.preventDefault();U(a,f.error,!0)}};
k.Hc=function(a,b,c){function d(b){if(null==c[b])if(f++,e[b]=void 0,f==h)U(a,e);else{var m=b+10;m<h&&d(m)}var n;n=g.get(c[b]);n.onsuccess=function(c){f++;e[b]=c.target.result;f==h?U(a,e):(c=b+10,c<h&&d(c))};n.onerror=function(b){f++;b.preventDefault();U(a,n.error,!0)}}var e=[];e.length=c.length;var f=0,g=a.g.objectStore(b),h=c.length;N(this.i,W(a)+" "+b+":"+h+" ids");if(0<h)for(b=0;10>b&&b<h;b++)d(b);else U(a,[])};
k.Pb=function(a,b){function c(f){var h=b[f],l=a.g.objectStore(h.w).get(h.id);l.onsuccess=function(h){e++;d[f]=h.target.result;e==b.length?U(a,d):(h=f+10,h<b.length&&c(h))};l.onerror=function(b){e++;b.preventDefault();U(a,l.error,!0)}}var d=[];d.length=b.length;var e=0;N(this.i,W(a)+" "+b.length+" ids");if(0<b.length)for(var f=0;10>f&&f<b.length;f++)c(f);else U(a,[])};
k.ib=function(a,b,c,d,e){if(d&&e)throw new Ac("unique count not available in IndexedDB");e=a.g.objectStore(b);b=W(a)+" "+b+(d?":"+d:"")+(c?":"+Q(c):"");N(this.i,b);var f;null!=d?(d=e.index(d),f=null!=c?d.count(c):d.count()):f=null!=c?e.count(c):e.count();f.onsuccess=function(b){U(a,b.target.result)};f.onerror=function(b){b.preventDefault();U(a,f.error,!0)}};
k.list=function(a,b,c,d,e,f,g,h,l,m){var n=[],p=a.g.objectStore(c),q=h?l?"prevunique":"prev":l?"nextunique":"next";c=W(a)+" "+b+" "+c+(d?":"+d:"")+(e?Q(e):"");h&&(c+=" reverse");l&&(c+=" unique");if(m&&t(m[0])){l=d?!t(m[1]):!0;var s=m[0],y=e?e.lower:void 0,A=e?e.upper:void 0,G=e?!!e.lowerOpen:!1;e=e?!!e.upperOpen:!1;e=$g(h?new R(y,s,G,l):new R(s,A,l,e));c+=" starting from "+Q(m[0]);t(m[1])&&(c+=", "+Q(m[1]))}N(this.i,c);var H;H=1==b||2==b||3==b?d?p.index(d).openKeyCursor(e,q):p.openCursor(e,q):d?
p.index(d).openCursor(e,q):p.openCursor(e,q);var J=!1;H.onsuccess=function(c){if(c=c.target.result){if(!J){if(0<g){J=!0;c.advance(g);return}if(m&&d&&t(m[0]))if(t(m[1])){var e=xh.cmp(c.key,m[0]),l=h?-1:1;if(0==e){e=xh.cmp(c.primaryKey,m[1]);if(0==e){J=!0;c["continue"]();return}if(e==l)J=!0;else{c["continue"]();return}}else J=!0}else J=!0;else J=!0}1==b?n.push(c.key):2==b?n.push(c.primaryKey):3==b?(l={},d&&(l[d]=c.key),p.keyPath?l[p.keyPath]=c.primaryKey:l._ROWID_=c.primaryKey,n.push(l)):4==b?n.push(c.value):
n.push([c.key,c.primaryKey,c.value]);if(n.length<f)c["continue"]();else m&&(m[0]=Ch(c.key),m[1]=Ch(c.primaryKey)),U(a,n)}else m&&(m[0]=void 0,m[1]=void 0),U(a,n)};H.onerror=function(b){b.preventDefault();U(a,H.error,!0)}};function Sj(a,b){this.g=b}D(Sj,Rj);Sj.prototype.i=P("ydn.db.core.req.IndexedDb");Sj.prototype.h=function(a,b,c,d){c=Z(this.g,c);return new Pj(a,b,c,d)};function Tj(){this.g=!1}Tj.prototype.g=!1;function Uj(a,b,c,d){yh.call(this,a,b,c,d);this.n=this.h=this.g=void 0;this.o=this.l=null;this.u=new Tj;this.Zb=this.W=null}D(Uj,yh);k=Uj.prototype;k.i=P("ydn.db.core.req.SimpleCursor");k.Nb=function(){return!!this.m};k.update=function(a){Vj(this.Zb,this.na(),a);return jb()};k.advance=function(a){function b(b){d++;if(!b||d>=a)return Wj(c,b)}var c=this,d=this.l?-1:0;this.reverse?Xj(this.W,b,this.l):Yj(this.W,b,this.l)};
k.Db=function(a){if(null!=a){var b=this,c=new $(a),d=function(c){b.l=c;if(!c)return Wj(b,c);var d=S(c.value.key,a);if(b.reverse){if(1!=d)return Wj(b,c)}else if(-1!=d)return Wj(b,c)};this.reverse?Xj(this.W,d,c):Yj(this.W,d,c)}else this.advance(1)};function Zj(a){setTimeout(function(){a.u.g?(a.u.g=!1,a.Oa(a.g,a.h,a.n),Zj(a)):(a.o(),a.o=null)},4)}
function Wj(a,b){if(a.l=b){var c=b.value;if(a.J)if(a.reverse||null==a.J.upper)a.reverse&&null!=a.J.lower&&(d=S(c.key,a.J.lower),-1==d||0==d&&a.J.lowerOpen)&&(a.l=null);else{var d=S(c.key,a.J.upper);if(1==d||0==d&&a.J.upperOpen)a.l=null}if(a.l){if(a.unique&&null!=a.g&&null!=c.key&&0==S(a.g,c.key))return;a.g=c.key;a.h=a.k?c.g:a.g;4==a.ca&&(a.kb?a.n=a.h:a.n=ak(a.Zb,a.h))}}a.l||(a.g=void 0,a.h=void 0,a.n=void 0);return a.u.g=!0}
k.openCursor=function(a,b){var c=null;if(this.J)if(this.reverse){var d=this.k?"\uffff":void 0;null!=this.J.upper&&(c=new $(this.J.upper,d))}else null!=this.J.lower&&(c=new $(this.J.lower));null!=a&&(c=this.k?new $(a,b):new $(a));this.o=this.m.A(function(b){function d(b){var e=b.value,f=e.key;if(b&&null!=f)if(null!=a){if(0==bk(c,e))return}else if(this.J&&(!this.reverse&&this.J.lowerOpen&&null!=this.J.lower&&(e=S(f,this.J.lower),0==e)||this.reverse&&this.J.upperOpen&&null!=this.J.upper&&(e=S(f,this.J.upper),
0==e)))return;return Wj(this,b)}this.Zb=ck(b,this.w);this.W=dk(this.Zb,this.ua);this.reverse?Xj(this.W,B(d,this),c):Yj(this.W,B(d,this),c);Zj(this)},this)};k.clear=function(){throw new zc;};k.toString=function(){return"Simple"+Uj.q.toString.call(this)};function ek(a,b,c){a=["ydn.db",a];t(b)&&(a.push(b),t(c)&&(a.push(c),t(void 0)&&a.push(kh(void 0))));return a.join("^|")};function $(a,b){this.key=a;this.g=b}$.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(null!=this.g?", "+this.g+")":")")};function bk(a,b){var c=S(a.key,b.key);return 0===c?null!=a.g?null!=b.g?S(a.g,b.g):1:null!=b.g?-1:0:c};function fk(a){this.ea=a||gk}function gk(a,b){return String(a)<String(b)?-1:String(a)>String(b)?1:0}k=fk.prototype;k.V=null;k.ea=null;k.ya=null;k.wa=null;
k.add=function(a){if(null==this.V)return this.wa=this.ya=this.V=new hk(a),!0;var b=null;ik(this,function(c){var d=null;0<this.ea(c.value,a)?(d=c.left,null==c.left&&(b=new hk(a,c),c.left=b,c==this.ya&&(this.ya=b))):0>this.ea(c.value,a)&&(d=c.right,null==c.right&&(b=new hk(a,c),c.right=b,c==this.wa&&(this.wa=b)));return d});b&&(ik(this,function(a){a.count++;return a.parent},b.parent),jk(this,b.parent));return!!b};
k.remove=function(a){var b=null;ik(this,function(c){var d=null;0<this.ea(c.value,a)?d=c.left:0>this.ea(c.value,a)?d=c.right:(b=c.value,kk(this,c));return d});return b};k.clear=function(){this.wa=this.ya=this.V=null};k.contains=function(a){var b=!1;ik(this,function(c){var d=null;0<this.ea(c.value,a)?d=c.left:0>this.ea(c.value,a)?d=c.right:b=!0;return d});return b};k.K=function(){return this.V?this.V.count:0};k.U=function(){var a=[];lk(this,function(b){a.push(b)});return a};
function lk(a,b){if(a.V){var c,d=c=mk(a);for(c=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=c&&d.right!=c)d=d.left;else{if(d.right!=c&&b(d.value))break;var e=d,d=null!=d.right&&d.right!=c?d.right:d.parent;c=e}}}function ik(a,b,c){for(c=c?c:a.V;c&&null!=c;)c=b.call(a,c)}
function jk(a,b){ik(a,function(a){var b=a.left?a.left.height:0,e=a.right?a.right.height:0;1<b-e?(a.left.right&&(!a.left.left||a.left.left.height<a.left.right.height)&&nk(this,a.left),ok(this,a)):1<e-b&&(a.right.left&&(!a.right.right||a.right.right.height<a.right.left.height)&&ok(this,a.right),nk(this,a));b=a.left?a.left.height:0;e=a.right?a.right.height:0;a.height=Math.max(b,e)+1;return a.parent},b)}
function nk(a,b){pk(b)?(b.parent.left=b.right,b.right.parent=b.parent):qk(b)?(b.parent.right=b.right,b.right.parent=b.parent):(a.V=b.right,a.V.parent=null);var c=b.right;b.right=b.right.left;null!=b.right&&(b.right.parent=b);c.left=b;b.parent=c;c.count=b.count;b.count-=(c.right?c.right.count:0)+1}
function ok(a,b){pk(b)?(b.parent.left=b.left,b.left.parent=b.parent):qk(b)?(b.parent.right=b.left,b.left.parent=b.parent):(a.V=b.left,a.V.parent=null);var c=b.left;b.left=b.left.right;null!=b.left&&(b.left.parent=b);c.right=b;b.parent=c;c.count=b.count;b.count-=(c.left?c.left.count:0)+1}
function kk(a,b){if(null!=b.left||null!=b.right){var c=null,d;if(null!=b.left){d=rk(a,b.left);ik(a,function(a){a.count--;return a.parent},d);if(d!=b.left){if(d.parent.right=d.left)d.left.parent=d.parent;d.left=b.left;d.left.parent=d;c=d.parent}d.parent=b.parent;d.right=b.right;d.right&&(d.right.parent=d);b==a.wa&&(a.wa=d)}else{d=mk(a,b.right);ik(a,function(a){a.count--;return a.parent},d);if(d!=b.right){if(d.parent.left=d.right)d.right.parent=d.parent;d.right=b.right;d.right.parent=d;c=d.parent}d.parent=
b.parent;d.left=b.left;d.left&&(d.left.parent=d);b==a.ya&&(a.ya=d)}d.count=b.count;pk(b)?b.parent.left=d:qk(b)?b.parent.right=d:a.V=d;jk(a,c?c:d)}else ik(a,function(a){a.count--;return a.parent},b.parent),pk(b)?(b.parent.left=null,b==a.ya&&(a.ya=b.parent),jk(a,b.parent)):qk(b)?(b.parent.right=null,b==a.wa&&(a.wa=b.parent),jk(a,b.parent)):a.clear()}function mk(a,b){if(!b)return a.ya;var c=b;ik(a,function(a){var b=null;a.left&&(b=c=a.left);return b},b);return c}
function rk(a,b){if(!b)return a.wa;var c=b;ik(a,function(a){var b=null;a.right&&(b=c=a.right);return b},b);return c}function hk(a,b){this.value=a;this.parent=b?b:null;this.count=1}hk.prototype.left=null;hk.prototype.right=null;hk.prototype.height=1;function qk(a){return!!a.parent&&a.parent.right==a}function pk(a){return!!a.parent&&a.parent.left==a};function sk(a){this.ea=a||gk}D(sk,fk);function Yj(a,b,c){if(a.V){var d;if(c instanceof hk)d=c;else if(c){if(ik(a,function(a){var b=null;0<this.ea(a.value,c)?(b=a.left,d=a):0>this.ea(a.value,c)?b=a.right:d=a;return b}),!d)return}else d=mk(a);a=d;for(var e=d.left?d.left:d;null!=a;)if(null!=a.left&&a.left!=e&&a.right!=e)a=a.left;else{if(a.right!=e&&b(a))return;var f=a;a=null!=a.right&&a.right!=e?a.right:a.parent;e=f}b(null)}}
function Xj(a,b,c){if(a.V){var d;if(c instanceof hk)d=c;else if(c){if(ik(a,B(function(a){var b=null;0<this.ea(a.value,c)?b=a.left:(0>this.ea(a.value,c)&&(b=a.right),d=a);return b},a)),!d)return}else d=rk(a);a=d;for(var e=d.right?d.right:d;null!=a;)if(null!=a.right&&a.right!=e&&a.left!=e)a=a.right;else{if(a.left!=e&&b(a))return;var f=a;a=null!=a.left&&a.left!=e?a.left:a.parent;e=f}b(null)}};function tk(a,b,c){this.l=a;this.storage=b;this.h=c;this.g={};a=this.h.keyPath;this.j=u(a)?a.join(","):a||"_ROWID_";this.g[this.j]=null;this.k=ek(this.l,this.h.getName(),this.j)+"^|"}
function dk(a,b){var c=b||a.j;if(!a.g[c]){a.g[c]=new sk(bk);for(var d=a.storage.length,e=0;e<d;e++){var f=a.storage.key(e);if(null!==f&&qa(f,a.k)){var g=nh(f.substr(a.k.length));if(c==a.j)a.g[c].add(new $(g));else{var h=a.storage.getItem(f);if(null!==h)if(f=Ah(a.h,c),h=If(h),h=cj(f,h),f.multiEntry){if(u(h))for(f=0;f<h.length;f++)a.g[c].add(new $(h[f],g))}else a.g[c].add(new $(h,g))}}}}return a.g[c]}
function uk(a,b,c){for(var d in a.g){var e=a.g[d];if(e)if(d==a.j)e.remove(new $(b));else{var f=Ah(a.h,d),f=hh(c,f.keyPath);e.remove(new $(b,f))}}}function vk(a){for(var b in a.g){var c=a.g[b];c&&c.clear()}a.g={}}
function Vj(a,b,c,d){if(null==b&&(a.h.keyPath&&(b=Ji(a.h,c)),a.h.h&&null==b)){b=a.k+kh(void 0);var e=If(a.storage.getItem(b));e.key_count||(e.key_count=0);e.key_count++;a.storage.setItem(b,Q(e));b=e.key_count}d&&(d=null!==a.storage.getItem(a.k+kh(b)));if(d)return null;a.storage.setItem(a.k+kh(b),Q(c));d=b;for(var f in a.g)if(e=a.g[f])if(f==a.j)e.add(new $(d));else{var g=Ah(a.h,f),g=hh(c,g.keyPath);null!=g&&e.add(new $(d,g))}return b}
function wk(a,b){var c=a.k+kh(b),d=a.storage.getItem(c);if(null===d)return 0;a.storage.removeItem(c);c=If(d);uk(a,b,c);return 1}tk.prototype.clear=function(){vk(this);xk(this)};function ak(a,b){var c=a.storage.getItem(a.k+kh(b)),d=void 0;if(null!==c)for(var d=If(c),c=0,e=a.h.indexes.length;c<e;c++){var f=a.h.index(c);if("DATE"==f.type){var g=cj(f,d);g&&dj(f,d,new Date(g))}}return d}tk.prototype.getName=function(){return this.h.getName()};
function yk(a,b,c){b=b||a.j;a=dk(a,b);var d=null,e=null,f=0,g=!1,h=!1;null!=c&&(null!=c.lower&&(d=new $(c.lower)),null!=c.upper&&(e=new $(c.upper)),g=c.lowerOpen,h=c.upperOpen);Yj(a,function(a){if(null!=a&&(a=a.value,!g||null==d||0!=S(a.key,d.key))){if(null!=e&&(a=S(a.key,e.key),1===a||0===a&&h))return!0;f++}},d);return f}
function xk(a,b){var c=dk(a,a.j),d=null,e=null,f=0,g=[],h=[],l=!1,m=!1;null!=b&&(null!=b.lower&&(d=new $(b.lower)),null!=b.upper&&(e=new $(b.upper)),l=b.lowerOpen,m=b.upperOpen);Yj(c,function(b){if(null!=b&&(b=b.value,!l||null==d||0!=bk(b,d))){if(null!=e){var c=bk(b,e);if(1===c||0===c&&m)return!0}var c=a.k+kh(b.key),q=a.storage.getItem(c);null!==q&&(a.storage.removeItem(c),f++,10>g.length&&(g.push(b.key),h.push(If(q))))}},d);if(10>g.length)for(c=0;c<g.length;c++)uk(a,g[c],h[c]);else vk(a);return f}
function zk(a,b,c,d,e,f,g,h,l){function m(c){if(c&&(G++,!(G<g))){var d=c.value;if(e){if(J&&null!=A&&(c=q?bk(d,A):S(d.key,A.key),0==c))return;if(null!=y&&(c=q?bk(d,y):S(d.key,y.key),-1==c||0==c&&H))return l&&(l[0]=void 0,l[1]=void 0),!0}else{if(H&&null!=y&&(c=q?bk(d,y):S(d.key,y.key),0==c))return;if(null!=A&&(c=q?bk(d,A):S(d.key,A.key),1==c||0==c&&J))return l&&(l[0]=void 0,l[1]=void 0),!0}c=d.key;if(!h||!s||null==p||0!=S(p,c)){d=s?d.g:c;if(2==b)n.push(d);else if(1==b)n.push(c);else if(3==b)n.push([c,
d]);else if(4==b){var m=ak(a,d);n.push(m)}else n.push([c,d,ak(a,d)]);l&&(l[0]=c,l[1]=d)}p=c;if(t(f)&&n.length>=f)return!0}}var n=[],p,q=!!l&&null!=l[0];c=c||a.j;var s=c!=a.j;c=dk(a,c);var y=null,A=null;t(g)||(g=0);var G=-1,H=!1,J=!1;null!=d&&(null!=d.lower&&(y=s&&e?new $(d.lower,"\uffff"):new $(d.lower)),null!=d.upper&&(A=s&&!e?new $(d.upper,"\uffff"):new $(d.upper)),H=!!d.lowerOpen,J=!!d.upperOpen);if(q){e?J=!0:H=!0;d=l[0];var O=t(l[1])?l[1]:"\uffff";e?A=s?new $(d,O):new $(d):y=s?new $(d,O):new $(d)}e?
Xj(c,m,A):Yj(c,m,y);return n}tk.prototype.aa=function(a,b,c,d,e){return zk(this,2,a,b,c,d,e)};tk.prototype.toString=function(){return"ydn.db.con.simple.Store:"+this.l+":"+this.h.getName()};function Ak(){this.clear()}k=Ak.prototype;k.qc=function(){return this};k.setItem=function(a,b){t(this.g[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.g[a]=b};k.getItem=function(a){return t(this.g[a])?this.g[a]:null};k.removeItem=function(a){delete this.g[a];Va(this.keys,a.toString());this.length=this.keys.length};k.length=0;k.key=function(a){a=this.keys[a];return t(a)?this.g[a]:null};k.clear=function(){this.g={};this.keys=[];this.length=0};function Bk(a){this.m=a||new Ak;this.l={}}function ck(a,b){var c=Z(a.g,b);if(c)a.l[b]||(a.l[b]=new tk(a.j,a.k,c));else throw new Bc('store name "'+b+'" not found.');return a.l[b]}Bk.prototype.za=function(a){var b=this;setTimeout(function(){var c=ek(b.j),c=b.k.getItem(c),c=new vj(c);a(c)},10)};function Ck(a,b){this.h=a;this.g=b}Ck.prototype.A=function(a,b){var c=this.h;setTimeout(function(){a.call(b,c)},4);var d=this;return function(){d.g("complete",null);d.g=null;d.h=null}};function Dk(a,b){this.g=b}D(Dk,di);k=Dk.prototype;k.i=P("ydn.db.crud.req.SimpleStore");k.Tb=function(a,b,c){this.la(a,!0,!1,null,b,c)};
k.la=function(a,b,c,d,e,f){N(this.i,W(a)+" "+(b?"put":"add")+"Object"+(c?"":"s "+e.length+" objects"));var g=a.g.A(function(h){var l;if(c)l=ck(h,d),h=f?f[0]:void 0,h=Vj(l,h,e[0],!b),null!=h?U(a,h):(l=Jf(h),l=new Th(l),U(a,l,!0));else{for(var m=d,n=[],p=!1,q=f||{},s=0;s<e.length;s++){var y;d?y=q[s]:(m=f[s],y=m.id,m=m.w);l&&l.getName()==m||(l=ck(h,m));y=Vj(l,y,e[s],!b);null!=y?n.push(y):(p=!0,n.push(new Th))}U(a,n,p)}g();g=null},this)};k.Lc=function(){throw new zc("putData");};
k.Ib=function(a,b,c){var d=a.g.A(function(e){e=ak(ck(e,b),c);U(a,e);d();d=null},this)};function Ek(a,b,c,d){var e=b.g.A(function(a){for(var g=[],h=c,l,m=0;m<d.length;m++){var n=d[m];n instanceof X&&(h=n,n=h.id,h=h.w);l&&l.getName()==h||(l=ck(a,h));n=ak(l,n);g[m]=n}U(b,g,!1);e();e=null},a)}k.Hc=function(a,b,c){Ek(this,a,b,c)};k.Pb=function(a,b){Ek(this,a,null,b)};
k.Vb=function(a,b,c){var d=W(a)+" removeById "+b+" "+c;N(this.i,d);var e=this,f=a.g.A(function(g){g=wk(ck(g,b),c);M(e.i,"success "+d+(0==g?" [not found]":""));U(a,g);f();f=null},this)};k.Xb=function(a,b){N(this.i,W(a)+" removeByKeys "+b.length+" keys");var c,d=0,e=a.g.A(function(f){for(var g=0;g<b.length;g++){var h=b[g].w,l=b[g].id;c&&c.getName()==h||(c=ck(f,h));d+=wk(c,l)}U(a,d);e();e=null},this)};k.oc=function(a,b,c){this.Wb(a,b,c)};
k.Wb=function(a,b,c){var d=W(a)+" removeByKeyRange "+(c?Q(c):"");N(this.i,d);var e=this,f=a.g.A(function(g){g=xk(ck(g,b),c);M(e.i,d+" deleted "+g+" records.");U(a,g);f();f=null},this)};k.Mc=function(a,b,c,d){var e=W(a)+" removeByIndexKeyRange "+(d?Q(d):"");N(this.i,e);var f=a.g.A(function(e){e=ck(e,b);for(var h=e.aa(c,d),l=h.length,m=0;m<l;m++)wk(e,h[m]);U(a,l);f();f=null},this)};
k.Bb=function(a,b){var c=W(a)+" clearByStores";N(this.i,c);var d=a.g.A(function(e){for(var f=0;f<b.length;f++)ck(e,b[f]).clear();M(this.i,"success "+c);U(a,b.length);d();d=null},this)};k.Fb=function(a,b){var c=a.g.A(function(d){for(var e=[],f=0;f<b.length;f++){var g=ck(d,b[f]);e.push(yk(g))}U(a,e);c();c=null},this)};
k.ib=function(a,b,c,d){var e=W(a)+" count"+(null!=d?"Index":"")+(null!=c?"KeyRange":"Store");N(this.i,e);var f=a.g.A(function(g){g=yk(ck(g,b),d,c);M(this.i,"success "+e);U(a,g);f();f=null},this)};k.list=function(a,b,c,d,e,f,g,h,l,m){var n=W(a)+" "+c+" "+(e?Jf(e):"");N(this.i,n);var p=a.g.A(function(q){q=zk(ck(q,c),b,d,e,h,f,g,l,m);M(this.i,n+" "+q.length+" records found.");U(a,q);p();p=null},this)};function Fk(a,b){this.g=b}D(Fk,Dk);Fk.prototype.h=function(a,b,c,d){c=Z(this.g,c);return new Uj(a,b,c,d)};function Gk(a,b,c,d){yh.call(this,a,b,c,d);this.u=null;this.o=this.l=void 0}D(Gk,yh);k=Gk.prototype;k.i=P("ydn.db.core.req.WebsqlCursor");k.na=function(){return this.o};k.init=function(a,b,c,d,e){Gk.q.init.call(this,a,b,c,d,e);this.u=w(b)?Ah(this.j,b):null};k.ic=function(){return this.N};
k.Cb=function(a){this.N=this.o=this.l=void 0;if(t(a))if(z(a)){var b=ej(a[this.j.l],this.j.type);this.o=b;if(this.k){var c=Ah(this.j,this.ua);this.l=ej(a[this.ua],c.type)}else this.l=b;this.N=this.kb?b:Hk(a,this.j)}else this.N=a};
function Ik(a,b,c,d,e,f){var g=!d;d=[];a.k&&null!=f&&null!=c?c=nj(a.j,a.ca,d,a.u.getName(),a.J,c,g,f,a.reverse,a.unique):null!=c?(f=a.u?a.u.getName():null,c=mj(a.j,a.ca,d,f,a.J,a.reverse,a.unique,c,g)):(c=jj(a.j,d,a.ca,a.k?a.u.k:a.j.l,a.J,a.reverse,a.unique),a.k&&(c+=", "+a.j.k+" ASC"));c+=" LIMIT 1";0<e&&(c+=" OFFSET "+e);N(a.i,a+": continue:  SQL: "+c+" : "+Q(d));a.m.executeSql(c,d,function(c,d){0<d.rows.length?a.Cb(d.rows.item(0)):a.Cb();b.call(a,a.l,a.o,a.N);b=null},function(c,d){K(a.i,"get error: "+
d.message);a.H(d);Bh(a);a.G=!0;a.Cb();b.call(a,a.o,a.l,a.N);b=null;return!1})}k.Nb=function(){return!!this.m};k.update=function(a){if(!this.Nb())throw new Xh;var b=new E,c=this.na();a=qj(this.j,a,c);var d="REPLACE INTO "+lj(this.j)+" ("+a.ad.join(", ")+") VALUES ("+a.od.join(", ")+")";N(this.i,this+': update "'+d+'" : '+Q(a.values));this.m.executeSql(d,a.values,function(){b.p(c)},function(a,c){b.s(c);return!1});return b};
k.advance=function(a){var b=this.l,c=this.o,d=!0;null==this.l||this.k&&null==this.o||(a-=1,d=!1);Ik(this,function(a,d,g){var h=null!=b&&null!=a&&0==S(b,a);if(this.k){var l=null!=d&&null!=c&&0==S(d,c);if(h&&l)throw new Bc("current: "+b+";"+c+" next: "+a+";"+d);}else if(h)throw new Bc("current: "+b+" next: "+a);this.Oa(a,d,g)},this.l,d,a,this.o)};k.Db=function(a){null!=a?Ik(this,this.Oa,a,!0):this.advance(1)};k.openCursor=function(a,b){Ik(this,this.Oa,a,!1,0,b)};
k.clear=function(){if(!this.Nb())throw new Xh;var a=new E,b=this.j.l,b="DELETE FROM "+lj(this.j)+" WHERE "+b+" = ?",c=[this.na()];N(this.i,this+': clear "'+b+'" : '+Q(c));this.m.executeSql(b,c,function(b,c){a.p(c.rowsAffected)},function(b,c){a.s(c);return!1});return a};k.toString=function(){return"WebSql"+Gk.q.toString.call(this)};function Jk(a,b){this.g=b}D(Jk,di);k=Jk.prototype;k.i=P("ydn.db.crud.req.WebSql");
function Hk(a,b){if(b.Ta&&!b.keyPath&&0==b.indexes.length&&a._default_){var c=a._default_;if(-1==c.indexOf(";base64,"))return If(c);'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substr(1,c.length-2));for(var d=c.split(";base64,"),c=d[0].split(":")[1],d=window.atob(d[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f.buffer],{type:c})}c=a._default_?If(a._default_):{};null!=b.keyPath&&(d=ej(a[b.keyPath],b.type),null!=d&&Mi(b,c,d));for(d=0;d<b.indexes.length;d++)e=
b.index(d),f=e.k,"_default_"==f||e.m||e.multiEntry||"DATE"!=e.type&&!b.Ta||(f=ej(a[f],e.type),t(f)&&dj(e,c,f));return c}k.Lc=function(){throw new zc("putData");};
k.la=function(a,b,c,d,e,f){function g(b,d){if(null==e[b])if(N(m.i,"empty object at "+b+" of "+e.length),p++,p==e.length)M(m.i,q+" success "+q),U(a,n,s);else{var G=b+2;G<e.length&&g(G,d)}var H;H=t(f)?qj(h,e[b],f[b]):qj(h,e[b]);G=l+lj(h)+" ("+H.ad.join(", ")+") VALUES ("+H.od.join(", ")+");";N(m.i,W(a)+" SQL: "+G+" PARAMS: "+H.values+" REQ: "+b+" of "+e.length);d.executeSql(G,H.values,function(f,q){function G(b,c){var e="ydn.db.me:"+h.getName()+":"+b.getName(),e=l+Ga(e)+" ("+h.k+", "+b.j+") VALUES (?, ?)",
f=[gh(ka,h.type),gh(c,b.type)];N(m.i,W(a)+" multiEntry "+e+" "+f);d.executeSql(e,f,function(){},function(a,b){K(m.i,"multiEntry index insert error: "+b.message);return!1})}p++;var ka=t(H.key)?H.key:q.insertId;1>q.rowsAffected&&(s=!0,ka=new Th(ka+" no-op"));for(var tb=0,Of=h.indexes.length;tb<Of;tb++){var Ob=h.index(tb);if(Ob.multiEntry)for(var rc=hh(e[b],Ob.keyPath),Pn=(rc?rc.length:0)||0,hi=0;hi<Pn;hi++)G(Ob,rc[hi])}c?U(a,ka):(n[b]=ka,p==e.length?U(a,n,s):(tb=b+2,tb<e.length&&g(tb,f)))},function(d,
f){p++;s=!0;6==f.code?f.name="ConstraintError":K(m.i,"error: "+f.message+" "+q);if(c)U(a,f,!0);else if(n[b]=f,p==e.length)N(m.i,"success "+q),U(a,n,s);else{var h=b+2;h<e.length&&g(h,d)}return!1})}b=!b;var h=Z(this.g,d),l=b?"INSERT INTO ":"INSERT OR REPLACE INTO ";d=a.g;var m=this,n=[],p=0,q=W(a)+" inserting "+e.length+" objects.",s=!1;if(0<e.length)for(b=0;2>b&&b<e.length;b++)g(b,d);else M(this.i,"success"),U(a,[])};
k.Tb=function(a,b,c){if(0==c.length)U(a,[]);else{for(var d=[],e=0,f=0,g=this,h=function(h,l){var m=[];N(g.i,"put "+l.length+" objects to "+h);for(var n=pj(Z(g.g,h)),p=n?void 0:[],q=0;q<l.length;q++)m.push(b[l[q]]),n||p.push(c[l[q]].id);n=Oh(a);n.t(function(b){for(var c=0;c<l.length;c++)d[l[c]]=b[c];e++;e==f&&U(a,d)},function(){e++;e==f&&U(a,d,!0)});g.la(n,!1,!1,h,m,p)},l="",m=[],n=[],p=0;p<c.length;p++){var q=c[p].w,s=c[p].id;q!=l?(f++,0<m.length&&h(l,m),m=[p],n=[s],l=q):(m.push(p),n.push(s))}0<m.length&&
h(l,m)}};k.Ib=function(a,b,c){var d=a.g,e=Z(this.g,b),f=this;b=e.k;c=[gh(c,e.type)];b="SELECT * FROM "+lj(e)+" WHERE "+b+" = ?";var g=W(a)+" SQL: "+b+" PARAMS: "+c;N(this.i,g);d.executeSql(b,c,function(b,c){if(0<c.rows.length){var d=c.rows.item(0);null!=d?(d=Hk(d,e),U(a,d)):(M(f.i,"success no result: "+g),U(a,void 0))}else M(f.i,"success no result: "+g),U(a,void 0)},function(b,c){K(f.i,"error: "+g+" "+c.message);U(a,c,!0);return!1})};
k.Hc=function(a,b,c){function d(b,e){var p=l.k,q=[gh(c[b],l.type)],s="SELECT * FROM "+lj(l)+" WHERE "+p+" = ?";N(f.i,"SQL: "+s+" PARAMS: "+q);e.executeSql(s,q,function(e,f){h++;if(0<f.rows.length){var n=f.rows.item(0);null!=n&&(g[b]=Hk(n,l))}else g[b]=void 0;h==c.length?U(a,g):(n=b+10,n<c.length&&d(n,e))},function(e,l){h++;K(f.i,"error: "+s+" "+l.message);if(h==c.length)U(a,g);else{var n=b+10;n<c.length&&d(n,e)}return!1})}var e=a.g,f=this,g=[],h=0,l=Z(this.g,b);if(0<c.length)for(b=0;10>b&&b<c.length;b++)d(b,
e);else M(f.i,"success"),U(a,[])};
k.Pb=function(a,b){function c(d,h){var n=b[d],p=Z(e.g,n.w),q=ci(n),n=p.k,q=[gh(q,p.type)],s="SELECT * FROM "+lj(p)+" WHERE "+n+" = ?";N(e.i,"SQL: "+s+" PARAMS: "+q);h.executeSql(s,q,function(h,m){g++;if(0<m.rows.length){var n=m.rows.item(0);null!=n&&(f[d]=Hk(n,p))}else f[d]=void 0;g==b.length?(N(e.i,"success "+s),U(a,f)):(n=d+10,n<b.length&&c(n,h))},function(b,c){U(a,c,!0);return!1})}var d=a.g,e=this,f=[],g=0;if(0<b.length)for(var h=0;10>h&&h<b.length;h++)c(h,d);else N(this.i,"success"),U(a,[])};
k.Bb=function(a,b){function c(d,g){function h(a){a="ydn.db.me:"+l.getName()+":"+a.getName();a="DELETE FROM  "+Ga(a);N(e.i,"SQL: "+a);g.executeSql(a,[])}var l=Z(e.g,b[d]),m="DELETE FROM  "+lj(l);N(e.i,"SQL: "+m+" PARAMS: []");g.executeSql(m,[],function(g){d==b.length-1?(N(e.i,"success "+m),U(a,b.length)):c(d+1,g)},function(b,c){U(a,c,!0);return!1});for(var n=0,p=l.indexes.length;n<p;n++){var q=l.index(n);q.multiEntry&&h(q)}}var d=a.g,e=this;0<b.length?c(0,d):(N(this.i,"success"),U(a,0))};
k.Xb=function(a,b){function c(h){if(h>=b.length)U(a,f,g);else{var l=Z(e.g,b[h].w),m=gh(b[h].id,l.type),n=" WHERE "+l.k+" = ?",p="DELETE FROM "+lj(l)+n,q=W(a)+" SQL: "+p+" PARAMS: "+[m];d.executeSql(p,[m],function(){f++;c(h)},function(a,b){K(e.i,"error: "+q+b.message);g=!0;c(h);return!1});h++;for(var p=function(b){b="ydn.db.me:"+l.getName()+":"+b.getName();b="DELETE FROM  "+Ga(b)+n;N(e.i,W(a)+NaN+b);d.executeSql(b,[m])},s=0,y=l.indexes.length;s<y;s++){var A=l.index(s);A.multiEntry&&p(A)}}}var d=a.g,
e=this,f=0,g=!1;N(this.i,W(a)+" removeByKeys: "+b.length+" keys");c(0)};
k.Vb=function(a,b,c){function d(b){b="ydn.db.me:"+f.getName()+":"+b.getName();b="DELETE FROM  "+Ga(b)+l;N(h.i,W(a)+NaN+b);e.executeSql(b,[g])}var e=a.g,f=Z(this.g,b),g=gh(c,f.type),h=this,l=" WHERE "+f.k+" = ?";b="DELETE FROM "+lj(f)+l;N(this.i,W(a)+" SQL: "+b+" PARAMS: "+[g]);e.executeSql(b,[g],function(b,c){U(a,c.rowsAffected)},function(b,c){U(a,c,!0);return!1});b=0;for(c=f.indexes.length;b<c;b++){var m=f.index(b);m.multiEntry&&d(m)}};k.oc=function(a,b,c){Kk(this,a,b,void 0,c)};
k.Wb=function(a,b,c){Kk(this,a,b,void 0,c)};k.Mc=function(a,b,c,d){Kk(this,a,b,c,d)};
function Kk(a,b,c,d,e){function f(c){c="ydn.db.me:"+h.getName()+":"+c.getName();c="DELETE FROM  "+Ga(c)+n;N(a.i,W(b)+NaN+c);g.executeSql(c,m)}var g=b.g,h=Z(a.g,c);c="DELETE FROM "+lj(h);var l=[],m=[],n="";null!=e&&(t(d)?(d=Ah(h,d),fh(d.j,d.type,e,m,l)):fh(h.k,h.type,e,m,l),n=" WHERE "+m.join(" AND "));c+=n;var p=W(b)+" SQL: "+c+" PARAMS: "+l;N(a.i,p);g.executeSql(c,l,function(c,d){N(a.i,"success "+p);U(b,d.rowsAffected)},function(c,d){K(a.i,"error: "+p+d.message);U(b,d,!0);return!1});e=0;for(d=h.indexes.length;e<
d;e++)c=h.index(e),c.multiEntry&&f(c)}k.Fb=function(a,b){function c(g){var h="SELECT COUNT(*) FROM "+Ga(b[g]);N(e.i,"SQL: "+h+" PARAMS: []");d.executeSql(h,[],function(d,e){var h=e.rows.item(0);f[g]=parseInt(h["COUNT(*)"],10);g++;g==b.length?U(a,f):c(g)},function(b,c){U(a,c,!0);return!1})}var d=a.g,e=this,f=[];0==b.length?(N(this.i,"success"),U(a,0)):c(0)};
k.ib=function(a,b,c,d,e){var f=[];b=jj(Z(this.g,b),f,6,d,c,!1,e);N(this.i,W(a)+" SQL: "+b+" PARAMS: "+f);a.g.executeSql(b,f,function(b,c){var d=c.rows.item(0);U(a,yj(d))},function(b,c){U(a,c,!0);return!1})};
k.list=function(a,b,c,d,e,f,g,h,l,m){var n=this,p=[],q=Z(this.g,c),s=q.l,y=q.type,A=y,G=null!=d&&d!==s?Ah(q,d):null,H=d||s;G&&(A=G.type);c=[];if(m&&t(m[0])){var J=m[0];G&&t(m[1])?(d=m[1],e=nj(q,b,c,G.getName(),e,J,!0,d,h,l)):e=mj(q,b,c,d,e,h,l,J,!0)}else e=jj(q,c,b,H,e,h,l);x(f)&&(e+=" LIMIT "+f);x(g)&&(e+=" OFFSET "+g);var O=a+" SQL: "+e+" ;params= "+Q(c);N(this.i,O);a.g.executeSql(e,c,function(c,d){for(var e=d.rows.length,f,g=0;g<e;g++)f=d.rows.item(g),2==b?p[g]=ej(f[s],y):1==b?p[g]=ej(f[H],A):
3==b?p[g]=[ej(f[H],A),ej(f[s],y)]:null!=f&&(p[g]=Hk(f,q));M(n.i,"success "+a);m&&f&&(m[0]=ej(f[H],A),m[1]=ej(f[s],y));U(a,p)},function(b,c){K(n.i,"error: "+O+c.message);U(a,c,!0);return!1})};function Lk(a,b){this.g=b}D(Lk,Jk);Lk.prototype.i=P("ydn.db.core.req.WebSql");Lk.prototype.h=function(a,b,c,d){c=Z(this.g,c);return new Gk(a,b,c,d)};Oj.prototype.u=function(){var a=ii(this);if("indexeddb"==a)return new Sj(0,this.h);if("websql"==a)return new Lk(0,this.h);if("memory"==a||"localstorage"==a||"userdata"==a||"sessionstorage"==a)return new Fk(0,this.h);throw new Bc("No executor for "+a);};function Mk(a){if(!w(a)||!/[\w\+]+@\w+\.\w+/.test(a))return null;a=a.toLowerCase();return a=a.replace(/\+\w*?@/,"@")};function Nk(a){if(!w(a))throw new Pf;this.ha=a;this.k=T;this.g=[];Ok(this,a);this.pb=""}k=Nk.prototype;k.ha="";k.jd=NaN;k.kd=NaN;k.Rc=!1;k.pb="";
function Ok(a,b){var c=b.split(/\sFROM\s/i);if(2==c.length){var d=c[1],c=c[0].match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i);if(3==c.length){a.l=c[1].toUpperCase();if("SELECT"==a.l)a.k=vh;else if("INSERT"==a.l)a.k=T;else if("UPDATE"==a.l)a.k=T;else if("DELETE"==a.l)a.k=T;else return;var c=c[2].trim(),e=c.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);e?(a.j=e[0].toUpperCase(),c=c.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):a.j=void 0;"("==c.charAt(0)&&(")"==c.charAt(c.length-1)?c=c.substring(1,c.length-
1):new ai("missing closing parentheses"));a.u=c;c=d.search(/(ORDER BY|LIMIT|OFFSET)/i);0<c?(a.h=d.substring(c),d=d.substring(0,c)):a.h="";c=d.search(/WHERE/i);0<c?(a.m=d.substring(c+6).trim(),d=d.substring(0,c)):a.m="";a.g=d.trim().split(",").map(function(a){a=Da(a,'"');a=Da(a,"'");return a.trim()})}}}
k.parse=function(a){if(a){for(var b=0;b<a.length;b++)this.ha=this.ha.replace("?",a[b]);Ok(this,this.ha)}this.n=Pk(this);if(!this.n)return this.pb;a=this.h.length;if(b=/OFFSET\s+(\d+)/i.exec(this.h))this.kd=parseInt(b[1],10),a=this.h.search(/OFFSET/i);if(b=/LIMIT\s+(\d+)/i.exec(this.h))this.jd=parseInt(b[1],10),b=this.h.search(/LIMIT/i),b<a&&(a=b);(a=/ORDER BY\s+(.+)/i.exec(this.h.substr(0,a)))?(a=a[1].trim(),(b=a.match(/(ASC|DESC)/i))?(this.Rc="DESC"==b[0].toUpperCase(),a=a.replace(/\s+(ASC|DESC)/i,
"")):this.Rc=!1,this.o=Da(Da(a,'"'),"'")):this.o=void 0;return""};function Qk(a){if("*"==a.u)return null;a=a.u.split(",");return a=a.map(function(a){return Da(a.trim(),'"')})}k.toJSON=function(){return{sql:this.ha}};
function Pk(a){function b(a){return Sa(c,function(b){return b.Ka==a})}var c=[],d=/(.+?)(<=|>=|=|>|<)(.+)/i;if(0<a.m.length)for(var e=a.m.split("AND"),f=0;f<e.length;f++){var g=e[f],h=d.exec(g);if(h){var l=h[1].trim(),l=Da(l,'"'),l=Da(l,"'");if(0<l.length){var m=h[3].trim();qa(m,'"')?m=Da(m,'"'):qa(m,"'")?m=Da(m,"'"):m=parseFloat(m);h=new sh(l,h[2],m);l=b(l);if(0<=l){if(c[l]=c[l].nc(h),!c[l])return a.pb='where clause "'+g+'" conflict',null}else c.push(h)}else return a.pb='Invalid clause "'+g+'"',null}else return a.pb=
'Invalid clause "'+g+'"',null}return c}k.toString=function(){return"query:"+this.ha};function Rk(a,b){this.g=b;this.h=a}Rk.prototype.i=P("ydn.db.sql.req.nosql.Node");Rk.prototype.toJSON=function(){return{sql:this.g}};Rk.prototype.toString=function(){return"idb.Node:"};
Rk.prototype.execute=function(a,b){var c=Xa(this.g.g)[0],d=this.g.n,e=this.g.jd,e=isNaN(e)?100:e,f=this.g.kd,f=isNaN(f)?0:f,g=this.g.o,h=Qk(this.g),l=null,m=this.g.Rc;if(0==d.length)l=null;else if(1==d.length)l=ah(d[0].g);else throw new yc("too many conditions.");null===h||Qh(a,function(a,b,c){var d=a;b||(d=a.map(function(a){var b=h.length;if(1==b)return hh(a,h[0]);for(var c={},d=0;d<b;d++)c[h[d]]=hh(a,h[d]);return c}));c(d,b)});var d=0<d.length?d[0].Ka:void 0,n=W(a)+" executing on"+c;d&&(n+=":"+
d);n+=" "+eh(l);M(this.i,n);g&&g!=this.h.keyPath?b.list(a,4,c,g,l,e,f,m,!1):t(d)&&d!=this.h.keyPath?b.list(a,4,c,d,l,e,f,m,!1):b.list(a,4,c,null,l,e,f,m,!1)};function Sk(a,b){Rk.call(this,a,b)}D(Sk,Rk);
Sk.prototype.execute=function(a,b){var c,d=Xa(this.g.g)[0],e=this.g.n,f=null;if(0==e.length)f=null;else if(1==e.length)f=ah(e[0].g);else throw new yc("too many conditions.");var g=this.g.j,e=0<e.length?e[0].Ka:void 0,h=W(a)+" executing "+g+" on "+d;e&&(h+=":"+e);h+=" "+eh(f);M(this.i,h);if("COUNT"==g)f?b.ib(a,d,f,e,!1):b.ib(a,d,null,void 0,!1);else{var l,h=Qk(this.g);if(!h||0==h.length)throw new Vf("field name require for reduce operation: "+g);h=h[0];if("MIN"==g)l=Tk(h);else if("MAX"==g)l=Uk(h);
else if("AVG"==g)c=0,l=Vk(h);else if("SUM"==g)c=0,l=Wk(h);else throw new Qf(g);var m;t(e)?m=new Jh(d,e,f):m=new Ih(d,f);var d=b.h(a.g,W(a),d,4),n=m.load([d]);n.H=function(b){U(a,b,!0)};var p=0;n.B=function(b){null!=b?(b=m.h?n.na():n.ic(),c=l(b,c,p),n.advance(1),p++):U(a,c)}}};function Vk(a){return function(b,c,d){t(c)||(c=0);return(c*d+b[a])/(d+1)}}function Wk(a){return function(b,c){return c+b[a]}}function Tk(a){return function(b,c){var d=b[a];return t(c)?c<d?c:d:d}}
function Uk(a){return function(b,c){var d=b[a];return t(c)?c>d?c:d:d}};function Xk(a,b){this.g=b}D(Xk,Sj);Xk.prototype.i=P("ydn.db.sql.req.IndexedDb");Xk.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new ai(c);c=Xa(b.g);if(1==c.length){var d=Z(this.g,c[0]);if(!d)throw new Yh(c[0]);var e=Qk(b);if(e)for(var f=0;f<e.length;f++)if(!Fi(d,e[f]))throw new Yh('Index "'+e[f]+'" not found in '+c[0]);var g;b.j?g=new Sk(d,b):g=new Rk(d,b);g.execute(a,this)}else throw new Qf(b.ha);};function Yk(a,b){this.h=b;this.j=a;this.g=Qk(b)}Yk.prototype.i=P("ydn.db.sql.req.websql.Node");Yk.prototype.toJSON=function(){return{sql:this.h.ha}};Yk.prototype.toString=function(){return"websql.Node:"};function Zk(a,b){if(a.g){if(1==a.g.length){if(z(b))return Zb(b,a.g[0]);return}for(var c={},d=0;d<a.g.length;d++)c[a.g[d]]=Zb(b,a.g[d]);return c}return Hk(b,a.j)}
Yk.prototype.execute=function(a,b,c){var d=this,e=[];b.executeSql(this.h.ha,c,function(b,c){for(var h=c.rows.length,l=0;l<h;l++){var m=c.rows.item(l);if(z(m))var n=Zk(d,m);e.push(n)}a(e)},function(b,c){K(d.i,"Sqlite error: "+c.message);a(c,!0);return!0})};function $k(a,b){Yk.call(this,a,b)}D($k,Yk);$k.prototype.execute=function(a,b,c){var d=this;b.executeSql(this.h.ha,c,function(b,c){var d=c.rows.length;if(1==d)d=yj(c.rows.item(0)),a(d);else if(0==d)a(void 0);else throw new Wh;},function(b,c){K(d.i,"Sqlite error: "+c.message);a(c,!0);return!0})};function al(a,b){this.g=b}D(al,Lk);al.prototype.i=P("ydn.db.sql.req.WebSql");al.prototype.executeSql=function(a,b,c){var d=Xa(b.g);if(1==d.length){var e=Z(this.g,d[0]);if(!e)throw new Yh(d[0]);var f=Qk(b);if(f)for(var g=0;g<f.length;g++)if(!Fi(e,f[g]))throw new Yh('Index "'+f[g]+'" not found in '+d[0]);var h;b.j?h=new $k(e,b):h=new Yk(e,b);h.execute(function(b,c){U(a,b,c)},a.g,c)}else throw new Qf(b.ha);};function bl(a,b){this.g=b}D(bl,Fk);bl.prototype.i=P("ydn.db.sql.req.SimpleStore");bl.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new ai(c);c=Xa(b.g);if(1==c.length){var d=Z(this.g,c[0]);if(!d)throw new Yh(c[0]);var e=Qk(b);if(e)for(var f=0;f<e.length;f++)if(!Fi(d,e[f]))throw new I('Index "'+e[f]+'" not found in '+c[0]);var g;b.j?g=new Sk(d,b):g=new Rk(d,b);g.execute(a,this)}else throw new yc(b.ha);};function cl(a,b,c,d){ti.call(this,a,b,c,d)}D(cl,Ui);cl.prototype.executeSql=function(a,b){for(var c=new Nk(a),d=Xa(c.g),e=0;e<d.length;e++){var f=Z(this.h,d[e]);if(!f)throw new I("store: "+f+" not exists.");}M(this.i,"executeSql: "+a+" params: "+b);var g=this.g.request("sql",Xa(c.g),c.k);V(g,function(){Y(this).executeSql(g,c,b||[])},this);return g};function dl(a,b,c){Nj.call(this,a,b,c)}D(dl,Oj);dl.prototype.lb=function(a,b){return new cl(this,this.h,a,b)};dl.prototype.executeSql=function(a,b){return this.g.executeSql(a,b)};dl.prototype.u=function(){var a=ii(this);if("indexeddb"==a)return new Xk(0,this.h);if("websql"==a)return new al(0,this.h);if("memory"==a||"localstorage"==a||"sessionstorage"==a)return new bl(0,this.h);throw new Bc("No executor for "+a);};function el(a,b){t(a)&&5242880<a&&K(this.i,"storage size request ignored, use Quota Management API instead");this.L=null;this.nb=b||NaN}k=el.prototype;
k.connect=function(a,b){function c(a,c,d){M(e.i,(d?"changing":"upgrading")+" version to "+a.version+" from "+g);for(d=0;d<b.stores.length;d++)fl(e,a,c,b.stores[d]);c=a.objectStoreNames;var f=c.length;for(d=0;d<f;d++)Ci(b,c[d])||(a.deleteObjectStore(c[d]),M(e.i,"store: "+c[d]+" deleted."))}function d(a,b){f.qa?K(e.i,"database already set."):t(b)?(K(e.i,b?b.message:"Error received."),e.L=null,f.s(b)):(e.L=a,e.L.onabort=function(a){N(e.i,e+": abort");e.qb(a.target.error)},e.L.onerror=function(a){N(e.i,
e+": error");e.qb(a.target.error)},e.L.onversionchange=function(a){N(e.i,e+" closing connection for onversionchange to: "+a.version);if(e.L&&(e.L.onabort=null,e.L.onblocked=null,e.L.onerror=null,e.L.onversionchange=null,e.Sb(a),!a.defaultPrevented)){e.L.close();e.L=null;var b=Error();b.name=a.type;e.hc(b)}},f.p(parseFloat(g)))}var e=this,f=new E,g=void 0,h=b.version;M(e.i,"Opening database: "+a+" ver: "+(b.h?"auto":h));var l;l=t(h)?xh.open(a,h):xh.open(a);l.onsuccess=function(f){var h=f.target.result;
t(g)||(g=h.version);M(e.i,"Database: "+h.name+", ver: "+h.version+" opened.");if(b.h)e.za(function(f){if(b instanceof yi)for(var g=0;g<f.stores.length;g++)Ci(b,f.stores[g].getName())||zi(b,f.stores[g].T());f=wj(b,f,!1,!0);if(0<f.length){M(e.i,"Schema change require for difference in "+f);var l=x(h.version)?h.version+1:1;if("IDBOpenDBRequest"in r){h.close();var m=xh.open(a,l);m.onupgradeneeded=function(a){a=a.target.result;M(e.i,"re-open for version "+a.version);c(a,m.transaction,!1)};m.onsuccess=
function(a){d(a.target.result)};m.onerror=function(){M(e.i,e+": fail.");d(null)}}else{var p=h.setVersion(l+"");p.g=function(a){K(e.i,"migrating from "+h.version+" to "+l+" failed.");d(null,a)};p.onsuccess=function(){p.transaction.oncomplete=H;c(h,p.transaction,!0)};var H=function(){var b=xh.open(a);b.onsuccess=function(a){a=a.target.result;M(e.i,e+": OK.");d(a)};b.onerror=function(){M(e.i,e+": fail.");d(null)}};null!=p.transaction&&(p.transaction.oncomplete=H)}}else d(h)},void 0,h);else if(b.version>
h.version){var l=h.setVersion(b.version);l.g=function(a){K(e.i,"migrating from "+h.version+" to "+b.version+" failed.");d(null,a)};l.onsuccess=function(){c(h,l.transaction,!0)}}else b.version==h.version?M(e.i,"database version "+h.version+" ready to go"):K(e.i,"connected database version "+h.version+" is higher than requested version."),e.za(function(a){a=wj(b,a,!1,!0);0<a.length?(M(e.i,a),d(null,new Tf("different schema: "+a))):d(h)},void 0,h)};l.onupgradeneeded=function(a){a=a.target.result;g=NaN;
M(e.i,"upgrade needed for version "+a.version);c(a,l.transaction,!1)};l.onerror=function(c){e.i.log(Dd,'open request to database "'+a+'" '+(t(b.version)?" with version "+b.version:"")+" cause error of "+l.error.name,void 0);d(null,c)};l.onblocked=function(c){e.i.log(Dd,"database "+a+" "+b.version+" block, close other connections.",void 0);d(null,c)};x(this.nb)&&!isNaN(this.nb)&&setTimeout(function(){"done"!=l.readyState&&(e.i.log(Dd,e+": database state is still "+l.readyState,void 0),d(null,new bi("connection timeout after "+
e.nb)))},this.nb);return f};k.nb=18E4;k.hc=function(){};k.qb=function(){};k.Sb=function(){};k.fb=function(){return"indexeddb"};k.gc=function(){return!!this.L};k.i=P("ydn.db.con.IndexedDb");k.L=null;k.fc=function(){return this.L?parseFloat(this.L.version):void 0};
k.za=function(a,b,c){c=c||this.L;if(t(b)){if(null===b){if(0==c.objectStoreNames.length){a(new vj(c.version));return}throw new Sf;}c=b.db}else{b=[];for(var d=c.objectStoreNames.length-1;0<=d;d--)b[d]=c.objectStoreNames[d];if(0==b.length){a(new vj(c.version));return}b=c.transaction(b,vh)}for(var e=c.objectStoreNames,f=[],g=e.length,d=0;d<g;d++){for(var h=b.objectStore(e[d]),l=[],m=0,n=h.indexNames.length;m<n;m++){var p=h.index(h.indexNames[m]);l[m]=new $i(p.keyPath,void 0,p.unique,p.multiEntry,p.name)}f[d]=
new vi(h.name,h.keyPath,h.autoIncrement,void 0,l)}b=new vj(c.version,f);a(b)};
function fl(a,b,c,d){function e(){var a={autoIncrement:!!d.h};null!=d.keyPath&&(a.keyPath=d.keyPath);return b.createObjectStore(d.getName(),a)}N(a.i,"Creating Object Store for "+d.getName()+" keyPath: "+d.keyPath);if(b.objectStoreNames.contains(d.getName()))if(c=c.objectStore(d.getName()),gj(d.keyPath||"",c.keyPath||""))b.deleteObjectStore(d.getName()),K(a.i,"store: "+d.getName()+" deleted due to keyPath change."),c=e();else if(ea(c.autoIncrement)&&ea(d.h)&&c.autoIncrement!=d.h)b.deleteObjectStore(d.getName()),
K(a.i,"store: "+d.getName()+" deleted due to autoIncrement change."),c=e();else{for(var f=c.indexNames,g=0,h=0,l=0,m=0;m<d.indexes.length;m++){var n=d.index(m),p=!1;if(f.contains(n.getName())){var q=c.index(n.getName()),s=null!=q.unique&&null!=n.unique&&q.unique!=n.unique,y=null!=q.multiEntry&&null!=n.multiEntry&&q.multiEntry!=n.multiEntry,q=null!=q.keyPath&&null!=n.keyPath&&!!gj(q.keyPath,n.keyPath);if(s||y||q)c.deleteIndex(n.getName()),p=!0,g--,l++}else"BLOB"!=n.type&&(p=!0);p&&(n.unique||n.multiEntry?
(p={unique:n.unique,multiEntry:n.multiEntry},c.createIndex(n.getName(),n.keyPath,p)):c.createIndex(n.getName(),n.keyPath),g++)}for(m=0;m<f.length;m++)Fi(d,f[m])||(c.deleteIndex(f[m]),h++);N(a.i,"Updated store: "+c.name+", "+g+" index created, "+h+" index deleted, "+l+" modified.")}else{c=e();for(m=0;m<d.indexes.length;m++)n=d.index(m),"BLOB"==n.type?a.i.info("Index "+n+" of blob data type ignored."):(N(a.i,"Creating index: "+n),n.unique||n.multiEntry?(p={unique:n.unique,multiEntry:n.multiEntry},c.createIndex(n.getName(),
n.keyPath,p)):c.createIndex(n.getName(),n.keyPath));N(a.i,"Created store: "+c)}}k.Gb=function(a,b,c,d){var e=this.L;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(null):(b=e.transaction(b,c),b.oncomplete=function(a){d("complete",a)},b.onabort=function(a){d("abort",a)},a(b),a=null)};k.ec=function(){N(this.i,this+" closing connection");this.L.close()};k.toString=function(){return"IndexedDB:"+(this.L?this.L.name+":"+this.L.version:"")};
Sh.push(function(a,b){if(!xh||b&&"indexeddb"!=b)return null;var c=xh.deleteDatabase(a),d=new Mh("IDBVersionChangeEvent ");c.onblocked=function(a){Dc(d,a)};c.onerror=function(a){d.s(a)};c.onsuccess=function(a){d.p(a)};return d});function gl(a){Bk.call(this,a);this.h=NaN}D(gl,Bk);k=gl.prototype;k.i=P("ydn.db.con.SimpleStorage");k.fc=function(){return this.h};
k.connect=function(a,b){function c(a,b){setTimeout(function(){b?(M(d.i,d+" opening fail"),e.s(b)):(M(d.i,d+" version "+d.fc()+" open"),e.p(a))},10)}var d=this,e=new E;this.k=this.m.qc(a);this.j=a;this.g=b;var f=ek(this.j);this.h=NaN;var g=If(this.k.getItem(f));t(g.version)&&!x(g.version)&&(g.version=NaN);if(g)if(g=new vj(g),wj(this.g,g,!1,!1))if(!this.g.h&&!isNaN(g.version)&&this.g.version>g.version)c(NaN,new Vh("existing version "+g.version+" is larger than "+this.g.version));else{var h=this.g.version;
this.h=t(h)?h:g.version+1;for(h=0;h<this.g.count();h++)var l=this.g.stores[h]||null;if(this.g instanceof yi)for(h=0;h<g.count();h++)l=g.stores[h]||null,zi(this.g,l);h=this.g.toJSON();h.version=this.h||NaN;this.k.setItem(f,Q(h));c(g.version||NaN)}else{for(h=0;h<this.g.count();h++)l=this.g.stores[h]||null;this.h=g.version||NaN;c(this.h)}else g=b.toJSON(),this.h=1,g.version=this.h,this.k.setItem(f,Q(g)),c(NaN);return e};k.gc=function(){return!!this.j};k.hc=function(){};k.qb=function(){};k.Sb=function(){};
k.fb=function(){return"memory"};k.ec=function(){};k.Gb=function(a,b,c,d){a(new Ck(this,function(a,b){d(a,b)}))};k.toString=function(){return"SimpleStorage:"+this.fb()+":"+(this.j+":"+this.h)};function hl(){gl.call(this,this)}D(hl,gl);hl.prototype.qc=function(){return window.localStorage};hl.prototype.fb=function(){return"localstorage"};Sh.push(function(a,b){if(!b||"localstorage"==b){var c=new hl,d=new yi;c.connect(a,d);c.za(function(a){for(var b=0;b<a.stores.length;b++)ck(c,a.stores[b].getName()).clear()})}});function il(){gl.call(this,this)}D(il,gl);il.prototype.qc=function(){return window.sessionStorage};il.prototype.fb=function(){return"sessionstorage"};
Sh.push(function(a,b){if(!b||"sessionstorage"==b){var c=new il,d=new yi;c.connect(a,d);c.za(function(a){for(var b=0;b<a.stores.length;b++)ck(c,a.stores[b].getName()).clear()})}});function jl(a){this.g=t(a)?a:4194304}k=jl.prototype;
k.connect=function(a,b){function c(b,c){var f=b.version?parseInt(b.version,10):0,g=c.h?isNaN(f)?1:f+1:c.version;L(e.i,a+": changing version from "+b.version+" to "+g);var h=!1,l=0;b.changeVersion(b.version,g+"",function(a){e.za(function(b){h=!0;for(var d=0;d<c.count();d++){var f=Z(b,(c.stores[d]||null).getName()),f=f?oj(f,c.stores[d]||null):null;kl(e,a,c.stores[d]||null,function(a){a&&l++},f)}for(d=0;d<b.count();d++)f=b.stores[d]||null,Ci(c,f.getName())||(c instanceof yi?zi(c,f):(f="DROP TABLE "+
lj(f),M(e.i,f),a.executeSql(f,[],function(){},function(a,b){throw b;})))},a,b)},function(c){e.i.log(Dd,"SQLError "+c+" "+c.code+"("+c.message+") while changing version from "+b.version+" to "+g+" on "+a,void 0);throw c;},function(){if(h){var f=".";l!=c.stores.length&&(f=" but unexpected stores exists.");N(e.i,a+":"+b.version+" ready"+f);d(b)}else K(e.i,a+": changing version voided.")})}function d(a,b){t(b)?(e.X=null,g.s(b)):(e.X=a,g.p(parseFloat(f)))}var e=this,f=NaN,g=new E,h=null;try{h=r.openDatabase(a,
"",a,this.g)}catch(l){if("SECURITY_ERR"==l.name)K(this.i,"SECURITY_ERR for opening "+a),h=null,this.Sc=new $h(l);else throw l;}if(h){var f=h.version,m="database "+a+(0==h.version.length?"":" version "+h.version);null!=b.version&&b.version==h.version?(L(e.i,"Existing "+m+" opened as requested."),d(h)):this.za(function(a){(a=wj(b,a,!0,!1))?(0==h.version.length?L(e.i,"New "+m+" created."):b.h?L(e.i,"Existing "+m+" opened and schema change for "+a):L(e.i,"Existing "+m+" opened and  schema change to version "+
b.version+" for "+a),c(h,b)):(L(e.i,"Existing "+m+" with same schema opened."),d(h))},null,h)}else d(null,this.Sc);return g};k.fb=function(){return"websql"};k.Sc=null;k.X=null;k.i=P("ydn.db.con.WebSql");k.hc=function(){};k.qb=function(){};
function ll(a){var b=a.B,c="CREATE TABLE IF NOT EXISTS "+lj(a)+" (",d=a.k,c=c+(d+" "+b+" PRIMARY KEY ");a.h&&(c+=" AUTOINCREMENT ");if(!a.Ta||!a.keyPath&&0==a.indexes.length)c+=" ,_default_ BLOB";for(var e=[],f=[d],g=0,h=a.indexes.length;g<h;g++){var l=a.index(g),m="";if(l.multiEntry){var m="ydn.db.me:"+a.getName()+":"+l.getName(),n=l.unique?" UNIQUE ":"",l="CREATE TABLE IF NOT EXISTS "+Ga(m)+" ("+d+" "+b+", "+l.j+" "+l.n+n+")";e.push(l)}else l.unique&&(m=" UNIQUE "),n=l.keyPath,"BLOB"!=l.type&&w(n)&&
(n="CREATE "+m+" INDEX IF NOT EXISTS "+Ga(a.getName()+"-"+l.getName())+" ON "+lj(a)+" ("+Ga(n)+")",e.push(n)),n=l.j,-1==f.indexOf(n)&&(c+=", "+n+" "+l.n+m,f.push(n))}e.unshift(c+")");return e}k.fc=function(){return this.X?parseFloat(this.X.version):void 0};
k.za=function(a,b,c){function d(a,b){throw b;}function e(b,c){if(c&&c.rows){for(var d=0;d<c.rows.length;d++){var e=c.rows.item(d);if("__WebKitDatabaseInfoTable__"!=e.name&&"sqlite_sequence"!=e.name&&"table"==e.type){var q="sql"in e?e.sql:void 0;N(f.i,"Parsing table schema from SQL: "+q);for(var s=q.substr(q.indexOf("("),q.lastIndexOf(")")).match(/(?:"[^"]*"|[^,])+/g),y=void 0,A,q=[],G=!1,H=!1,J=0;J<s.length;J++){var O=s[J].match(/\w+|"[^"]+"/g),ga=Oa(O,function(a){return a.toUpperCase()}),ka=Da(O[0],
'"'),O=aj(ga[1]);if(-1!=ga.indexOf("PRIMARY")&&-1!=ga.indexOf("KEY")){A=O;if(w(ka)&&!sa(ka)&&"_ROWID_"!=ka){var tb=ka.split(","),y=ka;1<tb.length&&(y=tb,A=void 0)}-1!=ga.indexOf("AUTOINCREMENT")&&(G=!0)}else if("_ROWID_"!=ka)if("_default_"==ka)H=!0;else{var Of="UNIQUE"==ga[2];qa(ka,e.tbl_name+"-")&&(ka=ka.substr(e.tbl_name.length+1));ga=new $i(ka,O,Of);q.push(ga)}}if(qa(e.name,"ydn.db.me:")){var Ob=e.name.split(":");if(3<=Ob.length){var rc=Ob[1],y=new $i(Ob[2],O,Of,!0),s=Sa(q,function(a){return a.getName()==
Ob[2]});0<=s?q[s]=y:q.push(y);s=Sa(h,function(a){return a.getName()===rc});0<=s?(J=h[s],h[s]=new vi(J.getName(),J.keyPath,G,A,q,void 0,!H)):h.push(new vi(rc,void 0,!1,void 0,[y]));N(f.i,'multi entry index "'+y.getName()+'" found in '+rc+(-1==s?"*":""))}else K(f.i,'Invalid multiEntry store name "'+e.name+'"')}else J=Sa(h,function(a){return a.getName()===e.name}),0<=J?(s=h[J].index(0),q.push(s),h[J]=new vi(e.name,y,G,A,q,void 0,!H)):(q=new vi(e.name,y,G,A,q,void 0,!H),h.push(q))}}d=new vj(g,h);a(d)}}
var f=this,g=(c=c||this.X)&&c.version?parseFloat(c.version):void 0,g=isNaN(g)?void 0:g,h=[];b?b.executeSql("SELECT * FROM sqlite_master",[],e,d):c.readTransaction(function(b){f.za(a,b,c)},function(a){f.i.log(Dd,"opening tx: "+a.message,void 0);throw a;},e)};
function kl(a,b,c,d,e){function f(a){b.executeSql(a,[],function(){g++;g==h.length&&(d(!0),d=null)},function(b,e){g++;g==h.length&&(d(!1),d=null);var f="SQLError creating table: "+c.getName()+" "+e.message+' for executing "'+a;throw new Zh(e,f);})}var g=0,h=ll(c),l="Create";if(e){e=xi(c,e);if(0==e.length){N(a.i,"same table "+c.getName()+" exists.");d(!0);d=null;return}l="Modify";K(a.i,"table: "+c.getName()+" has changed by "+e+" ALTER TABLE cannot run in WebSql, dropping old table.");h.unshift("DROP TABLE IF EXISTS "+
Ga(c.getName()))}N(a.i,l+" table: "+c.getName()+": "+h.join(";"));for(a=0;a<h.length;a++)f(h[a])}k.gc=function(){return!!this.X};k.ec=function(){this.X=null};k.Gb=function(a,b,c,d){function e(a){N(h.i,h+": Tx "+c+" request cause error.");d("abort",a)}function f(){d("complete",{type:"complete"})}function g(b){a(b)}var h=this;null===this.X&&(a(null),d("abort",this.Sc));c==vh?this.X.readTransaction(g,e,f):c==wh?this.X.changeVersion(this.X.version,this.X.version+1+"",g,e,f):this.X.transaction(g,e,f)};
Sh.push(function(a,b){if(!b||"websql"==b){var c=new jl,d=new yi;M(c.i,"deleting websql database: "+a);var d=c.connect(a,d),e=function(){c.i.info("all tables in "+a+" deleted.")};d.F(function(){c.Gb(function(b){b.executeSql('SELECT * FROM sqlite_master WHERE type = "table"',[],function(d,e){if(e&&e.rows){for(var l=e.rows.length,m=0,n=0;n<l;n++){var p=e.rows.item(n);"__WebKitDatabaseInfoTable__"!=p.name&&"sqlite_sequence"!=p.name&&(m++,N(c.i,"deleting table: "+p.name),b.executeSql("DROP TABLE "+p.name))}M(c.i,
m+' tables deleted from "'+a+'"')}},function(a,b){throw b;})},[],T,e)});d.gb(function(){K(c.i,"Connecting "+a+" failed.")})}});jl.prototype.Sb=function(){};jl.prototype.toString=function(){return"WebSql:"+(this.X?":"+this.X.version:"")};Lj.prototype.sc=function(a){return"indexeddb"==a&&xh?new el(this.B,this.H):"websql"==a&&fa(r.openDatabase)?new jl(this.B):"localstorage"==a&&window.localStorage?new hl:"sessionstorage"==a&&window.sessionStorage?new il:"memory"==a?new gl:null};function ml(a,b){mb.call(this);this.k=b;this.g=[];if(a>this.k)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var c=0;c<a;c++)this.g.push(this.h())}D(ml,mb);ml.prototype.Ub=function(a){this.g.length<this.k?this.g.push(a):this.j(a)};ml.prototype.h=function(){return{}};ml.prototype.j=function(a){if(z(a))if(fa(a.Da))a.Da();else for(var b in a)delete a[b]};ml.prototype.I=function(){ml.q.I.call(this);for(var a=this.g;a.length;)this.j(a.pop());delete this.g};function nl(){this.g=[];this.j=new Tc;this.k=new Tc;this.m=1;this.l=new ml(0,4E3);this.l.h=function(){return new ol};this.n=new ml(0,50);this.n.h=function(){return new pl};var a=this;this.h=new ml(0,2E3);this.h.h=function(){return String(a.m++)};this.h.j=function(){}}P("goog.debug.Trace");function pl(){this.time=this.count=0}pl.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");return a.join("")};function ol(){}
function ql(a,b,c){var d=[];-1==b?d.push("    "):d.push(rl(a.h-b));d.push(" ",sl(a.h-0));0==a.g?d.push(" Start        "):1==a.g?(d.push(" Done "),d.push(rl(a.l-a.startTime)," ms ")):d.push(" Comment      ");d.push(c,a);0<a.k&&d.push("[VarAlloc ",a.k,"] ");return d.join("")}ol.prototype.toString=function(){return null==this.type?this.j:"["+this.type+"] "+this.j};
nl.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.g.length;d++){var e=this.g[d];1==e.g&&c.pop();a.push(" ",ql(e,b,c.join("")));b=e.h;a.push("\n");0==e.g&&c.push("|  ")}if(0!=this.j.K()){var f=C();a.push(" Unstopped timers:\n");Rc(this.j,function(b){a.push("  ",b," (",f-b.startTime," ms, started at ",sl(b.startTime),")\n")})}b=this.k.aa();for(d=0;d<b.length;d++)c=this.k.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",0,"\n","Total comments created ",0,
"\n","Overhead start: ",0," ms\n","Overhead end: ",0," ms\n","Overhead comment: ",0," ms\n");return a.join("")};function rl(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a}function sl(a){a=Math.round(a);return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+a%1E3).substring(1,4)}new nl;/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function tl(a){a.n||(a.n=new wc);return a.n}function ul(a,b){var c=vl;if("ready"==a)pc(tl(c),a,b,void 0,void 0);else{var d="created error fail ready deleted updated versionchange".split(" "),e=function(a){if(!Ta(d,a))throw new I('Invalid event type "'+a+'"');};if(v(a))for(var f=0;f<a.length;f++)e(a[f]);else e(a);jc(tl(c),a,b,void 0,void 0)}}Lj.prototype.removeEventListener=function(a,b,c,d){qc(tl(this),a,b,c,d)};Lj.prototype.fa=function(a){tl(this).dispatchEvent(a)};function wl(a,b,c){Nj.call(this,a,b,c)}D(wl,dl);var xl,yl,zl,Al,Fj,Bl=P("ydn.crm.shared");function Cl(){xl||(xl=new Ge(0));return xl}function Dl(){yl||(yl=new Yg(Cl()),Cg(yl,"default"));return yl}function El(a){var b=Dl();a=new Ng(a,xl,!1);Cg(a,"gc");var c=new Tg(a,function(a){a.path="https://yathit-app.appspot.com/proxy/"+a.path;return a});Cg(new Vg(b,"https://yathit-app.appspot.com/proxy/"),"proxy");Cg(new Ug(function(a){return"GET"==a.method},a,c),"gse")}var Fl={},Gl="";
function Hl(a,b){Fl[a]=b;var c={};c[Gl]=Fl;chrome.storage.local.set(c)}var Il={stores:[{name:"general"},{name:"sugar"}]};function Jl(a){Gl=a+"-setting";a+="-setting";Fj&&Fj.getName()!=a&&(Ej(),Fj=null);Fj&&(Fj=new wl(a,Il));var b=new E;chrome.storage.local.get(Gl,function(a){a[Gl]&&(Fl=a[Gl]);b.p(Fj)});return b};function Kl(a,b){if(a.link){if(u(a.link)){for(var c=0;c<a.link.length;c++)if(a.link[c].rel==b)return a.link[c];return null}return a.link.rel==b?a.link:null}return null};function Ll(a,b){this.entry=a;this.data=b;this.g=!1}Ll.prototype.data=null;Ll.prototype.preventDefault=function(){this.g=!0};function Ml(a,b,c,d){F.call(this,a,b);this.status=c;this.entry=d}D(Ml,F);Ml.prototype.status=NaN;Ml.prototype.C=function(){return this.status};Ml.prototype.ta=function(){return this.entry.ta()};function Nl(a,b,c){Ml.call(this,"conflict",a,b,c.entry)}D(Nl,Ml);function Ol(a,b){this.g=a;if(b)throw new yc("optional key paths");}var Pl={Sd:"key",Pd:"date",Td:"modified",Rd:"expires",Qd:"etag",Ud:"updated",Vd:"uri",NEXT:"next"};function Ql(a,b,c){return c&&a.g[b]?hh(c,a.g[b]):void 0}function Rl(a,b,c,d){a.g[b]&&ih(c,a.g[b],d)};function Sl(a,b,c,d){this.key=a;this.h=(this.h=d?b[d]:b)||{};this.g=c}function Tl(a){return null!=a.key?a.key:Ql(a.g,"key",a.h)}function Ul(a){return Ql(a.g,"updated",a.h)}function Vl(a){return Ql(a.g,"etag",a.h)}function Wl(a){var b={},c=Vl(a);c&&1<c.length?b["if-none-match"]=c:(a=Ul(a))&&(b["if-modified-since"]=a);return b}
Sl.prototype.toJSON=function(){var a={};Rl(this.g,"key",a,Tl(this));var b=Ql(this.g,"date",this.h);b&&Rl(this.g,"date",a,b);(b=Ql(this.g,"expires",this.h))&&Rl(this.g,"expires",a,b);(b=Ul(this))&&Rl(this.g,"updated",a,b);(b=Vl(this))&&Rl(this.g,"etag",a,b);return a};function Xl(a,b,c){b.expires&&Rl(c,"expires",b,(new Date(b.expires)).getTime());b["last-updated"]&&Rl(c,"updated",b,(new Date(b["last-updated"])).getTime());b.etag&&Rl(c,"etag",b,(new Date(b.etag)).getTime());Rl(c,"date",b,NaN);Sl.call(this,a,b,c)}D(Xl,Sl);function Yl(a,b,c){this.g=a;this.m=c||null;this.j=this.h=null;this.key=b}k=Yl.prototype;k.i=P("ydn.db.sync.entry.Rest");k.ta=function(){if(this.j&&this.g.o&&this.k){var a=this.g.u;this.g.N||delete this.j[a]}return this.j||null};k.jc=function(){return this.g.Fc(this.key)};k.yc=function(a,b){if(a)return a;if(b.Z())return Ig(b);try{return Ig(b)}catch(c){var d=Gg(b);return z(d)?d:{body:d}}};
k.save=function(a){var b=this.key;if(a&&!this.g.o)return C(),Zl(this.g,[this.k.toJSON()]);var c=this.j;if(a&&!c)return jb();a=void 0;null!=this.k&&(C(),a=[this.k.toJSON()]);return $l(this.g,[c],a,[b])};
k.Ra=function(a,b){if(this.g.G&&z(this.h))a.call(b,304),a=null;else{var c=this;am(this,function(d){if(d){var e=Ql(d.g,"expires",d.h);if(e&&e>C()){N(this.i,this+" not expired");a.call(b,304);a=null;return}}d=c.Na(c.jc(),"GET",d);this.g.P().request(d).execute(function(d,e){var h;h=new Xl(c.key,e.Za(),c.g.m);c.k=h;c.j=c.yc(d,e);a.call(b,e.C());a=null})},this)}};
k.Na=function(a,b,c,d){a=new dg(a,b);if(c){var e;"POST"==a.method||"PUT"==a.method||"DELETE"==a.method?(e={},(b=Ul(c))&&(e["if-unmodified-since"]=b),(c=Vl(c))&&1<c.length&&(e["if-match"]=c),c=e):c=Wl(c);e=c;a.headers?bc(a.headers,e):a.headers=e}a.body=z(d)?JSON.stringify(d):d;N(this.i,this+" "+a.method+" "+a.path+" "+Jf(e));return a};
function bm(a,b,c){am(a,function(a){a=this.Na(this.jc(),"PUT",a,this.m);this.g.P().request(a).execute(function(a,d){this.k=new Xl(this.key,d.Za(),this.g.m);this.j=a;b&&(b.call(c,d.C()),b=null)},this)},a)}function am(a,b,c){a.l?b.call(c,a.l):cm(a.g,a.key,function(d){a.l=d;b.call(c,d)})}
k.load=function(a,b){this.h&&this.l?a&&(a.call(b,this.h,this.l),a=void 0):this.g.load(this.key,function(c,d){this.h=c;var e=this.g.u;this.h&&e&&this.h[e]&&(this.l=new Sl(this.key,this.h,this.g.m,e),this.g.N||delete this.h[e]);this.h=c;this.l=d;a&&(a.call(b,c),a=void 0)},this)};function dm(a,b){var c=a.jc(),d=a.g.P();am(a,function(a){a=this.Na(c,"DELETE",a);d.request(a).execute(function(a,d){N(this.i,"deleted "+c+" "+d.C());b.call(this,d.C())},this)},a)}
k.toString=function(){return"sync.entry{"+this.g.w+":"+this.key+"}"};function em(a,b,c){this.storage=a;this.j=b;this.w=b.getName();a="format readRequestTimeout writeRequestTimeout transport Options fetchStrategies baseUri immutable keepMeta metaStoreName metaDataName prefetch prefetchRefractoryPeriod".split(" ");for(var d in c)if(-1==La(a,d))throw new I('Unknown Sync attribute "'+d+'"  in Sync.');this.G=!!c.immutable;this.h=c.baseUri;this.xa=c.metaStoreName||this.w;this.u=c.metaDataName;this.o=this.xa==this.w;a=c.Options||{};if(!this.xa)throw new I("metadata store name required.");
b=this.sa();for(d in a)if(-1==La(b,d))throw new I('Unknown Sync.Options attribute "'+d+'" in Sync.Options');this.da=a.delimiter||"";this.l=a.prefix||"";this.N=!!c.keepMeta;this.H=c.prefetch||x(c.prefetchRefractoryPeriod)?"full":null;this.ca=x(c.prefetchRefractoryPeriod)?c.prefetchRefractoryPeriod:5E3;this.g=fm(c.transport);this.m=new Ol(this.ra(),c.metaData);this.n=null;this.B=NaN}k=em.prototype;k.ra=function(){var a={},b;for(b in Pl)a[b]=b;return a};k.sa=function(){return[]};k.i=P("ydn.db.sync.Rest");
k.Ba=function(){return this.h};k.P=function(){this.g||(this.g=new Yg);return this.g};k.toString=function(){return"sync:"+this.w};function Zl(a,b){return Oi(a.storage.g,a.xa,b).gb(function(a){throw a;})}function gm(a,b,c){a.j.keyPath&&null==Ji(a.j,b)&&null!=c&&ih(b,a.j.keyPath,c)}
function $l(a,b,c,d){d=a.j.keyPath?void 0:d;if(c){if(a.o){for(g=0;g<b.length;g++)null!=c[g]&&bc(b[g],c[g]);return Oi(a.storage.g,a.w,b,d)}if(b){for(var e=[],f=b.concat(c),g=0;g<b.length;g++){var h=a.j.keyPath?NaN:d[g];e.push(new X(a.w,h))}for(g=0;g<c.length;g++)e.push(new X(a.xa,NaN));return Oi(a.storage.g,e,f)}return Oi(a.storage.g,a.xa,c)}for(g=0;g<b.length;g++)h=d?d[g]:void 0,gm(a,b[g],h);return Oi(a.storage.g,a.w,b,d)}
function hm(a,b){var c=[new X(a.w,b)];a.o||c.push(new X(a.xa,b));return Pi(a.storage.g,c)}k.Fc=function(a){return this.Ba()+a};k.add=function(a,b,c){null!=c?gm(this,b,c):this.j.keyPath&&(c=Ji(this.j,b));var d=this.S(c,b),e=this;bm(d,function(a){201==a||200==a?(N(e.i,d+" created"),d.save(!0)):K(e.i,"Unexpected respond "+a+" for add "+d)})};
function cm(a,b,c){var d=new X(a.xa,b);im(a,[d]).t(function(a){c.call(void 0,new Sl(b,a[0],this.m,this.u))},function(a){K(this.i,this+" error loading meta data "+a);c.call(void 0,null)},a)}k.Qb=function(a,b){var c=a.map(function(a){return new X(this.xa,a)});im(this,c).t(function(c){for(var e=[],f=0;f<a.length;f++)e[f]=new Sl(a[f],c[f],this.m,this.u);b(e)},function(a){K(this.i,this+" error loading meta data "+a);b([])},this)};
k.load=function(a,b,c){var d=this.xa,e=[new X(this.w,a)];this.o||e.push(new X(d,a));im(this,e).t(function(d){var e=d[0];b.call(c,e,new Sl(a,this.o?e:d[1],this.m,this.u))},function(a){K(this.i,this+" error loading meta data "+a);b.call(c,null,null)},this)};function im(a,b){return Ri(a.storage.g,b)}
k.get=function(a,b){this.B||this.Ja();Qh(a,function(c,d,e){if(d)e(c,d);else{Dc(a,c);var f=t(c);if(f&&this.G)e(c);else{var g=this.S(b,c);g.Ra(function(a){if(304==a){if(e(c),!f)throw new Bc(g+" not modified, but not exist in server");}else if(200==a)g.save().Q(function(){e(g.ta())});else if(404==a)hm(g.g,g.key).Q(function(){e(g.ta())});else throw e(g.ta()),new Ac("Invalid HTTP respond "+a+" for GET "+b);},this)}}},this)};
function jm(a,b,c,d,e,f){var g=[],h=a.i;M(a.i,d.length+", "+e.length+", "+f.length+", "+g.length+" records to fetch, update, delete, save");var l=d.length+e.length+f.length+g.length;if(0==l)b(c);else{for(var m=!1,n=function(){l--;0==l&&(b(c,m),b=null)},g=0;g<d.length;g++){var p=a.S(d[g]);p.index=g;p.Ra(function(a){200==a?(N(h,"A new "+this+" received from server"),this.save().t(function(){c[this.index]=this.ta();n()},function(){m=!0;n()},this)):304==a?this.save(!0).t(function(){N(h,this+" expires date updated");
n()},function(){m=!0;n()},this):(K(h,"Invalid status "+a+" for fetching "+this),n())},p)}for(g=0;g<e.length;g++)p=a.S(e[g]),p.index=g,p.load(function(){this.Ra(function(a){200==a?(N(h,this+" updated from server"),this.save().t(function(){c[this.index]=this.ta();n()},function(){m=!0;n()},this)):(K(h,"Invalid status "+a+" for fetching "+this),n())})});for(g=0;g<f.length;g++)p=a.S(f[g]),p.index=g,hm(p.g,p.key).t(function(){c[this.index]=new Ll(p,null);n()},function(){m=!0;n()},p)}}
function km(a,b,c){Qh(b,function(a,e,f){if(e)f(a,e);else if(Qa(a,function(a){return t(a)})&&this.G)f(a);else{Dc(b,a);var g=a.length;for(e=0;e<c.length;e++)if(this.G&&t(a[e]))g--,0==g&&f(a);else{var h=this.S(c[e],a[e]);h.index=e;h.Ra(function(b){200==b?(a[this.index]=this.ta(),this.save()):404==b&&(a[this.index]=void 0);g--;0==g&&f(a)},h)}}},a)}k.S=function(a,b){return new Yl(this,a,b)};k.count=function(a){return a};k.Ic=function(){throw new yc;};
k.values=function(a,b,c){lm(this)?(N(this.i,"prefetch queued"),Qh(a,function(d,e,f){Dc(a,d);e?f(d,e):mm(this,function(a){a?Qi(this.storage.g,this.w,null,null,!1,b,c).t(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(){K(this.i,this+" prefetch fail");f(d)},this)},this)):this.Ic(a,b,c)};
k.keys=function(a,b,c,d,e,f,g){Qh(a,function(h,l,m){Dc(a,h);l?m(h,l):mm(this,function(a){a?Si(this.storage.g,this.w,b,c,d,e,f,g).t(function(a){m(a)},function(a){m(a,!0)},this):m(h)},function(){K(this.i,this+" prefetch fail");m(h)},this)},this)};k.wc=function(){};
k.put=function(a,b,c){c=t(c)?c:this.j.keyPath?Ji(this.j,b):null;var d=this.S(c,b);V(a,function(){d.load()},this);Qh(a,function(c,f,g){Dc(a,c);bm(d,function(c){409==c?d.Ra(function(){var c=new Ll(d,b);Dc(a,c);c.g?g(null,f):g(void 0,f)}):200==c||201==c?(d.save(!0),g(b,f)):(K(this.i,"Unexpected response for PUT: "+c),g(null,f))},this)},this)};
k.remove=function(a,b){var c=this,d=this.S(b);d.load(function(){Qh(a,function(e,f,g){dm(d,function(f){if(409==f){f=new Ll(d,null);Dc(a,f);var l=new Nl(c.storage,409,f);c.storage.fa(l)}else 200==f?N(c.i,"Successfully deleted object "+b):(K(c.i,"Unexpected response for DELETE: "+f+" "+b),Dc(a,l));g(e)})})})};
k.Ja=function(){N(this.i,this+" starting prefetch");var a=new E;Qi(this.storage.g,this.w,"updated.$t",null,!0,1).t(function(b){var c={};if(b=b[0])b=Zb(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b;var d=this,c=new dg(this.Ba(),"GET",c);d.P().request(c).execute(function(b,c){if(200==c.C()){if(!b){var g=Gg(c);w(g)&&(b=JSON.parse(g))}g=(g=(b.feed||b).entry)?u(g)?g:[g]:[];0<g.length?$l(d,g).Q(function(){a.p(!0)}):a.p(!1)}else 302==c.C()?a.p():(g=d+": Invalid response status "+
c.C()+" on prefetching",K(d.i,g),a.s(Error(g)))})},function(b){a.s(b)},this);return a};function lm(a){return a.H?a.B?C()-a.B>a.ca:!0:!1}function mm(a,b,c,d){lm(a)?a.n?a.n.t(b,c,d):(a.n=a.Ja(),a.B=C(),a.n.t(b,c,d),a.n.t(function(a){N(this.i,"prefetch "+(a?"updated":"no update"));this.n=null},function(a){this.n=null;throw a;},a)):b.call(d,!1)};function nm(a,b,c){em.call(this,a,b,c)}D(nm,em);nm.prototype.i=P("ydn.db.sync.Atom");nm.prototype.sa=function(){return nm.q.sa.call(this)};function om(a){this.data=a}k=om.prototype;k.Pc=function(){return this.data.id.$t};k.Qc=function(){return this.data.title?this.data.title.$t:void 0};k.cc=function(a){return Kl(this.data,a)};k.Ld=function(){var a=this.cc("self");return a?a.href:void 0};k.Kd=function(){var a=this.cc("http://schemas.google.com/g/2005#batch");return a?a.href:""};k.Jb=function(){return this.data.content||null};function pm(a,b,c){Yl.call(this,a,b,c)}D(pm,Yl);pm.prototype.i=P("ydn.db.sync.entry.S3");pm.prototype.getName=function(){return this.g.l+this.key};pm.prototype.Na=function(a,b,c,d){b=pm.q.Na.call(this,a,b,c,d);if("PUT"==b.method||"POST"==b.method){c=(new Zc(a)).Qa.substr(1);if(1>c.length)throw new Ac("invalid url "+a);b.headers.Key=c;a=b.headers["Content-Type"]||"application/json";d instanceof File?a=d.type:w(d)&&(a=/<*DOCTYPE html/i.test(d)?"text/html":"text/plain");b.headers.ContentType=a}return b};function qm(a){this.data=a}D(qm,om);P("ydn.gdata.base");var rm={atom:"http://www.w3.org/2005/Atom",ydn:"http://www.yathit.com/2012/ydn",app:"http://www.w3.org/2007/app",openSearch:"http://a9.com/-/spec/opensearch/1.1/",gAcl:"http://schemas.google.com/acl/2007",sites:"http://schemas.google.com/sites/2008",gs:"http://schemas.google.com/spreadsheets/2006",dc:"http://purl.org/dc/terms",batch:"http://schemas.google.com/gdata/batch",gd:"http://schemas.google.com/g/2005",gContact:"http://schemas.google.com/contact/2008",thr:"http://purl.org/syndication/thread/1.0",
xhtml:"http://www.w3.org/1999/xhtml"};function sm(a,b){for(var c=a.indexOf(" "),d=0;d<b.length;d++){var e=b[d],e=(0==d?"xmlns":"xmlns:"+e)+'="'+rm[e]+'"';-1==a.indexOf(e)&&(a=a.substring(0,c+1)+e+" "+a.substr(c+1))}return a}P("ydn.xml");function tm(a,b,c){c=!!c;if(a.getName()!=b.getName())return!1;var d=um(a),e=um(b);if(!c&&d.length!=e.length||c&&e.length>d.length)return!1;for(d=0;d<e.length;d++)if(a.getAttribute(e[d])!=b.getAttribute(e[d]))return!1;d=vm(a);e=vm(b);if(!c&&d.length!=e.length||c&&e.length>d.length)return!1;if(0==d.length||0==d.length)return a.data.$t===b.data.$t;for(d=0;d<e.length;d++){var f=wm(a,e[d]),g=wm(b,e[d]);if(!c&&f.length!=g.length||c&&g.length>f.length)return!1;for(var h=0;h<g.length;h++)if(-1==Sa(f,function(a){return tm(a,
g[h],c)}))return!1}return!0};function xm(a,b,c){if(t(b))ym(this,b),t(c)||(c=a[b]);else for(var d in a)if(a.hasOwnProperty(d)&&z(a[d])&&w(a[d].xmlns)){this.tb=[d].xmlns;ym(this,d);c=a[d];break}this.data=c;this.parent=a}k=xm.prototype;k.tb="http://www.w3.org/2005/Atom";function ym(a,b){var c=b.split(":");1<c.length&&(a.tb=rm[c[0]]||rm.xhtml||xm.prototype.tb,b=c[1]);a.g=b}k.toString=function(){return"JsonElement:"+this.g};k.getName=function(){return this.g};
function zm(a,b){for(var c in a.data)a.data.hasOwnProperty(c)&&z(a.data[c])&&delete a.data[c];a.data.$t=b}k.getAttribute=function(a){a=a.replace(/:/,"$");return this.data[a]};k.setAttribute=function(a,b){a=a.replace(/:/,"$");this.data[a]=b};k.removeAttribute=function(a){a=a.replace(/:/,"$");delete this.data[a]};function um(a){var b=[],c;for(c in a.data)a.data.hasOwnProperty(c)&&w(a.data[c])&&"$t"!=c&&b.push(c);return b}
function wm(a,b){t(void 0)?b="undefined$"+b:t(b)&&(b=b.replace(/:/,"$"));var c=[];if(t(b)){var d=a.data[b];if(u(d))for(var e=0;e<d.length;e++)c.push(new xm(a.data,b,d[e]));else z(d)&&c.push(new xm(a.data,b,d))}else for(d in a.data)if(u(a.data[d]))for(e=0;e<a.data[d].length;e++)c.push(new xm(a.data,d,a.data[d][e]));else z(a.data[d])&&c.push(new xm(a.data,d,a.data[d]));return c}function vm(a){var b=[],c;for(c in a.data)z(a.data[c])&&b.push(c.replace("$",":"));return b}
k.appendChild=function(a){var b=a.getName();this.data[b]?(u(this.data[b])||(this.data[b]=[this.data[b]]),this.data[b].push(xj(a.data))):this.data[b]=xj(a.data)};
k.update=function(a,b,c,d,e){var f=!1;c=c||{};var g=t(b),h=!0===b||!g,l=!1===b,m=um(this),n=um(a);if(!g)for(var p=0;p<m.length;p++)t(e)&&!e[m[p].replace("$",":")]||Ta(n,m[p])||(this.removeAttribute(m[p]),f=!0);for(p=0;p<n.length;p++){var q=a.getAttribute(n[p]);if(!t(e)||e[n[p].replace("$",":")])Ta(m,n[p])?l||q==this.getAttribute(n[p])||(this.setAttribute(n[p],q),f=!0):(this.setAttribute(n[p],q),f=!0)}if(0==Am(a)&&h&&(e=this.data.$t,l=a.data.$t,t(l)&&e!=l))return zm(this,l),!0;if(!g)for(var s in this.data)d&&
!d[s.replace("$",":")]||!z(this.data[s])||z(a.data[s])||(delete this.data[s],f=!0);s=vm(a);for(e=0;e<s.length;e++)if(l=s[e],!d||!0==d[l]){var y=wm(a,l),m=wm(this,l),A=l.replace(":","$");if(1==y.length)0==m.length?(this.data[A]=xj(y[0].data),f=!0):1==m.length?c[l]?h&&!tm(m[0],y[0],!0)&&(u(this.data[A])||(this.data[A]=[this.data[A]]),this.data[A].push(xj(y[0].data)),f=!0):f=m[0].update(y[0],b)||f:g?(l=Sa(m,function(a){return tm(a,y[0],!0)}),-1==l&&h&&(this.data[A].push(xj(y[0].data)),f=!0)):(this.data[A]=
xj(y[0].data),f=!0);else if(!u(this.data[A]))if(h)this.data[A]=xj(a.data[A]),f=!0;else{if(g){var m=xj(a.data[A]),G=this,l=Sa(m,function(a){return hj(G.data[A],a)});-1==l&&(m.push(this.data[A]),this.data[A]=m,f=!0)}}else if(h)for(m.length>y.length&&(this.data[A].splice(y.length,m.length-y.length),f=!0),p=0;p<y.length;p++)t(m[p])?hj(m[p].data,y[p].data)||(this.data[A][p]=xj(y[p].data),f=!0):(this.data[A][p]=xj(y[p].data),f=!0);else if(g)for(p=0;p<a.data[A].length;p++)l=Sa(this.data[A],function(b){return hj(a.data[A][p],
b)}),-1==l&&(this.data[A].push(xj(a.data[A][p])),f=!0)}return f};k.toJSON=function(){return{data:this.data,tagName:this.g}};
function Bm(a){function b(a,g){d(g,a);var h,l;for(l in a)if(a.hasOwnProperty(l)&&!w(a[l]))if(w(a[l].$t)&&"xhtml"==a[l].type){h=c(l);d(h,a[l]);var m=Mf(a[l].$t);e.importNode(m.documentElement,!0);h.appendChild(m.documentElement);g.appendChild(h)}else if(w(a[l].$t))h=c(l),h.textContent=a[l].$t,d(h,a[l]),g.appendChild(h);else if(u(a[l])&&a[l][0]&&w(a[l][0].$t))for(m=0;m<a[l].length;m++)h=c(l),h.textContent=a[l][m].$t,d(h,a[l][m]),g.appendChild(h);else if(u(a[l]))for(m=0;m<a[l].length;m++)h=c(l),g.appendChild(h),
b(a[l][m],h);else z(a[l])&&(h=c(l),g.appendChild(h),b(a[l],h))}function c(a){return e.createElement(a.replace("$",":"))}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&"$t"!=c&&w(b[c])&&a.setAttribute(c.replace("$",":"),b[c])}var e=Kf(a.getName(),a.tb);b(a.data,e.documentElement);return Nf(e.documentElement)}
function Am(a){function b(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(u(a[c])?b+=a[c].length:z(a[c])&&b++);return b}var c;t(void 0)?c="undefined$"+c:t(c)&&(c=c.replace(/:/,"$"));return t(c)?u(a.data[c])?a.data[c].length:z(a.data[c])?b(a.data[c]):0:b(a.data)}k.T=function(a){var b={};if(t(a))for(var c in this.data){var d=c.replace("$",":");w(this.data[c])?b[c]=this.data[c]:!0==a[d]&&(b[c]=xj(this.data[c]))}else b=xj(this.data);return new xm(null,this.g,b)};
function Cm(a,b){var c=b.ownerDocument.createElementNS(a.tb,a.getName()),d;for(d in a.data)if(a.data.hasOwnProperty(d)){var e=d.replace("$",":");if(w(a.data[d]))"$t"==d?c.textContent=a.data[d]:(e=c.ownerDocument.createAttribute(e),e.nodeValue=a.data[d],c.setAttributeNode(e));else if(u(a.data[d]))for(var f=0;f<a.data[d].length;f++){var g=new xm(a.data[d],e,a.data[d][f]);Cm(g,c)}else z(a.data[d])&&(g=new xm(a.data,e,a.data[d]),Cm(g,c))}return b.appendChild(c)};function Dm(a){var b;if(t(a.id))b=a.id.$t;else if(t(a.batch$id))b=a.batch$id.$t;else if(t(a.g))b=a.g.$t;else throw new Pf("id or batch:id required.");this.id=b;this.h=void 0;this.data=a}D(Dm,qm);k=Dm.prototype;k.i=P("ydn.gdata.Entry");k.Qc=om.prototype.Qc;k.Pc=function(){return this.id};k.Wa=["link","category"];k.Dd=["id","batch$id","link","category"];k.Jb=om.prototype.Jb;function Em(a,b){if(b)a.data.status=""==b?void 0:b;else{var c=a.data;c.status&&(c.status=b)}}
function Fm(a){return t(a.gd$deleted)?"gd:deleted":(a=a.status)?a:""}k.setTitle=function(){throw new Rf;};k.Xa=function(){if(!Gm(this.data))throw Error("nothing to commit");var a=new E;Hm(this,function(b,c){if(c.Z())a.p(b);else{var d=Gg(c);if(w(d)&&/html/.test(Hg(c,"content-type")))try{var e=(new DOMParser).parseFromString(d,"text/html");e.body&&(d=e.body.innerHTML)}catch(f){}a.s(c.C()+" "+c.ba()+" "+d)}},this);return a};
function Hm(a,b,c){var d=bg("gse");if(Gm(a.data)){var e={"Content-Type":"application/atom+xml"};a.g&&(e["GData-Version"]=a.g);var f={},g="POST",h,l,m;m="full";t(l)||(l="base"!=m);var n=a.kind||"contact";h=h?"/"+h:"";h=(l?"https":"http")+"://www.google.com/m8/feeds/"+n+"s/"+a.user_id.replace("@","%40")+"/"+m+h;h=h.replace("%40","@");if(l=(l=a.cc("edit"))?l.href:void 0)g="delete"==Fm(a.data)?"DELETE":"PUT",h=l;try{var p=Im(a)}catch(q){ug({"class":"ydn.gdata.Entry",method:"ydn.gdata.Entry.commit","entry.data":a.data,
context:"toXmlString",error:{name:q.name,message:q.message,stack:q.stack}})}l=a.type;m=["atom","app","gd","batch","ydn"];if("sites"==l||"site"==l||"content"==l||"webpage"==l)m=m.concat("xhtml","sites");else if("m8"==l||"contact"==l)m=m.concat("gContact");p=sm(p,m);Dm.g&&(a.h=[h,f,g,e,p]);d.request(new dg(h,g,f,e,p)).execute(b,c)}else M(a.i,a+" commit ignore since not modified."),b&&b.call(c,null,null)}function Gm(a){if(null==a.id)return!0;a=Fm(a);return"modified"===a||"delete"===a}k.xc=function(){return this.data};
function Im(a){var b=new xm(null,"entry",a.xc()),c=!1;b.xmlns||(b.xmlns="http://www.w3.org/2005/Atom",c=!0);var d=["atom"],e;for(e in a.data)if(a=e.match(/^(\w+)\$\w+/))a=a[1],a in rm&&(Ta(d,a)||d.push(a));e=Bm(b);c&&delete b.xmlns;return sm(e,d)}k.update=function(a){var b=["batch$status","batch$operation","status"],c;for(c in a.data)a.data.hasOwnProperty(c)&&z(a.data[c])&&!Ta(b,c)&&!Ta(this.Dd,c)&&(this.data[c]=a.data[c])};k.Tc=function(a){return Cm(new xm(null,"entry",this.data),a)};function Jm(a,b,c){Yl.call(this,a,b,c)}D(Jm,Yl);Jm.prototype.jc=function(){return this.key};Jm.prototype.Na=function(a,b,c,d){a=Jm.q.Na.call(this,a,b,c,d);this.g.qd(a.method)&&r.gapi&&r.gapi.auth&&(b=gapi.auth.getToken())&&b.access_token&&(a.headers.Authorization=b.token_type+" "+b.access_token);if("GET"==a.method)a.params.alt="json";else if("PUT"==a.method||"POST"==a.method)d=new Dm(d),a.body=Im(d),a.headers["Content-Type"]="application/atom+xml";return a};
Jm.prototype.yc=function(a,b){a=Jm.q.yc.call(this,a,b);a.feed&&(a=a.feed);a.entry&&(a=a.entry);return a};function Km(a,b,c){em.call(this,a,b,c);a=c.Options;this.kind=a.kind;this.version=a.version;this.projection=a.projection;this.k=a.maxResults}D(Km,nm);k=Km.prototype;k.projection=null;k.version=null;k.i=P("ydn.db.sync.GData");k.S=function(a,b){return new Jm(this,a,b)};k.ra=function(){var a=Km.q.ra.call(this);a.key=["id","$t"];a.etag="gd$etag";a.updated=["updated","$t"];return a};k.sa=function(){var a=Km.q.sa.call(this);return a=a.concat(["version","projection","kind","maxResults"])};
k.Ba=function(){return"https://www.googleapis.com/"+this.kind+"/"};k.qd=function(){return!1};
function Lm(a,b,c){var d=c||a.Ba();c&&N(a.i,"continuing "+c);b=new dg(d,"GET",b);var e=new E;a.P().request(b).execute(function(b,d){if(200==d.C()){if(!b){var h=Gg(d);w(h)&&(b=JSON.parse(h))}var h=b.feed||b,l=h.entry,l=l?u(l)?l:[l]:[];0<l.length&&$l(a,l);for(var l=null,h=h.link,h=u(h)?h:[h],m=0;m<h.length;m++)"next"==h[m].rel&&(l=h[m].href);l?hb(Lm(a,{},l),e):(N(a.i,"prefetch "+a.w+" done"),e.p(!!c))}else 302==d.C()?e.p():(h=a+": Invalid response status "+d.C()+" on prefetching",K(a.i,h),e.s(Error(h)))});
return e}k.Ja=function(){N(this.i,"starting prefetch");var a=new E;Qi(this.storage.g,this.w,"updated.$t",null,!0,1).F(function(b){var c={alt:"json",kind:this.kind};this.k&&(c["max-results"]=this.k);(b=b[0])?(b=Zb(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b,N(this.i,this.w+" fetching entries later then "+b)):N(this.i,this.w+" fetching entries from beginning");hb(Lm(this,c),a)},this);return a};
k.count=function(a){var b=zh(this.j,"updated.$t");if(!b)return a;var c=Oh(a);a.t(function(a){Dc(c,a);Qi(this.storage.g,this.w,b.getName(),null,!1,1).t(function(b){var f={alt:"json"};if(b=u(b)?b[0]:b)b=Zb(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),f["updated-min"]=b;var g=this,f=new dg(this.Ba(),"GET",f);this.P().request(f).execute(function(b,e){if(200==e.C()){if(!b){var f=Gg(e);w(f)&&(b=JSON.parse(f))}f=Zb(b.feed,"openSearch$totalResults");c.p(a+parseFloat(f||0))}else K(g.i,g+":Unexpected respond status "+
e.C())})},function(a){c.s(a)},this)},function(a){c.s(a)},this);return c};function Mm(a,b,c){Yl.call(this,a,b,c)}D(Mm,Jm);function Nm(a,b,c){Km.call(this,a,b,c);this.h=this.h.substr(27);this.Ga=c.Options.prefix}D(Nm,Km);Nm.prototype.P=function(){this.g||(this.g=new Om(gapi.client));return this.g};Nm.prototype.S=function(a,b){return new Mm(this,a,b)};Nm.prototype.Ba=function(){return this.h+this.Ga};
Nm.prototype.Ja=function(){N(this.i,"starting prefetch");var a=new E;Qi(this.storage.g,this.w,"updated",null,!0,1).t(function(b){var c={alt:"json"};if(b=b[0])b=Zb(b,"updated"),b=(new Date(1+ +new Date(b))).toISOString(),c.updatedMin=b;var d=this,c=new dg(this.Ba(),"GET",c);d.P().request(c).execute(function(b,c){if(b){var g=b.items||[];0<g.length?$l(d,g).Q(function(){a.p(!0)}):a.p(!1)}else 302==c.C()?a.p():(g=d+": Invalid response status "+c.C()+" on prefetching",K(d.i,g),a.s(Error(g)))})},function(b){a.s(b)},
this);return a};function Pm(a,b){if(!t(r.AWS))throw new Ac("AWS JS SDK not loaded");this.h=a;this.j=b;this.g=null}Pm.prototype.request=function(a){return new Qm(this,a)};function Rm(a){var b={params:{Bucket:a.h,region:a.j}};if(!a.h)throw new I("bucket name required");a.g||(a.g=new AWS.S3(b));return a.g}function Qm(a,b){this.parent=a;this.g=b}
function Sm(a,b,c,d,e){var f=NaN,g="",h={};a=Rm(a.parent)[b](c);a.on("complete",function(a){a.httpResponse&&(f=a.httpResponse.statusCode,w(f)&&(f=parseInt(f,10)),h=a.httpResponse.headers);a.error&&(g=a.error.message,f||(f=400))});a.send(function(a,b){var c=new Eg(f,b,h,g);a?d.call(e,null,c):d.call(e,b,c)})}
Qm.prototype.execute=function(a,b){var c;c=(new Zc(this.g.path)).Qa;c="/"==c.charAt(0)?c.substr(1):c;var d=this.g.headers||{};c&&(d.Key=c);if(c)if("GET"==this.g.method)Sm(this,"getObject",d,a,b);else if("PUT"==this.g.method)Sm(this,"putObject",d,a,b);else throw new yc("HTTP method "+this.g.method);};function Tm(a,b){this.g=a;this.j=Um(this,"Prefix")[0];this.h=b.type}Tm.prototype.K=function(){return this.g.documentElement.getElementsByTagName("Contents").length};Tm.prototype.keys=function(){var a=Um(this,"Key");if(this.j){var b=this.j.length,a=a.map(function(a){return a.substr(b)});"INTEGER"==this.h?a=a.map(function(a){return parseInt(a,10)}):"NUMERIC"==this.h&&(a=a.map(function(a){return parseFloat(a)}))}return a};
function Um(a,b){for(var c=[],d=a.g.documentElement.getElementsByTagName(b),e=d.length,f=0;f<e;f++)c[f]=d[f].textContent;return c}function Vm(a){return Um(a,"LastModified").map(function(a){return(new Date(Date.parse(a))).toGMTString()})}
function Wm(a){var b=a.g.documentElement.getElementsByTagName("NextMarker");return 1==b.length?b[0].textContent:"true"==a.g.documentElement.getElementsByTagName("IsTruncated")[0].textContent&&(a=a.g.documentElement.firstElementChild.lastElementChild)&&"Contents"==a.tagName?a.getElementsByTagName("Key")[0]:null};function Xm(a,b,c){em.call(this,a,b,c);this.k=c.Options.bucket;if(!w(this.k)||sa(this.k))throw new I("bucket name required.");this.h||(this.h="https://"+this.k+".s3.amazonaws.com/");if(!0===b.h)throw new I('S3 object store "'+b.getName()+'" must not set autoIncrement to true.');}D(Xm,em);k=Xm.prototype;k.i=P("ydn.db.sync.S3");k.sa=function(){var a=Xm.q.sa.call(this);return a=a.concat(["bucket","maxKeys","prefix","delimiter"])};k.P=function(){this.g||(this.g=new Pm(this.k));return this.g};
k.Fc=function(a){return this.h+this.l+a};k.S=function(a,b){return new pm(this,a,b)};
k.Ic=function(a,b){var c=this;Qh(a,function(d,e,f){Dc(a,d);c.Qb(d,function(a){var e={},l=a[0]?Tl(a[0]):null;null!=l&&(e.marker=l);0<c.l.length&&(e.prefix=c.l);0<b&&(e["max-keys"]=b);N(c.i,c+" querying for newer entries starting from "+l);e=new dg(c.h,"GET",e);c.P().request(e).execute(function(b,e){if(200==e.C()){for(var h=Gg(e),h=h instanceof Document?h:Mf(h),l=new Tm(h,c.j),h=l.keys(),l=Vm(l),s=[],y=[],A=[],G=0,H=0;G<=a.length&&H<h.length;){var J=a[G]?Tl(a[G]):null,O=h[H];if(G==a.length)y.push(O),
H++;else{var ga=J?S(J,O):-1;0==ga?((O=Ul(a[G]))&&l[H]&&O!=l[H]&&(l[H]>O?A.push(J):K(c.i,'record "'+J+'" in database is more recent than server '+O+" vs "+l[H])),G++,H++):1==ga?(s.push(J),G++):(y.push(O),H++)}}jm(c,f,d,y,A,s)}else K(c.i,"Invalid response status "+e.C())})})},this)};
function Ym(a,b){function c(f){null!=f&&(d.marker=f);N(a.i,a+" querying for newer entries starting from "+f);e.request(new dg(a.h,"GET",d)).execute(function(d,e){if(200==e.C()){var f=Gg(e),f=f instanceof Document?f:Mf(f),f=new Tm(f,a.j),m=Wm(f),f=f.keys(),n=f.length;if(0==n)b([]),b=null;else for(var p=0,q=0;q<n;q++)a.S(f[q]).Ra(function(){p++;p==n&&(m?c(m):b&&(b([this.ta()]),b=null))})}else K(a.i,"Invalid response status "+e.C())})}var d={};0<a.l.length&&(d.prefix=a.l);var e=a.P();c();a.ia=!0}
function Zm(a,b){a.ia||Qh(b,function(a,b,e){t(a[0])?e(a):Ym(this,e)},a)};function $m(a,b,c){Yl.call(this,a,b,c)}D($m,pm);$m.prototype.i=P("ydn.db.sync.entry.Gcs");function an(a,b,c){Xm.call(this,a,b,c);this.h="https://"+this.k+".storage.googleapis.com/"}D(an,Xm);an.prototype.i=P("ydn.db.sync.Gcs");an.prototype.P=function(){this.g||(this.g=new Yg);return this.g};an.prototype.S=function(a,b){return new $m(this,a,b)};function Om(a,b){this.g=a;this.h=!!b}Om.prototype.request=function(a){var b={path:a.path,method:a.method,headers:a.headers,params:a.params,body:a.body};this.h&&(b.callback=function(a,e){c.p(a,e);b.callback=null});a=this.g.request(b);var c=new bn(a);return c};function bn(a){this.h=a||null}bn.prototype.p=function(a,b){this.j&&(this.j(a,Jg(b)),this.j=null);this.g={json:a,bb:b}};
bn.prototype.execute=function(a){this.h?(this.h.execute(function(b,c){a(b,Jg(c))}),this.h=null):this.g?(a(this.g.json,Jg(this.g.bb)),this.g=null):this.j=a};function fm(a){if(a){if(a instanceof Yg)return a;if(fa(a))return new Om({request:function(b){a(b)}},!0);if("request"in a)return new Om(a);throw new I(a+" is not a valid HTTP Client");}return null};function cn(a,b,c){Yl.call(this,a,b,c)}D(cn,$m);cn.prototype.i=P("ydn.db.sync.entry.GcsJson");cn.prototype.Ra=function(a){var b=this.g,c=this;am(this,function(d){var e={method:"GET",path:"storage/v1beta2/b/"+b.k+"/o/"+encodeURIComponent(c.getName())};d&&(e.headers=Wl(d));gapi.client.request(e).execute(function(d,e){c.k=new Xl(c.key,Jg(e).Za(),b.m);d?(N(c.i,c+": readServer updated"),c.j=d):(N(c.i,c+": readServer request fail "+e),c.k=null,c.j=null);a.call(c,200)},e)})};function dn(a,b,c){an.call(this,a,b,c)}D(dn,an);k=dn.prototype;k.i=P("ydn.db.sync.GcsJson");k.ra=function(){var a=dn.q.ra.call(this);a.key="name";return a};k.P=function(){if(!this.g)if(t(r.gapi))this.g=new Om(gapi.client);else throw new Ac("gapi not loaded");return dn.q.P.call(this)};k.S=function(a,b){return new cn(this,a,b)};
k.Ja=function(){M(this.i,"starting prefetch");var a=new E;Si(this.storage.g,this.w,null,null,1,0,!0,!1).t(function(b){var c={bucket:this.k};(b=b[0])&&(c.marker=b);var d=this;if(!r.yd||r.yd.client)throw Error("gapi lib not loaded");gapi.client.load("storage","v1beta2",function(){var b=gapi.client.storage.objects.list({bucket:d.k});this.Ga&&(c.prefix=this.Ga);b.execute(function(b,c){if(b&&!b.error){var e=b.items||[];0<e.length?$l(d,null,e).Q(function(){a.p(!0)}):a.p(!1)}else e=d+": "+c,K(d.i,e),a.s(Error(e))})})},
function(b){a.s(b)},this);return a};function en(a,b,c){an.call(this,a,b,c);this.H="full"}D(en,an);k=en.prototype;k.i=P("ydn.db.sync.GcsMeta");k.ra=function(){var a=en.q.ra.call(this);a.key="name";return a};k.P=function(){!this.g&&gapi&&(this.g=new Om(gapi.client));return en.q.P.call(this)};k.S=function(a,b){return new cn(this,a,b)};
k.Ja=function(){M(this.i,"starting prefetch");var a=new E;if(!r.gapi||!r.gapi.client)throw Error("gapi lib not loaded");var b=this;gapi.client.load("storage","v1beta2",function(){function c(e){e&&(d.pageToken=e);gapi.client.storage.objects.list(d).execute(function(e,g){if(e&&!e.error){var h=e.items||[];if(e.nextPageToken)N(b.i,"receiving "+h.length+" meta records, continuing next"),$l(b,h),c(e.nextPageToken);else if(0<h.length)$l(b,h).Q(function(){N(b.i,"receiving "+h.length+" meta records, prefetching dane.");
a.p(!0)});else{var l=!!d.pageToken;N(b.i,"prefetching done");a.p(l)}}else l=b+": "+g,K(b.i,l),a.s(Error(l))})}var d={bucket:b.k};this.Ga&&(d.prefix=this.Ga);c()});return a};k.Qb=function(a,b){if(0==a.length)b([]);else{var c=this.w,d=Oa(a,function(a){return new X(c,a)});im(this,d).t(function(d){for(var f=[],g=0;g<a.length;g++)f[g]=new Sl(a[g],d[g],this.m,c);b(f)},function(a){K(this.i,this+" error loading meta data "+a);b([])},this)}};function fn(a,b,c){em.call(this,a,b,c)}D(fn,em);fn.prototype.Fc=function(a){return this.h+this.l+this.w+this.da+a};fn.prototype.i=P("ydn.db.sync.Json");
fn.prototype.Ic=function(a){function b(a,b){var c=new dg(e);d.P().request(c).execute(function(c){if(200==c.status){var e=(c.response instanceof Object?c.response:If(c.responseText)).items;c=Oa(e,function(a){return a.id});for(var e=Oa(e,function(a){return a.updated}),h=[],p=[],q=[],s=0,y=0;s<=a.length&&y<c.length;){var A=Tl(a[s]),G=c[y];if(s==a.length)p.push(G),y++;else{var H=S(A,G);0==H?((G=Ul(a[s]))&&e[y]&&G!=e[y]&&(new Date(e[y])>G?q.push(A):K(d.i,'record "'+A+'" in database is more recent than server '+
G+" vs "+e[y])),s++,y++):1==H?(h.push(A),s++):(p.push(G),y++)}}jm(d,function(){},b,p,q,h)}else K(d.i,"Invalid response status "+c.status)})}var c=new Cc,d=this,e=this.h+this.l+this.w;a.F(function(a){Dc(c,a);this.Qb(a,function(c){b(c,a)})},this)};function gn(a,b,c){em.call(this,a,b,c)}D(gn,nm);function hn(a,b,c){Yl.call(this,a,b,c)}D(hn,pm);hn.prototype.i=P("ydn.db.sync.entry.S3Meta");function jn(a,b,c){Xm.call(this,a,b,c);this.Ga=c.Options.prefix;if("Key"!=b.keyPath)throw new I('s3-meta store "'+b.getName()+'" must use inline key with keyPath "Key"');this.H="meta"}D(jn,Xm);k=jn.prototype;k.i=P("ydn.db.sync.S3Meta");k.ra=function(){var a=jn.q.ra.call(this);a.key="Key";a.modified="LastModified";a.etag="ETag";return a};k.S=function(a,b){return new hn(this,a,b)};
k.Ja=function(){function a(f){f&&(e.marker=f);c.listObjects(e).send(function(c,f){if(c){var l=d+": "+Jf(c);K(d.i,l);b.s(c instanceof Error?c:Error(l))}else{var m=f.Contents||[];f.IsTruncated?(N(d.i,"receiving "+m.length+" meta records, continuing next"),$l(d,m),a(m[m.length-1].Key+"\uffff")):0<m.length?$l(d,m).Q(function(){N(d.i,"receiving "+m.length+" meta records, prefetching dane.");b.p(!0)}):(l=!!e.marker,N(d.i,"prefetching done"),b.p(l))}})}M(this.i,"starting prefetch");var b=new E,c=Rm(this.P()),
d=this,e={};this.Ga&&(e.prefix=this.Ga);a();return b};k.Qb=function(){throw new Ac("loading meta data should not be necessary");};function kn(a,b,c){Yl.call(this,a,b,c)}D(kn,Jm);function ln(a,b,c){Km.call(this,a,b,c);a=c.Options;this.domain=a.domain;this.ia=a.siteName;if(a=Ah(b,"sites$parent"))ij(a,function(a){for(var b=a.link||[],c=0;c<b.length;c++)if("http://schemas.google.com/sites/2008#parent"==b[c].rel)return b[c].href;return a.id.$t.replace(/\w+$/,"0")}),L(this.i,"index sites$parent in "+b.getName()+" has set a generator.");if(a=Ah(b,"alternate"))ij(a,function(a){a=a.link||[];for(var b=0;b<a.length;b++)if("alternate"==a[b].rel)return a[b].href}),L(this.i,"index alternate in "+
b.getName()+" has set a generator.")}D(ln,Km);k=ln.prototype;k.S=function(a,b){return new kn(this,a,b)};k.sa=function(){var a=ln.q.sa.call(this);return a=a.concat(["domain","siteName"])};k.Ba=function(){return"https://sites.google.com/feeds/content/"+this.domain+"/"+this.ia+"/"};k.qd=function(a){return"GET"!=a};
function mn(a,b,c,d){var e={alt:"json",kind:a.kind};"sites$parent"==c?(c=d.match(/\w+$/)[0],e.parent=c):"alternate"==c&&(c=d.replace(/https:\/\/sites.google.com\/a\/[^\/]+\/[^\/]+/,""),e.path=c);var f={},g=a.Ba();Qh(b,function(c,l,m){Dc(b,c);if(l=c[0])l=Zb(l,"updated","$t"),l=(new Date(1+ +new Date(l))).toISOString(),e["updated-min"]=l;l=new dg(g,"GET",e,f);a.P().request(l).execute(function(b,e){if(200==e.C()){if(!b){var f=Gg(e);w(f)&&(b=JSON.parse(f))}var g=(f=(b.feed||b).entry)?u(f)?f:[f]:[];0<
g.length?$l(a,g).Q(function(){m(g)}):m(c)}else 302==e.C()?m(c):(f=a+": Invalid response status "+e.C()+" for querying pageName: "+d,K(a.i,f),m(Error(f),!0))})},a)}k.wc=function(a,b,c){if(lm(this))Qh(a,function(d,e,f){Dc(a,d);mm(this,function(a){!0===a?Qi(this.storage.g,this.w,b,R.only(c),!1,0).t(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(a){f(a,!0)},this)},this);else return"alternate"==b||"alternate"==b?mn(this,a,b,c):ln.q.wc.call(this,a,b,c)};vi.prototype.g=null;
Nj.prototype.Yc=function(a,b){var c=b.format;if("gdata-sites"==c)a.g=new ln(this,a,b);else if("gdata"==c)a.g=new Km(this,a,b);else if("gdata-json"==c)a.g=new Nm(this,a,b);else if("odata"==c)a.g=new gn(this,a,b);else if("s3"==c)a.g=new Xm(this,a,b);else if("s3-meta"==c)a.g=new jn(this,a,b);else if("gcs"==c)a.g=new an(this,a,b);else if("gcs-json"==c)a.g=new dn(this,a,b);else if("gcs-meta"==c)a.g=new en(this,a,b);else if("atom"==c)a.g=new nm(this,a,b);else if("json"==c)a.g=new fn(this,a,b);else if("rest"==
c)a.g=new em(this,a,b);else throw new yc("Sync format: "+c);rj(a,function(b,c){var f=b.zc();if(!(this instanceof ti)||this.ka)if(!window.navigator||!t(window.navigator.onLine)||window.navigator.onLine)if("add"==f)f=c[1],a.g.add(b,f);else if("count"==f)c[1]||c[2]||a.g.count(b);else if("put"==f){var f=c[1],g=c[2];a.g.put(b,f,g)}else if("rm:iter"==f)g=c[1],a.g.remove(b,g);else if("values:iter:index"==f){var f=c[1],g=c[2],h=c[3],l=c[4],m=c[5];!h&&!m&&g&&null!=g.lower&&null!=g.upper&&0==S(g.lower,g.upper)&&
a.g.wc(b,f,g.lower)}else if("keys"==f)g=c[1],l=c[2],h=c[3],m=c[4],a.g.keys(b,null,g,l,h,m,!1);else if("keys:iter:index"==f)f=c[1],g=c[2],l=c[3],h=c[4],m=c[5],a.g.keys(b,f,g,l,h,m,c[6]);else if("values"==f)g=c[1],l=c[2],h=c[3],m=c[4],g||m?g&&g.lower&&w(g.lower)&&g.lower==g.upper||!g&&m&&1==l&&h&&Zm(a.g,b):a.g.values(b,l,h);else if(""!=f)if("get"==f)g=c[1],a.g.get(b,g);else if("values:array"==f)km(a.g,b,c[1]);else throw Error(f);})};var nn={stores:[{name:"gdata-contact",keyPath:"id.$t",type:"TEXT",indexes:[{name:"updated.$t",type:"TEXT"},{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[];a=u(a.gd$email)?a.gd$email:z(a.gd$email)?[a.gd$email]:[];for(var c=0;c<a.length;c++){var d=Mk(a[c].address);d&&b.push(d)}return b}},{name:"ydn$externalIds",multiEntry:!0,generator:function(a){return(u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[]).map(function(a){return a.value})}}]}]},
vl=new wl(void 0,nn);function on(a){var b=a+"-gdata";a=vl.getName();if(a!=b){a?vl=new wl(b,nn):Bj(vl,b);var c="reload-versionchange"+vl.getName();ul("ready",function(){M(Bl,"db "+b+" connected.");window.sessionStorage.removeItem(c)})}}ul("fail",function(a){M(Bl,"database fail "+a.name);var b="reload-versionchange"+vl.getName();if(a.error&&"versionchange"==a.error.name){if(window.sessionStorage.getItem(b))throw a;window.sessionStorage.setItem(b,"1");location.reload()}else throw vl=null,a;});
function pn(){return{stores:[{name:"Meta"},{name:"Accounts",keyPath:"id",indexes:[{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[],c;for(c in a)if(qa(c,"email")){var d=Mk(a[c]);d&&b.push(d)}return b}},{name:"account_name"},{name:"first_name"},{name:"full_name"},{name:"last_name"},{name:"date_modified"}]},{name:"Contacts",keyPath:"id",indexes:[{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[],c;for(c in a)if(qa(c,"email")){var d=Mk(a[c]);d&&b.push(d)}return b}},{name:"account_name"},
{name:"first_name"},{name:"full_name"},{name:"last_name"},{name:"date_modified"}]},{name:"Leads",keyPath:"id",indexes:[{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[],c;for(c in a)if(qa(c,"email")){var d=Mk(a[c]);d&&b.push(d)}return b}},{name:"account_name"},{name:"first_name"},{name:"full_name"},{name:"last_name"},{name:"date_modified"}]},{name:"Opportunities",keyPath:"id",indexes:[{name:"account_id"},{name:"date_modified"}]},{name:"Teams",keyPath:"id",indexes:[{name:"account_id"},
{name:"date_modified"}]},{name:"Tasks",keyPath:"id",indexes:[{name:"account_id"},{name:"date_modified"}]},{name:"TeamSets",keyPath:"id",indexes:[{name:"account_id"},{name:"date_modified"}]}]}};var qn="Accounts Contacts Employees Leads Opportunities Tasks Teams TeamSets Users".split(" "),rn="Accounts Contacts Leads Opportunities Tasks Teams".split(" ");function sn(a,b,c){b&&(b.gd$city&&a[c+"_address_city"]!=b.gd$city.$t&&(a[c+"_address_city"]=b.gd$city.$t),b.gd$country&&a[c+"_address_country"]!=b.gd$country.$t&&(a[c+"_address_country"]=b.gd$country.$t),b.gd$postcode&&a[c+"_address_postalcode"]!=b.gd$postcode.$t&&(a[c+"_address_postalcode"]=b.gd$postcode.$t),b.gd$region&&a[c+"_address_state"]!=b.gd$region.$t&&(a[c+"_address_state"]=b.gd$region.$t),b.gd$street&&a[c+"_address_street"]!=b.gd$street.$t&&(a[c+"_address_street"]=b.gd$street.$t),b.gd$housename&&
a[c+"_address_street_2"]!=b.gd$neighborhood.$t&&(a[c+"_address_street_2"]=b.gd$neighborhood.$t),b.gd$neighborhood&&a[c+"_address_street_3"]!=b.gd$city.$t&&(a[c+"_address_street_3"]=b.gd$city.$t))};function tn(a){if(u(a))return a.map(function(a){return tn(a)});if(z(a)){var b={},c;for(c in a.name_value_list)b[c]=a.name_value_list[c].value;return b}throw Error("Invalid name_value_entries");};function un(a,b,c,d){b=qa(b,"http")?new Zc(b):$c(ad(new Zc,b),"https");ed(b,"");dd(b,null);this.u=b.Ea;this.o=b.toString().replace(/\/$/,"");this.G=this.o+"/service/v4/rest.php";this.k=c;this.l=d;this.g=null;this.j=a;this.db=new wl(this.u,pn());this.h=null;this.m=this.n=NaN;this.B=!1}D(un,Sg);k=un.prototype;
k.request=function(a,b,c,d,e,f){function g(){m.execute(function(g,h){this.n=C();if(!f&&g&&11==g.number)this.Rb().t(function(){this.request(a,b,c,d,e,!0)},function(){d.call(e,null,new Eg(0,null,{},"Login fail"))},this);else{var l=g;if(w(l))try{g=JSON.parse(l)}catch(m){}d.call(e,g,h)}},this)}for(var h="{",l=0;l<b.length;l++)h+=(0==l?"":",")+'"'+b[l]+'":'+JSON.stringify(c[l]);h+="}";l=new fd;l.add("method",a);l.add("input_type","json");l.add("response_type","json");l.add("rest_data",h);Cl();var m=this.j.request(new dg(this.G,
"POST",{},{"Content-Type":"application/x-www-form-urlencoded"},l.toString())),h=C()-this.n;0<h&&100>h?(this.n=100+this.n,N(this.i,"request will call after "+h+" ms."),Td(g,h,this)):g.call(this)};
function vn(a,b,c){var d=["session","module_name"];a=[a.g?a.g.id:null,c.module_name];var e=[!1,!1];if("get_entry_list"==b)b=c.query||"",d.push("query"),a.push(b),e.push(""==b),d.push("order_by"),b=c.order_by||"",a.push(b),e.push(""==b),b=c.offset||0,d.push("offset"),a.push(b),e.push(0==b),b=c.select_fields||[],d.push("select_fields"),a.push(b),e.push(0==b.length),b=c.link_name_to_fields_array||[],d.push("link_name_to_fields_array"),a.push(b),e.push(0==b.length),b=c.max_results||25,d.push("max_results"),
a.push(b),e.push(null!=c.max_results),b=c.deleted||0,d.push("deleted"),a.push(b),e.push(0==b),c=!!c.favorites,d.push("favorites"),a.push(c),e.push(!1==c);else if("get_available_modules"==b)c=c.filter||"",d.push("filter"),a.push(c),e.push(0==c.length);else if("get_module_fields"==b)c=c.fields||[],d.push("fields"),a.push(c),e.push(0==c.length);else if("get_entries"==b)b=c.ids||[],d.push("ids"),a.push(b),e.push(!1),b=c.select_fields||[],d.push("select_fields"),a.push(b),e.push(0==b.length),b=c.link_name_to_fields_array||
[],d.push("link_name_to_fields_array"),a.push(b),e.push(0==b.length);else for(var f in c)"module_name"!=f&&(d.push(f),a.push(c[f]),e.push(!1));for(c=e.length-1;0<=c;c--)if(e[c])d.pop(),a.pop();else break;return{keys:d,values:a}}
function wn(a,b){var c=b.module_name;a.m=C();return xn(a,"get_entry_list",b).F(function(a){var e=a.result_count,f=a.offset||0,g=a.entry_list,h=parseInt(a.next_offset,10);if(t(e)&&u(g))return 0<g.length&&(a=tn(g),this.db.put(c,a)),0<g.length&&e>=g.length&&h>f?(b.offset=h,wn(this,b)):h;throw Error("Invalid REST respond on entry list query on "+c+": "+JSON.stringify(a));},a)}
function yn(a,b){if(-1==qn.indexOf(b))return kb("module name "+b+" invalid.");var c={module_name:b},d="module/"+b;return a.db.get("Meta",d).F(function(a){return a?a:xn(this,"get_module_fields",c).F(function(a){this.db.put("Meta",a,d);return a},this)},a)}function zn(a,b){var c=new Hh(b,"date_modified",null,!0);return a.db.keys(c,1).F(function(a){var c={};a[0]&&(c.query=b.toLowerCase()+".date_modified>'"+a[0]+"'");c.module_name=b;c.order_by="date_modified";return wn(this,c)},a)}
function xn(a,b,c,d){var e=d||0,f=new E;if(!a.g||!a.g.id)return 2>e?(N(a.i,"Request require login, tried "+e),a.Rb().F(function(){e++;hb(xn(a,b,c,e),f)})):(M(a.i,"Cannot do request, not login. Give up after "+e+" retry"),f.s()),f;d=vn(a,b,c);a.request(b,d.keys,d.values,function(d,h){h.Z()?11==d.number&&/invalid/i.test(d.name)?(this.g=null,hb(xn(a,b,c,e),f)):f.p(d):f.s(h.C()+" "+h.ba())},a);return f}
k.list=function(a){if(!u(a)||0==a.length)return kb("invalid query");for(var b=[],c=0;c<a.length;c++){var d=a[c];if(!z(d))return kb("invalid query at "+c+"");var e=d.store;if(!w(e)||0==e.length)return kb("store name required at "+c);var f=d.index;if(!w(f)||0==f.length)return kb("index name missing in "+e);var g=null;null!=d.key?g=R.only(d.key):null!=d.keyRange&&(g=bh(d.keyRange));"id"==f?b.push(this.db.values(e,g)):b.push(this.db.values(e,f,g))}return(new Qj(b)).t(function(b){for(var c=0;c<b.length;c++)b[c][0]?
a[c].result=b[c][1]:(K(this.i,"query "+c+" failed."),a[c].result=[]);return a},function(b){K(this.i,"list failed "+b);return a},this)};function An(a,b){var c=b.store;if(!w(c)||0==c.length)return kb("store name required.");var d=b.id;return w(d)&&0!=d.length?a.db.get(c,d):kb("id required.")}
function Bn(a){if(a.h&&a.h.isLogin)return jb(a.h);var b=new E;a.db.get("Meta","info/server").Q(function(a){a&&a.version?(this.h=a,b.p(a)):this.request("get_server_info",[],[],function(a,c){if(0==c.C())this.h=null,b.s("service "+this.G+" not responding");else if(c.Z()){var f=Gg(c);if((!a||!a.version)&&w(f))try{a=JSON.parse(f)}catch(g){a=Gg(c)}a&&a.version?(f=a,this.h=$b(f),b.p({info:f,about:this.Va()}),this.db.put("Meta",f,"info/server")):(this.h=null,b.s("invalid respond "+Gg(c)))}else this.h=null,
b.s("request fail "+c.C()+" "+c.ba())},this)},a);return b}function Cn(a){var b=new E;a.request("get_available_modules",["filter"],["all"],function(a){b.p(a)},a);return b}k.Va=function(){var a=this.j,a=a instanceof Vg&&/proxy/.test(a.h);return{baseUrl:this.o,domain:this.u,userName:this.k,isLogin:this.isLogin(),hostPermission:!a}};function Dn(a){return(new Qj([Bn(a),Cn(a)])).F(function(a){return{serverInfo:a[0][1],availableModules:a[1][1],about:this.Va()}},a)}
function En(a,b,c){var d=[],e;for(e in c)d.push({name:e,value:c[e]});c={module_name:b,name_value_list:d};window.console.log("set_entry",c);return xn(a,"set_entry",c).F(function(a){if(a&&a.id){var c={id:a.id};a=a.entry_list||{};for(var d in a)c[d]=a[d].value;window.console.log("set_entry result",c);this.db.put(b,c);return c}throw Error("creating "+b+" entry fail");},a)}
function Fn(a,b,c){var d={},e=0;!c.title||d.name&&d.name==c.title.$t||(d.name=c.title.$t,e++);for(var f=0;c.gd$email&&f<c.gd$email.length;f++){var g=c.gd$email[f];"http://schemas.google.com/g/2005#work"==g.rel?d.email1!=g.address&&(e++,d.email1=g.address):"http://schemas.google.com/g/2005#home"==g.rel?d.email2!=g.address&&(e++,d.email2=g.address):"http://schemas.google.com/g/2005#other"==g.rel&&d.email!=g.address&&(e++,d.email=g.address)}c.gd$name?(c.gd$name.gd$namePrefix&&d.salutation!=c.gd$name.gd$namePrefix.$t&&
(e++,d.salutation=c.gd$name.gd$namePrefix.$t),c.gd$name.gd$givenName&&d.first_name!=c.gd$name.gd$givenName.$t&&(d.first_name=c.gd$name.gd$givenName.$t,e++),c.gd$name.gd$familyName&&d.last_name!=c.gd$name.gd$familyName.$t&&(d.last_name=c.gd$name.gd$familyName.$t,e++),c.gd$name.gd$fullName&&d.full_name!=c.gd$name.gd$fullName.$t&&(d.full_name=c.gd$name.gd$fullName.$t,e++)):d.full_name=c.title.$t;c.gd$organization&&c.gd$organization[0]&&(f=c.gd$organization[0],f.gd$orgTitle&&f.gd$orgTitle.$t!=d.title&&
(d.title=f.gd$orgTitle.$t,e++),f.gd$orgDepartment&&f.gd$orgDepartment.$t!=d.department&&(d.department=f.gd$orgDepartment.$t,e++),f.gd$orgJobDescription&&f.gd$orgJobDescription.$t!=d.description&&(d.description=f.gd$orgJobDescription.$t,e++));if(c.gd$im)for(f=0;f<c.gd$im.length;f++)"Twitter"==c.gd$im[f].label&&d.twitter!=c.gd$im[f].address?(d.twitter=c.gd$im[f].address,e++):"Facebook"==c.gd$im[f].label&&d.facebook!=c.gd$im[f].address?(d.facebook=c.gd$im[f].address,e++):"Google Plus"==c.gd$im[f].label&&
d.googleplus!=c.gd$im[f].address?(d.googleplus=c.gd$im[f].address,e++):"Linkedin"==c.gd$im[f].label&&d.linkedin!=c.gd$im[f].address&&(d.linkedin=c.gd$im[f].address,e++);c.gContact$birthday&&d.birthdate!=c.gContact$birthday.when&&(d.birthdate=c.gContact$birthday.when,e++);for(f=0;c.gd$phoneNumber&&f<c.gd$phoneNumber.length;f++)if(g=c.gd$phoneNumber[f],g.$t)if("http://schemas.google.com/g/2005#mobile"==g.rel)d.phone_mobile!=g.$t&&(d.phone_mobile=g.$t,e++);else if("http://schemas.google.com/g/2005#work"==
g.rel)d.phone_work!=g.$t&&(d.phone_work=g.$t,e++);else if("http://schemas.google.com/g/2005#home"==g.rel)d.phone_home!=g.$t&&(d.phone_home=g.$t,e++);else if("http://schemas.google.com/g/2005#fax"==g.rel||"http://schemas.google.com/g/2005#home_fax"==g.rel||"http://schemas.google.com/g/2005#work_fax"==g.rel)d.phone_fax!=g.$t&&(d.phone_fax=g.$t,e++);else if(d.phone_other=g.$t)d.phone_other=g.$t,e++;if(c.gd$structuredPostalAddress){g=e=-1;for(f=0;f<c.gd$structuredPostalAddress.length;f++){var h=c.gd$structuredPostalAddress[f];
"http://schemas.google.com/g/2005#work"==h.rel||h.primary?e=f:g=f}-1==e&&(g=-1);sn(d,c.gd$structuredPostalAddress[e],"primary");sn(d,c.gd$structuredPostalAddress[g],"alt")}return En(a,b,d)}k.isLogin=function(){return!(!this.g||!this.g.id)};
k.update=function(){if(this.j&&this.j instanceof Vg)L(this.i,"Updating skipped on http client on proxy");else{var a;if(this.B)L(this.i,"Modules are already updating now at "+a+" / "+rn.length);else{this.B=!0;this.m=C();a=0;var b=this,c=function(){var d=rn[a];d?(M(b.i,"Syncing module "+d),a++,zn(b,d).Q(function(){b.m=C();r.setTimeout(function(){c()},500)})):(L(b.i,"Updating module done"),b.B=!1)};c();r.setTimeout(function(){2E3<b.m-C()&&c()},2E3)}}};
k.Rb=function(a,b){a&&(this.k=a);b&&(this.l=b);if(!this.k)return kb("username required.");if(!this.l)return kb("password required.");var c=new E;this.request("login",["user_auth","application_name","name_value_list"],[{user_name:this.k,password:this.l},"Yathit CRM",{language:"",notifyonsave:"false"}],function(a,b){if(a&&a.id)this.g=$b(a),c.p(a);else if(a&&a.description)c.s(a.description+" ("+a.name+")");else{var f=b.C()+" "+b.ba()+" "+Gg(b);c.s("Login fail: "+f.substr(0,200))}},this,!0);return c};
function Gn(a){var b=new E;a.request("logout",[],[],function(a,d){this.g=null;d.Z()?(K(this.i,"Logout request fail with "+d.C()+" "+d.ba()),b.p(!0)):b.s(d.C()+" "+d.ba())},a,!0);return b}
function Hn(a){function b(){f.request(new dg(e.toString())).execute(function(a,b){/sugarcrm/i.test(Gg(b))?d.s("Look like SugarCRM web site, but REST V4 API is not available."):200==b.C()?d.s("Not a SugarCRM web site"):d.s("Invalid respond, "+b.C())})}function c(a,b){var c=new fd;c.add("method","get_server_info");c.add("input_type","json");c.add("response_type","json");c.add("rest_data","{}");f.request(new dg(a,"POST",{},{"Content-Type":"application/x-www-form-urlencoded"},c.toString())).execute(b)}
var d=new E;a=a.trim();qa(a,"http")||(a="https://"+a);var e=new Zc(a);ed(e,"");dd(e,null);var f=bg("proxy"),g=e.T();a=e.Qa;/rest.php$/.test(a)||(/index.php$/.test(a)?cd(g,a.replace("/index.php","")):cd(g,""));var h=g.toString();(function(a,b){c(a+"/service/v4/rest.php",function(a,c){if(200==c.C()){if(!a||!a.version){var d=Gg(c);if(w(d))try{a=JSON.parse(d)}catch(e){b(null,c);return}else a=d}a&&a.version&&b(a,c)}else b(0,c)})})(h,function(a,f){a?(a.isLogin=!1,a.userName=null,a.domain=g.Ea,a.baseUrl=
h,d.p(a)):0==a?"https"==e.Sa?($c(g,"http"),setTimeout(function(){c(g.toString(),function(a,c){c.Z()?d.p(a):b()})},100)):d.s(f.C()+" "+f.ba()+" "+Gg(f)):b()});return d}k.toString=function(){return"SugarClient:"+this.u};function In(a){Error.captureStackTrace?Error.captureStackTrace(this,In):this.stack=Error().stack||"";a&&(this.message=String(a))}D(In,Error);In.prototype.name="ydn.gdata.error.InvalidAtomFormatError";function Jn(a){Error.captureStackTrace?Error.captureStackTrace(this,Jn):this.stack=Error().stack||"";a&&(this.message=String(a))}D(Jn,Error);Jn.prototype.name="ydn.gdata.error.IncompatibleError";var Kn="atom app gd xhtml batch openSearch".split(" ");function Ln(a){if(!t(this.type))throw new Uf("Abstract class cannot be instantiated.");if(w(a))a={id:{$t:a}};else if(!t(a.id)||!w(a.id.$t))throw new Pf("Invalid GDataFeed");this.id=a.id.$t;this.data=a;t(this.data.entry)?u(this.data.entry)||(this.data.entry=[this.data.entry]):this.data.entry=[];this.k={};this.m={};a=u(this.data.entry)?this.data.entry.length:0;for(var b=0;b<a;b++){var c=this.data.entry[b],c=c.id?c.id.$t:c.vd?c.vd.$t:"";if(0==c.length)throw new In("entry "+b);if(0==c.match(/\w+$/)[0].length)throw new In("entry "+
b+" of "+c);var d=c.match(/\w+$/)[0];this.k[c]=this.data.entry[b];this.m[d]=this.data.entry[b]}this.j=!0;this.u=[];this.o=new xf(function(){this.dispatchEvent(Mn)},300,this);this.Oc=null;this.h=NaN;this.n=void 0}D(Ln,Ef);var Mn="i";k=Ln.prototype;k.Wc=function(){return this.kind};k.i=P("ydn.gdata.Feed");
k.ab=function(a){var b=new E;N(this.i,this+" receiving a task, ready: "+this.j);var c=this;this.j?(this.j=!1,b.Q(function(){N(c.i,c+" finish the task.");c.j=!0;var a=c.u.shift();a&&a.call(this)}),a.call(this,b)):this.u.push(ma(B(a,this),b));return b};k.Oc=null;k.Gc=function(){this.dispatchEvent("e")};k.ed=function(){return Kn};k.xd=function(a){a.g()||K(this.i,"Batch submission failed. "+a.responseText)};
k.Xa=function(a,b){var c=this.ed(),d=void 0;t(c)||(c=Kn);for(var e="",f=0;f<c.length;f++)var g=c[f],e=0==f?e+(' xmlns="'+rm[g]+'" '):e+(" xmlns:"+g+'="'+rm[g]+'" ');d=t(d)?"<id>"+d+"</id>":"";d=Mf("<feed"+e+">"+d+"</feed>");for(f=c=0;e=this.Ya(f);f++)if("gd:deleted"==Fm(e.data))Em(e,"");else if(Gm(e.data)){var g="delete"==Fm(e.data),h=!(!e.data.id||!e.data.id.$t);Em(e,null);var l=e.Tc(d.documentElement),m=l.getElementsByTagNameNS(rm.batch||rm.xhtml,"operation");m[0]?m=m[0]:m=l.appendChild(d.createElementNS(rm.batch||
rm.xhtml,"operation"));l=d.createAttribute("type");l.nodeValue=g?"delete":h?"update":"insert";m.setAttributeNode(l);Em(e,"committed");c++;a&&a.message({id:this.Vc(),code:"operation: "+l.nodeValue+" "+e})}if(0==c)return L(this.i,this+" Nothing to commit."),0;L(this.i,this+" committing "+c+" entries.");d=Nf(d);b?(this.i.info("Commit ignored for dry run."),window.console.log(d)):(e=B(this.xd,this),this.B&&this.B.stop(),f=this.Oc||yg(this.rb()),g=this.vc(),f.send(g,e,{method:"POST",body:d,headers:{"Content-Type":"application/atom+xml"},
params:{}}));return c};k.kc=function(a){return new Dm(a)};k.Ya=function(a){return 0<=a&&a<this.data.entry.length?this.kc(this.data.entry[a]):null};k.Uc=function(a){return(a=this.k[a])?this.kc(a):null};
k.save=function(a){if(this.G){var b=this;this.l||(this.l=new xf(function(){this.ab(function(a){var d=b.toJSON(),e=b.data.entry,f,g,h;b.G.N(function(a){a.put("ydn.gdata.feed",d).gb(function(a){throw a;}).F(function(){f=!0});a.put("ydn.gdata.entry",e).gb(function(a){throw a;}).F(function(a){h=a.length;g=!0})},["ydn.gdata.feed","ydn.gdata.entry"],"readwrite").t(function(){f&&g?N(this.i,b+": saved "+h+" entries."):N(this.i,b+": saved failed"+e.length+" entries.");a.p(!0)},function(a){throw a;},this)})},
1E3,this));a?zf(this.l):yf(this.l)}};
function Nn(a,b,c){c=c||new E;var d=a.Oc||yg(a.rb());if(!d)return K(a.i,a+": No transport available."),c.s(Error("No transport available.")),c;d.send(b,function(b){if(200==b.status){a.h=C();b=b.D?Ud(b.D.responseText):void 0;if(!b.feed)throw new In("feed missing.");var d=b.feed;if(!t(d))throw b=Q(d),new In(b.substr(0,50));if(d.id.$t!=a.sb())throw new Jn(d.id.$t+" is not "+a.sb());var g=b=0,h=u(d.entry)?d.entry:d.entry?[d.entry]:[];b=h.length;0==b&&N(a.i,a+": fetch return no result.");for(var l=0;l<
b;l++){for(var m=a,n=h[l],p=n instanceof Dm?n:m.kc(n),q=p,s=0;s<q.Wa.length;s++)null!=q.data[q.Wa[s]]&&!u(q.data[q.Wa[s]])&&(q.data[q.Wa[s]]=[q.data[q.Wa[s]]]);Em(q,null);q=q.data;q.batch$status&&(q.batch$status=void 0);q.batch$operation&&(q.batch$operation=void 0);var q=p.Pc(),y=m.Uc(q);(s=!!y)?y.update(p):(y=p.id.match(/\w+$/)[0],m.data.entry.push(n),m.k[q]=p.data,m.m[y]=p.data);!s&&g++}L(a.i,a+" "+b+" ("+g+" new) entries received");a.Gc();(d=Kl(d,"next"))?(a.save(),yf(a.o),a.n=d.$t,Nn(a,d.href,
c)):(0<b&&(a.save(),yf(a.o)),c.p(!0))}else K(a.i,"Fetching "+b.uri+" failed: "+b.status),c.s(!1)});return c}k.toString=function(){return this.type+":"+this.id};function On(a,b){a.ud&&b.g.set("v",a.ud);b.g.set("alt","json");b.g.set("showdeleted",!0)}
function Qn(a,b){var c="lu",d=!1;if("lf"==c){if(a.h){var d=!0,e=new Date(a.h),e=e.toISOString();b.g.set("updated-min",e)}}else if("lu"==c){for(var e=0,f=-1,g,h=0;g=a.Ya(h);h++)g=g.data.updated.$t,e<g&&(e=g,f=h);if(e=a.Ya(f))e=new Date(e.data.updated.$t),e=new Date(1+ +e),e=e.toISOString(),b.g.set("updated-min",e)}else"lo"==c?(b.g.set("orderby","lastmodified"),a.h&&b.g.set("max-results","1")):c="no";N(a.i,a+" updating "+(d?"continue":"begin")+" by "+c)}k.Md=om.prototype.cc;k.sb=om.prototype.Pc;
k.Od=om.prototype.Ld;k.Nd=om.prototype.Kd;k.rb=function(){return this.Od()||""};k.Vc=function(){return this.id};k.vc=function(){return this.Nd()};function Rn(a){return a.ab(function(a){var c=new Zc(this.rb());On(this,c);Qn(this,c);this.O(Cf,!1);Nn(this,c.toString()).Q(function(c){Ff(this);c?a.p(!0):a.s(void 0)},this)})}k.update=function(a){return a||!0!==("undefined"==typeof this.g?null:(this.g&Cf)==Cf)?Rn(this):(N(this.i,this+" already loaded."),jb(!1))};
k.count=function(a){if(a){a=0;for(var b,c=0;b=this.Ya(c);c++)"gd:deleted"==Fm(b.data)||"deleted"==Fm(b.data)||a++;return a}return this.data.entry.length};k.toJSON=function(){return{id:this.id,key:this.Vc(),last_fetch_next_uri:this.n,last_fetch:this.h}};function Sn(a){Dm.call(this,a);a=(a=this.id.match(/https?:\/\/www.google.com\/m8\/feeds\/(group|contact|batch)s?\/([^\/]+)\/?(\w+)\/?(\w*)?/))?{Xd:"m8",kind:a[1],user_id:a[2]?a[2].replace("%40","@"):"",projection:a[3],id:a[4]}:null;window.console.assert(!!a,"Invalid m8 entry: "+this.id);this.user_id=a.user_id;window.console.assert(a.kind==this.kind,"Invalid kind: "+a.kind+" vs "+this.kind)}D(Sn,Dm);Sn.prototype.i=P("ydn.gdata.m8.Entry");Sn.prototype.g="3.0";Sn.prototype.type="m8";function Tn(a){if(!t(this.kind))throw new Uf("Abstract class cannot be instantiated.");Ln.call(this,a);this.user_id=this.sb()}D(Tn,Ln);k=Tn.prototype;k.Wc=function(){return this.kind};k.ud="3.0";k.type="m8";k.toString=function(){return"Feed:"+this.kind+":"+this.user_id};k.rb=function(){return"https://www.google.com/m8/feeds/"+this.Wc()+"s/"+this.user_id.replace("@","%40")+"/full?v=3.0"};
k.vc=function(){var a=Tn.q.vc.call(this);return a?a:"https://www.google.com/m8/feeds/"+this.Wc()+"s/"+this.user_id.replace("@","%40")+"/full/batch?v=3.0"};var Un=Kn.concat(["gContact"]);Tn.prototype.ed=function(){return Un};function Vn(a){Sn.call(this,a)}D(Vn,Sn);k=Vn.prototype;k.kind="contact";k.i=P("ydn.gdata.m8.ContactEntry");k.getName=function(a){var b=a?"":this.Qc();if(a||0==b.length)a=this.data.gd$name,z(a)&&(b=a.gd$fullName.$t||"",0==b.length&&(b=(a.gd$givenName.$t||"")+" "+(a.gd$familyName.$t||"")));return ta(b)};k.xc=function(){var a=Vn.q.xc.call(this);if(a.ydn$emails||a.ydn$xp||a.ydn$externalIds)a==this.data&&(a=xj(this.data)),delete a.ydn$emails,delete a.ydn$xp,delete a.ydn$externalIds;return a};k.Wa="link category gd$email gd$im gd$organization gd$phoneNumber gd$structuredPostalAddress gd$formattedAddress".split(" ");
k.Tc=function(a){return Vn.q.Tc.call(this,a)};function Wn(a){Tn.call(this,a)}D(Wn,Tn);k=Wn.prototype;k.i=P("ydn.gdata.m8.ContactFeed");k.kind="contact";k.Gc=function(){Wn.q.Gc.call(this)};k.Uc=function(a){return Wn.q.Uc.call(this,a)};k.kc=function(a){return new Vn(a)};k.Ya=function(a){return Wn.q.Ya.call(this,a)};k.rb=function(){return"https://www.google.com/m8/feeds/contacts/"+this.sb()+"/full"};k.Vc=function(){return"http://www.google.com/m8/feeds/contacts/"+this.sb().replace("@","%40")};function Xn(a){function b(a){qa(a,"atom:")&&(a=a.substring(5,a.length));return a.replace("#text","$t").replace(/:/g,"$")}w(a)&&(a=Mf(a));var c={};if(1==a.nodeType){if(0<a.attributes.length)for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c[b(e.nodeName)]=e.nodeValue}}else 3==a.nodeType&&(c=a.nodeValue);if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++){var e=a.childNodes.item(d),f=b(e.nodeName);if("undefined"==typeof c[f])"content"==f?(c[f]={$t:Nf(e)},e.namespaceURI&&(c[f].xmlns=
e.namespaceURI)):c[f]=Xn(e);else{if("undefined"==typeof c[f].length){var g=c[f];c[f]=[];c[f].push(g)}c[f].push(Xn(e))}}return c};function Yn(a,b){this.storage=a;this.id=b.id?b.id.replace("@","%40"):b.id;this.client=this.g=null;this.h=new Af(function(){Zn(this).t(function(a){M(this.i,this+" updated, "+a+" new entries.")},function(){K(this.i,this+" update failed.")},this)},6E4,this)}k=Yn.prototype;k.i=P("ydn.ds.gdata.GData");k.update=function(){var a=this.h;a.cb?a.Yb=!0:Bf(a)};k.A=function(){return vl};
function $n(a,b){var c=(a.client?a.client:bg("gse")).request(b),d=new E;c.execute(function(a,b){if(a){var c=a.feed;if(c.entry){var h=this.A().put(ao(),c.entry).F(function(a){return a.length}),l=(new Wn(c)).Md("next");l?$n(this,new dg(l.href)).F(function(a){d.p(this+a)},c.entry.length):hb(h,d)}else d.p(0)}else K(this.i,"fetching fail "+(b?b.C()+" "+b.ba():"")),d.s(b)},a);return d}k.getParams=function(){return{alt:"json"}};k.get=function(a){return w(a)&&0!=a.length?this.A().get(ao(),a):kb("invalid key")};
k.put=function(a){return this.A().put(ao(),a)};
function bo(a,b,c,d){return a.A().get(ao(),b).F(function(a){if(a){a.gContact$externalId=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var f=new Vn(a),g=!1,h=0;h<a.gContact$externalId.length;h++)if(a.gContact$externalId[h].value==d){a.gContact$externalId[h].label=c;g=!0;break}g||a.gContact$externalId.push({label:c,value:d});Em(f,"modified");return f.Xa().F(function(a){a=Xn(a);var b=a.entry;if(!b||!b.id)throw Error("Invalid respond on saving gdata "+Jf(a));
this.A().put(ao(),b);return b},this)}throw Error("gdata entry "+b+" not found");},a)}k.td=function(a){return new Dm(a)};function co(a,b){return a.td(b).Xa().F(function(a){a=Xn(a);var b=a.entry;if(!b||!b.id)throw Error("Invalid respond on saving gdata "+Jf(a));this.A().put(ao(),b);return b},a)}
function Zn(a){if(!a.A().getName())return kb(Error("database not ready"));if(!a.g){var b=new Hh(ao(),"updated.$t",null,!0);a.g=new E;a.A().keys(b,1).F(function(a){var b=this.getParams();b.orderby="lastmodified";a[0]?(b.sortorder="descending",a=(new Date(1+ +new Date(a[0]))).toISOString(),b["updated-min"]=a):b.sortorder="ascending";$n(this,new dg(eo(this)+"/full","GET",b)).t(function(a){this.g.p(a);this.g=null},function(a){this.g.p(a);this.g=null},this)},a)}return a.g}k.toString=function(){return"contact"};function fo(a,b){Yn.call(this,a,b)}D(fo,Yn);function ao(){return"gdata-contact"}fo.prototype.getParams=function(){var a=fo.q.getParams.call(this);a.v="3.0";return a};function eo(a){return"https://www.google.com/m8/feeds/contacts/"+a.id}fo.prototype.td=function(a){var b=!!a.id;b||(a.id={$t:eo(this)+"/base/0"});var c=new Vn(a);b||delete a.id;return c};function go(a,b){return b&&0!=b.length?a.A().values(ao(),"ydn$emails",R.only(b),100,0,!1,!0):jb([])};function ho(a){this.g=a;this.j=0;this.k=[];this.l=[0,0,0,0];this.h=new Kinetic.Layer;a=this.g/2;var b=a/3;this.m=[a,a,b,this.g-b];this.n=[a,b,this.g-b,this.g-b]}ho.prototype.clear=function(){this.h=new Kinetic.Layer};var jo=Math.pow(2,2),ko=Math.pow(2,3),lo=Math.pow(2,4),mo=Math.pow(2,5);ho.prototype.O=function(a,b){this.j=b?this.j|a:this.j&~a};
function no(a){a.clear();for(var b=[["#C2C2C2","#6B6B6B","#525252","#3D3D3D"],["#FAFAFA","#D8D8D8","#D8D8D8","#C2C2C2"],["#FCCA03","#DD1812","#0140CA","#16A61E"]],c=["m252,324c0,-59.647 48.354,-108 108,-108c26.90799,0 51.51501,9.843 70.42401,26.121c1.03198,-8.564 1.57599,-17.27901 1.57599,-26.121c0,-119.126 -96.43701,-215.722 -215.49899,-215.994c40.89099,0.137 73.99899,33.321 73.99899,74.244c0,41.007 -33.24301,74.25 -74.25,74.25c-41.008,0 -74.25,-33.243 -74.25,-74.25c0,-40.979 33.19701,-74.203 74.16701,-74.248c-0.05602,0 -0.11201,-0.002 -0.16701,-0.002c-119.294,0 -216,96.707 -216,216c0,8.843 0.544,17.55701 1.577,26.121c18.908,-16.278 43.515,-26.121 70.423,-26.121c59.646,0 108,48.353 108,108c0,37.93399 -19.561,71.29401 -49.14301,90.56c26.127,11.21701 54.90701,17.44 85.14301,17.44s59.01599,-6.22299 85.14301,-17.44c-29.582,-19.26599 -49.14301,-52.62601 -49.14301,-90.56z",
"m142,74.25c0,41.007 33.242,74.25 74.25,74.25c41.00699,0 74.25,-33.243 74.25,-74.25c0,-40.923 -33.108,-74.107 -73.99899,-74.244c-0.112,0 -0.22301,-0.004 -0.334,-0.004c-40.97,0.045 -74.16701,33.269 -74.16701,74.248z","m180,324c0,-59.647 -48.354,-108 -108,-108c-26.908,0 -51.515,9.843 -70.424,26.121c9.366,77.69 59.967,142.67798 129.28099,172.43799c29.582,-19.26498 49.14301,-52.625 49.14301,-90.55899z","m430.42401,242.121c-18.909,-16.278 -43.51602,-26.121 -70.42401,-26.121c-59.646,0 -108,48.353 -108,108c0,37.93399 19.561,71.29401 49.142,90.56c69.315,-29.76199 119.91602,-94.74899 129.28201,-172.439z"],
d=b[0].slice(),e=[jo,ko,lo,mo],f=0;f<e.length;f++){var g=e[f];(a.j&g)==g&&(d[f]=b[2][f])}b=new Kinetic.Group({scaleX:a.g/435,scaleY:a.g/435});e=new Kinetic.Group;for(f=0;f<c.length;f++)a.k[f]=new Kinetic.Path({data:c[f],fill:d[f]}),0<a.l[f]&&(g=a.g/19*8,g=new Kinetic.Text({x:a.m[f]-g/4,y:a.n[f]-g/2,text:String(a.l[f]),fontSize:g,fontFamily:"sans-serif",fill:"white"}),e.add(g)),b.add(a.k[f]);a.h.add(b);a.h.add(e);return a.h};function oo(a){this.g=document.createElement("div");this.h=a||19;this.j=new ho(this.h);this.k=new xf(function(){this.render()},100,this);chrome.runtime.onSuspend&&chrome.runtime.onSuspend.addListener(function(){chrome.browserAction.setTitle({title:"suspended"});this.O(ko,!1);this.O(lo,!1);this.O(mo,!1);this.O(jo,!1);this.render()}.bind(this))}oo.prototype.O=function(a,b){this.j.O(a,b);zf(this.k)};
oo.prototype.render=function(){this.g.parentElement||document.body.appendChild(this.g);(new Kinetic.Stage({container:this.g,width:this.h,height:this.h})).add(no(this.j));if(chrome.browserAction){var a=this.g.querySelector("canvas"),b=a.getContext("2d");chrome.browserAction.setIcon({imageData:b.getImageData(0,0,a.width,a.height)})}};function po(a){this.k=a;this.h=this.k.length/4;this.l=this.h+6;this.j=[[],[],[],[]];this.m=[[],[],[],[]];this.g=Array(4*(this.l+1));for(a=0;a<this.h;a++)this.g[a]=[this.k[4*a],this.k[4*a+1],this.k[4*a+2],this.k[4*a+3]];var b=Array(4);for(a=this.h;a<4*(this.l+1);a++){b[0]=this.g[a-1][0];b[1]=this.g[a-1][1];b[2]=this.g[a-1][2];b[3]=this.g[a-1][3];if(0==a%this.h){var c=b,d=c[0];c[0]=c[1];c[1]=c[2];c[2]=c[3];c[3]=d;qo(b);b[0]^=ro[a/this.h][0];b[1]^=ro[a/this.h][1];b[2]^=ro[a/this.h][2];b[3]^=ro[a/this.h][3]}else 6<
this.h&&4==a%this.h&&qo(b);this.g[a]=Array(4);this.g[a][0]=this.g[a-this.h][0]^b[0];this.g[a][1]=this.g[a-this.h][1]^b[1];this.g[a][2]=this.g[a-this.h][2]^b[2];this.g[a][3]=this.g[a-this.h][3]^b[3]}}function so(a,b){for(var c=0;4>c;c++)for(var d=0;4>d;d++)a.j[c][d]^=a.g[4*b+d][c]}function to(a){for(var b=uo,c=0;4>c;c++)for(var d=0;4>d;d++)a.j[c][d]=b[a.j[c][d]]}function vo(a){for(var b=1;4>b;b++)for(var c=0;4>c;c++)a.m[b][c]=a.j[b][c];for(b=1;4>b;b++)for(c=0;4>c;c++)a.j[b][c]=a.m[b][(c+b)%4]}
function qo(a){a[0]=uo[a[0]];a[1]=uo[a[1]];a[2]=uo[a[2]];a[3]=uo[a[3]]}
var uo=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,
61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ro=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,
0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],wo=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,
27,25,31,29,19,17,23,21,11,9,15,13,3,1,7,5,59,57,63,61,51,49,55,53,43,41,47,45,35,33,39,37,91,89,95,93,83,81,87,85,75,73,79,77,67,65,71,69,123,121,127,125,115,113,119,117,107,105,111,109,99,97,103,101,155,153,159,157,147,145,151,149,139,137,143,141,131,129,135,133,187,185,191,189,179,177,183,181,171,169,175,173,163,161,167,165,219,217,223,221,211,209,215,213,203,201,207,205,195,193,199,197,251,249,255,253,243,241,247,245,235,233,239,237,227,225,231,229],xo=[0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,
17,48,51,54,53,60,63,58,57,40,43,46,45,36,39,34,33,96,99,102,101,108,111,106,105,120,123,126,125,116,119,114,113,80,83,86,85,92,95,90,89,72,75,78,77,68,71,66,65,192,195,198,197,204,207,202,201,216,219,222,221,212,215,210,209,240,243,246,245,252,255,250,249,232,235,238,237,228,231,226,225,160,163,166,165,172,175,170,169,184,187,190,189,180,183,178,177,144,147,150,149,156,159,154,153,136,139,142,141,132,135,130,129,155,152,157,158,151,148,145,146,131,128,133,134,143,140,137,138,171,168,173,174,167,
164,161,162,179,176,181,182,191,188,185,186,251,248,253,254,247,244,241,242,227,224,229,230,239,236,233,234,203,200,205,206,199,196,193,194,211,208,213,214,223,220,217,218,91,88,93,94,87,84,81,82,67,64,69,70,79,76,73,74,107,104,109,110,103,100,97,98,115,112,117,118,127,124,121,122,59,56,61,62,55,52,49,50,35,32,37,38,47,44,41,42,11,8,13,14,7,4,1,2,19,16,21,22,31,28,25,26];function yo(a){this.g=a};function zo(){this.h=[];this.l=this.j=0;for(var a=[],b=0;64>b;b++)a[b]=0;this.n=a;this.n[0]=128;this.g=[];this.o=0;this.m()}D(zo,Ne);
function Ao(a,b){for(var c=[],d=0,e=0;e<b.length;)c[d++]=b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3],e=4*d;for(d=16;64>d;d++)c[d]=c[d-16]+((c[d-15]>>>7|c[d-15]<<25)^(c[d-15]>>>18|c[d-15]<<14)^c[d-15]>>>3)+c[d-7]+((c[d-2]>>>17|c[d-2]<<15)^(c[d-2]>>>19|c[d-2]<<13)^c[d-2]>>>10)&4294967295;for(var e=a.g[0],f=a.g[1],g=a.g[2],h=a.g[3],l=a.g[4],m=a.g[5],n=a.g[6],p=a.g[7],d=0;64>d;d++)var q=((e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10))+(e&f^e&g^f&g)&4294967295,s=p+((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&
m^~l&n)+a.u[d]+c[d]&4294967295,p=n,n=m,m=l,l=h+s&4294967295,h=g,g=f,f=e,e=s+q&4294967295;a.g[0]=a.g[0]+e&4294967295;a.g[1]=a.g[1]+f&4294967295;a.g[2]=a.g[2]+g&4294967295;a.g[3]=a.g[3]+h&4294967295;a.g[4]=a.g[4]+l&4294967295;a.g[5]=a.g[5]+m&4294967295;a.g[6]=a.g[6]+n&4294967295;a.g[7]=a.g[7]+p&4294967295}
zo.prototype.update=function(a,b){t(b)||(b=a.length);var c=0,d=this.j;if(w(a))for(;c<b;)this.h[d++]=a.charCodeAt(c++),64==d&&(Ao(this,this.h),d=0);else for(;c<b;)this.h[d++]=a[c++],64==d&&(Ao(this,this.h),d=0);this.j=d;this.l+=b};zo.prototype.k=function(){var a=[],b=8*this.l;56>this.j?this.update(this.n,56-this.j):this.update(this.n,64-(this.j-56));for(var c=63;56<=c;c--)this.h[c]=b&255,b/=256;Ao(this,this.h);for(c=b=0;c<this.o;c++)for(var d=24;0<=d;d-=8)a[b++]=this.g[c]>>d&255;return a};
zo.prototype.u=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,
3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Bo(){zo.call(this)}D(Bo,zo);Bo.prototype.m=function(){this.h=[];this.l=this.j=0;this.g=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];this.o=8};function Co(a,b){this.g=a;this.h=Le("requestAnimationFrame");this.filter=b||null;var c=this;setTimeout(function(){Do(c)},6E5*Math.random())}
function Do(a){var b=a.g.getName(),c={"Content-Type":"application/json"};a.g.values("log",null,20).F(function(a){if(0!=a.length){var e=a.map(function(a){return a.key});a=JSON.stringify(a);a=new dg("https://mhardartway.s3.amazonaws.com/"+(b+"/"+e[0]),"PUT",null,c,a);var f=bg(),e=e.map(function(a){return new X("log",a)});f.request(a).execute(function(a,b){b.Z()&&this.g.remove(e).F(function(a){a==e.length&&Do(this)},this)},this)}},a)}
Co.prototype.log=function(a){this.filter&&(a=this.filter(a));if(a){var b=JSON.stringify(a);a=String(C());for(var c=[],d=0;16>d;++d)c[d]=256*Math.random()|0;d=new Bo;d.update(Le(a));d.update(c);d.update(this.h);for(var d=d.k(),b=Le(b),e=c.length-b.length%c.length,f=0;f<e;f++)b.push(10);for(var d=new po(d),d=new yo(d),e=[],g=c,f=0;f<b.length;f+=16){for(var h=Za(b,f,f+16),l=g,g=[],m=0;m<h.length;m++)g.push(h[m]^l[m]);for(var h=d.g,n=void 0,n=void 0,l=0;4>l;l++)for(m=0;4>m;m++)n=4*m+l,n=g[n],h.j[l][m]=
n;so(h,0);for(g=1;g<h.l;++g){to(h);vo(h);l=h.j;m=h.m[0];for(n=0;4>n;n++)m[0]=l[0][n],m[1]=l[1][n],m[2]=l[2][n],m[3]=l[3][n],l[0][n]=wo[m[0]]^xo[m[1]]^m[2]^m[3],l[1][n]=m[0]^wo[m[1]]^xo[m[2]]^m[3],l[2][n]=m[0]^m[1]^wo[m[2]]^xo[m[3]],l[3][n]=xo[m[0]]^m[1]^m[2]^wo[m[3]];so(h,g)}to(h);vo(h);so(h,h.l);g=[];for(l=0;4>l;l++)for(m=0;4>m;m++)g[4*m+l]=h.j[l][m];h=g;Ya(e,h);g=h}this.g.put("log",{key:a,salt:c,value:String.fromCharCode.apply(null,e)})}};function Eo(){this.B=null;this.g={};this.j=null;this.G=new $f;Xf(this.G);this.h=this.n=this.m=this.o=null;this.u=new df(new hf,"XMLHttpRequest"+location.host);this.l=new oo;var a=new wl("ydn.crm",{stores:[{name:"log",keyPath:"key"}]}),b=this,c=C();Kg=tg=new Co(a,function(a){if(!a||a.HttpRequestData&&"https://mail.google.com/mail/feed/atom/bazinga"==a.HttpRequestData.path)return null;b.h&&b.h.Id&&(a.id=b.h.Id.$t);a.uptime=c;return a});chrome.permissions.onAdded.addListener(this.Cd.bind(this))}k=Eo.prototype;
k.i=P("ydn.crm.app.App");k.Cd=function(a){for(var b=(a=a.origins)?a.length:0,c=0;c<b;c++){var d=a[c].match(/https:\/\/([^\/]+)/);if(d){var d=d[1],e=this.g[d];if(e&&(L(this.i,"host permission granted to "+e),e.j instanceof Vg)){var f=bg("default");this.g[d]=new un(f,e.o,e.k,e.l)}}}};k.init=function(a){this.B=a||{};this.B.logging&&sg("ydn.crm","finest");M(this.i,"init "+this);this.l.O(jo,!0);zl||(Dl(),zl=new Xg(Cl(),void 0,"https://yathit-app.appspot.com",1,!0),Cg(zl,cg))};
function Fo(a,b){function c(a){return a.Rb().F(function(){L(this.i,"initializing sugarcrm client: "+e+" login="+a.isLogin());if(a.isLogin()){this.g[e]=a;window.console.log(l);this.u.set(h,l);var b=Object.keys(this.g);Hl("sd",b);a.update();Go(this)}return a.Va()},this)}var d=b.baseUrl,e=b.domain||d;if(!e)return kb("domain or url required.");e=e.trim();qa(e,"http")&&(e=ld(new Zc(e)));/\//.test(e)&&(e=ld(new Zc("https://"+e)));if(d&&(d=d.trim(),!qa(d,"http"))){var d=d.replace(/:?\/\//,""),f=new Zc("https://"+
d);f.Qa||cd(f,"/");d=f.toString()}var g=a.g[e],h="sugar-client-"+e,l=a.u.get(h)||{};if(g)return g.isLogin()?jb(g.Va()):c.call(a,g);var m=b.username||l.username;d||(d=l.base_url);d||(d="https://"+e+"/");if(!m)return kb("username required.");var n=b.password;n?n=CryptoJS.MD5(n).toString():n=l.password;if(!m)return kb("username required.");l.username=m;l.password=n;l.base_url=d;f=new Zc(d);cd(f,"/*");var p=new E;chrome.permissions.contains({origins:[f.toString()]},function(b){b=b?bg("default"):bg("proxy");
g=new un(b,d,m,n);hb(c.call(a,g),p)});return p}function Go(a){var b=!1,c;for(c in a.g)if(a.g[c].isLogin()){b=!0;break}a.l.O(jo,!0);a.l.O(mo,a.isLogin());a.l.O(ko,b)}function Ho(a,b){if(!b)return kb("domain required");a.u.remove("sugar-client-"+b);var c=Fl.sd||[],d=c.indexOf(b);0<=d&&(c.splice(d,1),Hl("sd",c));var e=new E;a.g[b]?Gn(a.g[b]).t(function(){delete this.g[b];e.p(!0);Go(this)},function(){e.s(!1)},a):e.p(!1);return e}
function Io(a,b){var c=new E,d=b.email||"";if(a.h&&a.h.email==d)return M(a.i,"already running for "+d),c.p(a.h),c;a.h=b;a.h.updated=C();if(d){M(a.i,"running "+a+" for "+d);var e=b.Id.$t;El(a);Jl(e).Q(function(){var a={id:d};on(e);this.j=new fo(vl,a);a=bg("gse");this.j.client=a;this.j.update();for(var a=Fl.sd||[],b=0;b<a.length;b++)a[b]&&Fo(this,{domain:a[b]});c.p(this.h);this.isLogin()?(this.l.O(mo,!0),chrome.browserAction.setTitle({title:"Ready"})):(this.l.O(mo,!1),chrome.browserAction.setTitle({title:"Login required."}))},
a)}else c.p(a.h),a.l.O(mo,!1),chrome.browserAction.setTitle({title:"Login required."});return c}
function Qg(a,b){if(a.m)return a.m;if(a.o&&a.o.expires<C())return jb(a.o);a.m=new E;var c={url:b||chrome.extension.getURL(Yf)},c=new dg("/token","GET",c);Al||(Al=new Xg(Cl(),void 0,"https://yathit-app.appspot.com/a/cm",1,!0),Cg(Al,"auth"));Al.request(c).execute(function(a,b){if(b.Z()){var c=a.Tokens[0];if(!c.has_token){this.m.s(c);return}c.expires=1E3*c.expires_in+C();this.o=c;this.m.p(c)}else this.o=null,this.m.s(b);this.m=null},a);return a.m}k.isLogin=function(){return!!this.h&&this.h.is_login};
function Jo(a,b){if(a.n)return a.n;a.n=ag(a.G,b).F(function(b){return Io(this,b).F(function(){a.isLogin()?setTimeout(function(){a.n=null},9E5):a.n=null})},a);return a.n}function Ko(a){a.n=null;a.h=null;a.l.O(mo,!1)}k.toString=function(){return"SugarApp:0.6.0"};function Lo(){var a=new wf;a.Cc('<div class="debug-panel"><div id="debug-channel"><h4>Channel</h4><select><option value="guf">GOOGLE_USERINFO</option><option value="gdf">GDATA_FETCH</option><option value="gdls">GDATA_LINK_SUGAR</option><option value="gdcm">GDATA_CONTACT_MERGE</option><option value="gdce">GDATA_LIST_CONTACT_BY_EMAIL</option><option value="sd">SUGAR_DETAILS</option><option value="sl">SUGAR_LOGIN</option><option value="sfm">SUGAR_FETCH_MODULE</option><option value="sr">SUGAR_REST</option><option value="slm">SUGAR_LIST_MODULE</option><option value="sim">SUGAR_INFO_MODULE</option><option value="slem">SUGAR_FIND_BY_EMAIL</option><option value="sic">SUGAR_IMPORT_CONTACT</option></select><br /><textarea cols="80" rows="6" name="params"></textarea><br /><button>Send</button></div><hr /><details id="debug-sugar-rest"><summary>REST call</summary><select class="sugar-rest-module"><option value="Leads">Leads</option><option value="User">User</option><option value="Contacts" selected>Contacts</option></select><select class="sugar-rest-method"><option value="get_module_fields">Retrieving a List of Fields From a Module</option><option value="get_entries">Retrieving Multiple Records by ID From a Module</option><option value="get_entry_list" selected>Retrieving a List of Records</option></select><div><textarea class="sugar-rest-params" cols="80" rows="6" name="params"></textarea></div><button class="sugar-rest-load">Load</button></details><span><button class="debug-sugar-nude">Nude</button></span><hr /><textarea id="debug-status" cols="80" rows=10" ></textarea></div>');
return a.toString()};function Mo(){this.g=this.root=null;if(!Jc){var a="default-"+C();Jc=new Gc(a)}a=Jc;a.j["sugarcrm-test.example.com"]||(a.j["sugarcrm-test.example.com"]=new Lc(a,"sugarcrm","test.example.com"));this.sugar=a.j["sugarcrm-test.example.com"]}Mo.prototype.i=P("ydn.crm.ui.Debug");Mo.prototype.status=function(a){window.console.log(a);this.g&&(z(a)?a=JSON.stringify(a,null,2):w(a)&&"{"==a.charAt(0)&&(a=JSON.parse(a),a=JSON.stringify(a,null,2)),this.g.textContent=a)};
function No(a,b){var c;if("get_entry_list"==b)c={query:"",order_by:"",offset:0,select_fields:[],link_name_to_fields_array:[],max_results:2,deleted:0,Favorites:!1};else if("get_available_modules"==b)c={filter:""};else if("get_entries"==b)c={ids:[],select_fields:[],link_name_to_fields_array:[]};else if("get_module_fields"==b)c={fields:[]};else throw Error(b);of("sugar-rest-params",a.root).value=JSON.stringify(c,null,2)}
Mo.prototype.init=function(a){if(this.root=a){this.root.innerHTML=uf(Lo());this.g=document.getElementById("debug-status");of("debug-greet",this.root);jc(of("debug-sugar-nude",this.root),"click",function(){for(var a=vl.getName(),b=ii(vl),c,d=0;d<Sh.length;d++){var l=Sh[d](a,b);l&&(c=l)}c||Rh("IDBVersionChangeEvent ",null)},!0,this);jc(of("sugar-rest-method",this.root),"change",function(){No(this,of("sugar-rest-method",this.root).value)},!0,this);a=of("sugar-rest-load",this.root);jc(a,"click",function(){try{var a=
JSON.parse(of("sugar-rest-params",this.root).value),b;for(b in a){var c=a[b];(w(c)&&sa(c)||u(c)&&0==c.length)&&delete a[b]}}catch(d){throw this.status("Invalid params values"),d;}a.module_name=of("sugar-rest-module",this.root).value;this.sugar.send("rest",{method:of("sugar-rest-method",this.root).value,params:a}).F(function(a){this.status(a)},this)},!1,this);No(this,"get_entry_list");a=document.getElementById("debug-channel");var b=pf(document,"BUTTON",null,a)[0],c=a.querySelector("select"),d=a.querySelector("textarea");
jc(c,"change",function(){"gdata-fetch"==c.value?d.value="contact":"gdata-list-contact-by-email"==c.value?d.value="kyawtuns@gmail.com":"list-module"==c.value?d.value="":"info-module"==c.value?d.value="Contacts":"list"==c.value&&(d.value="kyawtuns@gmail.com")},!1,this);jc(b,"click",function(){var a=c.value,b=d.value,b="{"==b.charAt(0)?JSON.parse(b):b;this.sugar.send(a,b).Q(function(a){this.status(a)},this)},!0,this)}};function Oo(){Eo.call(this)}D(Oo,Eo);Oo.prototype.i=P("ydn.crm.app.Page");
Oo.prototype.init=function(a){Oo.q.init.call(this,a);a:{a=mf().createElement("DIV");var b=new wf;b.Cc('<div class="app"><section class="sidebar"><div class="user-toolbar"><div><a id="user-login">...</a></div><div><span id="user-name" style="display: none;"></span></div></div></section><ul><li><details><summary>Debug</summary><div id="section-debug"></div></details></li></ul></div>');b=uf(b.toString());b.match(vf);a.innerHTML=b;if(1==a.childNodes.length&&(b=a.firstChild,1==b.nodeType)){a=b;break a}}document.body.appendChild(a);
a=new Mo;b=document.getElementById("section-debug");a.init(b)};function Po(){Eo.call(this);this.k={};Qo(this)}D(Po,Oo);Po.prototype.i=P("ydn.crm.app.EventPage");Po.prototype.init=function(a){Po.q.init.call(this,a)};
function Ro(a,b,c){var d=c.req;c.done=!0;M(a.i,"service req: "+d+":"+c.id);if("app-setting"==d)c.data=r.localStorage.getItem("app-setting"),b.postMessage(c);else if("echo"==d)M(a.i,"resp: "+d+":"+c.id),b.postMessage(c);else if("list-sugarcrm"==d){var e=[],f;for(f in a.g)e.push(a.g[f].Va());M(a.i,"resp: "+c.req+":"+c.id);c.data=e;b.postMessage(c)}else"gdata-fetch"==d?(e=c.data,"contact"==e?a.j?Zn(a.j).t(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):(c.error=
"gdata not ready",b.postMessage(c)):(c.error="invalid kind "+e,b.postMessage(c))):"gdata-list-contact-by-email"==d?go(a.j,c.data).F(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c):"gdata-token"==d?Qg(a,c.data).Q(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c):"log"==d?(ug(c.data),b.postMessage(c)):"login-info"==d?Jo(a,c.data).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=
a;this.error="invalid login";b.postMessage(this)},c):"logged-in"==d?(Jo(a,null).F(function(b){So(a,{req:d,info:b})}),b.postMessage(c)):"logout"==d?(Ko(a),So(a,{req:d}),b.postMessage(c)):"new-entry"==d?z(c.data)?co(a.j,c.data).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="failed to create a new entry";b.postMessage(this)},c):(c.error="Invalid gdata entry data",b.postMessage(c)):"new-sugarcrm"==d?Fo(a,c.data).t(function(){M(a.i,
"resp: "+this.req+":"+this.id);this.data=!0;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):"sugar-server-info"==d?(e=c.data,e=/https?:/.test(e)?new Zc(e):ad(new Zc,e),(e=a.g[e.Ea])?Bn(e).F(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c):Hn(c.data).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){M(a.i,"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},c)):"remove-sugar"==
d?Ho(a,c.data).Q(function(a){this.data=a;b.postMessage(this)},c):"user-setting"==d?Rg().F(function(a){this.data=a;b.postMessage(this)},c):K(a.i,"Main channel unknown req: "+d)}
function To(a,b,c,d){var e=d.req;d.done=!0;L(a.i,"sugar service req: "+c+":"+e+":"+d.id);if(a.isLogin())if("about"==e)d.data=c.Va(),b.postMessage(d);else if("details"==e)Dn(c).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){M(a.i,"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},d);else if("echo"==e)b.postMessage(d);else if("get"==e)An(c,d.data).t(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},
d);else if("fetch-module"==e)zn(c,d.data).t(function(c){M(a.i,"resp: "+this.req+":"+this.id+" "+c);this.data=c;b.postMessage(this)},function(c){M(a.i,"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},d);else if("info-module"==e)yn(c,d.data).t(function(c){this.data=c;M(a.i,"resp: "+this.req+":"+this.id);b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},d);else if("import-gdata"==e){var f=d.data,g=f?f["gdata-id"]:"";g?0<=qn.indexOf(f.module)?a.j.get(g).t(function(a){var d=
qn[qn.indexOf(this.data.module)];a?Fn(c,d,a).t(function(a){a&&a.id?this.data=a:this.error="Set Entry to "+this.module+" failed";b.postMessage(this)},function(a){this.error=JSON.stringify(a);b.postMessage(this)},this):(this.error="contact entry "+this.data+" not found",b.postMessage(this))},function(a){throw a;},d):(K(a.i,"resp error: "+e+":"+d.id),d.error="invalid module name "+f.module,b.postMessage(d)):(K(a.i,"resp error: "+e+":"+d.id),d.error="gdata id required",b.postMessage(d))}else"link"==e?
(e=a.j,(f=d.data["gdata-id"])?(g=d.data["external-id"])&&g.label&&g.value?bo(e,f,g.label,g.value).t(function(a){this.data=a;b.postMessage(this)},function(c){K(a.i,"error linking gdata "+this.req+":"+this.id);this.error="error "+c;b.postMessage(this)},d):(d.error="invalid external_id",b.postMessage(d)):(d.error="gdata-id not required",b.postMessage(d))):"list"==e?c.list(d.data).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},
d):"list-module"==e?Cn(c).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;M(a.i,"resp: "+this.req+":"+this.id);b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},d):"login"==e?Fo(a,d.data).t(function(c){this.data=c;b.postMessage(this);Go(a)},function(a){this.error=a;b.postMessage(this)},d):"put-record"==e?(e=d.data.module)?(f=d.data.record,z(f)?En(c,e,f).t(function(c){this.data=c;M(a.i,"resp: "+this.req+":"+this.id);b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},
d):(d.error="record object required",b.postMessage(d))):(d.error="module required",b.postMessage(d)):"server-info"==e?Bn(c).t(function(c){M(a.i,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){M(a.i,"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},d):"sync-entry"==e?(f=d.data,a.j.get(f).t(function(c){c?new Vn(c):(c="GData entry "+this.data+" not found.",M(a.i,c),this.error=c,b.postMessage(this))},function(c){M(a.i,"resp error: "+this.req+":"+
this.id+" "+c);this.error=c;b.postMessage(this)},d)):"rest"==e?(g=d.data,z(g)?(f=g.method,g=g.params,w(f)&&0!=f.length?z(g)?xn(c,f,g).t(function(c){this.data=c;M(a.i,"resp: "+this.req+":"+this.id);b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},d):(d.error="REST parameter must be an object",M(a.i,"resp: error "+e+":"+d.id),b.postMessage(d)):(d.error="method must be valid string",M(a.i,"resp: error "+e+":"+d.id),b.postMessage(d))):(d.error="REST parameter must be an object",M(a.i,
"resp: error "+e+":"+d.id),b.postMessage(d))):K(a.i,c+" unknown req: "+e);else d.error="Not login",b.postMessage(d)}function Uo(a){var b=!1,c;for(c in a.k)"gmail"==a.k[c].group&&(b=!0);a.l.O(lo,b)}function So(a,b){for(var c in a.k){var d=a.k[c];"gmail"==d.group&&d.port.postMessage(b)}}Po.prototype.H=function(){return{sugars:this.g,gdata:this.j,ports:this.k,user_info:this.h}};
function Qo(a){chrome.runtime.onConnect.addListener(function(b){var c=b.sender.url,d=b.name.substr(0,b.name.lastIndexOf("-"));Ta(Kc,d)?(a.i.info("Channel "+b.name+" connected for "+c),a.k[b.name]={name:b.name,group:d,port:b},Uo(a),b.onMessage.addListener(function(c){if(c&&z(c)){if("close"==c.req)a.i.info("closing "+b.name),delete a.k[b.name],b.disconnect(),Uo(a);else if(!c.id){K(a.i,"Unknown group in pipe info "+b.name);return}if("sugarcrm"==c.group){var d=c.name,g=a.g[d];g?To(a,b,g,c):K(a.i,"SugarCRM instance "+
d+" not found.")}else if("gmail"==c.group)for(d in a.k)g=a.k[d],g.group!=d||c.name&&c.name!=g.name||g.port.postMessage(c);else Ro(a,b,c)}else K(a.i,"invalid message package: "+c)}),b.onDisconnect.addListener(function(){a.i.info("disconnected "+b.name);delete a.k[b.name];Uo(a)})):K(a.i,"channel "+b.name+" ignored from "+c)});a.i.info("event page start listening incoming connection")}
na("runApp",function(){var a=new Po,b=r.localStorage.getItem("app-setting"),c=null;b&&(c=JSON.parse(b));window.onerror=function(a,b,c){b&&(a+=" on "+c+" of "+b);window.console.warn(a)};c&&c.logging&&(sg("ydn.crm","finest"),sg("ydn.ds","finer"));a.init(c);Jo(a);return a});Po.prototype.xp=Po.prototype.H;na("ydn.debug.log",sg);na("ydn.crm.shared.setSetting",Hl);na("ydn.crm.version","0.6.0");na("goog.async.Deferred",E);E.prototype.addCallback=E.prototype.F;E.prototype.addErrback=E.prototype.gb;E.prototype.addBoth=E.prototype.Q;E.prototype.addCallbacks=E.prototype.t;})();app=runApp();

            //# sourceMappingURL=ydn.crm.js.map
        