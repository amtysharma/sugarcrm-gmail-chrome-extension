(function(){var COMPILED=!0,goog=goog||{};goog.global=this;goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c=c[d]?c[d]:c[d]={}:c[d]=b};goog.define=function(a,b){var c=b;COMPILED||goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]);goog.exportPath_(a,c)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;
goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a];for(var b=a;(b=b.substring(0,b.lastIndexOf(".")))&&!goog.getObjectByName(b);)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)};goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||"",Error("Importing test-only code into non-debug environment"+a?": "+a:".");};
COMPILED||(goog.isProvided_=function(a){return!goog.implicitNamespaces_[a]&&!!goog.getObjectByName(a)},goog.implicitNamespaces_={});goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};
goog.addDependency=function(a,b,c){if(goog.DEPENDENCIES_ENABLED){var d;a=a.replace(/\\/g,"/");for(var e=goog.dependencies_,f=0;d=b[f];f++)e.nameToPath[d]=a,a in e.pathToNames||(e.pathToNames[a]={}),e.pathToNames[a][d]=!0;for(d=0;b=c[d];d++)a in e.requires||(e.requires[a]={}),e.requires[a][b]=!0}};goog.ENABLE_DEBUG_LOADER=!0;
goog.require=function(a){if(!COMPILED&&!goog.isProvided_(a)){if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b){goog.included_[b]=!0;goog.writeScripts_();return}}a="goog.require could not find: "+a;goog.global.console&&goog.global.console.error(a);throw Error(a);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(a,b){return a};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};
goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),d=-1==d?c.length:
d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[a]&&b(a)&&(goog.dependencies_.written[a]=!0)},goog.writeScriptTag_=function(a){if(goog.inHtmlDocument_()){var b=goog.global.document;if("complete"==b.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load');}b.write('<script type="text/javascript" src="'+a+'">\x3c/script>');
return!0}return!1},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var g in d.requires[e])if(!goog.isProvided_(g))if(g in d.nameToPath)a(d.nameToPath[g]);else throw Error("Undefined nameToPath for "+g);e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_,e;for(e in goog.included_)d.written[e]||a(e);for(e=0;e<b.length;e++)if(b[e])goog.importScript_(goog.basePath+b[e]);else throw Error("Undefined script input");
},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isDef=function(a){return void 0!==a};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);
b.body.removeChild(c)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){var c=b||{},d;for(d in c){var e=(""+c[d]).replace(/\$/g,"$$$$");a=a.replace(RegExp("\\{\\$"+d+"\\}","gi"),e)}return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};
goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){var g=Array.prototype.slice.call(arguments,2);return b.prototype[c].apply(a,g)}};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_)return d.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),f=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,
e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){a.call(goog.global)};goog.debug={};goog.debug.Error=function(a){Error.captureStackTrace?Error.captureStackTrace(this,goog.debug.Error):this.stack=Error().stack||"";a&&(this.message=String(a))};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.dom={};goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};goog.string={};goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)};goog.string.endsWith=function(a,b){var c=a.length-b.length;return 0<=c&&a.indexOf(b,c)==c};goog.string.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(0,b.length))};goog.string.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))};
goog.string.caseInsensitiveEquals=function(a,b){return a.toLowerCase()==b.toLowerCase()};goog.string.subs=function(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")};goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmpty=function(a){return/^[\s\xa0]*$/.test(a)};goog.string.isEmptySafe=function(a){return goog.string.isEmpty(goog.string.makeSafe(a))};
goog.string.isBreakingWhitespace=function(a){return!/[^\t\n\r ]/.test(a)};goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)};goog.string.isNumeric=function(a){return!/[^0-9]/.test(a)};goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)};goog.string.isSpace=function(a){return" "==a};goog.string.isUnicodeChar=function(a){return 1==a.length&&" "<=a&&"~">=a||"\u0080"<=a&&"\ufffd">=a};goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")};
goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")};goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")};goog.string.trim=function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};
goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=function(a,b){var c=String(a).toLowerCase(),d=String(b).toLowerCase();return c<d?-1:c==d?0:1};goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;
goog.string.numerateCompare=function(a,b){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var c=a.toLowerCase().match(goog.string.numerateCompareRegExp_),d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=Math.min(c.length,d.length),f=0;f<e;f++){var g=c[f],h=d[f];if(g!=h)return c=parseInt(g,10),!isNaN(c)&&(d=parseInt(h,10),!isNaN(d)&&c-d)?c-d:g<h?-1:1}return c.length!=d.length?c.length-d.length:a<b?-1:1};goog.string.urlEncode=function(a){return encodeURIComponent(String(a))};
goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))};goog.string.newLineToBr=function(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")};
goog.string.htmlEscape=function(a,b){if(b)return a.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;").replace(goog.string.singleQuoteRe_,"&#39;");if(!goog.string.allRe_.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(goog.string.amperRe_,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(goog.string.ltRe_,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(goog.string.gtRe_,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(goog.string.quotRe_,
"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(goog.string.singleQuoteRe_,"&#39;"));return a};goog.string.amperRe_=/&/g;goog.string.ltRe_=/</g;goog.string.gtRe_=/>/g;goog.string.quotRe_=/"/g;goog.string.singleQuoteRe_=/'/g;goog.string.allRe_=/[&<>"']/;goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a};
goog.string.unescapeEntitiesWithDocument=function(a,b){return goog.string.contains(a,"&")?goog.string.unescapeEntitiesUsingDom_(a,b):a};
goog.string.unescapeEntitiesUsingDom_=function(a,b){var c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},d;d=b?b.createElement("div"):document.createElement("div");return a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,b){var g=c[a];if(g)return g;if("#"==b.charAt(0)){var h=Number("0"+b.substr(1));isNaN(h)||(g=String.fromCharCode(h))}g||(d.innerHTML=a+" ",g=d.firstChild.nodeValue.slice(0,-1));return c[a]=g})};
goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,c){switch(c){case "amp":return"&";case "lt":return"<";case "gt":return">";case "quot":return'"';default:if("#"==c.charAt(0)){var d=Number("0"+c.substr(1));if(!isNaN(d))return String.fromCharCode(d)}return a}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g;goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g," &#160;"),b)};
goog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a};goog.string.truncate=function(a,b,c){c&&(a=goog.string.unescapeEntities(a));a.length>b&&(a=a.substring(0,b-3)+"...");c&&(a=goog.string.htmlEscape(a));return a};
goog.string.truncateMiddle=function(a,b,c,d){c&&(a=goog.string.unescapeEntities(a));if(d&&a.length>b){d>b&&(d=b);var e=a.length-d;a=a.substring(0,b-d)+"..."+a.substring(e)}else a.length>b&&(d=Math.floor(b/2),e=a.length-d,a=a.substring(0,d+b%2)+"..."+a.substring(e));c&&(a=goog.string.htmlEscape(a));return a};goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"};goog.string.jsEscapeCache_={"'":"\\'"};
goog.string.quote=function(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(31<e&&127>e?d:goog.string.escapeChar(d))}b.push('"');return b.join("")};goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join("")};
goog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a,c=a.charCodeAt(0);if(31<c&&127>c)b=a;else{if(256>c){if(b="\\x",16>c||256<c)b+="0"}else b="\\u",4096>c&&(b+="0");b+=c.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[a]=b};goog.string.toMap=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=!0;return b};
goog.string.contains=function(a,b){return-1!=a.indexOf(b)};goog.string.countOf=function(a,b){return a&&b?a.split(b).length-1:0};goog.string.removeAt=function(a,b,c){var d=a;0<=b&&b<a.length&&0<c&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c));return d};goog.string.remove=function(a,b){var c=RegExp(goog.string.regExpEscape(b),"");return a.replace(c,"")};goog.string.removeAll=function(a,b){var c=RegExp(goog.string.regExpEscape(b),"g");return a.replace(c,"")};
goog.string.regExpEscape=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(a,b){return Array(b+1).join(a)};goog.string.padNumber=function(a,b,c){a=goog.isDef(c)?a.toFixed(c):String(a);c=a.indexOf(".");-1==c&&(c=a.length);return goog.string.repeat("0",Math.max(0,b-c))+a};goog.string.makeSafe=function(a){return null==a?"":String(a)};goog.string.buildString=function(a){return Array.prototype.join.call(arguments,"")};
goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)};
goog.string.compareVersions=function(a,b){for(var c=0,d=goog.string.trim(String(a)).split("."),e=goog.string.trim(String(b)).split("."),f=Math.max(d.length,e.length),g=0;0==c&&g<f;g++){var h=d[g]||"",k=e[g]||"",l=/(\d*)(\D*)/g,m=/(\d*)(\D*)/g;do{var n=l.exec(h)||["","",""],p=m.exec(k)||["","",""];if(0==n[0].length&&0==p[0].length)break;var c=0==n[1].length?0:parseInt(n[1],10),q=0==p[1].length?0:parseInt(p[1],10),c=goog.string.compareElements_(c,q)||goog.string.compareElements_(0==n[2].length,0==p[2].length)||
goog.string.compareElements_(n[2],p[2])}while(0==c)}return c};goog.string.compareElements_=function(a,b){return a<b?-1:a>b?1:0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c),b%=goog.string.HASHCODE_MAX_;return b};goog.string.uniqueStringCounter_=2147483648*Math.random()|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};
goog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmpty(a)?NaN:b};goog.string.isLowerCamelCase=function(a){return/^[a-z]+([A-Z][a-z]*)*$/.test(a)};goog.string.isUpperCamelCase=function(a){return/^([A-Z][a-z]*)+$/.test(a)};goog.string.toCamelCase=function(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})};goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,"-$1").toLowerCase()};
goog.string.toTitleCase=function(a,b){var c=goog.isString(b)?goog.string.regExpEscape(b):"\\s";return a.replace(RegExp("(^"+(c?"|["+c+"]+":"")+")([a-z])","g"),function(a,b,c){return b+c.toUpperCase()})};goog.string.parseInt=function(a){isFinite(a)&&(a=String(a));return goog.isString(a)?/^\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10):NaN};goog.string.splitLimit=function(a,b,c){a=a.split(b);for(var d=[];0<c&&a.length;)d.push(a.shift()),c--;a.length&&d.push(a.join(b));return d};goog.asserts={};goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(a,b){b.unshift(a);goog.debug.Error.call(this,goog.string.subs.apply(null,b));b.shift();this.messagePattern=a};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.doAssertFailure_=function(a,b,c,d){var e="Assertion failed";if(c)var e=e+(": "+c),f=d;else a&&(e+=": "+a,f=b);throw new goog.asserts.AssertionError(""+e,f||[]);};
goog.asserts.assert=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!a&&goog.asserts.doAssertFailure_("",null,b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.fail=function(a,b){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};
goog.asserts.assertNumber=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertString=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertFunction=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertObject=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertArray=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertBoolean=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertElement=function(a,b,c){!goog.asserts.ENABLE_ASSERTS||goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertInstanceof=function(a,b,c,d){!goog.asserts.ENABLE_ASSERTS||a instanceof b||goog.asserts.doAssertFailure_("instanceof check failed.",null,c,Array.prototype.slice.call(arguments,3));return a};
goog.asserts.assertObjectPrototypeIsIntact=function(){for(var a in Object.prototype)goog.asserts.fail(a+" should not be enumerable in Object.prototype.")};goog.array={};goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE;goog.array.peek=function(a){return a[a.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;
goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};
goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1};
goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(a,b,c){goog.asserts.assert(null!=a.length);goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;0<=d;--d)d in e&&b.call(c,e[d],d,a)};
goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e};
goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};
goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.reduce?function(a,b,c,d){goog.asserts.assert(null!=a.length);d&&(b=goog.bind(b,d));return goog.array.ARRAY_PROTOTYPE_.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;goog.array.forEach(a,function(c,g){e=b.call(d,e,c,g,a)});return e};
goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.reduceRight?function(a,b,c,d){goog.asserts.assert(null!=a.length);d&&(b=goog.bind(b,d));return goog.array.ARRAY_PROTOTYPE_.reduceRight.call(a,b,c)}:function(a,b,c,d){var e=c;goog.array.forEachRight(a,function(c,g){e=b.call(d,e,c,g,a)});return e};
goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};
goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};goog.array.count=function(a,b,c){var d=0;goog.array.forEach(a,function(a,f,g){b.call(c,a,f,g)&&++d},c);return d};
goog.array.find=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1};goog.array.findRight=function(a,b,c){b=goog.array.findIndexRight(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};
goog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;0<=d;d--)if(d in e&&b.call(c,e[d],d,a))return d;return-1};goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)};goog.array.isEmpty=function(a){return 0==a.length};goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0};goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)};
goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)};goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)};goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)};goog.array.remove=function(a,b){var c=goog.array.indexOf(a,b),d;(d=0<=c)&&goog.array.removeAt(a,c);return d};
goog.array.removeAt=function(a,b){goog.asserts.assert(null!=a.length);return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length};goog.array.removeIf=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0<=b?(goog.array.removeAt(a,b),!0):!1};goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.toArray=function(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};goog.array.clone=goog.array.toArray;
goog.array.extend=function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(goog.isArray(d)||(e=goog.isArrayLike(d))&&Object.prototype.hasOwnProperty.call(d,"callee"))a.push.apply(a,d);else if(e)for(var f=a.length,g=d.length,h=0;h<g;h++)a[f+h]=d[h];else a.push(d)}};goog.array.splice=function(a,b,c,d){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))};
goog.array.slice=function(a,b,c){goog.asserts.assert(null!=a.length);return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)};goog.array.removeDuplicates=function(a,b,c){b=b||a;var d=function(a){return goog.isObject(g)?"o"+goog.getUid(g):(typeof g).charAt(0)+g};c=c||d;for(var d={},e=0,f=0;f<a.length;){var g=a[f++],h=c(g);Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,b[e++]=g)}b.length=e};
goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)};goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)};goog.array.binarySearch_=function(a,b,c,d,e){for(var f=0,g=a.length,h;f<g;){var k=f+g>>1,l;l=c?b.call(e,a[k],k,a):b(d,a[k]);0<l?f=k+1:(g=k,h=!l)}return h?f:~f};goog.array.sort=function(a,b){goog.asserts.assert(null!=a.length);goog.array.ARRAY_PROTOTYPE_.sort.call(a,b||goog.array.defaultCompare)};
goog.array.stableSort=function(a,b){for(var c=0;c<a.length;c++)a[c]={index:c,value:a[c]};var d=b||goog.array.defaultCompare;goog.array.sort(a,function(a,b){return d(a.value,b.value)||a.index-b.index});for(c=0;c<a.length;c++)a[c]=a[c].value};goog.array.sortObjectsByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(a[b],c[b])})};
goog.array.isSorted=function(a,b,c){b=b||goog.array.defaultCompare;for(var d=1;d<a.length;d++){var e=b(a[d-1],a[d]);if(0<e||0==e&&c)return!1}return!0};goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;var d=a.length;c=c||goog.array.defaultCompareEquality;for(var e=0;e<d;e++)if(!c(a[e],b[e]))return!1;return!0};goog.array.compare=function(a,b,c){return goog.array.equals(a,b,c)};
goog.array.compare3=function(a,b,c){c=c||goog.array.defaultCompare;for(var d=Math.min(a.length,b.length),e=0;e<d;e++){var f=c(a[e],b[e]);if(0!=f)return f}return goog.array.defaultCompare(a.length,b.length)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};goog.array.defaultCompareEquality=function(a,b){return a===b};goog.array.binaryInsert=function(a,b,c){c=goog.array.binarySearch(a,b,c);return 0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1};
goog.array.binaryRemove=function(a,b,c){b=goog.array.binarySearch(a,b,c);return 0<=b?goog.array.removeAt(a,b):!1};goog.array.bucket=function(a,b,c){for(var d={},e=0;e<a.length;e++){var f=a[e],g=b.call(c,f,e,a);goog.isDef(g)&&(d[g]||(d[g]=[])).push(f)}return d};goog.array.toObject=function(a,b,c){var d={};goog.array.forEach(a,function(e,f){d[b.call(c,e,f,a)]=e});return d};
goog.array.range=function(a,b,c){var d=[],e=0,f=a;c=c||1;void 0!==b&&(e=a,f=b);if(0>c*(f-e))return[];if(0<c)for(a=e;a<f;a+=c)d.push(a);else for(a=e;a>f;a+=c)d.push(a);return d};goog.array.repeat=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};goog.array.flatten=function(a){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];goog.isArray(d)?b.push.apply(b,goog.array.flatten.apply(null,d)):b.push(d)}return b};
goog.array.rotate=function(a,b){goog.asserts.assert(null!=a.length);a.length&&(b%=a.length,0<b?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b)));return a};goog.array.moveItem=function(a,b,c){goog.asserts.assert(0<=b&&b<a.length);goog.asserts.assert(0<=c&&c<a.length);b=goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1);goog.array.ARRAY_PROTOTYPE_.splice.call(a,c,0,b[0])};
goog.array.zip=function(a){if(!arguments.length)return[];for(var b=[],c=0;;c++){for(var d=[],e=0;e<arguments.length;e++){var f=arguments[e];if(c>=f.length)return b;d.push(f[c])}b.push(d)}};goog.array.shuffle=function(a,b){for(var c=b||Math.random,d=a.length-1;0<d;d--){var e=Math.floor(c()*(d+1)),f=a[d];a[d]=a[e];a[e]=f}};goog.functions={};goog.functions.constant=function(a){return function(){return a}};goog.functions.FALSE=goog.functions.constant(!1);goog.functions.TRUE=goog.functions.constant(!0);goog.functions.NULL=goog.functions.constant(null);goog.functions.identity=function(a,b){return a};goog.functions.error=function(a){return function(){throw Error(a);}};goog.functions.fail=function(a){return function(){throw a;}};
goog.functions.lock=function(a,b){b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};goog.functions.nth=function(a){return function(){return arguments[a]}};goog.functions.withReturnValue=function(a,b){return goog.functions.sequence(a,goog.functions.constant(b))};goog.functions.compose=function(a,b){var c=arguments,d=c.length;return function(){var a;d&&(a=c[d-1].apply(this,arguments));for(var b=d-2;0<=b;b--)a=c[b].call(this,a);return a}};
goog.functions.sequence=function(a){var b=arguments,c=b.length;return function(){for(var a,e=0;e<c;e++)a=b[e].apply(this,arguments);return a}};goog.functions.and=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)if(!b[a].apply(this,arguments))return!1;return!0}};goog.functions.or=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)if(b[a].apply(this,arguments))return!0;return!1}};
goog.functions.not=function(a){return function(){return!a.apply(this,arguments)}};goog.functions.create=function(a,b){var c=function(){};c.prototype=a.prototype;c=new c;a.apply(c,Array.prototype.slice.call(arguments,1));return c};goog.functions.CACHE_RETURN_VALUE=!0;goog.functions.cacheReturnValue=function(a){var b=!1,c;return function(){if(!goog.functions.CACHE_RETURN_VALUE)return a();b||(c=a(),b=!0);return c}};/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
goog.async={};
goog.async.Deferred=function(a,b){this.sequence_=[];this.onCancelFunction_=a;this.defaultScope_=b||null;this.hadError_=this.fired_=!1;this.result_=void 0;this.silentlyCanceled_=this.blocking_=this.blocked_=!1;this.unhandledExceptionTimeoutId_=0;this.parent_=null;this.branches_=0;if(goog.async.Deferred.LONG_STACK_TRACES&&(this.constructorStack_=null,Error.captureStackTrace)){var c={stack:""};Error.captureStackTrace(c,goog.async.Deferred);"string"==typeof c.stack&&(this.constructorStack_=c.stack.replace(/^[^\n]*\n/,
""))}};goog.async.Deferred.STRICT_ERRORS=!1;goog.async.Deferred.LONG_STACK_TRACES=goog.DEBUG;goog.async.Deferred.prototype.cancel=function(a){if(this.hasFired())this.result_ instanceof goog.async.Deferred&&this.result_.cancel();else{if(this.parent_){var b=this.parent_;delete this.parent_;a?b.cancel(a):b.branchCancel_()}this.onCancelFunction_?this.onCancelFunction_.call(this.defaultScope_,this):this.silentlyCanceled_=!0;this.hasFired()||this.errback(new goog.async.Deferred.CanceledError(this))}};
goog.async.Deferred.prototype.branchCancel_=function(){this.branches_--;0>=this.branches_&&this.cancel()};goog.async.Deferred.prototype.continue_=function(a,b){this.blocked_=!1;this.updateResult_(a,b)};goog.async.Deferred.prototype.updateResult_=function(a,b){this.fired_=!0;this.result_=b;this.hadError_=!a;this.fire_()};goog.async.Deferred.prototype.check_=function(){if(this.hasFired()){if(!this.silentlyCanceled_)throw new goog.async.Deferred.AlreadyCalledError(this);this.silentlyCanceled_=!1}};
goog.async.Deferred.prototype.callback=function(a){this.check_();this.assertNotDeferred_(a);this.updateResult_(!0,a)};goog.async.Deferred.prototype.errback=function(a){this.check_();this.assertNotDeferred_(a);this.makeStackTraceLong_(a);this.updateResult_(!1,a)};goog.async.Deferred.prototype.makeStackTraceLong_=function(a){goog.async.Deferred.LONG_STACK_TRACES&&this.constructorStack_&&goog.isObject(a)&&a.stack&&/^[^\n]+(\n   [^\n]+)+/.test(a.stack)&&(a.stack=a.stack+"\nDEFERRED OPERATION:\n"+this.constructorStack_)};
goog.async.Deferred.prototype.assertNotDeferred_=function(a){goog.asserts.assert(!(a instanceof goog.async.Deferred),"An execution sequence may not be initiated with a blocking Deferred.")};goog.async.Deferred.prototype.addCallback=function(a,b){return this.addCallbacks(a,null,b)};goog.async.Deferred.prototype.addErrback=function(a,b){return this.addCallbacks(null,a,b)};goog.async.Deferred.prototype.addBoth=function(a,b){return this.addCallbacks(a,a,b)};
goog.async.Deferred.prototype.addCallbacks=function(a,b,c){goog.asserts.assert(!this.blocking_,"Blocking Deferreds can not be re-used");this.sequence_.push([a,b,c]);this.hasFired()&&this.fire_();return this};goog.async.Deferred.prototype.chainDeferred=function(a){this.addCallbacks(a.callback,a.errback,a);return this};goog.async.Deferred.prototype.awaitDeferred=function(a){return this.addCallback(goog.bind(a.branch,a))};
goog.async.Deferred.prototype.branch=function(a){var b=new goog.async.Deferred;this.chainDeferred(b);a&&(b.parent_=this,this.branches_++);return b};goog.async.Deferred.prototype.hasFired=function(){return this.fired_};goog.async.Deferred.prototype.isError=function(a){return a instanceof Error};goog.async.Deferred.prototype.hasErrback_=function(){return goog.array.some(this.sequence_,function(a){return goog.isFunction(a[1])})};
goog.async.Deferred.prototype.fire_=function(){this.unhandledExceptionTimeoutId_&&this.hasFired()&&this.hasErrback_()&&(goog.global.clearTimeout(this.unhandledExceptionTimeoutId_),delete this.unhandledExceptionTimeoutId_);this.parent_&&(this.parent_.branches_--,delete this.parent_);for(var a=this.result_,b=!1,c=!1;this.sequence_.length&&!this.blocked_;){var d=this.sequence_.shift(),e=d[0],f=d[1],d=d[2];if(e=this.hadError_?f:e)try{var g=e.call(d||this.defaultScope_,a);goog.isDef(g)&&(this.hadError_=
this.hadError_&&(g==a||this.isError(g)),this.result_=a=g);a instanceof goog.async.Deferred&&(this.blocked_=c=!0)}catch(h){a=h,this.hadError_=!0,this.makeStackTraceLong_(a),this.hasErrback_()||(b=!0)}}this.result_=a;c?(a.addCallbacks(goog.bind(this.continue_,this,!0),goog.bind(this.continue_,this,!1)),a.blocking_=!0):!goog.async.Deferred.STRICT_ERRORS||!this.isError(a)||a instanceof goog.async.Deferred.CanceledError||(b=this.hadError_=!0);b&&(this.unhandledExceptionTimeoutId_=goog.global.setTimeout(goog.functions.fail(a),
0))};goog.async.Deferred.succeed=function(a){var b=new goog.async.Deferred;b.callback(a);return b};goog.async.Deferred.fail=function(a){var b=new goog.async.Deferred;b.errback(a);return b};goog.async.Deferred.canceled=function(){var a=new goog.async.Deferred;a.cancel();return a};goog.async.Deferred.when=function(a,b,c){return a instanceof goog.async.Deferred?a.branch(!0).addCallback(b,c):goog.async.Deferred.succeed(a).addCallback(b,c)};
goog.async.Error=function(a){Error.captureStackTrace?Error.captureStackTrace(this,goog.async.Error):this.stack=Error().stack||"";a&&(this.message=String(a))};goog.inherits(goog.async.Error,Error);goog.async.Deferred.AlreadyCalledError=function(a){goog.async.Error.call(this);this.deferred=a};goog.inherits(goog.async.Deferred.AlreadyCalledError,goog.async.Error);goog.async.Deferred.AlreadyCalledError.prototype.message="Deferred has already fired";
goog.async.Deferred.AlreadyCalledError.prototype.name="AlreadyCalledError";goog.async.Deferred.CanceledError=function(a){goog.async.Error.call(this);this.deferred=a};goog.inherits(goog.async.Deferred.CanceledError,goog.async.Error);goog.async.Deferred.CanceledError.prototype.message="Deferred was canceled";goog.async.Deferred.CanceledError.prototype.name="CanceledError";goog.disposable={};goog.disposable.IDisposable=function(){};goog.Disposable=function(){goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF&&(goog.Disposable.INCLUDE_STACK_ON_CREATION&&(this.creationStack=Error().stack),goog.Disposable.instances_[goog.getUid(this)]=this)};goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2};goog.Disposable.MONITORING_MODE=0;goog.Disposable.INCLUDE_STACK_ON_CREATION=!0;goog.Disposable.instances_={};
goog.Disposable.getUndisposedObjects=function(){var a=[],b;for(b in goog.Disposable.instances_)goog.Disposable.instances_.hasOwnProperty(b)&&a.push(goog.Disposable.instances_[Number(b)]);return a};goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}};goog.Disposable.prototype.disposed_=!1;goog.Disposable.prototype.isDisposed=function(){return this.disposed_};goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed;
goog.Disposable.prototype.dispose=function(){if(!this.disposed_&&(this.disposed_=!0,this.disposeInternal(),goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF)){var a=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(a))throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call");delete goog.Disposable.instances_[a]}};
goog.Disposable.prototype.registerDisposable=function(a){this.addOnDisposeCallback(goog.partial(goog.dispose,a))};goog.Disposable.prototype.addOnDisposeCallback=function(a,b){this.onDisposeCallbacks_||(this.onDisposeCallbacks_=[]);this.onDisposeCallbacks_.push(goog.bind(a,b))};goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()};
goog.Disposable.isDisposed=function(a){return a&&"function"==typeof a.isDisposed?a.isDisposed():!1};goog.dispose=function(a){a&&"function"==typeof a.dispose&&a.dispose()};goog.disposeAll=function(a){for(var b=0,c=arguments.length;b<c;++b){var d=arguments[b];goog.isArrayLike(d)?goog.disposeAll.apply(null,d):goog.dispose(d)}};goog.debug.entryPointRegistry={};goog.debug.EntryPointMonitor=function(){};goog.debug.entryPointRegistry.refList_=[];goog.debug.entryPointRegistry.monitors_=[];goog.debug.entryPointRegistry.monitorsMayExist_=!1;goog.debug.entryPointRegistry.register=function(a){goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=a;if(goog.debug.entryPointRegistry.monitorsMayExist_)for(var b=goog.debug.entryPointRegistry.monitors_,c=0;c<b.length;c++)a(goog.bind(b[c].wrap,b[c]))};
goog.debug.entryPointRegistry.monitorAll=function(a){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var b=goog.bind(a.wrap,a),c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](b);goog.debug.entryPointRegistry.monitors_.push(a)};
goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(a){var b=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(a==b[b.length-1],"Only the most recent monitor can be unwrapped.");a=goog.bind(a.unwrap,a);for(var c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](a);b.length--};goog.userAgent={};goog.userAgent.ASSUME_IE=!1;goog.userAgent.ASSUME_GECKO=!1;goog.userAgent.ASSUME_WEBKIT=!1;goog.userAgent.ASSUME_MOBILE_WEBKIT=!1;goog.userAgent.ASSUME_OPERA=!1;goog.userAgent.ASSUME_ANY_VERSION=!1;goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;
goog.userAgent.getUserAgentString=function(){return goog.global.navigator?goog.global.navigator.userAgent:null};goog.userAgent.getNavigator=function(){return goog.global.navigator};
goog.userAgent.init_=function(){goog.userAgent.detectedOpera_=!1;goog.userAgent.detectedIe_=!1;goog.userAgent.detectedWebkit_=!1;goog.userAgent.detectedMobile_=!1;goog.userAgent.detectedGecko_=!1;var a;if(!goog.userAgent.BROWSER_KNOWN_&&(a=goog.userAgent.getUserAgentString())){var b=goog.userAgent.getNavigator();goog.userAgent.detectedOpera_=goog.string.startsWith(a,"Opera");goog.userAgent.detectedIe_=!goog.userAgent.detectedOpera_&&(goog.string.contains(a,"MSIE")||goog.string.contains(a,"Trident"));
goog.userAgent.detectedWebkit_=!goog.userAgent.detectedOpera_&&goog.string.contains(a,"WebKit");goog.userAgent.detectedMobile_=goog.userAgent.detectedWebkit_&&goog.string.contains(a,"Mobile");goog.userAgent.detectedGecko_=!goog.userAgent.detectedOpera_&&!goog.userAgent.detectedWebkit_&&!goog.userAgent.detectedIe_&&"Gecko"==b.product}};goog.userAgent.BROWSER_KNOWN_||goog.userAgent.init_();goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.userAgent.detectedOpera_;
goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.userAgent.detectedIe_;goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.userAgent.detectedGecko_;goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.userAgent.detectedWebkit_;goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.detectedMobile_;goog.userAgent.SAFARI=goog.userAgent.WEBKIT;
goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigator();return a&&a.platform||""};goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.userAgent.ASSUME_MAC=!1;goog.userAgent.ASSUME_WINDOWS=!1;goog.userAgent.ASSUME_LINUX=!1;goog.userAgent.ASSUME_X11=!1;goog.userAgent.ASSUME_ANDROID=!1;goog.userAgent.ASSUME_IPHONE=!1;goog.userAgent.ASSUME_IPAD=!1;
goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD;
goog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,"Mac");goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,"Win");goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,"Linux");goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator().appVersion||"","X11");var a=goog.userAgent.getUserAgentString();goog.userAgent.detectedAndroid_=!!a&&
goog.string.contains(a,"Android");goog.userAgent.detectedIPhone_=!!a&&goog.string.contains(a,"iPhone");goog.userAgent.detectedIPad_=!!a&&goog.string.contains(a,"iPad")};goog.userAgent.PLATFORM_KNOWN_||goog.userAgent.initPlatform_();goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_;goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_;
goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_;goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_;goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.userAgent.detectedAndroid_;goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.userAgent.detectedIPhone_;
goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.userAgent.detectedIPad_;
goog.userAgent.determineVersion_=function(){var a="",b;goog.userAgent.OPERA&&goog.global.opera?(a=goog.global.opera.version,a="function"==typeof a?a():a):(goog.userAgent.GECKO?b=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?b=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(b=/WebKit\/(\S+)/),b&&(a=(a=b.exec(goog.userAgent.getUserAgentString()))?a[1]:""));return goog.userAgent.IE&&(b=goog.userAgent.getDocumentMode_(),b>parseFloat(a))?String(b):a};
goog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:void 0};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(a,b){return goog.string.compareVersions(a,b)};goog.userAgent.isVersionOrHigherCache_={};
goog.userAgent.isVersionOrHigher=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[a]||(goog.userAgent.isVersionOrHigherCache_[a]=0<=goog.string.compareVersions(goog.userAgent.VERSION,a))};goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher;goog.userAgent.isDocumentModeOrHigher=function(a){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=a};goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher;
goog.userAgent.DOCUMENT_MODE=function(){var a=goog.global.document;return a&&goog.userAgent.IE?goog.userAgent.getDocumentMode_()||("CSS1Compat"==a.compatMode?parseInt(goog.userAgent.VERSION,10):5):void 0}();goog.events={};
goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8")||
goog.userAgent.OPERA&&goog.userAgent.isVersionOrHigher("9.5")||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("8")||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:"ontouchstart"in goog.global||!!(goog.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!goog.global.navigator||!goog.global.navigator.msMaxTouchPoints)};goog.events.EventId=function(a){this.id=a};goog.events.EventId.prototype.toString=function(){return this.id};goog.events.Event=function(a,b){this.type=a instanceof goog.events.EventId?String(a):a;this.currentTarget=this.target=b};goog.events.Event.prototype.disposeInternal=function(){};goog.events.Event.prototype.dispose=function(){};goog.events.Event.prototype.propagationStopped_=!1;goog.events.Event.prototype.defaultPrevented=!1;goog.events.Event.prototype.returnValue_=!0;goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0};
goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=!0;this.returnValue_=!1};goog.events.Event.stopPropagation=function(a){a.stopPropagation()};goog.events.Event.preventDefault=function(a){a.preventDefault()};goog.events.getVendorPrefixedName_=function(a){return goog.userAgent.WEBKIT?"webkit"+a:goog.userAgent.OPERA?"o"+a.toLowerCase():a.toLowerCase()};
goog.events.EventType={CLICK:"click",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",SELECTSTART:"selectstart",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",
DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONSOLEMESSAGE:"consolemessage",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",ORIENTATIONCHANGE:"orientationchange",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",
UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",ANIMATIONSTART:goog.events.getVendorPrefixedName_("AnimationStart"),ANIMATIONEND:goog.events.getVendorPrefixedName_("AnimationEnd"),ANIMATIONITERATION:goog.events.getVendorPrefixedName_("AnimationIteration"),TRANSITIONEND:goog.events.getVendorPrefixedName_("TransitionEnd"),
POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTERCANCEL:"pointercancel",POINTERMOVE:"pointermove",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",
MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERENTER:"MSPointerEnter",MSPOINTERHOVER:"MSPointerHover",MSPOINTERLEAVE:"MSPointerLeave",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROUT:"MSPointerOut",MSPOINTEROVER:"MSPointerOver",MSPOINTERUP:"MSPointerUp",TEXTINPUT:"textinput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",EXIT:"exit",LOADABORT:"loadabort",LOADCOMMIT:"loadcommit",
LOADREDIRECT:"loadredirect",LOADSTART:"loadstart",LOADSTOP:"loadstop",RESPONSIVE:"responsive",SIZECHANGED:"sizechanged",UNRESPONSIVE:"unresponsive",VISIBILITYCHANGE:"visibilitychange"};goog.reflect={};goog.reflect.object=function(a,b){return b};goog.reflect.sinkValue=function(a){goog.reflect.sinkValue[" "](a);return a};goog.reflect.sinkValue[" "]=goog.nullFunction;goog.reflect.canAccessProperty=function(a,b){try{return goog.reflect.sinkValue(a[b]),!0}catch(c){}return!1};goog.events.BrowserEvent=function(a,b){goog.events.Event.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.platformModifierKey=!1;this.event_=null;a&&this.init(a,b)};goog.inherits(goog.events.BrowserEvent,goog.events.Event);
goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};goog.events.BrowserEvent.IEButtonMap=[1,4,2];
goog.events.BrowserEvent.prototype.init=function(a,b){var c=this.type=a.type;this.target=a.target||a.srcElement;this.currentTarget=b;var d=a.relatedTarget;d?goog.userAgent.GECKO&&(goog.reflect.canAccessProperty(d,"nodeName")||(d=null)):c==goog.events.EventType.MOUSEOVER?d=a.fromElement:c==goog.events.EventType.MOUSEOUT&&(d=a.toElement);this.relatedTarget=d;this.offsetX=goog.userAgent.WEBKIT||void 0!==a.offsetX?a.offsetX:a.layerX;this.offsetY=goog.userAgent.WEBKIT||void 0!==a.offsetY?a.offsetY:a.layerY;
this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.screenX=a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.platformModifierKey=goog.userAgent.MAC?a.metaKey:a.ctrlKey;this.state=a.state;this.event_=a;a.defaultPrevented&&this.preventDefault();delete this.propagationStopped_};
goog.events.BrowserEvent.prototype.isButton=function(a){return goog.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==a:"click"==this.type?a==goog.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[a])};goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)};
goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this);this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0};
goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var a=this.event_;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_};goog.events.BrowserEvent.prototype.disposeInternal=function(){};goog.events.Listenable=function(){};goog.events.Listenable.IMPLEMENTED_BY_PROP="closure_listenable_"+(1E6*Math.random()|0);goog.events.Listenable.addImplementation=function(a){a.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP]=!0};goog.events.Listenable.isImplementedBy=function(a){try{return!(!a||!a[goog.events.Listenable.IMPLEMENTED_BY_PROP])}catch(b){return!1}};goog.events.ListenableKey=function(){};goog.events.ListenableKey.counter_=0;goog.events.ListenableKey.reserveKey=function(){return++goog.events.ListenableKey.counter_};goog.events.Listener=function(a,b,c,d,e,f){goog.events.Listener.ENABLE_MONITORING&&(this.creationStack=Error().stack);this.listener=a;this.proxy=b;this.src=c;this.type=d;this.capture=!!e;this.handler=f;this.key=goog.events.ListenableKey.reserveKey();this.removed=this.callOnce=!1};goog.events.Listener.ENABLE_MONITORING=!1;goog.events.Listener.prototype.markAsRemoved=function(){this.removed=!0;this.handler=this.src=this.proxy=this.listener=null};goog.object={};goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)};goog.object.filter=function(a,b,c){var d={},e;for(e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d};goog.object.map=function(a,b,c){var d={},e;for(e in a)d[e]=b.call(c,a[e],e,a);return d};goog.object.some=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return!0;return!1};goog.object.every=function(a,b,c){for(var d in a)if(!b.call(c,a[d],d,a))return!1;return!0};
goog.object.getCount=function(a){var b=0,c;for(c in a)b++;return b};goog.object.getAnyKey=function(a){for(var b in a)return b};goog.object.getAnyValue=function(a){for(var b in a)return a[b]};goog.object.contains=function(a,b){return goog.object.containsValue(a,b)};goog.object.getValues=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b};goog.object.getKeys=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};
goog.object.getValueByKeys=function(a,b){for(var c=goog.isArrayLike(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],goog.isDef(a));c++);return a};goog.object.containsKey=function(a,b){return b in a};goog.object.containsValue=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1};goog.object.findKey=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d};goog.object.findValue=function(a,b,c){return(b=goog.object.findKey(a,b,c))&&a[b]};
goog.object.isEmpty=function(a){for(var b in a)return!1;return!0};goog.object.clear=function(a){for(var b in a)delete a[b]};goog.object.remove=function(a,b){var c;(c=b in a)&&delete a[b];return c};goog.object.add=function(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');goog.object.set(a,b,c)};goog.object.get=function(a,b,c){return b in a?a[b]:c};goog.object.set=function(a,b,c){a[b]=c};goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c};
goog.object.clone=function(a){var b={},c;for(c in a)b[c]=a[c];return b};goog.object.unsafeClone=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.object.unsafeClone(a[c]);return b}return a};goog.object.transpose=function(a){var b={},c;for(c in a)b[a[c]]=c;return b};goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.object.extend=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++)c=goog.object.PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};
goog.object.create=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c};goog.object.createSet=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};
goog.object.createImmutableView=function(a){var b=a;Object.isFrozen&&!Object.isFrozen(a)&&(b=Object.create(a),Object.freeze(b));return b};goog.object.isImmutableView=function(a){return!!Object.isFrozen&&Object.isFrozen(a)};goog.events.ListenerMap=function(a){this.src=a;this.listeners={};this.typeCount_=0};goog.events.ListenerMap.prototype.getTypeCount=function(){return this.typeCount_};goog.events.ListenerMap.prototype.getListenerCount=function(){var a=0,b;for(b in this.listeners)a+=this.listeners[b].length;return a};
goog.events.ListenerMap.prototype.add=function(a,b,c,d,e){var f=this.listeners[a];f||(f=this.listeners[a]=[],this.typeCount_++);var g=goog.events.ListenerMap.findListenerIndex_(f,b,d,e);-1<g?(a=f[g],c||(a.callOnce=!1)):(a=new goog.events.Listener(b,null,this.src,a,!!d,e),a.callOnce=c,f.push(a));return a};
goog.events.ListenerMap.prototype.remove=function(a,b,c,d){if(!(a in this.listeners))return!1;var e=this.listeners[a];b=goog.events.ListenerMap.findListenerIndex_(e,b,c,d);return-1<b?(e[b].markAsRemoved(),goog.array.removeAt(e,b),0==e.length&&(delete this.listeners[a],this.typeCount_--),!0):!1};
goog.events.ListenerMap.prototype.removeByKey=function(a){var b=a.type;if(!(b in this.listeners))return!1;var c=goog.array.remove(this.listeners[b],a);c&&(a.markAsRemoved(),0==this.listeners[b].length&&(delete this.listeners[b],this.typeCount_--));return c};goog.events.ListenerMap.prototype.removeAll=function(a){var b=0,c;for(c in this.listeners)if(!a||c==a){for(var d=this.listeners[c],e=0;e<d.length;e++)++b,d[e].markAsRemoved();delete this.listeners[c];this.typeCount_--}return b};
goog.events.ListenerMap.prototype.getListeners=function(a,b){var c=this.listeners[a],d=[];if(c)for(var e=0;e<c.length;++e){var f=c[e];f.capture==b&&d.push(f)}return d};goog.events.ListenerMap.prototype.getListener=function(a,b,c,d){a=this.listeners[a];var e=-1;a&&(e=goog.events.ListenerMap.findListenerIndex_(a,b,c,d));return-1<e?a[e]:null};
goog.events.ListenerMap.prototype.hasListener=function(a,b){var c=goog.isDef(a),d=goog.isDef(b);return goog.object.some(this.listeners,function(e,f){for(var g=0;g<e.length;++g)if(!(c&&e[g].type!=a||d&&e[g].capture!=b))return!0;return!1})};goog.events.ListenerMap.findListenerIndex_=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.listener==b&&f.capture==!!c&&f.handler==d)return e}return-1};goog.events.listeners_={};goog.events.LISTENER_MAP_PROP_="closure_lm_"+(1E6*Math.random()|0);goog.events.onString_="on";goog.events.onStringMap_={};goog.events.CaptureSimulationMode={OFF_AND_FAIL:0,OFF_AND_SILENT:1,ON:2};goog.events.CAPTURE_SIMULATION_MODE=2;goog.events.listenerCountEstimate_=0;
goog.events.listen=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listen(a,b[f],c,d,e);return null}c=goog.events.wrapListener_(c);return goog.events.Listenable.isImplementedBy(a)?a.listen(b,c,d,e):goog.events.listen_(a,b,c,!1,d,e)};
goog.events.listen_=function(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e;if(g&&!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_FAIL)return goog.asserts.fail("Can not register capture listener in IE8-."),null;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_SILENT)return null}var h=goog.events.getListenerMap_(a);h||(a[goog.events.LISTENER_MAP_PROP_]=h=new goog.events.ListenerMap(a));
c=h.add(b,c,d,e,f);if(c.proxy)return c;d=goog.events.getProxy();c.proxy=d;d.src=a;d.listener=c;a.addEventListener?a.addEventListener(b,d,g):a.attachEvent(goog.events.getOnString_(b),d);goog.events.listenerCountEstimate_++;return c};goog.events.getProxy=function(){var a=goog.events.handleBrowserEvent_,b=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b};
goog.events.listenOnce=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listenOnce(a,b[f],c,d,e);return null}c=goog.events.wrapListener_(c);return goog.events.Listenable.isImplementedBy(a)?a.listenOnce(b,c,d,e):goog.events.listen_(a,b,c,!0,d,e)};goog.events.listenWithWrapper=function(a,b,c,d,e){b.listen(a,c,d,e)};
goog.events.unlisten=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.unlisten(a,b[f],c,d,e);return null}c=goog.events.wrapListener_(c);if(goog.events.Listenable.isImplementedBy(a))return a.unlisten(b,c,d,e);if(!a)return!1;d=!!d;if(a=goog.events.getListenerMap_(a))if(b=a.getListener(b,c,d,e))return goog.events.unlistenByKey(b);return!1};
goog.events.unlistenByKey=function(a){if(goog.isNumber(a)||!a||a.removed)return!1;var b=a.src;if(goog.events.Listenable.isImplementedBy(b))return b.unlistenByKey(a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(goog.events.getOnString_(c),d);goog.events.listenerCountEstimate_--;(c=goog.events.getListenerMap_(b))?(c.removeByKey(a),0==c.getTypeCount()&&(c.src=null,b[goog.events.LISTENER_MAP_PROP_]=null)):a.markAsRemoved();return!0};
goog.events.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e)};goog.events.removeAll=function(a,b){if(!a)return 0;if(goog.events.Listenable.isImplementedBy(a))return a.removeAllListeners(b);var c=goog.events.getListenerMap_(a);if(!c)return 0;var d=0,e;for(e in c.listeners)if(!b||e==b)for(var f=goog.array.clone(c.listeners[e]),g=0;g<f.length;++g)goog.events.unlistenByKey(f[g])&&++d;return d};goog.events.removeAllNativeListeners=function(){return goog.events.listenerCountEstimate_=0};
goog.events.getListeners=function(a,b,c){return goog.events.Listenable.isImplementedBy(a)?a.getListeners(b,c):a?(a=goog.events.getListenerMap_(a))?a.getListeners(b,c):[]:[]};goog.events.getListener=function(a,b,c,d,e){c=goog.events.wrapListener_(c);d=!!d;return goog.events.Listenable.isImplementedBy(a)?a.getListener(b,c,d,e):a?(a=goog.events.getListenerMap_(a))?a.getListener(b,c,d,e):null:null};
goog.events.hasListener=function(a,b,c){if(goog.events.Listenable.isImplementedBy(a))return a.hasListener(b,c);a=goog.events.getListenerMap_(a);return!!a&&a.hasListener(b,c)};goog.events.expose=function(a){var b=[],c;for(c in a)a[c]&&a[c].id?b.push(c+" = "+a[c]+" ("+a[c].id+")"):b.push(c+" = "+a[c]);return b.join("\n")};goog.events.getOnString_=function(a){return a in goog.events.onStringMap_?goog.events.onStringMap_[a]:goog.events.onStringMap_[a]=goog.events.onString_+a};
goog.events.fireListeners=function(a,b,c,d){return goog.events.Listenable.isImplementedBy(a)?a.fireListeners(b,c,d):goog.events.fireListeners_(a,b,c,d)};goog.events.fireListeners_=function(a,b,c,d){var e=1;if(a=goog.events.getListenerMap_(a))if(b=a.listeners[b])for(b=goog.array.clone(b),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.removed&&(e&=!1!==goog.events.fireListener(f,d))}return Boolean(e)};
goog.events.fireListener=function(a,b){var c=a.listener,d=a.handler||a.src;a.callOnce&&goog.events.unlistenByKey(a);return c.call(d,b)};goog.events.getTotalListenerCount=function(){return goog.events.listenerCountEstimate_};goog.events.dispatchEvent=function(a,b){goog.asserts.assert(goog.events.Listenable.isImplementedBy(a),"Can not use goog.events.dispatchEvent with non-goog.events.Listenable instance.");return a.dispatchEvent(b)};
goog.events.protectBrowserEventEntryPoint=function(a){goog.events.handleBrowserEvent_=a.protectEntryPoint(goog.events.handleBrowserEvent_)};
goog.events.handleBrowserEvent_=function(a,b){if(a.removed)return!0;if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var c=b||goog.getObjectByName("window.event"),d=new goog.events.BrowserEvent(c,this),e=!0;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.ON){if(!goog.events.isMarkedIeEvent_(c)){goog.events.markIeEvent_(c);for(var c=[],f=d.currentTarget;f;f=f.parentNode)c.push(f);for(var f=a.type,g=c.length-1;!d.propagationStopped_&&0<=g;g--)d.currentTarget=c[g],e&=goog.events.fireListeners_(c[g],
f,!0,d);for(g=0;!d.propagationStopped_&&g<c.length;g++)d.currentTarget=c[g],e&=goog.events.fireListeners_(c[g],f,!1,d)}}else e=goog.events.fireListener(a,d);return e}return goog.events.fireListener(a,new goog.events.BrowserEvent(b,this))};goog.events.markIeEvent_=function(a){var b=!1;if(0==a.keyCode)try{a.keyCode=-1;return}catch(c){b=!0}if(b||void 0==a.returnValue)a.returnValue=!0};goog.events.isMarkedIeEvent_=function(a){return 0>a.keyCode||void 0!=a.returnValue};goog.events.uniqueIdCounter_=0;
goog.events.getUniqueId=function(a){return a+"_"+goog.events.uniqueIdCounter_++};goog.events.getListenerMap_=function(a){a=a[goog.events.LISTENER_MAP_PROP_];return a instanceof goog.events.ListenerMap?a:null};goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(1E9*Math.random()>>>0);
goog.events.wrapListener_=function(a){goog.asserts.assert(a,"Listener can not be null.");if(goog.isFunction(a))return a;goog.asserts.assert(a.handleEvent,"An object listener must have handleEvent method.");return a[goog.events.LISTENER_WRAPPER_PROP_]||(a[goog.events.LISTENER_WRAPPER_PROP_]=function(b){return a.handleEvent(b)})};goog.debug.entryPointRegistry.register(function(a){goog.events.handleBrowserEvent_=a(goog.events.handleBrowserEvent_)});goog.events.EventTarget=function(){goog.Disposable.call(this);this.eventTargetListeners_=new goog.events.ListenerMap(this);this.actualEventTarget_=this};goog.inherits(goog.events.EventTarget,goog.Disposable);goog.events.Listenable.addImplementation(goog.events.EventTarget);goog.events.EventTarget.MAX_ANCESTORS_=1E3;goog.events.EventTarget.prototype.parentEventTarget_=null;goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};
goog.events.EventTarget.prototype.setParentEventTarget=function(a){this.parentEventTarget_=a};goog.events.EventTarget.prototype.addEventListener=function(a,b,c,d){goog.events.listen(this,a,b,c,d)};goog.events.EventTarget.prototype.removeEventListener=function(a,b,c,d){goog.events.unlisten(this,a,b,c,d)};
goog.events.EventTarget.prototype.dispatchEvent=function(a){this.assertInitialized_();var b,c=this.getParentEventTarget();if(c){b=[];for(var d=1;c;c=c.getParentEventTarget())b.push(c),goog.asserts.assert(++d<goog.events.EventTarget.MAX_ANCESTORS_,"infinite loop")}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,a,b)};
goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this);this.removeAllListeners();this.parentEventTarget_=null};goog.events.EventTarget.prototype.listen=function(a,b,c,d){this.assertInitialized_();return this.eventTargetListeners_.add(String(a),b,!1,c,d)};goog.events.EventTarget.prototype.listenOnce=function(a,b,c,d){return this.eventTargetListeners_.add(String(a),b,!0,c,d)};
goog.events.EventTarget.prototype.unlisten=function(a,b,c,d){return this.eventTargetListeners_.remove(String(a),b,c,d)};goog.events.EventTarget.prototype.unlistenByKey=function(a){return this.eventTargetListeners_.removeByKey(a)};goog.events.EventTarget.prototype.removeAllListeners=function(a){return this.eventTargetListeners_?this.eventTargetListeners_.removeAll(a):0};
goog.events.EventTarget.prototype.fireListeners=function(a,b,c){a=this.eventTargetListeners_.listeners[String(a)];if(!a)return!0;a=goog.array.clone(a);for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.removed&&f.capture==b){var g=f.listener,h=f.handler||f.src;f.callOnce&&this.unlistenByKey(f);d=!1!==g.call(h,c)&&d}}return d&&!1!=c.returnValue_};goog.events.EventTarget.prototype.getListeners=function(a,b){return this.eventTargetListeners_.getListeners(String(a),b)};
goog.events.EventTarget.prototype.getListener=function(a,b,c,d){return this.eventTargetListeners_.getListener(String(a),b,c,d)};goog.events.EventTarget.prototype.hasListener=function(a,b){var c=goog.isDef(a)?String(a):void 0;return this.eventTargetListeners_.hasListener(c,b)};goog.events.EventTarget.prototype.setTargetForTesting=function(a){this.actualEventTarget_=a};goog.events.EventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")};
goog.events.EventTarget.dispatchEventInternal_=function(a,b,c){var d=b.type||b;if(goog.isString(b))b=new goog.events.Event(b,a);else if(b instanceof goog.events.Event)b.target=b.target||a;else{var e=b;b=new goog.events.Event(d,a);goog.object.extend(b,e)}var e=!0,f;if(c)for(var g=c.length-1;!b.propagationStopped_&&0<=g;g--)f=b.currentTarget=c[g],e=f.fireListeners(d,!0,b)&&e;b.propagationStopped_||(f=b.currentTarget=a,e=f.fireListeners(d,!0,b)&&e,b.propagationStopped_||(e=f.fireListeners(d,!1,b)&&e));
if(c)for(g=0;!b.propagationStopped_&&g<c.length;g++)f=b.currentTarget=c[g],e=f.fireListeners(d,!1,b)&&e;return e};var ydn={debug:{}};ydn.debug.error={};ydn.debug.error.ArgumentException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.ArgumentException"};goog.inherits(ydn.debug.error.ArgumentException,goog.debug.Error);ydn.debug.error.TypeError=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.TypeError"};goog.inherits(ydn.debug.error.TypeError,goog.debug.Error);ydn.debug.error.NotSupportedException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.NotSupportedException"};
goog.inherits(ydn.debug.error.NotSupportedException,goog.debug.Error);ydn.debug.error.NotImplementedException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.NotImplementedException"};goog.inherits(ydn.debug.error.NotImplementedException,goog.debug.Error);ydn.debug.error.InvalidOperationException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.InvalidOperationException"};goog.inherits(ydn.debug.error.InvalidOperationException,goog.debug.Error);
ydn.debug.error.InternalError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.debug.error.InternalError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"};goog.inherits(ydn.debug.error.InternalError,Error);ydn.debug.error.InternalError.prototype.name="ydn.error.InternalError";
ydn.debug.error.ConstraintError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ConstraintError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"};goog.inherits(ydn.debug.error.ConstraintError,Error);ydn.debug.error.ConstraintError.prototype.name="ydn.error.ConstraintError";ydn.base={};ydn.base.JQUERY=!1;ydn.async={};ydn.async.Deferred=function(a,b){goog.async.Deferred.call(this,a,b);this.progbacks_=[]};goog.inherits(ydn.async.Deferred,goog.async.Deferred);ydn.async.Deferred.prototype.addProgback=function(a,b){this.progbacks_.push([a,b]);return this};ydn.async.Deferred.prototype.notify=function(a){for(var b=0;b<this.progbacks_.length;b++)this.progbacks_[b][0].call(this.progbacks_[b][1],a)};
ydn.async.Deferred.prototype.callback=function(a){this.progbacks_.length=0;ydn.async.Deferred.superClass_.callback.call(this,a)};ydn.async.Deferred.prototype.errback=function(a){this.progbacks_.length=0;ydn.async.Deferred.superClass_.errback.call(this,a)};
ydn.async.Deferred.prototype.then=function(a,b,c){if(c&&goog.isFunction(c))throw new ydn.debug.error.ArgumentException("progress callback is not supported");var d=a;goog.isFunction(a)&&(d=function(b){b=a.call(c,b);if(goog.isObject(b)&&goog.isFunction(b.then)){var d=new goog.async.Deferred;b.then.call(c,function(a){d.callback(a)},function(a){d.errback(a)});return d}return b});return this.addCallbacks(d,b,c)};ydn.msg={};ydn.msg.Message=function(a){this.id="i"+this.count();this.req=a;this.alive_=!0;this.error_=this.data_=null;this.df_=new ydn.async.Deferred;this.tid_=NaN};ydn.msg.Message.DEBUG=goog.DEBUG;ydn.msg.Message.prototype.getId=function(){return this.id};ydn.msg.Message.prototype.getReq=function(){return this.req};ydn.msg.Message.prototype.setRef=function(a,b){this.group_=a;this.name_=b};ydn.msg.Message.counter_=0;ydn.msg.Message.TIMEOUT=goog.DEBUG?5E3:25E3;ydn.msg.Message.prototype.promise=function(){return this.df_};
ydn.msg.Message.prototype.count=function(){ydn.msg.Message.counter_++;return ydn.msg.Message.counter_};ydn.msg.Message.prototype.isError=function(){return!!this.error_};
ydn.msg.Message.prototype.listen=function(a){if(a&&a.id==this.id){this.data_=a.data;var b=a.error;b&&(b instanceof Error?this.error_=b:goog.isObject(b)?(this.error_=Error(b.message),this.error_.name=b.name,this.error_.source=b,this.error_.result=this.data_):(this.error_=Error(b),this.error_.name="UnknownError"));a.done?(this.alive_=!1,this.error_?this.df_.errback(this.error_):this.df_.callback(this.data_),window.clearTimeout(this.tid_)):this.df_.notify(a.data);return!0}return!1};
ydn.msg.Message.prototype.toString=function(){return"Message:"+this.id+(this.alive_?"*":"")};ydn.msg.Message.prototype.hasDone=function(){return!this.alive_};ydn.msg.Message.prototype.setData=function(a){this.data_=a};ydn.msg.Message.prototype.getData=function(){return this.data_};ydn.msg.Message.prototype.getError=function(){return this.error_};
ydn.msg.Message.prototype.toJSON=function(){var a=this;this.tid_=window.setTimeout(function(){if(a.alive_){var b=Error("message timeout");b.name="TimeOutError";a.listen({id:a.id,req:a.req,error:b})}},ydn.msg.Message.TIMEOUT);return{id:this.id,req:this.req,group:this.group_,name:this.name_,data:this.data_}};ydn.msg.Pipe=function(a){goog.events.EventTarget.call(this);this.name=a||"main-"+goog.now();this.messages_=[];this.port_=this.info_=null;this.sub_channels_={}};goog.inherits(ydn.msg.Pipe,goog.events.EventTarget);ydn.msg.Pipe.prototype.disposeInternal=function(){if(this.port_){var a=this;this.port_.disconnect(function(){a.port_=null;a.messages_.length=0})}else this.messages_.length=0};ydn.msg.Pipe.MAX_MESSANGERS=50;ydn.msg.Pipe.DEBUG=goog.DEBUG;ydn.msg.Pipe.EventType="post";
ydn.msg.Event=function(a){goog.events.Event.call(this,ydn.msg.Pipe.EventType);this.message=a};goog.inherits(ydn.msg.Event,goog.events.Event);ydn.msg.Event.prototype.getMessage=function(){return this.message};ydn.msg.RReq={INFO:"info"};
ydn.msg.Pipe.prototype.defaultListener_=function(a){if(a&&a.id)for(var b=this.messages_.length-1;0<=b;b--)if(this.messages_[b].getId()==a.id){ydn.msg.Pipe.DEBUG&&window.console.log(this+" receiving msg "+a.req+":"+a.id,a);if(!a.id){a.req==ydn.msg.RReq.INFO?(a.data=this.info_,this.port_.postMessage(a)):this.dispatchEvent(new ydn.msg.Event(a));break}if(this.messages_[b].listen(a)){this.messages_[b].hasDone()?this.messages_.splice(b,1):b>ydn.msg.Pipe.MAX_MESSANGERS/2&&(a=this.messages_.splice(b,1),this.messages_.unshift(a[0]));
break}}};goog.DEBUG&&(ydn.msg.Pipe.prototype.toString=function(){return"Pipe:"+this.name});ydn.msg.Pipe.prototype.sendMsg=function(a){var b=a.toJSON();ydn.msg.Pipe.DEBUG&&window.console.log(this+" sending msg "+b.req+":"+b.id);this.getPort().postMessage(b);this.messages_.push(a);this.messages_.length>ydn.msg.Pipe.MAX_MESSANGERS&&(this.messages_.length-=1)};ydn.msg.Pipe.prototype.getChannelName=function(){return this.name};
ydn.msg.Pipe.prototype.getChannel=function(a,b){var c=a||ydn.msg.Group.MAIN,d=c+(b?"-"+b:"");this.sub_channels_[d]||(this.sub_channels_[d]=new ydn.msg.Channel(this,c,b||""));return this.sub_channels_[d]};ydn.msg.Pipe.prototype.setInfo=function(a){if(this.info_)throw Error("already listening");};
ydn.msg.Pipe.prototype.getPort=function(){if(!this.port_){var a=this;this.port_=chrome.runtime.connect({name:this.name});var b=goog.bind(this.defaultListener_,this);this.port_.onMessage.addListener(b);this.port_.onDisconnect.addListener(function(){ydn.msg.Pipe.DEBUG&&goog.global.console.log("disconnected port "+a.port_.name+" "+a.port_.url);a.port_.onMessage.removeListener(b);a.port_=null;a.messages_.length=0})}return this.port_};ydn.msg.main_=null;
ydn.msg.getMain=function(){ydn.msg.main_||(ydn.msg.main_=new ydn.msg.Pipe);return ydn.msg.main_};ydn.msg.Group={MAIN:"main",GMAIL:"gmail",HOST_PERMISSION:"host-permission",POPUP:"popup",OPTIONS:"options",CONTENT_SCRIPT:"content-script",SUGAR:"sugarcrm"};ydn.msg.getChannel=function(a,b){return ydn.msg.getMain().getChannel(a,b)};ydn.msg.Channel=function(a,b,c){this.main_=a;this.group_=b;this.name_=c};
ydn.msg.Channel.prototype.send=function(a,b){var c=new ydn.msg.Message(a);c.setRef(this.group_,this.name_);b&&c.setData(b);var d=c.promise();this.main_.sendMsg(c);return d};ydn.crm={};ydn.crm.Ch=function(){};ydn.crm.Ch.channels_={};ydn.crm.Ch.getChannel=function(a){return ydn.crm.Ch.channels_[a]};ydn.crm.Ch.list=function(){return Object.keys(ydn.crm.Ch.channels_)};
ydn.crm.Ch.Req={ACK:"ack",CLOSE_WINDOW:"wc",LIST_SUGAR:"list-sugarcrm",ECHO:"echo",LOGIN_INFO:"login-info",LOGOUT:"logout",GDATA_FETCH:"gdata-fetch",GDATA_CONTACT_MERGE:"gdcm",GDATA_LIST_CONTACT_BY_EMAIL:"gdata-list-contact-by-email",GDATA_TOKEN:"gdata-token",LOG:"log",NEW_ENTRY:"new-entry",SUGAR_SERVER_INFO:"sugar-server-info",NEW_SUGAR:"new-sugarcrm",NUKE:"nk",REMOVE_SUGAR:"remove-sugar",UPDATE_HOST_PERMISSION:"update-host-permission"};
ydn.crm.Ch.SReq={ABOUT:"about",DETAILS:"details",FETCH_MODULE:"fetch-module",GET:"get",LINK:"link",NEW_RECORD:"new-record",IMPORT_GDATA:"import-gdata",INFO_MODULE:"info-module",LIST:"list",LIST_MODULE:"list-module",LOGIN:"login",REST:"rest",SERVER_INFO:"server-info",SYNC_ENTRY:"sync-entry",UPDATE_HOST_PERMISSION:"update-host-permission"};goog.structs={};goog.structs.getCount=function(a){return"function"==typeof a.getCount?a.getCount():goog.isArrayLike(a)||goog.isString(a)?a.length:goog.object.getCount(a)};goog.structs.getValues=function(a){if("function"==typeof a.getValues)return a.getValues();if(goog.isString(a))return a.split("");if(goog.isArrayLike(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return goog.object.getValues(a)};
goog.structs.getKeys=function(a){if("function"==typeof a.getKeys)return a.getKeys();if("function"!=typeof a.getValues){if(goog.isArrayLike(a)||goog.isString(a)){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}return goog.object.getKeys(a)}};goog.structs.contains=function(a,b){return"function"==typeof a.contains?a.contains(b):"function"==typeof a.containsValue?a.containsValue(b):goog.isArrayLike(a)||goog.isString(a)?goog.array.contains(a,b):goog.object.containsValue(a,b)};
goog.structs.isEmpty=function(a){return"function"==typeof a.isEmpty?a.isEmpty():goog.isArrayLike(a)||goog.isString(a)?goog.array.isEmpty(a):goog.object.isEmpty(a)};goog.structs.clear=function(a){"function"==typeof a.clear?a.clear():goog.isArrayLike(a)?goog.array.clear(a):goog.object.clear(a)};
goog.structs.forEach=function(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(goog.isArrayLike(a)||goog.isString(a))goog.array.forEach(a,b,c);else for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;g<f;g++)b.call(c,e[g],d&&d[g],a)};
goog.structs.filter=function(a,b,c){if("function"==typeof a.filter)return a.filter(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.filter(a,b,c);var d,e=goog.structs.getKeys(a),f=goog.structs.getValues(a),g=f.length;if(e){d={};for(var h=0;h<g;h++)b.call(c,f[h],e[h],a)&&(d[e[h]]=f[h])}else for(d=[],h=0;h<g;h++)b.call(c,f[h],void 0,a)&&d.push(f[h]);return d};
goog.structs.map=function(a,b,c){if("function"==typeof a.map)return a.map(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.map(a,b,c);var d,e=goog.structs.getKeys(a),f=goog.structs.getValues(a),g=f.length;if(e){d={};for(var h=0;h<g;h++)d[e[h]]=b.call(c,f[h],e[h],a)}else for(d=[],h=0;h<g;h++)d[h]=b.call(c,f[h],void 0,a);return d};
goog.structs.some=function(a,b,c){if("function"==typeof a.some)return a.some(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.some(a,b,c);for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;g<f;g++)if(b.call(c,e[g],d&&d[g],a))return!0;return!1};
goog.structs.every=function(a,b,c){if("function"==typeof a.every)return a.every(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.every(a,b,c);for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;g<f;g++)if(!b.call(c,e[g],d&&d[g],a))return!1;return!0};goog.math={};goog.math.randomInt=function(a){return Math.floor(Math.random()*a)};goog.math.uniformRandom=function(a,b){return a+Math.random()*(b-a)};goog.math.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};goog.math.modulo=function(a,b){var c=a%b;return 0>c*b?c+b:c};goog.math.lerp=function(a,b,c){return a+c*(b-a)};goog.math.nearlyEquals=function(a,b,c){return Math.abs(a-b)<=(c||1E-6)};goog.math.standardAngle=function(a){return goog.math.modulo(a,360)};
goog.math.toRadians=function(a){return a*Math.PI/180};goog.math.toDegrees=function(a){return 180*a/Math.PI};goog.math.angleDx=function(a,b){return b*Math.cos(goog.math.toRadians(a))};goog.math.angleDy=function(a,b){return b*Math.sin(goog.math.toRadians(a))};goog.math.angle=function(a,b,c,d){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(d-b,c-a)))};goog.math.angleDifference=function(a,b){var c=goog.math.standardAngle(b)-goog.math.standardAngle(a);180<c?c-=360:-180>=c&&(c=360+c);return c};
goog.math.sign=function(a){return 0==a?0:0>a?-1:1};goog.math.longestCommonSubsequence=function(a,b,c,d){c=c||function(a,b){return a==b};d=d||function(b,c){return a[b]};for(var e=a.length,f=b.length,g=[],h=0;h<e+1;h++)g[h]=[],g[h][0]=0;for(var k=0;k<f+1;k++)g[0][k]=0;for(h=1;h<=e;h++)for(k=1;k<=f;k++)c(a[h-1],b[k-1])?g[h][k]=g[h-1][k-1]+1:g[h][k]=Math.max(g[h-1][k],g[h][k-1]);for(var l=[],h=e,k=f;0<h&&0<k;)c(a[h-1],b[k-1])?(l.unshift(d(h-1,k-1)),h--,k--):g[h-1][k]>g[h][k-1]?h--:k--;return l};
goog.math.sum=function(a){return goog.array.reduce(arguments,function(a,c){return a+c},0)};goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length};goog.math.sampleVariance=function(a){var b=arguments.length;if(2>b)return 0;var c=goog.math.average.apply(null,arguments);return goog.math.sum.apply(null,goog.array.map(arguments,function(a){return Math.pow(a-c,2)}))/(b-1)};goog.math.standardDeviation=function(a){return Math.sqrt(goog.math.sampleVariance.apply(null,arguments))};
goog.math.isInt=function(a){return isFinite(a)&&0==a%1};goog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)};goog.math.safeFloor=function(a,b){goog.asserts.assert(!goog.isDef(b)||0<b);return Math.floor(a+(b||2E-15))};goog.math.safeCeil=function(a,b){goog.asserts.assert(!goog.isDef(b)||0<b);return Math.ceil(a-(b||2E-15))};goog.iter={};goog.iter.StopIteration="StopIteration"in goog.global?goog.global.StopIteration:Error("StopIteration");goog.iter.Iterator=function(){};goog.iter.Iterator.prototype.next=function(){throw goog.iter.StopIteration;};goog.iter.Iterator.prototype.__iterator__=function(a){return this};
goog.iter.toIterator=function(a){if(a instanceof goog.iter.Iterator)return a;if("function"==typeof a.__iterator__)return a.__iterator__(!1);if(goog.isArrayLike(a)){var b=0,c=new goog.iter.Iterator;c.next=function(){for(;;){if(b>=a.length)throw goog.iter.StopIteration;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");};
goog.iter.forEach=function(a,b,c){if(goog.isArrayLike(a))try{goog.array.forEach(a,b,c)}catch(d){if(d!==goog.iter.StopIteration)throw d;}else{a=goog.iter.toIterator(a);try{for(;;)b.call(c,a.next(),void 0,a)}catch(e){if(e!==goog.iter.StopIteration)throw e;}}};goog.iter.filter=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;a.next=function(){for(;;){var a=d.next();if(b.call(c,a,void 0,d))return a}};return a};
goog.iter.range=function(a,b,c){var d=0,e=a,f=c||1;1<arguments.length&&(d=a,e=b);if(0==f)throw Error("Range step argument must not be zero");var g=new goog.iter.Iterator;g.next=function(){if(0<f&&d>=e||0>f&&d<=e)throw goog.iter.StopIteration;var a=d;d+=f;return a};return g};goog.iter.join=function(a,b){return goog.iter.toArray(a).join(b)};goog.iter.map=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;a.next=function(){for(;;){var a=d.next();return b.call(c,a,void 0,d)}};return a};
goog.iter.reduce=function(a,b,c,d){var e=c;goog.iter.forEach(a,function(a){e=b.call(d,e,a)});return e};goog.iter.some=function(a,b,c){a=goog.iter.toIterator(a);try{for(;;)if(b.call(c,a.next(),void 0,a))return!0}catch(d){if(d!==goog.iter.StopIteration)throw d;}return!1};goog.iter.every=function(a,b,c){a=goog.iter.toIterator(a);try{for(;;)if(!b.call(c,a.next(),void 0,a))return!1}catch(d){if(d!==goog.iter.StopIteration)throw d;}return!0};
goog.iter.chain=function(a){var b=goog.iter.toIterator(arguments),c=new goog.iter.Iterator,d=null;c.next=function(){for(;;){if(null==d){var a=b.next();d=goog.iter.toIterator(a)}try{return d.next()}catch(c){if(c!==goog.iter.StopIteration)throw c;d=null}}};return c};goog.iter.chainFromIterable=function(a){return goog.iter.chain.apply(void 0,a)};
goog.iter.dropWhile=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;var e=!0;a.next=function(){for(;;){var a=d.next();if(!e||!b.call(c,a,void 0,d))return e=!1,a}};return a};goog.iter.takeWhile=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;var e=!0;a.next=function(){for(;;)if(e){var a=d.next();if(b.call(c,a,void 0,d))return a;e=!1}else throw goog.iter.StopIteration;};return a};
goog.iter.toArray=function(a){if(goog.isArrayLike(a))return goog.array.toArray(a);a=goog.iter.toIterator(a);var b=[];goog.iter.forEach(a,function(a){b.push(a)});return b};goog.iter.equals=function(a,b){var c=goog.iter.zipLongest({},a,b);return goog.iter.every(c,function(a){return a[0]==a[1]})};goog.iter.nextOrValue=function(a,b){try{return goog.iter.toIterator(a).next()}catch(c){if(c!=goog.iter.StopIteration)throw c;return b}};
goog.iter.product=function(a){if(goog.array.some(arguments,function(a){return!a.length})||!arguments.length)return new goog.iter.Iterator;var b=new goog.iter.Iterator,c=arguments,d=goog.array.repeat(0,c.length);b.next=function(){if(d){for(var a=goog.array.map(d,function(a,b){return c[b][a]}),b=d.length-1;0<=b;b--){goog.asserts.assert(d);if(d[b]<c[b].length-1){d[b]++;break}if(0==b){d=null;break}d[b]=0}return a}throw goog.iter.StopIteration;};return b};
goog.iter.cycle=function(a){var b=goog.iter.toIterator(a),c=[],d=0;a=new goog.iter.Iterator;var e=!1;a.next=function(){var a=null;if(!e)try{return a=b.next(),c.push(a),a}catch(g){if(g!=goog.iter.StopIteration||goog.array.isEmpty(c))throw g;e=!0}a=c[d];d=(d+1)%c.length;return a};return a};goog.iter.count=function(a,b){var c=a||0,d=goog.isDef(b)?b:1,e=new goog.iter.Iterator;e.next=function(){var a=c;c+=d;return a};return e};
goog.iter.repeat=function(a){var b=new goog.iter.Iterator;b.next=goog.functions.constant(a);return b};goog.iter.accumulate=function(a){var b=goog.iter.toIterator(a),c=0;a=new goog.iter.Iterator;a.next=function(){return c+=b.next()};return a};goog.iter.zip=function(a){var b=arguments,c=new goog.iter.Iterator;if(0<b.length){var d=goog.array.map(b,goog.iter.toIterator);c.next=function(){return goog.array.map(d,function(a){return a.next()})}}return c};
goog.iter.zipLongest=function(a,b){var c=goog.array.slice(arguments,1),d=new goog.iter.Iterator;if(0<c.length){var e=goog.array.map(c,goog.iter.toIterator);d.next=function(){var b=!1,c=goog.array.map(e,function(c){var d;try{d=c.next(),b=!0}catch(e){if(e!==goog.iter.StopIteration)throw e;d=a}return d});if(!b)throw goog.iter.StopIteration;return c}}return d};goog.iter.compress=function(a,b){var c=goog.iter.toIterator(b);return goog.iter.filter(a,function(){return!!c.next()})};
goog.iter.GroupByIterator_=function(a,b){this.iterator=goog.iter.toIterator(a);this.keyFunc=b||goog.functions.identity};goog.inherits(goog.iter.GroupByIterator_,goog.iter.Iterator);goog.iter.GroupByIterator_.prototype.next=function(){for(;this.currentKey==this.targetKey;)this.currentValue=this.iterator.next(),this.currentKey=this.keyFunc(this.currentValue);this.targetKey=this.currentKey;return[this.currentKey,this.groupItems_(this.targetKey)]};
goog.iter.GroupByIterator_.prototype.groupItems_=function(a){for(var b=[];this.currentKey==a;){b.push(this.currentValue);try{this.currentValue=this.iterator.next()}catch(c){if(c!==goog.iter.StopIteration)throw c;break}this.currentKey=this.keyFunc(this.currentValue)}return b};goog.iter.groupBy=function(a,b){return new goog.iter.GroupByIterator_(a,b)};
goog.iter.tee=function(a,b){var c=goog.iter.toIterator(a),d=goog.isNumber(b)?b:2,e=goog.array.map(goog.array.range(d),function(){return[]}),f=function(){var a=c.next();goog.array.forEach(e,function(b){b.push(a)})};return goog.array.map(e,function(a){var b=new goog.iter.Iterator;b.next=function(){goog.array.isEmpty(a)&&f();goog.asserts.assert(!goog.array.isEmpty(a));return a.shift()};return b})};goog.iter.enumerate=function(a,b){return goog.iter.zip(goog.iter.count(b),a)};
goog.iter.limit=function(a,b){goog.asserts.assert(goog.math.isInt(b)&&0<=b);var c=goog.iter.toIterator(a),d=new goog.iter.Iterator,e=b;d.next=function(){if(0<e--)return c.next();throw goog.iter.StopIteration;};return d};goog.iter.consume=function(a,b){goog.asserts.assert(goog.math.isInt(b)&&0<=b);for(var c=goog.iter.toIterator(a);0<b--;)goog.iter.nextOrValue(c,null);return c};
goog.iter.slice=function(a,b,c){goog.asserts.assert(goog.math.isInt(b)&&0<=b);a=goog.iter.consume(a,b);goog.isNumber(c)&&(goog.asserts.assert(goog.math.isInt(c)&&c>=b),a=goog.iter.limit(a,c-b));return a};goog.iter.hasDuplicates_=function(a){var b=[];goog.array.removeDuplicates(a,b);return a.length!=b.length};goog.iter.permutations=function(a,b){var c=goog.iter.toArray(a),d=goog.isNumber(b)?b:c.length,c=goog.array.repeat(c,d),c=goog.iter.product.apply(void 0,c);return goog.iter.filter(c,function(a){return!goog.iter.hasDuplicates_(a)})};
goog.iter.combinations=function(a,b){function c(a){return d[a]}var d=goog.iter.toArray(a),e=goog.iter.range(d.length),e=goog.iter.permutations(e,b),f=goog.iter.filter(e,function(a){return goog.array.isSorted(a)}),e=new goog.iter.Iterator;e.next=function(){return goog.array.map(f.next(),c)};return e};
goog.iter.combinationsWithReplacement=function(a,b){function c(a){return d[a]}var d=goog.iter.toArray(a),e=goog.array.range(d.length),e=goog.array.repeat(e,b),e=goog.iter.product.apply(void 0,e),f=goog.iter.filter(e,function(a){return goog.array.isSorted(a)}),e=new goog.iter.Iterator;e.next=function(){return goog.array.map(f.next(),c)};return e};goog.structs.Map=function(a,b){this.map_={};this.keys_=[];this.version_=this.count_=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)};goog.structs.Map.prototype.getCount=function(){return this.count_};goog.structs.Map.prototype.getValues=function(){this.cleanupKeysArray_();for(var a=[],b=0;b<this.keys_.length;b++)a.push(this.map_[this.keys_[b]]);return a};
goog.structs.Map.prototype.getKeys=function(){this.cleanupKeysArray_();return this.keys_.concat()};goog.structs.Map.prototype.containsKey=function(a){return goog.structs.Map.hasKey_(this.map_,a)};goog.structs.Map.prototype.containsValue=function(a){for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b];if(goog.structs.Map.hasKey_(this.map_,c)&&this.map_[c]==a)return!0}return!1};
goog.structs.Map.prototype.equals=function(a,b){if(this===a)return!0;if(this.count_!=a.getCount())return!1;var c=b||goog.structs.Map.defaultEquals;this.cleanupKeysArray_();for(var d,e=0;d=this.keys_[e];e++)if(!c(this.get(d),a.get(d)))return!1;return!0};goog.structs.Map.defaultEquals=function(a,b){return a===b};goog.structs.Map.prototype.isEmpty=function(){return 0==this.count_};goog.structs.Map.prototype.clear=function(){this.map_={};this.version_=this.count_=this.keys_.length=0};
goog.structs.Map.prototype.remove=function(a){return goog.structs.Map.hasKey_(this.map_,a)?(delete this.map_[a],this.count_--,this.version_++,this.keys_.length>2*this.count_&&this.cleanupKeysArray_(),!0):!1};
goog.structs.Map.prototype.cleanupKeysArray_=function(){if(this.count_!=this.keys_.length){for(var a=0,b=0;a<this.keys_.length;){var c=this.keys_[a];goog.structs.Map.hasKey_(this.map_,c)&&(this.keys_[b++]=c);a++}this.keys_.length=b}if(this.count_!=this.keys_.length){for(var d={},b=a=0;a<this.keys_.length;)c=this.keys_[a],goog.structs.Map.hasKey_(d,c)||(this.keys_[b++]=c,d[c]=1),a++;this.keys_.length=b}};
goog.structs.Map.prototype.get=function(a,b){return goog.structs.Map.hasKey_(this.map_,a)?this.map_[a]:b};goog.structs.Map.prototype.set=function(a,b){goog.structs.Map.hasKey_(this.map_,a)||(this.count_++,this.keys_.push(a),this.version_++);this.map_[a]=b};goog.structs.Map.prototype.addAll=function(a){var b;a instanceof goog.structs.Map?(b=a.getKeys(),a=a.getValues()):(b=goog.object.getKeys(a),a=goog.object.getValues(a));for(var c=0;c<b.length;c++)this.set(b[c],a[c])};
goog.structs.Map.prototype.clone=function(){return new goog.structs.Map(this)};goog.structs.Map.prototype.transpose=function(){for(var a=new goog.structs.Map,b=0;b<this.keys_.length;b++){var c=this.keys_[b];a.set(this.map_[c],c)}return a};goog.structs.Map.prototype.toObject=function(){this.cleanupKeysArray_();for(var a={},b=0;b<this.keys_.length;b++){var c=this.keys_[b];a[c]=this.map_[c]}return a};goog.structs.Map.prototype.getKeyIterator=function(){return this.__iterator__(!0)};
goog.structs.Map.prototype.getValueIterator=function(){return this.__iterator__(!1)};goog.structs.Map.prototype.__iterator__=function(a){this.cleanupKeysArray_();var b=0,c=this.keys_,d=this.map_,e=this.version_,f=this,g=new goog.iter.Iterator;g.next=function(){for(;;){if(e!=f.version_)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw goog.iter.StopIteration;var g=c[b++];return a?g:d[g]}};return g};
goog.structs.Map.hasKey_=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};goog.uri={};goog.uri.utils={};goog.uri.utils.CharCode_={AMPERSAND:38,EQUAL:61,HASH:35,QUESTION:63};goog.uri.utils.buildFromEncodedParts=function(a,b,c,d,e,f,g){var h="";a&&(h+=a+":");c&&(h+="//",b&&(h+=b+"@"),h+=c,d&&(h+=":"+d));e&&(h+=e);f&&(h+="?"+f);g&&(h+="#"+g);return h};goog.uri.utils.splitRe_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};goog.uri.utils.split=function(a){goog.uri.utils.phishingProtection_();return a.match(goog.uri.utils.splitRe_)};goog.uri.utils.needsPhishingProtection_=goog.userAgent.WEBKIT;
goog.uri.utils.phishingProtection_=function(){if(goog.uri.utils.needsPhishingProtection_){goog.uri.utils.needsPhishingProtection_=!1;var a=goog.global.location;if(a){var b=a.href;if(b&&(b=goog.uri.utils.getDomain(b))&&b!=a.hostname)throw goog.uri.utils.needsPhishingProtection_=!0,Error();}}};goog.uri.utils.decodeIfPossible_=function(a){return a&&decodeURIComponent(a)};goog.uri.utils.getComponentByIndex_=function(a,b){return goog.uri.utils.split(b)[a]||null};
goog.uri.utils.getScheme=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.SCHEME,a)};goog.uri.utils.getEffectiveScheme=function(a){a=goog.uri.utils.getScheme(a);!a&&self.location&&(a=self.location.protocol,a=a.substr(0,a.length-1));return a?a.toLowerCase():""};goog.uri.utils.getUserInfoEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.USER_INFO,a)};goog.uri.utils.getUserInfo=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getUserInfoEncoded(a))};
goog.uri.utils.getDomainEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.DOMAIN,a)};goog.uri.utils.getDomain=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getDomainEncoded(a))};goog.uri.utils.getPort=function(a){return Number(goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PORT,a))||null};goog.uri.utils.getPathEncoded=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PATH,a)};
goog.uri.utils.getPath=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getPathEncoded(a))};goog.uri.utils.getQueryData=function(a){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.QUERY_DATA,a)};goog.uri.utils.getFragmentEncoded=function(a){var b=a.indexOf("#");return 0>b?null:a.substr(b+1)};goog.uri.utils.setFragmentEncoded=function(a,b){return goog.uri.utils.removeFragment(a)+(b?"#"+b:"")};goog.uri.utils.getFragment=function(a){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getFragmentEncoded(a))};
goog.uri.utils.getHost=function(a){a=goog.uri.utils.split(a);return goog.uri.utils.buildFromEncodedParts(a[goog.uri.utils.ComponentIndex.SCHEME],a[goog.uri.utils.ComponentIndex.USER_INFO],a[goog.uri.utils.ComponentIndex.DOMAIN],a[goog.uri.utils.ComponentIndex.PORT])};goog.uri.utils.getPathAndAfter=function(a){a=goog.uri.utils.split(a);return goog.uri.utils.buildFromEncodedParts(null,null,null,null,a[goog.uri.utils.ComponentIndex.PATH],a[goog.uri.utils.ComponentIndex.QUERY_DATA],a[goog.uri.utils.ComponentIndex.FRAGMENT])};
goog.uri.utils.removeFragment=function(a){var b=a.indexOf("#");return 0>b?a:a.substr(0,b)};goog.uri.utils.haveSameDomain=function(a,b){var c=goog.uri.utils.split(a),d=goog.uri.utils.split(b);return c[goog.uri.utils.ComponentIndex.DOMAIN]==d[goog.uri.utils.ComponentIndex.DOMAIN]&&c[goog.uri.utils.ComponentIndex.SCHEME]==d[goog.uri.utils.ComponentIndex.SCHEME]&&c[goog.uri.utils.ComponentIndex.PORT]==d[goog.uri.utils.ComponentIndex.PORT]};
goog.uri.utils.assertNoFragmentsOrQueries_=function(a){if(goog.DEBUG&&(0<=a.indexOf("#")||0<=a.indexOf("?")))throw Error("goog.uri.utils: Fragment or query identifiers are not supported: ["+a+"]");};goog.uri.utils.appendQueryData_=function(a){if(a[1]){var b=a[0],c=b.indexOf("#");0<=c&&(a.push(b.substr(c)),a[0]=b=b.substr(0,c));c=b.indexOf("?");0>c?a[1]="?":c==b.length-1&&(a[1]=void 0)}return a.join("")};
goog.uri.utils.appendKeyValuePairs_=function(a,b,c){if(goog.isArray(b)){goog.asserts.assertArray(b);for(var d=0;d<b.length;d++)goog.uri.utils.appendKeyValuePairs_(a,String(b[d]),c)}else null!=b&&c.push("&",a,""===b?"":"=",goog.string.urlEncode(b))};goog.uri.utils.buildQueryDataBuffer_=function(a,b,c){goog.asserts.assert(0==Math.max(b.length-(c||0),0)%2,"goog.uri.utils: Key/value lists must be even in length.");for(c=c||0;c<b.length;c+=2)goog.uri.utils.appendKeyValuePairs_(b[c],b[c+1],a);return a};
goog.uri.utils.buildQueryData=function(a,b){var c=goog.uri.utils.buildQueryDataBuffer_([],a,b);c[0]="";return c.join("")};goog.uri.utils.buildQueryDataBufferFromMap_=function(a,b){for(var c in b)goog.uri.utils.appendKeyValuePairs_(c,b[c],a);return a};goog.uri.utils.buildQueryDataFromMap=function(a){a=goog.uri.utils.buildQueryDataBufferFromMap_([],a);a[0]="";return a.join("")};
goog.uri.utils.appendParams=function(a,b){return goog.uri.utils.appendQueryData_(2==arguments.length?goog.uri.utils.buildQueryDataBuffer_([a],arguments[1],0):goog.uri.utils.buildQueryDataBuffer_([a],arguments,1))};goog.uri.utils.appendParamsFromMap=function(a,b){return goog.uri.utils.appendQueryData_(goog.uri.utils.buildQueryDataBufferFromMap_([a],b))};goog.uri.utils.appendParam=function(a,b,c){a=[a,"&",b];goog.isDefAndNotNull(c)&&a.push("=",goog.string.urlEncode(c));return goog.uri.utils.appendQueryData_(a)};
goog.uri.utils.findParam_=function(a,b,c,d){for(var e=c.length;0<=(b=a.indexOf(c,b))&&b<d;){var f=a.charCodeAt(b-1);if(f==goog.uri.utils.CharCode_.AMPERSAND||f==goog.uri.utils.CharCode_.QUESTION)if(f=a.charCodeAt(b+e),!f||f==goog.uri.utils.CharCode_.EQUAL||f==goog.uri.utils.CharCode_.AMPERSAND||f==goog.uri.utils.CharCode_.HASH)return b;b+=e+1}return-1};goog.uri.utils.hashOrEndRe_=/#|$/;goog.uri.utils.hasParam=function(a,b){return 0<=goog.uri.utils.findParam_(a,0,b,a.search(goog.uri.utils.hashOrEndRe_))};
goog.uri.utils.getParamValue=function(a,b){var c=a.search(goog.uri.utils.hashOrEndRe_),d=goog.uri.utils.findParam_(a,0,b,c);if(0>d)return null;var e=a.indexOf("&",d);if(0>e||e>c)e=c;d+=b.length+1;return goog.string.urlDecode(a.substr(d,e-d))};goog.uri.utils.getParamValues=function(a,b){for(var c=a.search(goog.uri.utils.hashOrEndRe_),d=0,e,f=[];0<=(e=goog.uri.utils.findParam_(a,d,b,c));){d=a.indexOf("&",e);if(0>d||d>c)d=c;e+=b.length+1;f.push(goog.string.urlDecode(a.substr(e,d-e)))}return f};
goog.uri.utils.trailingQueryPunctuationRe_=/[?&]($|#)/;goog.uri.utils.removeParam=function(a,b){for(var c=a.search(goog.uri.utils.hashOrEndRe_),d=0,e,f=[];0<=(e=goog.uri.utils.findParam_(a,d,b,c));)f.push(a.substring(d,e)),d=Math.min(a.indexOf("&",e)+1||c,c);f.push(a.substr(d));return f.join("").replace(goog.uri.utils.trailingQueryPunctuationRe_,"$1")};goog.uri.utils.setParam=function(a,b,c){return goog.uri.utils.appendParam(goog.uri.utils.removeParam(a,b),b,c)};
goog.uri.utils.appendPath=function(a,b){goog.uri.utils.assertNoFragmentsOrQueries_(a);goog.string.endsWith(a,"/")&&(a=a.substr(0,a.length-1));goog.string.startsWith(b,"/")&&(b=b.substr(1));return goog.string.buildString(a,"/",b)};goog.uri.utils.StandardQueryParam={RANDOM:"zx"};goog.uri.utils.makeUnique=function(a){return goog.uri.utils.setParam(a,goog.uri.utils.StandardQueryParam.RANDOM,goog.string.getRandomString())};goog.Uri=function(a,b){var c;a instanceof goog.Uri?(this.ignoreCase_=goog.isDef(b)?b:a.getIgnoreCase(),this.setScheme(a.getScheme()),this.setUserInfo(a.getUserInfo()),this.setDomain(a.getDomain()),this.setPort(a.getPort()),this.setPath(a.getPath()),this.setQueryData(a.getQueryData().clone()),this.setFragment(a.getFragment())):a&&(c=goog.uri.utils.split(String(a)))?(this.ignoreCase_=!!b,this.setScheme(c[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(c[goog.uri.utils.ComponentIndex.USER_INFO]||
"",!0),this.setDomain(c[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(c[goog.uri.utils.ComponentIndex.PORT]),this.setPath(c[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(c[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(c[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):(this.ignoreCase_=!!b,this.queryData_=new goog.Uri.QueryData(null,null,this.ignoreCase_))};goog.Uri.preserveParameterTypesCompatibilityFlag=!1;goog.Uri.RANDOM_PARAM=goog.uri.utils.StandardQueryParam.RANDOM;
goog.Uri.prototype.scheme_="";goog.Uri.prototype.userInfo_="";goog.Uri.prototype.domain_="";goog.Uri.prototype.port_=null;goog.Uri.prototype.path_="";goog.Uri.prototype.fragment_="";goog.Uri.prototype.isReadOnly_=!1;goog.Uri.prototype.ignoreCase_=!1;
goog.Uri.prototype.toString=function(){var a=[],b=this.getScheme();b&&a.push(goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInSchemeOrUserInfo_),":");if(b=this.getDomain()){a.push("//");var c=this.getUserInfo();c&&a.push(goog.Uri.encodeSpecialChars_(c,goog.Uri.reDisallowedInSchemeOrUserInfo_),"@");a.push(goog.string.urlEncode(b));b=this.getPort();null!=b&&a.push(":",String(b))}if(b=this.getPath())this.hasDomain()&&"/"!=b.charAt(0)&&a.push("/"),a.push(goog.Uri.encodeSpecialChars_(b,"/"==b.charAt(0)?
goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_));(b=this.getEncodedQuery())&&a.push("?",b);(b=this.getFragment())&&a.push("#",goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInFragment_));return a.join("")};
goog.Uri.prototype.resolve=function(a){var b=this.clone(),c=a.hasScheme();c?b.setScheme(a.getScheme()):c=a.hasUserInfo();c?b.setUserInfo(a.getUserInfo()):c=a.hasDomain();c?b.setDomain(a.getDomain()):c=a.hasPort();var d=a.getPath();if(c)b.setPort(a.getPort());else if(c=a.hasPath()){if("/"!=d.charAt(0))if(this.hasDomain()&&!this.hasPath())d="/"+d;else{var e=b.getPath().lastIndexOf("/");-1!=e&&(d=b.getPath().substr(0,e+1)+d)}d=goog.Uri.removeDotSegments(d)}c?b.setPath(d):c=a.hasQuery();c?b.setQueryData(a.getDecodedQuery()):
c=a.hasFragment();c&&b.setFragment(a.getFragment());return b};goog.Uri.prototype.clone=function(){return new goog.Uri(this)};goog.Uri.prototype.getScheme=function(){return this.scheme_};goog.Uri.prototype.setScheme=function(a,b){this.enforceReadOnly();if(this.scheme_=b?goog.Uri.decodeOrEmpty_(a):a)this.scheme_=this.scheme_.replace(/:$/,"");return this};goog.Uri.prototype.hasScheme=function(){return!!this.scheme_};goog.Uri.prototype.getUserInfo=function(){return this.userInfo_};
goog.Uri.prototype.setUserInfo=function(a,b){this.enforceReadOnly();this.userInfo_=b?goog.Uri.decodeOrEmpty_(a):a;return this};goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_};goog.Uri.prototype.getDomain=function(){return this.domain_};goog.Uri.prototype.setDomain=function(a,b){this.enforceReadOnly();this.domain_=b?goog.Uri.decodeOrEmpty_(a):a;return this};goog.Uri.prototype.hasDomain=function(){return!!this.domain_};goog.Uri.prototype.getPort=function(){return this.port_};
goog.Uri.prototype.setPort=function(a){this.enforceReadOnly();if(a){a=Number(a);if(isNaN(a)||0>a)throw Error("Bad port number "+a);this.port_=a}else this.port_=null;return this};goog.Uri.prototype.hasPort=function(){return null!=this.port_};goog.Uri.prototype.getPath=function(){return this.path_};goog.Uri.prototype.setPath=function(a,b){this.enforceReadOnly();this.path_=b?goog.Uri.decodeOrEmpty_(a):a;return this};goog.Uri.prototype.hasPath=function(){return!!this.path_};
goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()};goog.Uri.prototype.setQueryData=function(a,b){this.enforceReadOnly();a instanceof goog.Uri.QueryData?(this.queryData_=a,this.queryData_.setIgnoreCase(this.ignoreCase_)):(b||(a=goog.Uri.encodeSpecialChars_(a,goog.Uri.reDisallowedInQuery_)),this.queryData_=new goog.Uri.QueryData(a,null,this.ignoreCase_));return this};goog.Uri.prototype.setQuery=function(a,b){return this.setQueryData(a,b)};
goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()};goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()};goog.Uri.prototype.getQueryData=function(){return this.queryData_};goog.Uri.prototype.getQuery=function(){return this.getEncodedQuery()};goog.Uri.prototype.setParameterValue=function(a,b){this.enforceReadOnly();this.queryData_.set(a,b);return this};
goog.Uri.prototype.setParameterValues=function(a,b){this.enforceReadOnly();goog.isArray(b)||(b=[String(b)]);this.queryData_.setValues(a,b);return this};goog.Uri.prototype.getParameterValues=function(a){return this.queryData_.getValues(a)};goog.Uri.prototype.getParameterValue=function(a){return this.queryData_.get(a)};goog.Uri.prototype.getFragment=function(){return this.fragment_};goog.Uri.prototype.setFragment=function(a,b){this.enforceReadOnly();this.fragment_=b?goog.Uri.decodeOrEmpty_(a):a;return this};
goog.Uri.prototype.hasFragment=function(){return!!this.fragment_};goog.Uri.prototype.hasSameDomainAs=function(a){return(!this.hasDomain()&&!a.hasDomain()||this.getDomain()==a.getDomain())&&(!this.hasPort()&&!a.hasPort()||this.getPort()==a.getPort())};goog.Uri.prototype.makeUnique=function(){this.enforceReadOnly();this.setParameterValue(goog.Uri.RANDOM_PARAM,goog.string.getRandomString());return this};goog.Uri.prototype.removeParameter=function(a){this.enforceReadOnly();this.queryData_.remove(a);return this};
goog.Uri.prototype.setReadOnly=function(a){this.isReadOnly_=a;return this};goog.Uri.prototype.isReadOnly=function(){return this.isReadOnly_};goog.Uri.prototype.enforceReadOnly=function(){if(this.isReadOnly_)throw Error("Tried to modify a read-only Uri");};goog.Uri.prototype.setIgnoreCase=function(a){this.ignoreCase_=a;this.queryData_&&this.queryData_.setIgnoreCase(a);return this};goog.Uri.prototype.getIgnoreCase=function(){return this.ignoreCase_};
goog.Uri.parse=function(a,b){return a instanceof goog.Uri?a.clone():new goog.Uri(a,b)};goog.Uri.create=function(a,b,c,d,e,f,g,h){h=new goog.Uri(null,h);a&&h.setScheme(a);b&&h.setUserInfo(b);c&&h.setDomain(c);d&&h.setPort(d);e&&h.setPath(e);f&&h.setQueryData(f);g&&h.setFragment(g);return h};goog.Uri.resolve=function(a,b){a instanceof goog.Uri||(a=goog.Uri.parse(a));b instanceof goog.Uri||(b=goog.Uri.parse(b));return a.resolve(b)};
goog.Uri.removeDotSegments=function(a){if(".."==a||"."==a)return"";if(goog.string.contains(a,"./")||goog.string.contains(a,"/.")){var b=goog.string.startsWith(a,"/");a=a.split("/");for(var c=[],d=0;d<a.length;){var e=a[d++];"."==e?b&&d==a.length&&c.push(""):".."==e?((1<c.length||1==c.length&&""!=c[0])&&c.pop(),b&&d==a.length&&c.push("")):(c.push(e),b=!0)}return c.join("/")}return a};goog.Uri.decodeOrEmpty_=function(a){return a?decodeURIComponent(a):""};
goog.Uri.encodeSpecialChars_=function(a,b){return goog.isString(a)?encodeURI(a).replace(b,goog.Uri.encodeChar_):null};goog.Uri.encodeChar_=function(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)};goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g;goog.Uri.reDisallowedInRelativePath_=/[\#\?:]/g;goog.Uri.reDisallowedInAbsolutePath_=/[\#\?]/g;goog.Uri.reDisallowedInQuery_=/[\#\?@]/g;goog.Uri.reDisallowedInFragment_=/#/g;
goog.Uri.haveSameDomain=function(a,b){var c=goog.uri.utils.split(a),d=goog.uri.utils.split(b);return c[goog.uri.utils.ComponentIndex.DOMAIN]==d[goog.uri.utils.ComponentIndex.DOMAIN]&&c[goog.uri.utils.ComponentIndex.PORT]==d[goog.uri.utils.ComponentIndex.PORT]};goog.Uri.QueryData=function(a,b,c){this.encodedQuery_=a||null;this.ignoreCase_=!!c};
goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_=new goog.structs.Map,this.count_=0,this.encodedQuery_))for(var a=this.encodedQuery_.split("&"),b=0;b<a.length;b++){var c=a[b].indexOf("="),d=null,e=null;0<=c?(d=a[b].substring(0,c),e=a[b].substring(c+1)):d=a[b];d=goog.string.urlDecode(d);d=this.getKeyName_(d);this.add(d,e?goog.string.urlDecode(e):"")}};
goog.Uri.QueryData.createFromMap=function(a,b,c){b=goog.structs.getKeys(a);if("undefined"==typeof b)throw Error("Keys are undefined");c=new goog.Uri.QueryData(null,null,c);a=goog.structs.getValues(a);for(var d=0;d<b.length;d++){var e=b[d],f=a[d];goog.isArray(f)?c.setValues(e,f):c.add(e,f)}return c};
goog.Uri.QueryData.createFromKeysValues=function(a,b,c,d){if(a.length!=b.length)throw Error("Mismatched lengths for keys/values");c=new goog.Uri.QueryData(null,null,d);for(d=0;d<a.length;d++)c.add(a[d],b[d]);return c};goog.Uri.QueryData.prototype.keyMap_=null;goog.Uri.QueryData.prototype.count_=null;goog.Uri.QueryData.prototype.getCount=function(){this.ensureKeyMapInitialized_();return this.count_};
goog.Uri.QueryData.prototype.add=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);var c=this.keyMap_.get(a);c||this.keyMap_.set(a,c=[]);c.push(b);this.count_++;return this};goog.Uri.QueryData.prototype.remove=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.containsKey(a)?(this.invalidateCache_(),this.count_-=this.keyMap_.get(a).length,this.keyMap_.remove(a)):!1};
goog.Uri.QueryData.prototype.clear=function(){this.invalidateCache_();this.keyMap_=null;this.count_=0};goog.Uri.QueryData.prototype.isEmpty=function(){this.ensureKeyMapInitialized_();return 0==this.count_};goog.Uri.QueryData.prototype.containsKey=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.containsKey(a)};goog.Uri.QueryData.prototype.containsValue=function(a){var b=this.getValues();return goog.array.contains(b,a)};
goog.Uri.QueryData.prototype.getKeys=function(){this.ensureKeyMapInitialized_();for(var a=this.keyMap_.getValues(),b=this.keyMap_.getKeys(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};goog.Uri.QueryData.prototype.getValues=function(a){this.ensureKeyMapInitialized_();var b=[];if(goog.isString(a))this.containsKey(a)&&(b=goog.array.concat(b,this.keyMap_.get(this.getKeyName_(a))));else{a=this.keyMap_.getValues();for(var c=0;c<a.length;c++)b=goog.array.concat(b,a[c])}return b};
goog.Uri.QueryData.prototype.set=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);this.containsKey(a)&&(this.count_-=this.keyMap_.get(a).length);this.keyMap_.set(a,[b]);this.count_++;return this};goog.Uri.QueryData.prototype.get=function(a,b){var c=a?this.getValues(a):[];return goog.Uri.preserveParameterTypesCompatibilityFlag?0<c.length?c[0]:b:0<c.length?String(c[0]):b};
goog.Uri.QueryData.prototype.setValues=function(a,b){this.remove(a);0<b.length&&(this.invalidateCache_(),this.keyMap_.set(this.getKeyName_(a),goog.array.clone(b)),this.count_+=b.length)};
goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var a=[],b=this.keyMap_.getKeys(),c=0;c<b.length;c++)for(var d=b[c],e=goog.string.urlEncode(d),d=this.getValues(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+goog.string.urlEncode(d[f]));a.push(g)}return this.encodedQuery_=a.join("&")};goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())};
goog.Uri.QueryData.prototype.invalidateCache_=function(){this.encodedQuery_=null};goog.Uri.QueryData.prototype.filterKeys=function(a){this.ensureKeyMapInitialized_();goog.structs.forEach(this.keyMap_,function(b,c,d){goog.array.contains(a,c)||this.remove(c)},this);return this};goog.Uri.QueryData.prototype.clone=function(){var a=new goog.Uri.QueryData;a.encodedQuery_=this.encodedQuery_;this.keyMap_&&(a.keyMap_=this.keyMap_.clone(),a.count_=this.count_);return a};
goog.Uri.QueryData.prototype.getKeyName_=function(a){a=String(a);this.ignoreCase_&&(a=a.toLowerCase());return a};goog.Uri.QueryData.prototype.setIgnoreCase=function(a){a&&!this.ignoreCase_&&(this.ensureKeyMapInitialized_(),this.invalidateCache_(),goog.structs.forEach(this.keyMap_,function(a,c){var d=c.toLowerCase();c!=d&&(this.remove(c),this.setValues(d,a))},this));this.ignoreCase_=a};
goog.Uri.QueryData.prototype.extend=function(a){for(var b=0;b<arguments.length;b++)goog.structs.forEach(arguments[b],function(a,b){this.add(b,a)},this)};goog.structs.Collection=function(){};goog.structs.Set=function(a){this.map_=new goog.structs.Map;a&&this.addAll(a)};goog.structs.Set.getKey_=function(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+goog.getUid(a):b.substr(0,1)+a};goog.structs.Set.prototype.getCount=function(){return this.map_.getCount()};goog.structs.Set.prototype.add=function(a){this.map_.set(goog.structs.Set.getKey_(a),a)};goog.structs.Set.prototype.addAll=function(a){a=goog.structs.getValues(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};
goog.structs.Set.prototype.removeAll=function(a){a=goog.structs.getValues(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};goog.structs.Set.prototype.remove=function(a){return this.map_.remove(goog.structs.Set.getKey_(a))};goog.structs.Set.prototype.clear=function(){this.map_.clear()};goog.structs.Set.prototype.isEmpty=function(){return this.map_.isEmpty()};goog.structs.Set.prototype.contains=function(a){return this.map_.containsKey(goog.structs.Set.getKey_(a))};
goog.structs.Set.prototype.containsAll=function(a){return goog.structs.every(a,this.contains,this)};goog.structs.Set.prototype.intersection=function(a){var b=new goog.structs.Set;a=goog.structs.getValues(a);for(var c=0;c<a.length;c++){var d=a[c];this.contains(d)&&b.add(d)}return b};goog.structs.Set.prototype.difference=function(a){var b=this.clone();b.removeAll(a);return b};goog.structs.Set.prototype.getValues=function(){return this.map_.getValues()};goog.structs.Set.prototype.clone=function(){return new goog.structs.Set(this)};
goog.structs.Set.prototype.equals=function(a){return this.getCount()==goog.structs.getCount(a)&&this.isSubsetOf(a)};goog.structs.Set.prototype.isSubsetOf=function(a){var b=goog.structs.getCount(a);if(this.getCount()>b)return!1;!(a instanceof goog.structs.Set)&&5<b&&(a=new goog.structs.Set(a));return goog.structs.every(this,function(b){return goog.structs.contains(a,b)})};goog.structs.Set.prototype.__iterator__=function(a){return this.map_.__iterator__(!1)};goog.debug.LOGGING_ENABLED=goog.DEBUG;goog.debug.catchErrors=function(a,b,c){c=c||goog.global;var d=c.onerror,e=!!b;goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("535.3")&&(e=!e);c.onerror=function(b,c,h,k,l){d&&d(b,c,h,k,l);a({message:b,fileName:c,line:h,col:k,error:l});return e}};goog.debug.expose=function(a,b){if("undefined"==typeof a)return"undefined";if(null==a)return"NULL";var c=[],d;for(d in a)if(b||!goog.isFunction(a[d])){var e=d+" = ";try{e+=a[d]}catch(f){e+="*** "+f+" ***"}c.push(e)}return c.join("\n")};
goog.debug.deepExpose=function(a,b){var c=new goog.structs.Set,d=[],e=function(a,g){var h=g+"  ";try{if(goog.isDef(a))if(goog.isNull(a))d.push("NULL");else if(goog.isString(a))d.push('"'+a.replace(/\n/g,"\n"+g)+'"');else if(goog.isFunction(a))d.push(String(a).replace(/\n/g,"\n"+g));else if(goog.isObject(a))if(c.contains(a))d.push("*** reference loop detected ***");else{c.add(a);d.push("{");for(var k in a)if(b||!goog.isFunction(a[k]))d.push("\n"),d.push(h),d.push(k+" = "),e(a[k],h);d.push("\n"+g+"}")}else d.push(a);
else d.push("undefined")}catch(l){d.push("*** "+l+" ***")}};e(a,"");return d.join("")};goog.debug.exposeArray=function(a){for(var b=[],c=0;c<a.length;c++)goog.isArray(a[c])?b.push(goog.debug.exposeArray(a[c])):b.push(a[c]);return"[ "+b.join(", ")+" ]"};
goog.debug.exposeException=function(a,b){try{var c=goog.debug.normalizeErrorObject(a);return"Message: "+goog.string.htmlEscape(c.message)+'\nUrl: <a href="view-source:'+c.fileName+'" target="_new">'+c.fileName+"</a>\nLine: "+c.lineNumber+"\n\nBrowser stack:\n"+goog.string.htmlEscape(c.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+goog.string.htmlEscape(goog.debug.getStacktrace(b)+"-> ")}catch(d){return"Exception trying to expose exception! You win, we lose. "+d}};
goog.debug.normalizeErrorObject=function(a){var b=goog.getObjectByName("window.location.href");if(goog.isString(a))return{message:a,name:"Unknown error",lineNumber:"Not available",fileName:b,stack:"Not available"};var c,d,e=!1;try{c=a.lineNumber||a.line||"Not available"}catch(f){c="Not available",e=!0}try{d=a.fileName||a.filename||a.sourceURL||goog.global.$googDebugFname||b}catch(g){d="Not available",e=!0}return!e&&a.lineNumber&&a.fileName&&a.stack&&a.message&&a.name?a:{message:a.message||"Not available",
name:a.name||"UnknownError",lineNumber:c,fileName:d,stack:a.stack||"Not available"}};goog.debug.enhanceError=function(a,b){var c="string"==typeof a?Error(a):a;c.stack||(c.stack=goog.debug.getStacktrace(arguments.callee.caller));if(b){for(var d=0;c["message"+d];)++d;c["message"+d]=String(b)}return c};
goog.debug.getStacktraceSimple=function(a){for(var b=[],c=arguments.callee.caller,d=0;c&&(!a||d<a);){b.push(goog.debug.getFunctionName(c));b.push("()\n");try{c=c.caller}catch(e){b.push("[exception trying to get caller]\n");break}d++;if(d>=goog.debug.MAX_STACK_DEPTH){b.push("[...long stack...]");break}}a&&d>=a?b.push("[...reached max depth limit...]"):b.push("[end]");return b.join("")};goog.debug.MAX_STACK_DEPTH=50;
goog.debug.getStacktrace=function(a){return goog.debug.getStacktraceHelper_(a||arguments.callee.caller,[])};
goog.debug.getStacktraceHelper_=function(a,b){var c=[];if(goog.array.contains(b,a))c.push("[...circular reference...]");else if(a&&b.length<goog.debug.MAX_STACK_DEPTH){c.push(goog.debug.getFunctionName(a)+"(");for(var d=a.arguments,e=0;e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=goog.debug.getFunctionName(f))?f:"[fn]";break;default:f=
typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(goog.debug.getStacktraceHelper_(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?c.push("[...long stack...]"):c.push("[end]");return c.join("")};goog.debug.setFunctionResolver=function(a){goog.debug.fnNameResolver_=a};
goog.debug.getFunctionName=function(a){if(goog.debug.fnNameCache_[a])return goog.debug.fnNameCache_[a];if(goog.debug.fnNameResolver_){var b=goog.debug.fnNameResolver_(a);if(b)return goog.debug.fnNameCache_[a]=b}a=String(a);goog.debug.fnNameCache_[a]||(b=/function ([^\(]+)/.exec(a),goog.debug.fnNameCache_[a]=b?b[1]:"[Anonymous]");return goog.debug.fnNameCache_[a]};
goog.debug.makeWhitespaceVisible=function(a){return a.replace(/ /g,"[_]").replace(/\f/g,"[f]").replace(/\n/g,"[n]\n").replace(/\r/g,"[r]").replace(/\t/g,"[t]")};goog.debug.fnNameCache_={};goog.debug.LogRecord=function(a,b,c,d,e){this.reset(a,b,c,d,e)};goog.debug.LogRecord.prototype.sequenceNumber_=0;goog.debug.LogRecord.prototype.exception_=null;goog.debug.LogRecord.prototype.exceptionText_=null;goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS=!0;goog.debug.LogRecord.nextSequenceNumber_=0;
goog.debug.LogRecord.prototype.reset=function(a,b,c,d,e){goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS&&(this.sequenceNumber_="number"==typeof e?e:goog.debug.LogRecord.nextSequenceNumber_++);this.time_=d||goog.now();this.level_=a;this.msg_=b;this.loggerName_=c;delete this.exception_;delete this.exceptionText_};goog.debug.LogRecord.prototype.getLoggerName=function(){return this.loggerName_};goog.debug.LogRecord.prototype.getException=function(){return this.exception_};
goog.debug.LogRecord.prototype.setException=function(a){this.exception_=a};goog.debug.LogRecord.prototype.getExceptionText=function(){return this.exceptionText_};goog.debug.LogRecord.prototype.setExceptionText=function(a){this.exceptionText_=a};goog.debug.LogRecord.prototype.setLoggerName=function(a){this.loggerName_=a};goog.debug.LogRecord.prototype.getLevel=function(){return this.level_};goog.debug.LogRecord.prototype.setLevel=function(a){this.level_=a};
goog.debug.LogRecord.prototype.getMessage=function(){return this.msg_};goog.debug.LogRecord.prototype.setMessage=function(a){this.msg_=a};goog.debug.LogRecord.prototype.getMillis=function(){return this.time_};goog.debug.LogRecord.prototype.setMillis=function(a){this.time_=a};goog.debug.LogRecord.prototype.getSequenceNumber=function(){return this.sequenceNumber_};goog.debug.LogBuffer=function(){goog.asserts.assert(goog.debug.LogBuffer.isBufferingEnabled(),"Cannot use goog.debug.LogBuffer without defining goog.debug.LogBuffer.CAPACITY.");this.clear()};goog.debug.LogBuffer.getInstance=function(){goog.debug.LogBuffer.instance_||(goog.debug.LogBuffer.instance_=new goog.debug.LogBuffer);return goog.debug.LogBuffer.instance_};goog.debug.LogBuffer.CAPACITY=0;
goog.debug.LogBuffer.prototype.addRecord=function(a,b,c){var d=(this.curIndex_+1)%goog.debug.LogBuffer.CAPACITY;this.curIndex_=d;if(this.isFull_)return d=this.buffer_[d],d.reset(a,b,c),d;this.isFull_=d==goog.debug.LogBuffer.CAPACITY-1;return this.buffer_[d]=new goog.debug.LogRecord(a,b,c)};goog.debug.LogBuffer.isBufferingEnabled=function(){return 0<goog.debug.LogBuffer.CAPACITY};
goog.debug.LogBuffer.prototype.clear=function(){this.buffer_=Array(goog.debug.LogBuffer.CAPACITY);this.curIndex_=-1;this.isFull_=!1};goog.debug.LogBuffer.prototype.forEachRecord=function(a){var b=this.buffer_;if(b[0]){var c=this.curIndex_,d=this.isFull_?c:-1;do d=(d+1)%goog.debug.LogBuffer.CAPACITY,a(b[d]);while(d!=c)}};goog.debug.Logger=function(a){this.name_=a};goog.debug.Logger.prototype.parent_=null;goog.debug.Logger.prototype.level_=null;goog.debug.Logger.prototype.children_=null;goog.debug.Logger.prototype.handlers_=null;goog.debug.Logger.ENABLE_HIERARCHY=!0;goog.debug.Logger.ENABLE_HIERARCHY||(goog.debug.Logger.rootHandlers_=[]);goog.debug.Logger.Level=function(a,b){this.name=a;this.value=b};goog.debug.Logger.Level.prototype.toString=function(){return this.name};
goog.debug.Logger.Level.OFF=new goog.debug.Logger.Level("OFF",Infinity);goog.debug.Logger.Level.SHOUT=new goog.debug.Logger.Level("SHOUT",1200);goog.debug.Logger.Level.SEVERE=new goog.debug.Logger.Level("SEVERE",1E3);goog.debug.Logger.Level.WARNING=new goog.debug.Logger.Level("WARNING",900);goog.debug.Logger.Level.INFO=new goog.debug.Logger.Level("INFO",800);goog.debug.Logger.Level.CONFIG=new goog.debug.Logger.Level("CONFIG",700);goog.debug.Logger.Level.FINE=new goog.debug.Logger.Level("FINE",500);
goog.debug.Logger.Level.FINER=new goog.debug.Logger.Level("FINER",400);goog.debug.Logger.Level.FINEST=new goog.debug.Logger.Level("FINEST",300);goog.debug.Logger.Level.ALL=new goog.debug.Logger.Level("ALL",0);
goog.debug.Logger.Level.PREDEFINED_LEVELS=[goog.debug.Logger.Level.OFF,goog.debug.Logger.Level.SHOUT,goog.debug.Logger.Level.SEVERE,goog.debug.Logger.Level.WARNING,goog.debug.Logger.Level.INFO,goog.debug.Logger.Level.CONFIG,goog.debug.Logger.Level.FINE,goog.debug.Logger.Level.FINER,goog.debug.Logger.Level.FINEST,goog.debug.Logger.Level.ALL];goog.debug.Logger.Level.predefinedLevelsCache_=null;
goog.debug.Logger.Level.createPredefinedLevelsCache_=function(){goog.debug.Logger.Level.predefinedLevelsCache_={};for(var a=0,b;b=goog.debug.Logger.Level.PREDEFINED_LEVELS[a];a++)goog.debug.Logger.Level.predefinedLevelsCache_[b.value]=b,goog.debug.Logger.Level.predefinedLevelsCache_[b.name]=b};
goog.debug.Logger.Level.getPredefinedLevel=function(a){goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_();return goog.debug.Logger.Level.predefinedLevelsCache_[a]||null};
goog.debug.Logger.Level.getPredefinedLevelByValue=function(a){goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_();if(a in goog.debug.Logger.Level.predefinedLevelsCache_)return goog.debug.Logger.Level.predefinedLevelsCache_[a];for(var b=0;b<goog.debug.Logger.Level.PREDEFINED_LEVELS.length;++b){var c=goog.debug.Logger.Level.PREDEFINED_LEVELS[b];if(c.value<=a)return c}return null};goog.debug.Logger.getLogger=function(a){return goog.debug.LogManager.getLogger(a)};
goog.debug.Logger.logToProfilers=function(a){goog.global.console&&(goog.global.console.timeStamp?goog.global.console.timeStamp(a):goog.global.console.markTimeline&&goog.global.console.markTimeline(a));goog.global.msWriteProfilerMark&&goog.global.msWriteProfilerMark(a)};goog.debug.Logger.prototype.getName=function(){return this.name_};
goog.debug.Logger.prototype.addHandler=function(a){goog.debug.LOGGING_ENABLED&&(goog.debug.Logger.ENABLE_HIERARCHY?(this.handlers_||(this.handlers_=[]),this.handlers_.push(a)):(goog.asserts.assert(!this.name_,"Cannot call addHandler on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootHandlers_.push(a)))};
goog.debug.Logger.prototype.removeHandler=function(a){if(goog.debug.LOGGING_ENABLED){var b=goog.debug.Logger.ENABLE_HIERARCHY?this.handlers_:goog.debug.Logger.rootHandlers_;return!!b&&goog.array.remove(b,a)}return!1};goog.debug.Logger.prototype.getParent=function(){return this.parent_};goog.debug.Logger.prototype.getChildren=function(){this.children_||(this.children_={});return this.children_};
goog.debug.Logger.prototype.setLevel=function(a){goog.debug.LOGGING_ENABLED&&(goog.debug.Logger.ENABLE_HIERARCHY?this.level_=a:(goog.asserts.assert(!this.name_,"Cannot call setLevel() on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootLevel_=a))};goog.debug.Logger.prototype.getLevel=function(){return goog.debug.LOGGING_ENABLED?this.level_:goog.debug.Logger.Level.OFF};
goog.debug.Logger.prototype.getEffectiveLevel=function(){if(!goog.debug.LOGGING_ENABLED)return goog.debug.Logger.Level.OFF;if(!goog.debug.Logger.ENABLE_HIERARCHY)return goog.debug.Logger.rootLevel_;if(this.level_)return this.level_;if(this.parent_)return this.parent_.getEffectiveLevel();goog.asserts.fail("Root logger has no level set.");return null};goog.debug.Logger.prototype.isLoggable=function(a){return goog.debug.LOGGING_ENABLED&&a.value>=this.getEffectiveLevel().value};
goog.debug.Logger.prototype.log=function(a,b,c){goog.debug.LOGGING_ENABLED&&this.isLoggable(a)&&(goog.isFunction(b)&&(b=b()),this.doLogRecord_(this.getLogRecord(a,b,c)))};goog.debug.Logger.prototype.getLogRecord=function(a,b,c){var d=goog.debug.LogBuffer.isBufferingEnabled()?goog.debug.LogBuffer.getInstance().addRecord(a,b,this.name_):new goog.debug.LogRecord(a,String(b),this.name_);c&&(d.setException(c),d.setExceptionText(goog.debug.exposeException(c,arguments.callee.caller)));return d};
goog.debug.Logger.prototype.shout=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.SHOUT,a,b)};goog.debug.Logger.prototype.severe=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.SEVERE,a,b)};goog.debug.Logger.prototype.warning=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.WARNING,a,b)};goog.debug.Logger.prototype.info=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.INFO,a,b)};
goog.debug.Logger.prototype.config=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.CONFIG,a,b)};goog.debug.Logger.prototype.fine=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINE,a,b)};goog.debug.Logger.prototype.finer=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINER,a,b)};goog.debug.Logger.prototype.finest=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINEST,a,b)};
goog.debug.Logger.prototype.logRecord=function(a){goog.debug.LOGGING_ENABLED&&this.isLoggable(a.getLevel())&&this.doLogRecord_(a)};goog.debug.Logger.prototype.doLogRecord_=function(a){goog.debug.Logger.logToProfilers("log:"+a.getMessage());if(goog.debug.Logger.ENABLE_HIERARCHY)for(var b=this;b;)b.callPublish_(a),b=b.getParent();else for(var b=0,c;c=goog.debug.Logger.rootHandlers_[b++];)c(a)};goog.debug.Logger.prototype.callPublish_=function(a){if(this.handlers_)for(var b=0,c;c=this.handlers_[b];b++)c(a)};
goog.debug.Logger.prototype.setParent_=function(a){this.parent_=a};goog.debug.Logger.prototype.addChild_=function(a,b){this.getChildren()[a]=b};goog.debug.LogManager={};goog.debug.LogManager.loggers_={};goog.debug.LogManager.rootLogger_=null;goog.debug.LogManager.initialize=function(){goog.debug.LogManager.rootLogger_||(goog.debug.LogManager.rootLogger_=new goog.debug.Logger(""),goog.debug.LogManager.loggers_[""]=goog.debug.LogManager.rootLogger_,goog.debug.LogManager.rootLogger_.setLevel(goog.debug.Logger.Level.CONFIG))};
goog.debug.LogManager.getLoggers=function(){return goog.debug.LogManager.loggers_};goog.debug.LogManager.getRoot=function(){goog.debug.LogManager.initialize();return goog.debug.LogManager.rootLogger_};goog.debug.LogManager.getLogger=function(a){goog.debug.LogManager.initialize();return goog.debug.LogManager.loggers_[a]||goog.debug.LogManager.createLogger_(a)};
goog.debug.LogManager.createFunctionForCatchErrors=function(a){return function(b){(a||goog.debug.LogManager.getRoot()).severe("Error: "+b.message+" ("+b.fileName+" @ Line: "+b.line+")")}};goog.debug.LogManager.createLogger_=function(a){var b=new goog.debug.Logger(a);if(goog.debug.Logger.ENABLE_HIERARCHY){var c=a.lastIndexOf("."),d=a.substr(0,c),c=a.substr(c+1),d=goog.debug.LogManager.getLogger(d);d.addChild_(c,b);b.setParent_(d)}return goog.debug.LogManager.loggers_[a]=b};goog.events.EventHandler=function(a){goog.Disposable.call(this);this.handler_=a;this.keys_={}};goog.inherits(goog.events.EventHandler,goog.Disposable);goog.events.EventHandler.typeArray_=[];goog.events.EventHandler.prototype.listen=function(a,b,c,d){return this.listen_(a,b,c,d)};goog.events.EventHandler.prototype.listenWithScope=function(a,b,c,d,e){return this.listen_(a,b,c,d,e)};
goog.events.EventHandler.prototype.listen_=function(a,b,c,d,e){goog.isArray(b)||(goog.events.EventHandler.typeArray_[0]=b,b=goog.events.EventHandler.typeArray_);for(var f=0;f<b.length;f++){var g=goog.events.listen(a,b[f],c||this.handleEvent,d||!1,e||this.handler_||this);if(!g)break;this.keys_[g.key]=g}return this};goog.events.EventHandler.prototype.listenOnce=function(a,b,c,d){return this.listenOnce_(a,b,c,d)};
goog.events.EventHandler.prototype.listenOnceWithScope=function(a,b,c,d,e){return this.listenOnce_(a,b,c,d,e)};goog.events.EventHandler.prototype.listenOnce_=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.listenOnce_(a,b[f],c,d,e);else{a=goog.events.listenOnce(a,b,c||this.handleEvent,d,e||this.handler_||this);if(!a)return this;this.keys_[a.key]=a}return this};goog.events.EventHandler.prototype.listenWithWrapper=function(a,b,c,d){return this.listenWithWrapper_(a,b,c,d)};
goog.events.EventHandler.prototype.listenWithWrapperAndScope=function(a,b,c,d,e){return this.listenWithWrapper_(a,b,c,d,e)};goog.events.EventHandler.prototype.listenWithWrapper_=function(a,b,c,d,e){b.listen(a,c,d,e||this.handler_||this,this);return this};goog.events.EventHandler.prototype.getListenerCount=function(){var a=0,b;for(b in this.keys_)Object.prototype.hasOwnProperty.call(this.keys_,b)&&a++;return a};
goog.events.EventHandler.prototype.unlisten=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.unlisten(a,b[f],c,d,e);else if(a=goog.events.getListener(a,b,c||this.handleEvent,d,e||this.handler_||this))goog.events.unlistenByKey(a),delete this.keys_[a.key];return this};goog.events.EventHandler.prototype.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e||this.handler_||this,this);return this};
goog.events.EventHandler.prototype.removeAll=function(){goog.object.forEach(this.keys_,goog.events.unlistenByKey);this.keys_={}};goog.events.EventHandler.prototype.disposeInternal=function(){goog.events.EventHandler.superClass_.disposeInternal.call(this);this.removeAll()};goog.events.EventHandler.prototype.handleEvent=function(a){throw Error("EventHandler.handleEvent not implemented");};goog.net={};goog.net.EventType={COMPLETE:"complete",SUCCESS:"success",ERROR:"error",ABORT:"abort",READY:"ready",READY_STATE_CHANGE:"readystatechange",TIMEOUT:"timeout",INCREMENTAL_DATA:"incrementaldata",PROGRESS:"progress"};goog.Timer=function(a,b){goog.events.EventTarget.call(this);this.interval_=a||1;this.timerObject_=b||goog.Timer.defaultTimerObject;this.boundTick_=goog.bind(this.tick_,this);this.last_=goog.now()};goog.inherits(goog.Timer,goog.events.EventTarget);goog.Timer.MAX_TIMEOUT_=2147483647;goog.Timer.prototype.enabled=!1;goog.Timer.defaultTimerObject=goog.global;goog.Timer.intervalScale=0.8;goog.Timer.prototype.timer_=null;goog.Timer.prototype.getInterval=function(){return this.interval_};
goog.Timer.prototype.setInterval=function(a){this.interval_=a;this.timer_&&this.enabled?(this.stop(),this.start()):this.timer_&&this.stop()};
goog.Timer.prototype.tick_=function(){if(this.enabled){var a=goog.now()-this.last_;0<a&&a<this.interval_*goog.Timer.intervalScale?this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-a):(this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null),this.dispatchTick(),this.enabled&&(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now()))}};goog.Timer.prototype.dispatchTick=function(){this.dispatchEvent(goog.Timer.TICK)};
goog.Timer.prototype.start=function(){this.enabled=!0;this.timer_||(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=goog.now())};goog.Timer.prototype.stop=function(){this.enabled=!1;this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null)};goog.Timer.prototype.disposeInternal=function(){goog.Timer.superClass_.disposeInternal.call(this);this.stop();delete this.timerObject_};goog.Timer.TICK="tick";
goog.Timer.callOnce=function(a,b,c){if(goog.isFunction(a))c&&(a=goog.bind(a,c));else if(a&&"function"==typeof a.handleEvent)a=goog.bind(a.handleEvent,a);else throw Error("Invalid listener argument");return b>goog.Timer.MAX_TIMEOUT_?-1:goog.Timer.defaultTimerObject.setTimeout(a,b||0)};goog.Timer.clear=function(a){goog.Timer.defaultTimerObject.clearTimeout(a)};goog.json={};goog.json.isValid_=function(a){return/^\s*$/.test(a)?!1:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,""))};goog.json.parse=function(a){a=String(a);if(goog.json.isValid_(a))try{return JSON.parse(a)}catch(b){}throw Error("Invalid JSON string: "+a);};goog.json.unsafeParse=function(a){return eval("("+a+")")};
goog.json.serialize=function(a,b){return(new goog.json.Serializer(b)).serialize(a)};goog.json.Serializer=function(a){this.replacer_=a};goog.json.Serializer.prototype.serialize=function(a){var b=[];this.serialize_(a,b);return b.join("")};
goog.json.Serializer.prototype.serialize_=function(a,b){switch(typeof a){case "string":this.serializeString_(a,b);break;case "number":this.serializeNumber_(a,b);break;case "boolean":b.push(a);break;case "undefined":b.push("null");break;case "object":if(null==a){b.push("null");break}if(goog.isArray(a)){this.serializeArray(a,b);break}this.serializeObject_(a,b);break;case "function":break;default:throw Error("Unknown type: "+typeof a);}};
goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"};goog.json.Serializer.charsToReplace_=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;
goog.json.Serializer.prototype.serializeString_=function(a,b){b.push('"',a.replace(goog.json.Serializer.charsToReplace_,function(a){if(a in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[a];var b=a.charCodeAt(0),e="\\u";16>b?e+="000":256>b?e+="00":4096>b&&(e+="0");return goog.json.Serializer.charToJsonCharCache_[a]=e+b.toString(16)}),'"')};goog.json.Serializer.prototype.serializeNumber_=function(a,b){b.push(isFinite(a)&&!isNaN(a)?a:"null")};
goog.json.Serializer.prototype.serializeArray=function(a,b){var c=a.length;b.push("[");for(var d="",e=0;e<c;e++)b.push(d),d=a[e],this.serialize_(this.replacer_?this.replacer_.call(a,String(e),d):d,b),d=",";b.push("]")};
goog.json.Serializer.prototype.serializeObject_=function(a,b){b.push("{");var c="",d;for(d in a)if(Object.prototype.hasOwnProperty.call(a,d)){var e=a[d];"function"!=typeof e&&(b.push(c),this.serializeString_(d,b),b.push(":"),this.serialize_(this.replacer_?this.replacer_.call(a,d,e):e,b),c=",")}b.push("}")};goog.log={};goog.log.ENABLED=goog.debug.LOGGING_ENABLED;goog.log.Logger=goog.debug.Logger;goog.log.Level=goog.debug.Logger.Level;goog.log.LogRecord=goog.debug.LogRecord;goog.log.getLogger=function(a,b){if(goog.log.ENABLED){var c=goog.debug.Logger.getLogger(a);b&&c&&c.setLevel(b);return c}return null};goog.log.addHandler=function(a,b){goog.log.ENABLED&&a&&a.addHandler(b)};goog.log.removeHandler=function(a,b){return goog.log.ENABLED&&a?a.removeHandler(b):!1};
goog.log.log=function(a,b,c,d){goog.log.ENABLED&&a&&a.log(b,c,d)};goog.log.error=function(a,b,c){goog.log.ENABLED&&a&&a.severe(b,c)};goog.log.warning=function(a,b,c){goog.log.ENABLED&&a&&a.warning(b,c)};goog.log.info=function(a,b,c){goog.log.ENABLED&&a&&a.info(b,c)};goog.log.fine=function(a,b,c){goog.log.ENABLED&&a&&a.fine(b,c)};goog.net.ErrorCode={NO_ERROR:0,ACCESS_DENIED:1,FILE_NOT_FOUND:2,FF_SILENT_ERROR:3,CUSTOM_ERROR:4,EXCEPTION:5,HTTP_ERROR:6,ABORT:7,TIMEOUT:8,OFFLINE:9};
goog.net.ErrorCode.getDebugMessage=function(a){switch(a){case goog.net.ErrorCode.NO_ERROR:return"No Error";case goog.net.ErrorCode.ACCESS_DENIED:return"Access denied to content document";case goog.net.ErrorCode.FILE_NOT_FOUND:return"File not found";case goog.net.ErrorCode.FF_SILENT_ERROR:return"Firefox silently errored";case goog.net.ErrorCode.CUSTOM_ERROR:return"Application custom error";case goog.net.ErrorCode.EXCEPTION:return"An exception occurred";case goog.net.ErrorCode.HTTP_ERROR:return"Http response at 400 or 500 level";
case goog.net.ErrorCode.ABORT:return"Request was aborted";case goog.net.ErrorCode.TIMEOUT:return"Request timed out";case goog.net.ErrorCode.OFFLINE:return"The resource is not available offline";default:return"Unrecognized error code"}};goog.net.HttpStatus={CONTINUE:100,SWITCHING_PROTOCOLS:101,OK:200,CREATED:201,ACCEPTED:202,NON_AUTHORITATIVE_INFORMATION:203,NO_CONTENT:204,RESET_CONTENT:205,PARTIAL_CONTENT:206,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,USE_PROXY:305,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,
PRECONDITION_FAILED:412,REQUEST_ENTITY_TOO_LARGE:413,REQUEST_URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,REQUEST_RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,QUIRK_IE_NO_CONTENT:1223};
goog.net.HttpStatus.isSuccess=function(a){switch(a){case goog.net.HttpStatus.OK:case goog.net.HttpStatus.CREATED:case goog.net.HttpStatus.ACCEPTED:case goog.net.HttpStatus.NO_CONTENT:case goog.net.HttpStatus.PARTIAL_CONTENT:case goog.net.HttpStatus.NOT_MODIFIED:case goog.net.HttpStatus.QUIRK_IE_NO_CONTENT:return!0;default:return!1}};goog.net.XhrLike=function(){};goog.net.XhrLike.prototype.open=function(a,b,c,d,e){};goog.net.XhrLike.prototype.send=function(a){};goog.net.XhrLike.prototype.abort=function(){};goog.net.XhrLike.prototype.setRequestHeader=function(a,b){};goog.net.XhrLike.prototype.getResponseHeader=function(a){};goog.net.XhrLike.prototype.getAllResponseHeaders=function(){};goog.net.XmlHttpFactory=function(){};goog.net.XmlHttpFactory.prototype.cachedOptions_=null;goog.net.XmlHttpFactory.prototype.getOptions=function(){return this.cachedOptions_||(this.cachedOptions_=this.internalGetOptions())};goog.net.WrapperXmlHttpFactory=function(a,b){goog.net.XmlHttpFactory.call(this);this.xhrFactory_=a;this.optionsFactory_=b};goog.inherits(goog.net.WrapperXmlHttpFactory,goog.net.XmlHttpFactory);goog.net.WrapperXmlHttpFactory.prototype.createInstance=function(){return this.xhrFactory_()};goog.net.WrapperXmlHttpFactory.prototype.getOptions=function(){return this.optionsFactory_()};goog.net.XmlHttp=function(){return goog.net.XmlHttp.factory_.createInstance()};goog.net.XmlHttp.ASSUME_NATIVE_XHR=!1;goog.net.XmlHttp.getOptions=function(){return goog.net.XmlHttp.factory_.getOptions()};goog.net.XmlHttp.OptionType={USE_NULL_FUNCTION:0,LOCAL_REQUEST_ERROR:1};goog.net.XmlHttp.ReadyState={UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETE:4};goog.net.XmlHttp.setFactory=function(a,b){goog.net.XmlHttp.setGlobalFactory(new goog.net.WrapperXmlHttpFactory(goog.asserts.assert(a),goog.asserts.assert(b)))};
goog.net.XmlHttp.setGlobalFactory=function(a){goog.net.XmlHttp.factory_=a};goog.net.DefaultXmlHttpFactory=function(){goog.net.XmlHttpFactory.call(this)};goog.inherits(goog.net.DefaultXmlHttpFactory,goog.net.XmlHttpFactory);goog.net.DefaultXmlHttpFactory.prototype.createInstance=function(){var a=this.getProgId_();return a?new ActiveXObject(a):new XMLHttpRequest};
goog.net.DefaultXmlHttpFactory.prototype.internalGetOptions=function(){var a={};this.getProgId_()&&(a[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION]=!0,a[goog.net.XmlHttp.OptionType.LOCAL_REQUEST_ERROR]=!0);return a};
goog.net.DefaultXmlHttpFactory.prototype.getProgId_=function(){if(goog.net.XmlHttp.ASSUME_NATIVE_XHR)return"";if(!this.ieProgId_&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var a=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],b=0;b<a.length;b++){var c=a[b];try{return new ActiveXObject(c),this.ieProgId_=c}catch(d){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return this.ieProgId_};
goog.net.XmlHttp.setGlobalFactory(new goog.net.DefaultXmlHttpFactory);goog.net.XhrIo=function(a){goog.events.EventTarget.call(this);this.headers=new goog.structs.Map;this.xmlHttpFactory_=a||null;this.active_=!1;this.xhrOptions_=this.xhr_=null;this.lastMethod_=this.lastUri_="";this.lastErrorCode_=goog.net.ErrorCode.NO_ERROR;this.lastError_="";this.inAbort_=this.inOpen_=this.inSend_=this.errorDispatched_=!1;this.timeoutInterval_=0;this.timeoutId_=null;this.responseType_=goog.net.XhrIo.ResponseType.DEFAULT;this.useXhr2Timeout_=this.withCredentials_=!1};
goog.inherits(goog.net.XhrIo,goog.events.EventTarget);goog.net.XhrIo.ResponseType={DEFAULT:"",TEXT:"text",DOCUMENT:"document",BLOB:"blob",ARRAY_BUFFER:"arraybuffer"};goog.net.XhrIo.prototype.logger_=goog.log.getLogger("goog.net.XhrIo");goog.net.XhrIo.CONTENT_TYPE_HEADER="Content-Type";goog.net.XhrIo.HTTP_SCHEME_PATTERN=/^https?$/i;goog.net.XhrIo.METHODS_WITH_FORM_DATA=["POST","PUT"];goog.net.XhrIo.FORM_CONTENT_TYPE="application/x-www-form-urlencoded;charset=utf-8";goog.net.XhrIo.XHR2_TIMEOUT_="timeout";
goog.net.XhrIo.XHR2_ON_TIMEOUT_="ontimeout";goog.net.XhrIo.sendInstances_=[];goog.net.XhrIo.send=function(a,b,c,d,e,f,g){var h=new goog.net.XhrIo;goog.net.XhrIo.sendInstances_.push(h);b&&h.listen(goog.net.EventType.COMPLETE,b);h.listenOnce(goog.net.EventType.READY,h.cleanupSend_);f&&h.setTimeoutInterval(f);g&&h.setWithCredentials(g);h.send(a,c,d,e)};goog.net.XhrIo.cleanup=function(){for(var a=goog.net.XhrIo.sendInstances_;a.length;)a.pop().dispose()};
goog.net.XhrIo.protectEntryPoints=function(a){goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_=a.protectEntryPoint(goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_)};goog.net.XhrIo.prototype.cleanupSend_=function(){this.dispose();goog.array.remove(goog.net.XhrIo.sendInstances_,this)};goog.net.XhrIo.prototype.getTimeoutInterval=function(){return this.timeoutInterval_};goog.net.XhrIo.prototype.setTimeoutInterval=function(a){this.timeoutInterval_=Math.max(0,a)};
goog.net.XhrIo.prototype.setResponseType=function(a){this.responseType_=a};goog.net.XhrIo.prototype.getResponseType=function(){return this.responseType_};goog.net.XhrIo.prototype.setWithCredentials=function(a){this.withCredentials_=a};goog.net.XhrIo.prototype.getWithCredentials=function(){return this.withCredentials_};
goog.net.XhrIo.prototype.send=function(a,b,c,d){if(this.xhr_)throw Error("[goog.net.XhrIo] Object is active with another request="+this.lastUri_+"; newUri="+a);b=b?b.toUpperCase():"GET";this.lastUri_=a;this.lastError_="";this.lastErrorCode_=goog.net.ErrorCode.NO_ERROR;this.lastMethod_=b;this.errorDispatched_=!1;this.active_=!0;this.xhr_=this.createXhr();this.xhrOptions_=this.xmlHttpFactory_?this.xmlHttpFactory_.getOptions():goog.net.XmlHttp.getOptions();this.xhr_.onreadystatechange=goog.bind(this.onReadyStateChange_,
this);try{goog.log.fine(this.logger_,this.formatMsg_("Opening Xhr")),this.inOpen_=!0,this.xhr_.open(b,a,!0),this.inOpen_=!1}catch(e){goog.log.fine(this.logger_,this.formatMsg_("Error opening Xhr: "+e.message));this.error_(goog.net.ErrorCode.EXCEPTION,e);return}a=c||"";var f=this.headers.clone();d&&goog.structs.forEach(d,function(a,b){f.set(b,a)});d=goog.array.find(f.getKeys(),goog.net.XhrIo.isContentTypeHeader_);c=goog.global.FormData&&a instanceof goog.global.FormData;!goog.array.contains(goog.net.XhrIo.METHODS_WITH_FORM_DATA,
b)||d||c||f.set(goog.net.XhrIo.CONTENT_TYPE_HEADER,goog.net.XhrIo.FORM_CONTENT_TYPE);goog.structs.forEach(f,function(a,b){this.xhr_.setRequestHeader(b,a)},this);this.responseType_&&(this.xhr_.responseType=this.responseType_);goog.object.containsKey(this.xhr_,"withCredentials")&&(this.xhr_.withCredentials=this.withCredentials_);try{this.cleanUpTimeoutTimer_(),0<this.timeoutInterval_&&(this.useXhr2Timeout_=goog.net.XhrIo.shouldUseXhr2Timeout_(this.xhr_),goog.log.fine(this.logger_,this.formatMsg_("Will abort after "+
this.timeoutInterval_+"ms if incomplete, xhr2 "+this.useXhr2Timeout_)),this.useXhr2Timeout_?(this.xhr_[goog.net.XhrIo.XHR2_TIMEOUT_]=this.timeoutInterval_,this.xhr_[goog.net.XhrIo.XHR2_ON_TIMEOUT_]=goog.bind(this.timeout_,this)):this.timeoutId_=goog.Timer.callOnce(this.timeout_,this.timeoutInterval_,this)),goog.log.fine(this.logger_,this.formatMsg_("Sending request")),this.inSend_=!0,this.xhr_.send(a),this.inSend_=!1}catch(g){goog.log.fine(this.logger_,this.formatMsg_("Send error: "+g.message)),this.error_(goog.net.ErrorCode.EXCEPTION,
g)}};goog.net.XhrIo.shouldUseXhr2Timeout_=function(a){return goog.userAgent.IE&&goog.userAgent.isVersionOrHigher(9)&&goog.isNumber(a[goog.net.XhrIo.XHR2_TIMEOUT_])&&goog.isDef(a[goog.net.XhrIo.XHR2_ON_TIMEOUT_])};goog.net.XhrIo.isContentTypeHeader_=function(a){return goog.string.caseInsensitiveEquals(goog.net.XhrIo.CONTENT_TYPE_HEADER,a)};goog.net.XhrIo.prototype.createXhr=function(){return this.xmlHttpFactory_?this.xmlHttpFactory_.createInstance():goog.net.XmlHttp()};
goog.net.XhrIo.prototype.timeout_=function(){"undefined"!=typeof goog&&this.xhr_&&(this.lastError_="Timed out after "+this.timeoutInterval_+"ms, aborting",this.lastErrorCode_=goog.net.ErrorCode.TIMEOUT,goog.log.fine(this.logger_,this.formatMsg_(this.lastError_)),this.dispatchEvent(goog.net.EventType.TIMEOUT),this.abort(goog.net.ErrorCode.TIMEOUT))};
goog.net.XhrIo.prototype.error_=function(a,b){this.active_=!1;this.xhr_&&(this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1);this.lastError_=b;this.lastErrorCode_=a;this.dispatchErrors_();this.cleanUpXhr_()};goog.net.XhrIo.prototype.dispatchErrors_=function(){this.errorDispatched_||(this.errorDispatched_=!0,this.dispatchEvent(goog.net.EventType.COMPLETE),this.dispatchEvent(goog.net.EventType.ERROR))};
goog.net.XhrIo.prototype.abort=function(a){this.xhr_&&this.active_&&(goog.log.fine(this.logger_,this.formatMsg_("Aborting")),this.active_=!1,this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1,this.lastErrorCode_=a||goog.net.ErrorCode.ABORT,this.dispatchEvent(goog.net.EventType.COMPLETE),this.dispatchEvent(goog.net.EventType.ABORT),this.cleanUpXhr_())};
goog.net.XhrIo.prototype.disposeInternal=function(){this.xhr_&&(this.active_&&(this.active_=!1,this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1),this.cleanUpXhr_(!0));goog.net.XhrIo.superClass_.disposeInternal.call(this)};goog.net.XhrIo.prototype.onReadyStateChange_=function(){if(!this.isDisposed())if(this.inOpen_||this.inSend_||this.inAbort_)this.onReadyStateChangeHelper_();else this.onReadyStateChangeEntryPoint_()};goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_=function(){this.onReadyStateChangeHelper_()};
goog.net.XhrIo.prototype.onReadyStateChangeHelper_=function(){if(this.active_&&"undefined"!=typeof goog)if(this.xhrOptions_[goog.net.XmlHttp.OptionType.LOCAL_REQUEST_ERROR]&&this.getReadyState()==goog.net.XmlHttp.ReadyState.COMPLETE&&2==this.getStatus())goog.log.fine(this.logger_,this.formatMsg_("Local request error detected and ignored"));else if(this.inSend_&&this.getReadyState()==goog.net.XmlHttp.ReadyState.COMPLETE)goog.Timer.callOnce(this.onReadyStateChange_,0,this);else if(this.dispatchEvent(goog.net.EventType.READY_STATE_CHANGE),
this.isComplete()){goog.log.fine(this.logger_,this.formatMsg_("Request complete"));this.active_=!1;try{this.isSuccess()?(this.dispatchEvent(goog.net.EventType.COMPLETE),this.dispatchEvent(goog.net.EventType.SUCCESS)):(this.lastErrorCode_=goog.net.ErrorCode.HTTP_ERROR,this.lastError_=this.getStatusText()+" ["+this.getStatus()+"]",this.dispatchErrors_())}finally{this.cleanUpXhr_()}}};
goog.net.XhrIo.prototype.cleanUpXhr_=function(a){if(this.xhr_){this.cleanUpTimeoutTimer_();var b=this.xhr_,c=this.xhrOptions_[goog.net.XmlHttp.OptionType.USE_NULL_FUNCTION]?goog.nullFunction:null;this.xhrOptions_=this.xhr_=null;a||this.dispatchEvent(goog.net.EventType.READY);try{b.onreadystatechange=c}catch(d){goog.log.error(this.logger_,"Problem encountered resetting onreadystatechange: "+d.message)}}};
goog.net.XhrIo.prototype.cleanUpTimeoutTimer_=function(){this.xhr_&&this.useXhr2Timeout_&&(this.xhr_[goog.net.XhrIo.XHR2_ON_TIMEOUT_]=null);goog.isNumber(this.timeoutId_)&&(goog.Timer.clear(this.timeoutId_),this.timeoutId_=null)};goog.net.XhrIo.prototype.isActive=function(){return!!this.xhr_};goog.net.XhrIo.prototype.isComplete=function(){return this.getReadyState()==goog.net.XmlHttp.ReadyState.COMPLETE};
goog.net.XhrIo.prototype.isSuccess=function(){var a=this.getStatus();return goog.net.HttpStatus.isSuccess(a)||0===a&&!this.isLastUriEffectiveSchemeHttp_()};goog.net.XhrIo.prototype.isLastUriEffectiveSchemeHttp_=function(){var a=goog.uri.utils.getEffectiveScheme(String(this.lastUri_));return goog.net.XhrIo.HTTP_SCHEME_PATTERN.test(a)};goog.net.XhrIo.prototype.getReadyState=function(){return this.xhr_?this.xhr_.readyState:goog.net.XmlHttp.ReadyState.UNINITIALIZED};
goog.net.XhrIo.prototype.getStatus=function(){try{return this.getReadyState()>goog.net.XmlHttp.ReadyState.LOADED?this.xhr_.status:-1}catch(a){return goog.log.warning(this.logger_,"Can not get status: "+a.message),-1}};goog.net.XhrIo.prototype.getStatusText=function(){try{return this.getReadyState()>goog.net.XmlHttp.ReadyState.LOADED?this.xhr_.statusText:""}catch(a){return goog.log.fine(this.logger_,"Can not get status: "+a.message),""}};goog.net.XhrIo.prototype.getLastUri=function(){return String(this.lastUri_)};
goog.net.XhrIo.prototype.getResponseText=function(){try{return this.xhr_?this.xhr_.responseText:""}catch(a){return goog.log.fine(this.logger_,"Can not get responseText: "+a.message),""}};goog.net.XhrIo.prototype.getResponseBody=function(){try{if(this.xhr_&&"responseBody"in this.xhr_)return this.xhr_.responseBody}catch(a){goog.log.fine(this.logger_,"Can not get responseBody: "+a.message)}return null};
goog.net.XhrIo.prototype.getResponseXml=function(){try{return this.xhr_?this.xhr_.responseXML:null}catch(a){return goog.log.fine(this.logger_,"Can not get responseXML: "+a.message),null}};goog.net.XhrIo.prototype.getResponseJson=function(a){if(this.xhr_){var b=this.xhr_.responseText;a&&0==b.indexOf(a)&&(b=b.substring(a.length));return goog.json.parse(b)}};
goog.net.XhrIo.prototype.getResponse=function(){try{if(!this.xhr_)return null;if("response"in this.xhr_)return this.xhr_.response;switch(this.responseType_){case goog.net.XhrIo.ResponseType.DEFAULT:case goog.net.XhrIo.ResponseType.TEXT:return this.xhr_.responseText;case goog.net.XhrIo.ResponseType.ARRAY_BUFFER:if("mozResponseArrayBuffer"in this.xhr_)return this.xhr_.mozResponseArrayBuffer}goog.log.error(this.logger_,"Response type "+this.responseType_+" is not supported on this browser");return null}catch(a){return goog.log.fine(this.logger_,
"Can not get response: "+a.message),null}};goog.net.XhrIo.prototype.getResponseHeader=function(a){return this.xhr_&&this.isComplete()?this.xhr_.getResponseHeader(a):void 0};goog.net.XhrIo.prototype.getAllResponseHeaders=function(){return this.xhr_&&this.isComplete()?this.xhr_.getAllResponseHeaders():""};
goog.net.XhrIo.prototype.getResponseHeaders=function(){for(var a={},b=this.getAllResponseHeaders().split("\r\n"),c=0;c<b.length;c++)if(!goog.string.isEmpty(b[c])){var d=goog.string.splitLimit(b[c],": ",2);a[d[0]]=a[d[0]]?a[d[0]]+(", "+d[1]):d[1]}return a};goog.net.XhrIo.prototype.getLastErrorCode=function(){return this.lastErrorCode_};goog.net.XhrIo.prototype.getLastError=function(){return goog.isString(this.lastError_)?this.lastError_:String(this.lastError_)};
goog.net.XhrIo.prototype.formatMsg_=function(a){return a+" ["+this.lastMethod_+" "+this.lastUri_+" "+this.getStatus()+"]"};goog.debug.entryPointRegistry.register(function(a){goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_=a(goog.net.XhrIo.prototype.onReadyStateChangeEntryPoint_)});goog.structs.Queue=function(){this.tail_=this.head_=0;this.elements_=[]};goog.structs.Queue.prototype.enqueue=function(a){this.elements_[this.tail_++]=a};goog.structs.Queue.prototype.dequeue=function(){if(this.head_!=this.tail_){var a=this.elements_[this.head_];delete this.elements_[this.head_];this.head_++;return a}};goog.structs.Queue.prototype.peek=function(){return this.head_==this.tail_?void 0:this.elements_[this.head_]};goog.structs.Queue.prototype.getCount=function(){return this.tail_-this.head_};
goog.structs.Queue.prototype.isEmpty=function(){return 0==this.tail_-this.head_};goog.structs.Queue.prototype.clear=function(){this.tail_=this.head_=this.elements_.length=0};goog.structs.Queue.prototype.contains=function(a){return goog.array.contains(this.elements_,a)};goog.structs.Queue.prototype.remove=function(a){a=goog.array.indexOf(this.elements_,a);if(0>a)return!1;a==this.head_?this.dequeue():(goog.array.removeAt(this.elements_,a),this.tail_--);return!0};
goog.structs.Queue.prototype.getValues=function(){return this.elements_.slice(this.head_,this.tail_)};goog.structs.Pool=function(a,b){goog.Disposable.call(this);this.minCount_=a||0;this.maxCount_=b||10;if(this.minCount_>this.maxCount_)throw Error(goog.structs.Pool.ERROR_MIN_MAX_);this.freeQueue_=new goog.structs.Queue;this.inUseSet_=new goog.structs.Set;this.delay=0;this.lastAccess=null;this.adjustForMinMax()};goog.inherits(goog.structs.Pool,goog.Disposable);goog.structs.Pool.ERROR_MIN_MAX_="[goog.structs.Pool] Min can not be greater than max";goog.structs.Pool.ERROR_DISPOSE_UNRELEASED_OBJS_="[goog.structs.Pool] Objects not released";
goog.structs.Pool.prototype.setMinimumCount=function(a){if(a>this.maxCount_)throw Error(goog.structs.Pool.ERROR_MIN_MAX_);this.minCount_=a;this.adjustForMinMax()};goog.structs.Pool.prototype.setMaximumCount=function(a){if(a<this.minCount_)throw Error(goog.structs.Pool.ERROR_MIN_MAX_);this.maxCount_=a;this.adjustForMinMax()};goog.structs.Pool.prototype.setDelay=function(a){this.delay=a};
goog.structs.Pool.prototype.getObject=function(){var a=goog.now();if(!(goog.isDefAndNotNull(this.lastAccess)&&a-this.lastAccess<this.delay)){var b=this.removeFreeObject_();b&&(this.lastAccess=a,this.inUseSet_.add(b));return b}};goog.structs.Pool.prototype.releaseObject=function(a){return this.inUseSet_.remove(a)?(this.addFreeObject(a),!0):!1};
goog.structs.Pool.prototype.removeFreeObject_=function(){for(var a;0<this.getFreeCount()&&(a=this.freeQueue_.dequeue(),!this.objectCanBeReused(a));)this.adjustForMinMax();!a&&this.getCount()<this.maxCount_&&(a=this.createObject());return a};goog.structs.Pool.prototype.addFreeObject=function(a){this.inUseSet_.remove(a);this.objectCanBeReused(a)&&this.getCount()<this.maxCount_?this.freeQueue_.enqueue(a):this.disposeObject(a)};
goog.structs.Pool.prototype.adjustForMinMax=function(){for(var a=this.freeQueue_;this.getCount()<this.minCount_;)a.enqueue(this.createObject());for(;this.getCount()>this.maxCount_&&0<this.getFreeCount();)this.disposeObject(a.dequeue())};goog.structs.Pool.prototype.createObject=function(){return{}};goog.structs.Pool.prototype.disposeObject=function(a){if("function"==typeof a.dispose)a.dispose();else for(var b in a)a[b]=null};
goog.structs.Pool.prototype.objectCanBeReused=function(a){return"function"==typeof a.canBeReused?a.canBeReused():!0};goog.structs.Pool.prototype.contains=function(a){return this.freeQueue_.contains(a)||this.inUseSet_.contains(a)};goog.structs.Pool.prototype.getCount=function(){return this.freeQueue_.getCount()+this.inUseSet_.getCount()};goog.structs.Pool.prototype.getInUseCount=function(){return this.inUseSet_.getCount()};goog.structs.Pool.prototype.getFreeCount=function(){return this.freeQueue_.getCount()};
goog.structs.Pool.prototype.isEmpty=function(){return this.freeQueue_.isEmpty()&&this.inUseSet_.isEmpty()};goog.structs.Pool.prototype.disposeInternal=function(){goog.structs.Pool.superClass_.disposeInternal.call(this);if(0<this.getInUseCount())throw Error(goog.structs.Pool.ERROR_DISPOSE_UNRELEASED_OBJS_);delete this.inUseSet_;for(var a=this.freeQueue_;!a.isEmpty();)this.disposeObject(a.dequeue());delete this.freeQueue_};goog.structs.Node=function(a,b){this.key_=a;this.value_=b};goog.structs.Node.prototype.getKey=function(){return this.key_};goog.structs.Node.prototype.getValue=function(){return this.value_};goog.structs.Node.prototype.clone=function(){return new goog.structs.Node(this.key_,this.value_)};goog.structs.Heap=function(a){this.nodes_=[];a&&this.insertAll(a)};goog.structs.Heap.prototype.insert=function(a,b){var c=new goog.structs.Node(a,b),d=this.nodes_;d.push(c);this.moveUp_(d.length-1)};
goog.structs.Heap.prototype.insertAll=function(a){var b,c;if(a instanceof goog.structs.Heap){if(b=a.getKeys(),c=a.getValues(),0>=a.getCount()){a=this.nodes_;for(var d=0;d<b.length;d++)a.push(new goog.structs.Node(b[d],c[d]));return}}else b=goog.object.getKeys(a),c=goog.object.getValues(a);for(d=0;d<b.length;d++)this.insert(b[d],c[d])};goog.structs.Heap.prototype.remove=function(){var a=this.nodes_,b=a.length,c=a[0];if(!(0>=b))return 1==b?goog.array.clear(a):(a[0]=a.pop(),this.moveDown_(0)),c.getValue()};
goog.structs.Heap.prototype.peek=function(){var a=this.nodes_;return 0==a.length?void 0:a[0].getValue()};goog.structs.Heap.prototype.peekKey=function(){return this.nodes_[0]&&this.nodes_[0].getKey()};goog.structs.Heap.prototype.moveDown_=function(a){for(var b=this.nodes_,c=b.length,d=b[a];a<c>>1;){var e=this.getLeftChildIndex_(a),f=this.getRightChildIndex_(a),e=f<c&&b[f].getKey()<b[e].getKey()?f:e;if(b[e].getKey()>d.getKey())break;b[a]=b[e];a=e}b[a]=d};
goog.structs.Heap.prototype.moveUp_=function(a){for(var b=this.nodes_,c=b[a];0<a;){var d=this.getParentIndex_(a);if(b[d].getKey()>c.getKey())b[a]=b[d],a=d;else break}b[a]=c};goog.structs.Heap.prototype.getLeftChildIndex_=function(a){return 2*a+1};goog.structs.Heap.prototype.getRightChildIndex_=function(a){return 2*a+2};goog.structs.Heap.prototype.getParentIndex_=function(a){return a-1>>1};
goog.structs.Heap.prototype.getValues=function(){for(var a=this.nodes_,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].getValue());return b};goog.structs.Heap.prototype.getKeys=function(){for(var a=this.nodes_,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].getKey());return b};goog.structs.Heap.prototype.containsValue=function(a){return goog.array.some(this.nodes_,function(b){return b.getValue()==a})};
goog.structs.Heap.prototype.containsKey=function(a){return goog.array.some(this.nodes_,function(b){return b.getKey()==a})};goog.structs.Heap.prototype.clone=function(){return new goog.structs.Heap(this)};goog.structs.Heap.prototype.getCount=function(){return this.nodes_.length};goog.structs.Heap.prototype.isEmpty=function(){return goog.array.isEmpty(this.nodes_)};goog.structs.Heap.prototype.clear=function(){goog.array.clear(this.nodes_)};goog.structs.PriorityQueue=function(){goog.structs.Heap.call(this)};goog.inherits(goog.structs.PriorityQueue,goog.structs.Heap);goog.structs.PriorityQueue.prototype.enqueue=function(a,b){this.insert(a,b)};goog.structs.PriorityQueue.prototype.dequeue=function(){return this.remove()};goog.structs.PriorityPool=function(a,b){this.delayTimeout_=void 0;this.requestQueue_=new goog.structs.PriorityQueue;goog.structs.Pool.call(this,a,b)};goog.inherits(goog.structs.PriorityPool,goog.structs.Pool);goog.structs.PriorityPool.DEFAULT_PRIORITY_=100;
goog.structs.PriorityPool.prototype.setDelay=function(a){goog.structs.PriorityPool.superClass_.setDelay.call(this,a);goog.isDefAndNotNull(this.lastAccess)&&(goog.global.clearTimeout(this.delayTimeout_),this.delayTimeout_=goog.global.setTimeout(goog.bind(this.handleQueueRequests_,this),this.delay+this.lastAccess-goog.now()),this.handleQueueRequests_())};
goog.structs.PriorityPool.prototype.getObject=function(a,b){if(!a){var c=goog.structs.PriorityPool.superClass_.getObject.call(this);c&&this.delay&&(this.delayTimeout_=goog.global.setTimeout(goog.bind(this.handleQueueRequests_,this),this.delay));return c}c=goog.isDef(b)?b:goog.structs.PriorityPool.DEFAULT_PRIORITY_;this.requestQueue_.enqueue(c,a);this.handleQueueRequests_()};
goog.structs.PriorityPool.prototype.handleQueueRequests_=function(){for(var a=this.requestQueue_;0<a.getCount();){var b=this.getObject();if(b)a.dequeue().apply(this,[b]);else break}};goog.structs.PriorityPool.prototype.addFreeObject=function(a){goog.structs.PriorityPool.superClass_.addFreeObject.call(this,a);this.handleQueueRequests_()};goog.structs.PriorityPool.prototype.adjustForMinMax=function(){goog.structs.PriorityPool.superClass_.adjustForMinMax.call(this);this.handleQueueRequests_()};
goog.structs.PriorityPool.prototype.disposeInternal=function(){goog.structs.PriorityPool.superClass_.disposeInternal.call(this);goog.global.clearTimeout(this.delayTimeout_);this.requestQueue_.clear();this.requestQueue_=null};goog.net.XhrIoPool=function(a,b,c){goog.structs.PriorityPool.call(this,b,c);this.headers_=a};goog.inherits(goog.net.XhrIoPool,goog.structs.PriorityPool);goog.net.XhrIoPool.prototype.createObject=function(){var a=new goog.net.XhrIo,b=this.headers_;b&&goog.structs.forEach(b,function(b,d){a.headers.set(d,b)});return a};goog.net.XhrIoPool.prototype.objectCanBeReused=function(a){return!a.isDisposed()&&!a.isActive()};goog.net.XhrManager=function(a,b,c,d,e){goog.events.EventTarget.call(this);this.maxRetries_=goog.isDef(a)?a:1;this.timeoutInterval_=goog.isDef(e)?Math.max(0,e):0;this.xhrPool_=new goog.net.XhrIoPool(b,c,d);this.requests_=new goog.structs.Map;this.eventHandler_=new goog.events.EventHandler(this)};goog.inherits(goog.net.XhrManager,goog.events.EventTarget);goog.net.XhrManager.ERROR_ID_IN_USE_="[goog.net.XhrManager] ID in use";
goog.net.XhrManager.XHR_EVENT_TYPES_=[goog.net.EventType.READY,goog.net.EventType.COMPLETE,goog.net.EventType.SUCCESS,goog.net.EventType.ERROR,goog.net.EventType.ABORT,goog.net.EventType.TIMEOUT];goog.net.XhrManager.prototype.setTimeoutInterval=function(a){this.timeoutInterval_=Math.max(0,a)};goog.net.XhrManager.prototype.getOutstandingCount=function(){return this.requests_.getCount()};goog.net.XhrManager.prototype.getOutstandingRequestIds=function(){return this.requests_.getKeys()};
goog.net.XhrManager.prototype.send=function(a,b,c,d,e,f,g,h,k,l){if(this.requests_.get(a))throw Error(goog.net.XhrManager.ERROR_ID_IN_USE_);b=new goog.net.XhrManager.Request(b,goog.bind(this.handleEvent_,this,a),c,d,e,g,goog.isDef(h)?h:this.maxRetries_,k,l);this.requests_.set(a,b);a=goog.bind(this.handleAvailableXhr_,this,a);this.xhrPool_.getObject(a,f);return b};
goog.net.XhrManager.prototype.abort=function(a,b){var c=this.requests_.get(a);if(c){var d=c.xhrIo;c.setAborted(!0);b&&(this.removeXhrListener_(d,c.getXhrEventCallback()),goog.events.listenOnce(d,goog.net.EventType.READY,function(){this.xhrPool_.releaseObject(d)},!1,this),this.requests_.remove(a));d&&d.abort()}};
goog.net.XhrManager.prototype.handleAvailableXhr_=function(a,b){var c=this.requests_.get(a);c&&!c.xhrIo?(this.addXhrListener_(b,c.getXhrEventCallback()),b.setTimeoutInterval(this.timeoutInterval_),b.setResponseType(c.getResponseType()),c.xhrIo=c.xhrLite=b,c.xhrIo.setWithCredentials(c.withCredentials_),this.dispatchEvent(new goog.net.XhrManager.Event(goog.net.EventType.READY,this,a,b)),this.retry_(a,b),c.getAborted()&&b.abort()):this.xhrPool_.releaseObject(b)};
goog.net.XhrManager.prototype.handleEvent_=function(a,b){var c=b.target;switch(b.type){case goog.net.EventType.READY:this.retry_(a,c);break;case goog.net.EventType.COMPLETE:return this.handleComplete_(a,c,b);case goog.net.EventType.SUCCESS:this.handleSuccess_(a,c);break;case goog.net.EventType.TIMEOUT:case goog.net.EventType.ERROR:this.handleError_(a,c);break;case goog.net.EventType.ABORT:this.handleAbort_(a,c)}return null};
goog.net.XhrManager.prototype.retry_=function(a,b){var c=this.requests_.get(a);!c||c.getCompleted()||c.hasReachedMaxRetries()?(c&&(this.removeXhrListener_(b,c.getXhrEventCallback()),this.requests_.remove(a)),this.xhrPool_.releaseObject(b)):(c.increaseAttemptCount(),b.send(c.getUrl(),c.getMethod(),c.getContent(),c.getHeaders()))};
goog.net.XhrManager.prototype.handleComplete_=function(a,b,c){var d=this.requests_.get(a);if(b.getLastErrorCode()==goog.net.ErrorCode.ABORT||b.isSuccess()||d.hasReachedMaxRetries())if(this.dispatchEvent(new goog.net.XhrManager.Event(goog.net.EventType.COMPLETE,this,a,b)),d&&(d.setCompleted(!0),d.getCompleteCallback()))return d.getCompleteCallback().call(b,c);return null};
goog.net.XhrManager.prototype.handleAbort_=function(a,b){this.dispatchEvent(new goog.net.XhrManager.Event(goog.net.EventType.ABORT,this,a,b))};goog.net.XhrManager.prototype.handleSuccess_=function(a,b){this.dispatchEvent(new goog.net.XhrManager.Event(goog.net.EventType.SUCCESS,this,a,b))};goog.net.XhrManager.prototype.handleError_=function(a,b){this.requests_.get(a).hasReachedMaxRetries()&&this.dispatchEvent(new goog.net.XhrManager.Event(goog.net.EventType.ERROR,this,a,b))};
goog.net.XhrManager.prototype.removeXhrListener_=function(a,b,c){this.eventHandler_.unlisten(a,c||goog.net.XhrManager.XHR_EVENT_TYPES_,b)};goog.net.XhrManager.prototype.addXhrListener_=function(a,b,c){this.eventHandler_.listen(a,c||goog.net.XhrManager.XHR_EVENT_TYPES_,b)};
goog.net.XhrManager.prototype.disposeInternal=function(){goog.net.XhrManager.superClass_.disposeInternal.call(this);this.xhrPool_.dispose();this.xhrPool_=null;this.eventHandler_.dispose();this.eventHandler_=null;var a=this.requests_;goog.structs.forEach(a,function(a,c){a.dispose()});a.clear();this.requests_=null};goog.net.XhrManager.Event=function(a,b,c,d){goog.events.Event.call(this,a,b);this.id=c;this.xhrIo=d};goog.inherits(goog.net.XhrManager.Event,goog.events.Event);
goog.net.XhrManager.Request=function(a,b,c,d,e,f,g,h,k){goog.Disposable.call(this);this.withCredentials_=!!k;this.url_=a;this.method_=c||"GET";this.content_=d;this.headers_=e||null;this.maxRetries_=goog.isDef(g)?g:1;this.attemptCount_=0;this.aborted_=this.completed_=!1;this.xhrEventCallback_=b;this.completeCallback_=f;this.responseType_=h||goog.net.XhrIo.ResponseType.DEFAULT;this.xhrIo=null};goog.inherits(goog.net.XhrManager.Request,goog.Disposable);goog.net.XhrManager.Request.prototype.getUrl=function(){return this.url_};
goog.net.XhrManager.Request.prototype.getMethod=function(){return this.method_};goog.net.XhrManager.Request.prototype.getContent=function(){return this.content_};goog.net.XhrManager.Request.prototype.getHeaders=function(){return this.headers_};goog.net.XhrManager.Request.prototype.getMaxRetries=function(){return this.maxRetries_};goog.net.XhrManager.Request.prototype.getAttemptCount=function(){return this.attemptCount_};goog.net.XhrManager.Request.prototype.increaseAttemptCount=function(){this.attemptCount_++};
goog.net.XhrManager.Request.prototype.hasReachedMaxRetries=function(){return this.attemptCount_>this.maxRetries_};goog.net.XhrManager.Request.prototype.setCompleted=function(a){this.completed_=a};goog.net.XhrManager.Request.prototype.getCompleted=function(){return this.completed_};goog.net.XhrManager.Request.prototype.setAborted=function(a){this.aborted_=a};goog.net.XhrManager.Request.prototype.getAborted=function(){return this.aborted_};goog.net.XhrManager.Request.prototype.getXhrEventCallback=function(){return this.xhrEventCallback_};
goog.net.XhrManager.Request.prototype.getCompleteCallback=function(){return this.completeCallback_};goog.net.XhrManager.Request.prototype.getResponseType=function(){return this.responseType_};goog.net.XhrManager.Request.prototype.disposeInternal=function(){goog.net.XhrManager.Request.superClass_.disposeInternal.call(this);delete this.xhrEventCallback_;delete this.completeCallback_};goog.crypt={};goog.crypt.stringToByteArray=function(a){for(var b=[],c=0,d=0;d<a.length;d++){for(var e=a.charCodeAt(d);255<e;)b[c++]=e&255,e>>=8;b[c++]=e}return b};goog.crypt.byteArrayToString=function(a){return String.fromCharCode.apply(null,a)};goog.crypt.byteArrayToHex=function(a){return goog.array.map(a,function(a){a=a.toString(16);return 1<a.length?a:"0"+a}).join("")};
goog.crypt.hexToByteArray=function(a){goog.asserts.assert(0==a.length%2,"Key string length must be multiple of 2");for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substring(c,c+2),16));return b};goog.crypt.stringToUtf8ByteArray=function(a){a=a.replace(/\r\n/g,"\n");for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?b[c++]=e:(2048>e?b[c++]=e>>6|192:(b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=e&63|128)}return b};
goog.crypt.utf8ByteArrayToString=function(a){for(var b=[],c=0,d=0;c<a.length;){var e=a[c++];if(128>e)b[d++]=String.fromCharCode(e);else if(191<e&&224>e){var f=a[c++];b[d++]=String.fromCharCode((e&31)<<6|f&63)}else{var f=a[c++],g=a[c++];b[d++]=String.fromCharCode((e&15)<<12|(f&63)<<6|g&63)}}return b.join("")};goog.crypt.xorByteArray=function(a,b){goog.asserts.assert(a.length==b.length,"XOR array lengths must match");for(var c=[],d=0;d<a.length;d++)c.push(a[d]^b[d]);return c};goog.crypt.Arc4=function(){this.state_=[];this.index2_=this.index1_=0};goog.crypt.Arc4.prototype.setKey=function(a,b){goog.asserts.assertArray(a,"Key parameter must be a byte array");b||(b=a.length);for(var c=this.state_,d=0;256>d;++d)c[d]=d;for(var e=0,d=0;256>d;++d){var e=e+c[d]+a[d%b]&255,f=c[d];c[d]=c[e];c[e]=f}this.index2_=this.index1_=0};
goog.crypt.Arc4.prototype.discard=function(a){for(var b=this.index1_,c=this.index2_,d=this.state_,e=0;e<a;++e){var b=b+1&255,c=c+d[b]&255,f=d[b];d[b]=d[c];d[c]=f}this.index1_=b;this.index2_=c};goog.crypt.Arc4.prototype.crypt=function(a,b){b||(b=a.length);for(var c=this.index1_,d=this.index2_,e=this.state_,f=0;f<b;++f){var c=c+1&255,d=d+e[c]&255,g=e[c];e[c]=e[d];e[d]=g;a[f]^=e[e[c]+e[d]&255]}this.index1_=c;this.index2_=d};goog.crypt.Hash=function(){};goog.crypt.Sha1=function(){goog.crypt.Hash.call(this);this.chain_=[];this.buf_=[];this.W_=[];this.pad_=[];this.pad_[0]=128;for(var a=1;64>a;++a)this.pad_[a]=0;this.reset()};goog.inherits(goog.crypt.Sha1,goog.crypt.Hash);goog.crypt.Sha1.prototype.reset=function(){this.chain_[0]=1732584193;this.chain_[1]=4023233417;this.chain_[2]=2562383102;this.chain_[3]=271733878;this.chain_[4]=3285377520;this.total_=this.inbuf_=0};
goog.crypt.Sha1.prototype.compress_=function(a,b){b||(b=0);var c=this.W_;if(goog.isString(a))for(var d=0;16>d;d++)c[d]=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),b+=4;else for(d=0;16>d;d++)c[d]=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3],b+=4;for(d=16;80>d;d++){var e=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=(e<<1|e>>>31)&4294967295}for(var f=this.chain_[0],g=this.chain_[1],h=this.chain_[2],k=this.chain_[3],l=this.chain_[4],m,d=0;80>d;d++)40>d?20>d?(e=k^g&(h^k),m=1518500249):
(e=g^h^k,m=1859775393):60>d?(e=g&h|k&(g|h),m=2400959708):(e=g^h^k,m=3395469782),e=(f<<5|f>>>27)+e+l+m+c[d]&4294967295,l=k,k=h,h=(g<<30|g>>>2)&4294967295,g=f,f=e;this.chain_[0]=this.chain_[0]+f&4294967295;this.chain_[1]=this.chain_[1]+g&4294967295;this.chain_[2]=this.chain_[2]+h&4294967295;this.chain_[3]=this.chain_[3]+k&4294967295;this.chain_[4]=this.chain_[4]+l&4294967295};
goog.crypt.Sha1.prototype.update=function(a,b){goog.isDef(b)||(b=a.length);for(var c=b-64,d=0,e=this.buf_,f=this.inbuf_;d<b;){if(0==f)for(;d<=c;)this.compress_(a,d),d+=64;if(goog.isString(a))for(;d<b;){if(e[f]=a.charCodeAt(d),++f,++d,64==f){this.compress_(e);f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,64==f){this.compress_(e);f=0;break}}this.inbuf_=f;this.total_+=b};
goog.crypt.Sha1.prototype.digest=function(){var a=[],b=8*this.total_;56>this.inbuf_?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,64-(this.inbuf_-56));for(var c=63;56<=c;c--)this.buf_[c]=b&255,b/=256;this.compress_(this.buf_);for(c=b=0;5>c;c++)for(var d=24;0<=d;d-=8)a[b]=this.chain_[c]>>d&255,++b;return a};goog.crypt.base64={};goog.crypt.base64.byteToCharMap_=null;goog.crypt.base64.charToByteMap_=null;goog.crypt.base64.byteToCharMapWebSafe_=null;goog.crypt.base64.charToByteMapWebSafe_=null;goog.crypt.base64.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.ENCODED_VALS_BASE+"+/=";goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_.";
goog.crypt.base64.HAS_NATIVE_SUPPORT=goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA||"function"==typeof goog.global.atob;
goog.crypt.base64.encodeByteArray=function(a,b){if(!goog.isArrayLike(a))throw Error("encodeByteArray takes an array as a parameter");goog.crypt.base64.init_();for(var c=b?goog.crypt.base64.byteToCharMapWebSafe_:goog.crypt.base64.byteToCharMap_,d=[],e=0;e<a.length;e+=3){var f=a[e],g=e+1<a.length,h=g?a[e+1]:0,k=e+2<a.length,l=k?a[e+2]:0,m=f>>2,f=(f&3)<<4|h>>4,h=(h&15)<<2|l>>6,l=l&63;k||(l=64,g||(h=64));d.push(c[m],c[f],c[h],c[l])}return d.join("")};
goog.crypt.base64.encodeString=function(a,b){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!b?goog.global.btoa(a):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(a),b)};goog.crypt.base64.decodeString=function(a,b){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!b?goog.global.atob(a):goog.crypt.byteArrayToString(goog.crypt.base64.decodeStringToByteArray(a,b))};
goog.crypt.base64.decodeStringToByteArray=function(a,b){goog.crypt.base64.init_();for(var c=b?goog.crypt.base64.charToByteMapWebSafe_:goog.crypt.base64.charToByteMap_,d=[],e=0;e<a.length;){var f=c[a.charAt(e++)],g=e<a.length?c[a.charAt(e)]:0;++e;var h=e<a.length?c[a.charAt(e)]:0;++e;var k=e<a.length?c[a.charAt(e)]:0;++e;if(null==f||null==g||null==h||null==k)throw Error();d.push(f<<2|g>>4);64!=h&&(d.push(g<<4&240|h>>2),64!=k&&d.push(h<<6&192|k))}return d};
goog.crypt.base64.init_=function(){if(!goog.crypt.base64.byteToCharMap_){goog.crypt.base64.byteToCharMap_={};goog.crypt.base64.charToByteMap_={};goog.crypt.base64.byteToCharMapWebSafe_={};goog.crypt.base64.charToByteMapWebSafe_={};for(var a=0;a<goog.crypt.base64.ENCODED_VALS.length;a++)goog.crypt.base64.byteToCharMap_[a]=goog.crypt.base64.ENCODED_VALS.charAt(a),goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[a]]=a,goog.crypt.base64.byteToCharMapWebSafe_[a]=goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(a),
goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.byteToCharMapWebSafe_[a]]=a}};goog.storage={};goog.storage.ErrorCode={INVALID_VALUE:"Storage: Invalid value was encountered",DECRYPTION_ERROR:"Storage: The value could not be decrypted"};goog.storage.Storage=function(a){this.mechanism=a;this.serializer_=new goog.json.Serializer};goog.storage.Storage.prototype.set=function(a,b){goog.isDef(b)?this.mechanism.set(a,this.serializer_.serialize(b)):this.mechanism.remove(a)};goog.storage.Storage.prototype.get=function(a){var b;try{b=this.mechanism.get(a)}catch(c){return}if(!goog.isNull(b))try{return goog.json.parse(b)}catch(d){throw goog.storage.ErrorCode.INVALID_VALUE;}};goog.storage.Storage.prototype.remove=function(a){this.mechanism.remove(a)};goog.storage.mechanism={};goog.storage.mechanism.Mechanism=function(){};goog.storage.RichStorage=function(a){goog.storage.Storage.call(this,a)};goog.inherits(goog.storage.RichStorage,goog.storage.Storage);goog.storage.RichStorage.DATA_KEY="data";goog.storage.RichStorage.Wrapper=function(a){this[goog.storage.RichStorage.DATA_KEY]=a};goog.storage.RichStorage.Wrapper.wrapIfNecessary=function(a){return!goog.isDef(a)||a instanceof goog.storage.RichStorage.Wrapper?a:new goog.storage.RichStorage.Wrapper(a)};
goog.storage.RichStorage.Wrapper.unwrap=function(a){a=a[goog.storage.RichStorage.DATA_KEY];if(!goog.isDef(a))throw goog.storage.ErrorCode.INVALID_VALUE;return a};goog.storage.RichStorage.Wrapper.unwrapIfPossible=function(a){return a?goog.storage.RichStorage.Wrapper.unwrap(a):void 0};goog.storage.RichStorage.prototype.set=function(a,b){goog.storage.RichStorage.superClass_.set.call(this,a,goog.storage.RichStorage.Wrapper.wrapIfNecessary(b))};
goog.storage.RichStorage.prototype.getWrapper=function(a){a=goog.storage.RichStorage.superClass_.get.call(this,a);if(!goog.isDef(a)||a instanceof Object)return a;throw goog.storage.ErrorCode.INVALID_VALUE;};goog.storage.RichStorage.prototype.get=function(a){return goog.storage.RichStorage.Wrapper.unwrapIfPossible(this.getWrapper(a))};goog.storage.ExpiringStorage=function(a){goog.storage.RichStorage.call(this,a)};goog.inherits(goog.storage.ExpiringStorage,goog.storage.RichStorage);goog.storage.ExpiringStorage.EXPIRATION_TIME_KEY="expiration";goog.storage.ExpiringStorage.CREATION_TIME_KEY="creation";goog.storage.ExpiringStorage.getCreationTime=function(a){return a[goog.storage.ExpiringStorage.CREATION_TIME_KEY]};goog.storage.ExpiringStorage.getExpirationTime=function(a){return a[goog.storage.ExpiringStorage.EXPIRATION_TIME_KEY]};
goog.storage.ExpiringStorage.isExpired=function(a){var b=goog.storage.ExpiringStorage.getCreationTime(a);a=goog.storage.ExpiringStorage.getExpirationTime(a);return!!a&&a<goog.now()||!!b&&b>goog.now()};
goog.storage.ExpiringStorage.prototype.set=function(a,b,c){if(b=goog.storage.RichStorage.Wrapper.wrapIfNecessary(b)){if(c){if(c<goog.now()){goog.storage.ExpiringStorage.prototype.remove.call(this,a);return}b[goog.storage.ExpiringStorage.EXPIRATION_TIME_KEY]=c}b[goog.storage.ExpiringStorage.CREATION_TIME_KEY]=goog.now()}goog.storage.ExpiringStorage.superClass_.set.call(this,a,b)};
goog.storage.ExpiringStorage.prototype.getWrapper=function(a,b){var c=goog.storage.ExpiringStorage.superClass_.getWrapper.call(this,a);if(c)if(!b&&goog.storage.ExpiringStorage.isExpired(c))goog.storage.ExpiringStorage.prototype.remove.call(this,a);else return c};goog.storage.CollectableStorage=function(a){goog.storage.ExpiringStorage.call(this,a)};goog.inherits(goog.storage.CollectableStorage,goog.storage.ExpiringStorage);
goog.storage.CollectableStorage.prototype.getExpiredKeys_=function(a,b){var c=[];goog.iter.forEach(a,function(a){var e;try{e=goog.storage.CollectableStorage.prototype.getWrapper.call(this,a,!0)}catch(f){if(f==goog.storage.ErrorCode.INVALID_VALUE){b&&c.push(a);return}throw f;}if(!goog.isDef(e))c.push(a);else if(goog.storage.ExpiringStorage.isExpired(e))c.push(a);else if(b)try{goog.storage.RichStorage.Wrapper.unwrap(e)}catch(g){if(g==goog.storage.ErrorCode.INVALID_VALUE)c.push(a);else throw g;}},this);
return c};goog.storage.CollectableStorage.prototype.collectInternal=function(a,b){var c=this.getExpiredKeys_(a,b);goog.array.forEach(c,function(a){goog.storage.CollectableStorage.prototype.remove.call(this,a)},this);return c};goog.storage.CollectableStorage.prototype.collect=function(a){this.collectInternal(this.mechanism.__iterator__(!0),a)};goog.storage.mechanism.IterableMechanism=function(){goog.storage.mechanism.Mechanism.call(this)};goog.inherits(goog.storage.mechanism.IterableMechanism,goog.storage.mechanism.Mechanism);goog.storage.mechanism.IterableMechanism.prototype.getCount=function(){var a=0;goog.iter.forEach(this.__iterator__(!0),function(b){goog.asserts.assertString(b);a++});return a};
goog.storage.mechanism.IterableMechanism.prototype.clear=function(){var a=goog.iter.toArray(this.__iterator__(!0)),b=this;goog.array.forEach(a,function(a){b.remove(a)})};goog.storage.EncryptedStorage=function(a,b){goog.storage.CollectableStorage.call(this,a);this.secret_=goog.crypt.stringToByteArray(b);this.cleartextSerializer_=new goog.json.Serializer};goog.inherits(goog.storage.EncryptedStorage,goog.storage.CollectableStorage);goog.storage.EncryptedStorage.SALT_KEY="salt";goog.storage.EncryptedStorage.prototype.secret_=null;goog.storage.EncryptedStorage.prototype.cleartextSerializer_=null;
goog.storage.EncryptedStorage.prototype.hashKeyWithSecret_=function(a){var b=new goog.crypt.Sha1;b.update(goog.crypt.stringToByteArray(a));b.update(this.secret_);return goog.crypt.base64.encodeByteArray(b.digest(),!0)};
goog.storage.EncryptedStorage.prototype.encryptValue_=function(a,b,c){if(!(0<a.length))throw Error("Non-empty salt must be provided");var d=new goog.crypt.Sha1;d.update(goog.crypt.stringToByteArray(b));d.update(a);d.update(this.secret_);a=new goog.crypt.Arc4;a.setKey(d.digest());a.discard(1536);c=goog.crypt.stringToByteArray(c);a.crypt(c);return goog.crypt.byteArrayToString(c)};goog.storage.EncryptedStorage.prototype.decryptValue_=function(a,b,c){return this.encryptValue_(a,b,c)};
goog.storage.EncryptedStorage.prototype.set=function(a,b,c){if(goog.isDef(b)){for(var d=[],e=0;8>e;++e)d[e]=Math.floor(256*Math.random());b=new goog.storage.RichStorage.Wrapper(this.encryptValue_(d,a,this.cleartextSerializer_.serialize(b)));b[goog.storage.EncryptedStorage.SALT_KEY]=d;goog.storage.EncryptedStorage.superClass_.set.call(this,this.hashKeyWithSecret_(a),b,c)}else goog.storage.EncryptedStorage.prototype.remove.call(this,a)};
goog.storage.EncryptedStorage.prototype.getWrapper=function(a,b){var c=goog.storage.EncryptedStorage.superClass_.getWrapper.call(this,this.hashKeyWithSecret_(a),b);if(c){var d=goog.storage.RichStorage.Wrapper.unwrap(c),e=c[goog.storage.EncryptedStorage.SALT_KEY];if(!goog.isString(d)||!goog.isArray(e)||!e.length)throw goog.storage.ErrorCode.INVALID_VALUE;d=this.decryptValue_(e,a,d);try{c[goog.storage.RichStorage.DATA_KEY]=goog.json.parse(d)}catch(f){throw goog.storage.ErrorCode.DECRYPTION_ERROR;}return c}};
goog.storage.EncryptedStorage.prototype.remove=function(a){goog.storage.EncryptedStorage.superClass_.remove.call(this,this.hashKeyWithSecret_(a))};goog.storage.mechanism.ErrorCode={INVALID_VALUE:"Storage mechanism: Invalid value was encountered",QUOTA_EXCEEDED:"Storage mechanism: Quota exceeded",STORAGE_DISABLED:"Storage mechanism: Storage disabled"};goog.storage.mechanism.HTML5WebStorage=function(a){goog.storage.mechanism.IterableMechanism.call(this);this.storage_=a};goog.inherits(goog.storage.mechanism.HTML5WebStorage,goog.storage.mechanism.IterableMechanism);goog.storage.mechanism.HTML5WebStorage.STORAGE_AVAILABLE_KEY_="__sak";
goog.storage.mechanism.HTML5WebStorage.prototype.isAvailable=function(){if(!this.storage_)return!1;try{return this.storage_.setItem(goog.storage.mechanism.HTML5WebStorage.STORAGE_AVAILABLE_KEY_,"1"),this.storage_.removeItem(goog.storage.mechanism.HTML5WebStorage.STORAGE_AVAILABLE_KEY_),!0}catch(a){return!1}};
goog.storage.mechanism.HTML5WebStorage.prototype.set=function(a,b){try{this.storage_.setItem(a,b)}catch(c){if(0==this.storage_.length)throw goog.storage.mechanism.ErrorCode.STORAGE_DISABLED;throw goog.storage.mechanism.ErrorCode.QUOTA_EXCEEDED;}};goog.storage.mechanism.HTML5WebStorage.prototype.get=function(a){a=this.storage_.getItem(a);if(!goog.isString(a)&&!goog.isNull(a))throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;return a};goog.storage.mechanism.HTML5WebStorage.prototype.remove=function(a){this.storage_.removeItem(a)};
goog.storage.mechanism.HTML5WebStorage.prototype.getCount=function(){return this.storage_.length};goog.storage.mechanism.HTML5WebStorage.prototype.__iterator__=function(a){var b=0,c=this.storage_,d=new goog.iter.Iterator;d.next=function(){if(b>=c.length)throw goog.iter.StopIteration;var d=goog.asserts.assertString(c.key(b++));if(a)return d;d=c.getItem(d);if(!goog.isString(d))throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;return d};return d};
goog.storage.mechanism.HTML5WebStorage.prototype.clear=function(){this.storage_.clear()};goog.storage.mechanism.HTML5WebStorage.prototype.key=function(a){return this.storage_.key(a)};goog.storage.mechanism.HTML5LocalStorage=function(){var a=null;try{a=window.localStorage||null}catch(b){}goog.storage.mechanism.HTML5WebStorage.call(this,a)};goog.inherits(goog.storage.mechanism.HTML5LocalStorage,goog.storage.mechanism.HTML5WebStorage);goog.dom.BrowserFeature={CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),CAN_USE_CHILDREN_ATTRIBUTE:!goog.userAgent.GECKO&&!goog.userAgent.IE||goog.userAgent.IE&&goog.userAgent.isDocumentModeOrHigher(9)||goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9.1"),CAN_USE_INNER_TEXT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),CAN_USE_PARENT_ELEMENT_PROPERTY:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT,INNER_HTML_NEEDS_SCOPED_ELEMENT:goog.userAgent.IE};goog.dom.TagName={A:"A",ABBR:"ABBR",ACRONYM:"ACRONYM",ADDRESS:"ADDRESS",APPLET:"APPLET",AREA:"AREA",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",B:"B",BASE:"BASE",BASEFONT:"BASEFONT",BDI:"BDI",BDO:"BDO",BIG:"BIG",BLOCKQUOTE:"BLOCKQUOTE",BODY:"BODY",BR:"BR",BUTTON:"BUTTON",CANVAS:"CANVAS",CAPTION:"CAPTION",CENTER:"CENTER",CITE:"CITE",CODE:"CODE",COL:"COL",COLGROUP:"COLGROUP",COMMAND:"COMMAND",DATA:"DATA",DATALIST:"DATALIST",DD:"DD",DEL:"DEL",DETAILS:"DETAILS",DFN:"DFN",DIALOG:"DIALOG",DIR:"DIR",DIV:"DIV",
DL:"DL",DT:"DT",EM:"EM",EMBED:"EMBED",FIELDSET:"FIELDSET",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FONT:"FONT",FOOTER:"FOOTER",FORM:"FORM",FRAME:"FRAME",FRAMESET:"FRAMESET",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEAD:"HEAD",HEADER:"HEADER",HGROUP:"HGROUP",HR:"HR",HTML:"HTML",I:"I",IFRAME:"IFRAME",IMG:"IMG",INPUT:"INPUT",INS:"INS",ISINDEX:"ISINDEX",KBD:"KBD",KEYGEN:"KEYGEN",LABEL:"LABEL",LEGEND:"LEGEND",LI:"LI",LINK:"LINK",MAP:"MAP",MARK:"MARK",MATH:"MATH",MENU:"MENU",META:"META",METER:"METER",
NAV:"NAV",NOFRAMES:"NOFRAMES",NOSCRIPT:"NOSCRIPT",OBJECT:"OBJECT",OL:"OL",OPTGROUP:"OPTGROUP",OPTION:"OPTION",OUTPUT:"OUTPUT",P:"P",PARAM:"PARAM",PRE:"PRE",PROGRESS:"PROGRESS",Q:"Q",RP:"RP",RT:"RT",RUBY:"RUBY",S:"S",SAMP:"SAMP",SCRIPT:"SCRIPT",SECTION:"SECTION",SELECT:"SELECT",SMALL:"SMALL",SOURCE:"SOURCE",SPAN:"SPAN",STRIKE:"STRIKE",STRONG:"STRONG",STYLE:"STYLE",SUB:"SUB",SUMMARY:"SUMMARY",SUP:"SUP",SVG:"SVG",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TEXTAREA:"TEXTAREA",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",
TIME:"TIME",TITLE:"TITLE",TR:"TR",TRACK:"TRACK",TT:"TT",U:"U",UL:"UL",VAR:"VAR",VIDEO:"VIDEO",WBR:"WBR"};goog.dom.classes={};goog.dom.classes.set=function(a,b){a.className=b};goog.dom.classes.get=function(a){a=a.className;return goog.isString(a)&&a.match(/\S+/g)||[]};goog.dom.classes.add=function(a,b){var c=goog.dom.classes.get(a),d=goog.array.slice(arguments,1),e=c.length+d.length;goog.dom.classes.add_(c,d);goog.dom.classes.set(a,c.join(" "));return c.length==e};
goog.dom.classes.remove=function(a,b){var c=goog.dom.classes.get(a),d=goog.array.slice(arguments,1),e=goog.dom.classes.getDifference_(c,d);goog.dom.classes.set(a,e.join(" "));return e.length==c.length-d.length};goog.dom.classes.add_=function(a,b){for(var c=0;c<b.length;c++)goog.array.contains(a,b[c])||a.push(b[c])};goog.dom.classes.getDifference_=function(a,b){return goog.array.filter(a,function(a){return!goog.array.contains(b,a)})};
goog.dom.classes.swap=function(a,b,c){for(var d=goog.dom.classes.get(a),e=!1,f=0;f<d.length;f++)d[f]==b&&(goog.array.splice(d,f--,1),e=!0);e&&(d.push(c),goog.dom.classes.set(a,d.join(" ")));return e};goog.dom.classes.addRemove=function(a,b,c){var d=goog.dom.classes.get(a);goog.isString(b)?goog.array.remove(d,b):goog.isArray(b)&&(d=goog.dom.classes.getDifference_(d,b));goog.isString(c)&&!goog.array.contains(d,c)?d.push(c):goog.isArray(c)&&goog.dom.classes.add_(d,c);goog.dom.classes.set(a,d.join(" "))};
goog.dom.classes.has=function(a,b){return goog.array.contains(goog.dom.classes.get(a),b)};goog.dom.classes.enable=function(a,b,c){c?goog.dom.classes.add(a,b):goog.dom.classes.remove(a,b)};goog.dom.classes.toggle=function(a,b){var c=!goog.dom.classes.has(a,b);goog.dom.classes.enable(a,b,c);return c};goog.math.Coordinate=function(a,b){this.x=goog.isDef(a)?a:0;this.y=goog.isDef(b)?b:0};goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)};goog.DEBUG&&(goog.math.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"});goog.math.Coordinate.equals=function(a,b){return a==b?!0:a&&b?a.x==b.x&&a.y==b.y:!1};goog.math.Coordinate.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};
goog.math.Coordinate.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};goog.math.Coordinate.azimuth=function(a){return goog.math.angle(0,0,a.x,a.y)};goog.math.Coordinate.squaredDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};goog.math.Coordinate.difference=function(a,b){return new goog.math.Coordinate(a.x-b.x,a.y-b.y)};goog.math.Coordinate.sum=function(a,b){return new goog.math.Coordinate(a.x+b.x,a.y+b.y)};
goog.math.Coordinate.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};goog.math.Coordinate.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};goog.math.Coordinate.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};goog.math.Coordinate.prototype.translate=function(a,b){a instanceof goog.math.Coordinate?(this.x+=a.x,this.y+=a.y):(this.x+=a,goog.isNumber(b)&&(this.y+=b));return this};
goog.math.Coordinate.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.x*=a;this.y*=c;return this};goog.math.Size=function(a,b){this.width=a;this.height=b};goog.math.Size.equals=function(a,b){return a==b?!0:a&&b?a.width==b.width&&a.height==b.height:!1};goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)};goog.DEBUG&&(goog.math.Size.prototype.toString=function(){return"("+this.width+" x "+this.height+")"});goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)};
goog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)};goog.math.Size.prototype.area=function(){return this.width*this.height};goog.math.Size.prototype.perimeter=function(){return 2*(this.width+this.height)};goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height};goog.math.Size.prototype.isEmpty=function(){return!this.area()};goog.math.Size.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};
goog.math.Size.prototype.fitsInside=function(a){return this.width<=a.width&&this.height<=a.height};goog.math.Size.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};goog.math.Size.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Size.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.width*=a;this.height*=c;return this};
goog.math.Size.prototype.scaleToFit=function(a){a=this.aspectRatio()>a.aspectRatio()?a.width/this.width:a.height/this.height;return this.scale(a)};goog.dom.ASSUME_QUIRKS_MODE=!1;goog.dom.ASSUME_STANDARDS_MODE=!1;goog.dom.COMPAT_MODE_KNOWN_=goog.dom.ASSUME_QUIRKS_MODE||goog.dom.ASSUME_STANDARDS_MODE;goog.dom.getDomHelper=function(a){return a?new goog.dom.DomHelper(goog.dom.getOwnerDocument(a)):goog.dom.defaultDomHelper_||(goog.dom.defaultDomHelper_=new goog.dom.DomHelper)};goog.dom.getDocument=function(){return document};goog.dom.getElement=function(a){return goog.dom.getElementHelper_(document,a)};
goog.dom.getElementHelper_=function(a,b){return goog.isString(b)?a.getElementById(b):b};goog.dom.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(document,a)};goog.dom.getRequiredElementHelper_=function(a,b){goog.asserts.assertString(b);var c=goog.dom.getElementHelper_(a,b);return c=goog.asserts.assertElement(c,"No element found with id: "+b)};goog.dom.$=goog.dom.getElement;
goog.dom.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(document,a,b,c)};goog.dom.getElementsByClass=function(a,b){var c=b||document;return goog.dom.canUseQuerySelector_(c)?c.querySelectorAll("."+a):c.getElementsByClassName?c.getElementsByClassName(a):goog.dom.getElementsByTagNameAndClass_(document,"*",a,b)};
goog.dom.getElementByClass=function(a,b){var c=b||document,d=null;return(d=goog.dom.canUseQuerySelector_(c)?c.querySelector("."+a):goog.dom.getElementsByClass(a,b)[0])||null};goog.dom.getRequiredElementByClass=function(a,b){var c=goog.dom.getElementByClass(a,b);return goog.asserts.assert(c,"No element found with className: "+a)};goog.dom.canUseQuerySelector_=function(a){return!(!a.querySelectorAll||!a.querySelector)};
goog.dom.getElementsByTagNameAndClass_=function(a,b,c,d){a=d||a;b=b&&"*"!=b?b.toUpperCase():"";if(goog.dom.canUseQuerySelector_(a)&&(b||c))return a.querySelectorAll(b+(c?"."+c:""));if(c&&a.getElementsByClassName){a=a.getElementsByClassName(c);if(b){d={};for(var e=0,f=0,g;g=a[f];f++)b==g.nodeName&&(d[e++]=g);d.length=e;return d}return a}a=a.getElementsByTagName(b||"*");if(c){d={};for(f=e=0;g=a[f];f++)b=g.className,"function"==typeof b.split&&goog.array.contains(b.split(/\s+/),c)&&(d[e++]=g);d.length=
e;return d}return a};goog.dom.$$=goog.dom.getElementsByTagNameAndClass;goog.dom.setProperties=function(a,b){goog.object.forEach(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in goog.dom.DIRECT_ATTRIBUTE_MAP_?a.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[d],b):goog.string.startsWith(d,"aria-")||goog.string.startsWith(d,"data-")?a.setAttribute(d,b):a[d]=b})};
goog.dom.DIRECT_ATTRIBUTE_MAP_={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};goog.dom.getViewportSize=function(a){return goog.dom.getViewportSize_(a||window)};goog.dom.getViewportSize_=function(a){a=a.document;a=goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body;return new goog.math.Size(a.clientWidth,a.clientHeight)};
goog.dom.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(window)};goog.dom.getDocumentHeight_=function(a){var b=a.document,c=0;if(b){a=goog.dom.getViewportSize_(a).height;var c=b.body,d=b.documentElement;if(goog.dom.isCss1CompatMode_(b)&&d.scrollHeight)c=d.scrollHeight!=a?d.scrollHeight:d.offsetHeight;else{var b=d.scrollHeight,e=d.offsetHeight;d.clientHeight!=e&&(b=c.scrollHeight,e=c.offsetHeight);c=b>a?b>e?b:e:b<e?b:e}}return c};
goog.dom.getPageScroll=function(a){return goog.dom.getDomHelper((a||goog.global||window).document).getDocumentScroll()};goog.dom.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(document)};
goog.dom.getDocumentScroll_=function(a){var b=goog.dom.getDocumentScrollElement_(a);a=goog.dom.getWindow_(a);return goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("10")&&a.pageYOffset!=b.scrollTop?new goog.math.Coordinate(b.scrollLeft,b.scrollTop):new goog.math.Coordinate(a.pageXOffset||b.scrollLeft,a.pageYOffset||b.scrollTop)};goog.dom.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(document)};
goog.dom.getDocumentScrollElement_=function(a){return!goog.userAgent.WEBKIT&&goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body||a.documentElement};goog.dom.getWindow=function(a){return a?goog.dom.getWindow_(a):window};goog.dom.getWindow_=function(a){return a.parentWindow||a.defaultView};goog.dom.createDom=function(a,b,c){return goog.dom.createDom_(document,arguments)};
goog.dom.createDom_=function(a,b){var c=b[0],d=b[1];if(!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES&&d&&(d.name||d.type)){c=["<",c];d.name&&c.push(' name="',goog.string.htmlEscape(d.name),'"');if(d.type){c.push(' type="',goog.string.htmlEscape(d.type),'"');var e={};goog.object.extend(e,d);delete e.type;d=e}c.push(">");c=c.join("")}c=a.createElement(c);d&&(goog.isString(d)?c.className=d:goog.isArray(d)?goog.dom.classes.add.apply(null,[c].concat(d)):goog.dom.setProperties(c,d));2<b.length&&
goog.dom.append_(a,c,b,2);return c};goog.dom.append_=function(a,b,c,d){function e(c){c&&b.appendChild(goog.isString(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var f=c[d];goog.isArrayLike(f)&&!goog.dom.isNodeLike(f)?goog.array.forEach(goog.dom.isNodeList(f)?goog.array.toArray(f):f,e):e(f)}};goog.dom.$dom=goog.dom.createDom;goog.dom.createElement=function(a){return document.createElement(a)};goog.dom.createTextNode=function(a){return document.createTextNode(String(a))};
goog.dom.createTable=function(a,b,c){return goog.dom.createTable_(document,a,b,!!c)};goog.dom.createTable_=function(a,b,c,d){for(var e=["<tr>"],f=0;f<c;f++)e.push(d?"<td>&nbsp;</td>":"<td></td>");e.push("</tr>");e=e.join("");c=["<table>"];for(f=0;f<b;f++)c.push(e);c.push("</table>");a=a.createElement(goog.dom.TagName.DIV);a.innerHTML=c.join("");return a.removeChild(a.firstChild)};goog.dom.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(document,a)};
goog.dom.htmlToDocumentFragment_=function(a,b){var c=a.createElement("div");goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT?(c.innerHTML="<br>"+b,c.removeChild(c.firstChild)):c.innerHTML=b;if(1==c.childNodes.length)return c.removeChild(c.firstChild);for(var d=a.createDocumentFragment();c.firstChild;)d.appendChild(c.firstChild);return d};goog.dom.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(document)};
goog.dom.isCss1CompatMode_=function(a){return goog.dom.COMPAT_MODE_KNOWN_?goog.dom.ASSUME_STANDARDS_MODE:"CSS1Compat"==a.compatMode};goog.dom.canHaveChildren=function(a){if(a.nodeType!=goog.dom.NodeType.ELEMENT)return!1;switch(a.tagName){case goog.dom.TagName.APPLET:case goog.dom.TagName.AREA:case goog.dom.TagName.BASE:case goog.dom.TagName.BR:case goog.dom.TagName.COL:case goog.dom.TagName.COMMAND:case goog.dom.TagName.EMBED:case goog.dom.TagName.FRAME:case goog.dom.TagName.HR:case goog.dom.TagName.IMG:case goog.dom.TagName.INPUT:case goog.dom.TagName.IFRAME:case goog.dom.TagName.ISINDEX:case goog.dom.TagName.KEYGEN:case goog.dom.TagName.LINK:case goog.dom.TagName.NOFRAMES:case goog.dom.TagName.NOSCRIPT:case goog.dom.TagName.META:case goog.dom.TagName.OBJECT:case goog.dom.TagName.PARAM:case goog.dom.TagName.SCRIPT:case goog.dom.TagName.SOURCE:case goog.dom.TagName.STYLE:case goog.dom.TagName.TRACK:case goog.dom.TagName.WBR:return!1}return!0};
goog.dom.appendChild=function(a,b){a.appendChild(b)};goog.dom.append=function(a,b){goog.dom.append_(goog.dom.getOwnerDocument(a),a,arguments,1)};goog.dom.removeChildren=function(a){for(var b;b=a.firstChild;)a.removeChild(b)};goog.dom.insertSiblingBefore=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)};goog.dom.insertSiblingAfter=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b.nextSibling)};goog.dom.insertChildAt=function(a,b,c){a.insertBefore(b,a.childNodes[c]||null)};
goog.dom.removeNode=function(a){return a&&a.parentNode?a.parentNode.removeChild(a):null};goog.dom.replaceNode=function(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)};goog.dom.flattenElement=function(a){var b,c=a.parentNode;if(c&&c.nodeType!=goog.dom.NodeType.DOCUMENT_FRAGMENT){if(a.removeNode)return a.removeNode(!1);for(;b=a.firstChild;)c.insertBefore(b,a);return goog.dom.removeNode(a)}};
goog.dom.getChildren=function(a){return goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE&&void 0!=a.children?a.children:goog.array.filter(a.childNodes,function(a){return a.nodeType==goog.dom.NodeType.ELEMENT})};goog.dom.getFirstElementChild=function(a){return void 0!=a.firstElementChild?a.firstElementChild:goog.dom.getNextElementNode_(a.firstChild,!0)};goog.dom.getLastElementChild=function(a){return void 0!=a.lastElementChild?a.lastElementChild:goog.dom.getNextElementNode_(a.lastChild,!1)};
goog.dom.getNextElementSibling=function(a){return void 0!=a.nextElementSibling?a.nextElementSibling:goog.dom.getNextElementNode_(a.nextSibling,!0)};goog.dom.getPreviousElementSibling=function(a){return void 0!=a.previousElementSibling?a.previousElementSibling:goog.dom.getNextElementNode_(a.previousSibling,!1)};goog.dom.getNextElementNode_=function(a,b){for(;a&&a.nodeType!=goog.dom.NodeType.ELEMENT;)a=b?a.nextSibling:a.previousSibling;return a};
goog.dom.getNextNode=function(a){if(!a)return null;if(a.firstChild)return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null};goog.dom.getPreviousNode=function(a){if(!a)return null;if(!a.previousSibling)return a.parentNode;for(a=a.previousSibling;a&&a.lastChild;)a=a.lastChild;return a};goog.dom.isNodeLike=function(a){return goog.isObject(a)&&0<a.nodeType};goog.dom.isElement=function(a){return goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT};
goog.dom.isWindow=function(a){return goog.isObject(a)&&a.window==a};goog.dom.getParentElement=function(a){if(goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY&&!(goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("9")&&!goog.userAgent.isVersionOrHigher("10")&&goog.global.SVGElement&&a instanceof goog.global.SVGElement))return a.parentElement;a=a.parentNode;return goog.dom.isElement(a)?a:null};
goog.dom.contains=function(a,b){if(a.contains&&b.nodeType==goog.dom.NodeType.ELEMENT)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};
goog.dom.compareNodeOrder=function(a,b){if(a==b)return 0;if(a.compareDocumentPosition)return a.compareDocumentPosition(b)&2?1:-1;if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){if(a.nodeType==goog.dom.NodeType.DOCUMENT)return-1;if(b.nodeType==goog.dom.NodeType.DOCUMENT)return 1}if("sourceIndex"in a||a.parentNode&&"sourceIndex"in a.parentNode){var c=a.nodeType==goog.dom.NodeType.ELEMENT,d=b.nodeType==goog.dom.NodeType.ELEMENT;if(c&&d)return a.sourceIndex-b.sourceIndex;var e=a.parentNode,
f=b.parentNode;return e==f?goog.dom.compareSiblingOrder_(a,b):!c&&goog.dom.contains(e,b)?-1*goog.dom.compareParentsDescendantNodeIe_(a,b):!d&&goog.dom.contains(f,a)?goog.dom.compareParentsDescendantNodeIe_(b,a):(c?a.sourceIndex:e.sourceIndex)-(d?b.sourceIndex:f.sourceIndex)}d=goog.dom.getOwnerDocument(a);c=d.createRange();c.selectNode(a);c.collapse(!0);d=d.createRange();d.selectNode(b);d.collapse(!0);return c.compareBoundaryPoints(goog.global.Range.START_TO_END,d)};
goog.dom.compareParentsDescendantNodeIe_=function(a,b){var c=a.parentNode;if(c==b)return-1;for(var d=b;d.parentNode!=c;)d=d.parentNode;return goog.dom.compareSiblingOrder_(d,a)};goog.dom.compareSiblingOrder_=function(a,b){for(var c=b;c=c.previousSibling;)if(c==a)return-1;return 1};
goog.dom.findCommonAncestor=function(a){var b,c=arguments.length;if(!c)return null;if(1==c)return arguments[0];var d=[],e=Infinity;for(b=0;b<c;b++){for(var f=[],g=arguments[b];g;)f.unshift(g),g=g.parentNode;d.push(f);e=Math.min(e,f.length)}f=null;for(b=0;b<e;b++){for(var g=d[0][b],h=1;h<c;h++)if(g!=d[h][b])return f;f=g}return f};goog.dom.getOwnerDocument=function(a){return a.nodeType==goog.dom.NodeType.DOCUMENT?a:a.ownerDocument||a.document};
goog.dom.getFrameContentDocument=function(a){return a.contentDocument||a.contentWindow.document};goog.dom.getFrameContentWindow=function(a){return a.contentWindow||goog.dom.getWindow(goog.dom.getFrameContentDocument(a))};
goog.dom.setTextContent=function(a,b){goog.asserts.assert(null!=a,"goog.dom.setTextContent expects a non-null value for node");if("textContent"in a)a.textContent=b;else if(a.nodeType==goog.dom.NodeType.TEXT)a.data=b;else if(a.firstChild&&a.firstChild.nodeType==goog.dom.NodeType.TEXT){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{goog.dom.removeChildren(a);var c=goog.dom.getOwnerDocument(a);a.appendChild(c.createTextNode(String(b)))}};
goog.dom.getOuterHtml=function(a){if("outerHTML"in a)return a.outerHTML;var b=goog.dom.getOwnerDocument(a).createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML};goog.dom.findNode=function(a,b){var c=[];return goog.dom.findNodes_(a,b,c,!0)?c[0]:void 0};goog.dom.findNodes=function(a,b){var c=[];goog.dom.findNodes_(a,b,c,!1);return c};goog.dom.findNodes_=function(a,b,c,d){if(null!=a)for(a=a.firstChild;a;){if(b(a)&&(c.push(a),d)||goog.dom.findNodes_(a,b,c,d))return!0;a=a.nextSibling}return!1};
goog.dom.TAGS_TO_IGNORE_={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1};goog.dom.PREDEFINED_TAG_VALUES_={IMG:" ",BR:"\n"};goog.dom.isFocusableTabIndex=function(a){return goog.dom.hasSpecifiedTabIndex_(a)&&goog.dom.isTabIndexFocusable_(a)};goog.dom.setFocusableTabIndex=function(a,b){b?a.tabIndex=0:(a.tabIndex=-1,a.removeAttribute("tabIndex"))};
goog.dom.isFocusable=function(a){var b;return(b=goog.dom.nativelySupportsFocus_(a)?!a.disabled&&(!goog.dom.hasSpecifiedTabIndex_(a)||goog.dom.isTabIndexFocusable_(a)):goog.dom.isFocusableTabIndex(a))&&goog.userAgent.IE?goog.dom.hasNonZeroBoundingRect_(a):b};goog.dom.hasSpecifiedTabIndex_=function(a){a=a.getAttributeNode("tabindex");return goog.isDefAndNotNull(a)&&a.specified};goog.dom.isTabIndexFocusable_=function(a){a=a.tabIndex;return goog.isNumber(a)&&0<=a&&32768>a};
goog.dom.nativelySupportsFocus_=function(a){return a.tagName==goog.dom.TagName.A||a.tagName==goog.dom.TagName.INPUT||a.tagName==goog.dom.TagName.TEXTAREA||a.tagName==goog.dom.TagName.SELECT||a.tagName==goog.dom.TagName.BUTTON};goog.dom.hasNonZeroBoundingRect_=function(a){a=goog.isFunction(a.getBoundingClientRect)?a.getBoundingClientRect():{height:a.offsetHeight,width:a.offsetWidth};return goog.isDefAndNotNull(a)&&0<a.height&&0<a.width};
goog.dom.getTextContent=function(a){if(goog.dom.BrowserFeature.CAN_USE_INNER_TEXT&&"innerText"in a)a=goog.string.canonicalizeNewlines(a.innerText);else{var b=[];goog.dom.getTextContent_(a,b,!0);a=b.join("")}a=a.replace(/ \xAD /g," ").replace(/\xAD/g,"");a=a.replace(/\u200B/g,"");goog.dom.BrowserFeature.CAN_USE_INNER_TEXT||(a=a.replace(/ +/g," "));" "!=a&&(a=a.replace(/^\s*/,""));return a};goog.dom.getRawTextContent=function(a){var b=[];goog.dom.getTextContent_(a,b,!1);return b.join("")};
goog.dom.getTextContent_=function(a,b,c){if(!(a.nodeName in goog.dom.TAGS_TO_IGNORE_))if(a.nodeType==goog.dom.NodeType.TEXT)c?b.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):b.push(a.nodeValue);else if(a.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)b.push(goog.dom.PREDEFINED_TAG_VALUES_[a.nodeName]);else for(a=a.firstChild;a;)goog.dom.getTextContent_(a,b,c),a=a.nextSibling};goog.dom.getNodeTextLength=function(a){return goog.dom.getTextContent(a).length};
goog.dom.getNodeTextOffset=function(a,b){for(var c=b||goog.dom.getOwnerDocument(a).body,d=[];a&&a!=c;){for(var e=a;e=e.previousSibling;)d.unshift(goog.dom.getTextContent(e));a=a.parentNode}return goog.string.trimLeft(d.join("")).replace(/ +/g," ").length};
goog.dom.getNodeAtOffset=function(a,b,c){a=[a];for(var d=0,e=null;0<a.length&&d<b;)if(e=a.pop(),!(e.nodeName in goog.dom.TAGS_TO_IGNORE_))if(e.nodeType==goog.dom.NodeType.TEXT)var f=e.nodeValue.replace(/(\r\n|\r|\n)/g,"").replace(/ +/g," "),d=d+f.length;else if(e.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)d+=goog.dom.PREDEFINED_TAG_VALUES_[e.nodeName].length;else for(f=e.childNodes.length-1;0<=f;f--)a.push(e.childNodes[f]);goog.isObject(c)&&(c.remainder=e?e.nodeValue.length+b-d-1:0,c.node=e);return e};
goog.dom.isNodeList=function(a){if(a&&"number"==typeof a.length){if(goog.isObject(a))return"function"==typeof a.item||"string"==typeof a.item;if(goog.isFunction(a))return"function"==typeof a.item}return!1};goog.dom.getAncestorByTagNameAndClass=function(a,b,c){if(!b&&!c)return null;var d=b?b.toUpperCase():null;return goog.dom.getAncestor(a,function(a){return(!d||a.nodeName==d)&&(!c||goog.dom.classes.has(a,c))},!0)};
goog.dom.getAncestorByClass=function(a,b){return goog.dom.getAncestorByTagNameAndClass(a,null,b)};goog.dom.getAncestor=function(a,b,c,d){c||(a=a.parentNode);c=null==d;for(var e=0;a&&(c||e<=d);){if(b(a))return a;a=a.parentNode;e++}return null};goog.dom.getActiveElement=function(a){try{return a&&a.activeElement}catch(b){}return null};
goog.dom.getPixelRatio=goog.functions.cacheReturnValue(function(){var a=goog.dom.getWindow(),b=goog.userAgent.GECKO&&goog.userAgent.MOBILE;return goog.isDef(a.devicePixelRatio)&&!b?a.devicePixelRatio:a.matchMedia?goog.dom.matchesPixelRatio_(0.75)||goog.dom.matchesPixelRatio_(1.5)||goog.dom.matchesPixelRatio_(2)||goog.dom.matchesPixelRatio_(3)||1:1});
goog.dom.matchesPixelRatio_=function(a){return goog.dom.getWindow().matchMedia("(-webkit-min-device-pixel-ratio: "+a+"),(min--moz-device-pixel-ratio: "+a+"),(min-resolution: "+a+"dppx)").matches?a:0};goog.dom.DomHelper=function(a){this.document_=a||goog.global.document||document};goog.dom.DomHelper.prototype.getDomHelper=goog.dom.getDomHelper;goog.dom.DomHelper.prototype.setDocument=function(a){this.document_=a};goog.dom.DomHelper.prototype.getDocument=function(){return this.document_};
goog.dom.DomHelper.prototype.getElement=function(a){return goog.dom.getElementHelper_(this.document_,a)};goog.dom.DomHelper.prototype.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(this.document_,a)};goog.dom.DomHelper.prototype.$=goog.dom.DomHelper.prototype.getElement;goog.dom.DomHelper.prototype.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(this.document_,a,b,c)};
goog.dom.DomHelper.prototype.getElementsByClass=function(a,b){return goog.dom.getElementsByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.getElementByClass=function(a,b){return goog.dom.getElementByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.getRequiredElementByClass=function(a,b){return goog.dom.getRequiredElementByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.$$=goog.dom.DomHelper.prototype.getElementsByTagNameAndClass;
goog.dom.DomHelper.prototype.setProperties=goog.dom.setProperties;goog.dom.DomHelper.prototype.getViewportSize=function(a){return goog.dom.getViewportSize(a||this.getWindow())};goog.dom.DomHelper.prototype.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(this.getWindow())};goog.dom.DomHelper.prototype.createDom=function(a,b,c){return goog.dom.createDom_(this.document_,arguments)};goog.dom.DomHelper.prototype.$dom=goog.dom.DomHelper.prototype.createDom;
goog.dom.DomHelper.prototype.createElement=function(a){return this.document_.createElement(a)};goog.dom.DomHelper.prototype.createTextNode=function(a){return this.document_.createTextNode(String(a))};goog.dom.DomHelper.prototype.createTable=function(a,b,c){return goog.dom.createTable_(this.document_,a,b,!!c)};goog.dom.DomHelper.prototype.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(this.document_,a)};goog.dom.DomHelper.prototype.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(this.document_)};
goog.dom.DomHelper.prototype.getWindow=function(){return goog.dom.getWindow_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(this.document_)};goog.dom.DomHelper.prototype.getActiveElement=function(a){return goog.dom.getActiveElement(a||this.document_)};goog.dom.DomHelper.prototype.appendChild=goog.dom.appendChild;
goog.dom.DomHelper.prototype.append=goog.dom.append;goog.dom.DomHelper.prototype.canHaveChildren=goog.dom.canHaveChildren;goog.dom.DomHelper.prototype.removeChildren=goog.dom.removeChildren;goog.dom.DomHelper.prototype.insertSiblingBefore=goog.dom.insertSiblingBefore;goog.dom.DomHelper.prototype.insertSiblingAfter=goog.dom.insertSiblingAfter;goog.dom.DomHelper.prototype.insertChildAt=goog.dom.insertChildAt;goog.dom.DomHelper.prototype.removeNode=goog.dom.removeNode;
goog.dom.DomHelper.prototype.replaceNode=goog.dom.replaceNode;goog.dom.DomHelper.prototype.flattenElement=goog.dom.flattenElement;goog.dom.DomHelper.prototype.getChildren=goog.dom.getChildren;goog.dom.DomHelper.prototype.getFirstElementChild=goog.dom.getFirstElementChild;goog.dom.DomHelper.prototype.getLastElementChild=goog.dom.getLastElementChild;goog.dom.DomHelper.prototype.getNextElementSibling=goog.dom.getNextElementSibling;goog.dom.DomHelper.prototype.getPreviousElementSibling=goog.dom.getPreviousElementSibling;
goog.dom.DomHelper.prototype.getNextNode=goog.dom.getNextNode;goog.dom.DomHelper.prototype.getPreviousNode=goog.dom.getPreviousNode;goog.dom.DomHelper.prototype.isNodeLike=goog.dom.isNodeLike;goog.dom.DomHelper.prototype.isElement=goog.dom.isElement;goog.dom.DomHelper.prototype.isWindow=goog.dom.isWindow;goog.dom.DomHelper.prototype.getParentElement=goog.dom.getParentElement;goog.dom.DomHelper.prototype.contains=goog.dom.contains;goog.dom.DomHelper.prototype.compareNodeOrder=goog.dom.compareNodeOrder;
goog.dom.DomHelper.prototype.findCommonAncestor=goog.dom.findCommonAncestor;goog.dom.DomHelper.prototype.getOwnerDocument=goog.dom.getOwnerDocument;goog.dom.DomHelper.prototype.getFrameContentDocument=goog.dom.getFrameContentDocument;goog.dom.DomHelper.prototype.getFrameContentWindow=goog.dom.getFrameContentWindow;goog.dom.DomHelper.prototype.setTextContent=goog.dom.setTextContent;goog.dom.DomHelper.prototype.getOuterHtml=goog.dom.getOuterHtml;goog.dom.DomHelper.prototype.findNode=goog.dom.findNode;
goog.dom.DomHelper.prototype.findNodes=goog.dom.findNodes;goog.dom.DomHelper.prototype.isFocusableTabIndex=goog.dom.isFocusableTabIndex;goog.dom.DomHelper.prototype.setFocusableTabIndex=goog.dom.setFocusableTabIndex;goog.dom.DomHelper.prototype.isFocusable=goog.dom.isFocusable;goog.dom.DomHelper.prototype.getTextContent=goog.dom.getTextContent;goog.dom.DomHelper.prototype.getNodeTextLength=goog.dom.getNodeTextLength;goog.dom.DomHelper.prototype.getNodeTextOffset=goog.dom.getNodeTextOffset;
goog.dom.DomHelper.prototype.getNodeAtOffset=goog.dom.getNodeAtOffset;goog.dom.DomHelper.prototype.isNodeList=goog.dom.isNodeList;goog.dom.DomHelper.prototype.getAncestorByTagNameAndClass=goog.dom.getAncestorByTagNameAndClass;goog.dom.DomHelper.prototype.getAncestorByClass=goog.dom.getAncestorByClass;goog.dom.DomHelper.prototype.getAncestor=goog.dom.getAncestor;goog.structs.InversionMap=function(a,b,c){this.rangeArray=null;if(a.length!=b.length)return null;this.storeInversion_(a,c);this.values=b};goog.structs.InversionMap.prototype.storeInversion_=function(a,b){this.rangeArray=a;for(var c=1;c<a.length;c++)null==a[c]?a[c]=a[c-1]+1:b&&(a[c]+=a[c-1])};
goog.structs.InversionMap.prototype.spliceInversion=function(a,b,c){a=new goog.structs.InversionMap(a,b,c);c=a.rangeArray[0];var d=goog.array.peek(a.rangeArray);b=this.getLeast(c);d=this.getLeast(d);c!=this.rangeArray[b]&&b++;c=d-b+1;goog.partial(goog.array.splice,this.rangeArray,b,c).apply(null,a.rangeArray);goog.partial(goog.array.splice,this.values,b,c).apply(null,a.values)};goog.structs.InversionMap.prototype.at=function(a){a=this.getLeast(a);return 0>a?null:this.values[a]};
goog.structs.InversionMap.prototype.getLeast=function(a){for(var b=this.rangeArray,c=0,d=b.length;8<d-c;){var e=d+c>>1;b[e]<=a?c=e:d=e}for(;c<d&&!(a<b[c]);++c);return c-1};goog.i18n={};goog.i18n.GraphemeBreak={};goog.i18n.GraphemeBreak.property={ANY:0,CONTROL:1,EXTEND:2,PREPEND:3,SPACING_MARK:4,INDIC_CONSONANT:5,VIRAMA:6,L:7,V:8,T:9,LV:10,LVT:11,CR:12,LF:13,REGIONAL_INDICATOR:14};goog.i18n.GraphemeBreak.inversions_=null;
goog.i18n.GraphemeBreak.applyLegacyBreakRules_=function(a,b){var c=goog.i18n.GraphemeBreak.property;return a==c.CR&&b==c.LF?!1:a==c.CONTROL||a==c.CR||a==c.LF||b==c.CONTROL||b==c.CR||b==c.LF?!0:a==c.L&&(b==c.L||b==c.V||b==c.LV||b==c.LVT)||!(a!=c.LV&&a!=c.V||b!=c.V&&b!=c.T)||(a==c.LVT||a==c.T)&&b==c.T||b==c.EXTEND||b==c.VIRAMA||a==c.VIRAMA&&b==c.INDIC_CONSONANT?!1:!0};
goog.i18n.GraphemeBreak.getBreakProp_=function(a){if(44032<=a&&55203>=a){var b=goog.i18n.GraphemeBreak.property;return 16==a%28?b.LV:b.LVT}goog.i18n.GraphemeBreak.inversions_||(goog.i18n.GraphemeBreak.inversions_=new goog.structs.InversionMap([0,10,1,2,1,18,95,33,13,1,594,112,275,7,263,45,1,1,1,2,1,2,1,1,56,5,11,11,48,21,16,1,101,7,1,1,6,2,2,1,4,33,1,1,1,30,27,91,11,58,9,34,4,1,9,1,3,1,5,43,3,136,31,1,17,37,1,1,1,1,3,8,4,1,2,1,7,8,2,2,21,8,1,2,17,39,1,1,1,2,6,6,1,9,5,4,2,2,12,2,15,2,1,17,39,2,3,12,
4,8,6,17,2,3,14,1,17,39,1,1,3,8,4,1,20,2,29,1,2,17,39,1,1,2,1,6,6,9,6,4,2,2,13,1,16,1,18,41,1,1,1,12,1,9,1,41,3,17,37,4,3,5,7,8,3,2,8,2,30,2,17,39,1,1,1,1,2,1,3,1,5,1,8,9,1,3,2,30,2,17,38,3,1,2,5,7,1,9,1,10,2,30,2,22,48,5,1,2,6,7,19,2,13,46,2,1,1,1,6,1,12,8,50,46,2,1,1,1,9,11,6,14,2,58,2,27,1,1,1,1,1,4,2,49,14,1,4,1,1,2,5,48,9,1,57,33,12,4,1,6,1,2,2,2,1,16,2,4,2,2,4,3,1,3,2,7,3,4,13,1,1,1,2,6,1,1,14,1,98,96,72,88,349,3,931,15,2,1,14,15,2,1,14,15,2,15,15,14,35,17,2,1,7,8,1,2,9,1,1,9,1,45,3,155,1,87,
31,3,4,2,9,1,6,3,20,19,29,44,9,3,2,1,69,23,2,3,4,45,6,2,1,1,1,8,1,1,1,2,8,6,13,128,4,1,14,33,1,1,5,1,1,5,1,1,1,7,31,9,12,2,1,7,23,1,4,2,2,2,2,2,11,3,2,36,2,1,1,2,3,1,1,3,2,12,36,8,8,2,2,21,3,128,3,1,13,1,7,4,1,4,2,1,203,64,523,1,2,2,24,7,49,16,96,33,3070,3,141,1,96,32,554,6,105,2,30164,4,1,10,33,1,80,2,272,1,3,1,4,1,23,2,2,1,24,30,4,4,3,8,1,1,13,2,16,34,16,1,27,18,24,24,4,8,2,23,11,1,1,12,32,3,1,5,3,3,36,1,2,4,2,1,3,1,69,35,6,2,2,2,2,12,1,8,1,1,18,16,1,3,6,1,5,48,1,1,3,2,2,5,2,1,1,32,9,1,2,2,5,1,
1,201,14,2,1,1,9,8,2,1,2,1,2,1,1,1,18,11184,27,49,1028,1024,6942,1,737,16,16,7,216,1,158,2,89,3,513,1,2051,15,40,7,1,1472,1,1,1,53,14,1,57,2,1,45,3,4,2,1,1,2,1,66,3,36,5,1,6,2,75,2,1,48,3,9,1,1,1258,1,1,1,2,6,1,1,22681,62,4,25042,1,1,3,3,1,5,8,8,2,7,30,4,148,3,8097,26,790017,255],[1,13,1,12,1,0,1,0,1,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,1,0,2,0,2,0,2,0,2,1,0,2,0,2,0,2,0,1,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,4,0,5,2,4,2,0,4,2,4,6,4,0,2,5,0,2,0,5,2,4,0,5,2,0,2,4,2,4,6,0,2,5,0,2,0,5,0,2,4,0,5,2,4,2,6,2,
5,0,2,0,2,4,0,5,2,0,4,2,4,6,0,2,0,2,4,0,5,2,0,2,4,2,4,6,2,5,0,2,0,5,0,2,0,5,2,4,2,4,6,0,2,0,4,0,5,0,2,4,2,6,2,5,0,2,0,4,0,5,2,0,4,2,4,2,4,2,4,2,6,2,5,0,2,0,4,0,5,0,2,4,2,4,6,0,2,0,2,0,4,0,5,6,2,4,2,4,2,4,0,5,0,2,0,4,2,6,0,2,0,5,0,2,0,4,2,0,2,0,5,0,2,0,2,0,2,0,2,0,4,5,2,4,2,6,0,2,0,2,0,2,0,5,0,2,4,2,0,6,4,2,5,0,5,0,4,2,5,2,5,0,5,0,5,2,5,2,0,4,2,0,2,5,0,2,0,7,8,9,0,2,0,5,2,6,0,5,2,6,0,5,2,0,5,2,5,0,2,4,2,4,2,4,2,6,2,0,2,0,2,0,2,0,5,2,4,2,4,2,4,2,0,5,0,5,0,4,0,4,0,5,2,4,0,5,0,5,4,2,4,2,6,0,2,0,2,4,2,
0,2,4,0,5,2,4,2,4,2,4,2,4,6,5,0,2,0,2,4,0,5,4,2,4,2,6,4,5,0,5,0,5,0,2,4,2,4,2,4,2,6,0,5,4,2,4,2,0,5,0,2,0,2,4,2,0,2,0,4,2,0,2,0,1,2,1,0,1,0,1,0,2,0,2,0,6,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,6,5,2,5,4,2,4,0,5,0,5,0,5,0,5,0,4,0,5,4,6,0,2,0,5,0,2,0,5,2,4,6,0,7,2,4,0,5,0,5,2,4,2,4,2,4,6,0,5,2,4,2,4,2,0,2,0,2,4,0,5,0,5,0,5,0,5,2,0,2,0,2,0,2,0,2,0,5,4,2,4,0,4,6,0,5,0,5,0,5,0,4,2,4,2,4,0,4,6,0,11,8,9,0,2,0,2,0,2,0,2,0,1,0,2,0,1,0,2,0,2,0,2,6,0,4,2,4,0,2,6,0,2,4,0,4,2,4,6,2,0,1,0,2,0,2,4,2,6,0,2,4,0,4,2,4,
6,0,2,4,2,4,2,6,2,0,4,2,0,2,4,2,0,4,2,1,2,0,2,0,2,0,2,0,14,0,1,2],!0));return goog.i18n.GraphemeBreak.inversions_.at(a)};goog.i18n.GraphemeBreak.hasGraphemeBreak=function(a,b,c){a=goog.i18n.GraphemeBreak.getBreakProp_(a);b=goog.i18n.GraphemeBreak.getBreakProp_(b);var d=goog.i18n.GraphemeBreak.property;return goog.i18n.GraphemeBreak.applyLegacyBreakRules_(a,b)&&!(c&&(a==d.PREPEND||b==d.SPACING_MARK))};goog.format={};goog.format.fileSize=function(a,b){return goog.format.numBytesToString(a,b,!1)};goog.format.isConvertableScaledNumber=function(a){return goog.format.SCALED_NUMERIC_RE_.test(a)};goog.format.stringToNumericValue=function(a){return goog.string.endsWith(a,"B")?goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_BINARY_):goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_SI_)};goog.format.stringToNumBytes=function(a){return goog.format.stringToNumericValue_(a,goog.format.NUMERIC_SCALES_BINARY_)};
goog.format.numericValueToString=function(a,b){return goog.format.numericValueToString_(a,goog.format.NUMERIC_SCALES_SI_,b)};goog.format.numBytesToString=function(a,b,c,d){var e="";if(!goog.isDef(c)||c)e="B";return goog.format.numericValueToString_(a,goog.format.NUMERIC_SCALES_BINARY_,b,e,d)};goog.format.stringToNumericValue_=function(a,b){var c=a.match(goog.format.SCALED_NUMERIC_RE_);return c?c[1]*b[c[2]]:NaN};
goog.format.numericValueToString_=function(a,b,c,d,e){var f=goog.format.NUMERIC_SCALE_PREFIXES_,g=a,h="",k="",l=1;0>a&&(a=-a);for(var m=0;m<f.length;m++){var n=f[m],l=b[n];if(a>=l||1>=l&&a>0.1*l){h=n;break}}h?(d&&(h+=d),e&&(k=" ")):l=1;a=Math.pow(10,goog.isDef(c)?c:2);return Math.round(g/l*a)/a+k+h};goog.format.SCALED_NUMERIC_RE_=/^([-]?\d+\.?\d*)([K,M,G,T,P,k,m,u,n]?)[B]?$/;goog.format.NUMERIC_SCALE_PREFIXES_="P T G M K  m u n".split(" ");
goog.format.NUMERIC_SCALES_SI_={"":1,n:1E-9,u:1E-6,m:0.001,k:1E3,K:1E3,M:1E6,G:1E9,T:1E12,P:1E15};goog.format.NUMERIC_SCALES_BINARY_={"":1,n:Math.pow(1024,-3),u:Math.pow(1024,-2),m:1/1024,k:1024,K:1024,M:Math.pow(1024,2),G:Math.pow(1024,3),T:Math.pow(1024,4),P:Math.pow(1024,5)};goog.format.FIRST_GRAPHEME_EXTEND_=768;
goog.format.isTreatedAsBreakingSpace_=function(a){return a<=goog.format.WbrToken_.SPACE||4096<=a&&(8192<=a&&8198>=a||8200<=a&&8203>=a||5760==a||6158==a||8232==a||8233==a||8287==a||12288==a)};goog.format.isInvisibleFormattingCharacter_=function(a){return 8204<=a&&8207>=a||8234<=a&&8238>=a};
goog.format.insertWordBreaksGeneric_=function(a,b,c){c=c||10;if(c>a.length)return a;for(var d=[],e=0,f=0,g=0,h=0,k=0;k<a.length;k++){var l=h,h=a.charCodeAt(k),l=h>=goog.format.FIRST_GRAPHEME_EXTEND_&&!b(l,h,!0);e>=c&&!goog.format.isTreatedAsBreakingSpace_(h)&&!l&&(d.push(a.substring(g,k),goog.format.WORD_BREAK_HTML),g=k,e=0);f?h==goog.format.WbrToken_.GT&&f==goog.format.WbrToken_.LT?f=0:h==goog.format.WbrToken_.SEMI_COLON&&f==goog.format.WbrToken_.AMP&&(f=0,e++):h==goog.format.WbrToken_.LT||h==goog.format.WbrToken_.AMP?
f=h:goog.format.isTreatedAsBreakingSpace_(h)?e=0:goog.format.isInvisibleFormattingCharacter_(h)||e++}d.push(a.substr(g));return d.join("")};goog.format.insertWordBreaks=function(a,b){return goog.format.insertWordBreaksGeneric_(a,goog.i18n.GraphemeBreak.hasGraphemeBreak,b)};goog.format.conservativelyHasGraphemeBreak_=function(a,b,c){return 1024<=b&&1315>b};goog.format.insertWordBreaksBasic=function(a,b){return goog.format.insertWordBreaksGeneric_(a,goog.format.conservativelyHasGraphemeBreak_,b)};
goog.format.IS_IE8_OR_ABOVE_=goog.userAgent.IE&&goog.userAgent.isVersionOrHigher(8);goog.format.WORD_BREAK_HTML=goog.userAgent.WEBKIT?"<wbr></wbr>":goog.userAgent.OPERA?"&shy;":goog.format.IS_IE8_OR_ABOVE_?"&#8203;":"<wbr>";goog.format.WbrToken_={LT:60,GT:62,AMP:38,SEMI_COLON:59,SPACE:32};goog.i18n.bidi={};goog.i18n.bidi.FORCE_RTL=!1;goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||("ar"==goog.LOCALE.substring(0,2).toLowerCase()||"fa"==goog.LOCALE.substring(0,2).toLowerCase()||"he"==goog.LOCALE.substring(0,2).toLowerCase()||"iw"==goog.LOCALE.substring(0,2).toLowerCase()||"ur"==goog.LOCALE.substring(0,2).toLowerCase()||"yi"==goog.LOCALE.substring(0,2).toLowerCase())&&(2==goog.LOCALE.length||"-"==goog.LOCALE.substring(2,3)||"_"==goog.LOCALE.substring(2,3));
goog.i18n.bidi.Format={LRE:"\u202a",RLE:"\u202b",PDF:"\u202c",LRM:"\u200e",RLM:"\u200f"};goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0,UNKNOWN:0};goog.i18n.bidi.RIGHT="right";goog.i18n.bidi.LEFT="left";goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT;goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT;
goog.i18n.bidi.toDir=function(a,b){return"number"==typeof a?0<a?goog.i18n.bidi.Dir.LTR:0>a?goog.i18n.bidi.Dir.RTL:b?null:goog.i18n.bidi.Dir.NEUTRAL:null==a?null:a?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};goog.i18n.bidi.ltrChars_="A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u200e\u2c00-\ufb1c\ufe00-\ufe6f\ufefd-\uffff";goog.i18n.bidi.rtlChars_="\u0591-\u07ff\u200f\ufb1d-\ufdff\ufe70-\ufefc";goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g;
goog.i18n.bidi.stripHtmlIfNeeded_=function(a,b){return b?a.replace(goog.i18n.bidi.htmlSkipReg_,""):a};goog.i18n.bidi.rtlCharReg_=RegExp("["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.ltrCharReg_=RegExp("["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.hasAnyRtl=function(a,b){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl;
goog.i18n.bidi.hasAnyLtr=function(a,b){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.ltrRe_=RegExp("^["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlRe_=RegExp("^["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.isRtlChar=function(a){return goog.i18n.bidi.rtlRe_.test(a)};goog.i18n.bidi.isLtrChar=function(a){return goog.i18n.bidi.ltrRe_.test(a)};goog.i18n.bidi.isNeutralChar=function(a){return!goog.i18n.bidi.isLtrChar(a)&&!goog.i18n.bidi.isRtlChar(a)};
goog.i18n.bidi.ltrDirCheckRe_=RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlDirCheckRe_=RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.startsWithRtl=function(a,b){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl;
goog.i18n.bidi.startsWithLtr=function(a,b){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr;goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/;goog.i18n.bidi.isNeutralText=function(a,b){a=goog.i18n.bidi.stripHtmlIfNeeded_(a,b);return goog.i18n.bidi.isRequiredLtrRe_.test(a)||!goog.i18n.bidi.hasAnyLtr(a)&&!goog.i18n.bidi.hasAnyRtl(a)};
goog.i18n.bidi.ltrExitDirCheckRe_=RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$");goog.i18n.bidi.rtlExitDirCheckRe_=RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$");goog.i18n.bidi.endsWithLtr=function(a,b){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr;
goog.i18n.bidi.endsWithRtl=function(a,b){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl;goog.i18n.bidi.rtlLocalesRe_=RegExp("^(ar|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Arab|Hebr|Thaa|Nkoo|Tfng))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)","i");goog.i18n.bidi.isRtlLanguage=function(a){return goog.i18n.bidi.rtlLocalesRe_.test(a)};goog.i18n.bidi.bracketGuardHtmlRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(&lt;.*?(&gt;)+)/g;
goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g;goog.i18n.bidi.guardBracketInHtml=function(a,b){return(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=rtl>$&</span>"):a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=ltr>$&</span>")};
goog.i18n.bidi.guardBracketInText=function(a,b){var c=(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM;return a.replace(goog.i18n.bidi.bracketGuardTextRe_,c+"$&"+c)};goog.i18n.bidi.enforceRtlInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=rtl"):"\n<span dir=rtl>"+a+"</span>"};goog.i18n.bidi.enforceRtlInText=function(a){return goog.i18n.bidi.Format.RLE+a+goog.i18n.bidi.Format.PDF};
goog.i18n.bidi.enforceLtrInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=ltr"):"\n<span dir=ltr>"+a+"</span>"};goog.i18n.bidi.enforceLtrInText=function(a){return goog.i18n.bidi.Format.LRE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g;goog.i18n.bidi.leftRe_=/left/gi;goog.i18n.bidi.rightRe_=/right/gi;goog.i18n.bidi.tempRe_=/%%%%/g;
goog.i18n.bidi.mirrorCSS=function(a){return a.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)};goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g;goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g;
goog.i18n.bidi.normalizeHebrewQuote=function(a){return a.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1\u05f4").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1\u05f3")};goog.i18n.bidi.wordSeparatorRe_=/\s+/;goog.i18n.bidi.hasNumeralsRe_=/\d/;goog.i18n.bidi.rtlDetectionThreshold_=0.4;
goog.i18n.bidi.estimateDirection=function(a,b){for(var c=0,d=0,e=!1,f=goog.i18n.bidi.stripHtmlIfNeeded_(a,b).split(goog.i18n.bidi.wordSeparatorRe_),g=0;g<f.length;g++){var h=f[g];goog.i18n.bidi.startsWithRtl(h)?(c++,d++):goog.i18n.bidi.isRequiredLtrRe_.test(h)?e=!0:goog.i18n.bidi.hasAnyLtr(h)?d++:goog.i18n.bidi.hasNumeralsRe_.test(h)&&(e=!0)}return 0==d?e?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL:c/d>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};
goog.i18n.bidi.detectRtlDirectionality=function(a,b){return goog.i18n.bidi.estimateDirection(a,b)==goog.i18n.bidi.Dir.RTL};goog.i18n.bidi.setElementDirAndAlign=function(a,b){a&&(b=goog.i18n.bidi.toDir(b))&&(a.style.textAlign=b==goog.i18n.bidi.Dir.RTL?"right":"left",a.dir=b==goog.i18n.bidi.Dir.RTL?"rtl":"ltr")};goog.i18n.bidi.DirectionalString=function(){};goog.i18n.BidiFormatter=function(a,b){this.contextDir_=goog.i18n.bidi.toDir(a,!0);this.alwaysSpan_=!!b};goog.i18n.BidiFormatter.prototype.getContextDir=function(){return this.contextDir_};goog.i18n.BidiFormatter.prototype.getAlwaysSpan=function(){return this.alwaysSpan_};goog.i18n.BidiFormatter.prototype.setContextDir=function(a){this.contextDir_=goog.i18n.bidi.toDir(a,!0)};goog.i18n.BidiFormatter.prototype.setAlwaysSpan=function(a){this.alwaysSpan_=a};
goog.i18n.BidiFormatter.prototype.estimateDirection=goog.i18n.bidi.estimateDirection;goog.i18n.BidiFormatter.prototype.areDirectionalitiesOpposite_=function(a,b){return 0>a*b};
goog.i18n.BidiFormatter.prototype.dirResetIfNeeded_=function(a,b,c,d){return d&&(this.areDirectionalitiesOpposite_(b,this.contextDir_)||this.contextDir_==goog.i18n.bidi.Dir.LTR&&goog.i18n.bidi.endsWithRtl(a,c)||this.contextDir_==goog.i18n.bidi.Dir.RTL&&goog.i18n.bidi.endsWithLtr(a,c))?this.contextDir_==goog.i18n.bidi.Dir.LTR?goog.i18n.bidi.Format.LRM:goog.i18n.bidi.Format.RLM:""};goog.i18n.BidiFormatter.prototype.dirAttrValue=function(a,b){return this.knownDirAttrValue(this.estimateDirection(a,b))};
goog.i18n.BidiFormatter.prototype.knownDirAttrValue=function(a){return(a==goog.i18n.bidi.Dir.NEUTRAL?this.contextDir_:a)==goog.i18n.bidi.Dir.RTL?"rtl":"ltr"};goog.i18n.BidiFormatter.prototype.dirAttr=function(a,b){return this.knownDirAttr(this.estimateDirection(a,b))};goog.i18n.BidiFormatter.prototype.knownDirAttr=function(a){return a!=this.contextDir_?a==goog.i18n.bidi.Dir.RTL?'dir="rtl"':a==goog.i18n.bidi.Dir.LTR?'dir="ltr"':"":""};
goog.i18n.BidiFormatter.prototype.spanWrap=function(a,b,c){return this.spanWrapWithKnownDir(null,a,b,c)};goog.i18n.BidiFormatter.prototype.spanWrapWithKnownDir=function(a,b,c,d){null==a&&(a=this.estimateDirection(b,c));return this.spanWrapWithKnownDir_(a,b,c,d)};
goog.i18n.BidiFormatter.prototype.spanWrapWithKnownDir_=function(a,b,c,d){d=d||void 0==d;c||(b=goog.string.htmlEscape(b));c=[];var e=a!=goog.i18n.bidi.Dir.NEUTRAL&&a!=this.contextDir_;this.alwaysSpan_||e?(c.push("<span"),e&&c.push(a==goog.i18n.bidi.Dir.RTL?' dir="rtl"':' dir="ltr"'),c.push(">"+b+"</span>")):c.push(b);c.push(this.dirResetIfNeeded_(b,a,!0,d));return c.join("")};goog.i18n.BidiFormatter.prototype.unicodeWrap=function(a,b,c){return this.unicodeWrapWithKnownDir(null,a,b,c)};
goog.i18n.BidiFormatter.prototype.unicodeWrapWithKnownDir=function(a,b,c,d){null==a&&(a=this.estimateDirection(b,c));return this.unicodeWrapWithKnownDir_(a,b,c,d)};goog.i18n.BidiFormatter.prototype.unicodeWrapWithKnownDir_=function(a,b,c,d){d=d||void 0==d;var e=[];a!=goog.i18n.bidi.Dir.NEUTRAL&&a!=this.contextDir_?(e.push(a==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.Format.RLE:goog.i18n.bidi.Format.LRE),e.push(b),e.push(goog.i18n.bidi.Format.PDF)):e.push(b);e.push(this.dirResetIfNeeded_(b,a,c,d));return e.join("")};
goog.i18n.BidiFormatter.prototype.markAfter=function(a,b){return this.markAfterKnownDir(null,a,b)};goog.i18n.BidiFormatter.prototype.markAfterKnownDir=function(a,b,c){null==a&&(a=this.estimateDirection(b,c));return this.dirResetIfNeeded_(b,a,c,!0)};goog.i18n.BidiFormatter.prototype.mark=function(){switch(this.contextDir_){case goog.i18n.bidi.Dir.LTR:return goog.i18n.bidi.Format.LRM;case goog.i18n.bidi.Dir.RTL:return goog.i18n.bidi.Format.RLM;default:return""}};
goog.i18n.BidiFormatter.prototype.startEdge=function(){return this.contextDir_==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT};goog.i18n.BidiFormatter.prototype.endEdge=function(){return this.contextDir_==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT};goog.soy={};goog.soy.data={};goog.soy.data.SanitizedContentKind={HTML:goog.DEBUG?{sanitizedContentKindHtml:!0}:{},JS:goog.DEBUG?{sanitizedContentJsStrChars:!0}:{},JS_STR_CHARS:goog.DEBUG?{sanitizedContentJsStrChars:!0}:{},URI:goog.DEBUG?{sanitizedContentUri:!0}:{},ATTRIBUTES:goog.DEBUG?{sanitizedContentHtmlAttribute:!0}:{},CSS:goog.DEBUG?{sanitizedContentCss:!0}:{},TEXT:goog.DEBUG?{sanitizedContentKindText:!0}:{}};
goog.soy.data.SanitizedContent=function(){throw Error("Do not instantiate directly");};goog.soy.data.SanitizedContent.prototype.contentDir=null;goog.soy.data.SanitizedContent.prototype.toString=function(){return this.content};goog.soy.REQUIRE_STRICT_AUTOESCAPE=!1;goog.soy.renderElement=function(a,b,c,d){a.innerHTML=goog.soy.ensureTemplateOutputHtml_(b(c||goog.soy.defaultTemplateData_,void 0,d))};goog.soy.renderAsFragment=function(a,b,c,d){d=d||goog.dom.getDomHelper();a=goog.soy.ensureTemplateOutputHtml_(a(b||goog.soy.defaultTemplateData_,void 0,c));goog.soy.assertFirstTagValid_(a);return d.htmlToDocumentFragment(a)};
goog.soy.renderAsElement=function(a,b,c,d){d=(d||goog.dom.getDomHelper()).createElement(goog.dom.TagName.DIV);a=goog.soy.ensureTemplateOutputHtml_(a(b||goog.soy.defaultTemplateData_,void 0,c));goog.soy.assertFirstTagValid_(a);d.innerHTML=a;return 1==d.childNodes.length&&(a=d.firstChild,a.nodeType==goog.dom.NodeType.ELEMENT)?a:d};
goog.soy.ensureTemplateOutputHtml_=function(a){if(!goog.soy.REQUIRE_STRICT_AUTOESCAPE&&!goog.isObject(a))return String(a);if(a instanceof goog.soy.data.SanitizedContent){var b=goog.soy.data.SanitizedContentKind;if(a.contentKind===b.HTML)return goog.asserts.assertString(a.content);if(a.contentKind===b.TEXT)return goog.string.htmlEscape(a.content)}goog.asserts.fail("Soy template output is unsafe for use as HTML: "+a);return"zSoyz"};
goog.soy.assertFirstTagValid_=function(a){if(goog.asserts.ENABLE_ASSERTS){var b=a.match(goog.soy.INVALID_TAG_TO_RENDER_);goog.asserts.assert(!b,"This template starts with a %s, which cannot be a child of a <div>, as required by soy internals. Consider using goog.soy.renderElement instead.\nTemplate output: %s",b&&b[0],a)}};goog.soy.INVALID_TAG_TO_RENDER_=/^<(body|caption|col|colgroup|head|html|tr|td|tbody|thead|tfoot)>/i;goog.soy.defaultTemplateData_={};goog.string.StringBuffer=function(a,b){null!=a&&this.append.apply(this,arguments)};goog.string.StringBuffer.prototype.buffer_="";goog.string.StringBuffer.prototype.set=function(a){this.buffer_=""+a};goog.string.StringBuffer.prototype.append=function(a,b,c){this.buffer_+=a;if(null!=b)for(var d=1;d<arguments.length;d++)this.buffer_+=arguments[d];return this};goog.string.StringBuffer.prototype.clear=function(){this.buffer_=""};goog.string.StringBuffer.prototype.getLength=function(){return this.buffer_.length};
goog.string.StringBuffer.prototype.toString=function(){return this.buffer_};var soy={esc:{}},soydata={};soy.StringBuilder=goog.string.StringBuffer;soydata.SanitizedContentKind={HTML:0,JS_STR_CHARS:1,URI:2,HTML_ATTRIBUTE:3};soydata.SanitizedContent=function(a){this.content=a};soydata.SanitizedContent.prototype.toString=function(){return this.content};soydata.SanitizedHtml=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedHtml,soydata.SanitizedContent);soydata.SanitizedHtml.prototype.contentKind=soydata.SanitizedContentKind.HTML;
soydata.SanitizedJsStrChars=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedJsStrChars,soydata.SanitizedContent);soydata.SanitizedJsStrChars.prototype.contentKind=soydata.SanitizedContentKind.JS_STR_CHARS;soydata.SanitizedUri=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedUri,soydata.SanitizedContent);soydata.SanitizedUri.prototype.contentKind=soydata.SanitizedContentKind.URI;
soydata.SanitizedHtmlAttribute=function(a){soydata.SanitizedContent.call(this,a)};goog.inherits(soydata.SanitizedHtmlAttribute,soydata.SanitizedContent);soydata.SanitizedHtmlAttribute.prototype.contentKind=soydata.SanitizedContentKind.HTML_ATTRIBUTE;soy.renderElement=goog.soy.renderElement;soy.renderAsFragment=function(a,b,c,d){return goog.soy.renderAsFragment(a,b,d,new goog.dom.DomHelper(c))};soy.renderAsElement=function(a,b,c,d){return goog.soy.renderAsElement(a,b,d,new goog.dom.DomHelper(c))};
soy.$$augmentData=function(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];return d};soy.$$getMapKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};soy.$$getDelegateId=function(a){return a};soy.$$DELEGATE_REGISTRY_PRIORITIES_={};soy.$$DELEGATE_REGISTRY_FUNCTIONS_={};
soy.$$registerDelegateFn=function(a,b,c){var d="key_"+a,e=soy.$$DELEGATE_REGISTRY_PRIORITIES_[d];if(void 0===e||b>e)soy.$$DELEGATE_REGISTRY_PRIORITIES_[d]=b,soy.$$DELEGATE_REGISTRY_FUNCTIONS_[d]=c;else if(b==e)throw Error('Encountered two active delegates with same priority (id/name "'+a+'").');};soy.$$getDelegateFn=function(a){return(a=soy.$$DELEGATE_REGISTRY_FUNCTIONS_["key_"+a])?a:soy.$$EMPTY_TEMPLATE_FN_};soy.$$EMPTY_TEMPLATE_FN_=function(a,b,c){return""};
soy.$$escapeHtml=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?a.content:soy.esc.$$escapeHtmlHelper(a)};soy.$$escapeHtmlRcdata=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?soy.esc.$$normalizeHtmlHelper(a.content):soy.esc.$$escapeHtmlHelper(a)};soy.$$stripHtmlTags=function(a){return String(a).replace(soy.esc.$$HTML_TAG_REGEX_,"")};
soy.$$escapeHtmlAttribute=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?soy.esc.$$normalizeHtmlHelper(soy.$$stripHtmlTags(a.content)):soy.esc.$$escapeHtmlHelper(a)};soy.$$escapeHtmlAttributeNospace=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML?soy.esc.$$normalizeHtmlNospaceHelper(soy.$$stripHtmlTags(a.content)):soy.esc.$$escapeHtmlNospaceHelper(a)};
soy.$$filterHtmlAttribute=function(a){return"object"===typeof a&&a&&a.contentKind===soydata.SanitizedContentKind.HTML_ATTRIBUTE?a.content.replace(/=([^"']*)$/,'="$1"'):soy.esc.$$filterHtmlAttributeHelper(a)};soy.$$filterHtmlElementName=function(a){return soy.esc.$$filterHtmlElementNameHelper(a)};soy.$$escapeJs=function(a){return soy.$$escapeJsString(a)};soy.$$escapeJsString=function(a){return"object"===typeof a&&a.contentKind===soydata.SanitizedContentKind.JS_STR_CHARS?a.content:soy.esc.$$escapeJsStringHelper(a)};
soy.$$escapeJsValue=function(a){if(null==a)return" null ";switch(typeof a){case "boolean":case "number":return" "+a+" ";default:return"'"+soy.esc.$$escapeJsStringHelper(String(a))+"'"}};soy.$$escapeJsRegex=function(a){return soy.esc.$$escapeJsRegexHelper(a)};soy.$$problematicUriMarks_=/['()]/g;soy.$$pctEncode_=function(a){return"%"+a.charCodeAt(0).toString(16)};
soy.$$escapeUri=function(a){if("object"===typeof a&&a.contentKind===soydata.SanitizedContentKind.URI)return soy.$$normalizeUri(a);a=soy.esc.$$escapeUriHelper(a);soy.$$problematicUriMarks_.lastIndex=0;return soy.$$problematicUriMarks_.test(a)?a.replace(soy.$$problematicUriMarks_,soy.$$pctEncode_):a};soy.$$normalizeUri=function(a){return soy.esc.$$normalizeUriHelper(a)};soy.$$filterNormalizeUri=function(a){return soy.esc.$$filterNormalizeUriHelper(a)};soy.$$escapeCssString=function(a){return soy.esc.$$escapeCssStringHelper(a)};
soy.$$filterCssValue=function(a){return null==a?"":soy.esc.$$filterCssValueHelper(a)};soy.$$changeNewlineToBr=function(a){return goog.string.newLineToBr(String(a),!1)};soy.$$insertWordBreaks=function(a,b){return goog.format.insertWordBreaks(String(a),b)};soy.$$truncate=function(a,b,c){a=String(a);if(a.length<=b)return a;c&&(3<b?b-=3:c=!1);soy.$$isHighSurrogate_(a.charAt(b-1))&&soy.$$isLowSurrogate_(a.charAt(b))&&(b-=1);a=a.substring(0,b);c&&(a+="...");return a};
soy.$$isHighSurrogate_=function(a){return 55296<=a&&56319>=a};soy.$$isLowSurrogate_=function(a){return 56320<=a&&57343>=a};soy.$$bidiFormatterCache_={};soy.$$getBidiFormatterInstance_=function(a){return soy.$$bidiFormatterCache_[a]||(soy.$$bidiFormatterCache_[a]=new goog.i18n.BidiFormatter(a))};soy.$$bidiTextDir=function(a,b){return a?goog.i18n.bidi.detectRtlDirectionality(a,b)?-1:1:0};
soy.$$bidiDirAttr=function(a,b,c){return new soydata.SanitizedHtmlAttribute(soy.$$getBidiFormatterInstance_(a).dirAttr(b,c))};soy.$$bidiMarkAfter=function(a,b,c){return soy.$$getBidiFormatterInstance_(a).markAfter(b,c)};soy.$$bidiSpanWrap=function(a,b){return soy.$$getBidiFormatterInstance_(a).spanWrap(b+"",!0)};soy.$$bidiUnicodeWrap=function(a,b){return soy.$$getBidiFormatterInstance_(a).unicodeWrap(b+"",!0)};soy.esc.$$escapeUriHelper=function(a){return goog.string.urlEncode(String(a))};
soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_={"\x00":"&#0;",'"':"&quot;","&":"&amp;","'":"&#39;","<":"&lt;",">":"&gt;","\t":"&#9;","\n":"&#10;","\x0B":"&#11;","\f":"&#12;","\r":"&#13;"," ":"&#32;","-":"&#45;","/":"&#47;","=":"&#61;","`":"&#96;","\u0085":"&#133;","\u00a0":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};
soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_[a]};
soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_={"\x00":"\\x00","\b":"\\x08","\t":"\\t","\n":"\\n","\x0B":"\\x0b","\f":"\\f","\r":"\\r",'"':"\\x22","&":"\\x26","'":"\\x27","/":"\\/","<":"\\x3c","=":"\\x3d",">":"\\x3e","\\":"\\\\","\u0085":"\\x85","\u2028":"\\u2028","\u2029":"\\u2029",$:"\\x24","(":"\\x28",")":"\\x29","*":"\\x2a","+":"\\x2b",",":"\\x2c","-":"\\x2d",".":"\\x2e",":":"\\x3a","?":"\\x3f","[":"\\x5b","]":"\\x5d","^":"\\x5e","{":"\\x7b","|":"\\x7c","}":"\\x7d"};
soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_[a]};
soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_={"\x00":"\\0 ","\b":"\\8 ","\t":"\\9 ","\n":"\\a ","\x0B":"\\b ","\f":"\\c ","\r":"\\d ",'"':"\\22 ","&":"\\26 ","'":"\\27 ","(":"\\28 ",")":"\\29 ","*":"\\2a ","/":"\\2f ",":":"\\3a ",";":"\\3b ","<":"\\3c ","=":"\\3d ",">":"\\3e ","@":"\\40 ","\\":"\\5c ","{":"\\7b ","}":"\\7d ","\u0085":"\\85 ","\u00a0":"\\a0 ","\u2028":"\\2028 ","\u2029":"\\2029 "};soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_ESCAPE_CSS_STRING_[a]};
soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_={"\x00":"%00","\u0001":"%01","\u0002":"%02","\u0003":"%03","\u0004":"%04","\u0005":"%05","\u0006":"%06","\u0007":"%07","\b":"%08","\t":"%09","\n":"%0A","\x0B":"%0B","\f":"%0C","\r":"%0D","\u000e":"%0E","\u000f":"%0F","\u0010":"%10","\u0011":"%11","\u0012":"%12","\u0013":"%13","\u0014":"%14","\u0015":"%15","\u0016":"%16","\u0017":"%17","\u0018":"%18","\u0019":"%19","\u001a":"%1A","\u001b":"%1B","\u001c":"%1C","\u001d":"%1D","\u001e":"%1E",
"\u001f":"%1F"," ":"%20",'"':"%22","'":"%27","(":"%28",")":"%29","<":"%3C",">":"%3E","\\":"%5C","{":"%7B","}":"%7D","\u007f":"%7F","\u0085":"%C2%85","\u00a0":"%C2%A0","\u2028":"%E2%80%A8","\u2029":"%E2%80%A9","\uff01":"%EF%BC%81","\uff03":"%EF%BC%83","\uff04":"%EF%BC%84","\uff06":"%EF%BC%86","\uff07":"%EF%BC%87","\uff08":"%EF%BC%88","\uff09":"%EF%BC%89","\uff0a":"%EF%BC%8A","\uff0b":"%EF%BC%8B","\uff0c":"%EF%BC%8C","\uff0f":"%EF%BC%8F","\uff1a":"%EF%BC%9A","\uff1b":"%EF%BC%9B","\uff1d":"%EF%BC%9D",
"\uff1f":"%EF%BC%9F","\uff20":"%EF%BC%A0","\uff3b":"%EF%BC%BB","\uff3d":"%EF%BC%BD"};soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=function(a){return soy.esc.$$ESCAPE_MAP_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_[a]};soy.esc.$$MATCHER_FOR_ESCAPE_HTML_=/[\x00\x22\x26\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_=/[\x00\x22\x27\x3c\x3e]/g;soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x26\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;
soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_=/[\x00\x09-\x0d \x22\x27\x2d\/\x3c-\x3e`\x85\xa0\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_=/[\x00\x08-\x0d\x22\x26\x27\/\x3c-\x3e\\\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_=/[\x00\x08-\x0d\x22\x24\x26-\/\x3a\x3c-\x3f\x5b-\x5e\x7b-\x7d\x85\u2028\u2029]/g;soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_=/[\x00\x08-\x0d\x22\x26-\x2a\/\x3a-\x3e@\\\x7b\x7d\x85\xa0\u2028\u2029]/g;
soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_=/[\x00- \x22\x27-\x29\x3c\x3e\\\x7b\x7d\x7f\x85\xa0\u2028\u2029\uff01\uff03\uff04\uff06-\uff0c\uff0f\uff1a\uff1b\uff1d\uff1f\uff20\uff3b\uff3d]/g;soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_=/^(?!-*(?:expression|(?:moz-)?binding))(?:[.#]?-?(?:[_a-z0-9-]+)(?:-[_a-z0-9-]+)*-?|-?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[a-z]{1,2}|%)?|!important|)$/i;soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_=/^(?:(?:https?|mailto):|[^&:\/?#]*(?:[\/?#]|$))/i;
soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTE_=/^(?!style|on|action|archive|background|cite|classid|codebase|data|dsync|href|longdesc|src|usemap)(?:[a-z0-9_$:-]*)$/i;soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_=/^(?!script|style|title|textarea|xmp|no)[a-z0-9_$:-]*$/i;soy.esc.$$escapeHtmlHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};
soy.esc.$$normalizeHtmlHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeHtmlNospaceHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};
soy.esc.$$normalizeHtmlNospaceHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_NORMALIZE_HTML_NOSPACE_,soy.esc.$$REPLACER_FOR_ESCAPE_HTML__AND__NORMALIZE_HTML__AND__ESCAPE_HTML_NOSPACE__AND__NORMALIZE_HTML_NOSPACE_)};soy.esc.$$escapeJsStringHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};
soy.esc.$$escapeJsRegexHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_JS_REGEX_,soy.esc.$$REPLACER_FOR_ESCAPE_JS_STRING__AND__ESCAPE_JS_REGEX_)};soy.esc.$$escapeCssStringHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_ESCAPE_CSS_STRING_,soy.esc.$$REPLACER_FOR_ESCAPE_CSS_STRING_)};soy.esc.$$filterCssValueHelper=function(a){a=String(a);return soy.esc.$$FILTER_FOR_FILTER_CSS_VALUE_.test(a)?a:(goog.asserts.fail("Bad value `%s` for |filterCssValue",[a]),"zSoyz")};
soy.esc.$$normalizeUriHelper=function(a){return String(a).replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_)};
soy.esc.$$filterNormalizeUriHelper=function(a){a=String(a);return soy.esc.$$FILTER_FOR_FILTER_NORMALIZE_URI_.test(a)?a.replace(soy.esc.$$MATCHER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_,soy.esc.$$REPLACER_FOR_NORMALIZE_URI__AND__FILTER_NORMALIZE_URI_):(goog.asserts.fail("Bad value `%s` for |filterNormalizeUri",[a]),"zSoyz")};
soy.esc.$$filterHtmlAttributeHelper=function(a){a=String(a);return soy.esc.$$FILTER_FOR_FILTER_HTML_ATTRIBUTE_.test(a)?a:(goog.asserts.fail("Bad value `%s` for |filterHtmlAttribute",[a]),"zSoyz")};soy.esc.$$filterHtmlElementNameHelper=function(a){a=String(a);return soy.esc.$$FILTER_FOR_FILTER_HTML_ELEMENT_NAME_.test(a)?a:(goog.asserts.fail("Bad value `%s` for |filterHtmlElementName",[a]),"zSoyz")};soy.esc.$$HTML_TAG_REGEX_=/<(?:!|\/?[a-zA-Z])(?:[^>'"]|"[^"]*"|'[^']*')*>/g;var templ={ydn:{}};templ.ydn.crm={};templ.ydn.crm.app={};templ.ydn.crm.app.body=function(a,b){return'<div class="app"><section class="sidebar"><div class="user-toolbar"><div><a id="user-login">...</a></div><div><span id="user-name" style="display: none;"></span></div></div></section><ul><li><details><summary>Debug</summary><div id="section-debug"></div></details></li></ul></div>'};
templ.ydn.crm.app.page=function(a,b){return'<!DOCTYPE html><html><head><meta charset="utf-8"/><title>Background page</title>'+(a.is_raw?'<script type="text/javascript" src="http://localhost:8085/crm-ex/lib/md5.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/crm-ex/lib/kinetic-v4.7.4.min.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/closure-library/closure/goog/base.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/ydn-base/src/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/ydn/src/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/ydn-api/js/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/ydn-db/src/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/ydn-db-sync/src/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/gdata/src/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/crm-ex/src/deps.js">\x3c/script><script type="text/javascript" src="http://localhost:8085/crm-ex/src/crm/include.js">\x3c/script>':
'<script type="text/javascript" src="lib/md5.js">\x3c/script><script type="text/javascript" src="lib/kinetic-v4.7.4.min.js">\x3c/script>')+'</head><body><div id="canvas-19"></div>'+(a.is_raw?'<script type="text/javascript" src="http://localhost:8085/crm-ex/js/run-event-page.js">\x3c/script>':'<script type="text/javascript" src="jsc/ydn.crm.js">\x3c/script><script type="text/javascript" src="js/run-event-page.js">\x3c/script>')+"</body></html>"};goog.async.Delay=function(a,b,c){goog.Disposable.call(this);this.listener_=a;this.interval_=b||0;this.handler_=c;this.callback_=goog.bind(this.doAction_,this)};goog.inherits(goog.async.Delay,goog.Disposable);goog.Delay=goog.async.Delay;goog.async.Delay.prototype.id_=0;goog.async.Delay.prototype.disposeInternal=function(){goog.async.Delay.superClass_.disposeInternal.call(this);this.stop();delete this.listener_;delete this.handler_};
goog.async.Delay.prototype.start=function(a){this.stop();this.id_=goog.Timer.callOnce(this.callback_,goog.isDef(a)?a:this.interval_)};goog.async.Delay.prototype.stop=function(){this.isActive()&&goog.Timer.clear(this.id_);this.id_=0};goog.async.Delay.prototype.fire=function(){this.stop();this.doAction_()};goog.async.Delay.prototype.fireIfActive=function(){this.isActive()&&this.fire()};goog.async.Delay.prototype.isActive=function(){return 0!=this.id_};
goog.async.Delay.prototype.doAction_=function(){this.id_=0;this.listener_&&this.listener_.call(this.handler_)};goog.async.Throttle=function(a,b,c){goog.Disposable.call(this);this.listener_=a;this.interval_=b;this.handler_=c;this.callback_=goog.bind(this.onTimer_,this)};goog.inherits(goog.async.Throttle,goog.Disposable);goog.Throttle=goog.async.Throttle;goog.async.Throttle.prototype.shouldFire_=!1;goog.async.Throttle.prototype.pauseCount_=0;goog.async.Throttle.prototype.timer_=null;goog.async.Throttle.prototype.fire=function(){this.timer_||this.pauseCount_?this.shouldFire_=!0:this.doAction_()};
goog.async.Throttle.prototype.stop=function(){this.timer_&&(goog.Timer.clear(this.timer_),this.timer_=null,this.shouldFire_=!1)};goog.async.Throttle.prototype.pause=function(){this.pauseCount_++};goog.async.Throttle.prototype.resume=function(){this.pauseCount_--;this.pauseCount_||!this.shouldFire_||this.timer_||(this.shouldFire_=!1,this.doAction_())};goog.async.Throttle.prototype.disposeInternal=function(){goog.async.Throttle.superClass_.disposeInternal.call(this);this.stop()};
goog.async.Throttle.prototype.onTimer_=function(){this.timer_=null;this.shouldFire_&&!this.pauseCount_&&(this.shouldFire_=!1,this.doAction_())};goog.async.Throttle.prototype.doAction_=function(){this.timer_=goog.Timer.callOnce(this.callback_,this.interval_);this.listener_.call(this.handler_)};ydn.DEBUG=!1;ydn.logger=goog.debug.Logger.getLogger("ydn");ydn.State=function(){};ydn.State.StateValue={INITIALIZED:Math.pow(2,2),DONE:Math.pow(2,3),FAIL:Math.pow(2,4),ERROR:Math.pow(2,5),LOADED:Math.pow(2,6),DRAWN:Math.pow(2,7),SAVED:Math.pow(2,8),RESTORED:Math.pow(2,9),UPDATED:Math.pow(2,10),FETCHED:Math.pow(2,11),WORKING:Math.pow(2,12),FETCHING:Math.pow(2,13)};
ydn.State.prototype.setState=function(a,b){if("boolean"!=typeof b)throw Error("Invalid value");if("number"!=typeof a||0>a)throw Error("Invalid state");"undefined"==typeof this.__state__&&(this.__state__=0);this.__state__=b?this.__state__|a:this.__state__&~a};ydn.State.prototype.inState=function(a){return"undefined"==typeof this.__state__?null:(this.__state__&a)==a};ydn.State.prototype.isDone=function(){return!0===this.inState(ydn.State.StateValue.DONE)};
ydn.State.prototype.setDone=function(){this.setState(ydn.State.StateValue.DONE,!0)};ydn.State.prototype.setStateFor=function(a,b,c){if("number"!=typeof c||0>=c)throw Error("Invalid duration");this.setState(a,b);setTimeout(goog.bind(function(){this.setState(a,!b)},this),c)};
ydn.State.prototype.getStateStr=function(){var a="?";this.key&&(a=this.key+":");if(!this.__state__)return a;for(var b=this.__state__.toString(2),c=b.length,d=!1,e=b.length;0<=e;e--)"1"==b[e]&&(a+=c-e-1+",",d=!0);d&&(a=a.substring(0,a.length-1));return a};ydn.EventState=function(){goog.events.EventTarget.call(this);this.key=this.__state__=void 0};goog.inherits(ydn.EventState,goog.events.EventTarget);ydn.EventState.prototype.setState=function(a,b){if("boolean"!=typeof b)throw Error("Invalid value");if("number"!=typeof a||0>a)throw Error("Invalid state");"undefined"==typeof this.__state__&&(this.__state__=0);this.__state__=b?this.__state__|a:this.__state__&~a};
ydn.EventState.prototype.inState=function(a){return"undefined"==typeof this.__state__?null:(this.__state__&a)==a};ydn.EventState.prototype.isDone=function(){return!0===this.inState(ydn.State.StateValue.DONE)};ydn.EventState.prototype.setDone=function(){this.setState(ydn.State.StateValue.DONE,!0);goog.Timer.callOnce(function(){this.dispatchEvent(ydn.EventState.EventType.DONE)},0,this)};
ydn.EventState.prototype.setStateFor=function(a,b,c){if("number"!=typeof c||0>=c)throw Error("Invalid duration");this.setState(a,b);setTimeout(goog.bind(function(){this.setState(a,!b)},this),c)};ydn.EventState.prototype.getStateStr=function(){var a="?";this.key&&(a=this.key+":");if(!this.__state__)return a;for(var b=this.__state__.toString(2),c=b.length,d=!1,e=b.length;0<=e;e--)"1"==b[e]&&(a+=c-e-1+",",d=!0);d&&(a=a.substring(0,a.length-1));return a};ydn.EventState.EventType={DONE:goog.events.getUniqueId("done")};ydn.api={};ydn.api.ClickEvent=function(a,b,c){goog.events.Event.call(this,a,b);this.url=c};goog.inherits(ydn.api.ClickEvent,goog.events.Event);ydn.api.display={};ydn.api.display.UserDisplay=function(){};ydn.api.display.UserDisplay.prototype.setNickname=function(a,b){};ydn.api.display.UserDisplay.prototype.getLoginClick=function(){};ydn.api.display.UserDisplay.prototype.setLoginUrl=function(a){};ydn.api.display.UserDisplay.prototype.setLogoutUrl=function(a){};ydn.api.display.ExternalUserDisplayImpl=function(a){this.display_=a};ydn.api.display.ExternalUserDisplayImpl.prototype.getLoginClick=function(){return this.display_.getLoginClick()};ydn.api.display.ExternalUserDisplayImpl.prototype.setNickname=function(a,b){this.display_.setNickname(a)};ydn.api.display.ExternalUserDisplayImpl.prototype.setLogoutUrl=function(a){this.display_.setLogoutUrl(a)};ydn.api.display.ExternalUserDisplayImpl.prototype.setLoginUrl=function(a){this.display_.setLoginUrl(a)};ydn.api.user={};ydn.api.user.EventType={LOADED:"user-loaded",LOGIN:"user-login",LOGOUT:"user-logout",LOGGING_IN:"user-logging-in",LOGGING_OUT:"user-logging-out"};goog.fs={};goog.fs.Error=function(a,b){goog.debug.Error.call(this,goog.string.subs("Error %s: %s",b,goog.fs.Error.getDebugMessage(a)));this.code=a};goog.inherits(goog.fs.Error,goog.debug.Error);goog.fs.Error.ErrorCode={NOT_FOUND:1,SECURITY:2,ABORT:3,NOT_READABLE:4,ENCODING:5,NO_MODIFICATION_ALLOWED:6,INVALID_STATE:7,SYNTAX:8,INVALID_MODIFICATION:9,QUOTA_EXCEEDED:10,TYPE_MISMATCH:11,PATH_EXISTS:12};
goog.fs.Error.getDebugMessage=function(a){switch(a){case goog.fs.Error.ErrorCode.NOT_FOUND:return"File or directory not found";case goog.fs.Error.ErrorCode.SECURITY:return"Insecure or disallowed operation";case goog.fs.Error.ErrorCode.ABORT:return"Operation aborted";case goog.fs.Error.ErrorCode.NOT_READABLE:return"File or directory not readable";case goog.fs.Error.ErrorCode.ENCODING:return"Invalid encoding";case goog.fs.Error.ErrorCode.NO_MODIFICATION_ALLOWED:return"Cannot modify file or directory";
case goog.fs.Error.ErrorCode.INVALID_STATE:return"Invalid state";case goog.fs.Error.ErrorCode.SYNTAX:return"Invalid line-ending specifier";case goog.fs.Error.ErrorCode.INVALID_MODIFICATION:return"Invalid modification";case goog.fs.Error.ErrorCode.QUOTA_EXCEEDED:return"Quota exceeded";case goog.fs.Error.ErrorCode.TYPE_MISMATCH:return"Invalid filetype";case goog.fs.Error.ErrorCode.PATH_EXISTS:return"File or directory already exists at specified path";default:return"Unrecognized error"}};goog.fs.ProgressEvent=function(a,b){goog.events.Event.call(this,a.type,b);this.event_=a};goog.inherits(goog.fs.ProgressEvent,goog.events.Event);goog.fs.ProgressEvent.prototype.isLengthComputable=function(){return this.event_.lengthComputable};goog.fs.ProgressEvent.prototype.getLoaded=function(){return this.event_.loaded};goog.fs.ProgressEvent.prototype.getTotal=function(){return this.event_.total};goog.fs.FileReader=function(){goog.events.EventTarget.call(this);this.reader_=new FileReader;this.reader_.onloadstart=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onprogress=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onload=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onabort=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onerror=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onloadend=goog.bind(this.dispatchProgressEvent_,this)};
goog.inherits(goog.fs.FileReader,goog.events.EventTarget);goog.fs.FileReader.ReadyState={INIT:0,LOADING:1,DONE:2};goog.fs.FileReader.EventType={LOAD_START:"loadstart",PROGRESS:"progress",LOAD:"load",ABORT:"abort",ERROR:"error",LOAD_END:"loadend"};goog.fs.FileReader.prototype.abort=function(){try{this.reader_.abort()}catch(a){throw new goog.fs.Error(a.code,"aborting read");}};goog.fs.FileReader.prototype.getReadyState=function(){return this.reader_.readyState};
goog.fs.FileReader.prototype.getResult=function(){return this.reader_.result};goog.fs.FileReader.prototype.getError=function(){return this.reader_.error&&new goog.fs.Error(this.reader_.error.code,"reading file")};goog.fs.FileReader.prototype.dispatchProgressEvent_=function(a){this.dispatchEvent(new goog.fs.ProgressEvent(a,this))};goog.fs.FileReader.prototype.disposeInternal=function(){goog.fs.FileReader.superClass_.disposeInternal.call(this);delete this.reader_};
goog.fs.FileReader.prototype.readAsBinaryString=function(a){this.reader_.readAsBinaryString(a)};goog.fs.FileReader.readAsBinaryString=function(a){var b=new goog.fs.FileReader,c=goog.fs.FileReader.createDeferred_(b);b.readAsBinaryString(a);return c};goog.fs.FileReader.prototype.readAsArrayBuffer=function(a){this.reader_.readAsArrayBuffer(a)};goog.fs.FileReader.readAsArrayBuffer=function(a){var b=new goog.fs.FileReader,c=goog.fs.FileReader.createDeferred_(b);b.readAsArrayBuffer(a);return c};
goog.fs.FileReader.prototype.readAsText=function(a,b){this.reader_.readAsText(a,b)};goog.fs.FileReader.readAsText=function(a,b){var c=new goog.fs.FileReader,d=goog.fs.FileReader.createDeferred_(c);c.readAsText(a,b);return d};goog.fs.FileReader.prototype.readAsDataUrl=function(a){this.reader_.readAsDataURL(a)};goog.fs.FileReader.readAsDataUrl=function(a){var b=new goog.fs.FileReader,c=goog.fs.FileReader.createDeferred_(b);b.readAsDataUrl(a);return c};
goog.fs.FileReader.createDeferred_=function(a){var b=new goog.async.Deferred;a.listen(goog.fs.FileReader.EventType.LOAD_END,goog.partial(function(a,b,e){e=b.getResult();var f=b.getError();null==e||f?a.errback(f):a.callback(e);b.dispose()},b,a));return b};goog.fs.Entry=function(){};goog.fs.Entry.prototype.isFile=function(){};goog.fs.Entry.prototype.isDirectory=function(){};goog.fs.Entry.prototype.getName=function(){};goog.fs.Entry.prototype.getFullPath=function(){};goog.fs.Entry.prototype.getFileSystem=function(){};goog.fs.Entry.prototype.getLastModified=function(){};goog.fs.Entry.prototype.getMetadata=function(){};goog.fs.Entry.prototype.moveTo=function(a,b){};goog.fs.Entry.prototype.copyTo=function(a,b){};goog.fs.Entry.prototype.wrapEntry=function(a){};
goog.fs.Entry.prototype.toUrl=function(a){};goog.fs.Entry.prototype.toUri=function(a){};goog.fs.Entry.prototype.remove=function(){};goog.fs.Entry.prototype.getParent=function(){};goog.fs.DirectoryEntry=function(){};goog.fs.DirectoryEntry.Behavior={DEFAULT:1,CREATE:2,CREATE_EXCLUSIVE:3};goog.fs.DirectoryEntry.prototype.getFile=function(a,b){};goog.fs.DirectoryEntry.prototype.getDirectory=function(a,b){};goog.fs.DirectoryEntry.prototype.createPath=function(a){};
goog.fs.DirectoryEntry.prototype.listDirectory=function(){};goog.fs.DirectoryEntry.prototype.removeRecursively=function(){};goog.fs.FileEntry=function(){};goog.fs.FileEntry.prototype.createWriter=function(){};goog.fs.FileEntry.prototype.file=function(){};goog.fs.FileSaver=function(a){goog.events.EventTarget.call(this);this.saver_=a;this.saver_.onwritestart=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onprogress=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onwrite=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onabort=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onerror=goog.bind(this.dispatchProgressEvent_,this);this.saver_.onwriteend=goog.bind(this.dispatchProgressEvent_,this)};
goog.inherits(goog.fs.FileSaver,goog.events.EventTarget);goog.fs.FileSaver.ReadyState={INIT:0,WRITING:1,DONE:2};goog.fs.FileSaver.EventType={WRITE_START:"writestart",PROGRESS:"progress",WRITE:"write",ABORT:"abort",ERROR:"error",WRITE_END:"writeend"};goog.fs.FileSaver.prototype.abort=function(){try{this.saver_.abort()}catch(a){throw new goog.fs.Error(a.code,"aborting save");}};goog.fs.FileSaver.prototype.getReadyState=function(){return this.saver_.readyState};
goog.fs.FileSaver.prototype.getError=function(){return this.saver_.error&&new goog.fs.Error(this.saver_.error.code,"saving file")};goog.fs.FileSaver.prototype.dispatchProgressEvent_=function(a){this.dispatchEvent(new goog.fs.ProgressEvent(a,this))};goog.fs.FileSaver.prototype.disposeInternal=function(){delete this.saver_;goog.fs.FileSaver.superClass_.disposeInternal.call(this)};goog.fs.FileSaver.ProgressEvent=goog.fs.ProgressEvent;goog.fs.FileWriter=function(a){goog.fs.FileSaver.call(this,a);this.writer_=a};goog.inherits(goog.fs.FileWriter,goog.fs.FileSaver);goog.fs.FileWriter.prototype.getPosition=function(){return this.writer_.position};goog.fs.FileWriter.prototype.getLength=function(){return this.writer_.length};goog.fs.FileWriter.prototype.write=function(a){try{this.writer_.write(a)}catch(b){throw new goog.fs.Error(b.code,"writing file");}};
goog.fs.FileWriter.prototype.seek=function(a){try{this.writer_.seek(a)}catch(b){throw new goog.fs.Error(b.code,"seeking in file");}};goog.fs.FileWriter.prototype.truncate=function(a){try{this.writer_.truncate(a)}catch(b){throw new goog.fs.Error(b.code,"truncating file");}};goog.fs.EntryImpl=function(a,b){this.fs_=a;this.entry_=b};goog.fs.EntryImpl.prototype.isFile=function(){return this.entry_.isFile};goog.fs.EntryImpl.prototype.isDirectory=function(){return this.entry_.isDirectory};goog.fs.EntryImpl.prototype.getName=function(){return this.entry_.name};goog.fs.EntryImpl.prototype.getFullPath=function(){return this.entry_.fullPath};goog.fs.EntryImpl.prototype.getFileSystem=function(){return this.fs_};goog.fs.EntryImpl.prototype.getLastModified=function(){return this.getMetadata().addCallback(function(a){return a.modificationTime})};
goog.fs.EntryImpl.prototype.getMetadata=function(){var a=new goog.async.Deferred;this.entry_.getMetadata(function(b){a.callback(b)},goog.bind(function(b){var c="retrieving metadata for "+this.getFullPath();a.errback(new goog.fs.Error(b.code,c))},this));return a};
goog.fs.EntryImpl.prototype.moveTo=function(a,b){var c=new goog.async.Deferred;this.entry_.moveTo(a.dir_,b,goog.bind(function(a){c.callback(this.wrapEntry(a))},this),goog.bind(function(d){var e="moving "+this.getFullPath()+" into "+a.getFullPath()+(b?", renaming to "+b:"");c.errback(new goog.fs.Error(d.code,e))},this));return c};
goog.fs.EntryImpl.prototype.copyTo=function(a,b){var c=new goog.async.Deferred;this.entry_.copyTo(a.dir_,b,goog.bind(function(a){c.callback(this.wrapEntry(a))},this),goog.bind(function(d){var e="copying "+this.getFullPath()+" into "+a.getFullPath()+(b?", renaming to "+b:"");c.errback(new goog.fs.Error(d.code,e))},this));return c};goog.fs.EntryImpl.prototype.wrapEntry=function(a){return a.isFile?new goog.fs.FileEntryImpl(this.fs_,a):new goog.fs.DirectoryEntryImpl(this.fs_,a)};
goog.fs.EntryImpl.prototype.toUrl=function(a){return this.entry_.toURL(a)};goog.fs.EntryImpl.prototype.toUri=goog.fs.EntryImpl.prototype.toUrl;goog.fs.EntryImpl.prototype.remove=function(){var a=new goog.async.Deferred;this.entry_.remove(goog.bind(a.callback,a,!0),goog.bind(function(b){var c="removing "+this.getFullPath();a.errback(new goog.fs.Error(b.code,c))},this));return a};
goog.fs.EntryImpl.prototype.getParent=function(){var a=new goog.async.Deferred;this.entry_.getParent(goog.bind(function(b){a.callback(new goog.fs.DirectoryEntryImpl(this.fs_,b))},this),goog.bind(function(b){var c="getting parent of "+this.getFullPath();a.errback(new goog.fs.Error(b.code,c))},this));return a};goog.fs.DirectoryEntryImpl=function(a,b){goog.fs.EntryImpl.call(this,a,b);this.dir_=b};goog.inherits(goog.fs.DirectoryEntryImpl,goog.fs.EntryImpl);
goog.fs.DirectoryEntryImpl.prototype.getFile=function(a,b){var c=new goog.async.Deferred;this.dir_.getFile(a,this.getOptions_(b),goog.bind(function(a){c.callback(new goog.fs.FileEntryImpl(this.fs_,a))},this),goog.bind(function(b){var e="loading file "+a+" from "+this.getFullPath();c.errback(new goog.fs.Error(b.code,e))},this));return c};
goog.fs.DirectoryEntryImpl.prototype.getDirectory=function(a,b){var c=new goog.async.Deferred;this.dir_.getDirectory(a,this.getOptions_(b),goog.bind(function(a){c.callback(new goog.fs.DirectoryEntryImpl(this.fs_,a))},this),goog.bind(function(b){var e="loading directory "+a+" from "+this.getFullPath();c.errback(new goog.fs.Error(b.code,e))},this));return c};
goog.fs.DirectoryEntryImpl.prototype.createPath=function(a){function b(a){if(!d.length)return goog.async.Deferred.succeed(a);var c=d.shift();return(".."==c?a.getParent():"."==c?goog.async.Deferred.succeed(a):a.getDirectory(c,goog.fs.DirectoryEntry.Behavior.CREATE)).addCallback(b)}if(goog.string.startsWith(a,"/")){var c=this.getFileSystem().getRoot();if(this.getFullPath()!=c.getFullPath())return c.createPath(a)}var d=goog.array.filter(a.split("/"),goog.functions.identity);return b(this)};
goog.fs.DirectoryEntryImpl.prototype.listDirectory=function(){var a=new goog.async.Deferred,b=this.dir_.createReader(),c=[],d=goog.bind(function(b){var c="listing directory "+this.getFullPath();a.errback(new goog.fs.Error(b.code,c))},this),e=goog.bind(function(f){if(f.length){for(var g=0,h;h=f[g];g++)c.push(this.wrapEntry(h));b.readEntries(e,d)}else a.callback(c)},this);b.readEntries(e,d);return a};
goog.fs.DirectoryEntryImpl.prototype.removeRecursively=function(){var a=new goog.async.Deferred;this.dir_.removeRecursively(goog.bind(a.callback,a,!0),goog.bind(function(b){var c="removing "+this.getFullPath()+" recursively";a.errback(new goog.fs.Error(b.code,c))},this));return a};goog.fs.DirectoryEntryImpl.prototype.getOptions_=function(a){return a==goog.fs.DirectoryEntry.Behavior.CREATE?{create:!0}:a==goog.fs.DirectoryEntry.Behavior.CREATE_EXCLUSIVE?{create:!0,exclusive:!0}:{}};
goog.fs.FileEntryImpl=function(a,b){goog.fs.EntryImpl.call(this,a,b);this.file_=b};goog.inherits(goog.fs.FileEntryImpl,goog.fs.EntryImpl);goog.fs.FileEntryImpl.prototype.createWriter=function(){var a=new goog.async.Deferred;this.file_.createWriter(function(b){a.callback(new goog.fs.FileWriter(b))},goog.bind(function(b){var c="creating writer for "+this.getFullPath();a.errback(new goog.fs.Error(b.code,c))},this));return a};
goog.fs.FileEntryImpl.prototype.file=function(){var a=new goog.async.Deferred;this.file_.file(function(b){a.callback(b)},goog.bind(function(b){var c="getting file for "+this.getFullPath();a.errback(new goog.fs.Error(b.code,c))},this));return a};goog.fs.FileSystem=function(){};goog.fs.FileSystem.prototype.getName=function(){};goog.fs.FileSystem.prototype.getRoot=function(){};goog.fs.FileSystemImpl=function(a){this.fs_=a};goog.fs.FileSystemImpl.prototype.getName=function(){return this.fs_.name};goog.fs.FileSystemImpl.prototype.getRoot=function(){return new goog.fs.DirectoryEntryImpl(this,this.fs_.root)};goog.fs.FileSystemImpl.prototype.getBrowserFileSystem=function(){return this.fs_};goog.fs.get_=function(a,b){var c=goog.global.requestFileSystem||goog.global.webkitRequestFileSystem;if(!goog.isFunction(c))return goog.async.Deferred.fail(Error("File API unsupported"));var d=new goog.async.Deferred;c(a,b,function(a){d.callback(new goog.fs.FileSystemImpl(a))},function(a){d.errback(new goog.fs.Error(a.code,"requesting filesystem"))});return d};goog.fs.FileSystemType_={TEMPORARY:0,PERSISTENT:1};goog.fs.getTemporary=function(a){return goog.fs.get_(goog.fs.FileSystemType_.TEMPORARY,a)};
goog.fs.getPersistent=function(a){return goog.fs.get_(goog.fs.FileSystemType_.PERSISTENT,a)};goog.fs.createObjectUrl=function(a){return goog.fs.getUrlObject_().createObjectURL(a)};goog.fs.revokeObjectUrl=function(a){goog.fs.getUrlObject_().revokeObjectURL(a)};
goog.fs.getUrlObject_=function(){if(goog.isDef(goog.global.URL)&&goog.isDef(goog.global.URL.createObjectURL))return goog.global.URL;if(goog.isDef(goog.global.webkitURL)&&goog.isDef(goog.global.webkitURL.createObjectURL))return goog.global.webkitURL;if(goog.isDef(goog.global.createObjectURL))return goog.global;throw Error("This browser doesn't seem to support blob URLs");};
goog.fs.getBlob=function(a){var b=goog.global.BlobBuilder||goog.global.WebKitBlobBuilder;if(goog.isDef(b)){for(var b=new b,c=0;c<arguments.length;c++)b.append(arguments[c]);return b.getBlob()}return new Blob(goog.array.toArray(arguments))};goog.fs.blobToString=function(a,b){return goog.fs.FileReader.readAsText(a,b)};
goog.fs.sliceBlob=function(a,b,c){goog.isDef(c)||(c=a.size);return a.webkitSlice?a.webkitSlice(b,c):a.mozSlice?a.mozSlice(b,c):a.slice?goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("13.0")||goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("537.1")?(0>b&&(b+=a.size),0>b&&(b=0),0>c&&(c+=a.size),c<b&&(c=b),a.slice(b,c-b)):a.slice(b,c):null};ydn.dom={};ydn.dom.getElementByName=function(a,b){for(var c=b.children.length;c--;)if(b.children[c].getAttribute("name")===a)return b.children[c];return null};
ydn.dom.injectNode=function(a,b,c,d){goog.isString(d)&&document.getElementById(d)||("js"==b||goog.string.endsWith(a,".js")?(b=document.createElement("script"),b.type="text/javascript",c?b.innerHTML=a:b.src=a):"css"==b||goog.string.endsWith(a,".css")?c?(b=document.createElement("style"),b.type="text/css",b.innerHTML=a):(b=document.createElement("link"),b.type="text/css",b.rel="stylesheet",b.href=a):(b=document.createElement("iframe"),b.setAttribute("frameborder","0"),b.src=a),goog.isString(d)&&(b.id=
d),document.getElementsByTagName("head")[0].appendChild(b))};ydn.dom.isBlobStorageSupported=function(){return!(!goog.global.URL||!goog.global.URL.createObjectURL)||!(!goog.global.webkitURL||!goog.global.webkitURL.createObjectURL)};ydn.dom.createBlobUrl=function(a,b){var c={txt:"text/plain",js:"text/javascript",css:"text/css"},c=new Blob([a],{type:(c[b||"txt"]||c.txt)+";charset=UTF-8"});return goog.fs.createObjectUrl(c)};
ydn.dom.injectCacheNode=function(a,b){var c=b||{},d=!!c.cache,e=!!c.use_inline,f=!!c.use_blob,g=!!c.no_try,h=!!c.refresh,k=(c=c.type)?c:goog.string.endsWith(a,".js")?"js":goog.string.endsWith(a,".css")?"css":"js";d?(d=window.localStorage.getItem(a),!h&&goog.isString(d)?e?ydn.dom.injectNode(d,k,!0):f&&ydn.dom.isBlobStorageSupported()?(g=ydn.dom.createBlobUrl(d,k),ydn.dom.injectNode(g,k)):ydn.dom.injectNode(d,k,!0):g?ydn.dom.injectNode(a,k):goog.net.XhrIo.send(a,function(b){b=b.target;b.isSuccess()?
(b=b.getResponseText(),window.localStorage.setItem(a,b),ydn.dom.injectCacheNode(a,{cache:!0,use_inline:e,use_blob:f,no_try:!0})):ydn.dom.injectNode(a,k)})):ydn.dom.injectNode(a,k)};ydn.dom.isInIframe=function(){return window&&window.top!=window.self};
ydn.dom.insertGoogleAnalytic=function(a,b){var c=[];c.push(["_setAccount",a]);b&&c.push(["_setDomainName",b]);c.push(["_trackPageview"]);(function(a){this._gaq=a;a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})(c)};
ydn.dom.insertFbJssdk=function(a){var b,c=document.getElementsByTagName("script")[0];if(!document.getElementById("facebook-jssdk"))if(document.body)b=document.createElement("div"),b.id="fb-root",document.body.appendChild(b),b=document.createElement("script"),b.id="facebook-jssdk",b.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId="+a,c.parentNode.insertBefore(b,c);else if(goog.DEBUG)throw Error("Document is not ready to inject Facebook jssdk");};
ydn.dom.insertGooglePlusComment=function(a,b){var c=a||document.body;if(c){var d=document.createElement("div");d.className="g-comments";d.setAttribute("data-href",window.location.toString());d.setAttribute("data-first_party_property","BLOGGER");d.setAttribute("data-view_type","FILTERED_POSTMOD");var e=document.createElement("a");e.href="https://plus.google.com/113228690701576340100?rel=author";e.textContent="Kyaw";var f=document.createElement("span");f.textContent="By ";var g=document.createElement("div");
g.appendChild(document.createElement("br"));g.appendChild(f);g.appendChild(e);b&&(g.appendChild(document.createTextNode(", ")),g.appendChild(b));e=document.createElement("div");e.appendChild(g);e.appendChild(d);c.appendChild(e);c=document.getElementById("plusone");c||(c=document.createElement("script"),c.id="plusone",c.src="https://apis.google.com/js/plusone.js",d=document.getElementsByTagName("script")[0],d.parentNode.insertBefore(c,d))}else if(goog.DEBUG)throw Error("Document is not ready to inject Google plus comment");
};ydn.dom.onDocumentComplete=function(a){ydn.dom.getDocumentComplete().addBoth(a)};ydn.dom.USE_onreadystatechange=!0;
ydn.dom.getDocumentComplete=function(){ydn.dom.dfDocumentComplete_||(ydn.dom.dfDocumentComplete_=new goog.async.Deferred,"complete"===document.readyState?ydn.dom.dfDocumentComplete_.callback(!0):ydn.dom.USE_onreadystatechange&&goog.isDef(document.onreadystatechange)&&goog.isNull(document.onreadystatechange)?document.onreadystatechange=function(){"complete"===document.readyState&&(document.onreadystatechange=null,ydn.dom.dfDocumentComplete_.callback(!0))}:(ydn.dom.timer_=new goog.Timer(100),goog.events.listen(ydn.dom.timer_,
goog.Timer.TICK,function(a){"complete"===document.readyState&&(ydn.dom.timer_.stop(),ydn.dom.timer_.dispose(),delete ydn.dom.timer_,ydn.dom.dfDocumentComplete_.callback(!0))}),ydn.dom.timer_.start()));return ydn.dom.dfDocumentComplete_};ydn.dom.onWindowOnLoad=function(a){ydn.dom.getWindowOnLoad().addBoth(a)};
ydn.dom.getWindowOnLoad=function(){if(!ydn.dom.dfWindowOnLoad_){ydn.dom.dfWindowOnLoad_=new goog.async.Deferred;var a=document.getElementsByTagName("BODY");a&&a[0]&&"loaded"==a[0].readyState?ydn.dom.dfWindowOnLoad_.callback(!0):window.addEventListener?window.addEventListener("load",function(){ydn.dom.dfWindowOnLoad_.callback(!0)},!1):window.attachEvent("onload",function(){ydn.dom.dfWindowOnLoad_.callback(!0)})}return ydn.dom.dfWindowOnLoad_};ydn.json={};ydn.json.DEBUG=!1;ydn.json.POLY_FILL=!1;ydn.json.logger=goog.debug.Logger.getLogger("ydn");ydn.json.parse=function(a){return!goog.isString(a)||goog.string.isEmpty(a)?{}:ydn.json.POLY_FILL&&"undefined"==typeof goog.global.JSON?goog.json.unsafeParse(a):JSON.parse(a)};ydn.json.toShortString=function(a){var b;try{b=ydn.json.stringify(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""};
ydn.json.stringify=function(a,b,c){return ydn.json.POLY_FILL&&"undefined"==typeof goog.global.JSON?goog.json.serialize(a,b):JSON.stringify(a,b,c)};goog.dom.xml={};goog.dom.xml.MAX_XML_SIZE_KB=2048;goog.dom.xml.MAX_ELEMENT_DEPTH=256;
goog.dom.xml.createDocument=function(a,b){if(b&&!a)throw Error("Can't create document with namespace and no root tag");if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(b||"",a||"",null);if("undefined"!=typeof ActiveXObject){var c=goog.dom.xml.createMsXmlDocument_();if(c)return a&&c.appendChild(c.createNode(goog.dom.NodeType.ELEMENT,a,b||"")),c}throw Error("Your browser does not support creating new documents");};
goog.dom.xml.loadXml=function(a){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(a,"application/xml");if("undefined"!=typeof ActiveXObject){var b=goog.dom.xml.createMsXmlDocument_();b.loadXML(a);return b}throw Error("Your browser does not support loading xml documents");};
goog.dom.xml.serialize=function(a){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(a);if(a=a.xml)return a;throw Error("Your browser does not support serializing XML documents");};
goog.dom.xml.selectSingleNode=function(a,b){if("undefined"!=typeof a.selectSingleNode){var c=goog.dom.getOwnerDocument(a);"undefined"!=typeof c.setProperty&&c.setProperty("SelectionLanguage","XPath");return a.selectSingleNode(b)}if(document.implementation.hasFeature("XPath","3.0")){var c=goog.dom.getOwnerDocument(a),d=c.createNSResolver(c.documentElement);return c.evaluate(b,a,d,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}return null};
goog.dom.xml.selectNodes=function(a,b){if("undefined"!=typeof a.selectNodes){var c=goog.dom.getOwnerDocument(a);"undefined"!=typeof c.setProperty&&c.setProperty("SelectionLanguage","XPath");return a.selectNodes(b)}if(document.implementation.hasFeature("XPath","3.0")){for(var c=goog.dom.getOwnerDocument(a),d=c.createNSResolver(c.documentElement),c=c.evaluate(b,a,d,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),d=[],e=c.snapshotLength,f=0;f<e;f++)d.push(c.snapshotItem(f));return d}return[]};
goog.dom.xml.setAttributes=function(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setAttribute(c,b[c])};goog.dom.xml.createMsXmlDocument_=function(){var a=new ActiveXObject("MSXML2.DOMDocument");if(a){a.resolveExternals=!1;a.validateOnParse=!1;try{a.setProperty("ProhibitDTD",!0),a.setProperty("MaxXMLSize",goog.dom.xml.MAX_XML_SIZE_KB),a.setProperty("MaxElementDepth",goog.dom.xml.MAX_ELEMENT_DEPTH)}catch(b){}}return a};ydn.error={};ydn.error.ArgumentException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ArgumentException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"};goog.inherits(ydn.error.ArgumentException,Error);ydn.error.NotSupportedException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.NotSupportedException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotSupportedException"};
goog.inherits(ydn.error.ArgumentException,Error);ydn.error.NotSupportedException.prototype.name="ydn.error.NotSupportedException";ydn.error.NotImplementedException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.NotImplementedException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"};goog.inherits(ydn.error.NotImplementedException,Error);
ydn.error.InternalError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InternalError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"};goog.inherits(ydn.error.InternalError,Error);ydn.error.InternalError.prototype.name="ydn.InternalError";ydn.error.ConstraintError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ConstraintError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"};
goog.inherits(ydn.error.ConstraintError,Error);ydn.error.ConstraintError.prototype.name="ydn.error.ConstraintError";ydn.error.InvalidOperationException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InvalidOperationException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"};goog.inherits(ydn.error.ArgumentException,Error);
ydn.error.InvalidOperationError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InvalidOperationError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"};goog.inherits(ydn.error.InvalidOperationError,Error);goog.userAgent.product={};goog.userAgent.product.ASSUME_FIREFOX=!1;goog.userAgent.product.ASSUME_CAMINO=!1;goog.userAgent.product.ASSUME_IPHONE=!1;goog.userAgent.product.ASSUME_IPAD=!1;goog.userAgent.product.ASSUME_ANDROID=!1;goog.userAgent.product.ASSUME_CHROME=!1;goog.userAgent.product.ASSUME_SAFARI=!1;
goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_CAMINO||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI;
goog.userAgent.product.init_=function(){goog.userAgent.product.detectedFirefox_=!1;goog.userAgent.product.detectedCamino_=!1;goog.userAgent.product.detectedIphone_=!1;goog.userAgent.product.detectedIpad_=!1;goog.userAgent.product.detectedAndroid_=!1;goog.userAgent.product.detectedChrome_=!1;goog.userAgent.product.detectedSafari_=!1;var a=goog.userAgent.getUserAgentString();a&&(-1!=a.indexOf("Firefox")?goog.userAgent.product.detectedFirefox_=!0:-1!=a.indexOf("Camino")?goog.userAgent.product.detectedCamino_=
!0:-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")?goog.userAgent.product.detectedIphone_=!0:-1!=a.indexOf("iPad")?goog.userAgent.product.detectedIpad_=!0:-1!=a.indexOf("Chrome")?goog.userAgent.product.detectedChrome_=!0:-1!=a.indexOf("Android")?goog.userAgent.product.detectedAndroid_=!0:-1!=a.indexOf("Safari")&&(goog.userAgent.product.detectedSafari_=!0))};goog.userAgent.product.PRODUCT_KNOWN_||goog.userAgent.product.init_();goog.userAgent.product.OPERA=goog.userAgent.OPERA;
goog.userAgent.product.IE=goog.userAgent.IE;goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.userAgent.product.detectedFirefox_;goog.userAgent.product.CAMINO=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CAMINO:goog.userAgent.product.detectedCamino_;goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.detectedIphone_;
goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.userAgent.product.detectedIpad_;goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.userAgent.product.detectedAndroid_;goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.userAgent.product.detectedChrome_;
goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.detectedSafari_;ydn.utils={};ydn.asserts={};ydn.utils.DEBUG=!1;ydn.utils.EMAIL_PATTERN=/(\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b)/gi;ydn.utils.extractEmailAddresses=function(a){return"string"!=typeof a?null:a.match(ydn.utils.EMAIL_PATTERN)};ydn.utils.isValidEmail=function(a){return goog.isString(a)?null!=a.match(ydn.utils.EMAIL_PATTERN):null};
ydn.utils.partialRight=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments),b=b.concat(c);return a.apply(this,b)}};ydn.utils.max=function(a,b){if(!goog.isArray(a))throw new ydn.error.ArgumentException("Array required.");if(goog.isDef(b)){var c=goog.array.map(a,function(a){return a[b]});return ydn.utils.max(c)}for(var c=Number.NaN,d=-1,e=0;e<a.length;e++)!isNaN(a[e])&&(isNaN(c)||a[e]>c)&&(c=a[e],d=e);return{value:c,index:d}};
ydn.utils.max_of=function(a){var b=Number.NaN,c=-1,d;for(d in a)if(a.hasOwnProperty(d)){var e=a[d];!isNaN(e)&&(isNaN(b)||e>b)&&(b=e,c=d)}return{value:b,index:c}};ydn.utils.range=function(a,b){for(var c=[],d=a;d<=b;d++)c.push(d);return c};ydn.utils.max_on=function(a,b,c){if("undefined"==typeof c){for(var d=-1,e=0;e<a.length;e++)-1==b.indexOf(e)&&(-1==d?d=e:a[e]>a[d]&&(d=e));return{value:a[d],index:d}}a=a.map(function(a){return a[c]});return ydn.utils.max_on(a,b)};ydn.utils.toRFC3339DateString=function(a){return a.toISOString()};
ydn.utils.parse_ISO_date=function(a){a=a.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(.*)/);return new Date(Date.UTC(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10),parseInt(a[6],10)))};ydn.utils._isoRegexp=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;
ydn.utils._parse_ISO_date=function(a){a+="";if("string"!=typeof a||0===a.length)return null;a=a.match(ydn.utils._isoRegexp);if("undefined"==typeof a||null===a)return null;var b,c,d,e,f,g,h;b=parseInt(a[1],10);if("undefined"==typeof a[2]||""===a[2])return new Date(b);c=parseInt(a[2],10)-1;d=parseInt(a[3],10);if("undefined"==typeof a[4]||""===a[4])return new Date(b,c,d);e=parseInt(a[4],10);f=parseInt(a[5],10);g="undefined"!=typeof a[6]&&""!==a[6]?parseInt(a[6],10):0;h="undefined"!=typeof a[7]&&""!==
a[7]?Math.round(1E3*parseFloat("0."+a[7])):0;if(!("undefined"!=typeof a[8]&&""!==a[8]||"undefined"!=typeof a[9]&&""!==a[9]))return new Date(b,c,d,e,f,g,h);var k;"undefined"!=typeof a[9]&&""!==a[9]?(k=36E5*parseInt(a[10],10),"undefined"!=typeof a[11]&&""!==a[11]&&(k+=6E4*parseInt(a[11],10)),"-"==a[9]&&(k=-k)):k=0;return new Date(Date.UTC(b,c,d,e,f,g,h)-k)};
ydn.utils.diagonalDominatedElement=function(a){if(!goog.isArray(a)||0<a.length&&!goog.isArray(a[0]))throw Error("Input matrix must be 2D matrix");var b=[],c=[],d,e;for(d=a.length;d--;){var f=ydn.utils.max_on(a[d],b);e=f.index;-1<e&&ydn.utils.max_on(a,c,e).index==d&&(b[d]=e,c[e]=d)}for(d=a.length;d--;)goog.isDef(b[d])||(f=ydn.utils.max_on(a[d],c),e=f.index,-1<e&&(b[d]=e,c[e]=d));for(e=a[0].length;e--;)goog.isDef(c[e])||(f=ydn.utils.max_on(a,b,e),d=f.index,-1<d&&(b[d]=e,c[e]=d));return{map1to2:b,map2to1:c}};
ydn.utils.getText=function(a){if(goog.isDefAndNotNull(a)&&goog.isString(a.$t))return a.$t;ydn.utils.DEBUG&&eval("console.error('Not text data:' + obj)");return""};ydn.utils.getNumber=function(a){a=ydn.utils.getText(a);return parseInt(a,10)};ydn.utils.extract_element_in_xml=function(a,b){for(var c=RegExp("<"+b+"(.*?)>(.*?)</"+b+">","igm"),d=0,e=[],f=[],g;null!=(g=c.exec(a));)d++,e.push(goog.string.trim(g[1])),f.push(goog.string.trim(g[2]));return{count:d,attribute:e,text:f}};
ydn.utils.isEnableCrossOriginResourceSharing=function(){return goog.userAgent.WEBKIT||goog.userAgent.GECKO};ydn.utils.parseTimeInterval=function(a){return(a=/(\d+)\:(\d+)\:(\d+\.\d+)/.exec(a))?3600*parseInt(a[1],10)+60*parseInt(a[2],10)+parseFloat(a[3]):NaN};ydn.utils.millisecondsInDays=function(a){return 864E5*a};ydn.asserts.assert=function(a,b){goog.asserts.ENABLE_ASSERTS&&window.console.assert(!!a,b)};ydn.utils.getEtag=function(a){a=goog.isString(a)?a:ydn.json.stringify(a);return"E"+goog.string.hashCode(a)};
ydn.utils.NONCE_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";ydn.utils.nonce=function(a){a=a||8;for(var b=ydn.utils.NONCE_CHARS,c="",d=0;d<a;++d)var e=Math.floor(Math.random()*b.length),c=c+b.substring(e,e+1);return c};ydn.utils.descendingId=function(){return new Date(9999,0,1)-new Date};ydn.api.AbstractUser=function(){ydn.EventState.call(this);this.is_login=null;this.is_confirmed=!1;goog.events.listen(this,ydn.api.user.EventType.LOGIN,this.redraw,!1,this);goog.events.listen(this,ydn.api.user.EventType.LOGOUT,this.redraw,!1,this);this.redirect_url=window.top.location.href.replace(/[?#]\S+/,"")};goog.inherits(ydn.api.AbstractUser,ydn.EventState);ydn.api.AbstractUser.prototype.getUserId=function(){goog.asserts.assertString(this.user_id);return this.user_id};
ydn.api.AbstractUser.prototype.setRedirectUrl=function(a){this.redirect_url=a};ydn.api.AbstractUser.prototype.logger=goog.debug.Logger.getLogger("ydn.api.AbstractUser");ydn.api.AbstractUser.prototype.setView=function(a){a=new ydn.api.display.ExternalUserDisplayImpl(a);this.setDisplay(a)};ydn.api.AbstractUser.prototype.setDisplay=function(a){if(this.display=a)(a=this.display.getLoginClick())?goog.events.listen(a,goog.events.EventType.CLICK,this.eventHandler_login_click,!1,this):this.logger.warning("LoginClick handler missing, client side will not receive logout event")};
ydn.api.AbstractUser.prototype.eventHandler_login_click=function(a){var b,c;this.isLogin()?(c=this.logout_url,b=ydn.api.user.EventType.LOGGING_OUT):(c=this.login_url,b=ydn.api.user.EventType.LOGGING_IN);c=new ydn.api.AbstractUser.UserEvent(b,this,c);this.dispatchEvent(c);return ydn.dom.isInIframe()?(this.logger.fine("iframe hold redirect "+b+" click."),a.preventDefault(),!1):!0};
ydn.api.AbstractUser.prototype.redraw=function(){this.display?(this.display.setNickname(this.email||""),this.isLogin()?this.logout_url&&this.display.setLogoutUrl(this.logout_url):this.login_url&&this.display.setLoginUrl(this.login_url),this.logger.finest("Refreshed.")):this.logger.finest("No UI refreshed.")};ydn.api.AbstractUser.prototype.fromJSON=function(a){this.nickname=a.nickname;this.email=a.email;this.user_id=a.user_id;this.is_login=a.is_login;this.logout_url=a.logout_url;this.login_url=a.login_url};
ydn.api.AbstractUser.prototype.toJSON=function(){return{nickname:this.nickname,email:this.email,is_login:this.is_login,login_url:this.login_url,logout_url:this.logout_url,user_id:this.user_id}};ydn.api.AbstractUser.prototype.restore=function(a,b){if(b){this.fromJSON(b);this.redraw();var c=new ydn.api.AbstractUser.UserEvent(ydn.api.user.EventType.LOADED,this);goog.Timer.callOnce(function(){this.dispatchEvent(c)},0,this);this.logger.fine(b.email+" restored.")}else this.logger.fine("No user session data.")};
ydn.api.AbstractUser.prototype.getEmail=function(){goog.asserts.assertString(this.email);return this.email};ydn.api.AbstractUser.prototype.getNickname=function(){return goog.isString(this.nickname)&&0<this.nickname.length?this.nickname:this.email||""};ydn.api.AbstractUser.prototype.getLogoutUrl=function(){var a=this.logout_url;goog.asserts.assertString(a);return a};ydn.api.AbstractUser.prototype.getLoginUrl=function(){var a=this.login_url;goog.asserts.assertString(a);return a};
ydn.api.AbstractUser.prototype.isLogin=function(){return!0===this.is_login};goog.DEBUG&&(ydn.api.AbstractUser.prototype.toString=function(){return"User:"+(!0===this.is_login?this.email:!1===this.is_login?"logout":"?")});ydn.api.AbstractUser.MAX_TRY_LOGIN=1;ydn.api.AbstractUser.prototype.num_try_login=0;
ydn.api.AbstractUser.prototype.try_login=function(a){!a&&this.isLogin()?this.logger.finest("Already login"):(this.login_timer||(this.login_timer=new goog.async.Throttle(function(a){this.isLogin()?this.login_timer.stop():this.num_try_login>ydn.api.AbstractUser.MAX_TRY_LOGIN?(this.logger.warning("Cannot login to the API server, tried "+this.num_try_login+" times."),this.login_timer.stop(),this.num_try_login=0):(this.num_try_login++,this.login())},5E3,this)),this.num_try_login=0,this.login_timer.fire())};
ydn.api.AbstractUser.prototype.refresh=function(a){this.try_login(a)};ydn.api.AbstractUser.UserEvent=function(a,b,c){ydn.api.ClickEvent.call(this,a,b,c)};goog.inherits(ydn.api.AbstractUser.UserEvent,ydn.api.ClickEvent);ydn.api.AbstractUser.OpenIdUserEvent=function(a,b,c){ydn.api.AbstractUser.UserEvent.call(this,a,b,void 0);this.token=c||null};goog.inherits(ydn.api.AbstractUser.OpenIdUserEvent,ydn.api.AbstractUser.UserEvent);ydn.http={};ydn.http.CallbackResult=function(a,b,c,d,e,f){this.status=d;this.contentType=a;this.responseText=b||"";this.url=c;this.response=e||null;this.headers=f||{}};ydn.http.CallbackResult.wrap=function(a){return a instanceof ydn.http.CallbackResult?a:new ydn.http.CallbackResult(a.contentType,a.responseText,a.url,a.status,a.response,a.headers)};
ydn.http.CallbackResult.prototype.getHeader=function(a){var b=this.headers[a];if(b)return b;a=a.toLowerCase();for(var c in this.headers)if(c.toLowerCase()==a)return this.headers[c]};ydn.http.CallbackResult.prototype.getResponseJson=function(){return("json"==this.contentType||goog.isString(this.contentType)&&goog.string.startsWith(this.contentType,"application/json"))&&null!=this.response&&"object"==typeof this.response?this.response:ydn.json.parse(this.responseText)};
ydn.http.CallbackResult.prototype.getStatus=function(){return this.status};ydn.http.CallbackResult.prototype.getUrl=function(){return this.url};ydn.http.CallbackResult.prototype.isSuccessStatusCode=function(){return 200<=this.status&&400>this.status};ydn.http.CallbackResult.prototype.getMessage=function(){var a=goog.isString(this.responseText)?this.responseText.substring(0,200):"";return this.status+": "+a};ydn.http.CallbackResult.prototype.isContentJson=function(){return/application\/json/.test(this.contentType)};
ydn.http.CallbackResult.prototype.isContentJavascript=function(){return/text\/javascript/.test(this.contentType)};ydn.http.CallbackResult.prototype.toString=function(){return goog.DEBUG?this.status+" "+this.url+" "+(this.message?this.message:this.responseText):ydn.http.CallbackResult.superClass_.toString.call(this)};ydn.http.ITransport=function(){};
ydn.http.getDefaultOptions=function(a){var b={method:"GET",body:void 0,headers:{},params:{}};return goog.isDefAndNotNull(a)?{method:a.method||b.method,body:a.body,headers:a.headers||{},params:a.params||{}}:b};ydn.http.ITransport.prototype.send=function(a,b,c){};ydn.http.Transport=function(){};ydn.api.User=function(){ydn.api.AbstractUser.call(this)};goog.inherits(ydn.api.User,ydn.api.AbstractUser);ydn.api.User.getInstance=function(){ydn.api.User.instance||(ydn.api.User.instance=new ydn.api.User);return ydn.api.User.instance};ydn.api.User.prototype.logger=goog.debug.Logger.getLogger("ydn.api.User");
ydn.api.User.prototype.load=function(a){this.logger.fine("getting user info");if(a.logout_url)return this.fromJSON(a),this.logger.fine(a.email+" login"),this.logout_url=a.logout_url,this.user_id=a.Id?a.Id.$t:void 0,this.is_login=!0,this.login_url=void 0,this.setState(ydn.State.StateValue.LOADED,!0),this.setDone(),!0;a.login_url&&(this.logger.fine("NO user"),this.login_url=a.login_url,this.is_login=!1,this.email=this.user_id=this.logout_url=this.nickname=void 0,this.setState(ydn.State.StateValue.LOADED,
!0),this.setDone());return!1};
ydn.api.User.prototype.ydn_login_callback=function(a,b){this.logging_in_=!1;this.logger.finest("Receiving "+(b.isSuccess()?"":"fail")+" login info from server.");if(b.isSuccess()){var c=a.User;if(c){this.is_confirmed=!0;var d;d=this.load(c)?new ydn.api.AbstractUser.UserEvent(ydn.api.user.EventType.LOGIN,this,this.logout_url):new ydn.api.AbstractUser.UserEvent(ydn.api.user.EventType.LOGOUT,this,this.login_url);goog.Timer.callOnce(function(){this.dispatchEvent(d)},0,this)}}else this.is_confirmed=!1,
this.logger.warning("Server return error with: "+b.getStatusText());this.login_timer&&this.login_timer.stop()};
ydn.api.User.prototype.getLoginInfo=function(a){var b=new goog.async.Deferred,c=ydn.client.getClient(ydn.http.Scopes.LOGIN);if(!c)return goog.async.Deferred.fail("login server not available.");var d=this.redirect_url,e=Math.random().toString().substr(2,6),d={pm:d,state:e};if(a)for(var f in a)d[f]=a[f];a=new ydn.client.HttpRequestData("/rpc_login","GET",d);c.request(a).execute(function(a,c){a?b.callback(a.User):b.errback(c)},this);return b};
ydn.api.User.prototype.login=function(){this.logger.fine("Sending login request.");this.logging_in_=!0;var a=ydn.client.getClient(ydn.http.Scopes.LOGIN),b=window.top.location.href.replace(/[?#]\S+/,""),b=new ydn.client.HttpRequestData("/rpc_login","GET",{url:b});a.request(b).execute(goog.bind(this.ydn_login_callback,this));return!1};ydn.http.Scopes={DEFAULT:"default",AUTH:"auth",LOGIN:"login",GSE:"gse",GOOGLE_CLIENT:"gc",PROXY:"proxy",BUG_REPORT:"bug"};ydn.http.API_SERVER_ORIGIN="https://yathit-api.appspot.com";ydn.http.PROXY_URL="https://yathit-api.appspot.com/proxy/";ydn.http.STORAGE_SERVER_URL="";ydn.http.STATIC_SERVER_ORIGIN="";ydn.http.BUG_REPORT_SERVER_ORIGIN="https://yathit-dev.appspot.com";ydn.http.logger=goog.debug.Logger.getLogger("ydn.http");
ydn.http.canCrossPost=function(){return goog.userAgent.WEBKIT||goog.userAgent.GECKO||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("9")?!0:!1};ydn.http.canCrossPostWithCredential=function(){if(!goog.isDef(ydn.http.canCrossPostWithCredential_)){if(!ydn.http.canCrossPost())return!1;try{var a=new XMLHttpRequest;ydn.http.canCrossPostWithCredential_=!!a&&goog.isDef(a.withCredentials)}catch(b){ydn.http.canCrossPostWithCredential_=!1}}return ydn.http.canCrossPostWithCredential_};
ydn.http.transports={};ydn.http.scope_resolvers=[];ydn.http.setScopeResolver=function(a){ydn.http.scope_resolvers=[a]};ydn.http.addScopeResolver=function(a){a&&ydn.http.scope_resolvers.push(a)};ydn.http.setTransport=function(a,b){b=b||ydn.http.Scopes.DEFAULT;ydn.http.transports[b]=a};
ydn.http.getTransport=function(a){if(!goog.isDef(a))return ydn.http.transports[ydn.http.Scopes.DEFAULT];for(var b=a,c=0;c<ydn.http.scope_resolvers.length;c++){var d=(0,ydn.http.scope_resolvers[c])(a);if(d){b=d;break}}ydn.http.logger.finest("Resolving "+a+" to "+b);return ydn.http.transports[b]||null};ydn.http.clearTransport=function(a){goog.isDef(a)?delete ydn.http.transports[a]:(ydn.http.transports={},ydn.http.scope_resolvers=[])};
ydn.http.has_custom_header=function(a){for(var b in a)if(goog.isString(a[b])&&goog.string.startsWith(a[b].toLowerCase(),"x-"))return!0;return!1};ydn.http.is_simple_request=function(a,b){a=a.toUpperCase();if("GET"!=a||"POST"!=a)return!1;if("POST"==a){if(ydn.http.has_custom_header(b))return!1;var c=b["Content-Type"],d=["application/x-www-form-urlencoded","multipart/form-data","text/plain"];if(c&&!goog.array.contains(d,c))return!1}return!0};
ydn.http.getXhrManager=function(){if(ydn.http.xhr_manager_)return ydn.http.xhr_manager_;var a=new goog.net.XhrManager;return ydn.http.xhr_manager_=a};goog.debug.RelativeTimeProvider=function(){this.relativeTimeStart_=goog.now()};goog.debug.RelativeTimeProvider.defaultInstance_=new goog.debug.RelativeTimeProvider;goog.debug.RelativeTimeProvider.prototype.set=function(a){this.relativeTimeStart_=a};goog.debug.RelativeTimeProvider.prototype.reset=function(){this.set(goog.now())};goog.debug.RelativeTimeProvider.prototype.get=function(){return this.relativeTimeStart_};goog.debug.RelativeTimeProvider.getDefaultInstance=function(){return goog.debug.RelativeTimeProvider.defaultInstance_};goog.debug.Formatter=function(a){this.prefix_=a||"";this.startTimeProvider_=goog.debug.RelativeTimeProvider.getDefaultInstance()};goog.debug.Formatter.prototype.appendNewline=!0;goog.debug.Formatter.prototype.showAbsoluteTime=!0;goog.debug.Formatter.prototype.showRelativeTime=!0;goog.debug.Formatter.prototype.showLoggerName=!0;goog.debug.Formatter.prototype.showExceptionText=!1;goog.debug.Formatter.prototype.showSeverityLevel=!1;
goog.debug.Formatter.prototype.setStartTimeProvider=function(a){this.startTimeProvider_=a};goog.debug.Formatter.prototype.getStartTimeProvider=function(){return this.startTimeProvider_};goog.debug.Formatter.prototype.resetRelativeTimeStart=function(){this.startTimeProvider_.reset()};
goog.debug.Formatter.getDateTimeStamp_=function(a){a=new Date(a.getMillis());return goog.debug.Formatter.getTwoDigitString_(a.getFullYear()-2E3)+goog.debug.Formatter.getTwoDigitString_(a.getMonth()+1)+goog.debug.Formatter.getTwoDigitString_(a.getDate())+" "+goog.debug.Formatter.getTwoDigitString_(a.getHours())+":"+goog.debug.Formatter.getTwoDigitString_(a.getMinutes())+":"+goog.debug.Formatter.getTwoDigitString_(a.getSeconds())+"."+goog.debug.Formatter.getTwoDigitString_(Math.floor(a.getMilliseconds()/
10))};goog.debug.Formatter.getTwoDigitString_=function(a){return 10>a?"0"+a:String(a)};goog.debug.Formatter.getRelativeTime_=function(a,b){var c=(a.getMillis()-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d};goog.debug.HtmlFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.HtmlFormatter,goog.debug.Formatter);goog.debug.HtmlFormatter.prototype.showExceptionText=!0;
goog.debug.HtmlFormatter.prototype.formatRecord=function(a){var b;switch(a.getLevel().value){case goog.debug.Logger.Level.SHOUT.value:b="dbg-sh";break;case goog.debug.Logger.Level.SEVERE.value:b="dbg-sev";break;case goog.debug.Logger.Level.WARNING.value:b="dbg-w";break;case goog.debug.Logger.Level.INFO.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.prefix_," ");this.showAbsoluteTime&&c.push("[",goog.debug.Formatter.getDateTimeStamp_(a),"] ");this.showRelativeTime&&c.push("[",goog.string.whitespaceEscape(goog.debug.Formatter.getRelativeTime_(a,
this.startTimeProvider_.get())),"s] ");this.showLoggerName&&c.push("[",goog.string.htmlEscape(a.getLoggerName()),"] ");this.showSeverityLevel&&c.push("[",goog.string.htmlEscape(a.getLevel().name),"] ");c.push('<span class="',b,'">',goog.string.newLineToBr(goog.string.whitespaceEscape(goog.string.htmlEscape(a.getMessage()))));this.showExceptionText&&a.getException()&&c.push("<br>",goog.string.newLineToBr(goog.string.whitespaceEscape(a.getExceptionText()||"")));c.push("</span>");this.appendNewline&&
c.push("<br>");return c.join("")};goog.debug.TextFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.TextFormatter,goog.debug.Formatter);
goog.debug.TextFormatter.prototype.formatRecord=function(a){var b=[];b.push(this.prefix_," ");this.showAbsoluteTime&&b.push("[",goog.debug.Formatter.getDateTimeStamp_(a),"] ");this.showRelativeTime&&b.push("[",goog.debug.Formatter.getRelativeTime_(a,this.startTimeProvider_.get()),"s] ");this.showLoggerName&&b.push("[",a.getLoggerName(),"] ");this.showSeverityLevel&&b.push("[",a.getLevel().name,"] ");b.push(a.getMessage());this.showExceptionText&&a.getException()&&b.push("\n",a.getExceptionText());
this.appendNewline&&b.push("\n");return b.join("")};goog.debug.Console=function(){this.publishHandler_=goog.bind(this.addLogRecord,this);this.formatter_=new goog.debug.TextFormatter;this.formatter_.showAbsoluteTime=!1;this.isCapturing_=this.formatter_.showExceptionText=!1;this.logBuffer_="";this.filteredLoggers_={}};goog.debug.Console.prototype.getFormatter=function(){return this.formatter_};
goog.debug.Console.prototype.setCapturing=function(a){if(a!=this.isCapturing_){var b=goog.debug.LogManager.getRoot();a?b.addHandler(this.publishHandler_):(b.removeHandler(this.publishHandler_),this.logBuffer="");this.isCapturing_=a}};
goog.debug.Console.prototype.addLogRecord=function(a){if(!this.filteredLoggers_[a.getLoggerName()]){var b=this.formatter_.formatRecord(a),c=goog.debug.Console.console_;if(c)switch(a.getLevel()){case goog.debug.Logger.Level.SHOUT:goog.debug.Console.logToConsole_(c,"info",b);break;case goog.debug.Logger.Level.SEVERE:goog.debug.Console.logToConsole_(c,"error",b);break;case goog.debug.Logger.Level.WARNING:goog.debug.Console.logToConsole_(c,"warn",b);break;default:goog.debug.Console.logToConsole_(c,"debug",
b)}else window.opera?window.opera.postError(b):this.logBuffer_+=b}};goog.debug.Console.prototype.addFilter=function(a){this.filteredLoggers_[a]=!0};goog.debug.Console.prototype.removeFilter=function(a){delete this.filteredLoggers_[a]};goog.debug.Console.instance=null;goog.debug.Console.console_=window.console;goog.debug.Console.setConsole=function(a){goog.debug.Console.console_=a};
goog.debug.Console.autoInstall=function(){goog.debug.Console.instance||(goog.debug.Console.instance=new goog.debug.Console);-1!=window.location.href.indexOf("Debug=true")&&goog.debug.Console.instance.setCapturing(!0)};goog.debug.Console.show=function(){alert(goog.debug.Console.instance.logBuffer_)};goog.debug.Console.logToConsole_=function(a,b,c){if(a[b])a[b](c);else a.log(c)};goog.dom.vendor={};goog.dom.vendor.getVendorJsPrefix=function(){return goog.userAgent.WEBKIT?"Webkit":goog.userAgent.GECKO?"Moz":goog.userAgent.IE?"ms":goog.userAgent.OPERA?"O":null};goog.dom.vendor.getVendorPrefix=function(){return goog.userAgent.WEBKIT?"-webkit":goog.userAgent.GECKO?"-moz":goog.userAgent.IE?"-ms":goog.userAgent.OPERA?"-o":null};
goog.dom.vendor.getPrefixedPropertyName=function(a,b){if(b&&a in b)return a;var c=goog.dom.vendor.getVendorJsPrefix();return c?(c=c.toLowerCase(),c+=goog.string.toTitleCase(a),!goog.isDef(b)||c in b?c:null):null};goog.dom.vendor.getPrefixedEventType=function(a){return((goog.dom.vendor.getVendorJsPrefix()||"")+a).toLowerCase()};goog.math.Box=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};goog.math.Box.boundingBox=function(a){for(var b=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x),c=1;c<arguments.length;c++){var d=arguments[c];b.top=Math.min(b.top,d.y);b.right=Math.max(b.right,d.x);b.bottom=Math.max(b.bottom,d.y);b.left=Math.min(b.left,d.x)}return b};goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)};
goog.DEBUG&&(goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"});goog.math.Box.prototype.contains=function(a){return goog.math.Box.contains(this,a)};goog.math.Box.prototype.expand=function(a,b,c,d){goog.isObject(a)?(this.top-=a.top,this.right+=a.right,this.bottom+=a.bottom,this.left-=a.left):(this.top-=a,this.right+=b,this.bottom+=c,this.left-=d);return this};
goog.math.Box.prototype.expandToInclude=function(a){this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.right=Math.max(this.right,a.right);this.bottom=Math.max(this.bottom,a.bottom)};goog.math.Box.equals=function(a,b){return a==b?!0:a&&b?a.top==b.top&&a.right==b.right&&a.bottom==b.bottom&&a.left==b.left:!1};
goog.math.Box.contains=function(a,b){return a&&b?b instanceof goog.math.Box?b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom:b.x>=a.left&&b.x<=a.right&&b.y>=a.top&&b.y<=a.bottom:!1};goog.math.Box.relativePositionX=function(a,b){return b.x<a.left?b.x-a.left:b.x>a.right?b.x-a.right:0};goog.math.Box.relativePositionY=function(a,b){return b.y<a.top?b.y-a.top:b.y>a.bottom?b.y-a.bottom:0};
goog.math.Box.distance=function(a,b){var c=goog.math.Box.relativePositionX(a,b),d=goog.math.Box.relativePositionY(a,b);return Math.sqrt(c*c+d*d)};goog.math.Box.intersects=function(a,b){return a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom};goog.math.Box.intersectsWithPadding=function(a,b,c){return a.left<=b.right+c&&b.left<=a.right+c&&a.top<=b.bottom+c&&b.top<=a.bottom+c};
goog.math.Box.prototype.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};goog.math.Box.prototype.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};
goog.math.Box.prototype.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};goog.math.Box.prototype.translate=function(a,b){a instanceof goog.math.Coordinate?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,goog.isNumber(b)&&(this.top+=b,this.bottom+=b));return this};
goog.math.Box.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.left*=a;this.right*=a;this.top*=c;this.bottom*=c;return this};goog.math.Rect=function(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d};goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)};goog.math.Rect.prototype.toBox=function(){return new goog.math.Box(this.top,this.left+this.width,this.top+this.height,this.left)};goog.math.Rect.createFromBox=function(a){return new goog.math.Rect(a.left,a.top,a.right-a.left,a.bottom-a.top)};
goog.DEBUG&&(goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"});goog.math.Rect.equals=function(a,b){return a==b?!0:a&&b?a.left==b.left&&a.width==b.width&&a.top==b.top&&a.height==b.height:!1};
goog.math.Rect.prototype.intersection=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var d=Math.max(this.top,a.top);a=Math.min(this.top+this.height,a.top+a.height);if(d<=a)return this.left=b,this.top=d,this.width=c-b,this.height=a-d,!0}return!1};
goog.math.Rect.intersection=function(a,b){var c=Math.max(a.left,b.left),d=Math.min(a.left+a.width,b.left+b.width);if(c<=d){var e=Math.max(a.top,b.top),f=Math.min(a.top+a.height,b.top+b.height);if(e<=f)return new goog.math.Rect(c,e,d-c,f-e)}return null};goog.math.Rect.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};goog.math.Rect.prototype.intersects=function(a){return goog.math.Rect.intersects(this,a)};
goog.math.Rect.difference=function(a,b){var c=goog.math.Rect.intersection(a,b);if(!c||!c.height||!c.width)return[a.clone()];var c=[],d=a.top,e=a.height,f=a.left+a.width,g=a.top+a.height,h=b.left+b.width,k=b.top+b.height;b.top>a.top&&(c.push(new goog.math.Rect(a.left,a.top,a.width,b.top-a.top)),d=b.top,e-=b.top-a.top);k<g&&(c.push(new goog.math.Rect(a.left,k,a.width,g-k)),e=k-d);b.left>a.left&&c.push(new goog.math.Rect(a.left,d,b.left-a.left,e));h<f&&c.push(new goog.math.Rect(h,d,f-h,e));return c};
goog.math.Rect.prototype.difference=function(a){return goog.math.Rect.difference(this,a)};goog.math.Rect.prototype.boundingRect=function(a){var b=Math.max(this.left+this.width,a.left+a.width),c=Math.max(this.top+this.height,a.top+a.height);this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.width=b-this.left;this.height=c-this.top};goog.math.Rect.boundingRect=function(a,b){if(!a||!b)return null;var c=a.clone();c.boundingRect(b);return c};
goog.math.Rect.prototype.contains=function(a){return a instanceof goog.math.Rect?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};goog.math.Rect.prototype.squaredDistance=function(a){var b=a.x<this.left?this.left-a.x:Math.max(a.x-(this.left+this.width),0);a=a.y<this.top?this.top-a.y:Math.max(a.y-(this.top+this.height),0);return b*b+a*a};
goog.math.Rect.prototype.distance=function(a){return Math.sqrt(this.squaredDistance(a))};goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)};goog.math.Rect.prototype.getTopLeft=function(){return new goog.math.Coordinate(this.left,this.top)};goog.math.Rect.prototype.getCenter=function(){return new goog.math.Coordinate(this.left+this.width/2,this.top+this.height/2)};
goog.math.Rect.prototype.getBottomRight=function(){return new goog.math.Coordinate(this.left+this.width,this.top+this.height)};goog.math.Rect.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};goog.math.Rect.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
goog.math.Rect.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Rect.prototype.translate=function(a,b){a instanceof goog.math.Coordinate?(this.left+=a.x,this.top+=a.y):(this.left+=a,goog.isNumber(b)&&(this.top+=b));return this};goog.math.Rect.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.left*=a;this.width*=a;this.top*=c;this.height*=c;return this};goog.style={};goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS=!1;goog.style.setStyle=function(a,b,c){goog.isString(b)?goog.style.setStyle_(a,c,b):goog.object.forEach(b,goog.partial(goog.style.setStyle_,a))};goog.style.setStyle_=function(a,b,c){(c=goog.style.getVendorJsStyleName_(a,c))&&(a.style[c]=b)};goog.style.getVendorJsStyleName_=function(a,b){var c=goog.string.toCamelCase(b);if(void 0===a.style[c]){var d=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(b);if(void 0!==a.style[d])return d}return c};
goog.style.getVendorStyleName_=function(a,b){var c=goog.string.toCamelCase(b);return void 0===a.style[c]&&(c=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(b),void 0!==a.style[c])?goog.dom.vendor.getVendorPrefix()+"-"+b:b};goog.style.getStyle=function(a,b){var c=a.style[goog.string.toCamelCase(b)];return"undefined"!==typeof c?c:a.style[goog.style.getVendorJsStyleName_(a,b)]||""};
goog.style.getComputedStyle=function(a,b){var c=goog.dom.getOwnerDocument(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))?c[b]||c.getPropertyValue(b)||"":""};goog.style.getCascadedStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:null};goog.style.getStyle_=function(a,b){return goog.style.getComputedStyle(a,b)||goog.style.getCascadedStyle(a,b)||a.style&&a.style[b]};
goog.style.getComputedBoxSizing=function(a){return goog.style.getStyle_(a,"boxSizing")||goog.style.getStyle_(a,"MozBoxSizing")||goog.style.getStyle_(a,"WebkitBoxSizing")||null};goog.style.getComputedPosition=function(a){return goog.style.getStyle_(a,"position")};goog.style.getBackgroundColor=function(a){return goog.style.getStyle_(a,"backgroundColor")};goog.style.getComputedOverflowX=function(a){return goog.style.getStyle_(a,"overflowX")};
goog.style.getComputedOverflowY=function(a){return goog.style.getStyle_(a,"overflowY")};goog.style.getComputedZIndex=function(a){return goog.style.getStyle_(a,"zIndex")};goog.style.getComputedTextAlign=function(a){return goog.style.getStyle_(a,"textAlign")};goog.style.getComputedCursor=function(a){return goog.style.getStyle_(a,"cursor")};
goog.style.setPosition=function(a,b,c){var d,e=goog.userAgent.GECKO&&(goog.userAgent.MAC||goog.userAgent.X11)&&goog.userAgent.isVersionOrHigher("1.9");b instanceof goog.math.Coordinate?(d=b.x,b=b.y):(d=b,b=c);a.style.left=goog.style.getPixelStyleValue_(d,e);a.style.top=goog.style.getPixelStyleValue_(b,e)};goog.style.getPosition=function(a){return new goog.math.Coordinate(a.offsetLeft,a.offsetTop)};
goog.style.getClientViewportElement=function(a){a=a?goog.dom.getOwnerDocument(a):goog.dom.getDocument();return!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9)||goog.dom.getDomHelper(a).isCss1CompatMode()?a.documentElement:a.body};goog.style.getViewportPageOffset=function(a){var b=a.body;a=a.documentElement;return new goog.math.Coordinate(b.scrollLeft||a.scrollLeft,b.scrollTop||a.scrollTop)};
goog.style.getBoundingClientRect_=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}goog.userAgent.IE&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b};
goog.style.getOffsetParent=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(8))return a.offsetParent;var b=goog.dom.getOwnerDocument(a),c=goog.style.getStyle_(a,"position"),d="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=goog.style.getStyle_(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null};
goog.style.getVisibleRectForElement=function(a){for(var b=new goog.math.Box(0,Infinity,Infinity,0),c=goog.dom.getDomHelper(a),d=c.getDocument().body,e=c.getDocument().documentElement,f=c.getDocumentScrollElement();a=goog.style.getOffsetParent(a);)if(!(goog.userAgent.IE&&0==a.clientWidth||goog.userAgent.WEBKIT&&0==a.clientHeight&&a==d||a==d||a==e||"visible"==goog.style.getStyle_(a,"overflow"))){var g=goog.style.getPageOffset(a),h=goog.style.getClientLeftTop(a);g.x+=h.x;g.y+=h.y;b.top=Math.max(b.top,
g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}d=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,d);b.top=Math.max(b.top,f);c=c.getViewportSize();b.right=Math.min(b.right,d+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null};
goog.style.getContainerOffsetToScrollInto=function(a,b,c){var d=goog.style.getPageOffset(a),e=goog.style.getPageOffset(b),f=goog.style.getBorderBox(b),g=d.x-e.x-f.left,d=d.y-e.y-f.top,e=b.clientWidth-a.offsetWidth;a=b.clientHeight-a.offsetHeight;f=b.scrollLeft;b=b.scrollTop;c?(f+=g-e/2,b+=d-a/2):(f+=Math.min(g,Math.max(g-e,0)),b+=Math.min(d,Math.max(d-a,0)));return new goog.math.Coordinate(f,b)};
goog.style.scrollIntoContainerView=function(a,b,c){a=goog.style.getContainerOffsetToScrollInto(a,b,c);b.scrollLeft=a.x;b.scrollTop=a.y};
goog.style.getClientLeftTop=function(a){if(goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("1.9")){var b=parseFloat(goog.style.getComputedStyle(a,"borderLeftWidth"));if(goog.style.isRightToLeft(a))var c=a.offsetWidth-a.clientWidth-b-parseFloat(goog.style.getComputedStyle(a,"borderRightWidth")),b=b+c;return new goog.math.Coordinate(b,parseFloat(goog.style.getComputedStyle(a,"borderTopWidth")))}return new goog.math.Coordinate(a.clientLeft,a.clientTop)};
goog.style.getPageOffset=function(a){var b,c=goog.dom.getOwnerDocument(a),d=goog.style.getStyle_(a,"position");goog.asserts.assertObject(a,"Parameter is required");var e=!goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS&&goog.userAgent.GECKO&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==d&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new goog.math.Coordinate(0,0),g=goog.style.getClientViewportElement(c);if(a==g)return f;if(goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS||
a.getBoundingClientRect)b=goog.style.getBoundingClientRect_(a),a=goog.dom.getDomHelper(c).getDocumentScroll(),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!e)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);if(goog.userAgent.WEBKIT&&"fixed"==goog.style.getComputedPosition(b)){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&
b!=a);if(goog.userAgent.OPERA||goog.userAgent.WEBKIT&&"absolute"==d)f.y-=c.body.offsetTop;for(b=a;(b=goog.style.getOffsetParent(b))&&b!=c.body&&b!=g;)f.x-=b.scrollLeft,goog.userAgent.OPERA&&"TR"==b.tagName||(f.y-=b.scrollTop)}return f};goog.style.getPageOffsetLeft=function(a){return goog.style.getPageOffset(a).x};goog.style.getPageOffsetTop=function(a){return goog.style.getPageOffset(a).y};
goog.style.getFramedPageOffset=function(a,b){var c=new goog.math.Coordinate(0,0),d=goog.dom.getWindow(goog.dom.getOwnerDocument(a)),e=a;do{var f=d==b?goog.style.getPageOffset(e):goog.style.getClientPositionForElement_(goog.asserts.assert(e));c.x+=f.x;c.y+=f.y}while(d&&d!=b&&(e=d.frameElement)&&(d=d.parent));return c};
goog.style.translateRectForAnotherFrame=function(a,b,c){if(b.getDocument()!=c.getDocument()){var d=b.getDocument().body;c=goog.style.getFramedPageOffset(d,c.getWindow());c=goog.math.Coordinate.difference(c,goog.style.getPageOffset(d));goog.userAgent.IE&&!b.isCss1CompatMode()&&(c=goog.math.Coordinate.difference(c,b.getDocumentScroll()));a.left+=c.x;a.top+=c.y}};
goog.style.getRelativePosition=function(a,b){var c=goog.style.getClientPosition(a),d=goog.style.getClientPosition(b);return new goog.math.Coordinate(c.x-d.x,c.y-d.y)};
goog.style.getClientPositionForElement_=function(a){var b;if(goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS||a.getBoundingClientRect)b=goog.style.getBoundingClientRect_(a),b=new goog.math.Coordinate(b.left,b.top);else{b=goog.dom.getDomHelper(a).getDocumentScroll();var c=goog.style.getPageOffset(a);b=new goog.math.Coordinate(c.x-b.x,c.y-b.y)}return goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher(12)?goog.math.Coordinate.sum(b,goog.style.getCssTranslation(a)):b};
goog.style.getClientPosition=function(a){goog.asserts.assert(a);if(a.nodeType==goog.dom.NodeType.ELEMENT)return goog.style.getClientPositionForElement_(a);var b=goog.isFunction(a.getBrowserEvent),c=a;a.targetTouches?c=a.targetTouches[0]:b&&a.getBrowserEvent().targetTouches&&(c=a.getBrowserEvent().targetTouches[0]);return new goog.math.Coordinate(c.clientX,c.clientY)};
goog.style.setPageOffset=function(a,b,c){var d=goog.style.getPageOffset(a);b instanceof goog.math.Coordinate&&(c=b.y,b=b.x);goog.style.setPosition(a,a.offsetLeft+(b-d.x),a.offsetTop+(c-d.y))};goog.style.setSize=function(a,b,c){if(b instanceof goog.math.Size)c=b.height,b=b.width;else if(void 0==c)throw Error("missing height argument");goog.style.setWidth(a,b);goog.style.setHeight(a,c)};goog.style.getPixelStyleValue_=function(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a};
goog.style.setHeight=function(a,b){a.style.height=goog.style.getPixelStyleValue_(b,!0)};goog.style.setWidth=function(a,b){a.style.width=goog.style.getPixelStyleValue_(b,!0)};goog.style.getSize=function(a){return goog.style.evaluateWithTemporaryDisplay_(goog.style.getSizeWithDisplay_,a)};
goog.style.evaluateWithTemporaryDisplay_=function(a,b){if("none"!=goog.style.getStyle_(b,"display"))return a(b);var c=b.style,d=c.display,e=c.visibility,f=c.position;c.visibility="hidden";c.position="absolute";c.display="inline";var g=a(b);c.display=d;c.position=f;c.visibility=e;return g};
goog.style.getSizeWithDisplay_=function(a){var b=a.offsetWidth,c=a.offsetHeight,d=goog.userAgent.WEBKIT&&!b&&!c;return goog.isDef(b)&&!d||!a.getBoundingClientRect?new goog.math.Size(b,c):(a=goog.style.getBoundingClientRect_(a),new goog.math.Size(a.right-a.left,a.bottom-a.top))};goog.style.getTransformedSize=function(a){if(!a.getBoundingClientRect)return null;a=goog.style.evaluateWithTemporaryDisplay_(goog.style.getBoundingClientRect_,a);return new goog.math.Size(a.right-a.left,a.bottom-a.top)};
goog.style.getBounds=function(a){var b=goog.style.getPageOffset(a);a=goog.style.getSize(a);return new goog.math.Rect(b.x,b.y,a.width,a.height)};goog.style.toCamelCase=function(a){return goog.string.toCamelCase(String(a))};goog.style.toSelectorCase=function(a){return goog.string.toSelectorCase(a)};
goog.style.getOpacity=function(a){var b=a.style;a="";"opacity"in b?a=b.opacity:"MozOpacity"in b?a=b.MozOpacity:"filter"in b&&(b=b.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(a=String(b[1]/100));return""==a?a:Number(a)};goog.style.setOpacity=function(a,b){var c=a.style;"opacity"in c?c.opacity=b:"MozOpacity"in c?c.MozOpacity=b:"filter"in c&&(c.filter=""===b?"":"alpha(opacity="+100*b+")")};
goog.style.setTransparentBackgroundImage=function(a,b){var c=a.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?c.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+b+'", sizingMethod="crop")':(c.backgroundImage="url("+b+")",c.backgroundPosition="top left",c.backgroundRepeat="no-repeat")};goog.style.clearTransparentBackgroundImage=function(a){a=a.style;"filter"in a?a.filter="":a.backgroundImage="none"};
goog.style.showElement=function(a,b){goog.style.setElementShown(a,b)};goog.style.setElementShown=function(a,b){a.style.display=b?"":"none"};goog.style.isElementShown=function(a){return"none"!=a.style.display};
goog.style.installStyles=function(a,b){var c=goog.dom.getDomHelper(b),d=null,e=c.getDocument();goog.userAgent.IE&&e.createStyleSheet?(d=e.createStyleSheet(),goog.style.setStyles(d,a)):(e=c.getElementsByTagNameAndClass("head")[0],e||(d=c.getElementsByTagNameAndClass("body")[0],e=c.createDom("head"),d.parentNode.insertBefore(e,d)),d=c.createDom("style"),goog.style.setStyles(d,a),c.appendChild(e,d));return d};goog.style.uninstallStyles=function(a){goog.dom.removeNode(a.ownerNode||a.owningElement||a)};
goog.style.setStyles=function(a,b){goog.userAgent.IE&&goog.isDef(a.cssText)?a.cssText=b:a.innerHTML=b};goog.style.setPreWrap=function(a){a=a.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(a.whiteSpace="pre",a.wordWrap="break-word"):a.whiteSpace=goog.userAgent.GECKO?"-moz-pre-wrap":"pre-wrap"};
goog.style.setInlineBlock=function(a){a=a.style;a.position="relative";goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(a.zoom="1",a.display="inline"):a.display=goog.userAgent.GECKO?goog.userAgent.isVersionOrHigher("1.9a")?"inline-block":"-moz-inline-box":"inline-block"};goog.style.isRightToLeft=function(a){return"rtl"==goog.style.getStyle_(a,"direction")};goog.style.unselectableStyle_=goog.userAgent.GECKO?"MozUserSelect":goog.userAgent.WEBKIT?"WebkitUserSelect":null;
goog.style.isUnselectable=function(a){return goog.style.unselectableStyle_?"none"==a.style[goog.style.unselectableStyle_].toLowerCase():goog.userAgent.IE||goog.userAgent.OPERA?"on"==a.getAttribute("unselectable"):!1};
goog.style.setUnselectable=function(a,b,c){c=c?null:a.getElementsByTagName("*");var d=goog.style.unselectableStyle_;if(d){if(b=b?"none":"",a.style[d]=b,c){a=0;for(var e;e=c[a];a++)e.style[d]=b}}else if(goog.userAgent.IE||goog.userAgent.OPERA)if(b=b?"on":"",a.setAttribute("unselectable",b),c)for(a=0;e=c[a];a++)e.setAttribute("unselectable",b)};goog.style.getBorderBoxSize=function(a){return new goog.math.Size(a.offsetWidth,a.offsetHeight)};
goog.style.setBorderBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(!goog.userAgent.IE||d&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(a,b,"border-box");else if(c=a.style,d){var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width-e.left-d.left-d.right-e.right;c.pixelHeight=b.height-e.top-d.top-d.bottom-e.bottom}else c.pixelWidth=b.width,c.pixelHeight=b.height};
goog.style.getContentBoxSize=function(a){var b=goog.dom.getOwnerDocument(a),c=goog.userAgent.IE&&a.currentStyle;if(c&&goog.dom.getDomHelper(b).isCss1CompatMode()&&"auto"!=c.width&&"auto"!=c.height&&!c.boxSizing)return b=goog.style.getIePixelValue_(a,c.width,"width","pixelWidth"),a=goog.style.getIePixelValue_(a,c.height,"height","pixelHeight"),new goog.math.Size(b,a);c=goog.style.getBorderBoxSize(a);b=goog.style.getPaddingBox(a);a=goog.style.getBorderBox(a);return new goog.math.Size(c.width-a.left-
b.left-b.right-a.right,c.height-a.top-b.top-b.bottom-a.bottom)};
goog.style.setContentBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(!goog.userAgent.IE||d&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(a,b,"content-box");else if(c=a.style,d)c.pixelWidth=b.width,c.pixelHeight=b.height;else{var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width+e.left+d.left+d.right+e.right;c.pixelHeight=b.height+e.top+d.top+d.bottom+e.bottom}};
goog.style.setBoxSizingSize_=function(a,b,c){a=a.style;goog.userAgent.GECKO?a.MozBoxSizing=c:goog.userAgent.WEBKIT?a.WebkitBoxSizing=c:a.boxSizing=c;a.width=Math.max(b.width,0)+"px";a.height=Math.max(b.height,0)+"px"};goog.style.getIePixelValue_=function(a,b,c,d){if(/^\d+px?$/.test(b))return parseInt(b,10);var e=a.style[c],f=a.runtimeStyle[c];a.runtimeStyle[c]=a.currentStyle[c];a.style[c]=b;b=a.style[d];a.style[c]=e;a.runtimeStyle[c]=f;return b};
goog.style.getIePixelDistance_=function(a,b){var c=goog.style.getCascadedStyle(a,b);return c?goog.style.getIePixelValue_(a,c,"left","pixelLeft"):0};
goog.style.getBox_=function(a,b){if(goog.userAgent.IE){var c=goog.style.getIePixelDistance_(a,b+"Left"),d=goog.style.getIePixelDistance_(a,b+"Right"),e=goog.style.getIePixelDistance_(a,b+"Top"),f=goog.style.getIePixelDistance_(a,b+"Bottom");return new goog.math.Box(e,d,f,c)}c=goog.style.getComputedStyle(a,b+"Left");d=goog.style.getComputedStyle(a,b+"Right");e=goog.style.getComputedStyle(a,b+"Top");f=goog.style.getComputedStyle(a,b+"Bottom");return new goog.math.Box(parseFloat(e),parseFloat(d),parseFloat(f),
parseFloat(c))};goog.style.getPaddingBox=function(a){return goog.style.getBox_(a,"padding")};goog.style.getMarginBox=function(a){return goog.style.getBox_(a,"margin")};goog.style.ieBorderWidthKeywords_={thin:2,medium:4,thick:6};
goog.style.getIePixelBorder_=function(a,b){if("none"==goog.style.getCascadedStyle(a,b+"Style"))return 0;var c=goog.style.getCascadedStyle(a,b+"Width");return c in goog.style.ieBorderWidthKeywords_?goog.style.ieBorderWidthKeywords_[c]:goog.style.getIePixelValue_(a,c,"left","pixelLeft")};
goog.style.getBorderBox=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){var b=goog.style.getIePixelBorder_(a,"borderLeft"),c=goog.style.getIePixelBorder_(a,"borderRight"),d=goog.style.getIePixelBorder_(a,"borderTop");a=goog.style.getIePixelBorder_(a,"borderBottom");return new goog.math.Box(d,c,a,b)}b=goog.style.getComputedStyle(a,"borderLeftWidth");c=goog.style.getComputedStyle(a,"borderRightWidth");d=goog.style.getComputedStyle(a,"borderTopWidth");a=goog.style.getComputedStyle(a,
"borderBottomWidth");return new goog.math.Box(parseFloat(d),parseFloat(c),parseFloat(a),parseFloat(b))};goog.style.getFontFamily=function(a){var b=goog.dom.getOwnerDocument(a),c="";if(b.body.createTextRange){b=b.body.createTextRange();b.moveToElementText(a);try{c=b.queryCommandValue("FontName")}catch(d){c=""}}c||(c=goog.style.getStyle_(a,"fontFamily"));a=c.split(",");1<a.length&&(c=a[0]);return goog.string.stripQuotes(c,"\"'")};goog.style.lengthUnitRegex_=/[^\d]+$/;
goog.style.getLengthUnits=function(a){return(a=a.match(goog.style.lengthUnitRegex_))&&a[0]||null};goog.style.ABSOLUTE_CSS_LENGTH_UNITS_={cm:1,"in":1,mm:1,pc:1,pt:1};goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_={em:1,ex:1};
goog.style.getFontSize=function(a){var b=goog.style.getStyle_(a,"fontSize"),c=goog.style.getLengthUnits(b);if(b&&"px"==c)return parseInt(b,10);if(goog.userAgent.IE){if(c in goog.style.ABSOLUTE_CSS_LENGTH_UNITS_)return goog.style.getIePixelValue_(a,b,"left","pixelLeft");if(a.parentNode&&a.parentNode.nodeType==goog.dom.NodeType.ELEMENT&&c in goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_)return a=a.parentNode,c=goog.style.getStyle_(a,"fontSize"),goog.style.getIePixelValue_(a,b==c?"1em":b,"left","pixelLeft")}c=
goog.dom.createDom("span",{style:"visibility:hidden;position:absolute;line-height:0;padding:0;margin:0;border:0;height:1em;"});goog.dom.appendChild(a,c);b=c.offsetHeight;goog.dom.removeNode(c);return b};goog.style.parseStyleAttribute=function(a){var b={};goog.array.forEach(a.split(/\s*;\s*/),function(a){a=a.split(/\s*:\s*/);2==a.length&&(b[goog.string.toCamelCase(a[0].toLowerCase())]=a[1])});return b};
goog.style.toStyleAttribute=function(a){var b=[];goog.object.forEach(a,function(a,d){b.push(goog.string.toSelectorCase(d),":",a,";")});return b.join("")};goog.style.setFloat=function(a,b){a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]=b};goog.style.getFloat=function(a){return a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]||""};
goog.style.getScrollbarWidth=function(a){var b=goog.dom.createElement("div");a&&(b.className=a);b.style.cssText="overflow:auto;position:absolute;top:0;width:100px;height:100px";a=goog.dom.createElement("div");goog.style.setSize(a,"200px","200px");b.appendChild(a);goog.dom.appendChild(goog.dom.getDocument().body,b);a=b.offsetWidth-b.clientWidth;goog.dom.removeNode(b);return a};goog.style.MATRIX_TRANSLATION_REGEX_=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;
goog.style.getCssTranslation=function(a){var b;goog.userAgent.IE?b="-ms-transform":goog.userAgent.WEBKIT?b="-webkit-transform":goog.userAgent.OPERA?b="-o-transform":goog.userAgent.GECKO&&(b="-moz-transform");var c;b&&(c=goog.style.getStyle_(a,b));c||(c=goog.style.getStyle_(a,"transform"));return c?(a=c.match(goog.style.MATRIX_TRANSLATION_REGEX_))?new goog.math.Coordinate(parseFloat(a[1]),parseFloat(a[2])):new goog.math.Coordinate(0,0):new goog.math.Coordinate(0,0)};goog.debug.DivConsole=function(a){this.publishHandler_=goog.bind(this.addLogRecord,this);this.formatter_=new goog.debug.HtmlFormatter;this.isCapturing_=this.formatter_.showAbsoluteTime=!1;this.element_=a;this.elementOwnerDocument_=this.element_.ownerDocument||this.element_.document;this.installStyles()};
goog.debug.DivConsole.prototype.installStyles=function(){goog.style.installStyles(".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}",this.element_);this.element_.className+=" logdiv"};
goog.debug.DivConsole.prototype.setCapturing=function(a){if(a!=this.isCapturing_){var b=goog.debug.LogManager.getRoot();a?b.addHandler(this.publishHandler_):(b.removeHandler(this.publishHandler_),this.logBuffer="");this.isCapturing_=a}};
goog.debug.DivConsole.prototype.addLogRecord=function(a){var b=100>=this.element_.scrollHeight-this.element_.scrollTop-this.element_.clientHeight,c=this.elementOwnerDocument_.createElement("div");c.className="logmsg";c.innerHTML=this.formatter_.formatRecord(a);this.element_.appendChild(c);b&&(this.element_.scrollTop=this.element_.scrollHeight)};goog.debug.DivConsole.prototype.getFormatter=function(){return this.formatter_};goog.debug.DivConsole.prototype.setFormatter=function(a){this.formatter_=a};
goog.debug.DivConsole.prototype.addSeparator=function(){var a=this.elementOwnerDocument_.createElement("div");a.className="logmsg logsep";this.element_.appendChild(a)};goog.debug.DivConsole.prototype.clear=function(){this.element_.innerHTML=""};ydn.debug.logger_console=null;ydn.debug.logger_div=null;ydn.debug.logger=goog.debug.Logger.getLogger("ydn.debug");
ydn.debug.log=function(a,b,c){a=a||"ydn";b=goog.isNumber(b)?new goog.debug.Logger.Level("log",b):goog.isString(b)?goog.debug.Logger.Level.getPredefinedLevel(b.toUpperCase()):goog.debug.Logger.Level.FINE;goog.debug.Logger.getLogger(a).setLevel(b);goog.isDef(c)?ydn.debug.logger_div||(ydn.debug.logger_div=new goog.debug.DivConsole(c),ydn.debug.logger_div.setCapturing(!0),goog.debug.LogManager.getRoot().setLevel(goog.debug.Logger.Level.WARNING)):ydn.debug.logger_console||ydn.debug.logger_div||(ydn.debug.logger_console=
new goog.debug.Console,ydn.debug.logger_console.setCapturing(!0),goog.debug.LogManager.getRoot().setLevel(goog.debug.Logger.Level.WARNING))};ydn.debug.ILogger=function(){};ydn.debug.ILogger.prototype.log=function(a){};ydn.debug.ILogger.instance=null;ydn.debug.ILogger.log=function(a){ydn.debug.ILogger.instance&&setTimeout(function(){ydn.debug.ILogger.instance.log(a)},10)};ydn.client={};ydn.client.clients_={};ydn.client.scope_resolvers_=[];ydn.client.setScopeResolver=function(a){ydn.client.scope_resolvers_=[a]};ydn.client.addScopeResolver=function(a){a&&ydn.client.scope_resolvers_.push(a)};ydn.client.setClient=function(a,b){b=b||ydn.http.Scopes.DEFAULT;ydn.client.clients_[b]=a};
ydn.client.getClient=function(a){if(!goog.isDef(a))return ydn.client.clients_[ydn.http.Scopes.DEFAULT];for(var b=a,c=0;c<ydn.client.scope_resolvers_.length;c++){var d=(0,ydn.client.scope_resolvers_[c])(a);if(d){b=d;break}}return ydn.client.clients_[b]||null};ydn.client.clearTransport=function(a){goog.isDef(a)?delete ydn.client.clients_[a]:(ydn.client.clients_={},ydn.client.scope_resolvers_=[])};
ydn.client.getXhrManager=function(){ydn.client.xhr_manager_||(ydn.client.xhr_manager_=new goog.net.XhrManager);return ydn.client.xhr_manager_};ydn.client.HttpRespondData=function(a,b,c,d){goog.isString(a)?this.raw=a:(this.raw=null,this.status=a,this.body=b,this.headers=c||{},this.statusText=d)};
ydn.client.HttpRespondData.prototype.ensureParse=function(){if(this.raw){var a=ydn.json.parse(this.raw);a.gapiRequest&&(a=a.gapiRequest.data);this.status=a.status;this.statusText=a.statusText;this.headers=a.headers;this.body=a.body;this.raw=null}};ydn.client.HttpRespondData.prototype.getStatus=function(){this.ensureParse();return this.status};ydn.client.HttpRespondData.prototype.isSuccess=function(){this.ensureParse();return 200<=this.status&&400>this.status};
ydn.client.HttpRespondData.prototype.getStatusText=function(){this.ensureParse();return this.statusText||""};ydn.client.HttpRespondData.prototype.getBody=function(){this.ensureParse();return this.body};ydn.client.HttpRespondData.prototype.getHeader=function(a){this.ensureParse();return this.headers[a]};ydn.client.HttpRespondData.prototype.getHeaders=function(){this.ensureParse();return this.headers};
ydn.client.HttpRespondData.prototype.isJson=function(){this.ensureParse();if("application/json"==this.getHeader("content-type"))return!0;var a=this.body;return goog.isString(a)&&!goog.string.isEmpty(a)?/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")):!1};
ydn.client.HttpRespondData.prototype.getJson=function(){return this.isJson()&&goog.isString(this.body)?JSON.parse(this.body):this.body};ydn.client.HttpRespondData.wrap=function(a){return a instanceof ydn.client.HttpRespondData?a:goog.isString(a)?new ydn.client.HttpRespondData(a):new ydn.client.HttpRespondData(a.status,a.body,a.headers,a.statusText)};ydn.client.HttpRequestData=function(a,b,c,d,e){this.path=a;this.method=b?b.toUpperCase():"GET";this.params=c||{};this.headers=d||{};this.body=e};
ydn.client.HttpRequestData.prototype.getUri=function(){return this.path};ydn.client.HttpRequestData.prototype.isWriteRequest=function(){return"POST"==this.method||"PUT"==this.method||"DELETE"==this.method};ydn.client.HttpRequestData.wrap=function(a){return a instanceof ydn.client.HttpRequestData?a:new ydn.client.HttpRequestData(a.path,a.method,a.params,a.headers,a.body)};ydn.client.HttpRequest=function(){};ydn.client.HttpRequest.prototype.execute=function(a,b){};ydn.client.Client=function(){};
ydn.client.Client.prototype.request=function(a){};ydn.client.error_logger=null;ydn.client.SimpleHttpRequest=function(a,b){this.xm_=goog.isDef(b)?b:ydn.client.getXhrManager();this.id_="sr"+ydn.client.SimpleHttpRequest.IdCount_++;this.req_data=a};ydn.client.SimpleHttpRequest.IdCount_=0;ydn.client.SimpleHttpRequest.prototype.getId=function(){return this.id_};
ydn.client.SimpleHttpRequest.prototype.execute=function(a,b){goog.asserts.assert(this.xm_,this+" already executed.");var c=this.req_data,d=new goog.Uri(c.path),e;for(e in c.params)d.setParameterValue(e,c.params[e]);this.xm_.send(this.id_,d.toString(),c.method,c.body,c.headers,void 0,function(d){d=d.target;for(var e=d.getAllResponseHeaders().split("\n"),h={},k=0;k<e.length;k++){var l=e[k].indexOf(":");if(0<l){var m=e[k].substr(0,l).toLowerCase();h[m]=e[k].substr(l+1).trim()}}e=k=d.getResponse();if(h["content-type"]&&
/json/.test(h["content-type"]))if(goog.isObject(k))e=k;else if(goog.isString(k))try{e=ydn.json.parse(k)}catch(n){e=k}h=new ydn.client.HttpRespondData(d.getStatus(),k,h,d.getStatusText());ydn.client.error_logger&&!h.isSuccess()&&ydn.client.error_logger.log({"class":"ydn.gdata.Entry",method:"commit",context:"HTTP request",HttpRequestData:{path:c.path,uri:d.getLastUri(),method:c.method,params:c.params,headers:c.headers,body:c.body},HttpRespondData:{status:h.getStatus(),statusText:h.getStatusText(),body:h.getBody(),
headers:h.getHeaders()}});a&&(a.call(b,e,h),a=null)});this.xm_=null};goog.DEBUG&&(ydn.client.SimpleHttpRequest.prototype.toString=function(){return"HTTPRequest:"+this.id_});ydn.client.OAuthProvider=function(){};ydn.client.OAuthClient=function(a,b,c){this.provider=a;this.xm=b;this.token=null;this.use_header_authorization=goog.isDef(c)?c:ydn.client.OAuthClient.USE_AUTHORIZATION_HEADER};ydn.client.OAuthClient.prototype.request=function(a){return new ydn.client.OAuthClient.Request(a,this)};ydn.client.OAuthClient.Request=function(a,b){ydn.client.SimpleHttpRequest.call(this,a,b.xm);this.parent=b;this.no_retry_=!1};goog.inherits(ydn.client.OAuthClient.Request,ydn.client.SimpleHttpRequest);
ydn.client.OAuthClient.DEBUG=!1;ydn.client.OAuthClient.USE_AUTHORIZATION_HEADER=!0;ydn.client.OAuthClient.Request.ERR_RESP=new ydn.client.HttpRespondData(0,null,null,"No access token");
ydn.client.OAuthClient.Request.prototype.execute=function(a,b){var c=this,d=function(){ydn.client.OAuthClient.USE_AUTHORIZATION_HEADER?c.req_data.headers.Authorization="Bearer "+c.parent.token.access_token:c.req_data.params.access_token=c.parent.token.access_token};c.parent.token&&c.parent.token.expires>goog.now()?(d(),ydn.client.OAuthClient.Request.superClass_.execute.call(this,function(e,f){401==f.getStatus()?(ydn.client.OAuthClient.DEBUG&&(window.console.log(c.parent.token),window.console.log("Although not expires, refreshing token due to "+
f.getStatus()+" "+f.getStatusText())),c.parent.provider.getOAuthToken().addCallbacks(function(e){c.parent.token=e;d();ydn.client.OAuthClient.Request.superClass_.execute.call(c,a,b)},function(d){c.parent.token=null;a.call(b,null,ydn.client.OAuthClient.Request.ERR_RESP)},c)):a.call(b,e,f)},this)):this.parent.provider.getOAuthToken().addCallbacks(function(e){c.parent.token=e;d();ydn.client.OAuthClient.Request.superClass_.execute.call(this,a,b)},function(d){c.parent.token=null;a.call(b,null,ydn.client.OAuthClient.Request.ERR_RESP)},
this)};ydn.crm.base={};ydn.crm.base.RAW=!1;ydn.crm.base.LOCAL_STORE_PREFIX="app";ydn.crm.base.SessionKey={LAST_URL:"lu"};ydn.crm.base.LocalKey={WHAT:"sd",USER_SETTING:"st"};ydn.crm.base.VERSION_MAJOR=0;ydn.crm.base.VERSION_MINOR=4;ydn.crm.base.VERSION_PATCH=1;ydn.crm.version=ydn.crm.base.VERSION_MAJOR+"."+ydn.crm.base.VERSION_MINOR+"."+ydn.crm.base.VERSION_PATCH;ydn.crm.base.VERSION_STABLE="0.2.139";ydn.crm.base.VERSION_BETA="0.2.140";
ydn.crm.base.Theme={DESKTOP:"featured",SIMPLICITY:"simplicity",MOBILE:"mobile",TABLET:"tablet"};ydn.crm.base.THEME_DEFAULT=ydn.crm.base.Theme.DESKTOP;ydn.crm.base.Track={STABLE:"stable",BETA:"beta",EDGE:"edge"};ydn.crm.base.getUserSetting=function(){};ydn.crm.base.LOGIN_ORIGIN="https://yathit-app.appspot.com";ydn.crm.base.APP_ID="cm";ydn.crm.base.DEV_MODE="chrome-extension://fmhdpfhfppingdiiefgnanjceieflpkj/"==chrome.extension.getURL("");ydn.crm.base.BASE_PATH=ydn.crm.base.DEV_MODE?"crm-ex/":"";
ydn.crm.base.OPTION_PAGE=ydn.crm.base.BASE_PATH+"option-page.html";ydn.crm.base.HOST_PERMISSION_PAGE=ydn.crm.base.BASE_PATH+"host-permission.html";ydn.crm.Client=function(){};ydn.crm.Client.prototype.logger=goog.debug.Logger.getLogger("ydn.crm.Client");ydn.client.AdaptorClient=function(a,b,c){this.client=a;this.adaptor=b;this.scope=c};ydn.client.AdaptorClient.prototype.request=function(a){a=this.adaptor.call(this.scope,a);return this.client.request(a)};ydn.client.FilteredClient=function(a,b,c){this.filter_=a;this.pass_client_=b;this.fail_client_=c};ydn.client.FilteredClient.prototype.request=function(a){return this.filter_(a)?this.pass_client_.request(a):this.fail_client_.request(a)};ydn.client.SerialProxy={};ydn.client.Proxy=function(a,b){this.client=a;this.proxy_path=b;this.next_retry=NaN;this.reqs_=[];this.in_req_=!1};ydn.client.Proxy.prototype.request=function(a){return new ydn.client.Proxy.Request(a,this)};ydn.client.Proxy.prototype.getProxyPath=function(){return this.proxy_path};ydn.client.Proxy.Request=function(a,b){a.path=b.proxy_path+a.path;this.req=b.client.request(a);this.parent=b;this.cb_=null;this.scope_=void 0};goog.inherits(ydn.client.Proxy.Request,ydn.client.SimpleHttpRequest);
ydn.client.Proxy.DEBUG=goog.DEBUG;
ydn.client.Proxy.Request.prototype.execute=function(a,b){if(this.parent.in_req_)this.cb_=a,this.scope_=b,this.parent.reqs_.push(this);else{this.parent.in_req_=!0;var c=function(c,d){var g=d.getHeader("retry-after");g?(/[^0-9|\.]/.test(g)?this.parent.next_retry=(new Date(g)).getTime():this.parent.next_retry=1E3*parseFloat(g)+goog.now(),ydn.client.Proxy.DEBUG&&goog.global.console.info("Next retry "+this.parent.next_retry+", now "+goog.now())):this.parent.next_retry=NaN;a&&a.call(b,c,d);this.parent.in_req_=
!1;if(g=this.parent.reqs_.pop())g.execute(g.cb_,g.scope_),g.cb_=null,g.scope_=null},d=this.parent.next_retry-goog.now();0<d?(ydn.client.Proxy.DEBUG&&goog.global.console.info("Proxy will call after "+d+" ms"),goog.Timer.callOnce(function(){this.parent.next_retry=NaN;this.req.execute(c,this)},d,this)):this.req.execute(c,this)}};
ydn.client.Proxy.test_=function(a){var b=ydn.client.getClient("proxy");goog.global.console.assert(b,"no proxy client");b.request(new ydn.client.HttpRequestData("https://api.mixpanel.com/track/")).execute(function(b,d){goog.global.console.info(a);0<a&&(a--,ydn.client.Proxy.test_(a))})};ydn.crm.shared={};ydn.crm.shared.logger=goog.debug.Logger.getLogger("ydn.crm.shared");ydn.crm.shared.log=function(){ydn.debug.log("ydn.crm","finest")};ydn.crm.shared.getXhrManager=function(){ydn.crm.shared.xhr_manager_||(ydn.crm.shared.xhr_manager_=new goog.net.XhrManager(0));return ydn.crm.shared.xhr_manager_};
ydn.crm.shared.getClient=function(){ydn.crm.shared.client_||(ydn.crm.shared.client_=new ydn.client.SimpleClient(ydn.crm.shared.getXhrManager()),ydn.client.setClient(ydn.crm.shared.client_,ydn.http.Scopes.DEFAULT));return ydn.crm.shared.client_};
ydn.crm.shared.setupClients=function(a){var b=ydn.crm.shared.getClient();a=new ydn.client.OAuthClient(a,ydn.crm.shared.xhr_manager_);ydn.client.setClient(a,ydn.http.Scopes.GOOGLE_CLIENT);var c=ydn.crm.base.LOGIN_ORIGIN+"/proxy/",b=new ydn.client.Proxy(b,c),d=new ydn.client.AdaptorClient(a,function(a){a.path=c+a.path;return a});ydn.client.setClient(b,ydn.http.Scopes.PROXY);a=new ydn.client.FilteredClient(function(a){return"GET"==a.method},a,d);ydn.client.setClient(a,ydn.http.Scopes.GSE)};
ydn.crm.shared.getLoginClient=function(){ydn.crm.shared.login_client_||(ydn.crm.shared.getClient(),ydn.crm.shared.login_client_=new ydn.client.SimpleClient(ydn.crm.shared.getXhrManager(),void 0,ydn.crm.base.LOGIN_ORIGIN),ydn.client.setClient(ydn.crm.shared.login_client_,ydn.http.Scopes.LOGIN));return ydn.crm.shared.login_client_};
ydn.crm.shared.getAppClient=function(){ydn.crm.shared.app_client_||(ydn.crm.shared.app_client_=new ydn.client.SimpleClient(ydn.crm.shared.getXhrManager(),void 0,ydn.crm.base.LOGIN_ORIGIN+"/a/"+ydn.crm.base.APP_ID),ydn.client.setClient(ydn.crm.shared.app_client_,ydn.http.Scopes.AUTH));return ydn.crm.shared.app_client_};ydn.crm.shared.Setting={SUGAR_DOMAINS:"sd"};ydn.crm.shared.setting_={};ydn.crm.shared.id_="";ydn.crm.shared.getSetting=function(a){return ydn.crm.shared.setting_[a]};
ydn.crm.shared.setSetting=function(a,b){ydn.crm.shared.setting_[a]=b;var c={};c[ydn.crm.shared.id_]=ydn.crm.shared.setting_;chrome.storage.local.set(c)};ydn.crm.shared.setupSetting=function(a,b,c){ydn.crm.shared.id_=a+"-setting";chrome.storage.local.get(ydn.crm.shared.id_,function(a){a[ydn.crm.shared.id_]&&(ydn.crm.shared.setting_=a[ydn.crm.shared.id_]);b.call(c)})};ydn.db={};ydn.db.KeyRange=function(a,b,c,d){this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d;goog.DEBUG&&goog.isFunction(Object.freeze)&&Object.freeze(this)};ydn.db.KeyRange.prototype.lower=void 0;ydn.db.KeyRange.prototype.upper=void 0;ydn.db.KeyRange.prototype.toJSON=function(){return ydn.db.KeyRange.toJSON(this)};ydn.db.KeyRange.prototype.toIDBKeyRange=function(){return ydn.db.KeyRange.parseIDBKeyRange(this)};
ydn.db.KeyRange.clone=function(a){if(goog.isDefAndNotNull(a))return new ydn.db.KeyRange(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen)};ydn.db.KeyRange.only=function(a){return new ydn.db.KeyRange(a,a,!1,!1)};ydn.db.KeyRange.bound=function(a,b,c,d){return new ydn.db.KeyRange(a,b,c,d)};ydn.db.KeyRange.upperBound=function(a,b){return new ydn.db.KeyRange(void 0,a,void 0,!!b)};ydn.db.KeyRange.lowerBound=function(a,b){return new ydn.db.KeyRange(a,void 0,!!b,void 0)};
ydn.db.KeyRange.starts=function(a){var b;if(goog.isArray(a))b=goog.array.clone(a),b.push("\uffff");else if(goog.isString(a))b=a+"\uffff";else if(goog.isNumber(a))b=a+2.220460492503131E-16,a-=2.220460492503131E-16;else return ydn.db.KeyRange.only(a);return ydn.db.KeyRange.bound(a,b,!1,!0)};ydn.db.KeyRange.toJSON=function(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}};
ydn.db.KeyRange.parseKeyRange=function(a){if(!goog.isDefAndNotNull(a))return null;if(a instanceof ydn.db.KeyRange)return a;if(goog.isObject(a))return new ydn.db.KeyRange(a.lower,a.upper,a.lowerOpen,a.upperOpen);throw new ydn.debug.error.ArgumentException("Invalid key range: "+a+" of type "+typeof a);};
ydn.db.KeyRange.parseIDBKeyRange=function(a){return goog.isDefAndNotNull(a)?goog.isDefAndNotNull(a.upper)&&goog.isDefAndNotNull(a.lower)?ydn.db.IDBKeyRange.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):goog.isDefAndNotNull(a.upper)?ydn.db.IDBKeyRange.upperBound(a.upper,a.upperOpen):goog.isDefAndNotNull(a.lower)?ydn.db.IDBKeyRange.lowerBound(a.lower,a.lowerOpen):null:null};
ydn.db.KeyRange.validate=function(a){if(a instanceof ydn.db.KeyRange)return"";if(goog.isDefAndNotNull(a)){if(goog.isObject(a)){for(var b in a)if(a.hasOwnProperty(b)&&!goog.array.contains(["lower","upper","lowerOpen","upperOpen"],b))return'invalid attribute "'+b+'" in key range object';return""}return"key range must be an object"}return""};
ydn.db.KeyRange.prototype.and=function(a){var b=this.lower,c=this.upper,d=this.lowerOpen,e=this.upperOpen;goog.isDefAndNotNull(a.lower)&&(!goog.isDefAndNotNull(this.lower)||a.lower>=this.lower)&&(b=a.lower,d=a.lowerOpen||this.lowerOpen);goog.isDefAndNotNull(a.upper)&&(!goog.isDefAndNotNull(this.upper)||a.upper<=this.upper)&&(c=a.upper,e=a.upperOpen||this.upperOpen);return ydn.db.KeyRange.bound(b,c,d,e)};
ydn.db.KeyRange.toString=function(a){if(!a)return"";var b=a.lowerOpen?"(":"[";goog.isDefAndNotNull(a.lower)&&(b+=a.lower+", ");goog.isDefAndNotNull(a.upper)&&(b+=a.upper);return b+=a.upperOpen?")":"]"};
ydn.db.KeyRange.toSql=function(a,b,c,d,e){if(c)if(!c.lowerOpen&&!c.upperOpen&&goog.isDefAndNotNull(c.lower)&&goog.isDefAndNotNull(c.upper)&&0===ydn.db.cmp(c.lower,c.upper))d.push(a+" = ?"),e.push(ydn.db.schema.Index.js2sql(c.lower,b));else{if(goog.isDefAndNotNull(c.lower)){var f=c.lowerOpen?" > ":" >= ";d.push(a+f+"?");e.push(ydn.db.schema.Index.js2sql(c.lower,b))}goog.isDefAndNotNull(c.upper)&&(f=c.upperOpen?" < ":" <= ",d.push(a+f+"?"),e.push(ydn.db.schema.Index.js2sql(c.upper,b)))}};
ydn.db.KeyRange.where=function(a,b,c,d){var e,f,g,h;if("starts"==a||"^"==a)return goog.asserts.assert(goog.isString(b)||goog.isArray(b),"key value of starts with must be an array or a string"),goog.asserts.assert(!goog.isDef(c),"op2 must not be defined"),goog.asserts.assert(!goog.isDef(d),"value2 must not be defined"),ydn.db.KeyRange.starts(b);if("<"==a||"<="==a)e=b,g="<"==a;else if(">"==a||">="==a)f=b,h=">"==a;else if("="==a||"=="==a)e=f=b;else throw new ydn.debug.error.ArgumentException("invalid op: "+
a);if("<"==c||"<="==c)e=d,g="<"==c;else if(">"==c||">="==c)f=d,h=">"==c;else if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("invalid op2: "+c);return ydn.db.KeyRange.bound(f,e,h,g)};ydn.db.IDBKeyRange=goog.global.IDBKeyRange||goog.global.webkitIDBKeyRange||ydn.db.KeyRange;ydn.db.utils={};ydn.db.utils.getValueByKeys=function(a,b){var c,d;2==arguments.length&&goog.isString(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=goog.isArrayLike(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],goog.isDef(a));c++);return a};ydn.db.utils.setValueByKeys=function(a,b,c){if(a)if(-1==b.indexOf("."))a[b]=c;else{b=b.split(".");for(var d=b.pop(),e;e=b.shift();)goog.isObject(a[e])||(goog.asserts.assert(!goog.isDef(a[e]),'key "'+e+'" is not on path'),a[e]={}),a=a[e];a[d]=c}};
ydn.db.utils.ARRAY_TERMINATOR={};ydn.db.utils.BYTE_TERMINATOR=0;ydn.db.utils.TYPE_NUMBER=1;ydn.db.utils.TYPE_DATE=2;ydn.db.utils.TYPE_STRING=3;ydn.db.utils.TYPE_ARRAY=4;ydn.db.utils.MAX_TYPE_BYTE_SIZE=12;
ydn.db.utils.encodeKey=function(a){a=[a];for(var b=new ydn.db.utils.HexStringWriter,c=0,d,e;void 0!==(e=a.pop());){0===c%4&&c+ydn.db.utils.TYPE_ARRAY>ydn.db.utils.MAX_TYPE_BYTE_SIZE&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=ydn.db.utils.TYPE_ARRAY,0<e.length){a.push(ydn.db.utils.ARRAY_TERMINATOR);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=ydn.db.utils.TYPE_NUMBER,b.write(c),ydn.db.utils.encodeNumber(b,e);else if(e instanceof Date)c+=ydn.db.utils.TYPE_DATE,
b.write(c),ydn.db.utils.encodeNumber(b,e.valueOf());else if("string"===d)c+=ydn.db.utils.TYPE_STRING,b.write(c),ydn.db.utils.encodeString(b,e);else if(e===ydn.db.utils.ARRAY_TERMINATOR)b.write(ydn.db.utils.BYTE_TERMINATOR);else return"";c=0}return b.trim().toString()};
ydn.db.utils.decodeKey=function(a){for(var b=[],c=b,d=[],e,f,g=new ydn.db.utils.HexStringReader(a);null!=g.read();)if(0===g.current)c=d.pop();else{if(null===g.current)break;do{e=g.current/4|0;a=g.current%4;for(var h=0;h<e;h++)f=[],c.push(f),d.push(c),c=f;if(0===a&&g.current+ydn.db.utils.TYPE_ARRAY>ydn.db.utils.MAX_TYPE_BYTE_SIZE)g.read();else break}while(1);a===ydn.db.utils.TYPE_NUMBER?c.push(ydn.db.utils.decodeNumber(g)):a===ydn.db.utils.TYPE_DATE?c.push(new Date(ydn.db.utils.decodeNumber(g))):a===
ydn.db.utils.TYPE_STRING?c.push(ydn.db.utils.decodeString(g)):0===a&&(c=d.pop())}return b[0]};ydn.db.utils.p16=65536;ydn.db.utils.p32=4294967296;ydn.db.utils.p48=281474976710656;ydn.db.utils.p52=4503599627370496;ydn.db.utils.pNeg1074=4.9E-324;ydn.db.utils.pNeg1022=2.2250738585072014E-308;
ydn.db.utils.ieee754=function(a){var b=0,c=0,d=0;if(0!==a)if(isFinite(a)){0>a&&(b=1,a=-a);d=0;if(a>=ydn.db.utils.pNeg1022){for(c=a;1>c;)d--,c*=2;for(;2<=c;)d++,c/=2;c=d+1023}d=c?Math.floor((a/Math.pow(2,d)-1)*ydn.db.utils.p52):Math.floor(a/ydn.db.utils.pNeg1074)}else c=2047,isNaN(a)?d=0x8000000000000:-Infinity===a&&(b=1);return{sign:b,exponent:c,mantissa:d}};
ydn.db.utils.encodeNumber=function(a,b){var c=ydn.db.utils.ieee754(b);c.sign&&(c.mantissa=ydn.db.utils.p52-1-c.mantissa,c.exponent=2047-c.exponent);var d=c.mantissa;a.write((c.sign?0:128)|c.exponent>>4);a.write((c.exponent&15)<<4|0|d/ydn.db.utils.p48);d%=ydn.db.utils.p48;c=0|d/ydn.db.utils.p32;a.write(c>>8,c&255);d%=ydn.db.utils.p32;c=0|d/ydn.db.utils.p16;a.write(c>>8,c&255);c=d%ydn.db.utils.p16;a.write(c>>8,c&255)};
ydn.db.utils.decodeNumber=function(a){var b=a.read()|0,c=b>>7?!1:!0,d=c?-1:1,e=(b&127)<<4,b=a.read()|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(a.read()|0):a.read()|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d};ydn.db.utils.secondLayer=16510;
ydn.db.utils.encodeString=function(a,b){for(var c=0;c<b.length;c++){var d=b.charCodeAt(c);126>=d?a.write(d+1):d<=ydn.db.utils.secondLayer?(d-=127,a.write(128|d>>8,d&255)):a.write(192|d>>10,d>>2|255,(d|3)<<6)}a.write(ydn.db.utils.BYTE_TERMINATOR)};
ydn.db.utils.decodeString=function(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=a.read();if(0===f||null==f)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")};ydn.db.utils.HexStringReader=function(a){this.current=null;this.string=a;this.lastIndex=this.string.length-1;this.index=-1};
ydn.db.utils.HexStringReader.prototype.read=function(){return this.current=this.index<this.lastIndex?parseInt(this.string[++this.index]+this.string[++this.index],16):null};ydn.db.utils.HexStringWriter=function(){this.buffer=[];this.c=void 0};ydn.db.utils.HexStringWriter.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.c=arguments[b].toString(16),this.buffer.push(2===this.c.length?this.c:this.c="0"+this.c)};
ydn.db.utils.HexStringWriter.prototype.trim=function(){for(var a=this.buffer.length;"00"===this.buffer[--a];);this.buffer.length=++a;return this};ydn.db.utils.HexStringWriter.prototype.toString=function(){return this.buffer.length?this.buffer.join(""):""};ydn.db.utils.cmp=function(a,b){var c=ydn.db.utils.encodeKey(a),d=ydn.db.utils.encodeKey(b);return c>d?1:c==d?0:-1};ydn.db.Where=function(a,b,c,d,e){this.key_range_=b instanceof ydn.db.KeyRange?b:goog.isString(b)&&goog.isDef(c)?ydn.db.KeyRange.where(b,c,d,e):ydn.db.KeyRange.parseKeyRange(b);this.field=a};ydn.db.Where.prototype.field="";ydn.db.Where.prototype.getField=function(){return this.field};ydn.db.Where.prototype.getKeyRange=function(){return this.key_range_};
ydn.db.Where.resolvedStartsWith=function(a){return goog.isDefAndNotNull(a)&&goog.isDefAndNotNull(a.lower)&&goog.isDefAndNotNull(a.upper)?goog.isArray(a.lower)&&goog.isArray(a.upper)?a.lower.length==a.upper.length-1&&"\uffff"==a.upper[a.upper.length-1]&&a.lower.every(function(b,c){return b==a.upper[c]}):!a.lowerOpen&&!a.upperOpen&&a.lower.length==a.upper.length+1&&"\uffff"==a.upper[a.lower.length-1]:!1};
ydn.db.Where.prototype.and=function(a){if(this.field!=a.field)return null;a=goog.isDefAndNotNull(this.key_range_)&&goog.isDefAndNotNull(a.key_range_)?this.key_range_.and(a.key_range_):this.key_range_||a.key_range_;return new ydn.db.Where(this.field,a)};ydn.db.base={};ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME="_ROWID_";ydn.db.base.DEFAULT_BLOB_COLUMN="_default_";ydn.db.base.DISPATCH_EVENT=!1;ydn.db.base.DEFAULT_RESULT_LIMIT=100;ydn.db.base.DEFAULT_CONNECTION_TIMEOUT=18E5;ydn.db.base.Mechanisms={IDB:"indexeddb",USER_DATA:"userdata",LOCAL_STORAGE:"localstorage",MEMORY_STORAGE:"memory",SESSION_STORAGE:"sessionstorage",WEBSQL:"websql"};ydn.db.base.TxEventTypes={COMPLETE:"complete",ABORT:"abort",ERROR:"error"};
ydn.db.base.StandardTransactionMode={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"};ydn.db.base.IDBTransaction=goog.global.IDBRequest&&"LOADING"in goog.global.IDBRequest?goog.global.IDBTransaction:goog.global.webkitIDBRequest&&"LOADING"in goog.global.webkitIDBRequest&&1===goog.global.webkitIDBTransaction.READ_WRITE?goog.global.webkitIDBTransaction:ydn.db.base.StandardTransactionMode;
ydn.db.base.TransactionMode={READ_ONLY:ydn.db.base.IDBTransaction.READ_ONLY,READ_WRITE:ydn.db.base.IDBTransaction.READ_WRITE,VERSION_CHANGE:ydn.db.base.IDBTransaction.VERSION_CHANGE};ydn.db.base.ENABLE_DEFAULT_TEXT_STORE=!1;ydn.db.base.ENABLE_ENCRYPTION=!1;ydn.db.base.Direction={NEXT:"next",NEXT_UNIQUE:"nextunique",PREV:"prev",PREV_UNIQUE:"prevunique"};ydn.db.base.DIRECTIONS=[ydn.db.base.Direction.NEXT,ydn.db.base.Direction.NEXT_UNIQUE,ydn.db.base.Direction.PREV,ydn.db.base.Direction.PREV_UNIQUE];
ydn.db.base.getDirection=function(a,b){return a?b?ydn.db.base.Direction.PREV_UNIQUE:ydn.db.base.Direction.PREV:b?ydn.db.base.Direction.NEXT_UNIQUE:ydn.db.base.Direction.NEXT};ydn.db.base.indexedDb=goog.global.indexedDB||goog.global.mozIndexedDB||goog.global.webkitIndexedDB||goog.global.moz_indexedDB||goog.global.msIndexedDB;ydn.db.base.PREFIX_MULTIENTRY="ydn.db.me:";ydn.db.base.QueryMethod={NONE:0,LIST_KEY:1,LIST_PRIMARY_KEY:2,LIST_KEYS:3,LIST_VALUE:4,GET:5,COUNT:6};ydn.db.core={};ydn.db.core.req={};
ydn.db.core.req.AbstractCursor=function(a,b,c,d){goog.Disposable.call(this);this.store_schema=c;this.store_name=c.getName();this.index_name=void 0;this.is_index=!1;this.key_range=null;this.tx=a;this.tx_no=b;this.count_=0;this.exited_=this.done_=!1;this.query_method=d||ydn.db.base.QueryMethod.LIST_VALUE;this.value_=this.primary_key_=this.key_=void 0;this.onNext=function(a){throw new ydn.debug.error.InternalError;};this.onFail=function(a){throw new ydn.debug.error.InternalError;};this.onTerminated=
function(a,b,c){}};goog.inherits(ydn.db.core.req.AbstractCursor,goog.Disposable);
ydn.db.core.req.AbstractCursor.prototype.init=function(a,b,c,d,e){goog.asserts.assert(this.store_name==a,"expect store name of "+this.store_name+" but "+a+" found.");goog.isDef(b)&&(this.index_name=this.store_schema.getIndexName(b),goog.asserts.assertString(this.index_name,'index "'+b+'" not found in store "'+a+'"'));this.is_index=goog.isString(this.index_name);this.key_range=c||null;this.count_=0;this.exited_=this.done_=!1;this.reverse=d==ydn.db.base.Direction.PREV||d==ydn.db.base.Direction.PREV_UNIQUE;
this.unique=d==ydn.db.base.Direction.NEXT_UNIQUE||d==ydn.db.base.Direction.PREV_UNIQUE;this.dir=d;this.is_key_cursor_=e;this.value_=this.primary_key_=this.key_=void 0};ydn.db.core.req.AbstractCursor.prototype.dir="";ydn.db.core.req.AbstractCursor.prototype.key_range=null;ydn.db.core.req.AbstractCursor.prototype.unique=!1;ydn.db.core.req.AbstractCursor.prototype.reverse=!1;ydn.db.core.req.AbstractCursor.prototype.is_key_cursor_=!0;ydn.db.core.req.AbstractCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.AbstractCursor");
ydn.db.core.req.AbstractCursor.prototype.isActive=function(){return!!this.tx};ydn.db.core.req.AbstractCursor.prototype.isIndexCursor=function(){return this.is_index};ydn.db.core.req.AbstractCursor.prototype.isPrimaryCursor=function(){return!this.is_index};ydn.db.core.req.AbstractCursor.prototype.isValueCursor=function(){return!this.is_key_cursor_};ydn.db.core.req.AbstractCursor.prototype.onError=function(a){this.onFail(a);this.finalize_();this.done_=!0};
ydn.db.core.req.AbstractCursor.prototype.onSuccess=function(a,b,c){goog.isDefAndNotNull(a)||(this.logger.finer(this+" finished."),this.done_=!0);this.key_=a;this.primary_key_=b;this.value_=c;this.count_++;this.done_?(this.logger.finest(this+" DONE."),this.onNext(),this.finalize_()):(this.logger.finest(this+" new cursor position {"+(this.is_index?this.key_+", "+this.primary_key_:this.key_)+"}"),this.onNext(this.key_))};ydn.db.core.req.AbstractCursor.prototype.disposeInternal=function(){this.tx=null};
goog.DEBUG&&(ydn.db.core.req.AbstractCursor.prototype.toString=function(){var a=goog.isDef(this.index_name)?":"+this.index_name:"";return"Cursor:"+this.store_name+a+"["+(this.tx?"":"~")+this.tx_no+"]"});
ydn.db.core.req.AbstractCursor.prototype.finalize_=function(){goog.isDefAndNotNull(this.primary_key_)?this.primary_key_=ydn.db.Key.clone(this.primary_key_):this.primary_key_=void 0;goog.isDefAndNotNull(this.key_)?this.key_=ydn.db.Key.clone(this.key_):this.key_=void 0;this.onTerminated(this.exited_,this.key_,this.primary_key_)};
ydn.db.core.req.AbstractCursor.prototype.open=function(a,b,c,d){this.tx=a;this.tx_no=b;this.done_=this.exited_=!1;this.key_=c;this.primary_key_=d;this.openCursor(this.key_,this.primary_key_)};ydn.db.core.req.AbstractCursor.prototype.resume=function(a,b){this.done_?this.open(a,b):this.open(a,b,this.key_,this.primary_key_)};ydn.db.core.req.AbstractCursor.prototype.exit=function(){this.exited_=!0;this.logger.finest(this+": exit");this.finalize_()};ydn.db.core.req.AbstractCursor.prototype.getCount=function(){return this.count_};
ydn.db.core.req.AbstractCursor.prototype.getKey=function(){return this.key_};ydn.db.core.req.AbstractCursor.prototype.getPrimaryKey=function(){return this.isIndexCursor()?this.primary_key_:this.key_};ydn.db.core.req.AbstractCursor.prototype.getValue=function(a){return this.isValueCursor()?this.value_:this.getPrimaryKey()};ydn.db.core.req.AbstractCursor.prototype.hasDone=function(){return this.done_};ydn.db.core.req.AbstractCursor.prototype.isExited=function(){return this.exited_};
ydn.db.core.req.AbstractCursor.prototype.continuePrimaryKey=function(a){};ydn.db.core.req.AbstractCursor.prototype.continueEffectiveKey=function(a){};ydn.db.core.req.AbstractCursor.prototype.restart=function(a,b){this.logger.finest(this+" restarting");this.exited_=this.done_=!1;this.openCursor(b,a)};ydn.db.core.AbstractIterator=function(){};ydn.db.core.req.ICursor=function(){};ydn.db.core.req.ICursor.prototype.openCursor=function(a,b){};ydn.db.core.req.ICursor.prototype.continuePrimaryKey=function(a){};ydn.db.core.req.ICursor.prototype.continueEffectiveKey=function(a){};ydn.db.core.req.ICursor.prototype.advance=function(a){};ydn.db.core.req.ICursor.prototype.restart=function(a,b){};ydn.db.core.req.ICursor.prototype.hasCursor=function(){};ydn.db.core.req.ICursor.prototype.update=function(a){};ydn.db.core.req.ICursor.prototype.clear=function(){};
ydn.db.core.req.ICursor.prototype.isIndexCursor=function(){};ydn.db.core.req.ICursor.prototype.isPrimaryCursor=function(){};ydn.db.core.req.ICursor.prototype.isValueCursor=function(){};ydn.db.Iterator=function(a,b,c,d,e,f,g){if(goog.DEBUG&&!goog.isString(a))throw new TypeError("store name must be a string, but "+a+" found.");this.store_name_=a;this.index_name_=b;this.index_key_path_=g;this.is_index_iterator_=!!this.index_name_;if(goog.DEBUG){if(goog.isDef(d)&&!goog.isBoolean(d))throw new ydn.debug.error.ArgumentException("reverse value must be a boolean, but "+typeof d+" found");if(goog.isDef(e)&&!goog.isBoolean(e))throw new ydn.debug.error.ArgumentException("unique value must be a boolean, but "+
typeof e+" found");if(goog.isDef(f)&&!goog.isBoolean(f))throw new ydn.debug.error.ArgumentException("key_only value must be a boolean, but "+typeof f+" found");}this.is_key_iterator_=goog.isDef(f)?f:!!goog.isString(this.index_name_);a=ydn.db.base.Direction.NEXT;d&&e?a=ydn.db.base.Direction.PREV_UNIQUE:d?a=ydn.db.base.Direction.PREV:e&&(a=ydn.db.base.Direction.NEXT_UNIQUE);this.direction_=a;if(goog.DEBUG&&(d=ydn.db.KeyRange.validate(c)))throw new ydn.debug.error.ArgumentException("Invalid key range: "+
d);this.key_range_=ydn.db.KeyRange.parseIDBKeyRange(c);this.state_=ydn.db.Iterator.State.INITIAL;this.prefix_index=NaN};goog.inherits(ydn.db.Iterator,ydn.db.core.AbstractIterator);ydn.db.Iterator.DEBUG=!1;ydn.db.Iterator.prototype.is_key_iterator_=!0;ydn.db.KeyIterator=function(a,b,c){if(3<arguments.length)throw new ydn.debug.error.ArgumentException("too many argument");ydn.db.Iterator.call(this,a,void 0,b,c,void 0,!0)};goog.inherits(ydn.db.KeyIterator,ydn.db.Iterator);
ydn.db.KeyIterator.where=function(a,b,c,d,e){return new ydn.db.KeyIterator(a,ydn.db.KeyRange.where(b,c,d,e))};ydn.db.IndexIterator=function(a,b,c,d,e){if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("index name must be string");ydn.db.Iterator.call(this,a,b,c,d,e,!0)};goog.inherits(ydn.db.IndexIterator,ydn.db.Iterator);ydn.db.IndexIterator.where=function(a,b,c,d,e,f){return new ydn.db.IndexIterator(a,b,ydn.db.KeyRange.where(c,d,e,f))};
ydn.db.ValueIterator=function(a,b,c){if(3<arguments.length)throw new ydn.debug.error.ArgumentException("too many argument");ydn.db.Iterator.call(this,a,void 0,b,c,void 0,!1)};goog.inherits(ydn.db.ValueIterator,ydn.db.Iterator);ydn.db.ValueIterator.where=function(a,b,c,d,e){return new ydn.db.ValueIterator(a,ydn.db.KeyRange.where(b,c,d,e))};
ydn.db.IndexValueIterator=function(a,b,c,d,e){if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("index name must be string");ydn.db.Iterator.call(this,a,b,c,d,e,!1)};goog.inherits(ydn.db.IndexValueIterator,ydn.db.Iterator);ydn.db.IndexValueIterator.where=function(a,b,c,d,e,f){return new ydn.db.IndexValueIterator(a,b,ydn.db.KeyRange.where(c,d,e,f))};ydn.db.Iterator.State={INITIAL:"init",WORKING:"busy",RESTING:"rest",COMPLETED:"done"};ydn.db.Iterator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.Iterator");
ydn.db.Iterator.prototype.getStoreName=function(){return this.store_name_};ydn.db.Iterator.prototype.getIndexName=function(){return this.index_name_};ydn.db.Iterator.prototype.getIndexKeyPath=function(){return this.index_key_path_||this.index_name_};ydn.db.Iterator.prototype.getDirection=function(){return this.direction_};ydn.db.Iterator.prototype.keyRange=function(){return this.key_range_};ydn.db.Iterator.prototype.hasKeyRange=function(){return!!this.key_range_};
ydn.db.Iterator.prototype.getLower=function(){return this.key_range_?void 0:this.key_range_.lower};ydn.db.Iterator.prototype.getLowerOpen=function(){return this.key_range_?void 0:this.key_range_.lowerOpen};ydn.db.Iterator.prototype.getUpper=function(){return this.key_range_?void 0:this.key_range_.upper};ydn.db.Iterator.prototype.getUpperOpen=function(){return this.key_range_?void 0:this.key_range_.upperOpen};
ydn.db.Iterator.prototype.getKeyRange=function(){return this.key_range_?this.key_range_ instanceof ydn.db.IDBKeyRange?this.key_range_:ydn.db.IDBKeyRange.bound(this.key_range_.lower,this.key_range_.upper,this.key_range_.lowerOpen,this.key_range_.upperOpen):null};ydn.db.Iterator.prototype.isKeyIterator=function(){return this.is_key_iterator_};ydn.db.Iterator.prototype.isIndexIterator=function(){return this.is_index_iterator_};ydn.db.Iterator.prototype.isPrimaryIterator=function(){return!this.is_index_iterator_};
ydn.db.Iterator.prototype.clone=function(){var a=new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.isKeyIterator(),this.index_key_path_);a.prefix_index=this.prefix_index;return a};ydn.db.Iterator.prototype.asKeyIterator=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),!0,this.index_key_path_)};
ydn.db.Iterator.prototype.unique=function(a){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),a,this.isKeyIterator(),this.index_key_path_)};ydn.db.Iterator.prototype.copy=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.isKeyIterator(),this.index_key_path_)};
goog.DEBUG&&(ydn.db.Iterator.prototype.toJSON=function(){return{store:this.store_name_,index:this.index_name_,keyRange:this.key_range_?ydn.db.KeyRange.toJSON(this.key_range_):null,direction:this.direction_}},ydn.db.Iterator.prototype.toString=function(){var a=goog.isDef(this.index_key_path_)?":"+this.index_key_path_.join(","):goog.isDef(this.index_name_)?":"+this.index_name_:"",a=a+ydn.db.KeyRange.toString(this.key_range_);this.state_!=ydn.db.Iterator.State.INITIAL&&(a+=this.state_+"{"+this.i_key_,
this.isIndexIterator()&&(a+=", "+this.i_primary_key_),a+="}");var b=this.isIndexIterator()?"Index":"",b=b+(this.isKeyIterator()?"Key":"Value");return b+"Iterator:"+this.store_name_+a});ydn.db.Iterator.prototype.resume=function(a,b){var c=new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.is_key_iterator_,this.index_key_path_);c.i_key_=a;c.i_primary_key_=b;c.state_=ydn.db.Iterator.State.RESTING;return c};
ydn.db.Iterator.prototype.reverse=function(a,b){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,!this.isReversed(),this.isUnique(),this.is_key_iterator_,this.index_key_path_)};ydn.db.Iterator.prototype.isReversed=function(){return this.direction_===ydn.db.base.Direction.PREV||this.direction_===ydn.db.base.Direction.PREV_UNIQUE};ydn.db.Iterator.prototype.isUnique=function(){return this.direction_===ydn.db.base.Direction.NEXT_UNIQUE||this.direction_===ydn.db.base.Direction.PREV_UNIQUE};
ydn.db.Iterator.prototype.getNextKeyRange=function(){this.state_!=ydn.db.Iterator.State.COMPLETED&&this.state_!=ydn.db.Iterator.State.INITIAL&&goog.isDefAndNotNull(this.i_key_);return this.key_range_};ydn.db.Iterator.prototype.getState=function(){return this.state_};
ydn.db.Iterator.prototype.load=function(a){a=a[0];a.init(this.store_name_,this.index_key_path_||this.index_name_,this.key_range_,this.direction_,this.is_key_iterator_);this.state_=ydn.db.Iterator.State.WORKING;var b=this;a.onTerminated=function(a,d,e){b.i_key_=d;b.i_primary_key_=e;b.state_=a?ydn.db.Iterator.State.RESTING:ydn.db.Iterator.State.COMPLETED};a.openCursor(this.i_key_,this.i_primary_key_);return a};
ydn.db.Iterator.prototype.isFreshState=function(){return this.state_==ydn.db.Iterator.State.INITIAL||this.state_==ydn.db.Iterator.State.COMPLETED};ydn.db.Iterator.prototype.getKey=function(){return this.i_key_};ydn.db.Iterator.prototype.getPrimaryKey=function(){return this.i_primary_key_};
ydn.db.Iterator.prototype.reset=function(a,b,c){a=a||ydn.db.Iterator.State.INITIAL;this.getState()==ydn.db.Iterator.State.WORKING?this.logger.warning(this+": resetting state to "+a+" ignore during iteration"):(this.i_key_=b,this.i_primary_key_=c,this.state_=a)};ydn.db.Iterator.prototype.stores=function(){return[this.store_name_]};ydn.db.Request=function(a,b,c){ydn.async.Deferred.call(this,b,c);this.method_=a;this.progbacks_=[];this.txbacks_=[];this.transformers_=[];this.tx_=null;this.tx_label_="";this.copy_count_=0};goog.inherits(ydn.db.Request,ydn.async.Deferred);ydn.db.Request.DEBUG=!1;ydn.db.Request.prototype.tx_label_="";ydn.db.Request.prototype.logger=goog.debug.Logger.getLogger("ydn.db.Request");
ydn.db.Request.prototype.setTx=function(a,b){goog.asserts.assert(!this.tx_,"TX already set.");this.tx_=a;this.tx_label_=b;this.logger.finer(this+" BEGIN");if(a){for(var c=0;c<this.txbacks_.length;c++)this.txbacks_[c][0].call(this.txbacks_[c][1],a);this.txbacks_.length=0}this.logger.finer(this+" END")};ydn.db.Request.prototype.copy=function(){var a=new ydn.db.Request(this.method_);this.copy_count_++;a.setTx(this.tx_,this.tx_label_+"C"+this.copy_count_);return a};
ydn.db.Request.prototype.removeTx=function(){this.tx_=null};ydn.db.Request.prototype.getTx=function(){return this.tx_};ydn.db.Request.prototype.getMethod=function(){return this.method_};ydn.db.Request.prototype.canAbort=function(){return!!this.tx_};
ydn.db.Request.prototype.abort=function(){if(this.tx_)if(this.logger.finer(this+" aborting"),goog.isFunction(this.tx_.abort))this.tx_.abort();else if(goog.isFunction(this.tx_.executeSql))this.tx_.executeSql("ABORT",[],function(a,b){},function(a,b){return!0});else throw new ydn.debug.error.NotSupportedException;else throw new ydn.db.InvalidStateError(goog.DEBUG?"No active transaction":"");};
ydn.db.Request.prototype.setDbValue=function(a,b){var c=this.transformers_.shift(),d=!!b;if(c){var e=this;c[0].call(c[1],a,d,function(a,b){e.setDbValue(a,b)})}else ydn.db.Request.DEBUG&&window.console.log(this+" receiving "+(d?"fail":"value"),a),d?this.errback(a):this.callback(a)};ydn.db.Request.prototype.await=function(a,b){goog.asserts.assert(!this.hasFired(),"transformer cannot be added after resolved.");this.transformers_.push([a,b])};
ydn.db.Request.prototype.addTxback=function(a,b){this.tx_?a.call(b,this.tx_):this.txbacks_.push([a,b]);return this};ydn.db.Request.prototype.callback=function(a){this.logger.finer(this+" SUCCESS");ydn.db.Request.superClass_.callback.call(this,a);this.dispose_()};ydn.db.Request.prototype.errback=function(a){this.logger.finer(this+" ERROR");ydn.db.Request.superClass_.errback.call(this,a);this.dispose_()};
ydn.db.Request.prototype.state=function(){return this.hasFired()?this.hadError_?"rejected":"resolved":"pending"};ydn.db.Request.prototype.dispose_=function(){this.tx_=null;this.tx_label_=this.tx_label_};ydn.db.Request.prototype.getLabel=function(){var a="";this.tx_label_&&(a=this.tx_?"*":"",a="["+this.tx_label_+a+"]");return this.method_+a};ydn.db.Request.succeed=function(a,b){var c=new ydn.db.Request(a);c.setDbValue(b);return c};ydn.db.Request.prototype.promise=function(){return this};
ydn.db.Request.prototype.toString=function(){return"Request:"+this.getLabel()};
ydn.db.Request.prototype.fire_=function(){this.unhandledExceptionTimeoutId_&&this.hasFired()&&this.hasErrback_()&&(goog.global.clearTimeout(this.unhandledExceptionTimeoutId_),delete this.unhandledExceptionTimeoutId_);this.parent_&&(this.parent_.branches_--,delete this.parent_);for(var a=this.result_,b=!1,c=!1;this.sequence_.length&&!this.blocked_;){var d=this.sequence_.shift(),e=d[0],f=d[1],d=d[2];if(e=this.hadError_?f:e)e=e.call(d||this.defaultScope_,a),goog.isDef(e)&&(this.hadError_=this.hadError_&&
(e==a||this.isError(e)),this.result_=a=e),a instanceof goog.async.Deferred&&(this.blocked_=c=!0)}this.result_=a;c?(a.addCallbacks(goog.bind(this.continue_,this,!0),goog.bind(this.continue_,this,!1)),a.blocking_=!0):!goog.async.Deferred.STRICT_ERRORS||!this.isError(a)||a instanceof goog.async.Deferred.CanceledError||(b=this.hadError_=!0);b&&(this.unhandledExceptionTimeoutId_=goog.global.setTimeout(goog.functions.fail(a),0))};
ydn.db.Request.prototype.toJSON=function(){var a=(this.tx_label_||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.method_?this.method_.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};
ydn.db.Request.Method={ADD:goog.DEBUG?"add":"a",ADDS:goog.DEBUG?"add:array":"b",CLEAR:goog.DEBUG?"clear":"c",COUNT:goog.DEBUG?"count":"d",GET:goog.DEBUG?"get":"e",GET_BY_KEY:goog.DEBUG?"get:key":"ek",GET_ITER:goog.DEBUG?"get:iter":"f",KEYS:goog.DEBUG?"keys":"g",KEYS_ITER:goog.DEBUG?"keys:iter":"h",KEYS_INDEX:goog.DEBUG?"keys:iter:index":"i",LIST:goog.DEBUG?"list":"i2",LOAD:goog.DEBUG?"load":"i3",MAP:goog.DEBUG?"map":"i4",OPEN:goog.DEBUG?"open":"i5",PUT:goog.DEBUG?"put":"j",PUTS:goog.DEBUG?"put:array":
"k",PUT_KEYS:goog.DEBUG?"put:keys":"l",REDUCE:goog.DEBUG?"reduce":"m0",REMOVE_ID:goog.DEBUG?"rm":"m",REMOVE:goog.DEBUG?"rm:iter":"n",REMOVE_KEYS:goog.DEBUG?"rm:keys":"o",REMOVE_INDEX:goog.DEBUG?"rm:iter:index":"p",RUN:goog.DEBUG?"run":"q",SCAN:goog.DEBUG?"scan":"qa",SEARCH:goog.DEBUG?"search":"qb",SQL:goog.DEBUG?"sql":"r",VALUES:goog.DEBUG?"values":"s",VALUES_ITER:goog.DEBUG?"values:iter":"t",VALUES_INDEX:goog.DEBUG?"values:iter:index":"u",VALUES_IDS:goog.DEBUG?"values:array":"v",VALUES_KEYS:goog.DEBUG?
"values:keys":"w",VERSION_CHANGE:goog.DEBUG?"IDBVersionChangeEvent ":"vc",NONE:""};ydn.db.version="0";ydn.db.cmp=ydn.db.base.indexedDb&&ydn.db.base.indexedDb.cmp?goog.bind(ydn.db.base.indexedDb.cmp,ydn.db.base.indexedDb):ydn.db.utils.cmp;ydn.db.databaseDeletors=[];ydn.db.deleteDatabase=function(a,b){for(var c,d=0;d<ydn.db.databaseDeletors.length;d++){var e=ydn.db.databaseDeletors[d](a,b);e&&(c=e)}return c||ydn.db.Request.succeed(ydn.db.Request.Method.VERSION_CHANGE,null)};ydn.db.con={};ydn.db.con.IStorage=function(){};ydn.db.con.ICursorStream=function(){};ydn.db.con.IdbCursorStream=function(a,b,c,d){if("transaction"in a)this.db_=a,this.tx_=this.idb_=null;else if("objectStore"in a){if(this.db_=null,this.idb_=a.db,this.tx_=a,goog.DEBUG&&!this.tx_.db.objectStoreNames.contains(b))throw new ydn.error.ArgumentException('store "'+b+'" not in transaction.');}else throw new ydn.error.ArgumentException("storage instance require.");this.store_name_=b;this.index_name_=c;this.sink_=d;this.cursor_=null;this.stack_=[];this.running_=0;this.on_tx_request_=!1};
ydn.db.con.IdbCursorStream.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.IdbCursorStream");ydn.db.con.IdbCursorStream.prototype.on_tx_request_=!1;ydn.db.con.IdbCursorStream.prototype.isIndex=function(){return goog.isDefAndNotNull(this.index_name_)};
ydn.db.con.IdbCursorStream.prototype.processRequest_=function(a){this.running_++;var b=this;a.onsuccess=function(a){if(a=a.target.result){if(goog.isFunction(b.sink_)){var d=a.value,d=b.isIndex()?d[b.index_name_]:d;b.sink_(a.primaryKey,d)}else b.logger.warning("sink gone, dropping value for: "+a.primaryKey);if(a&&0<b.stack_.length)a["continue"](b.stack_.shift());else b.running_--,b.clearStack_()}};a.onerror=function(c){b.logger.warning("seeking fail. "+("error"in a?a.error.name+":"+a.error.message:
""));b.running_--;b.clearStack_()}};ydn.db.con.IdbCursorStream.prototype.onFinish=function(a){0==this.stack_.length&&0==this.running_?a():this.collector_=a};
ydn.db.con.IdbCursorStream.prototype.createRequest_=function(){if(!this.on_tx_request_){var a=this,b=function(b,c){a.tx_=null;b!==ydn.db.base.TxEventTypes.COMPLETE&&a.logger.warning(c.name+":"+c.message);a.logger.finest(a+" transaction "+b)},c=function(b){var c=a.stack_.shift();a.logger.finest(a+" transaction started for "+c);b=b.objectStore(a.store_name_);a.processRequest_(b.openCursor(c))};if(this.tx_)a.logger.finest(a+" using existing tx."),c(this.tx_);else if(this.idb_)a.logger.finest(a+" creating tx from IDBDatabase."),
this.tx=this.idb_.transaction([this.store_name_],ydn.db.base.TransactionMode.READ_ONLY),this.tx.oncomplete=function(a){b(ydn.db.base.TxEventTypes.COMPLETE,a)},this.tx.onerror=function(a){b(ydn.db.base.TxEventTypes.ERROR,a)},this.tx.onabort=function(a){b(ydn.db.base.TxEventTypes.ABORT,a)};else if(this.db_)a.logger.finest(a+" creating tx from ydn.db.con.IStorage."),this.on_tx_request_=!0,this.db_.transaction(function(b){a.on_tx_request_=!1;c(b)},[a.store_name_],ydn.db.base.TransactionMode.READ_ONLY,
b);else throw new ydn.error.InternalError(goog.DEBUG?"no way to create a transaction provided.":"");}};ydn.db.con.IdbCursorStream.prototype.clearStack_=function(){if(this.cursor_&&0<this.stack_.length)this.cursor_["continue"](this.stack_.shift());else 0==this.running_&&this.collector_&&this.collector_()};ydn.db.con.IdbCursorStream.prototype.seek=function(a){this.stack_.push(a);this.createRequest_()};ydn.db.Streamer=function(a,b,c){a&&a instanceof ydn.db.con.Storage?this.db_=a:a&&a.db&&(this.db_=null,this.setTx(a));if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("a store name required.");this.store_name_=b;if(goog.isDef(c)&&!goog.isString(c))throw new ydn.debug.error.ArgumentException("projection index name must be a string.");this.index_name_=c;this.cursor_=null;this.stack_key_=[];this.stack_value_=[];this.is_collecting_=!1};ydn.db.Streamer.prototype.logger=goog.debug.Logger.getLogger("ydn.db.Streamer");
ydn.db.Streamer.prototype.db_=null;ydn.db.Streamer.prototype.key_only_=!0;ydn.db.Streamer.prototype.storage_=null;ydn.db.Streamer.prototype.sink_=null;ydn.db.Streamer.prototype.getFieldName=function(){return this.index_name_};ydn.db.Streamer.prototype.cursor_=null;ydn.db.Streamer.prototype.isKeyIterator=function(){return this.key_only_};ydn.db.Streamer.prototype.setSink=function(a){this.sink_=a};
ydn.db.Streamer.prototype.setTx=function(a){if(a.db)this.cursor_=new ydn.db.con.IdbCursorStream(a,this.store_name_,this.index_name_,goog.bind(this.collector_,this));else throw new ydn.debug.error.ArgumentException("Invalid IndexedDB Transaction.");};
ydn.db.Streamer.prototype.push_=function(){var a=0<this.stack_value_.length;if(a&&!this.is_collecting_&&goog.isFunction(this.sink_)){var b=this,c=function(){b.push_()},d=this.stack_key_.shift(),e=this.stack_value_.shift(),a=0<this.stack_value_.length,c=this.sink_(d,e,a?c:null);a&&!c&&this.push_()}};ydn.db.Streamer.prototype.is_collecting_=!1;
ydn.db.Streamer.prototype.collect=function(a){if(this.cursor_){this.is_collecting_=!0;var b=this;this.cursor_.onFinish(function(c){a(b.stack_key_,b.stack_value_);b.stack_key_=[];b.stack_value_=[];b.is_collecting_=!1})}else a(this.stack_key_,this.stack_value_),this.stack_key_=[],this.stack_value_=[]};ydn.db.Streamer.prototype.done=function(){if(this.cursor_){var a=new goog.async.Deferred,b=this;this.cursor_.onFinish(function(c){a.callback(b.stack_value_)});return a}return goog.async.Deferred.succeed(this.stack_value_)};
ydn.db.Streamer.prototype.collector_=function(a,b){this.stack_key_.push(a);this.stack_value_.push(b);this.push_()};
ydn.db.Streamer.prototype.push=function(a,b){if(this.is_collecting_)throw new ydn.error.InvalidOperationError(goog.DEBUG?"push not allowed after a collection is started":"");if(2<=arguments.length)this.collector_(a,b);else{if(!this.cursor_){if(!this.db_)throw new ydn.error.InvalidOperationError("Database connection is not setup.");var c=this.db_.getType();if(c)if(c===ydn.db.base.Mechanisms.IDB)this.cursor_=new ydn.db.con.IdbCursorStream(this.db_,this.store_name_,this.index_name_,goog.bind(this.collector_,
this));else throw new ydn.error.NotImplementedException(c);else throw new ydn.error.InvalidOperationError("Database is not connected.");}this.cursor_.seek(a)}};ydn.db.Streamer.prototype.pull=function(a,b){goog.isDef(this.foreign_key_index_name_)?this.key_only_?this.push(b):goog.isDefAndNotNull(b)?this.push(b[this.foreign_key_index_name_]):this.push(void 0,void 0):this.push(a)};ydn.db.Streamer.prototype.setRelation=function(a,b){this.foreign_key_store_name_=a;this.foreign_key_index_name_=b};
ydn.db.Streamer.prototype.getRelation=function(){return[this.foreign_key_store_name_,this.foreign_key_index_name_]};ydn.db.Streamer.prototype.getStoreName=function(){return this.store_name_};ydn.db.Streamer.prototype.getIndexName=function(){return this.index_name_};goog.DEBUG&&(ydn.db.Streamer.prototype.toString=function(){return"Streamer:"+this.store_name_+(this.index_name_||"")});ydn.db.algo={};ydn.db.algo.AbstractSolver=function(a,b){if(goog.DEBUG&&goog.isDefAndNotNull(a)&&!("push"in a))throw new ydn.error.ArgumentException('output receiver object must have "push" method.');this.out=a||null;this.limit=b;this.match_count=0;this.is_reverse=!1;this.is_duplex_output=a instanceof ydn.db.Streamer&&!!a.getFieldName()};ydn.db.algo.AbstractSolver.prototype.logger=goog.debug.Logger.getLogger("ydn.db.algo.AbstractSolver");
ydn.db.algo.AbstractSolver.prototype.begin=function(a,b,c){this.is_reverse=b[0].isReversed();if(goog.DEBUG)for(c=0;c<b.length;c++){if(!(b[c]instanceof ydn.db.Iterator))throw new ydn.debug.error.TypeError("item at iterators "+c+" is not an iterator.");if(0<c&&this.is_reverse!=b[c].isReversed())throw new ydn.debug.error.TypeError("iterator at "+c+" must "+(this.is_reverse?"be reverse":"not be reverse"));}this.out instanceof ydn.db.Streamer&&this.out.setTx(a);if(this.is_duplex_output)if((a=b[0].getIndexKeyPath())&&
1<a.length){if(a[a.length-1]!=this.out.getFieldName())throw new ydn.error.InvalidOperationError("Output streamer projection field must be same as postfix field in the iterator");}else goog.DEBUG&&this.logger.warning("Unable to check correctness of output streamer.");a="{";for(c=0;c<b.length;c++)0<c&&(a+=", "),a+=b.toString();a+="}";this.is_reverse&&(a+=" reverse");this.logger.fine(this+" begin "+a);return!1};
ydn.db.algo.AbstractSolver.prototype.pusher=function(a,b,c,d,e){b=goog.isDefAndNotNull(d);if(!goog.isDef(d)){d=c[0];b=goog.isDefAndNotNull(d);for(var f=1;b&&f<c.length;f++)goog.isDefAndNotNull(c[f])&&0==ydn.db.cmp(c[f],d)||(b=!1)}return b&&(this.match_count++,this.out&&(this.is_duplex_output?this.out.push(d,e):this.out.push(d)),goog.isDef(this.limit)&&this.match_count>=this.limit)?[]:a};ydn.db.algo.AbstractSolver.prototype.solver=function(a,b){return[]};
ydn.db.algo.AbstractSolver.prototype.finish=function(a){return!1};ydn.db.ConstraintError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.ConstraintError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ConstraintError"};goog.inherits(ydn.db.ConstraintError,Error);ydn.db.ConstraintError.prototype.name="ConstraintError";goog.DEBUG&&(ydn.db.ConstraintError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.InvalidKeyException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidKeyException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"};goog.inherits(ydn.db.InvalidKeyException,Error);goog.DEBUG&&(ydn.db.InvalidKeyException.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.VersionError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.VersionError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.VersionError"};goog.inherits(ydn.db.VersionError,Error);ydn.db.VersionError.prototype.name="ydn.db.VersionError";goog.DEBUG&&(ydn.db.VersionError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.InternalError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InternalError):this.stack=Error().stack||"";a&&(this.message=String(a))};goog.inherits(ydn.db.InternalError,Error);ydn.db.InternalError.prototype.name="ydn.db.InternalError";ydn.db.ScopeError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.ScopeError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.ScopeError"};goog.inherits(ydn.db.ScopeError,Error);
ydn.db.InvalidStateError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidStateError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"};goog.inherits(ydn.db.InvalidStateError,Error);ydn.db.InvalidAccessError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidAccessError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"};goog.inherits(ydn.db.InvalidAccessError,Error);
ydn.db.NotFoundError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.NotFoundError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"};goog.inherits(ydn.db.NotFoundError,Error);ydn.db.NotFoundError.prototype.name="NotFoundError";goog.DEBUG&&(ydn.db.NotFoundError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.DataCloneError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.DataCloneError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="DataCloneError"};goog.inherits(ydn.db.DataCloneError,Error);goog.DEBUG&&(ydn.db.DataCloneError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.SQLError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SQLError):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"};goog.inherits(ydn.db.SQLError,Error);goog.DEBUG&&(ydn.db.SQLError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.SecurityError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SecurityError):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"};goog.inherits(ydn.db.SecurityError,Error);goog.DEBUG&&(ydn.db.SecurityError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.SqlParseError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SqlParseError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.SqlParseError"};goog.inherits(ydn.db.SqlParseError,Error);ydn.db.TimeoutError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.TimeoutError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"};goog.inherits(ydn.db.TimeoutError,Error);
ydn.db.TxError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.TxError):this.stack=Error().stack||"";b&&(this.message=String(b));this.name="TxError";this.result=a};goog.inherits(ydn.db.TxError,Error);ydn.db.TxError.prototype.getResult=function(){return this.result};ydn.db.TxAbortedError=function(a,b){ydn.db.TxError.call(this,a,b);this.name="TxAbortedError"};goog.inherits(ydn.db.TxAbortedError,ydn.db.TxError);ydn.db.Key=function(a,b,c){var d;if(goog.isObject(a))d=a.store,b=a.id,goog.isDefAndNotNull(a.parent)&&(c=new ydn.db.Key(a.parent));else if(goog.asserts.assertString(a,"store name of a key object must be a string"),goog.isDef(b))d=a;else if(d=a.lastIndexOf(ydn.db.Key.SEP_PARENT),b=a,0<d&&(b=a.substr(d),c=new ydn.db.Key(a.substring(0,d))),b=b.split(ydn.db.Key.SEP_STORE),d=b[0],b=b[1],!goog.isDef(b))throw Error("Invalid key value: "+a);this.store_name=d;this.id=b;this.parent=c||null};var IDBKey;
ydn.db.Key.prototype.toJSON=function(){var a={store:this.store_name,id:this.id};this.parent&&(a.parent=this.parent.toJSON());return a};ydn.db.Key.SEP_PARENT="^|";ydn.db.Key.SEP_STORE="^:";ydn.db.Key.prototype.valueOf=function(){return(this.parent?this.parent.valueOf()+ydn.db.Key.SEP_PARENT:"")+this.store_name+ydn.db.Key.SEP_STORE+this.id};ydn.db.Key.prototype.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};ydn.db.Key.prototype.getStoreName=function(){return this.store_name};
ydn.db.Key.prototype.getId=function(){return this.id};ydn.db.Key.prototype.getNormalizedId=function(){return goog.isArray(this.id)?this.id.join(ydn.db.Key.SEP_PARENT):this.id instanceof Date?+this.id:this.id};ydn.db.Key.prototype.getParent=function(){return this.parent};ydn.db.Key.isValidKey=function(a){return goog.isNumber(a)||goog.isString(a)||goog.isArray(a)&&goog.array.every(a,ydn.db.Key.isValidKey)||a instanceof Date};
ydn.db.Key.clone=function(a){if(goog.isArrayLike(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};ydn.db.crud={};ydn.db.crud.req={};ydn.db.crud.req.RequestExecutor=function(a,b){this.dbname=a;this.schema=b};ydn.db.crud.req.RequestExecutor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.RequestExecuto");goog.DEBUG&&(ydn.db.crud.req.RequestExecutor.prototype.toString=function(){return"RequestExecutor"});ydn.db.crud.IOperator=function(){};ydn.db.core.IOperator=function(){};ydn.db.crud.req.ListType={};ydn.db.crud.req.IRequestExecutor=function(){};ydn.db.core.req.IRequestExecutor=function(){};ydn.db.tr={};ydn.db.tr.Thread=function(a,b,c,d,e,f){this.storage_=a;this.q_no_=b;this.r_no_=this.tx_no_=0;this.scope_store_names=d;this.scope_mode=e;this.policy=c||ydn.db.tr.Thread.Policy.SINGLE;this.max_tx_no=f||0;this.gen_req_=null;this.break_tx_=!1;this.yield_no_=0};ydn.db.tr.Thread.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Thread");
ydn.db.tr.Thread.prototype.setGenerator=function(a,b){goog.asserts.assert(!this.generator_,"thread can have only one generator");this.generator_=a;this.gen_req_=b;return goog.bind(this.onGenTxCommitted_,this)};
ydn.db.tr.Thread.prototype.onGenTxCommitted_=function(a,b){if(a==ydn.db.base.TxEventTypes.COMPLETE||a==ydn.db.base.TxEventTypes.ABORT)if(this.break_tx_)this.logger.finest("tx "+this.getTxNo()+" committed"),this.break_tx_=!1;else{this.logger.finest("Generator done "+this.break_tx_);var c=a==ydn.db.base.TxEventTypes.COMPLETE;this.gen_req_.setDbValue(this.getTxNo(),!c)}};
ydn.db.tr.Thread.prototype.commit=function(){if(goog.isDef(this.generator_))if(this.generator_)this.logger.finest("Receive to commit tx "+this.getTxNo()+" on yield "+this.yield_no_),this.break_tx_=!0;else throw new ydn.debug.error.InvalidOperationException("Coroutine transaction thread has been ended");else throw new ydn.debug.error.InvalidOperationException("Transaction thread not running in a generator");};
ydn.db.tr.Thread.prototype.sendNext_=function(a){if(this.break_tx_){this.logger.finest("waiting tx to be committed for yielding "+this.yield_no_);var b=this;setTimeout(function(){b.processTx(function(c){b.logger.finest("sending result to yield "+b.yield_no_);b.generator_.next(a)},b.scope_store_names,b.scope_mode,goog.bind(b.onGenTxCommitted_,b))},4)}else this.logger.finest("sending result to yield "+this.yield_no_),this.generator_.next(a);this.yield_no_++};
ydn.db.tr.Thread.prototype.request=function(a,b,c,d){a=new ydn.db.Request(a);this.generator_&&a.addCallbacks(function(a){this.sendNext_(a)},function(a){var b=a;a instanceof Error||(b=Error(),b.error=a);this.sendNext_(b)},this);return a};ydn.db.tr.Thread.prototype.getTxNo=function(){return this.tx_no_};ydn.db.tr.Thread.prototype.type=function(){return this.storage_.getType()};ydn.db.tr.Thread.prototype.getQueueNo=function(){return this.q_no_};ydn.db.tr.Thread.prototype.addStoreSchema=function(a){return this.storage_.addStoreSchema(a)};
ydn.db.tr.Thread.prototype.getStorage=function(){return this.storage_};ydn.db.tr.Thread.prototype.getLabel=function(){return"B"+this.q_no_+"T"+this.tx_no_};ydn.db.tr.Thread.Policy={MULTI:"multi",REPEAT:"repeat",ALL:"all",ATOMIC:"atomic",SINGLE:"single"};
ydn.db.tr.Thread.abort=function(a){if(a)if(goog.isFunction(a.abort))a.abort();else if(goog.isFunction(a.executeSql))a.executeSql("ABORT",[],null,function(a,c){return!0});else throw new ydn.debug.error.NotSupportedException;else throw new ydn.db.InvalidStateError("No active transaction");};ydn.db.tr.Mutex=function(a){this.tr_no=a;this.tx_=null;this.tx_count_=0};ydn.db.tr.Mutex.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Mutex");ydn.db.tr.Mutex.DEBUG=!1;ydn.db.tr.Mutex.prototype.up=function(a,b,c){ydn.db.tr.Mutex.DEBUG&&window.console.log(this+": up");goog.asserts.assert(!this.tx_,this+": transaction overlap");this.tx_=a;this.out_of_scope_=this.is_locked_=!1;this.store_names=b;this.mode=c;this.tx_count_++;this.oncompleted=null};ydn.db.tr.Mutex.prototype.store_names=null;
ydn.db.tr.Mutex.prototype.sameScope=function(a,b){if(!this.store_names||!this.mode||b!=this.mode||this.store_names.length!=a.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.store_names.indexOf(a[c]))return!1;return!0};
ydn.db.tr.Mutex.prototype.subScope=function(a,b){if(!this.store_names||!this.mode||b!=this.mode&&(this.mode!=ydn.db.base.TransactionMode.READ_WRITE||b!=ydn.db.base.TransactionMode.READ_ONLY)||a.length>this.store_names.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.store_names.indexOf(a[c]))return!1;return!0};
ydn.db.tr.Mutex.prototype.down=function(a,b){if(this.tx_){ydn.db.tr.Mutex.DEBUG&&window.console.log(this+": down");this.mode=this.store_names=this.tx_=null;if(goog.isFunction(this.oncompleted))this.oncompleted(a,b);this.oncompleted=null}else this.logger.warning(this+" has no TX to be unlocked for "+a)};ydn.db.tr.Mutex.prototype.out=function(){this.out_of_scope_=!0};ydn.db.tr.Mutex.prototype.inScope=function(){return!this.out_of_scope_};
ydn.db.tr.Mutex.prototype.lock=function(){ydn.db.tr.Mutex.DEBUG&&window.console.log(this+": locked");this.is_locked_=!0};ydn.db.tr.Mutex.prototype.getTxCount=function(){return this.tx_count_};ydn.db.tr.Mutex.prototype.isLocked=function(){return this.is_locked_};ydn.db.tr.Mutex.prototype.isActive=function(){return!!this.tx_};ydn.db.tr.Mutex.prototype.isAvailable=function(){return!this.is_locked_};ydn.db.tr.Mutex.prototype.isActiveAndAvailable=function(){return this.isActive()&&this.isAvailable()};
ydn.db.tr.Mutex.prototype.oncompleted=null;ydn.db.tr.Mutex.prototype.getTx=function(){return this.tx_};ydn.db.tr.Mutex.prototype.getLabel=function(){return"B"+this.tr_no+"T"+this.tx_count_};goog.DEBUG&&(ydn.db.tr.Mutex.prototype.toString=function(){var a=this.tx_?"*":"";return"Mutex:"+this.getLabel()+a});ydn.db.tr.Serial=function(a,b,c,d,e,f){ydn.db.tr.Thread.call(this,a,b,c,d,e,f);this.trQueue_=[];this.completed_handlers_=[];this.s_request_tx=null;this.mu_tx_=new ydn.db.tr.Mutex(b);this.max_tx_no_=f||0;this.has_tx_started_=!1};goog.inherits(ydn.db.tr.Serial,ydn.db.tr.Thread);ydn.db.tr.Serial.DEBUG=!1;ydn.db.tr.Serial.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Serial");ydn.db.tr.Serial.prototype.getMuTx=function(){return this.mu_tx_};
ydn.db.tr.Serial.prototype.getActiveTx=function(){return this.mu_tx_.isActiveAndAvailable()?this.mu_tx_:null};ydn.db.tr.Serial.prototype.isActive=function(){return this.mu_tx_.isActiveAndAvailable()};ydn.db.tr.Serial.prototype.reusedTx=function(a,b){return this.policy==ydn.db.tr.Thread.Policy.MULTI?this.mu_tx_.subScope(a,b):this.policy==ydn.db.tr.Thread.Policy.REPEAT?this.mu_tx_.sameScope(a,b):this.policy==ydn.db.tr.Thread.Policy.ALL?!0:!1};
ydn.db.tr.Serial.prototype.getTx=function(){return this.mu_tx_.isActiveAndAvailable()?this.mu_tx_.getTx():null};ydn.db.tr.Serial.prototype.lock=function(){this.mu_tx_.lock()};ydn.db.tr.Serial.MAX_QUEUE=1E3;ydn.db.tr.Serial.prototype.popTxQueue_=function(){var a=this.trQueue_.shift();a&&(ydn.db.tr.Serial.DEBUG&&this.logger.finest("pop tx queue["+this.trQueue_.length+"]"),this.processTx(a.fnc,a.store_names,a.mode,a.oncompleted))};
ydn.db.tr.Serial.prototype.peekScopes=function(){return 0<this.trQueue_.length?this.trQueue_[0].store_names:null};ydn.db.tr.Serial.prototype.peekMode=function(){return 0<this.trQueue_.length?this.trQueue_[0].mode:null};ydn.db.tr.Serial.prototype.isNextTxCompatible=function(){var a=this.peekScopes(),b=this.peekMode();return goog.isDefAndNotNull(a)&&goog.isDefAndNotNull(b)?this.reusedTx(a,b):!1};
ydn.db.tr.Serial.prototype.pushTxQueue=function(a,b,c,d){this.logger.finest("push tx queue["+this.trQueue_.length+"]");this.trQueue_.push({fnc:a,store_names:b,mode:c,oncompleted:d})};ydn.db.tr.Serial.prototype.abort=function(){this.logger.finer(this+": aborting");ydn.db.tr.Thread.abort(this.s_request_tx)};
ydn.db.tr.Serial.prototype.processTx=function(a,b,c,d){var e=goog.isString(b)?[b]:b;if(goog.DEBUG)if(goog.isArrayLike(e)){if(0==e.length)throw new ydn.debug.error.ArgumentException("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!goog.isString(e[f]))throw new ydn.debug.error.ArgumentException("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.scope_store_names_&&!goog.array.contains(this.scope_store_names_,e[f]))throw new ydn.debug.error.ArgumentException('store name "'+
f+e[f]+'" in scope of '+this);}}else throw new ydn.debug.error.ArgumentException("store names must be an array");var g=goog.isDef(c)?c:ydn.db.base.TransactionMode.READ_ONLY,h=this;if(this.mu_tx_.isActive()||!this.getStorage().isReady()&&this.has_tx_started_)this.pushTxQueue(a,b,g,d);else{var k=this.getLabel();d&&this.completed_handlers_.push(d);if(this.max_tx_no_&&this.getTxNo()>=this.max_tx_no_)throw new ydn.debug.error.InvalidOperationException("Exceed maximum number of transactions of "+this.max_tx_no_);
this.has_tx_started_=!0;this.getStorage().transaction(function(c){h.mu_tx_.up(c,b,g);k=h.getLabel();h.logger.fine(k+" BEGIN "+ydn.json.stringify(b)+" "+g);a(h);a=null;for(h.mu_tx_.out();h.isNextTxCompatible();)c=h.trQueue_.shift(),c.oncompleted&&h.completed_handlers_.push(c.oncompleted),h.logger.finest("pop tx queue"+(h.trQueue_.length+1)+" reusing T"+h.getTxNo()),c.fnc()},e,g,function(a,b){h.logger.fine(k+" "+a);h.mu_tx_.down(a,b);for(var c=0;c<h.completed_handlers_.length;c++)(0,h.completed_handlers_[c])(a,
b);h.completed_handlers_.length=0;h.popTxQueue_();h.r_no_=0})}};ydn.db.tr.Serial.prototype.getLabel=function(){return this.mu_tx_.getLabel()};
ydn.db.tr.Serial.prototype.request=function(a,b,c,d){var e=ydn.db.tr.Serial.superClass_.request.call(this,a,b,c,d);a=c||ydn.db.base.TransactionMode.READ_ONLY;var f=this;this.mu_tx_.isActiveAndAvailable()&&this.reusedTx(b,a)?(b=this.mu_tx_.getTx(),this.r_no_++,e.setTx(b,this.getLabel()+"R"+this.r_no_),d&&this.completed_handlers_.push(d)):f.processTx(function(a){a=f.mu_tx_.getTx();f.r_no_++;e.setTx(a,f.getLabel()+"R"+f.r_no_)},b,a,d);return e};
ydn.db.tr.Serial.prototype.exec=function(a,b,c,d,e){d=d||ydn.db.base.TransactionMode.READ_ONLY;var f=this,g;if(f.mu_tx_.isActiveAndAvailable()&&this.reusedTx(c,d)){var h=f.mu_tx_.getTx();f.r_no_++;g=f.getLabel()+"R"+f.r_no_;f.logger.finer(g+" BEGIN");b(h,g,function(b,c){f.s_request_tx=h;c?(f.logger.finer(g+" ERROR"),a.errback(b)):(f.logger.finer(g+" SUCCESS"),a.callback(b));f.s_request_tx=null});f.logger.finer(g+" END");b=null}else f.processTx(function(c){var d=f.mu_tx_.getTx();f.r_no_++;g=f.getLabel()+
"R"+f.r_no_;f.logger.finer(g+" BEGIN");b(d,g,function(b,c){f.s_request_tx=d;c?(f.logger.finer(g+" ERROR"),a.errback(b)):(f.logger.finer(g+" SUCCESS"),a.callback(b));f.s_request_tx=null});f.logger.finer(g+" END");b=null},c,d,e)};ydn.db.tr.Serial.prototype.getName=function(){return this.getStorage().getName()};goog.DEBUG&&(ydn.db.tr.Serial.prototype.toString=function(){var a=this.s_request_tx?"*":"";return"Serial:"+this.getLabel()+a});ydn.db.tr.AtomicSerial=function(a,b){ydn.db.tr.Serial.call(this,a,b)};goog.inherits(ydn.db.tr.AtomicSerial,ydn.db.tr.Serial);ydn.db.tr.AtomicSerial.DEBUG=!1;ydn.db.tr.AtomicSerial.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.AtomicSerial");
ydn.db.tr.AtomicSerial.prototype.request=function(a,b,c){var d,e,f,g=ydn.db.tr.AtomicSerial.superClass_.request.call(this,a,b,c,function(a,b){g.removeTx();if(d)a!=ydn.db.base.TxEventTypes.COMPLETE&&(f=!0,e=b),d(e,f);else{var c=new ydn.db.TimeoutError;g.setDbValue(c,!0)}});g.await(function(a,b,c){f=b;e=a;d=c});return g};
ydn.db.tr.AtomicSerial.prototype.exec=function(a,b,c,d,e){var f,g,h=new goog.async.Deferred;h.addCallbacks(function(a){g=!1;f=a},function(a){g=!0;f=a});ydn.db.tr.AtomicSerial.superClass_.exec.call(this,h,b,c,d,function(b,c){if(b!=ydn.db.base.TxEventTypes.COMPLETE)a.errback(c);else if(!0===g)a.errback(f);else if(!1===g)a.callback(f);else{var d=new ydn.db.TimeoutError;a.errback(d)}e&&(e(b,c),e=void 0)})};goog.DEBUG&&(ydn.db.tr.AtomicSerial.prototype.toString=function(){return"Atomic"+ydn.db.tr.AtomicSerial.superClass_.toString.call(this)});ydn.db.tr.DbOperator=function(a,b,c,d){this.storage_=a;this.schema=b;this.tx_thread=c;this.sync_thread=d;this.executor=null};ydn.db.tr.DbOperator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.DbOperator");ydn.db.tr.DbOperator.prototype.getTxNo=function(){return this.tx_thread.getTxNo()};ydn.db.tr.DbOperator.prototype.abort=function(){this.tx_thread.abort()};ydn.db.tr.DbOperator.prototype.getExecutor=function(){this.executor||(this.executor=this.storage_.newExecutor());return this.executor};
ydn.db.tr.DbOperator.prototype.getStorage=function(){return this.storage_};ydn.db.tr.DbOperator.prototype.commit=function(){this.tx_thread.commit()};ydn.db.tr.DbOperator.prototype.addStoreSchema=function(a){return this.getStorage().addStoreSchema(a)};goog.DEBUG&&(ydn.db.tr.DbOperator.prototype.toString=function(){return"TxStorage:"+this.getStorage().getName()});ydn.db.crud.DbOperator=function(a,b,c,d){ydn.db.tr.DbOperator.call(this,a,b,c,d)};goog.inherits(ydn.db.crud.DbOperator,ydn.db.tr.DbOperator);ydn.db.crud.DbOperator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.DbOperator");ydn.db.crud.DbOperator.prototype.getCrudExecutor=function(){return this.getExecutor()};
ydn.db.crud.DbOperator.prototype.count=function(a,b,c,d){var e,f,g,h;if(goog.isDefAndNotNull(a))if(goog.isArray(a)){if(goog.isDef(c)||goog.isDef(b))throw new ydn.debug.error.ArgumentException("too many arguments.");f=a;for(var k=0;k<f.length;k++)if(!this.schema.hasStore(f[k]))throw new ydn.debug.error.ArgumentException('store name "'+f[k]+'" at '+k+" not found.");this.logger.finer("countStores: "+ydn.json.stringify(f));e=this.tx_thread.request(ydn.db.Request.Method.COUNT,f);e.addTxback(function(){this.getCrudExecutor().countStores(e,
f)},this)}else if(goog.isString(a)){k=this.schema.getStore(a);if(!k)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.DEBUG&&goog.isDef(d)&&!goog.isBoolean(d))throw new ydn.debug.error.ArgumentException('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(goog.isString(b))if(g=b,goog.isObject(c)){if(goog.DEBUG){var l=ydn.db.KeyRange.validate(c);if(l)throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(c)+" "+
l);}h=ydn.db.KeyRange.parseIDBKeyRange(c)}else{if(goog.DEBUG&&goog.isDefAndNotNull(c))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(c)+" of type "+typeof c);h=null}else if(goog.isObject(b)||!goog.isDefAndNotNull(b))if(goog.isObject(b)){if(goog.DEBUG&&(l=ydn.db.KeyRange.validate(b)))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(b)+" "+l);h=ydn.db.KeyRange.parseIDBKeyRange(b)}else{if(goog.isDefAndNotNull(b))throw new ydn.debug.error.ArgumentException("key range must be  an object but found "+
ydn.json.toShortString(b)+" of type "+typeof b);h=null}else throw new ydn.debug.error.ArgumentException('invalid second argument for count "'+ydn.json.toShortString(c)+'" of type '+typeof b);this.logger.finer("countKeyRange: "+a+" "+(g?g:"")+ydn.json.stringify(h));e=this.tx_thread.request(ydn.db.Request.Method.COUNT,f);k.hook(e,arguments);e.addTxback(function(a){this.getCrudExecutor().countKeyRange(e,f[0],h,g,!!d)},this)}else throw new ydn.debug.error.ArgumentException("Invalid store name or store names.");
else this.logger.warning("count method requires store name(s)"),k=this.schema.getStoreNames(),e=this.tx_thread.request(ydn.db.Request.Method.COUNT,k),e.await(function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),e.addTxback(function(){this.getCrudExecutor().countStores(e,f)},this);return e};
ydn.db.crud.DbOperator.prototype.get=function(a,b){var c=this,d;if(a instanceof ydn.db.Key){var e=a,f=e.getStoreName(),g=this.schema.getStore(f);if(!g){if(this.schema.isAutoSchema()){if(this.getStorage().isReady())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,void 0);d=new ydn.db.Request(ydn.db.Request.Method.GET);this.getStorage().onReady(function(){c.get(a,b).addCallbacks(function(a){d.callback(a)},function(a){d.errback(a)})});return d}throw new ydn.debug.error.ArgumentException("Store: "+
f+" not found.");}var h=e.getId();this.logger.finer("getByKey: "+f+":"+h);d=this.tx_thread.request(ydn.db.Request.Method.GET_BY_KEY,[f]);g.hook(d,arguments,void 0,this);d.addTxback(function(){this.getCrudExecutor().getById(d,f,h)},this)}else if(goog.isString(a)&&goog.isDef(b)){var k=a,g=this.schema.getStore(k);if(!g){if(this.schema.isAutoSchema()){if(this.getStorage().isReady())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,void 0);d=new ydn.db.Request(ydn.db.Request.Method.GET);this.getStorage().onReady(function(){c.get(a,
b).addCallbacks(function(a){d.callback(a)},function(a){d.errback(a)})});return d}throw new ydn.debug.error.ArgumentException('Store name "'+k+'" not found.');}var l=b;goog.asserts.assert(ydn.db.Key.isValidKey(l),"key "+l+" of type "+typeof l+" is not a valid key");this.logger.finer("getById: "+k+":"+l);d=this.tx_thread.request(ydn.db.Request.Method.GET,[k]);g.hook(d,arguments,void 0,this);d.addTxback(function(){this.getCrudExecutor().getById(d,k,l)},this)}else throw new ydn.debug.error.ArgumentException("get require valid input arguments.");
return d};
ydn.db.crud.DbOperator.prototype.keys=function(a,b,c,d,e,f,g){var h,k,l=null,m=!1,n=!1,p=a,q=this.schema.getStore(p);if(goog.DEBUG){if(!goog.isString(p))throw new ydn.debug.error.ArgumentException("store name must be a string, but "+p+" of type "+typeof p+" is not.");if(!this.schema.isAutoSchema()){if(!q)throw new ydn.debug.error.ArgumentException('store name "'+p+'" not found.');if(goog.isString(b)&&!q.getIndex(b))throw new ydn.debug.error.ArgumentException('index "'+b+'" not found in store "'+p+
'".');}}if(this.schema.isAutoSchema()&&!q)return ydn.db.Request.succeed(ydn.db.Request.Method.KEYS,[]);var r;if(goog.isString(b)){var s=b;if(goog.DEBUG){var t=ydn.db.KeyRange.validate(c);if(t)throw new ydn.debug.error.ArgumentException("invalid key range: "+c+" "+t);}l=ydn.db.KeyRange.parseIDBKeyRange(c);if(goog.isNumber(d))h=d;else{if(goog.isDef(d))throw new ydn.debug.error.ArgumentException("limit must be a number");h=ydn.db.base.DEFAULT_RESULT_LIMIT}if(goog.isNumber(e))k=e;else{if(goog.isDef(e))throw new ydn.debug.error.ArgumentException("offset must be a number");
k=0}if(goog.isDef(f))if(goog.isBoolean(f))m=f;else throw new ydn.debug.error.ArgumentException("reverse must be a boolean");if(goog.isDef(g))if(goog.isBoolean(g))n=g;else throw new ydn.debug.error.ArgumentException("unique must be a boolean");this.logger.finer("keysByIndexKeyRange: "+p);r=this.tx_thread.request(ydn.db.Request.Method.KEYS_INDEX,[p]);q.hook(r,arguments);r.addTxback(function(){this.getCrudExecutor().list(r,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,p,s,l,h,k,m,n)},this)}else{if(goog.isObject(b)){if(goog.DEBUG&&
(t=ydn.db.KeyRange.validate(b)))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(b)+" "+t);l=ydn.db.KeyRange.parseIDBKeyRange(b)}else{if(goog.DEBUG&&goog.isDefAndNotNull(b))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(b)+" of type "+typeof b);l=null}if(goog.isNumber(c))h=c;else{if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("limit must be a number");h=ydn.db.base.DEFAULT_RESULT_LIMIT}if(goog.isNumber(d))k=
d;else{if(goog.isDef(d))throw new ydn.debug.error.ArgumentException("offset must be a number");k=0}if(goog.isDef(e))if(goog.isBoolean(e))m=e;else throw new ydn.debug.error.ArgumentException("reverse must be a boolean");this.logger.finer("keysByKeyRange: "+p);r=this.tx_thread.request(ydn.db.Request.Method.KEYS,[p]);q.hook(r,arguments);r.addTxback(function(){this.getCrudExecutor().list(r,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,p,null,l,h,k,m,!1)},this)}return r};
ydn.db.crud.DbOperator.prototype.values=function(a,b,c,d,e,f,g){var h=this,k,l=ydn.db.Request.Method.NONE,m,n,p=!1,q=!1;if(goog.isString(a)){var r=a,s=this.schema.getStore(r);if(!s){if(this.schema.isAutoSchema()){if(this.getStorage().isReady())return ydn.db.Request.succeed(ydn.db.Request.Method.VALUES,[]);k=new ydn.db.Request(ydn.db.Request.Method.VALUES);this.getStorage().onReady(function(){h.values(a,b,c,d,e,f).addCallbacks(function(a){k.callback(a)},function(a){k.errback(a)})});return k}throw new ydn.db.NotFoundError(r);
}if(goog.isArray(b)){if(goog.DEBUG&&(goog.isDef(c)||goog.isDef(d)))throw new ydn.debug.error.ArgumentException("too many input arguments");var t=b;this.logger.finer("listByIds: "+r+" "+t.length+" ids");k=this.tx_thread.request(ydn.db.Request.Method.VALUES_IDS,[r]);s.hook(k,arguments,void 0,this);k.addTxback(function(){this.getCrudExecutor().listByIds(k,r,t)},this)}else if(goog.isString(b)){var u=b;if(goog.DEBUG){if(!s.hasIndex(u))throw new ydn.debug.error.ArgumentException('index "'+u+'" not found in store "'+
r+'"');if(l=ydn.db.KeyRange.validate(c))throw new ydn.debug.error.ArgumentException("invalid key range: "+c+" "+l);}var v=ydn.db.KeyRange.parseIDBKeyRange(c);if(goog.isDef(d))if(goog.isNumber(d))m=d;else throw new ydn.debug.error.ArgumentException("limit must be a number.");else m=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(e))if(goog.isNumber(e))n=e;else throw new ydn.debug.error.ArgumentException("offset must be a number.");else n=0;if(goog.isBoolean(f))p=f;else if(goog.isDef(f))throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+
f);if(goog.isDef(g))if(goog.isBoolean(g))q=g;else throw new ydn.debug.error.ArgumentException("unique must be a boolean");this.logger.finer("listByIndexKeyRange: "+r+":"+u);l=ydn.db.Request.Method.VALUES_INDEX;k=this.tx_thread.request(l,[r]);s.hook(k,arguments);k.addTxback(function(){this.getCrudExecutor().list(k,ydn.db.base.QueryMethod.LIST_VALUE,r,u,v,m,n,p,q)},this)}else{v=null;if(goog.isObject(b)){if(goog.DEBUG&&(l=ydn.db.KeyRange.validate(b)))throw new ydn.debug.error.ArgumentException("invalid key range: "+
b+" "+l);v=ydn.db.KeyRange.parseIDBKeyRange(b)}else if(goog.DEBUG&&goog.isDefAndNotNull(b))throw new ydn.debug.error.ArgumentException('expect key range object, but found "'+ydn.json.toShortString(b)+'" of type '+typeof b);if(goog.isDef(c))if(goog.isNumber(c))m=c;else throw new ydn.debug.error.ArgumentException("limit must be a number, but "+c+" is "+typeof c);else m=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(d))if(goog.isNumber(d))n=d;else throw new ydn.debug.error.ArgumentException("offset must be a number, but "+
d+" is "+typeof d);else n=0;if(goog.isDef(e))if(goog.isBoolean(e))p=e;else throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+e+" is "+typeof e);this.logger.finer((v?"listByKeyRange: ":"listByStore: ")+r);l=ydn.db.Request.Method.VALUES;k=this.tx_thread.request(l,[r]);s.hook(k,arguments);k.addTxback(function(){this.getCrudExecutor().list(k,ydn.db.base.QueryMethod.LIST_VALUE,r,null,v,m,n,p,!1)},this)}}else if(goog.isArray(a))if(a[0]instanceof ydn.db.Key){for(var s=[],x=a,
l=0;l<x.length;l++){var y=x[l].getStoreName();if(!this.schema.hasStore(y)){if(this.schema.isAutoSchema())return s=[],s[x.length-1]=void 0,ydn.db.Request.succeed(ydn.db.Request.Method.GET,s);throw new ydn.debug.error.ArgumentException("Store: "+y+" not found.");}goog.array.contains(s,y)||s.push(y)}this.logger.finer("listByKeys: "+ydn.json.stringify(s)+" "+x.length+" keys");k=this.tx_thread.request(ydn.db.Request.Method.VALUES_KEYS,s);k.addTxback(function(){this.getCrudExecutor().listByKeys(k,x)},this)}else throw new ydn.debug.error.ArgumentException("first argumentmust be array of ydn.db.Key, but "+
a[0]+" of "+typeof a[0]+" found.");else throw new ydn.debug.error.ArgumentException("first argument "+a+" is invalid.");return k};
ydn.db.crud.DbOperator.prototype.list=function(a,b,c,d,e,f,g,h,k){var l=this.schema.getStore(b);if(!l){if(this.schema.isAutoSchema())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,[]);throw new ydn.db.NotFoundError(b);}var m,n=ydn.db.Request.Method.NONE;if(goog.DEBUG){if(c&&!l.hasIndex(c))throw new ydn.debug.error.ArgumentException('index "'+c+'" not found in store "'+b+'"');if(l=ydn.db.KeyRange.validate(d))throw new ydn.debug.error.ArgumentException("invalid key range: "+d+" "+l);}var p=
ydn.db.KeyRange.parseIDBKeyRange(d),q=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isNumber(e))q=e;else if(goog.isDefAndNotNull(e))throw new ydn.debug.error.ArgumentException('limit must be a number but "'+e+'" of type '+typeof e+" found.");var r=0;if(goog.isNumber(f))r=f;else if(goog.isDefAndNotNull(f))throw new ydn.debug.error.ArgumentException('offset must be a number but "'+f+'" of type '+typeof f+" found.");var s=!1;if(goog.isBoolean(g))s=g;else if(goog.isDefAndNotNull(g))throw new ydn.debug.error.ArgumentException('reverse must be a boolean but "'+
g+'" of type '+typeof g+" found.");var t=!1;if(goog.isBoolean(h))t=h;else if(goog.isDefAndNotNull(h))throw new ydn.debug.error.ArgumentException('unique must be a boolean but "'+h+'" of type '+typeof h+" found.");if(r&&k&&goog.isDef(k[0]))throw new ydn.debug.error.ArgumentException("offset must not given when initial cursor position is defined");this.logger.finer(a+": "+b+":"+c);n=ydn.db.Request.Method.VALUES_INDEX;m=this.tx_thread.request(n,[b]);m.addTxback(function(){this.getCrudExecutor().list(m,
a,b,c||null,p,q,r,s,t,k)},this);return m};
ydn.db.crud.DbOperator.prototype.add=function(a,b,c){var d=goog.isString(a)?a:goog.isObject(a)?a.name:void 0;if(!goog.isString(d))throw new ydn.debug.error.ArgumentException("store name "+d+" must be a string, but "+typeof d);var e=this.schema.getStore(d);if(!e){if(!this.schema.isAutoSchema())throw new ydn.debug.error.ArgumentException('store name "'+d+'" not found.');a=goog.isObject(a)?a:{name:d};e=ydn.db.schema.Store.fromJSON(a);this.logger.finer("Adding object store: "+d);this.addStoreSchema(e)}else if(this.schema.isAutoSchema()&&
goog.isObject(a)&&(a=ydn.db.schema.Store.fromJSON(a),a=e.difference(a)))throw new ydn.debug.error.NotSupportedException(a);var f;if(!e)throw new ydn.debug.error.ArgumentException('store name "'+d+'" not found.');if(goog.isString(e.keyPath)&&goog.isDef(c))throw new ydn.debug.error.ArgumentException("key must not be provided while the store uses in-line key.");if(!e.usedInlineKey()&&!e.autoIncrement&&!goog.isDef(c))throw new ydn.debug.error.ArgumentException("out-of-line key must be provided.");if(goog.isArray(b)){this.logger.finer("addObjects: "+
d+" "+b.length+" objects");for(a=0;a<b.length;a++)e.generateIndex(b[a]);f=this.tx_thread.request(ydn.db.Request.Method.ADDS,[d],ydn.db.base.TransactionMode.READ_WRITE);f.addTxback(function(){this.getCrudExecutor().insertObjects(f,!1,!1,d,b,c)},this);e.dispatch_events&&f.addCallback(function(a){a=new ydn.db.events.StoreEvent(ydn.db.events.Types.CREATED,this.getStorage(),e.getName(),a,b);this.getStorage().dispatchDbEvent(a)},this)}else if(goog.isObject(b))a="store: "+d+" key: "+e.extractKey(b,c),this.logger.finer("addObject: "+
a),e.generateIndex(b),f=this.tx_thread.request(ydn.db.Request.Method.ADD,[d],ydn.db.base.TransactionMode.READ_WRITE),f.addTxback(function(){this.getCrudExecutor().insertObjects(f,!1,!0,d,[b],[c])},this),e.dispatch_events&&f.addCallback(function(a){a=new ydn.db.events.RecordEvent(ydn.db.events.Types.CREATED,this.getStorage(),e.getName(),a,b);this.getStorage().dispatchDbEvent(a)},this);else throw new ydn.debug.error.ArgumentException("record must be an object or array list of objects, but "+b+" of type "+
typeof b+" found.");return f};
ydn.db.crud.DbOperator.prototype.getStore_=function(a){var b=goog.isString(a)?a:goog.isObject(a)?a.name:void 0;if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("store name must be a string");var c=this.schema.getStore(b);if(!c){if(!this.schema.isAutoSchema())throw new ydn.db.NotFoundError(b);c=goog.isObject(a)?a:{name:b};c=ydn.db.schema.Store.fromJSON(c);this.logger.finer("Adding object store: "+b);this.addStoreSchema(c)}else if(this.schema.isAutoSchema()&&goog.isObject(a)&&(a=ydn.db.schema.Store.fromJSON(a),
a=c.difference(a)))throw new ydn.debug.error.NotSupportedException(a);if(!c)throw new ydn.db.NotFoundError(b);return c};ydn.db.crud.DbOperator.prototype.load=function(a,b,c){var d=c||",",e=this.getStore_(a).getName();a=this.tx_thread.request(ydn.db.Request.Method.LOAD,[e]);var f=this;this.tx_thread.exec(a,function(a,c,k){f.getCrudExecutor().putData(a,c,k,e,b,d)},[e],ydn.db.base.TransactionMode.READ_WRITE);return a};
ydn.db.crud.DbOperator.prototype.search=function(a){var b=a.getStoreList();this.logger.finest("query "+a);var c=this.tx_thread.request(ydn.db.Request.Method.SEARCH,b,ydn.db.base.TransactionMode.READ_ONLY);c.addTxback(function(){var b=this.getCrudExecutor();a.nextLookup(function(e,f,g,h){var k=c.copy();b.list(k,ydn.db.base.QueryMethod.LIST_VALUE,e,f,g.toIDBKeyRange(),100,0,!1,!1);k.addBoth(function(b){var d=null;b instanceof Array||(d=b,b=[]);b=a.addResult(this,b);!0===b?c.notify(a):!1===b&&c.callback(a.collect());
if(d)throw d;},h)})},this);return c};
ydn.db.crud.DbOperator.prototype.put=function(a,b,c){var d,e=this;if(a instanceof ydn.db.Key){var f=a,g=f.getStoreName(),h=this.schema.getStore(g);if(!h)throw new ydn.debug.error.ArgumentException('store "'+g+'" not found.');if(h.usedInlineKey()){var k=h.extractKey(b);if(goog.isDefAndNotNull(k)){if(0!=ydn.db.cmp(k,f.getId()))throw new ydn.debug.error.ArgumentException("Inline key must be "+f+" but "+k+" found.");}else h.setKeyValue(b,f.getId());return this.put(g,b)}return this.put(g,b,f.getId())}if(goog.isArray(a)){if(goog.DEBUG&&
goog.isDef(c))throw new ydn.debug.error.ArgumentException("too many arguments");var l=a;if(goog.DEBUG&&!goog.isDef(b))throw new ydn.debug.error.ArgumentException("record values required");goog.asserts.assertArray(b,"record values must also be in an array");var m=b;goog.asserts.assert(l.length===m.length,"number of keys and number of object must be same, but found "+l.length+" vs. "+m.length);f=[];g=0;for(h=l.length;g<h;g++){k=l[g].getStoreName();-1==goog.array.indexOf(f,k)&&f.push(k);var n=this.schema.getStore(k);
if(!n)throw new ydn.debug.error.ArgumentException('store "'+k+'" not found.');n.usedInlineKey()&&n.setKeyValue(m[g],l[g].getId())}this.logger.finer("putByKeys: to "+ydn.json.stringify(f)+" "+m.length+" objects");for(g=0;g<m.length;g++)n.generateIndex(m[g]);d=this.tx_thread.request(ydn.db.Request.Method.PUT_KEYS,f,ydn.db.base.TransactionMode.READ_WRITE);n.hook(d,arguments);d.addTxback(function(){e.getCrudExecutor().putByKeys(d,m,l)},this)}else if(goog.isString(a)||goog.isObject(a)){var n=this.getStore_(a),
p=n.getName();if(n.usedInlineKey()&&goog.isDef(c))throw new ydn.debug.error.ArgumentException("key must not be provided while the store uses in-line key.");if(!n.usedInlineKey()&&!n.autoIncrement&&!goog.isDef(c))throw new ydn.debug.error.ArgumentException("out-of-line key must be provided.");if(goog.isArray(b)){var q=b,r=c;this.logger.finer("putObjects: "+p+" "+q.length+" objects");for(g=0;g<q.length;g++)n.generateIndex(q[g]);d=this.tx_thread.request(ydn.db.Request.Method.PUTS,[p],ydn.db.base.TransactionMode.READ_WRITE);
n.hook(d,arguments);d.addTxback(function(){this.getCrudExecutor().insertObjects(d,!0,!1,p,q,r)},this);n.dispatch_events&&d.addCallback(function(a){a=new ydn.db.events.StoreEvent(ydn.db.events.Types.UPDATED,this.getStorage(),p,a,q);this.getStorage().dispatchDbEvent(a)},this)}else if(goog.isObject(b)){var s=b,t=c;goog.DEBUG&&(goog.isDef(t)?goog.asserts.assert(ydn.db.Key.isValidKey(t),t+" of type "+typeof t+" is invalid key for "+ydn.json.toShortString(s)):!n.isAutoIncrement()&&n.usedInlineKey()&&goog.asserts.assert(ydn.db.Key.isValidKey(n.extractKey(s)),
"in-line key on "+n.getKeyPath()+" must provided in "+ydn.json.toShortString(s)));this.logger.finer("putObject: "+p+" "+t);if(goog.isDef(goog.global.Blob)&&s instanceof Blob&&n.isFixed()&&!n.usedInlineKey()&&0==n.countIndex()&&goog.userAgent.WEBKIT)d=new ydn.db.Request(ydn.db.Request.Method.PUT),f=new FileReader,f.onload=function(a){var b=a.target.result,c=e.tx_thread.request(ydn.db.Request.Method.PUT,[p],ydn.db.base.TransactionMode.READ_WRITE);n.hook(c,[p,s,t]);c.addTxback(function(){e.getCrudExecutor().insertObjects(c,
!0,!0,p,[b],[t])},this);c.addCallbacks(function(a){d.callback(a)},function(a){d.errback(a)})},f.onerror=function(a){d.errback(a)},f.onabort=function(a){d.errback(a)},f.readAsDataURL(s);else{n.generateIndex(s);d=this.tx_thread.request(ydn.db.Request.Method.PUT,[p],ydn.db.base.TransactionMode.READ_WRITE);var u=[p,s,t];n.hook(d,u);d.addTxback(function(){var a=goog.isDef(t)?[u[2]]:void 0;e.getCrudExecutor().insertObjects(d,!0,!0,p,[u[1]],a)},this)}n.dispatch_events&&d.addCallback(function(a){a=new ydn.db.events.RecordEvent(ydn.db.events.Types.UPDATED,
this.getStorage(),p,a,s);this.getStorage().dispatchDbEvent(a)},this)}else throw new ydn.debug.error.ArgumentException("put record value must be Object or array of Objects");}else throw new ydn.debug.error.ArgumentException("the first argument of put must be store name, store schema or array of keys.");return d};
ydn.db.crud.DbOperator.prototype.dumpInternal=function(a,b,c,d,e){d=d?this.tx_thread:this.sync_thread;var f,g;if(goog.isString(a)){var h=this.schema.getStore(a);if(goog.DEBUG)if(h){if(!h.usedInlineKey()&&!h.isAutoIncrement()&&!goog.isDefAndNotNull(c))throw new ydn.debug.error.ArgumentException('key required for store "'+a+'"');}else throw new ydn.db.NotFoundError(a);for(var k=0;k<b.length;k++)h.generateIndex(b[k]);f=[a]}else{goog.asserts.assertArray(a,"store name "+a+" + must be an array or string, but "+
typeof a);g=a;f=[];for(var k=0,l=g.length;k<l;k++){var m=g[k].getStoreName(),h=this.schema.getStore(m);-1==goog.array.indexOf(f,m)&&f.push(m);if(goog.DEBUG&&!h)throw new ydn.db.NotFoundError(m);h.generateIndex(b[k])}}var n;if(goog.isString(a))h=this.schema.getStore(a),n=d.request(ydn.db.Request.Method.PUTS,f,ydn.db.base.TransactionMode.READ_WRITE),e&&h.hook(n,[a,b,c],e),n.addTxback(function(){this.getCrudExecutor().insertObjects(n,!0,!1,a,b,c)},this);else{n=d.request(ydn.db.Request.Method.PUT_KEYS,
f,ydn.db.base.TransactionMode.READ_WRITE);if(e)for(k=0;k<f.length;k++)h=this.schema.getStore(f[k]),h.hook(n,[b,g],e);n.addTxback(function(){this.getCrudExecutor().putByKeys(n,b,g)},this)}return n};
ydn.db.crud.DbOperator.prototype.removeInternalByKeys=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c].getStoreName();-1==goog.array.indexOf(b,e)&&b.push(e);if(goog.DEBUG&&!this.schema.hasStore(e))throw new ydn.db.NotFoundError(e);}var f=this.sync_thread.request(ydn.db.Request.Method.REMOVE_KEYS,b,ydn.db.base.TransactionMode.READ_WRITE);f.addTxback(function(){this.getCrudExecutor().removeByKeys(f,a)},this);return f};
ydn.db.crud.DbOperator.prototype.removeInternal=function(a,b){var c=this.sync_thread.request(ydn.db.Request.Method.REMOVE,[a],ydn.db.base.TransactionMode.READ_WRITE);c.addTxback(function(){this.getCrudExecutor().removeByKeyRange(c,a,b||null)},this);return c};
ydn.db.crud.DbOperator.prototype.listInternal=function(a,b,c,d,e,f){e=e||ydn.db.base.DEFAULT_RESULT_LIMIT;var g,h=f||0;if(goog.DEBUG)if(f=this.schema.getStore(a)){if(b&&!f.hasIndex(b))throw new ydn.db.NotFoundError('index "'+b+'" in store "'+a+'"');}else throw new ydn.db.NotFoundError(a);var k=ydn.db.KeyRange.parseIDBKeyRange(c);goog.isString(b)?(g=this.sync_thread.request(ydn.db.Request.Method.VALUES_INDEX,[a]),g.addTxback(function(){this.getCrudExecutor().list(g,ydn.db.base.QueryMethod.LIST_VALUE,
a,b,k,e,h,d,!1)},this)):(g=this.sync_thread.request(ydn.db.Request.Method.VALUES,[a]),g.addTxback(function(){this.getCrudExecutor().list(g,ydn.db.base.QueryMethod.LIST_VALUE,a,null,k,e,h,d,!1)},this));return g};
ydn.db.crud.DbOperator.prototype.valuesInternal=function(a){var b=[],c=a.length;if(0==c)return ydn.db.Request.succeed(ydn.db.Request.Method.KEYS,[]);for(var d=0;d<c;d++){var e=a[d].getStoreName();-1==goog.array.indexOf(b,e)&&b.push(e);if(goog.DEBUG&&!this.schema.hasStore(e))throw new ydn.db.NotFoundError(e);}var f=this,g=this.sync_thread.request(ydn.db.Request.Method.KEYS,b);g.addTxback(function(){f.getCrudExecutor().listByKeys(g,a)},this);return g};
ydn.db.crud.DbOperator.prototype.countInternal=function(a,b){var c=(b?this.tx_thread:this.sync_thread).request(ydn.db.Request.Method.COUNT,a);c.addTxback(function(){this.getCrudExecutor().countStores(c,a)},this);return c};
ydn.db.crud.DbOperator.prototype.keysInternal=function(a,b,c,d,e,f,g){var h;d=d||ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.DEBUG){var k=this.schema.getStore(a);if(k){if(b&&!k.hasIndex(b))throw new ydn.db.NotFoundError('index "'+b+'" in store "'+a+'"');}else throw new ydn.db.NotFoundError(a);}goog.isString(b)?(h=this.sync_thread.request(ydn.db.Request.Method.KEYS_INDEX,[a]),h.addTxback(function(){this.getCrudExecutor().list(h,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,b,c,d,e,f,g)},this)):(h=this.sync_thread.request(ydn.db.Request.Method.KEYS,
[a]),h.addTxback(function(){this.getCrudExecutor().list(h,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,null,c,d,e,f,g)},this));return h};
ydn.db.crud.DbOperator.prototype.clear=function(a,b,c){if(goog.DEBUG&&goog.isDef(c))throw new ydn.debug.error.ArgumentException("too many input arguments");var d;if(goog.isString(a)){c=this.schema.getStore(a);if(!c)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.isObject(b)){var e=ydn.db.KeyRange.parseIDBKeyRange(b);if(goog.isNull(e))throw new ydn.debug.error.ArgumentException("clear method requires a valid non-null KeyRange object.");this.logger.finer("clearByKeyRange: "+
a+":"+ydn.json.stringify(e));d=this.tx_thread.request(ydn.db.Request.Method.CLEAR,[a],ydn.db.base.TransactionMode.READ_WRITE);c.hook(d,[a,e]);d.addTxback(function(){this.getCrudExecutor().clearByKeyRange(d,a,e)},this)}else{if(goog.isDef(b))throw new ydn.debug.error.ArgumentException("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+typeof b);this.logger.finer("clearByStore: "+a);d=this.tx_thread.request(ydn.db.Request.Method.CLEAR,[a],ydn.db.base.TransactionMode.READ_WRITE);
d.addTxback(function(){this.getCrudExecutor().clearByStores(d,[a])},this)}}else if(!goog.isDef(a)||goog.isArray(a)&&goog.isString(a[0])){var f=a||this.schema.getStoreNames();this.logger.finer("clearByStores: "+ydn.json.stringify(f));d=this.tx_thread.request(ydn.db.Request.Method.CLEAR,f,ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().clearByStores(d,f)},this)}else throw new ydn.debug.error.ArgumentException('first argument "'+a+'" is invalid.');return d};
ydn.db.crud.DbOperator.prototype.remove=function(a,b,c){var d;if(goog.isString(a)){var e=this.schema.getStore(a);if(!e)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.isDef(c))if(goog.isString(b)){var f=e.getIndex(b);if(!f)throw new ydn.debug.error.ArgumentException("index: "+b+" not found in "+a);if(goog.isObject(c)||goog.isNull(c)){var g=ydn.db.KeyRange.parseIDBKeyRange(c);this.logger.finer("removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_INDEX,
[a],ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().removeByIndexKeyRange(d,a,f.getName(),g)},this)}else throw new ydn.debug.error.ArgumentException("key range "+c+' is invalid type "'+typeof c+'".');}else throw new ydn.debug.error.ArgumentException('index name "'+b+'" must be a string, but '+typeof b+" found.");else if(goog.isString(b)||goog.isNumber(b)||goog.isArrayLike(b)||b instanceof Date){this.logger.finer("removeById: "+a+":"+b);d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_ID,
[a],ydn.db.base.TransactionMode.READ_WRITE);var h=[a,b];e.hook(d,h);d.addTxback(function(){this.getCrudExecutor().removeById(d,a,h[1])},this);e.dispatch_events&&d.addCallback(function(b){b=new ydn.db.events.RecordEvent(ydn.db.events.Types.DELETED,this.getStorage(),a,b,void 0);this.getStorage().dispatchDbEvent(b)},this)}else if(goog.isObject(b))g=ydn.db.KeyRange.parseIDBKeyRange(b),this.logger.finer("removeByKeyRange: "+a+":"+ydn.json.stringify(g)),d=this.tx_thread.request(ydn.db.Request.Method.REMOVE,
[a],ydn.db.base.TransactionMode.READ_WRITE),e.hook(d,[a,g]),d.addTxback(function(){this.getCrudExecutor().removeByKeyRange(d,a,g)},this),e.dispatch_events&&d.addCallback(function(b){b=new ydn.db.events.StoreEvent(ydn.db.events.Types.DELETED,this.getStorage(),a,b,void 0);this.getStorage().dispatchDbEvent(b)},this);else throw new ydn.debug.error.ArgumentException('Invalid key or key range "'+b+'" of type '+typeof b);}else if(a instanceof ydn.db.Key){var k=a.getStoreName(),e=this.schema.getStore(k);
goog.asserts.assert(e,'store "'+k+'" not found.');d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_ID,[k],ydn.db.base.TransactionMode.READ_WRITE);var l=[k,a.getId()];e.hook(d,l);d.addTxback(function(){this.getCrudExecutor().removeById(d,k,l[1])},this)}else if(goog.isArray(a)){b=[];c=0;for(e=a.length;c<e;c++){if(goog.DEBUG&&!(a[c]instanceof ydn.db.Key))throw new ydn.debug.error.ArgumentException("key list element at "+c+" of "+e+' must be yn.db.Key, but "'+ydn.json.toShortString(a[c])+'" ('+goog.typeOf(a[c])+
") is not ydn.db.Key.");var m=a[c].getStoreName();-1==goog.array.indexOf(b,m)&&b.push(m)}if(1>b.length)throw new ydn.debug.error.ArgumentException('at least one valid key required in key list "'+ydn.json.toShortString(a)+'"');d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_KEYS,b,ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().removeByKeys(d,a)},this)}else throw new ydn.debug.error.ArgumentException('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+
ydn.json.toShortString(a)+'" ('+goog.typeOf(a)+") found.");return d};goog.DEBUG&&(ydn.db.crud.DbOperator.prototype.toString=function(){return"DbOperator:"+this.getStorage().getName()});ydn.db.core.DbOperator=function(a,b,c,d){ydn.db.crud.DbOperator.call(this,a,b,c,d)};goog.inherits(ydn.db.core.DbOperator,ydn.db.crud.DbOperator);ydn.db.core.DbOperator.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.DbOperator");ydn.db.core.DbOperator.DEBUG=!1;
ydn.db.core.DbOperator.prototype.get=function(a,b){if(a instanceof ydn.db.Iterator){var c=a.getStoreName(),d=this.schema.getStore(c);if(!d)throw new ydn.debug.error.ArgumentException('store "'+c+'" not found.');var e=a.getIndexName();if(goog.isDef(e)&&!d.hasIndex(e))throw new ydn.debug.error.ArgumentException('index "'+e+'" not found in store "'+c+'".');this.logger.finer("getByIterator:"+a);var f=this.tx_thread.request(ydn.db.Request.Method.GET_ITER,[c]);f.addTxback(function(){this.iterate(ydn.db.base.QueryMethod.GET,
f,a,1)},this);return f}return ydn.db.core.DbOperator.superClass_.get.call(this,a,b)};
ydn.db.core.DbOperator.prototype.keys=function(a,b,c,d,e,f,g){if(a instanceof ydn.db.Iterator){var h=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isNumber(b)){if(h=b,1>h)throw new ydn.debug.error.ArgumentException("limit must be a positive value, but "+b);}else if(goog.isDef(b))throw new ydn.debug.error.ArgumentException("limit must be a number,  but "+b);if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("offset must not be specified");this.logger.finer("keysByIterator:"+a);var k=this.tx_thread.request(ydn.db.Request.Method.KEYS_ITER,
[a.getStoreName()]);k.addTxback(function(){a.isIndexIterator()?this.iterate(ydn.db.base.QueryMethod.LIST_KEY,k,a,h):this.iterate(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,k,a,h)},this);return k}return ydn.db.core.DbOperator.superClass_.keys.call(this,a,b,c,d,e,f,g)};
ydn.db.core.DbOperator.prototype.count=function(a,b,c,d){if(a instanceof ydn.db.Iterator){if(goog.isDef(b)||goog.isDef(c))throw new ydn.debug.error.ArgumentException("too many arguments.");this.logger.finer("countIterator:"+a);var e=this.tx_thread.request(ydn.db.Request.Method.COUNT,[a.getStoreName()]);e.addTxback(function(){this.iterate(ydn.db.base.QueryMethod.COUNT,e,a)},this);return e}return ydn.db.core.DbOperator.superClass_.count.call(this,a,b,c,d)};
ydn.db.core.DbOperator.prototype.values=function(a,b,c,d,e,f){if(a instanceof ydn.db.Iterator){var g;if(goog.isNumber(b)){if(g=b,1>g)throw new ydn.debug.error.ArgumentException("limit must be a positive value, but "+g);}else if(goog.isDef(b))throw new ydn.debug.error.ArgumentException("limit must be a number, but "+b);if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("offset must not be specified");this.logger.finer("listByIterator:"+a);var h=this.tx_thread.request(ydn.db.Request.Method.VALUES_ITER,
[a.getStoreName()]);h.addTxback(function(){a.isKeyIterator()?this.iterate(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,h,a,g):this.iterate(ydn.db.base.QueryMethod.LIST_VALUE,h,a,g)},this);return h}return ydn.db.core.DbOperator.superClass_.values.call(this,a,b,c,d,e,f)};
ydn.db.core.DbOperator.prototype.scan=function(a,b,c){if(goog.DEBUG){if(!goog.isArray(b))throw new ydn.debug.error.ArgumentException("iterators argument must be an array, but "+b+" of type "+typeof b+" found");for(var d=0;d<b.length;d++)if(!(b[d]instanceof ydn.db.Iterator))throw new ydn.debug.error.ArgumentException("Iterator at "+d+" must be cursor range iterator.");}c=c||ydn.db.base.TransactionMode.READ_ONLY;for(var e=[],d=0;d<b.length;d++)for(var f=b[d].stores(),g=0;g<f.length;g++)goog.array.contains(e,
f[g])||e.push(f[g]);this.logger.finer(this+": scan for "+b.length+" iterators on "+e);var h=this,d=this.tx_thread.request(ydn.db.Request.Method.SCAN,e);this.tx_thread.exec(d,function(c,d,e){var f=d+" "+h+" scanning";h.logger.finest(f);var g=!1,q,r=[],s=[],t=[],u=[],v=0,x=function(c,d){if(g)throw ydn.db.core.DbOperator.DEBUG&&window.console.log("iterator "+c+" done"),new ydn.error.InternalError;v++;var k=v===q,l=r[c],y=b[l],l=u[l],x=l.getPrimaryKey(),z=l.getValue();if(ydn.db.core.DbOperator.DEBUG){var A=
d+(goog.isDefAndNotNull(x)?", "+x:"");window.console.log(l+" new position "+A+(k?" (all result done)":""))}s[c]=d;y.isIndexIterator()?y.isKeyIterator()?t[c]=x:t[c]=z:y.isKeyIterator()?t[c]=d:t[c]=z;if(k){z=a instanceof ydn.db.algo.AbstractSolver?a.solver(s,t):a(s,t);ydn.db.core.DbOperator.DEBUG&&window.console.log(h+" received result from solver "+ydn.json.stringify(z)+" for keys "+ydn.json.stringify(s));k=[];y=[];l=[];x=[];if(goog.isArray(z))for(var w=0;w<z.length;w++)!0===z[w]?l[w]=1:!1===z[w]?
x[w]=!0:y[w]=z[w];else if(goog.isNull(z))k=[];else if(goog.isDef(z))if(goog.isObject(z)){if(goog.DEBUG)for(w in k=["advance","continue","continuePrimary","restart"],z)if(!goog.array.contains(k,w))throw new ydn.debug.error.InvalidOperationException('Unknown attribute "'+w+'" in cursor advancement object');k=z.continuePrimary||[];y=z["continue"]||[];l=z.advance||[];x=z.restart||[]}else throw new ydn.debug.error.InvalidOperationException("scan callback output");else for(k=[],w=0;w<b.length;w++)goog.isDef(r[w])&&
(l[w]=1);for(w=v=z=0;w<b.length;w++)goog.isDefAndNotNull(k[w])||goog.isDef(y[w])||goog.isDefAndNotNull(x[w])||goog.isDefAndNotNull(l[w])||v++;for(w=0;w<b.length;w++)if(goog.isDefAndNotNull(k[w])||goog.isDef(y[w])||goog.isDefAndNotNull(x[w])||goog.isDefAndNotNull(l[w])){A=r[w];if(!goog.isDef(A))throw new ydn.error.InvalidOperationException(w+" is not an iterator.");var A=b[A],B=u[w];if(goog.DEBUG&&!goog.isDefAndNotNull(s[w])){var H=w+"/"+b.length;if(goog.isDefAndNotNull(l[w]))throw new ydn.error.InvalidOperationError(B+
" "+H+" must not advance "+l[w]+" steps");if(goog.isDef(y[w]))throw new ydn.error.InvalidOperationError(B+" "+H+" must not continue to key "+y[w]);if(goog.isDefAndNotNull(k[w]))throw new ydn.error.InvalidOperationError(B+" "+H+" must not continue to primary key "+k[w]);}s[w]=void 0;t[w]=void 0;if(goog.isDefAndNotNull(x[w]))ydn.db.core.DbOperator.DEBUG&&window.console.log("cursor "+B+" of iterator "+A+": restarting."),goog.asserts.assert(!0===x[w],w+" restart must be true"),B.restart();else if(goog.isDef(y[w]))ydn.db.core.DbOperator.DEBUG&&
window.console.log(A+": continuing to "+y[w]),B.continueEffectiveKey(y[w]);else if(goog.isDefAndNotNull(k[w]))ydn.db.core.DbOperator.DEBUG&&window.console.log(B+": continuing to primary key "+k[w]),B.continuePrimaryKey(k[w]);else if(goog.isDefAndNotNull(l[w]))ydn.db.core.DbOperator.DEBUG&&window.console.log(A+": advancing "+l[w]+" steps."),goog.asserts.assert(1===l[w],w+" advance value must be 1"),B.advance(1);else throw new ydn.error.InternalError(A+": has no action");z++}if(0==z){for(w=0;w<u.length;w++)u[w].exit();
g=!0;goog.array.clear(u);h.logger.finer("success "+f);e(void 0)}}},y=function(a){for(var b=0;b<u.length;b++)u[b].exit();goog.array.clear(u);h.logger.finer(f+" error");e(a,!0)},z=function(){for(var a=0,e=0;e<b.length;e++){var f=b[e],g=[h.getIndexExecutor().getCursor(c,d,f.getStoreName())],f=f.load(g);f.onFail=y;f.onNext=goog.partial(x,a);u[e]=f;r[a]=e;a++}q=b.length};a instanceof ydn.db.algo.AbstractSolver?a.begin(c,b,function(){z()})||z():z()},e,c);return d};
ydn.db.core.DbOperator.prototype.getIndexExecutor=function(){return this.getExecutor()};
ydn.db.core.DbOperator.prototype.open=function(a,b,c,d){if(goog.DEBUG){if(!(b instanceof ydn.db.Iterator))throw new ydn.debug.error.ArgumentException("Second argument must be cursor range iterator.");for(var e=b.stores(),f=0;f<e.length;f++)if(!this.schema.getStore(e[f]))throw new ydn.debug.error.ArgumentException('Store "'+e[f]+'" not found.');}c=c||ydn.db.base.TransactionMode.READ_ONLY;var g=this,h=this.tx_thread.request(ydn.db.Request.Method.OPEN,b.stores(),c);this.logger.finer("open:"+c+" "+b);
h.addTxback(function(c){var e=h.getLabel();g.logger.finer(e+" iterating "+b);for(var f=b.stores(),n=[],p=0;p<f.length;p++)n[p]=g.getIndexExecutor().getCursor(c,e,f[p]);var q=b.load(n);q.onFail=function(a){h.setDbValue(a,!0)};q.onNext=function(b){goog.isDefAndNotNull(b)?(b=a.call(d,q),!0===b?q.restart():goog.isObject(b)?!0===b.restart?q.restart(b["continue"],b.continuePrimary):goog.isDefAndNotNull(b["continue"])?q.continueEffectiveKey(b["continue"]):goog.isDefAndNotNull(b.continuePrimary)?q.continuePrimaryKey(b.continuePrimary):
(q.exit(),h.setDbValue(void 0)):goog.isNull(b)?(q.exit(),h.setDbValue(void 0)):goog.isDefAndNotNull(b)?q.continueEffectiveKey(b):q.advance(1)):(q.exit(),h.setDbValue(void 0))}},this);return h};
ydn.db.core.DbOperator.prototype.map=function(a,b){for(var c=this,d=a.stores(),e,f=0;e=d[f];f++)if(!e)throw new ydn.debug.error.ArgumentException('Store "'+e+'" not found.');e=this.tx_thread.request(ydn.db.Request.Method.MAP,d);this.logger.finest("map:"+a);this.tx_thread.exec(e,function(d,e,f){c.logger.finest(e+" iterating "+a);for(var l=a.stores(),m=[],n=0;n<l.length;n++)m[n]=c.getIndexExecutor().getCursor(d,e,l[n]);var p=a.load(m);p.onFail=function(a){f(a,!1)};p.onNext=function(c){goog.isDefAndNotNull(c)?
(c=a.isIndexIterator()?a.isKeyIterator()?c:p.getPrimaryKey():a.isKeyIterator()?c:p.getValue(),b(c),p.advance(1)):(f(void 0),b=null)}},d,ydn.db.base.TransactionMode.READ_ONLY);return e};
ydn.db.core.DbOperator.prototype.reduce=function(a,b,c){for(var d=this,e=a.stores(),f,g=0;f=e[g];g++)if(!f)throw new ydn.debug.error.ArgumentException('Store "'+f+'" not found.');f=this.tx_thread.request(ydn.db.Request.Method.REDUCE,e);var h=goog.isObject(c)?ydn.object.clone(c):c;this.logger.finer("reduce:"+a);this.tx_thread.exec(f,function(c,e,f){for(var g=a.stores(),p=[],q=0;q<g.length;q++)p[q]=d.getIndexExecutor().getCursor(c,e,g[q]);var r=a.load(p);r.onFail=function(a){f(a,!0)};var s=0;r.onNext=
function(c){goog.isDefAndNotNull(c)?(c=a.isIndexIterator()?a.isKeyIterator()?c:r.getPrimaryKey():a.isKeyIterator()?c:r.getValue(),h=b(h,c,s++),r.advance(1)):f(h)}},e,ydn.db.base.TransactionMode.READ_ONLY);return f};
ydn.db.core.DbOperator.prototype.listIter=function(a,b,c,d){var e=d||0,f=b.getStoreName(),g=b.getIndexName()||null,h=c||ydn.db.base.DEFAULT_RESULT_LIMIT;this.logger.finer("listIter:"+a+" "+b+(c?" limit="+h:"")+(d?" offset="+e:""));var k=this.tx_thread.request(ydn.db.Request.Method.VALUES_INDEX,[f]),l=b.getState()==ydn.db.Iterator.State.COMPLETED||b.getState()==ydn.db.Iterator.State.INITIAL?[]:[b.getKey(),b.getPrimaryKey()];k.addTxback(function(){b.getKey();this.getCrudExecutor().list(k,a,f,g,b.getKeyRange(),
h,e,b.isReversed(),b.isUnique(),l)},this);k.addCallback(function(){goog.isDefAndNotNull(l[0])?b.reset(ydn.db.Iterator.State.RESTING,l[0],l[1]):b.reset()});return k};
ydn.db.core.DbOperator.prototype.iterate=function(a,b,c,d,e){var f=[],g=b.getTx(),h=b.getLabel(),k=h+" "+a+"ByIterator "+c;0<d&&(k+=" limit "+d);var l=this;this.logger.finer(k);for(var m=this.getIndexExecutor(),n=[],p=c.stores(),q=0;q<p.length;q++)n[q]=m.getCursor(g,h,p[q]);var r=c.load(n);r.onFail=function(a){r.exit();b.setDbValue(a,!0)};var s=0,t=!1,u=!1;r.onNext=function(c){u||(l.logger.finest(k+" starting"),u=!0);goog.isDefAndNotNull(c)?(r.getPrimaryKey(),!t&&0<e?(r.advance(e),t=!0):(s++,a==ydn.db.base.QueryMethod.LIST_KEY?
f.push(c):a==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?f.push(r.getPrimaryKey()):a==ydn.db.base.QueryMethod.LIST_KEYS?f.push([c,r.getPrimaryKey()]):a!=ydn.db.base.QueryMethod.COUNT&&f.push(r.getValue()),a==ydn.db.base.QueryMethod.GET?(r.exit(),b.setDbValue(f[0])):a==ydn.db.base.QueryMethod.COUNT||!goog.isDef(d)||s<d?r.continueEffectiveKey():(l.logger.finer("success:"+k+" yields "+f.length+" records"),r.exit(),b.setDbValue(f)))):(l.logger.finer("success:"+k+" yields "+f.length+" records"),r.exit(),
b.setDbValue(a==ydn.db.base.QueryMethod.GET?f[0]:a==ydn.db.base.QueryMethod.COUNT?s:f))}};ydn.db.events={};ydn.db.events.Types={READY:"ready",ERROR:"error",FAIL:"fail",CREATED:"created",DELETED:"deleted",UPDATED:"updated"};ydn.db.events.Event=function(a,b){goog.events.Event.call(this,a,b)};goog.inherits(ydn.db.events.Event,goog.events.Event);ydn.db.events.Event.prototype.getStoreName=function(){return this.store_name};ydn.db.events.StorageEvent=function(a,b,c,d,e){ydn.db.events.Event.call(this,a,b);this.version=c;this.oldVersion=d;this.old_schema_=e};
goog.inherits(ydn.db.events.StorageEvent,ydn.db.events.Event);ydn.db.events.StorageEvent.prototype.name="ReadyEvent";ydn.db.events.StorageEvent.prototype.version=NaN;ydn.db.events.StorageEvent.prototype.oldVersion=NaN;ydn.db.events.StorageEvent.prototype.old_schema_=null;ydn.db.events.StorageEvent.prototype.getVersion=function(){return this.version};ydn.db.events.StorageEvent.prototype.getOldVersion=function(){return this.oldVersion};ydn.db.events.StorageEvent.prototype.getOldSchema=function(){return this.old_schema_};
ydn.db.events.StorageErrorEvent=function(a,b,c){ydn.db.events.Event.call(this,c||ydn.db.events.Types.ERROR,a);this.error=b};goog.inherits(ydn.db.events.StorageErrorEvent,ydn.db.events.Event);ydn.db.events.StorageErrorEvent.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};ydn.db.events.StorageErrorEvent.prototype.name="ErrorEvent";ydn.db.events.StorageErrorEvent.prototype.error=null;ydn.db.events.StorageErrorEvent.prototype.getError=function(){return this.error};
ydn.db.events.StorageFailEvent=function(a,b){ydn.db.events.StorageErrorEvent.call(this,a,b,ydn.db.events.Types.FAIL)};goog.inherits(ydn.db.events.StorageFailEvent,ydn.db.events.StorageErrorEvent);ydn.db.events.StorageFailEvent.prototype.name="FailEvent";ydn.db.events.RecordEvent=function(a,b,c,d,e){ydn.db.events.Event.call(this,a,b);this.store_name=c;this.key=d;this.value=e};goog.inherits(ydn.db.events.RecordEvent,ydn.db.events.Event);ydn.db.events.RecordEvent.prototype.name="RecordEvent";
ydn.db.events.RecordEvent.prototype.getKey=function(){return this.key};ydn.db.events.RecordEvent.prototype.getValue=function(){return this.value};ydn.db.events.StoreEvent=function(a,b,c,d,e){ydn.db.events.Event.call(this,a,b);this.store_name=c;this.keys=d;this.values=e};goog.inherits(ydn.db.events.StoreEvent,ydn.db.events.Event);ydn.db.events.StoreEvent.prototype.name="StoreEvent";ydn.db.events.StoreEvent.prototype.getKeys=function(){return this.keys};
ydn.db.events.StoreEvent.prototype.getValues=function(){return this.values};ydn.db.con.IDatabase=function(){};ydn.db.con.IDatabase.prototype.close=function(){};ydn.db.con.IDatabase.prototype.getType=function(){};ydn.db.con.IDatabase.prototype.isReady=function(){};ydn.db.con.IDatabase.prototype.connect=function(a,b){};ydn.db.con.IDatabase.prototype.getDbInstance=function(){};ydn.db.schema={};
ydn.db.schema.Index=function(a,b,c,d,e,f){goog.isDef(e)||(e=goog.isArray(a)?a.join(", "):a);if(goog.isDefAndNotNull(a)&&!goog.isString(a)&&!goog.isArrayLike(a))throw new ydn.debug.error.ArgumentException("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);goog.DEBUG&&goog.isArray(a)&&Object.freeze&&Object.freeze(a);!goog.isDef(a)&&goog.isDef(e)&&(a=e);this.keyPath=a;this.is_composite_=goog.isArrayLike(this.keyPath);this.index_name_=e;this.type=ydn.db.schema.Index.toType(b);if(goog.isDef(b)){if(!goog.isDef(this.type))throw new ydn.debug.error.ArgumentException("type invalid in index: "+
this.index_name_);if(goog.isArray(this.keyPath))throw new ydn.debug.error.ArgumentException('composite key for store "'+this.index_name_+'" must not specified type');}this.unique=!!c;this.multiEntry=!!d;this.keyColumnType_=goog.isString(this.type)?this.type:ydn.db.schema.DataType.TEXT;this.index_column_name_=goog.isString(e)?e:goog.isArray(a)?this.keyPath.join(","):a;this.index_column_name_quoted_=goog.string.quote(this.index_column_name_);this.key_paths_=this.is_composite_?null:this.keyPath.split(".");
goog.asserts.assert(!goog.isDefAndNotNull(f)||goog.isFunction(f),"index generator must be a function, , but "+typeof f+" found.");this.index_generator_=f||null};
ydn.db.schema.Index.prototype.extractKey=function(a){if(goog.isDefAndNotNull(a)){if(goog.isArrayLike(this.keyPath)){for(var b=[],c=0,d=this.keyPath.length;c<d;c++){var e=ydn.db.utils.getValueByKeys(a,this.keyPath[c]);goog.asserts.assert(goog.isDefAndNotNull(e),ydn.json.toShortString(a)+" does not issue require composite key value "+c+" of "+d+' on index "'+this.index_name_+'"');b[c]=e}return b}return ydn.db.utils.getValueByKeys(a,this.keyPath)}};
ydn.db.schema.Index.prototype.applyValue=function(a,b){for(var c=0;c<this.key_paths_.length;c++)c==this.key_paths_.length-1?a[this.key_paths_[c]]=b:goog.isObject(a[this.key_paths_[c]])||(a[this.key_paths_[c]]={})};ydn.db.schema.DataType={BLOB:"BLOB",DATE:"DATE",INTEGER:"INTEGER",NUMERIC:"NUMERIC",TEXT:"TEXT"};ydn.db.DataTypeAbbr={DATE:"d",NUMERIC:"n",TEXT:"t",BLOB:"b"};ydn.db.schema.Index.ARRAY_SEP=String.fromCharCode(31);
ydn.db.schema.Index.js2sql=function(a,b){if(b==ydn.db.schema.DataType.DATE){if(a instanceof Date)return+a}else return goog.isDefAndNotNull(b)?a:ydn.db.utils.encodeKey(a)};ydn.db.schema.Index.sql2js=function(a,b){return b==ydn.db.schema.DataType.DATE?new Date(a):goog.isDef(b)?a:ydn.db.utils.decodeKey(a)};ydn.db.schema.Index.TYPES=[ydn.db.schema.DataType.BLOB,ydn.db.schema.DataType.DATE,ydn.db.schema.DataType.INTEGER,ydn.db.schema.DataType.NUMERIC,ydn.db.schema.DataType.TEXT];
ydn.db.schema.Index.toType=function(a){if(goog.isString(a))return a=goog.array.indexOf(ydn.db.schema.Index.TYPES,a),ydn.db.schema.Index.TYPES[a]};ydn.db.schema.Index.toAbbrType=function(a){return a instanceof Date?ydn.db.DataTypeAbbr.DATE:goog.isNumber(a)?ydn.db.DataTypeAbbr.NUMERIC:goog.isString(a)?ydn.db.DataTypeAbbr.TEXT:ydn.db.DataTypeAbbr.BLOB};
ydn.db.schema.Index.type2AbbrType=function(a){return a===ydn.db.schema.DataType.DATE?ydn.db.DataTypeAbbr.DATE:a===ydn.db.schema.DataType.NUMERIC?ydn.db.DataTypeAbbr.NUMERIC:a===ydn.db.schema.DataType.TEXT?ydn.db.DataTypeAbbr.TEXT:ydn.db.DataTypeAbbr.BLOB};ydn.db.schema.Index.prototype.getType=function(){return this.type};ydn.db.schema.Index.prototype.getSqlType=function(){return this.keyColumnType_};ydn.db.schema.Index.prototype.getName=function(){return this.index_name_};
ydn.db.schema.Index.prototype.isMultiEntry=function(){return this.multiEntry};ydn.db.schema.Index.prototype.isComposite=function(){return this.is_composite_};ydn.db.schema.Index.prototype.isUnique=function(){return this.unique};ydn.db.schema.Index.prototype.toJSON=function(){return{name:this.index_name_,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};
ydn.db.schema.Index.prototype.clone=function(){var a=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath;return new ydn.db.schema.Index(a,this.type,this.unique,this.multiEntry,this.index_name_,this.index_generator_)};
ydn.db.schema.Index.compareKeyPath=function(a,b){return goog.isDefAndNotNull(a)||goog.isDefAndNotNull(b)?goog.isDefAndNotNull(a)?goog.isDefAndNotNull(b)?goog.isArrayLike(a)&&goog.isArrayLike(b)?goog.array.equals(a,b)?null:"expect: "+a+", but: "+b:ydn.object.equals(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null};ydn.db.schema.Index.prototype.equalsKeyPath=function(a){return!ydn.db.schema.Index.compareKeyPath(this.keyPath,a)};
ydn.db.schema.Index.prototype.difference=function(a){if(!a)return"no index for "+this.index_name_;if(this.index_name_!=a.index_name_)return"name, expect: "+this.index_name_+", but: "+a.index_name_;var b=ydn.db.schema.Index.compareKeyPath(this.keyPath,a.keyPath);return b?"keyPath, "+b:goog.isDefAndNotNull(this.unique)&&goog.isDefAndNotNull(a.unique)&&this.unique!=a.unique?"unique, expect: "+this.unique+", but: "+a.unique:goog.isDefAndNotNull(this.multiEntry)&&goog.isDefAndNotNull(a.multiEntry)&&this.multiEntry!=
a.multiEntry?"multiEntry, expect: "+this.multiEntry+", but: "+a.multiEntry:goog.isDef(this.type)&&goog.isDef(a.type)&&(goog.isArrayLike(this.type)?!goog.array.equals(this.type,a.type):this.type!=a.type)?"data type, expect: "+this.type+", but: "+a.type:""};
ydn.db.schema.Index.prototype.hint=function(a){if(!a)return this;goog.asserts.assert(this.index_name_==a.index_name_,"index name: "+this.index_name_+" != "+a.index_name_);var b=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath,c=this.type;goog.isDef(a.type)||"TEXT"!=c||(c=void 0);return new ydn.db.schema.Index(b,c,this.unique,this.multiEntry,a.index_name_)};ydn.db.schema.Index.toDir=function(a){a=goog.array.indexOf(ydn.db.base.DIRECTIONS,a);return ydn.db.base.DIRECTIONS[a]};
ydn.db.schema.Index.prototype.getKeyPath=function(){return this.keyPath};ydn.db.schema.Index.prototype.getSQLIndexColumnName=function(){return this.index_column_name_};ydn.db.schema.Index.prototype.getSQLIndexColumnNameQuoted=function(){return this.index_column_name_quoted_};ydn.db.schema.Index.prototype.setGenerator=function(a){goog.asserts.assert(!this.index_generator_,"index "+this.index_name_+" already has a generator");this.index_generator_=a};
ydn.db.schema.Index.prototype.generateIndex=function(a){if(this.index_generator_){var b=this.index_generator_(a),c=typeof b;if("string"==c||"number"==c||b instanceof Date||goog.isArray(b)){for(c=0;c<this.key_paths_.length-1;c++)goog.isObject(a[this.key_paths_[c]])||(a[this.key_paths_[c]]={});a[this.key_paths_[this.key_paths_.length-1]]=b}}};
ydn.db.schema.Index.fromJSON=function(a){if(goog.DEBUG){var b="name unique type keyPath multiEntry generator".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException("Unknown field: "+c+" in "+ydn.json.stringify(a));}return new ydn.db.schema.Index(a.keyPath,a.type,a.unique,a.multiEntry,a.name,a.generator)};
goog.DEBUG&&(ydn.db.schema.Index.prototype.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.key_paths_&&1<this.key_paths_.length&&(a+="Compound");return a+"Index:"+this.index_name_});ydn.db.schema.Store=function(a,b,c,d,e,f,g,h){this.name_=a;if(!goog.isString(this.name_))throw new ydn.debug.error.ArgumentException("store name must be a string");this.keyPath=goog.isDef(b)?b:null;this.isComposite=goog.isArrayLike(this.keyPath);if(!goog.isNull(this.keyPath)&&!goog.isString(this.keyPath)&&!this.isComposite)throw new ydn.debug.error.ArgumentException("keyPath must be a string or array");this.autoIncrement=c;var k;if(goog.isDefAndNotNull(d)){k=ydn.db.schema.Index.toType(d);if(!goog.isDef(k))throw new ydn.debug.error.ArgumentException('type "'+
d+'" for primary key in store "'+this.name_+'" is invalid.');if(this.isComposite)throw new ydn.debug.error.ArgumentException('composite key for store "'+this.name_+'" must not specified type');}this.type=goog.isDefAndNotNull(k)?k:this.autoIncrement?ydn.db.schema.DataType.INTEGER:void 0;this.keyPaths=goog.isString(this.keyPath)?this.keyPath.split("."):[];this.indexes=e||[];this.dispatch_events=!!f;this.fixed=!!g;this.keyColumnType_=goog.isString(this.type)?this.type:ydn.db.schema.DataType.TEXT;this.primary_column_name_=
goog.isArray(this.keyPath)?this.keyPath.join(","):goog.isString(this.keyPath)?this.keyPath:ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;this.primary_column_name_quoted_=goog.string.quote(this.primary_column_name_);this.is_encrypted_=!!h;if(goog.DEBUG&&this.is_encrypted_){if(this.keyPath)throw new ydn.debug.error.ArgumentException('encrypted store "'+this.name_+'" must not use inline key');if(this.isAutoIncrement())throw new ydn.debug.error.ArgumentException('encrypted store "'+this.name_+'" must not use key generator');
}this.hooks_=[]};ydn.db.schema.Store.FetchStrategy={LAST_UPDATED:"last-updated",ASCENDING_KEY:"ascending-key",DESCENDING_KEY:"descending-key"};ydn.db.schema.Store.FetchStrategies=[ydn.db.schema.Store.FetchStrategy.LAST_UPDATED,ydn.db.schema.Store.FetchStrategy.ASCENDING_KEY,ydn.db.schema.Store.FetchStrategy.DESCENDING_KEY];ydn.db.schema.Store.prototype.dispatch_events=!1;ydn.db.schema.Store.prototype.fixed=!1;
ydn.db.schema.Store.prototype.toJSON=function(){for(var a=[],b=0;b<this.indexes.length;b++)a.push(this.indexes[b].toJSON());return{name:this.name_,keyPath:this.keyPath,autoIncrement:this.autoIncrement,type:this.type,indexes:a}};
ydn.db.schema.Store.fromJSON=function(a){if(goog.DEBUG){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException('Unknown attribute "'+c+'"');}b=[];c=a.indexes||[];if(goog.isArray(c))for(var d=0;d<c.length;d++){var e=ydn.db.schema.Index.fromJSON(c[d]);goog.isDef(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new ydn.db.schema.Store(a.name,a.keyPath,
a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)};ydn.db.schema.Store.prototype.toSql=function(a,b,c,d,e,f){a=this.inSql(a,b,c,d,e,f);c="";b!=ydn.db.base.QueryMethod.NONE&&(c+="SELECT "+a.select);c+=" FROM "+a.from;a.where&&(c+=" WHERE "+a.where);a.group&&(c+=" GROUP BY "+a.group);a.order&&(c+=" ORDER BY "+a.order);return c};
ydn.db.schema.Store.prototype.inSql=function(a,b,c,d,e,f){var g={select:"",from:"",where:"",group:"",order:""},h=this.primary_column_name_,k=this.primary_column_name_quoted_,l=null;c!==h&&goog.isString(c)&&(l=this.getIndex(c));var m=!!l,n=c||h,p=goog.string.quote(n);m?l.getKeyPath():this.getKeyPath();var q=m?l.getType():this.getType(),r=m&&l.isMultiEntry();g.from=this.getQuotedName();b===ydn.db.base.QueryMethod.COUNT?g.select="COUNT("+k+")":b===ydn.db.base.QueryMethod.LIST_KEYS||b===ydn.db.base.QueryMethod.LIST_KEY||
b===ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?(g.select=k,goog.isDefAndNotNull(c)&&c!=h&&(g.select+=", "+p)):g.select="*";h=f?"DISTINCT ":"";c=[];r?(r=goog.string.quote(ydn.db.base.PREFIX_MULTIENTRY+this.getName()+":"+l.getName()),g.select=b===ydn.db.base.QueryMethod.COUNT?"COUNT("+h+r+"."+p+")":b===ydn.db.base.QueryMethod.LIST_KEYS||b===ydn.db.base.QueryMethod.LIST_KEY||b===ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?"DISTINCT "+this.getQuotedName()+"."+k+", "+r+"."+p+" AS "+n:"DISTINCT "+this.getQuotedName()+
".*, "+r+"."+p+" AS "+n,g.from=r+" INNER JOIN "+this.getQuotedName()+" USING ("+k+")",b=r+"."+p,goog.isDefAndNotNull(d)&&(ydn.db.KeyRange.toSql(b,q,d,c,a),0<c.length&&(g.where=g.where?g.where+(" AND "+c.join(" AND ")):c.join(" AND ")))):goog.isDefAndNotNull(d)&&(ydn.db.KeyRange.toSql(p,q,d,c,a),0<c.length&&(g.where=g.where?g.where+(" AND "+c.join(" AND ")):c.join(" AND ")));m&&!l.isUnique()&&f&&(g.group=p);a=e?"DESC":"ASC";g.order=p+" "+a;m&&(g.order+=", "+k+" "+a);return g};
ydn.db.schema.Store.prototype.sqlContinueEffectiveKey=function(a,b,c,d,e,f,g,h){var k,l,m,n;goog.isDefAndNotNull(d)?(k=d.lower,l=d.upper,m=d.lowerOpen,n=d.upperOpen,e?goog.isDefAndNotNull(l)?(d=ydn.db.cmp(g,l),-1==d?(l=g,n=h):0==d&&(n=h||n)):(l=g,n=h):goog.isDefAndNotNull(k)?(d=ydn.db.cmp(g,k),1==d?(k=g,m=h):0==d&&(m=h||m)):(k=g,m=h)):e?(l=g,n=h):(k=g,m=h);d=new ydn.db.KeyRange(k,l,!!m,!!n);g=(c=c?this.getIndex(c):null)?c.getSQLIndexColumnName():this.getSQLKeyColumnName();a=this.inSql(b,a,g,d,e,f);
a="SELECT "+a.select+" FROM "+a.from+(a.where?" WHERE "+a.where:"")+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.order;c&&(e=e?"DESC":"ASC",a+=", "+this.getSQLKeyColumnNameQuoted()+e);return a};
ydn.db.schema.Store.prototype.sqlContinueIndexEffectiveKey=function(a,b,c,d,e,f,g,h,k){var l=this.getIndex(c),m=l.getSQLIndexColumnName();c=l.getSQLIndexColumnNameQuoted();this.getSQLKeyColumnName();var n=this.getSQLKeyColumnNameQuoted(),p=h?" <":" >",p=f?p+" ":p+"= ";f=ydn.db.schema.Index.js2sql(e,l.getType());g=ydn.db.schema.Index.js2sql(g,this.getType());l="";d?(a=this.inSql(b,a,m,d,h,k),a.where+=" AND ",l=c+p+"?",b.push(f)):(d=h?ydn.db.KeyRange.upperBound(e,!0):ydn.db.KeyRange.lowerBound(e,!0),
a=this.inSql(b,a,m,d,h,k),l=a.where,a.where="");a.where+="("+l+" OR ("+c+" = ? AND "+n+p+"?))";b.push(f);b.push(g);return"SELECT "+a.select+" FROM "+a.from+" WHERE "+a.where+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.order};ydn.db.schema.Store.prototype.clone=function(){return ydn.db.schema.Store.fromJSON(this.toJSON())};ydn.db.schema.Store.prototype.countIndex=function(){return this.indexes.length};ydn.db.schema.Store.prototype.index=function(a){return this.indexes[a]||null};
ydn.db.schema.Store.prototype.getIndex=function(a){return goog.array.find(this.indexes,function(b){return b.getName()==a})};ydn.db.schema.Store.prototype.getIndexByKeyPath=function(a){for(var b=0;b<this.indexes.length;b++)if(this.indexes[b].equalsKeyPath(a))return this.indexes[b];return null};ydn.db.schema.Store.prototype.isFixed=function(){return this.fixed};ydn.db.schema.Store.prototype.isEncrypted=function(){return this.is_encrypted_};
ydn.db.schema.Store.prototype.hasIndex=function(a){return a===this.keyPath?!0:goog.array.some(this.indexes,function(b){return b.getName()==a})};ydn.db.schema.Store.prototype.isKeyPath=function(a){return goog.isDef(this.keyPath)?1==this.keyPaths.length?this.keyPath===a:goog.isArrayLike(a)?goog.array.equals(this.keyPaths,a):!1:!1};
ydn.db.schema.Store.prototype.hasIndexByKeyPath=function(a){return this.keyPath&&goog.isNull(ydn.db.schema.Index.compareKeyPath(this.keyPath,a))?!0:goog.array.some(this.indexes,function(b){return goog.isDefAndNotNull(b.keyPath)&&goog.isNull(ydn.db.schema.Index.compareKeyPath(b.keyPath,a))})};ydn.db.schema.Store.prototype.getSQLKeyColumnNameQuoted=function(){return this.primary_column_name_quoted_};ydn.db.schema.Store.prototype.getSQLKeyColumnName=function(){return this.primary_column_name_};
ydn.db.schema.Store.prototype.getQuotedName=function(){return goog.string.quote(this.name_)};ydn.db.schema.Store.prototype.getColumns=function(){if(this.columns_&&this.columns_.length!=this.indexes.length){this.columns_=[];for(var a=0;a<this.indexes.length;a++)this.columns_.push(this.indexes[a].getName())}return this.columns_};
ydn.db.schema.Store.prototype.hintForIdb=function(a){for(var b=0;b<a.indexes.length;b++){var c=a.indexes[b];this.hasIndex(c.getName())||c.getType()!=ydn.db.schema.DataType.BLOB||(c=new ydn.db.schema.Index(c.getKeyPath(),c.getType(),c.isUnique(),c.isMultiEntry(),c.getName()),this.indexes.push(c))}};
ydn.db.schema.Store.prototype.hintForWebSql=function(a){if(!a)return this;goog.asserts.assert(this.name_==a.name_,"store name: "+this.name_+" != "+a.name_);var b=this.autoIncrement,c=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath,d=this.type,e=goog.array.map(this.indexes,function(a){return a.clone()});goog.isDef(a.type)||"TEXT"!=d||(d=void 0);goog.isArray(a.keyPath)&&goog.isString(c)&&c==a.keyPath.join(",")&&(c=goog.array.clone(a.keyPath));for(var f=0,g=a.indexes.length;f<
g;f++)if(a.indexes[f].isComposite())for(var h=a.indexes[f].getName(),k=e.length-1;0<=k;k--)if(0<=h.indexOf(e[k].getName())){e[k]=a.indexes[f].clone();break}for(f=0;f<e.length;f++)(g=a.getIndex(e[f].getName()))&&(e[f]=e[f].hint(g));return new ydn.db.schema.Store(a.name_,c,b,d,e)};ydn.db.schema.Store.prototype.getName=function(){return this.name_};ydn.db.schema.Store.prototype.isAutoIncrement=function(){return this.autoIncrement};ydn.db.schema.Store.prototype.getKeyPath=function(){return this.keyPath};
ydn.db.schema.Store.prototype.usedInlineKey=function(){return!!this.keyPath};ydn.db.schema.Store.prototype.getIndexNames=function(){return this.indexes.map(function(a){return a.getName()})};ydn.db.schema.Store.prototype.getType=function(){return this.type};ydn.db.schema.Store.prototype.getSqlType=function(){return this.keyColumnType_};ydn.db.schema.Store.prototype.getIndexKeyPaths=function(){return this.indexes.map(function(a){return a.keyPath})};
ydn.db.schema.Store.prototype.addIndex=function(a,b,c,d){this.indexes.push(new ydn.db.schema.Index(a,b,c,d))};ydn.db.schema.Store.prototype.extractKey=function(a,b){if(a){if(!this.usedInlineKey()&&goog.isDefAndNotNull(b))return b;if(this.isComposite){for(var c=[],d=0;d<this.keyPath.length;d++)c.push(ydn.db.utils.getValueByKeys(a,this.keyPath[d]));return c}if(this.keyPath)return goog.object.getValueByKeys(a,this.keyPaths)}};
ydn.db.schema.Store.prototype.getRowValue=function(a){if(goog.isDefAndNotNull(this.keyPath))return a=a[this.keyPath],this.type==ydn.db.schema.DataType.DATE?a=Date.parse(a):this.type==ydn.db.schema.DataType.NUMERIC?a=parseFloat(a):this.type==ydn.db.schema.DataType.INTEGER&&(a=parseInt(a,10)),a};ydn.db.schema.Store.prototype.generateKey=function(){goog.isDef(this.current_key_)||(this.current_key_=0);return this.current_key_++};
ydn.db.schema.Store.prototype.setKeyValue=function(a,b){for(var c=0;c<this.keyPaths.length;c++){var d=this.keyPaths[c];if(c==this.keyPaths.length-1){a[d]=b;break}goog.isDef(a[d])||(a[d]={});a=a[d]}};
ydn.db.schema.Store.prototype.sqlNamesValues=function(a,b,c){var d=[],e=[];b=goog.isDef(b)?b:this.extractKey(a);goog.isDef(b)&&(e.push(this.getSQLKeyColumnNameQuoted()),d.push(ydn.db.schema.Index.js2sql(b,this.getType())));for(var f=0;f<this.indexes.length;f++){var g=this.indexes[f];if(!(g.isMultiEntry()||g.getName()===this.keyPath||g.getName()==ydn.db.base.DEFAULT_BLOB_COLUMN||c&&g.isUnique())){var h=g.extractKey(a);goog.isDefAndNotNull(h)&&(d.push(ydn.db.schema.Index.js2sql(h,g.getType())),e.push(g.getSQLIndexColumnNameQuoted()))}}this.fixed?
this.isFixed()&&!this.usedInlineKey()&&0==this.countIndex()&&(goog.isString(a)&&-1==a.indexOf(";base64,")?d.push(a):d.push(ydn.json.stringify(a)),e.push(ydn.db.base.DEFAULT_BLOB_COLUMN)):(d.push(ydn.json.stringify(a)),e.push(ydn.db.base.DEFAULT_BLOB_COLUMN));a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{columns:e,slots:a,values:d,key:b}};ydn.db.schema.Store.prototype.equals=function(a){return this.name_===a.name_&&ydn.object.equals(this.toJSON(),a.toJSON())};
ydn.db.schema.Store.prototype.difference=function(a){if(!a)return"missing store: "+this.name_;if(this.name_!=a.name_)return"store name, expect: "+this.name_+", but: "+a.name_;var b=ydn.db.schema.Index.compareKeyPath(this.keyPath,a.keyPath);if(b)return"keyPath, "+b;if(goog.isDef(this.autoIncrement)&&goog.isDef(a.autoIncrement)&&this.autoIncrement!=a.autoIncrement)return"autoIncrement, expect:  "+this.autoIncrement+", but: "+a.autoIncrement;if(this.indexes.length!=a.indexes.length)return"indexes length, expect:  "+
this.indexes.length+", but: "+a.indexes.length;if(goog.isDef(this.type)&&goog.isDef(a.type)&&(goog.isArrayLike(this.type)?!goog.array.equals(this.type,a.type):this.type!=a.type))return"data type, expect:  "+this.type+", but: "+a.type;for(b=0;b<this.indexes.length;b++){var c=a.getIndex(this.indexes[b].getName()),c=this.indexes[b].difference(c);if(0<c.length)return'index "'+this.indexes[b].getName()+'" '+c}return""};ydn.db.schema.Store.prototype.similar=function(a){return 0==this.difference(a).length};
ydn.db.schema.Store.prototype.generateIndex=function(a){if(a)for(var b=0;b<this.indexes.length;b++)this.indexes[b].generateIndex(a)};ydn.db.schema.Store.prototype.addHook=function(a){this.hooks_.push(a);return this.hooks_.length-1};ydn.db.schema.Store.prototype.hook=function(a,b,c,d){for(var e=0;e<this.hooks_.length;e++)c!==e&&this.hooks_[e].call(d,a,b)};
ydn.db.schema.Store.prototype.getIndexName=function(a){var b,c=a;goog.isArray(a)?(b=this.getIndexByKeyPath(a),c=a.join(", ")):b=this.getIndex(a);if(goog.DEBUG&&!b)throw new ydn.debug.error.ArgumentException('require index "'+c+'" not found in store "'+this.getName()+'"');return b.getName()};goog.DEBUG&&(ydn.db.schema.Store.prototype.toString=function(){return"Store:"+this.name_+"["+this.countIndex()+"index]"});ydn.db.schema.fulltext={};ydn.db.schema.fulltext.Entry=function(){};ydn.db.schema.fulltext.ResultSet=function(){};ydn.db.schema.fulltext.ResultSet.prototype.getStoreList=function(){};ydn.db.schema.fulltext.ResultSet.prototype.nextLookup=function(a){};ydn.db.schema.fulltext.ResultSet.prototype.addResult=function(a,b){};ydn.db.schema.fulltext.ResultSet.prototype.collect=function(){};ydn.db.schema.fulltext.Engine=function(){};ydn.db.schema.fulltext.Engine.prototype.query=function(a,b,c,d){};ydn.db.schema.fulltext.Engine.prototype.analyze=function(a,b,c){};ydn.db.schema.fulltext.InvIndex=function(a,b,c){if(goog.DEBUG){if(!a||goog.string.isEmpty(a))throw new ydn.debug.error.ArgumentException("store_name must be provided for primary full text index");if(!b||goog.string.isEmpty(b))throw new ydn.debug.error.ArgumentException("index_name must be provided for primary full text index");}this.store_name=a;this.key_path=b;this.weight=c||1};ydn.db.schema.fulltext.InvIndex.prototype.getStoreName=function(){return this.store_name};
ydn.db.schema.fulltext.InvIndex.prototype.getWeight=function(){return this.weight};ydn.db.schema.fulltext.InvIndex.prototype.getKeyPath=function(){return this.key_path};
ydn.db.schema.fulltext.InvIndex.fromJson=function(a){if(goog.DEBUG){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException("Unknown field: "+c+" in "+ydn.json.toShortString(a));}return new ydn.db.schema.fulltext.InvIndex(a.storeName,a.keyPath,a.weight)};ydn.db.schema.fulltext.Catalog=function(a,b,c,d){this.name=a;this.indexes=b;this.lang=c||"";if(goog.DEBUG&&-1==["","en","fr"].indexOf(this.lang))throw new ydn.debug.error.ArgumentException('Unsupported lang "'+c+" for full text search index "+a);this.normalizers=d||null;this.engine=null};ydn.db.schema.fulltext.Catalog.prototype.getSourceNames=function(){for(var a=[],b=0;b<this.indexes.length;b++){var c=this.indexes[b].getStoreName();-1==a.indexOf(c)&&a.push(c)}return a};
ydn.db.schema.fulltext.Catalog.prototype.getName=function(){return this.name};ydn.db.schema.fulltext.Catalog.prototype.count=function(){return this.indexes.length};ydn.db.schema.fulltext.Catalog.prototype.index=function(a){return this.indexes[a]};ydn.db.schema.fulltext.Catalog.prototype.getSource=function(a,b){return goog.array.find(this.indexes,function(c){return c.getStoreName()==a&&c.getKeyPath()==b})};
ydn.db.schema.fulltext.Catalog.fromJson=function(a){if(goog.DEBUG){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException("Unknown field: "+c+" in "+ydn.json.stringify(a));}if(!goog.isArray(a.sources))throw new ydn.debug.error.ArgumentException("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){return ydn.db.schema.fulltext.InvIndex.fromJson(a)});
return new ydn.db.schema.fulltext.Catalog(a.name,b,a.lang)};ydn.db.schema.Database=function(a,b){var c,d,e=b;if(goog.isObject(a)){d=a;if(goog.DEBUG){c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==goog.array.indexOf(c,f))throw new ydn.debug.error.ArgumentException("Unknown field: "+f+" in schema.");}c=d.version;var e=[],g=d.stores||[];if(goog.DEBUG&&!goog.isArray(g))throw new ydn.debug.error.ArgumentException("stores must be array");this.default_text_store_name_=d.defaultTextStoreName;for(f=0;f<g.length;f++){var h=ydn.db.schema.Store.fromJSON(g[f]);
if(goog.DEBUG&&-1!=goog.array.findIndex(e,function(a){return a.name==h.getName()}))throw new ydn.debug.error.ArgumentException('duplicate store name "'+h.getName()+'".');e.push(h)}}else goog.isString(a)?c=0==a.length?void 0:parseFloat(a):goog.isNumber(a)&&(c=a);if(goog.isDef(c)){if(!goog.isNumber(c)||0>c)throw new ydn.debug.error.ArgumentException("Invalid version: "+c+" ("+a+")");isNaN(c)&&(c=void 0)}if(goog.isDef(b)&&(!goog.isArray(b)||0<b.length&&!(b[0]instanceof ydn.db.schema.Store)))throw new ydn.debug.error.ArgumentException("stores");
this.version=c;this.is_auto_version_=!goog.isDef(this.version);this.stores=e||[];c=[];if(d&&d.fullTextCatalogs)for(goog.asserts.assertArray(d.fullTextCatalogs,"fullTextCatalogs"),f=0;f<d.fullTextCatalogs.length;f++)e=ydn.db.schema.fulltext.Catalog.fromJson(d.fullTextCatalogs[f]),c[f]=e,this.getStore(e.getName())||(g=[new ydn.db.schema.Index("k",ydn.db.schema.DataType.TEXT),new ydn.db.schema.Index("v",ydn.db.schema.DataType.TEXT)],e=new ydn.db.schema.Store(e.getName(),"id",!1,void 0,g),this.stores.push(e));
this.full_text_schema_=c};ydn.db.schema.Database.prototype.countFullTextIndex=function(){return this.full_text_schema_.length};ydn.db.schema.Database.prototype.fullTextIndex=function(a){return this.full_text_schema_[a]};ydn.db.schema.Database.prototype.getFullTextIndex=function(a){return goog.array.find(this.full_text_schema_,function(b){return b.getName()==a})};
ydn.db.schema.Database.prototype.getDefaultTextStoreName=function(){goog.asserts.assertString(this.default_text_store_name_,"defaultTextStoreName is not defined in the database schema");return this.default_text_store_name_};ydn.db.schema.Database.prototype.toJSON=function(){var a=goog.array.map(this.stores,function(a){return a.toJSON()}),b={};b.stores=a;goog.isDef(this.version)&&(b.version=this.version);return b};ydn.db.schema.Database.prototype.is_auto_version_=!1;
ydn.db.schema.Database.prototype.getVersion=function(){return this.version};ydn.db.schema.Database.prototype.setVersion=function(a){goog.asserts.assert(this.is_auto_version_,"autoversion schema cannot set a version");goog.asserts.assertNumber(a,"version must be a number");this.version=a};ydn.db.schema.Database.prototype.isAutoVersion=function(){return this.is_auto_version_};ydn.db.schema.Database.prototype.isAutoSchema=function(){return!1};
ydn.db.schema.Database.prototype.getStoreNames=function(){return goog.array.map(this.stores,function(a){return a.getName()})};ydn.db.schema.Database.prototype.store=function(a){return this.stores[a]||null};ydn.db.schema.Database.prototype.count=function(){return this.stores.length};ydn.db.schema.Database.prototype.getStore=function(a){return goog.array.find(this.stores,function(b){return b.getName()==a})};
ydn.db.schema.Database.prototype.getIndexOf=function(a){return goog.array.indexOf(this.stores,function(b){return b.name==a})};ydn.db.schema.Database.prototype.hasStore=function(a){return goog.array.some(this.stores,function(b){return b.getName()==a})};
ydn.db.schema.Database.prototype.difference=function(a,b,c){if(!a||this.stores.length!=a.stores.length)return"Number of store: "+this.stores.length+" vs "+a.stores.length;for(var d=0;d<this.stores.length;d++){var e=a.getStore(this.stores[d].getName());if(e){if(b&&(e=e.hintForWebSql(this.stores[d])),c&&e.hintForIdb(this.stores[d]),e=this.stores[d].difference(e),0<e.length)return'store: "'+this.stores[d].getName()+'" '+e}else return'missing object store "'+this.stores[d].getName()+'"'}return""};
ydn.db.schema.Database.prototype.similar=function(a){return 0==this.difference(a,!1,!1).length};ydn.db.schema.Database.prototype.getFullTextSchema=function(a){return goog.array.find(this.full_text_schema_,function(b){return b.getName()==a})};ydn.db.schema.Database.prototype.listStores=function(){this.store_names||(this.store_names=goog.array.map(this.stores,function(a){return a.getName()}));return this.store_names};ydn.db.schema.EditableDatabase=function(a,b){ydn.db.schema.Database.call(this,a,b)};goog.inherits(ydn.db.schema.EditableDatabase,ydn.db.schema.Database);ydn.db.schema.EditableDatabase.prototype.isAutoSchema=function(){return!0};ydn.db.schema.EditableDatabase.prototype.addStore=function(a){this.stores.push(a)};ydn.object={};ydn.object.clone=function(a){return ydn.json.parse(ydn.json.stringify(a))};
ydn.object.equals=function(a,b,c){c=c||{};if(goog.isDefAndNotNull(a)&&goog.isDefAndNotNull(b)){if(goog.isArrayLike(a)&&goog.isArrayLike(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(-1==goog.array.find(b,function(b){return ydn.object.equals(b,a[d])}))return!1;return!0}if(goog.isArrayLike(a))return 1==a.length&&ydn.object.equals(a[0],b);if(goog.isArrayLike(b))return 1==b.length&&ydn.object.equals(b[0],a);if(goog.isObject(a)&&goog.isObject(a)){for(var e in a)if(a.hasOwnProperty(e)&&
!c[e]){var f=ydn.object.equals(a[e],b[e]);if(!f)return!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=ydn.object.equals(a[e],b[e]),!f))return!1;return!0}return a===b}return!1};ydn.object.length=function(a){if(a&&a.length&&goog.isNumber(a.length))return a.length;var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};ydn.object.extend=function(a,b){var c=ydn.object.clone(a),d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c};ydn.object.reparr=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};
ydn.object.takeFirst=function(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return a[b]};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
ydn.db.con.Storage=function(a,b,c){c=c||{};if(goog.DEBUG){var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==goog.array.indexOf(d,e))throw new ydn.debug.error.ArgumentException('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!goog.isArray(c.mechanisms))throw new ydn.debug.error.ArgumentException("mechanisms attribute must be an array but "+goog.typeOf(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!goog.array.contains(ydn.db.con.Storage.PREFERENCE,
c.mechanisms[e]))throw new ydn.debug.error.ArgumentException('Invalid mechanism "'+c.mechanisms[e]+'"');}}this.mechanisms=c.mechanisms||ydn.db.con.Storage.PREFERENCE;this.size=c.size;this.connectionTimeout=goog.isDef(c.connectionTimeout)?c.connectionTimeout:ydn.db.con.Storage.DEBUG?1E3:goog.DEBUG?3E4:18E5;this.db_=null;this.txQueue_=[];this.in_version_change_tx_=!1;if(b instanceof ydn.db.schema.Database)d=b;else if(goog.isObject(b)){var d=c.autoSchema||!goog.isDef(b.stores)?new ydn.db.schema.EditableDatabase(b):
new ydn.db.schema.Database(b),f=b.stores?b.stores.length:0;for(e=0;e<f;e++){var g=d.getStore(b.stores[e].name);b.stores[e].Sync&&this.addSynchronizer(g,b.stores[e].Sync)}}else d=new ydn.db.schema.EditableDatabase;b=this.setEncryption(c.Encryption);this.schema=d;for(e=0;e<this.schema.count();e++)if(this.schema.store(e).isEncrypted()){if(goog.DEBUG&&!b)throw Error("encryption option must be defined");this.addEncryption(this.schema.store(e))}goog.isDef(a)&&this.setName(a);this.event_target=null;this.df_on_ready_=
new goog.async.Deferred};ydn.db.con.Storage.DEBUG=!1;ydn.db.con.Storage.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.Storage");ydn.db.con.Storage.prototype.getSchema=function(a){if(goog.isDef(a)){var b=function(b){a(b.toJSON())};if(this.db_)this.db_.getSchema(b);else{var c=this;goog.asserts.assertFunction(b,"schema");this.transaction(function(a){c.db_.getSchema(b,a)},null,ydn.db.base.TransactionMode.READ_ONLY)}}return this.schema?this.schema.toJSON():null};
ydn.db.con.Storage.prototype.addStoreSchema=function(a){var b=a instanceof ydn.db.schema.Store?a:ydn.db.schema.Store.fromJSON(a);a=a.name;var c=this.schema.getStore(a);if(b.similar(c))return goog.async.Deferred.succeed(!1);c=c?"update":"add";if(this.schema instanceof ydn.db.schema.EditableDatabase)return this.schema.addStore(b),this.db_?(this.db_.close(),this.db_=null,this.connectDatabase()):goog.async.Deferred.succeed(!1);throw new ydn.error.ConstraintError(goog.DEBUG?"Cannot "+c+" store: "+a+". Not auto schema generation mode.":
"");};ydn.db.con.Storage.prototype.setName=function(a){if(this.db_)throw new ydn.debug.error.InvalidOperationException("Already connected with "+this.db_name);goog.asserts.assertString(a,"database name must be a string but found "+a+" of type "+typeof a);this.db_name=a;this.connectDatabase()};ydn.db.con.Storage.prototype.getName=function(){return this.db_name};
ydn.db.con.Storage.PREFERENCE=[ydn.db.base.Mechanisms.IDB,ydn.db.base.Mechanisms.WEBSQL,ydn.db.base.Mechanisms.LOCAL_STORAGE,ydn.db.base.Mechanisms.SESSION_STORAGE,ydn.db.base.Mechanisms.USER_DATA,ydn.db.base.Mechanisms.MEMORY_STORAGE];ydn.db.con.Storage.prototype.createDbInstance=function(a){return null};
ydn.db.con.Storage.prototype.connectDatabase=function(){for(var a=this,b=new goog.async.Deferred,c=function(c,e){c?(a.logger.finest(a+": ready."),a.last_queue_checkin_=NaN,d.onError=function(b){b=new ydn.db.events.StorageErrorEvent(a,b);a.dispatchDbEvent(b)},d.onFail=function(b){b=new ydn.db.events.StorageFailEvent(a,b);a.dispatchDbEvent(b);a.db_=null},d.onVersionChange=function(b){a.dispatchDbEvent(b)},setTimeout(function(){a.dispatchReady(e);a.popTxQueue_()},10),b.callback(e)):(a.logger.warning(a+
": database connection fail "+e.name),setTimeout(function(){var b=new ydn.db.events.StorageFailEvent(a,e);a.dispatchReady(b);a.purgeTxQueue_(e)},10),b.errback(e))},d=null,e=this.mechanisms,f=0;f<e.length;f++){var g=e[f].toLowerCase();if(d=this.createDbInstance(g)){d=this.createDbInstance(g);break}}goog.isNull(d)?(e=new ydn.error.ConstraintError("No storage mechanism found."),e=new ydn.db.events.StorageFailEvent(this,e),c(!1,e)):(this.init(),d.connect(this.db_name,this.schema).addCallbacks(function(a){this.db_=
d;a=new ydn.db.events.StorageEvent(ydn.db.events.Types.READY,this,parseFloat(d.getVersion()),parseFloat(a),null);c(!0,a)},function(a){this.logger.warning(this+": opening fail");c(!1,a)},this));return b};ydn.db.con.Storage.prototype.getType=function(){if(this.db_)return this.db_.getType()};ydn.db.con.Storage.prototype.onReady=function(a,b){this.df_on_ready_.addBoth(a,b)};
ydn.db.con.Storage.prototype.dispatchReady=function(a){var b=this;setTimeout(function(){a instanceof ydn.db.events.StorageErrorEvent?b.df_on_ready_.errback(a.error):b.df_on_ready_.callback();b.dispatchDbEvent(a)},4)};ydn.db.con.Storage.prototype.isReady=function(){return!!this.db_&&this.db_.isReady()};ydn.db.con.Storage.prototype.init=function(){};ydn.db.con.Storage.prototype.close=function(){this.db_&&(this.db_.close(),this.db_=null,this.logger.finest(this+" closed"))};
ydn.db.con.Storage.prototype.getDbInstance=function(){return this.db_?this.db_.getDbInstance():null};ydn.db.con.Storage.prototype.last_queue_checkin_=NaN;ydn.db.con.Storage.QUEUE_LIMIT=100;ydn.db.con.Storage.prototype.countTxQueue=function(){return this.txQueue_.length};ydn.db.con.Storage.prototype.popTxQueue_=function(){var a=this.txQueue_.shift();a&&(this.logger.finest("pop tx queue["+(this.txQueue_.length+1)+"]"),this.transaction(a.fnc,a.scopes,a.mode,a.oncompleted));this.last_queue_checkin_=goog.now()};
ydn.db.con.Storage.prototype.pushTxQueue_=function(a,b,c,d){this.logger.finest("push tx queue["+this.txQueue_.length+"]");this.txQueue_.push({fnc:a,scopes:b,mode:c,oncompleted:d});goog.DEBUG&&this.txQueue_.length>ydn.db.con.Storage.QUEUE_LIMIT&&0==this.txQueue_.length%ydn.db.con.Storage.QUEUE_LIMIT&&this.logger.warning("Transaction queue stack size is "+this.txQueue_.length+". It is too large, possibility due to incorrect usage.")};
ydn.db.con.Storage.prototype.purgeTxQueue_=function(a){if(this.txQueue_){this.logger.info("Purging "+this.txQueue_.length+" transactions request.");for(var b;b=this.txQueue_.shift();)if(b.oncompleted)b.oncompleted(ydn.db.base.TxEventTypes.ERROR,a)}};ydn.db.con.Storage.prototype.in_version_change_tx_=!1;
ydn.db.con.Storage.prototype.transaction=function(a,b,c,d){var e=b;if(goog.isString(b))e=[b];else if(!goog.isDefAndNotNull(b))e=null;else if(goog.DEBUG)if(goog.isArrayLike(b)){if(0==b.length)throw new ydn.debug.error.ArgumentException("number of store names must more than 0");for(var f=0;f<b.length;f++)if(!goog.isString(b[f]))throw new ydn.debug.error.ArgumentException("store name at "+f+" must be string but found "+typeof b[f]);}else throw new ydn.debug.error.ArgumentException("store names must be an array");
if(this.db_&&this.db_.isReady()&&!this.in_version_change_tx_){var g=this,h=goog.isDef(c)?c:ydn.db.base.TransactionMode.READ_ONLY;h==ydn.db.base.TransactionMode.VERSION_CHANGE&&(this.in_version_change_tx_=!0);this.db_.doTransaction(function(b){a(b);a=null},e,h,function(a,b){goog.isFunction(d)&&(d(a,b),d=void 0);h==ydn.db.base.TransactionMode.VERSION_CHANGE&&(g.in_version_change_tx_=!1);g.popTxQueue_()})}else this.pushTxQueue_(a,e,c,d)};ydn.db.con.Storage.prototype.isAutoVersion=function(){return this.schema.isAutoVersion()};
ydn.db.con.Storage.prototype.isAutoSchema=function(){return this.schema.isAutoSchema()};ydn.db.con.Storage.prototype.addSynchronizer=function(a,b){this.logger.warning("Synchronization option for "+a.getName()+" ignored.")};ydn.db.con.Storage.prototype.addEncryption=function(a){this.logger.warning("Encryption option for "+a.getName()+" ignored.")};ydn.db.con.Storage.prototype.setEncryption=function(a){return!1};
ydn.db.con.Storage.prototype.addFullTextIndexer=function(a,b){this.logger.warning("Full text indexer option for "+a.getName()+" ignored.")};ydn.db.con.Storage.prototype.getEventTypes=function(){return"created error fail ready deleted updated versionchange".split(" ")};ydn.db.con.Storage.prototype.dispatchDbEvent=function(a){};goog.DEBUG&&(ydn.db.con.Storage.prototype.toString=function(){return"Storage:"+this.db_});ydn.db.tr.ParallelTxExecutor=function(a,b,c,d){this.tx_=a;this.tx_no_=b;this.scopes_=goog.array.clone(c);this.mode_=d;this.oncompleted_handlers=[]};ydn.db.tr.ParallelTxExecutor.prototype.tx_=null;ydn.db.tr.ParallelTxExecutor.prototype.isActive=function(){return!!this.tx_};ydn.db.tr.ParallelTxExecutor.prototype.getTx=function(){return this.tx_};ydn.db.tr.ParallelTxExecutor.prototype.getTxNo=function(){return this.tx_no_};
ydn.db.tr.ParallelTxExecutor.prototype.onCompleted=function(a,b){goog.asserts.assert(this.isActive(),this.tx_no_+" already completed?");for(var c=0;c<this.oncompleted_handlers.length;c++)this.oncompleted_handlers[c](a,b);this.oncompleted_handlers.length=0;this.oncompleted_handlers=this.scopes_=this.tx_=null};
ydn.db.tr.ParallelTxExecutor.prototype.executeTx=function(a,b){if(this.tx_)b&&this.oncompleted_handlers.push(b),a(this.tx_);else throw new ydn.debug.error.InternalError("tx committed on ParallelTxExecutor");};ydn.db.tr.ParallelTxExecutor.prototype.sameScope=function(a,b){if(!this.scopes_||!this.mode_||b!=this.mode_||this.scopes_.length!=a.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.scopes_.indexOf(a[c]))return!1;return!0};
ydn.db.tr.ParallelTxExecutor.prototype.subScope=function(a,b){if(!this.scopes_||!this.mode_||b!=this.mode_&&(this.mode_!=ydn.db.base.TransactionMode.READ_WRITE||b!=ydn.db.base.TransactionMode.READ_ONLY)||a.length>this.scopes_.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.scopes_.indexOf(a[c]))return!1;return!0};goog.DEBUG&&(ydn.db.tr.ParallelTxExecutor.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.tx_no_+" mode:"+this.mode_+" scopes:"+ydn.json.stringify(this.scopes_)});ydn.db.tr.Parallel=function(a,b,c,d,e,f){ydn.db.tr.Thread.call(this,a,b,c,d,e,f);this.p_request_tx=this.pl_tx_ex_=null};goog.inherits(ydn.db.tr.Parallel,ydn.db.tr.Thread);ydn.db.tr.Parallel.DEBUG=!1;ydn.db.tr.Parallel.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.Parallel");ydn.db.tr.Parallel.prototype.getPlTx=function(){return this.pl_tx_ex_};ydn.db.tr.Parallel.prototype.isActive=function(){return!!this.pl_tx_ex_&&this.pl_tx_ex_.isActive()};
ydn.db.tr.Parallel.prototype.sameScope=function(a,b){return this.pl_tx_ex_.sameScope(a,b)};ydn.db.tr.Parallel.prototype.subScope=function(a,b){return this.pl_tx_ex_.subScope(a,b)};ydn.db.tr.Parallel.prototype.abort=function(){this.logger.finer(this+": aborting");ydn.db.tr.Thread.abort(this.p_request_tx)};
ydn.db.tr.Parallel.prototype.reusedTx=function(a,b){return this.policy==ydn.db.tr.Thread.Policy.MULTI?this.pl_tx_ex_.subScope(a,b):this.policy==ydn.db.tr.Thread.Policy.REPEAT?this.pl_tx_ex_.sameScope(a,b):this.policy==ydn.db.tr.Thread.Policy.ALL?!0:!1};
ydn.db.tr.Parallel.prototype.processTx=function(a,b,c,d){var e;this.scope_store_names&&(b=this.scope_store_names);this.scope_mode&&(c=this.scope_mode);var f=goog.isDef(c)?c:ydn.db.base.TransactionMode.READ_ONLY,g=this,h;c=function(a,b){g.logger.fine(e+" "+a);if(h)h.onCompleted(a,b);g.r_no_=0};var k=function(c){g.tx_no_++;h=new ydn.db.tr.ParallelTxExecutor(c,g.tx_no_,b,f);e=g.getLabel();g.logger.fine(e+" BEGIN "+ydn.json.stringify(b)+" "+f);g.pl_tx_ex_=h;g.pl_tx_ex_.executeTx(a,d)},l=this.isActive()&&
this.reusedTx(b,f);if(ydn.db.tr.Parallel.DEBUG){var m=this.isActive()?"active":"inactive";window.console.log(this+" "+this.pl_tx_ex_+(l?" reusing "+m+" transaction":" opening "+m+" transaction ")+" for mode:"+f+" scopes:"+ydn.json.stringify(b))}if(l)this.pl_tx_ex_.executeTx(a,d);else{if(this.max_tx_no&&this.tx_no_>=this.max_tx_no)throw new ydn.debug.error.InvalidOperationException("Exceed maximum number of transactions of "+this.max_tx_no);this.getStorage().transaction(k,b,f,c)}};
ydn.db.tr.Parallel.prototype.request=function(a,b,c,d){var e=ydn.db.tr.Parallel.superClass_.request.call(this,a,b,c,d);a=c||ydn.db.base.TransactionMode.READ_ONLY;var f=this;if(ydn.db.tr.Parallel.DEBUG){var g="SN"+Math.random(),g=g.replace(".","");window.console.log(this+" scheduling to execute "+b+" "+a+" "+g)}this.processTx(function(a){ydn.db.tr.Parallel.DEBUG&&window.console.log(f+" executing "+g);f.r_no_++;var b=f.getLabel()+"R"+f.r_no_;e.setTx(a,b)},b,a,d);return e};
ydn.db.tr.Parallel.prototype.exec=function(a,b,c,d,e){var f=this,g;if(ydn.db.tr.Parallel.DEBUG){var h="SN"+Math.random(),h=h.replace(".","");window.console.log(this+" scheduling to execute "+c+" "+d+" "+h)}this.processTx(function(c){ydn.db.tr.Parallel.DEBUG&&window.console.log(this+" executing "+h);f.r_no_++;g=f.getLabel()+"R"+f.r_no_;f.logger.finer(g+" BEGIN");b(c,g,function(b,d){f.p_request_tx=c;g=f.getLabel()+"R"+f.r_no_;d?(f.logger.finer(g+" ERROR"),a.errback(b)):(f.logger.finer(g+" SUCCESS"),
a.callback(b));f.p_request_tx=null});b=null;f.logger.finer(g+" END")},c,d,e)};goog.DEBUG&&(ydn.db.tr.Parallel.prototype.toString=function(){var a=this.p_request_tx?"*":"";return"Parallel:"+this.policy+":"+this.getLabel()+a});ydn.db.tr.AtomicParallel=function(a,b){ydn.db.tr.Parallel.call(this,a,b,ydn.db.tr.Thread.Policy.SINGLE)};goog.inherits(ydn.db.tr.AtomicParallel,ydn.db.tr.Parallel);ydn.db.tr.AtomicParallel.DEBUG=!1;ydn.db.tr.AtomicParallel.prototype.logger=goog.debug.Logger.getLogger("ydn.db.tr.AtomicParallel");ydn.db.tr.AtomicParallel.prototype.reusedTx=function(a,b){return!1};
ydn.db.tr.AtomicParallel.prototype.request=function(a,b,c){var d,e,f,g=this,h=ydn.db.tr.AtomicParallel.superClass_.request.call(this,a,b,c,function(a,b){h.removeTx();g.logger.finer("transaction "+a);if(d)a!=ydn.db.base.TxEventTypes.COMPLETE&&(f=!0,e=b),d(e,f);else{var c=new ydn.db.TimeoutError;h.setDbValue(c,!0)}});h.await(function(a,b,c){f=b;e=a;d=c});return h};
ydn.db.tr.AtomicParallel.prototype.exec=function(a,b,c,d,e){var f,g,h=new goog.async.Deferred;h.addCallbacks(function(a){g=!1;f=a},function(a){g=!0;f=a});ydn.db.tr.AtomicParallel.superClass_.exec.call(this,h,b,c,d,function(b,c){if(b!=ydn.db.base.TxEventTypes.COMPLETE)a.errback(c);else if(!0===g)a.errback(f);else if(!1===g)a.callback(f);else{var d=new ydn.db.TimeoutError;a.errback(d)}e&&(e(b,c),e=void 0)})};goog.DEBUG&&(ydn.db.tr.AtomicParallel.prototype.toString=function(){return"Atomic"+ydn.db.tr.AtomicParallel.superClass_.toString.call(this)});ydn.db.tr.Storage=function(a,b,c){ydn.db.con.Storage.call(this,a,b,c);this.ptx_no=0;a=!0;b=ydn.db.tr.Thread.Policy.SINGLE;c&&(goog.isDef(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=this.newTxQueue(b,a);this.sync_thread=this.newTxQueue(ydn.db.tr.Thread.Policy.ATOMIC,!1);this.db_operator=this.newOperator(c,this.sync_thread)};goog.inherits(ydn.db.tr.Storage,ydn.db.con.Storage);ydn.db.tr.Storage.prototype.ptx_no=0;
ydn.db.tr.Storage.prototype.branch=function(a,b,c,d,e,f){a=a||ydn.db.tr.Thread.Policy.SINGLE;var g;d==ydn.db.base.StandardTransactionMode.READ_ONLY?g=ydn.db.base.TransactionMode.READ_ONLY:d==ydn.db.base.StandardTransactionMode.READ_WRITE&&(g=ydn.db.base.TransactionMode.READ_WRITE);a=this.newTxQueue(a,b,c,g,e);return this.newOperator(a,f?null:this.sync_thread)};ydn.db.tr.Storage.prototype.newOperator=function(a,b){return new ydn.db.tr.DbOperator(this,this.schema,a,b)};
ydn.db.tr.Storage.prototype.newTxQueue=function(a,b,c,d,e){if(b){if(a==ydn.db.tr.Thread.Policy.MULTI||a==ydn.db.tr.Thread.Policy.REPEAT||a==ydn.db.tr.Thread.Policy.ALL||a==ydn.db.tr.Thread.Policy.SINGLE)return new ydn.db.tr.Serial(this,this.ptx_no++,a,c,d,e);if(a==ydn.db.tr.Thread.Policy.ATOMIC)return new ydn.db.tr.AtomicSerial(this,this.ptx_no++);throw new ydn.debug.error.ArgumentException('Invalid requestType "'+a+'"');}if(a==ydn.db.tr.Thread.Policy.MULTI||a==ydn.db.tr.Thread.Policy.REPEAT||a==
ydn.db.tr.Thread.Policy.ALL||a==ydn.db.tr.Thread.Policy.SINGLE)return new ydn.db.tr.Parallel(this,this.ptx_no++,a,c,d,e);if(a==ydn.db.tr.Thread.Policy.ATOMIC)return new ydn.db.tr.AtomicParallel(this,this.ptx_no++);throw new ydn.debug.error.ArgumentException('Invalid requestType "'+a+'"');};
ydn.db.tr.Storage.prototype.run=function(a,b,c){if(goog.DEBUG&&3<arguments.length)throw new ydn.debug.error.ArgumentException("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.ptx_no++;var d=b||this.schema.getStoreNames(),e=ydn.db.base.TransactionMode.READ_ONLY;if(c)if(c==ydn.db.base.StandardTransactionMode.READ_WRITE)e=ydn.db.base.TransactionMode.READ_WRITE;else if(c!=ydn.db.base.StandardTransactionMode.READ_ONLY)throw new ydn.debug.error.ArgumentException('Invalid transaction mode "'+
c+'"');var f=this.newTxQueue(ydn.db.tr.Thread.Policy.ALL,!1,d,e,1),g=this.newOperator(f,this.sync_thread),h=new ydn.db.Request(ydn.db.Request.Method.RUN),k=this;f.processTx(function(b){k.logger.finest("executing run in transaction on "+f);h.setTx(b,f.getLabel()+"R0");a(g)},d,e,function(a,b){h.removeTx();var c=a===ydn.db.base.TxEventTypes.COMPLETE;h.setDbValue(f.getTxNo(),!c)});return h};
ydn.db.tr.Storage.prototype.spawn=function(a,b,c,d){if(goog.DEBUG&&3<arguments.length)throw new ydn.debug.error.ArgumentException("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.ptx_no++;var e=b||this.schema.getStoreNames(),f=ydn.db.base.TransactionMode.READ_ONLY;if(c)if(c==ydn.db.base.StandardTransactionMode.READ_WRITE)f=ydn.db.base.TransactionMode.READ_WRITE;else if(c!=ydn.db.base.StandardTransactionMode.READ_ONLY)throw new ydn.debug.error.ArgumentException('Invalid transaction mode "'+
c+'"');var g=this.newTxQueue(ydn.db.tr.Thread.Policy.ALL,!1,e,f,d),h=this.newOperator(g,this.sync_thread),k=new ydn.db.Request(ydn.db.Request.Method.RUN),l,m=this;g.processTx(function(b){m.logger.finest("executing run in transaction on "+g);k.setTx(b,g.getLabel()+"R0");b=a(h);l=g.setGenerator(b,k);b.next()},e,f,function(a,b){k.removeTx();a!=ydn.db.base.TxEventTypes.COMPLETE&&a!=ydn.db.base.TxEventTypes.ABORT||l(a,b)});return k};
ydn.db.tr.Storage.prototype.getTxNo=function(){return this.db_operator?this.db_operator.getTxNo():NaN};ydn.db.crud.Storage=function(a,b,c){ydn.db.tr.Storage.call(this,a,b,c);a=this.schema;for(b=0;b<a.countFullTextIndex();b++){c=a.fullTextIndex(b);var d=a.getStore(c.getName());if(d){if(!d.hasIndex("k"))throw new ydn.debug.error.ArgumentException('full text index store "'+d.getName()+'" must have "keyword" index');if(!d.hasIndex("v"))throw new ydn.debug.error.ArgumentException('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.getKeyPath())throw new ydn.debug.error.ArgumentException('full text index store "'+
d.getName()+'" must use "id" as key path.');}else throw new ydn.debug.error.ArgumentException('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=c.index(d),f=a.getStore(e.getStoreName());if(f)this.addFullTextIndexer(f,c);else throw new ydn.debug.error.ArgumentException('full text source store "'+e.getStoreName()+'" does not exist for full text index "'+c.getName()+'"');}}};goog.inherits(ydn.db.crud.Storage,ydn.db.tr.Storage);ydn.db.crud.Storage.prototype.init=function(){ydn.db.crud.Storage.superClass_.init.call(this)};
ydn.db.crud.Storage.prototype.newOperator=function(a,b){return new ydn.db.crud.DbOperator(this,this.schema,a,b)};ydn.db.crud.Storage.prototype.getCoreOperator=function(){return this.db_operator};ydn.db.crud.Storage.prototype.add=function(a,b,c){return this.getCoreOperator().add(a,b,c)};ydn.db.crud.Storage.prototype.count=function(a,b,c,d){return this.getCoreOperator().count(a,b,c,d)};ydn.db.crud.Storage.prototype.get=function(a,b){return this.getCoreOperator().get(a,b)};
ydn.db.crud.Storage.prototype.keys=function(a,b,c,d,e,f,g){return this.getCoreOperator().keys(a,b,c,d,e,f,g)};ydn.db.crud.Storage.prototype.values=function(a,b,c,d,e,f){return this.getCoreOperator().values(a,b,c,d,e,f)};ydn.db.crud.Storage.prototype.list=function(a,b,c,d,e,f,g,h,k){return this.getCoreOperator().list(a,b,c,d,e,f,g,h,k)};ydn.db.crud.Storage.prototype.load=function(a,b,c){return this.getCoreOperator().load(a,b,c)};
ydn.db.crud.Storage.prototype.put=function(a,b,c){return this.getCoreOperator().put(a,b,c)};ydn.db.crud.Storage.prototype.clear=function(a,b,c){return this.getCoreOperator().clear(a,b,c)};ydn.db.crud.Storage.prototype.remove=function(a,b,c){return this.getCoreOperator().remove(a,b,c)};goog.DEBUG&&(ydn.db.crud.Storage.prototype.toString=function(){var a="Storage:"+this.getName();this.isReady()&&(a+=" ["+this.getType()+"]");return a});ydn.db.core.Storage=function(a,b,c){ydn.db.crud.Storage.call(this,a,b,c)};goog.inherits(ydn.db.core.Storage,ydn.db.crud.Storage);ydn.db.core.Storage.prototype.newOperator=function(a,b){return new ydn.db.core.DbOperator(this,this.schema,a,b)};ydn.db.core.Storage.prototype.getIndexOperator=function(){return this.db_operator};ydn.db.core.Storage.prototype.open=function(a,b,c,d){return this.getIndexOperator().open(a,b,c,d)};
ydn.db.core.Storage.prototype.listIter=function(a,b,c,d){return this.getIndexOperator().listIter(a,b,c,d)};ydn.db.core.Storage.prototype.scan=function(a,b){return this.getIndexOperator().scan(a,b)};ydn.db.core.Storage.prototype.map=function(a,b){return this.getIndexOperator().map(a,b)};ydn.db.core.Storage.prototype.reduce=function(a,b,c){return this.getIndexOperator().reduce(a,b,c)};ydn.db.core.req.IDBCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);this.request_=null};goog.inherits(ydn.db.core.req.IDBCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.IDBCursor.DEBUG=!1;ydn.db.core.req.IDBCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.IDBCursor");
ydn.db.core.req.IDBCursor.prototype.defaultOnSuccess=function(a){a=a.target.result;ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(this+" onSuccess "+(a?a.key+", "+a.primaryKey:""));if(a)this.onSuccess(a.key,a.primaryKey,a.value);else this.onSuccess()};
ydn.db.core.req.IDBCursor.prototype.openCursor=function(a,b){var c=this+" opening ";goog.isDefAndNotNull(a)&&(c+="{"+a,c=goog.isDefAndNotNull(b)?c+(";"+b+"}"):c+"}");this.logger.finest(c);var d=this.key_range,c=this.tx.objectStore(this.store_name),e=goog.isString(this.index_name)?c.index(this.index_name):null;if(goog.isDef(a))var f=e?!goog.isDef(b):!0,g=d?d.lower:void 0,h=d?d.upper:void 0,k=d?!!d.lowerOpen:!1,d=d?!!d.upperOpen:!1,d=(this.reverse?new ydn.db.KeyRange(g,a,k,f):new ydn.db.KeyRange(a,
h,f,d)).toIDBKeyRange();var l;l=this.isValueCursor()?e?goog.isDefAndNotNull(this.dir)?e.openCursor(d,this.dir):goog.isDefAndNotNull(d)?e.openCursor(d):e.openCursor():goog.isDefAndNotNull(this.dir)?c.openCursor(d,this.dir):goog.isDefAndNotNull(d)?c.openCursor(d):c.openCursor():e?goog.isDefAndNotNull(this.dir)?e.openKeyCursor(d,this.dir):goog.isDefAndNotNull(d)?e.openKeyCursor(d):e.openKeyCursor():goog.isDefAndNotNull(this.dir)?c.openCursor(d,this.dir):goog.isDefAndNotNull(d)?c.openCursor(d):c.openCursor();
var m=this;l.onerror=function(a){var b=l.error;a.preventDefault();m.onError(b)};var n=function(a,b,c){ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(m+" requestReady "+a);m.request_=l;m.request_.onsuccess=goog.bind(m.defaultOnSuccess,m);b=m.isIndexCursor()?b:void 0;m.onSuccess(a,b,c);l=null};goog.isDefAndNotNull(a)?(ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(m+" seeking start position, now "+a),l.onsuccess=function(c){if(c=c.target.result){var d=ydn.db.base.indexedDb.cmp(c.key,a),e=
m.reverse?-1:1;if(d==e)n(c.key,c.primaryKey,c.value);else if(d==-e)c["continue"](a);else if(goog.isDefAndNotNull(b))if(ydn.db.base.indexedDb.cmp(c.primaryKey,b)==e)n(c.key,c.primaryKey,c.value);else c["continue"]();else c["continue"]()}else n()}):(m.request_=l,ydn.db.core.req.IDBCursor.DEBUG&&window.console.log(m+" ready ",m.request_),m.request_.onsuccess=goog.bind(m.defaultOnSuccess,m))};ydn.db.core.req.IDBCursor.prototype.hasCursor=function(){return!!this.request_};
ydn.db.core.req.IDBCursor.prototype.update=function(a){var b=this.request_.result;if(b){var c=new goog.async.Deferred;a=b.update(a);a.onsuccess=function(a){c.callback(a.target.result)};a.onerror=function(a){a.preventDefault();c.errback(a)};return c}throw new ydn.db.InvalidAccessError("cursor gone");};
ydn.db.core.req.IDBCursor.prototype.clear=function(){var a=this.request_.result;if(a){var b=new goog.async.Deferred,a=a["delete"]();a.onsuccess=function(a){b.callback(1)};a.onerror=function(a){a.preventDefault();b.errback(a)};return b}throw new ydn.db.InvalidAccessError("cursor gone");};ydn.db.core.req.IDBCursor.prototype.advance=function(a){var b=this.request_.result;if(1==a)b["continue"]();else b.advance(a)};
ydn.db.core.req.IDBCursor.prototype.continuePrimaryKey=function(a){var b=this.request_.result;if(goog.DEBUG){var c=ydn.db.base.indexedDb.cmp(a,b.primaryKey);if(c!=(this.reverse?-1:1))throw new ydn.debug.error.InternalError('continuing primary key "'+a+'" must '+(this.reverse?"lower":"higher")+' than current primary key "'+b.primaryKey+'"');}var d=this;this.request_.onsuccess=function(e){if(b=e.target.result)if(c=ydn.db.base.indexedDb.cmp(b.primaryKey,a),0==c||1==c&&!d.reverse||-1==c&&d.reverse)d.request_.onsuccess=
goog.bind(d.defaultOnSuccess,d),e=d.isIndexCursor()?b.primaryKey:void 0,d.onSuccess(b.key,e,b.value);else b["continue"]();else d.request_.onsuccess=goog.bind(d.defaultOnSuccess,d),d.onSuccess()};b["continue"]()};ydn.db.core.req.IDBCursor.prototype.continueEffectiveKey=function(a){var b=this.request_.result;if(goog.isDefAndNotNull(a))b["continue"](a);else b["continue"]()};
ydn.db.core.req.IDBCursor.prototype.disposeInternal=function(){ydn.db.core.req.IDBCursor.superClass_.disposeInternal.call(this);this.request_=null};goog.DEBUG&&(ydn.db.core.req.IDBCursor.prototype.toString=function(){return"IDB"+ydn.db.core.req.IDBCursor.superClass_.toString.call(this)});goog.async.DeferredList=function(a,b,c,d,e,f){goog.async.Deferred.call(this,e,f);this.list_=a;this.deferredResults_=[];this.fireOnOneCallback_=!!b;this.fireOnOneErrback_=!!c;this.consumeErrors_=!!d;for(b=this.numFinished_=0;b<a.length;b++)a[b].addCallbacks(goog.bind(this.handleCallback_,this,b,!0),goog.bind(this.handleCallback_,this,b,!1));0!=a.length||this.fireOnOneCallback_||this.callback(this.deferredResults_)};goog.inherits(goog.async.DeferredList,goog.async.Deferred);
goog.async.DeferredList.prototype.handleCallback_=function(a,b,c){this.numFinished_++;this.deferredResults_[a]=[b,c];this.hasFired()||(this.fireOnOneCallback_&&b?this.callback([a,c]):this.fireOnOneErrback_&&!b?this.errback(c):this.numFinished_==this.list_.length&&this.callback(this.deferredResults_));this.consumeErrors_&&!b&&(c=null);return c};goog.async.DeferredList.prototype.errback=function(a){goog.async.DeferredList.superClass_.errback.call(this,a);for(a=0;a<this.list_.length;a++)this.list_[a].cancel()};
goog.async.DeferredList.gatherResults=function(a){return(new goog.async.DeferredList(a,!1,!0)).addCallback(function(a){for(var c=[],d=0;d<a.length;d++)c[d]=a[d][1];return c})};ydn.db.crud.req.IndexedDb=function(a,b){ydn.db.crud.req.RequestExecutor.call(this,a,b)};goog.inherits(ydn.db.crud.req.IndexedDb,ydn.db.crud.req.RequestExecutor);ydn.db.crud.req.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.IndexedDb");ydn.db.crud.req.IndexedDb.DEBUG=!1;ydn.db.crud.req.IndexedDb.REQ_PER_TX=10;
ydn.db.crud.req.IndexedDb.prototype.countStores=function(a,b){var c=[],d=function(e){var f=b[e],g=a.getTx().objectStore(f).count();g.onsuccess=function(f){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(f);c[e]=f.target.result;e++;e==b.length?a.setDbValue(c):d(e)};g.onerror=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(b);b.preventDefault();a.setDbValue(g.error,!0)}};0==b.length?a.setDbValue([]):d(0)};
ydn.db.crud.req.IndexedDb.prototype.insertObjects=function(a,b,c,d,e,f){var g=[],h=0,k=!1,l=this,m=b?"put":"add",n=a.getTx().objectStore(d),p=a.getLabel()+" "+m+" "+e.length+' objects to store "'+d+'"';this.logger.finest(p);var q=function(p){if(!goog.isDefAndNotNull(e[p]))if(l.logger.finest("empty object at "+p+" of "+e.length),h++,h==e.length)a.setDbValue(g,k);else{var s=p+ydn.db.crud.req.IndexedDb.REQ_PER_TX;s<e.length&&q(s)}var t,s=e[p];t=goog.isDefAndNotNull(f)?b?n.put(s,f[p]):n.add(s,f[p]):b?
n.put(s):n.add(s);t.onsuccess=function(b){h++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([d,b,p]);g[p]=b.target.result;h==e.length?a.setDbValue(c?g[0]:g,k):(b=p+ydn.db.crud.req.IndexedDb.REQ_PER_TX,b<e.length&&q(b))};t.onerror=function(b){h++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([d,b,p]);var f=t.error;l.logger.finest(a.getLabel()+m+' request to "'+d+'" cause '+f.name+' for object "'+ydn.json.toShortString(e[p])+'" at index '+p+" of "+e.length+" objects.");g[p]=f;k=!0;b.preventDefault();
h==e.length?a.setDbValue(c?g[0]:g,k):(b=p+ydn.db.crud.req.IndexedDb.REQ_PER_TX,b<e.length&&q(b))}};if(0<e.length)for(p=0;p<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&p<e.length;p++)q(p);else a.setDbValue([])};
ydn.db.crud.req.IndexedDb.prototype.putByKeys=function(a,b,c){var d=[],e=0,f=!1,g=this,h=a.getLabel()+" putByKeys: of "+b.length+" objects";this.logger.finest(h);var k=function(h){var m=c[h],n=m.getStoreName(),p=a.getTx().objectStore(n),q;q=goog.isNull(p.keyPath)?p.put(b[h],m.getId()):p.put(b[h]);q.onsuccess=function(c){e++;d[h]=c.target.result;e==b.length?a.setDbValue(d,f):(c=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX,c<b.length&&k(c))};q.onerror=function(c){e++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([n,
c]);var m=c.name;goog.DEBUG&&g.logger.warning("request result "+m+' error when put keys to "'+n+'" for object "'+ydn.json.toShortString(b[h])+'" at index '+h+" of "+b.length+" objects.");d[h]=q.error;f=!0;c.preventDefault();e==b.length?a.setDbValue(d,f):(c=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX,c<b.length&&k(c))}};if(0<b.length)for(h=0;h<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&h<b.length;h++)k(h);else a.setDbValue(d,f)};
ydn.db.crud.req.IndexedDb.prototype.putData=function(a,b,c,d,e,f){var g=this.schema.getStore(d),h=a.objectStore(d),k=[],l=e.indexOf("\n"),m=e.substr(0,l).split(f),n=[];for(a=0;a<m.length;a++){var p=g.getIndex(m[a]);p?n[a]=p.getType():m[a]==g.getKeyPath()&&(n[a]=g.getType())}l++;this.logger.finest(b+" Loading data  of "+m.length+"-fields record to "+d);var q=function(){var a={},b=e.indexOf("\n",l),p=!1,u;-1==b?(p=!0,u=e.substring(l)):(u=e.substring(l,b),l=b+1);for(var b=u.split(f),v=0;v<m.length;v++){var x=
b[v];n[v]&&(n[v]==ydn.db.schema.DataType.TEXT?x=goog.string.stripQuotes(x,'"'):n[v]==ydn.db.schema.DataType.INTEGER?x=parseInt(x,10):n[v]==ydn.db.schema.DataType.NUMERIC&&(x=parseFloat(x)));a[m[v]]=x}var y=h.put(a);y.onsuccess=function(a){k.push(a.target.result);p?c(k):q()};y.onerror=function(a){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([d,a]);goog.DEBUG&&"DataError"==a.name&&(a=new ydn.db.InvalidKeyException(g+": "+u.substring(0,70)));a.preventDefault();c(y.error,!0)}};q()};
ydn.db.crud.req.IndexedDb.prototype.removeById=function(a,b,c){var d=a.getTx().objectStore(b),e=a.getLabel()+" clearById: "+b+" "+c;this.logger.finest(e);var f=d.openCursor(ydn.db.IDBKeyRange.only(c));f.onsuccess=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,c,d]);if(d=d.target.result){var e=d["delete"]();e.onsuccess=function(b){a.setDbValue(1)};e.onerror=function(b){a.setDbValue(e.error,!0)}}else a.setDbValue(0)};f.onerror=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,
c,d]);d.preventDefault();a.setDbValue(f.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.removeByKeys=function(a,b){var c=0,d,e,f=a.getLabel()+" removeByKeys: "+b.length+" keys";this.logger.finest(f);var g=[],h=function(f){f++;if(f>=b.length)0<g.length?a.setDbValue(g,!0):a.setDbValue(c);else{b[f].getStoreName()!=d&&(d=b[f].getStoreName(),e=a.getTx().objectStore(d));var l=e["delete"](b[f].getId());l.onsuccess=function(a){c++;h(f)};l.onerror=function(a){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([d,void 0,a]);a.preventDefault();g[f]=l.error;
h(f)}}};h(-1)};ydn.db.crud.req.IndexedDb.prototype.removeByKeyRange=function(a,b,c){var d=a.getTx().objectStore(b),e=d.count(c),f=a.getLabel()+" clearByKeyRange: "+b+" "+c;this.logger.finest(f);e.onsuccess=function(b){var e=b.target.result,f=d["delete"](c);f.onsuccess=function(){a.setDbValue(e)};f.onerror=function(b){a.setDbValue(f.error,!0)}};e.onerror=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,c,d]);d.preventDefault();a.setDbValue(e.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.clearByKeyRange=function(a,b,c){var d=a.getTx().objectStore(b);b=a.getLabel()+" "+b+" "+c;this.logger.finest(b);var e=d["delete"](c);e.onsuccess=function(b){a.setDbValue(void 0)};e.onerror=function(b){b.preventDefault();a.setDbValue(e.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.removeByIndexKeyRange=function(a,b,c,d){var e=a.getTx().objectStore(b).index(c);b=a.getLabel()+" clearByIndexKeyRange: "+b+":"+c+" "+d;this.logger.finest(b);var f=[],g=e.openCursor(d),h=0;g.onsuccess=function(b){var c=b.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){h++;c["continue"]()};d.onerror=function(a){f.push(d.error);a.preventDefault();c["continue"]()}}else 0<f.length?a.setDbValue(f,!0):a.setDbValue(h)};g.onerror=function(b){b.preventDefault();
a.setDbValue(g.error,!0)}};ydn.db.crud.req.IndexedDb.prototype.clearByStores=function(a,b){var c=b.length,d=0,e=a.getLabel()+" clearByStores: "+b;this.logger.finest(e);for(e=0;e<c;e++){var f=b[e],g=a.getTx().objectStore(f).clear();g.onsuccess=function(b){d++;d==c&&a.setDbValue(d)};g.onerror=function(b){d++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([d,b]);b.preventDefault();d==c&&a.setDbValue(g.error,!0)}}};
ydn.db.crud.req.IndexedDb.prototype.getById=function(a,b,c){var d=this,e=a.getLabel()+b+":"+c;this.logger.finest(e);var f=a.getTx().objectStore(b),g=f.get(c);g.onsuccess=function(e){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,c,e]);d.logger.finest(a.getLabel()+" record "+c+(goog.isDefAndNotNull(e.target.result)?" ":" not ")+" exists.");var g=e.target.result;if(!f.keyPath&&0==f.indexNames.length&&goog.userAgent.WEBKIT&&goog.isString(g)&&0<=g.indexOf(";base64,")){'"'==g.charAt(0)&&'"'==g.charAt(g.length-
1)&&(g=g.substr(1,g.length-2));g=g.split(";base64,");e=g[0].split(":")[1];for(var g=window.atob(g[1]),l=g.length,m=new Uint8Array(l),n=0;n<l;++n)m[n]=g.charCodeAt(n);e=new Blob([m.buffer],{type:e});a.setDbValue(e)}else a.setDbValue(e.target.result)};g.onerror=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,c,d]);d.preventDefault();a.setDbValue(g.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.listByIds=function(a,b,c){var d=[];d.length=c.length;var e=0,f=a.getTx().objectStore(b),g=c.length,h=a.getLabel()+" "+b+":"+g+" ids";this.logger.finest(h);var k=function(h){if(!goog.isDefAndNotNull(c[h]))if(e++,d[h]=void 0,e==g)a.setDbValue(d);else{var m=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX;m<g&&k(m)}var n;n=f.get(c[h]);n.onsuccess=function(f){e++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,c,h,f]);d[h]=f.target.result;e==g?a.setDbValue(d):(f=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX,
f<g&&k(f))};n.onerror=function(d){e++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,c,h,d]);d.preventDefault();a.setDbValue(n.error,!0)}};if(0<g)for(h=0;h<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&h<g;h++)k(h);else a.setDbValue([])};
ydn.db.crud.req.IndexedDb.prototype.listByKeys=function(a,b){var c=[];c.length=b.length;var d=0,e=a.getLabel()+" "+b.length+" ids";this.logger.finest(e);var f=function(e){var h=b[e],k=a.getTx().objectStore(h.getStoreName()).get(h.getId());k.onsuccess=function(h){d++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(h);c[e]=h.target.result;d==b.length?a.setDbValue(c):(h=e+ydn.db.crud.req.IndexedDb.REQ_PER_TX,h<b.length&&f(h))};k.onerror=function(c){d++;ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([b,
c]);c.preventDefault();a.setDbValue(k.error,!0)}};if(0<b.length)for(e=0;e<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&e<b.length;e++)f(e);else a.setDbValue([])};
ydn.db.crud.req.IndexedDb.prototype.countKeyRange=function(a,b,c,d,e){if(goog.DEBUG&&d&&e)throw new ydn.debug.error.InvalidOperationException("unique count not available in IndexedDB");e=a.getTx().objectStore(b);b=a.getLabel()+" "+b+(d?":"+d:"")+(c?":"+ydn.json.stringify(c):"");this.logger.finest(b);var f;goog.isDefAndNotNull(d)?(d=e.index(d),f=goog.isDefAndNotNull(c)?d.count(c):d.count()):f=goog.isDefAndNotNull(c)?e.count(c):e.count();f.onsuccess=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(b);
a.setDbValue(b.target.result)};f.onerror=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log(b);b.preventDefault();a.setDbValue(f.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.list=function(a,b,c,d,e,f,g,h,k,l){var m=[],n=a.getTx().objectStore(c),p=ydn.db.base.getDirection(h,k),q=a.getLabel()+" "+b+" "+c+(d?":"+d:"")+(e?ydn.json.stringify(e):"");h&&(q+=" reverse");k&&(q+=" unique");if(l&&goog.isDef(l[0])){k=d?!goog.isDef(l[1]):!0;var r=l[0],s=e?e.lower:void 0,t=e?e.upper:void 0,u=e?!!e.lowerOpen:!1;e=e?!!e.upperOpen:!1;e=(h?new ydn.db.KeyRange(s,r,u,k):new ydn.db.KeyRange(r,t,k,e)).toIDBKeyRange();q+=" starting from "+ydn.json.stringify(l[0]);
goog.isDef(l[1])&&(q+=", "+ydn.json.stringify(l[1]))}this.logger.finest(q);var v;v=b==ydn.db.base.QueryMethod.LIST_KEY||b==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY||b==ydn.db.base.QueryMethod.LIST_KEYS?d?n.index(d).openKeyCursor(e,p):n.openCursor(e,p):d?n.index(d).openCursor(e,p):n.openCursor(e,p);var x=!1;v.onsuccess=function(c){if(c=c.target.result){if(!x){if(0<g){x=!0;c.advance(g);return}if(l&&d&&goog.isDef(l[0]))if(goog.isDef(l[1])){var e=ydn.db.base.indexedDb.cmp(c.key,l[0]),k=h?-1:1;if(0==e){e=
ydn.db.base.indexedDb.cmp(c.primaryKey,l[1]);if(0==e){x=!0;c["continue"]();return}if(e==k)x=!0;else{c["continue"]();return}}else x=!0}else x=!0;else x=!0}b==ydn.db.base.QueryMethod.LIST_KEY?m.push(c.key):b==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?m.push(c.primaryKey):b==ydn.db.base.QueryMethod.LIST_KEYS?(k={},d&&(k[d]=c.key),n.keyPath?k[n.keyPath]=c.primaryKey:k[ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME]=c.primaryKey,m.push(k)):b==ydn.db.base.QueryMethod.LIST_VALUE?m.push(c.value):m.push([c.key,c.primaryKey,
c.value]);if(m.length<f)c["continue"]();else l&&(l[0]=ydn.db.Key.clone(c.key),l[1]=ydn.db.Key.clone(c.primaryKey)),a.setDbValue(m)}else l&&(l[0]=void 0,l[1]=void 0),a.setDbValue(m)};v.onerror=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&window.console.log([c,b]);b.preventDefault();a.setDbValue(v.error,!0)}};ydn.db.core.req.IndexedDb=function(a,b){ydn.db.crud.req.IndexedDb.call(this,a,b)};goog.inherits(ydn.db.core.req.IndexedDb,ydn.db.crud.req.IndexedDb);ydn.db.core.req.IndexedDb.DEBUG=!1;ydn.db.core.req.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.IndexedDb");ydn.db.core.req.IndexedDb.prototype.getCursor=function(a,b,c,d){var e=this.schema.getStore(c);goog.asserts.assertObject(e,'store "'+c+'" not found.');return new ydn.db.core.req.IDBCursor(a,b,e,d)};
ydn.db.core.req.IndexedDb.prototype.getStreamer=function(a,b,c,d){return new ydn.db.Streamer(a,c,d)};ydn.db.base.Mutex=function(){this.state_=!1};ydn.db.base.Mutex.prototype.state_=!1;ydn.db.base.Mutex.prototype.up=function(){goog.asserts.assert(!this.state_,"Mutex already up.");this.state_=!0};ydn.db.base.Mutex.prototype.down=function(){goog.asserts.assert(this.state_,"Mutex already down.");this.state_=!1};ydn.db.base.Mutex.prototype.state=function(){return this.state_};ydn.db.core.req.SimpleCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);goog.asserts.assert(c);this.value_=this.primary_key_=this.key_=void 0;this.onCursorComplete_=this.current_=null;this.result_ready_=new ydn.db.base.Mutex;this.store_=this.buffer_=null};goog.inherits(ydn.db.core.req.SimpleCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.SimpleCursor.DEBUG=!1;ydn.db.core.req.SimpleCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.SimpleCursor");
ydn.db.core.req.SimpleCursor.prototype.hasCursor=function(){return this.isActive()};ydn.db.core.req.SimpleCursor.prototype.update=function(a){this.store_.addRecord(this.getPrimaryKey(),a);return goog.async.Deferred.succeed()};
ydn.db.core.req.SimpleCursor.prototype.advance=function(a){var b=this,c=this.current_?-1:0;ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log(this+(this.current_?" advancing ":" starting ")+a+" step");var d=function(d){c++;if(!d||c>=a)return ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log("advance to "+(d?d.value:"null")),b.defaultOnSuccess_(d)};this.reverse?this.buffer_.reverseTraverse(d,this.current_):this.buffer_.traverse(d,this.current_)};
ydn.db.core.req.SimpleCursor.prototype.continueEffectiveKey=function(a){if(goog.isDefAndNotNull(a)){var b=this,c=new ydn.db.con.simple.Node(a),d=function(c){b.current_=c;if(!c)return b.defaultOnSuccess_(c);var d=c.value.getKey(),d=ydn.db.cmp(d,a);if(b.reverse){if(1!=d)return b.defaultOnSuccess_(c)}else if(-1!=d)return b.defaultOnSuccess_(c)};this.reverse?this.buffer_.reverseTraverse(d,c):this.buffer_.traverse(d,c)}else this.advance(1)};
ydn.db.core.req.SimpleCursor.prototype.dispatchOnSuccess_=function(){var a=this;setTimeout(function(){a.result_ready_.state()?(ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log(this+" invoke success "+a.key_),a.result_ready_.down(),a.onSuccess(a.key_,a.primary_key_,a.value_),a.dispatchOnSuccess_()):(ydn.db.core.req.SimpleCursor.DEBUG&&window.console.log(this+" complete"),a.onCursorComplete_(),a.onCursorComplete_=null)},4)};
ydn.db.core.req.SimpleCursor.prototype.defaultOnSuccess_=function(a){if(this.current_=a){a=a.value;if(this.key_range)if(!this.reverse&&goog.isDefAndNotNull(this.key_range.upper)){var b=ydn.db.cmp(a.getKey(),this.key_range.upper);if(1==b||0==b&&this.key_range.upperOpen)this.current_=null}else this.reverse&&goog.isDefAndNotNull(this.key_range.lower)&&(b=ydn.db.cmp(a.getKey(),this.key_range.lower),-1==b||0==b&&this.key_range.lowerOpen)&&(this.current_=null);if(this.current_){if(this.unique&&goog.isDefAndNotNull(this.key_)&&
goog.isDefAndNotNull(a.getKey())&&0==ydn.db.cmp(this.key_,a.getKey()))return;this.key_=a.getKey();this.primary_key_=this.is_index?a.getPrimaryKey():this.key_;this.query_method==ydn.db.base.QueryMethod.LIST_VALUE&&(this.isValueCursor()?(goog.asserts.assert(goog.isDefAndNotNull(this.primary_key_)),this.value_=this.store_.getRecord(null,this.primary_key_)):this.value_=this.primary_key_)}}this.current_||(this.value_=this.primary_key_=this.key_=void 0);this.result_ready_.up();ydn.db.core.req.SimpleCursor.DEBUG&&
window.console.log(this+" new position "+(this.key_+(this.is_index?", "+this.primary_key_:""))+" "+this.result_ready_);return!0};
ydn.db.core.req.SimpleCursor.prototype.openCursor=function(a,b){var c=null;if(this.key_range)if(this.reverse){var d=this.is_index?"\uffff":void 0;goog.isDefAndNotNull(this.key_range.upper)&&(c=new ydn.db.con.simple.Node(this.key_range.upper,d))}else goog.isDefAndNotNull(this.key_range.lower)&&(c=new ydn.db.con.simple.Node(this.key_range.lower));goog.isDefAndNotNull(a)&&(c=this.isIndexCursor()?new ydn.db.con.simple.Node(a,b):new ydn.db.con.simple.Node(a));this.onCursorComplete_=this.tx.getStorage(function(b){var d=
function(b){var d=b.value,e=d.getKey();if(b&&goog.isDefAndNotNull(e))if(goog.isDefAndNotNull(a)){if(0==ydn.db.con.simple.Node.cmp(c,d))return}else if(this.key_range&&(!this.reverse&&this.key_range.lowerOpen&&goog.isDefAndNotNull(this.key_range.lower)&&(d=ydn.db.cmp(e,this.key_range.lower),0==d)||this.reverse&&this.key_range.upperOpen&&goog.isDefAndNotNull(this.key_range.upper)&&(d=ydn.db.cmp(e,this.key_range.upper),0==d)))return;return this.defaultOnSuccess_(b)};this.store_=b.getSimpleStore(this.store_name);
this.buffer_=this.store_.getIndexCache(this.index_name);this.reverse?this.buffer_.reverseTraverse(goog.bind(d,this),c):this.buffer_.traverse(goog.bind(d,this),c);this.dispatchOnSuccess_()},this)};ydn.db.core.req.SimpleCursor.prototype.clear=function(){throw new ydn.debug.error.NotImplementedException;};ydn.db.core.req.SimpleCursor.prototype.continuePrimaryKey=function(a){throw new ydn.debug.error.NotImplementedException;};
goog.DEBUG&&(ydn.db.core.req.SimpleCursor.prototype.toString=function(){return"Simple"+ydn.db.core.req.SimpleCursor.superClass_.toString.call(this)});ydn.db.con.simple={};ydn.db.con.simple.NAMESPACE="ydn.db";ydn.db.con.simple.SEP="^|";ydn.db.con.simple.makeKey=function(a,b,c,d){a=[ydn.db.con.simple.NAMESPACE,a];goog.isDef(b)&&(a.push(b),goog.isDef(c)&&(a.push(c),goog.isDef(d)&&a.push(ydn.db.utils.encodeKey(d))));return a.join(ydn.db.con.simple.SEP)};ydn.db.con.simple.Node=function(a,b){this.key=a;this.primary_key=b};ydn.db.con.simple.Node.prototype.getKey=function(){return this.key};ydn.db.con.simple.Node.prototype.getPrimaryKey=function(){return this.primary_key};goog.DEBUG&&(ydn.db.con.simple.Node.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(goog.isDefAndNotNull(this.primary_key)?", "+this.primary_key+")":")")});
ydn.db.con.simple.Node.cmp=function(a,b){var c=ydn.db.cmp(a.key,b.key);return 0===c?goog.isDefAndNotNull(a.primary_key)?goog.isDefAndNotNull(b.primary_key)?ydn.db.cmp(a.primary_key,b.primary_key):1:goog.isDefAndNotNull(b.primary_key)?-1:0:c};goog.structs.AvlTree=function(a){this.comparator_=a||goog.structs.AvlTree.DEFAULT_COMPARATOR_};goog.structs.AvlTree.DEFAULT_COMPARATOR_=function(a,b){return String(a)<String(b)?-1:String(a)>String(b)?1:0};goog.structs.AvlTree.prototype.root_=null;goog.structs.AvlTree.prototype.comparator_=null;goog.structs.AvlTree.prototype.minNode_=null;goog.structs.AvlTree.prototype.maxNode_=null;
goog.structs.AvlTree.prototype.add=function(a){if(null==this.root_)return this.maxNode_=this.minNode_=this.root_=new goog.structs.AvlTree.Node(a),!0;var b=null;this.traverse_(function(c){var d=null;0<this.comparator_(c.value,a)?(d=c.left,null==c.left&&(b=new goog.structs.AvlTree.Node(a,c),c.left=b,c==this.minNode_&&(this.minNode_=b))):0>this.comparator_(c.value,a)&&(d=c.right,null==c.right&&(b=new goog.structs.AvlTree.Node(a,c),c.right=b,c==this.maxNode_&&(this.maxNode_=b)));return d});b&&(this.traverse_(function(a){a.count++;
return a.parent},b.parent),this.balance_(b.parent));return!!b};goog.structs.AvlTree.prototype.remove=function(a){var b=null;this.traverse_(function(c){var d=null;0<this.comparator_(c.value,a)?d=c.left:0>this.comparator_(c.value,a)?d=c.right:(b=c.value,this.removeNode_(c));return d});return b};goog.structs.AvlTree.prototype.clear=function(){this.maxNode_=this.minNode_=this.root_=null};
goog.structs.AvlTree.prototype.contains=function(a){var b=!1;this.traverse_(function(c){var d=null;0<this.comparator_(c.value,a)?d=c.left:0>this.comparator_(c.value,a)?d=c.right:b=!0;return d});return b};goog.structs.AvlTree.prototype.getCount=function(){return this.root_?this.root_.count:0};goog.structs.AvlTree.prototype.getKthValue=function(a){return 0>a||a>=this.getCount()?null:this.getKthNode_(a).value};goog.structs.AvlTree.prototype.getMinimum=function(){return this.getMinNode_().value};
goog.structs.AvlTree.prototype.getMaximum=function(){return this.getMaxNode_().value};goog.structs.AvlTree.prototype.getHeight=function(){return this.root_?this.root_.height:0};goog.structs.AvlTree.prototype.getValues=function(){var a=[];this.inOrderTraverse(function(b){a.push(b)});return a};
goog.structs.AvlTree.prototype.inOrderTraverse=function(a,b){if(this.root_){var c;b?this.traverse_(function(a){var d=null;0<this.comparator_(a.value,b)?(d=a.left,c=a):0>this.comparator_(a.value,b)?d=a.right:c=a;return d}):c=this.getMinNode_();for(var d=c,e=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=e&&d.right!=e)d=d.left;else{if(d.right!=e&&a(d.value))break;var f=d,d=null!=d.right&&d.right!=e?d.right:d.parent,e=f}}};
goog.structs.AvlTree.prototype.reverseOrderTraverse=function(a,b){if(this.root_){var c;b?this.traverse_(goog.bind(function(a){var d=null;0<this.comparator_(a.value,b)?d=a.left:(0>this.comparator_(a.value,b)&&(d=a.right),c=a);return d},this)):c=this.getMaxNode_();for(var d=c,e=c.right?c.right:c;null!=d;)if(null!=d.right&&d.right!=e&&d.left!=e)d=d.right;else{if(d.left!=e&&a(d.value))break;var f=d,d=null!=d.left&&d.left!=e?d.left:d.parent,e=f}}};
goog.structs.AvlTree.prototype.traverse_=function(a,b,c){b=b?b:this.root_;for(c=c?c:null;b&&b!=c;)b=a.call(this,b)};
goog.structs.AvlTree.prototype.balance_=function(a){this.traverse_(function(a){var c=a.left?a.left.height:0,d=a.right?a.right.height:0;1<c-d?(a.left.right&&(!a.left.left||a.left.left.height<a.left.right.height)&&this.leftRotate_(a.left),this.rightRotate_(a)):1<d-c&&(a.right.left&&(!a.right.right||a.right.right.height<a.right.left.height)&&this.rightRotate_(a.right),this.leftRotate_(a));c=a.left?a.left.height:0;d=a.right?a.right.height:0;a.height=Math.max(c,d)+1;return a.parent},a)};
goog.structs.AvlTree.prototype.leftRotate_=function(a){a.isLeftChild()?(a.parent.left=a.right,a.right.parent=a.parent):a.isRightChild()?(a.parent.right=a.right,a.right.parent=a.parent):(this.root_=a.right,this.root_.parent=null);var b=a.right;a.right=a.right.left;null!=a.right&&(a.right.parent=a);b.left=a;a.parent=b;b.count=a.count;a.count-=(b.right?b.right.count:0)+1};
goog.structs.AvlTree.prototype.rightRotate_=function(a){a.isLeftChild()?(a.parent.left=a.left,a.left.parent=a.parent):a.isRightChild()?(a.parent.right=a.left,a.left.parent=a.parent):(this.root_=a.left,this.root_.parent=null);var b=a.left;a.left=a.left.right;null!=a.left&&(a.left.parent=a);b.right=a;a.parent=b;b.count=a.count;a.count-=(b.left?b.left.count:0)+1};
goog.structs.AvlTree.prototype.removeNode_=function(a){if(null!=a.left||null!=a.right){var b=null,c;if(null!=a.left){c=this.getMaxNode_(a.left);this.traverse_(function(a){a.count--;return a.parent},c);if(c!=a.left){if(c.parent.right=c.left)c.left.parent=c.parent;c.left=a.left;c.left.parent=c;b=c.parent}c.parent=a.parent;c.right=a.right;c.right&&(c.right.parent=c);a==this.maxNode_&&(this.maxNode_=c)}else{c=this.getMinNode_(a.right);this.traverse_(function(a){a.count--;return a.parent},c);if(c!=a.right){if(c.parent.left=
c.right)c.right.parent=c.parent;c.right=a.right;c.right.parent=c;b=c.parent}c.parent=a.parent;c.left=a.left;c.left&&(c.left.parent=c);a==this.minNode_&&(this.minNode_=c)}c.count=a.count;a.isLeftChild()?a.parent.left=c:a.isRightChild()?a.parent.right=c:this.root_=c;this.balance_(b?b:c)}else this.traverse_(function(a){a.count--;return a.parent},a.parent),a.isLeftChild()?(this.special=1,a.parent.left=null,a==this.minNode_&&(this.minNode_=a.parent),this.balance_(a.parent)):a.isRightChild()?(a.parent.right=
null,a==this.maxNode_&&(this.maxNode_=a.parent),this.balance_(a.parent)):this.clear()};goog.structs.AvlTree.prototype.getKthNode_=function(a,b){var c=b||this.root_,d=c.left?c.left.count:0;return a<d?this.getKthNode_(a,c.left):a==d?c:this.getKthNode_(a-d-1,c.right)};goog.structs.AvlTree.prototype.getMinNode_=function(a){if(!a)return this.minNode_;var b=a;this.traverse_(function(a){var d=null;a.left&&(d=b=a.left);return d},a);return b};
goog.structs.AvlTree.prototype.getMaxNode_=function(a){if(!a)return this.maxNode_;var b=a;this.traverse_(function(a){var d=null;a.right&&(d=b=a.right);return d},a);return b};goog.structs.AvlTree.Node=function(a,b){this.value=a;this.parent=b?b:null;this.count=1};goog.structs.AvlTree.Node.prototype.left=null;goog.structs.AvlTree.Node.prototype.right=null;goog.structs.AvlTree.Node.prototype.height=1;goog.structs.AvlTree.Node.prototype.isRightChild=function(){return!!this.parent&&this.parent.right==this};
goog.structs.AvlTree.Node.prototype.isLeftChild=function(){return!!this.parent&&this.parent.left==this};ydn.structs={};ydn.structs.Buffer=function(a){goog.structs.AvlTree.call(this,a)};goog.inherits(ydn.structs.Buffer,goog.structs.AvlTree);
ydn.structs.Buffer.prototype.traverse=function(a,b){if(this.root_){var c;if(b instanceof goog.structs.AvlTree.Node)c=b;else if(b){if(this.traverse_(function(a){var d=null;0<this.comparator_(a.value,b)?(d=a.left,c=a):0>this.comparator_(a.value,b)?d=a.right:c=a;return d}),!c)return}else c=this.getMinNode_();for(var d=c,e=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=e&&d.right!=e)d=d.left;else{if(d.right!=e&&a(d))return;var f=d,d=null!=d.right&&d.right!=e?d.right:d.parent,e=f}a(null)}};
ydn.structs.Buffer.prototype.reverseTraverse=function(a,b){if(this.root_){var c;if(b instanceof goog.structs.AvlTree.Node)c=b;else if(b){if(this.traverse_(goog.bind(function(a){var d=null;0<this.comparator_(a.value,b)?d=a.left:(0>this.comparator_(a.value,b)&&(d=a.right),c=a);return d},this)),!c)return}else c=this.getMaxNode_();for(var d=c,e=c.right?c.right:c;null!=d;)if(null!=d.right&&d.right!=e&&d.left!=e)d=d.right;else{if(d.left!=e&&a(d))return;var f=d,d=null!=d.left&&d.left!=e?d.left:d.parent,
e=f}a(null)}};ydn.structs.Buffer.prototype.iter=function(a,b,c){return new ydn.structs.Buffer.Iterator(a,b,c)};
ydn.structs.Buffer.prototype.scan=function(a,b){var c=b instanceof ydn.structs.Buffer.Iterator?b:this.iter(b);if(this.root_){var d,e=!1;if(c.current_)d=c.current_;else if(c.key_range_){var f;c.reverse_&&goog.isDefAndNotNull(c.key_range_.upper)?(f=c.key_range_.upper,e=!!c.key_range_.upperOpen):goog.isDefAndNotNull(c.key_range_.lower)&&(f=c.key_range_.lower,e=!!c.key_range_.lowerOpen);this.traverse_(goog.bind(function(a){var b=null;0<this.comparator_(a.value,f)?b=a.left:(0>this.comparator_(a.value,
f)&&(b=a.right),d=a);return b},this))}else d||(d=this.getMaxNode_());if(d){var g=d,h;if(c.reverse_){for(h=d.right?d.right:d;null!=g;)if(null!=g.right&&g.right!=h&&g.left!=h)g=g.right;else{if(g.left!=h){c.current_=g;if(e){e=!1;continue}if(a(g.value))return}var k=g,g=null!=g.left&&g.left!=h?g.left:g.parent;h=k}c.current_=null;a()}else for(h=d.left?d.left:d;null!=g;)if(null!=g.left&&g.left!=h&&g.right!=h)g=g.left;else{if(g.right!=h){c.current_=g;if(e){e=!1;continue}if(a(g.value))break}k=g;g=null!=g.right&&
g.right!=h?g.right:g.parent;h=k}}else c.current_=null,a()}else a()};ydn.structs.Buffer.prototype.union=function(a){this.getMinNode_();for(a=a.getMinNode_();a;);};ydn.structs.Buffer.Iterator=function(a,b,c){this.key_range_=a||null;this.reverse_=!!b;this.unique_=!!c;this.current_=null};ydn.structs.Buffer.Iterator.prototype.key_range_=null;ydn.structs.Buffer.Iterator.prototype.reverse_=!1;ydn.structs.Buffer.Iterator.prototype.unique_=!1;ydn.structs.Buffer.Iterator.prototype.current_=null;ydn.db.con.simple.Store=function(a,b,c){this.db_name=a;this.storage=b;this.schema=c;this.key_indexes={};a=this.schema.getKeyPath();this.primary_index=goog.isArray(a)?a.join(","):a||ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;this.key_indexes[this.primary_index]=null;this.key_prefix=ydn.db.con.simple.makeKey(this.db_name,this.schema.getName(),this.primary_index)+ydn.db.con.simple.SEP};ydn.db.con.simple.Store.DEBUG=!1;ydn.db.con.simple.Store.prototype.makeKey=function(a){return this.key_prefix+ydn.db.utils.encodeKey(a)};
ydn.db.con.simple.Store.prototype.extractKey=function(a){return ydn.db.utils.decodeKey(a.substr(this.key_prefix.length))};ydn.db.con.simple.Store.prototype.generateKey=function(){var a=this.makeKey(),b=ydn.json.parse(this.storage.getItem(a));b.key_count||(b.key_count=0);b.key_count++;this.storage.setItem(a,ydn.json.stringify(b));return b.key_count};
ydn.db.con.simple.Store.prototype.getIndexCache=function(a){a=a||this.primary_index;if(!this.key_indexes[a]){this.key_indexes[a]=new ydn.structs.Buffer(ydn.db.con.simple.Node.cmp);for(var b=this.storage.length,c=0;c<b;c++){var d=this.storage.key(c);if(!goog.isNull(d)&&goog.string.startsWith(d,this.key_prefix)){var e=this.extractKey(d);if(a==this.primary_index)e=new ydn.db.con.simple.Node(e),this.key_indexes[a].add(e);else{var f=this.storage.getItem(d);if(!goog.isNull(f))if(d=this.schema.getIndex(a),
f=ydn.json.parse(f),f=d.extractKey(f),d.isMultiEntry()){if(goog.isArray(f))for(d=0;d<f.length;d++){var g=new ydn.db.con.simple.Node(f[d],e);this.key_indexes[a].add(g)}}else e=new ydn.db.con.simple.Node(f,e),this.key_indexes[a].add(e)}}}ydn.db.con.simple.Store.DEBUG&&window.console.log("index "+a+" of "+this.schema.getName()+" for "+this.key_indexes[a].getCount()+" records.")}return this.key_indexes[a]};
ydn.db.con.simple.Store.prototype.updateIndex=function(a,b){for(var c in this.key_indexes){var d=this.key_indexes[c];if(d)if(ydn.db.con.simple.Store.DEBUG&&window.console.log("updating "+a+" in index "+c+" of "+this.schema.getName()),c==this.primary_index)d.add(new ydn.db.con.simple.Node(a));else{var e=this.schema.getIndex(c),e=ydn.db.utils.getValueByKeys(b,e.getKeyPath());goog.isDefAndNotNull(e)&&(e=new ydn.db.con.simple.Node(a,e),d.add(e))}}};
ydn.db.con.simple.Store.prototype.removeIndex=function(a,b){for(var c in this.key_indexes){var d=this.key_indexes[c];if(d)if(ydn.db.con.simple.Store.DEBUG&&window.console.log("removing "+a+" in index "+c+" of "+this.schema.getName()),c==this.primary_index)d.remove(new ydn.db.con.simple.Node(a));else{var e=this.schema.getIndex(c),e=ydn.db.utils.getValueByKeys(b,e.getKeyPath()),e=new ydn.db.con.simple.Node(a,e);d.remove(e)}}};
ydn.db.con.simple.Store.prototype.clearIndexCache=function(){for(var a in this.key_indexes){var b=this.key_indexes[a];b&&(b.clear(),ydn.db.con.simple.Store.DEBUG&&window.console.log("index "+a+" of "+this.schema.getName()+" cleared."))}this.key_indexes={}};
ydn.db.con.simple.Store.prototype.addRecord=function(a,b,c){goog.isDefAndNotNull(a)||(this.schema.usedInlineKey()&&(a=this.schema.extractKey(b)),this.schema.isAutoIncrement()&&!goog.isDefAndNotNull(a)&&(a=this.generateKey()));goog.asserts.assert(goog.isDefAndNotNull(a),this+"primary key not provided in "+ydn.json.toShortString(b));ydn.db.con.simple.Store.DEBUG&&window.console.log("add "+a);if(c&&!goog.isNull(this.storage.getItem(this.makeKey(a))))return null;this.storage.setItem(this.makeKey(a),ydn.json.stringify(b));
this.updateIndex(a,b);return a};ydn.db.con.simple.Store.prototype.removeRecord=function(a){var b=this.makeKey(a),c=this.storage.getItem(b);if(goog.isNull(c))return 0;this.storage.removeItem(b);b=ydn.json.parse(c);this.removeIndex(a,b);return 1};ydn.db.con.simple.Store.prototype.clear=function(){this.clearIndexCache();this.removeRecords()};
ydn.db.con.simple.Store.prototype.getRecord=function(a,b){if(a&&a!=this.primary_index)throw goog.asserts.assert(this.schema.hasIndex(a),'index "'+a+'" not found in '+this),"impl";var c=this.storage.getItem(this.makeKey(b)),d=void 0;if(!goog.isNull(c))for(var d=ydn.json.parse(c),c=0,e=this.schema.countIndex();c<e;c++){var f=this.schema.index(c);if(f.getType()==ydn.db.schema.DataType.DATE){var g=f.extractKey(d);g&&f.applyValue(d,new Date(g))}}return d};ydn.db.con.simple.Store.prototype.getName=function(){return this.schema.getName()};
ydn.db.con.simple.Store.prototype.countRecords=function(a,b){a=a||this.primary_index;var c=this.getIndexCache(a),d=null,e=null,f=0,g=!1,h=!1;goog.isDefAndNotNull(b)&&(goog.isDefAndNotNull(b.lower)&&(d=new ydn.db.con.simple.Node(b.lower)),goog.isDefAndNotNull(b.upper)&&(e=new ydn.db.con.simple.Node(b.upper)),g=b.lowerOpen,h=b.upperOpen);c.traverse(function(a){if(goog.isDefAndNotNull(a)&&(a=a.value,!g||!goog.isDefAndNotNull(d)||0!=ydn.db.cmp(a.getKey(),d.getKey()))){if(goog.isDefAndNotNull(e)&&(a=ydn.db.cmp(a.getKey(),
e.getKey()),1===a||0===a&&h))return!0;f++}},d);return f};
ydn.db.con.simple.Store.prototype.removeRecords=function(a){var b=this,c=this.getIndexCache(this.primary_index),d=null,e=null,f=0,g=[],h=[],k=!1,l=!1;goog.isDefAndNotNull(a)&&(goog.isDefAndNotNull(a.lower)&&(d=new ydn.db.con.simple.Node(a.lower)),goog.isDefAndNotNull(a.upper)&&(e=new ydn.db.con.simple.Node(a.upper)),k=a.lowerOpen,l=a.upperOpen);c.traverse(function(a){if(goog.isDefAndNotNull(a)&&(a=a.value,!k||!goog.isDefAndNotNull(d)||0!=ydn.db.con.simple.Node.cmp(a,d))){if(goog.isDefAndNotNull(e)){var c=
ydn.db.con.simple.Node.cmp(a,e);if(1===c||0===c&&l)return!0}var c=b.makeKey(a.getKey()),p=b.storage.getItem(c);goog.isNull(p)||(b.storage.removeItem(c),f++,ydn.db.con.simple.Store.DEBUG&&window.console.log(f+". remove "+a.getKey()+" "+c),10>g.length&&(g.push(a.getKey()),h.push(ydn.json.parse(p))))}},d);if(10>g.length)for(a=0;a<g.length;a++)this.removeIndex(g[a],h[a]);else this.clearIndexCache();return f};
ydn.db.con.simple.Store.prototype.getItems=function(a,b,c,d,e,f,g,h){var k=[],l,m=!!h&&goog.isDefAndNotNull(h[0]);b=b||this.primary_index;var n=b!=this.primary_index;b=this.getIndexCache(b);var p=null,q=null;goog.isDef(f)||(f=0);var r=-1,s=!1,t=!1;goog.isDefAndNotNull(c)&&(goog.isDefAndNotNull(c.lower)&&(p=n&&d?new ydn.db.con.simple.Node(c.lower,"\uffff"):new ydn.db.con.simple.Node(c.lower)),goog.isDefAndNotNull(c.upper)&&(q=n&&!d?new ydn.db.con.simple.Node(c.upper,"\uffff"):new ydn.db.con.simple.Node(c.upper)),
s=!!c.lowerOpen,t=!!c.upperOpen);if(m){d?t=!0:s=!0;c=h[0];var u=goog.isDef(h[1])?h[1]:"\uffff";d?q=n?new ydn.db.con.simple.Node(c,u):new ydn.db.con.simple.Node(c):p=n?new ydn.db.con.simple.Node(c,u):new ydn.db.con.simple.Node(c)}ydn.db.con.simple.Store.DEBUG&&window.console.log(this+" "+(d?" rev":"")+" from "+p+" to "+q);var v=this;c=function(b){if(b&&(r++,!(r<f))){var c=b.value;if(d){if(t&&goog.isDefAndNotNull(q)&&(b=m?ydn.db.con.simple.Node.cmp(c,q):ydn.db.cmp(c.getKey(),q.getKey()),0==b))return;
if(goog.isDefAndNotNull(p)&&(b=m?ydn.db.con.simple.Node.cmp(c,p):ydn.db.cmp(c.getKey(),p.getKey()),-1==b||0==b&&s))return h&&(h[0]=void 0,h[1]=void 0),!0}else{if(s&&goog.isDefAndNotNull(p)&&(b=m?ydn.db.con.simple.Node.cmp(c,p):ydn.db.cmp(c.getKey(),p.getKey()),0==b))return;if(goog.isDefAndNotNull(q)&&(b=m?ydn.db.con.simple.Node.cmp(c,q):ydn.db.cmp(c.getKey(),q.getKey()),1==b||0==b&&t))return h&&(h[0]=void 0,h[1]=void 0),!0}b=c.getKey();if(!g||!n||!goog.isDefAndNotNull(l)||0!=ydn.db.cmp(l,b)){c=n?
c.getPrimaryKey():b;if(a==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY)k.push(c);else if(a==ydn.db.base.QueryMethod.LIST_KEY)k.push(b);else if(a==ydn.db.base.QueryMethod.LIST_KEYS)k.push([b,c]);else if(a==ydn.db.base.QueryMethod.LIST_VALUE){var u=v.getRecord(null,c);k.push(u)}else k.push([b,c,v.getRecord(null,c)]);h&&(h[0]=b,h[1]=c)}l=b;if(goog.isDef(e)&&k.length>=e)return!0}};d?b.reverseTraverse(c,q):b.traverse(c,p);return k};
ydn.db.con.simple.Store.prototype.getRecords=function(a,b,c,d,e){return this.getItems(ydn.db.base.QueryMethod.LIST_VALUE,a,b,c,d,e)};ydn.db.con.simple.Store.prototype.getKeys=function(a,b,c,d,e){return this.getItems(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,b,c,d,e)};goog.DEBUG&&(ydn.db.con.simple.Store.prototype.toString=function(){return"ydn.db.con.simple.Store:"+this.db_name+":"+this.schema.getName()});ydn.db.con.simple.IStorageProvider=function(){};ydn.db.con.simple.IStorageProvider.prototype.connectDb=function(a){};ydn.db.req={};ydn.db.req.InMemoryStorage=function(){this.clear()};ydn.db.req.InMemoryStorage.prototype.connectDb=function(a){return this};ydn.db.req.InMemoryStorage.prototype.setItem=function(a,b){goog.isDef(this.memoryStorage[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.memoryStorage[a]=b};ydn.db.req.InMemoryStorage.prototype.getItem=function(a){return goog.isDef(this.memoryStorage[a])?this.memoryStorage[a]:null};
ydn.db.req.InMemoryStorage.prototype.removeItem=function(a){delete this.memoryStorage[a];goog.array.remove(this.keys,a.toString());this.length=this.keys.length};ydn.db.req.InMemoryStorage.prototype.length=0;ydn.db.req.InMemoryStorage.prototype.key=function(a){a=this.keys[a];return goog.isDef(a)?this.memoryStorage[a]:null};ydn.db.req.InMemoryStorage.prototype.clear=function(){this.memoryStorage={};this.keys=[];this.length=0};ydn.db.con.SimpleStorageService=function(a){this.provider_=a||new ydn.db.req.InMemoryStorage;this.simple_stores_={}};ydn.db.con.SimpleStorageService.DEFAULT_KEY_PATH="_id_";ydn.db.con.SimpleStorageService.prototype.getSimpleStore=function(a){var b=this.schema.getStore(a);if(b)this.simple_stores_[a]||(this.simple_stores_[a]=new ydn.db.con.simple.Store(this.dbname,this.storage_,b));else throw new ydn.debug.error.InternalError('store name "'+a+'" not found.');return this.simple_stores_[a]};
ydn.db.con.SimpleStorageService.prototype.getSchema=function(a){var b=this;setTimeout(function(){var c=ydn.db.con.simple.makeKey(b.dbname),c=b.storage_.getItem(c),c=new ydn.db.schema.Database(c);a(c)},10)};ydn.db.con.simple.TxStorage=function(a,b){this.storage_=a;this.on_completed_=b};ydn.db.con.simple.TxStorage.prototype.getStorage=function(a,b){var c=this.storage_;goog.asserts.assertObject(c,"transaction already committed");setTimeout(function(){a.call(b,c)},4);var d=this;return function(){d.on_completed_(ydn.db.base.TxEventTypes.COMPLETE,null);d.on_completed_=null;d.storage_=null}};ydn.db.crud.req.SimpleStore=function(a,b){ydn.db.crud.req.RequestExecutor.call(this,a,b)};goog.inherits(ydn.db.crud.req.SimpleStore,ydn.db.crud.req.RequestExecutor);ydn.db.crud.req.SimpleStore.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.SimpleStore");ydn.db.crud.req.SimpleStore.SYNC=!0;ydn.db.crud.req.SimpleStore.DEBUG=!1;ydn.db.crud.req.SimpleStore.prototype.putByKeys=function(a,b,c){this.insertObjects(a,!0,!1,null,b,c)};
ydn.db.crud.req.SimpleStore.prototype.insertObjects=function(a,b,c,d,e,f){var g=a.getLabel()+" "+(b?"put":"add")+"Object"+(c?"":"s "+e.length+" objects");this.logger.finest(g);var h=a.getTx().getStorage(function(g){var l;if(c)goog.asserts.assertString(d,"store name must be provided"),l=g.getSimpleStore(d),g=f?f[0]:void 0,g=l.addRecord(g,e[0],!b),goog.isDefAndNotNull(g)?a.setDbValue(g):(l=goog.DEBUG?ydn.json.toShortString(g):"",l=new ydn.db.ConstraintError(l),a.setDbValue(l,!0));else{for(var m=d,n=
[],p=!1,q=f||{},r=0;r<e.length;r++){var s;d?s=q[r]:(m=f[r],s=m.getId(),m=m.getStoreName());l&&l.getName()==m||(goog.asserts.assertString(m,"store name a string, but "+m),l=g.getSimpleStore(m));s=l.addRecord(s,e[r],!b);goog.isDefAndNotNull(s)?n.push(s):(p=!0,n.push(new ydn.db.ConstraintError))}a.setDbValue(n,p)}h();h=null},this)};ydn.db.crud.req.SimpleStore.prototype.putData=function(a,b,c,d,e,f){throw new ydn.debug.error.NotImplementedException("putData");};
ydn.db.crud.req.SimpleStore.prototype.getById=function(a,b,c){var d=a.getTx().getStorage(function(e){e=e.getSimpleStore(b).getRecord(null,c);a.setDbValue(e);d();d=null},this)};ydn.db.crud.req.SimpleStore.prototype.listByIds_=function(a,b,c){var d=a.getTx().getStorage(function(e){for(var f=[],g=b,h,k=0;k<c.length;k++){var l=c[k];l instanceof ydn.db.Key&&(g=l,l=g.getId(),g=g.getStoreName());h&&h.getName()==g||(h=e.getSimpleStore(g));l=h.getRecord(null,l);f[k]=l}a.setDbValue(f,!1);d();d=null},this)};
ydn.db.crud.req.SimpleStore.prototype.listByIds=function(a,b,c){this.listByIds_(a,b,c)};ydn.db.crud.req.SimpleStore.prototype.listByKeys=function(a,b){this.listByIds_(a,null,b)};ydn.db.crud.req.SimpleStore.prototype.removeById=function(a,b,c){var d=a.getLabel()+" removeById "+b+" "+c;this.logger.finest(d);var e=this,f=a.getTx().getStorage(function(g){g=g.getSimpleStore(b).removeRecord(c);e.logger.finer("success "+d+(0==g?" [not found]":""));a.setDbValue(g);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.removeByKeys=function(a,b){var c=a.getLabel()+" removeByKeys "+b.length+" keys";this.logger.finest(c);var d,e=0,f=a.getTx().getStorage(function(c){for(var h=0;h<b.length;h++){var k=b[h].getStoreName(),l=b[h].getId();d&&d.getName()==k||(d=c.getSimpleStore(k));e+=d.removeRecord(l)}a.setDbValue(e);f();f=null},this)};ydn.db.crud.req.SimpleStore.prototype.clearByKeyRange=function(a,b,c){this.removeByKeyRange(a,b,c)};
ydn.db.crud.req.SimpleStore.prototype.removeByKeyRange=function(a,b,c){var d=a.getLabel()+" removeByKeyRange "+(c?ydn.json.stringify(c):"");this.logger.finest(d);var e=this,f=a.getTx().getStorage(function(g){g=g.getSimpleStore(b).removeRecords(c);e.logger.finer(d+" deleted "+g+" records.");a.setDbValue(g);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.removeByIndexKeyRange=function(a,b,c,d){var e=a.getLabel()+" removeByIndexKeyRange "+(d?ydn.json.stringify(d):"");this.logger.finest(e);var f=a.getTx().getStorage(function(e){e=e.getSimpleStore(b);for(var h=e.getKeys(c,d),k=h.length,l=0;l<k;l++)e.removeRecord(h[l]);a.setDbValue(k);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.clearByStores=function(a,b){var c=a.getLabel()+" clearByStores";this.logger.finest(c);var d=a.getTx().getStorage(function(e){for(var f=0;f<b.length;f++)e.getSimpleStore(b[f]).clear();this.logger.finer("success "+c);a.setDbValue(b.length);d();d=null},this)};
ydn.db.crud.req.SimpleStore.prototype.countStores=function(a,b){var c=a.getTx().getStorage(function(d){for(var e=[],f=0;f<b.length;f++){var g=d.getSimpleStore(b[f]);e.push(g.countRecords())}a.setDbValue(e);c();c=null},this)};
ydn.db.crud.req.SimpleStore.prototype.countKeyRange=function(a,b,c,d){var e=a.getLabel()+" count"+(goog.isDefAndNotNull(d)?"Index":"")+(goog.isDefAndNotNull(c)?"KeyRange":"Store");this.logger.finest(e);var f=a.getTx().getStorage(function(g){g=g.getSimpleStore(b).countRecords(d,c);this.logger.finer("success "+e);a.setDbValue(g);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.list=function(a,b,c,d,e,f,g,h,k,l){var m=a.getLabel()+" "+c+" "+(e?ydn.json.toShortString(e):"");this.logger.finest(m);var n=a.getTx().getStorage(function(p){p=p.getSimpleStore(c).getItems(b,d,e,h,f,g,k,l);this.logger.finer(m+" "+p.length+" records found.");a.setDbValue(p);n();n=null},this)};ydn.db.core.req.SimpleStore=function(a,b){ydn.db.crud.req.SimpleStore.call(this,a,b)};goog.inherits(ydn.db.core.req.SimpleStore,ydn.db.crud.req.SimpleStore);ydn.db.core.req.SimpleStore.DEBUG=!1;ydn.db.core.req.SimpleStore.prototype.getCursor=function(a,b,c,d){var e=this.schema.getStore(c);goog.asserts.assertObject(e,'store "'+c+'" not found.');return new ydn.db.core.req.SimpleCursor(a,b,e,d)};ydn.db.core.req.SimpleStore.prototype.getStreamer=function(a,b,c,d){throw"not yet";};ydn.db.core.req.CachedWebsqlCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);goog.asserts.assert(c);this.store_schema_=c;this.cursor_=null;this.current_cursor_index_=NaN;this.has_pending_request=!1};goog.inherits(ydn.db.core.req.CachedWebsqlCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.CachedWebsqlCursor.DEBUG=!1;ydn.db.core.req.CachedWebsqlCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.CachedWebsqlCursor");
ydn.db.core.req.CachedWebsqlCursor.prototype.current_key_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.current_primary_key_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.current_value_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.cursor_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.current_cursor_index_=NaN;ydn.db.core.req.CachedWebsqlCursor.prototype.moveNext_=function(){this.current_cursor_index_++;return[this.getPrimaryKey(),this.getIndexKey(),this.getValue()]};
ydn.db.core.req.CachedWebsqlCursor.prototype.invokeNextSuccess_=function(){var a=this.moveNext_();ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log(["onSuccess",this.current_cursor_index_].concat(a));this.onSuccess(a[0],a[1],a[2])};
ydn.db.core.req.CachedWebsqlCursor.prototype.openCursor=function(a,b,c){var d=this,e=["SELECT"],f=[],g=this.store_schema_.getSQLKeyColumnName(),h=goog.string.quote(g),k=this.index_name?this.store_schema_.getIndex(this.index_name):null,l=k?k.getType():this.store_schema_.getType(),m=k?k.getSQLIndexColumnName():g,g=goog.string.quote(m),n=" ORDER BY ";this.isValueCursor()?(e.push("*"),k?(goog.asserts.assertString(m),n+=this.reverse?goog.string.quote(m)+" DESC, "+h+" DESC ":goog.string.quote(m)+" ASC, "+
h+" ASC "):n=n+h+(this.reverse?" DESC":" ASC")):k?(goog.asserts.assertString(m),e.push(goog.string.quote(m)+", "+h),n+=this.reverse?goog.string.quote(m)+" DESC, "+h+" DESC ":goog.string.quote(m)+" ASC, "+h+" ASC "):(e.push(h),n+=h,n+=this.reverse?" DESC":" ASC");e.push("FROM "+goog.string.quote(this.store_name));m=[];k&&k.isMultiEntry();k=this.key_range;if(goog.isDefAndNotNull(a))if(this.index_name){goog.asserts.assert(goog.isDefAndNotNull(b));if(goog.isDefAndNotNull(this.key_range)){h=ydn.db.base.indexedDb.cmp(b,
this.key_range.upper);if(1==h||0==h&&!this.key_range.upperOpen){this.onSuccess(void 0,void 0,void 0);return}k=ydn.db.IDBKeyRange.bound(b,this.key_range.upper,!1,this.key_range.upperOpen)}else k=ydn.db.IDBKeyRange.lowerBound(b);ydn.db.KeyRange.toSql(g,l,k,m,f)}else k=this.reverse?ydn.db.IDBKeyRange.upperBound(a,!!c):ydn.db.IDBKeyRange.lowerBound(a,!!c),ydn.db.KeyRange.toSql(h,this.store_schema_.getType(),k,m,f);else this.index_name?ydn.db.KeyRange.toSql(g,l,k,m,f):ydn.db.KeyRange.toSql(h,this.store_schema_.getType(),
k,m,f);0<m.length&&e.push("WHERE "+m.join(" AND "));e.push(n);var p=e.join(" ");d.logger.finest(this+": opened: "+("{"+(b?b+"-":"")+(a?a:"")+"}")+" SQL: "+p+" : "+ydn.json.stringify(f));this.tx.executeSql(p,f,function(b,e){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([p,e]);d.has_pending_request=!1;d.cursor_=e;d.current_cursor_index_=0;if(d.index_name&&goog.isDefAndNotNull(a))for(var f=ydn.db.cmp(d.getPrimaryKey(),a);-1==f||0==f&&c;)d.current_cursor_index_++,f=ydn.db.cmp(d.getPrimaryKey(),
a);d.onSuccess(d.getPrimaryKey(),d.getIndexKey(),d.getValue())},function(a,b){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([p,a,b]);d.has_pending_request=!1;d.logger.warning("get error: "+b.message);d.onError(b);return!0})};ydn.db.core.req.CachedWebsqlCursor.prototype.hasCursor=function(){return!!this.cursor_&&this.current_cursor_index_<this.cursor_.rows.length};
ydn.db.core.req.CachedWebsqlCursor.prototype.getIndexKey=function(){if(this.isIndexCursor()&&this.current_cursor_index_<this.cursor_.rows.length){var a=this.cursor_.rows.item(this.current_cursor_index_),b=this.store_schema_.getIndex(this.index_name),c=b.getType();return ydn.db.schema.Index.sql2js(a[b.getSQLIndexColumnName()],c)}};
ydn.db.core.req.CachedWebsqlCursor.prototype.getPrimaryKey=function(){if(this.current_cursor_index_<this.cursor_.rows.length){var a=this.store_schema_.getSQLKeyColumnName(),b=this.cursor_.rows.item(this.current_cursor_index_);return ydn.db.schema.Index.sql2js(b[a],this.store_schema_.getType())}};ydn.db.core.req.CachedWebsqlCursor.prototype.getEffectiveKey=function(){return this.isIndexCursor()?this.getIndexKey():this.getPrimaryKey()};
ydn.db.core.req.CachedWebsqlCursor.prototype.getValue=function(){this.index_name||this.store_schema_.getSQLKeyColumnName();if(this.current_cursor_index_<this.cursor_.rows.length){if(this.isValueCursor()){var a=this.cursor_.rows.item(this.current_cursor_index_);return ydn.db.crud.req.WebSql.parseRow(a,this.store_schema_)}return this.getPrimaryKey()}};
ydn.db.core.req.CachedWebsqlCursor.prototype.clear=function(){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var a=new goog.async.Deferred,b=this;this.has_pending_request=!0;var c=this.store_schema_.getSQLKeyColumnName(),d="DELETE FROM "+this.store_schema_.getQuotedName()+" WHERE "+c+" = ?",c=[this.getPrimaryKey()];b.logger.finest(this+': clear "'+d+'" : '+ydn.json.stringify(c));this.tx.executeSql(d,c,function(c,f){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([d,f]);b.has_pending_request=
!1;a.callback(f.rowsAffected)},function(c,f){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([d,c,f]);b.has_pending_request=!1;b.logger.warning("get error: "+f.message);a.errback(f);return!0});return a};
ydn.db.core.req.CachedWebsqlCursor.prototype.update=function(a){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var b=new goog.async.Deferred,c=this;this.has_pending_request=!0;var d=this.getPrimaryKey();goog.asserts.assertObject(a);a=c.store_schema_.sqlNamesValues(a,d);var e="REPLACE INTO "+this.store_schema_.getQuotedName()+" ("+a.columns.join(", ")+") VALUES ("+a.slots.join(", ")+") ON CONFLICT FAIL";c.logger.finest(this+': clear "'+e+'" : '+ydn.json.stringify(a.values));this.tx.executeSql(e,
a.values,function(a,g){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([e,g]);c.has_pending_request=!1;b.callback(d)},function(a,d){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&window.console.log([e,a,d]);c.has_pending_request=!1;c.logger.warning("get error: "+d.message);b.errback(d);return!0});return b};
ydn.db.core.req.CachedWebsqlCursor.prototype.advance=function(a){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");this.current_cursor_index_+=a;var b=this.getPrimaryKey(),c=this.getIndexKey(),d=this.getValue(),e=this;setTimeout(function(){e.onSuccess(b,c,d)},4)};
ydn.db.core.req.CachedWebsqlCursor.prototype.continuePrimaryKey=function(a){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");var b=ydn.db.cmp(a,this.getPrimaryKey());if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" wrong direction.");for(var c=this.getIndexKey(),d=this.cursor_.rows.length,e=0;e<d;e++){if(0==b||1==b&&this.reverse||-1==b&&!this.reverse){this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue());
return}this.current_cursor_index_++;if(c&&c!=this.getIndexKey()){this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue());return}b=this.getPrimaryKey();b=goog.isDefAndNotNull(b)?ydn.db.cmp(a,b):1}this.onSuccess(void 0,void 0,void 0)};
ydn.db.core.req.CachedWebsqlCursor.prototype.continueEffectiveKey=function(a){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");if(goog.isDefAndNotNull(a)){var b=ydn.db.cmp(a,this.getEffectiveKey());if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" wrong direction.");for(var c=this.cursor_.rows.length,d=0;d<c;d++){if(0==b||1==b&&this.reverse||-1==b&&!this.reverse){this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),
this.getValue());return}this.current_cursor_index_++;b=this.getEffectiveKey();b=goog.isDefAndNotNull(b)?ydn.db.cmp(a,b):1}this.onSuccess(void 0,void 0,void 0)}else this.advance(1)};ydn.db.core.req.WebsqlCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);goog.asserts.assert(c);this.store_schema_=c;this.index_=null;this.current_primary_key_=this.current_key_=void 0};goog.inherits(ydn.db.core.req.WebsqlCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.WebsqlCursor.DEBUG=!1;ydn.db.core.req.WebsqlCursor.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.WebsqlCursor");ydn.db.core.req.WebsqlCursor.prototype.getIndexKey=function(){return this.current_key_};
ydn.db.core.req.WebsqlCursor.prototype.getPrimaryKey=function(){return this.current_primary_key_};ydn.db.core.req.WebsqlCursor.prototype.init=function(a,b,c,d,e){ydn.db.core.req.WebsqlCursor.superClass_.init.call(this,a,b,c,d,e);this.index_=goog.isString(b)?this.store_schema.getIndex(b):null};ydn.db.core.req.WebsqlCursor.prototype.getValue=function(){return this.current_value_};
ydn.db.core.req.WebsqlCursor.prototype.collect=function(a){this.current_value_=this.current_primary_key_=this.current_key_=void 0;ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log(a);if(goog.isDef(a))if(goog.isObject(a)){var b=this.store_schema.getSQLKeyColumnName();this.current_primary_key_=b=ydn.db.schema.Index.sql2js(a[b],this.store_schema.getType());if(this.isIndexCursor()){goog.asserts.assertString(this.index_name);var c=this.store_schema.getIndex(this.index_name).getType();this.current_key_=
ydn.db.schema.Index.sql2js(a[this.index_name],c)}else this.current_key_=b;this.current_value_=this.isValueCursor()?ydn.db.crud.req.WebSql.parseRow(a,this.store_schema):b}else this.current_value_=a};
ydn.db.core.req.WebsqlCursor.prototype.continuePrimaryKey_=function(a,b,c,d){goog.asserts.assertString(this.index_name);goog.asserts.assert(goog.isDefAndNotNull(this.current_key_));this.store_schema.getIndex(this.index_name);var e=[],f=this.index_name,g=this.key_range,h=this.current_key_;if(goog.isDefAndNotNull(g)){var k=g.lower,l=g.upper,m=g.lowerOpen,g=g.upperOpen;this.reverse?l=goog.isDefAndNotNull(l)&&-1==ydn.db.cmp(l,h)?l:h:k=goog.isDefAndNotNull(k)&&1==ydn.db.cmp(k,h)?k:h;g=goog.isDefAndNotNull(k)&&
goog.isDefAndNotNull(l)?ydn.db.KeyRange.bound(k,l,!!m,!!g):goog.isDefAndNotNull(k)?ydn.db.IDBKeyRange.lowerBound(k,!!m):ydn.db.IDBKeyRange.upperBound(l,!!g)}else g=this.reverse?ydn.db.IDBKeyRange.upperBound(h):ydn.db.IDBKeyRange.lowerBound(h);f=this.store_schema.inSql(e,this.query_method,f,g,this.reverse,this.unique);b=this.reverse?ydn.db.IDBKeyRange.upperBound(b,!c):ydn.db.IDBKeyRange.lowerBound(b,!c);b=this.store_schema.inSql(e,this.query_method,this.store_schema.getSQLKeyColumnName(),b,this.reverse,
this.unique);f.where=f.where?f.where+(" AND "+b.where):b.where;var n="SELECT "+f.select+" FROM "+f.from+(f.where?" WHERE "+f.where:"")+(f.group?" GROUP BY "+f.group:"")+" ORDER BY "+f.order,n=n+" LIMIT 1";0<d&&(n+=" OFFSET "+d);var p=this;this.logger.finest(this+": continuePrimary:  SQL: "+n+" : "+ydn.json.stringify(e));this.tx.executeSql(n,e,function(b,c){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([n,c]);0<c.rows.length?p.collect(c.rows.item(0)):p.collect();a.call(p,p.current_key_,p.current_primary_key_,
p.current_value_);a=null},function(b,c){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([n,c]);p.logger.warning("get error: "+c.message);p.onError(c);p.collect();a.call(p,p.current_primary_key_,p.current_key_,p.current_value_);a=null;return!1})};
ydn.db.core.req.WebsqlCursor.prototype.continueEffectiveKey_=function(a,b,c,d,e){var f=!c;c=[];var g;this.is_index&&goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(b)?g=this.store_schema.sqlContinueIndexEffectiveKey(this.query_method,c,this.index_.getName(),this.key_range,b,f,e,this.reverse,this.unique):goog.isDefAndNotNull(b)?(e=this.index_?this.index_.getName():null,g=this.store_schema.sqlContinueEffectiveKey(this.query_method,c,e,this.key_range,this.reverse,this.unique,b,f)):(b=this.isPrimaryCursor()?
this.store_schema.getSQLKeyColumnName():this.index_.getSQLIndexColumnName(),g=this.store_schema.toSql(c,this.query_method,b,this.key_range,this.reverse,this.unique),this.isIndexCursor()&&(g+=", "+this.store_schema.getSQLKeyColumnNameQuoted()+" ASC"));g+=" LIMIT 1";0<d&&(g+=" OFFSET "+d);var h=this;this.logger.finest(this+": continue:  SQL: "+g+" : "+ydn.json.stringify(c));this.tx.executeSql(g,c,function(b,c){0<c.rows.length?h.collect(c.rows.item(0)):h.collect();a.call(h,h.current_key_,h.current_primary_key_,
h.current_value_);a=null},function(b,c){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([g,b,c]);h.logger.warning("get error: "+c.message);h.onError(c);h.collect();a.call(h,h.current_primary_key_,h.current_key_,h.current_value_);a=null;return!1})};ydn.db.core.req.WebsqlCursor.prototype.hasCursor=function(){return this.isActive()};
ydn.db.core.req.WebsqlCursor.prototype.update=function(a){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var b=new goog.async.Deferred,c=this.getPrimaryKey();goog.asserts.assertObject(a);a=this.store_schema.sqlNamesValues(a,c);var d="REPLACE INTO "+this.store_schema.getQuotedName()+" ("+a.columns.join(", ")+") VALUES ("+a.slots.join(", ")+")";this.logger.finest(this+': update "'+d+'" : '+ydn.json.stringify(a.values));this.tx.executeSql(d,a.values,function(a,f){ydn.db.core.req.WebsqlCursor.DEBUG&&
window.console.log([d,f]);b.callback(c)},function(a,c){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([d,a,c]);b.errback(c);return!1});return b};ydn.db.core.req.WebsqlCursor.MONITOR=!0;
ydn.db.core.req.WebsqlCursor.prototype.advance=function(a){var b=this.current_key_,c=this.current_primary_key_,d=function(a,d,e){var k=goog.isDefAndNotNull(b)&&goog.isDefAndNotNull(a)&&0==ydn.db.cmp(b,a);if(this.isPrimaryCursor()){if(k)throw new ydn.debug.error.InternalError("current: "+b+" next: "+a);}else{var l=goog.isDefAndNotNull(d)&&goog.isDefAndNotNull(c)&&0==ydn.db.cmp(d,c);if(k&&l)throw new ydn.debug.error.InternalError("current: "+b+";"+c+" next: "+a+";"+d);}this.onSuccess(a,d,e)};goog.asserts.assert(0<
a);var e=!0;goog.isDefAndNotNull(this.current_key_)&&(this.isPrimaryCursor()||goog.isDefAndNotNull(this.current_primary_key_))&&(a-=1,e=!1);this.continueEffectiveKey_(ydn.db.core.req.WebsqlCursor.MONITOR?d:this.onSuccess,this.current_key_,e,a,this.current_primary_key_)};ydn.db.core.req.WebsqlCursor.prototype.continueEffectiveKey=function(a){goog.isDefAndNotNull(a)?this.continueEffectiveKey_(this.onSuccess,a,!0):this.advance(1)};
ydn.db.core.req.WebsqlCursor.prototype.prepareBaseSql=function(a){var b=this.index_?this.index_.getSQLIndexColumnName():this.store_schema.getSQLKeyColumnName();return this.store_schema.inSql(a,this.query_method,b,this.key_range,this.reverse,this.unique)};ydn.db.core.req.WebsqlCursor.prototype.openCursor=function(a,b){this.continueEffectiveKey_(this.onSuccess,a,!1,0,b)};
ydn.db.core.req.WebsqlCursor.prototype.clear=function(){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var a=new goog.async.Deferred,b=this.store_schema.getSQLKeyColumnName(),c="DELETE FROM "+this.store_schema.getQuotedName()+" WHERE "+b+" = ?",b=[this.getPrimaryKey()];this.logger.finest(this+': clear "'+c+'" : '+ydn.json.stringify(b));this.tx.executeSql(c,b,function(b,e){ydn.db.core.req.WebsqlCursor.DEBUG&&window.console.log([c,e]);a.callback(e.rowsAffected)},function(b,e){ydn.db.core.req.WebsqlCursor.DEBUG&&
window.console.log([c,b,e]);a.errback(e);return!1});return a};
ydn.db.core.req.WebsqlCursor.prototype.continuePrimaryKey=function(a){goog.asserts.assert(this.isIndexCursor());goog.asserts.assert(goog.isDefAndNotNull(this.current_key_));goog.asserts.assert(goog.isDefAndNotNull(this.current_primary_key_));var b=ydn.db.cmp(a,this.current_primary_key_);if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" to continuePrimaryKey  from "+this.current_primary_key_+" to "+a+" on "+this.dir+" direction is wrong");this.continuePrimaryKey_(this.onSuccess,
a,!0)};goog.DEBUG&&(ydn.db.core.req.WebsqlCursor.prototype.toString=function(){return"WebSql"+ydn.db.core.req.WebsqlCursor.superClass_.toString.call(this)});ydn.db.crud.req.WebSql=function(a,b){ydn.db.crud.req.RequestExecutor.call(this,a,b)};goog.inherits(ydn.db.crud.req.WebSql,ydn.db.crud.req.RequestExecutor);ydn.db.crud.req.WebSql.DEBUG=!1;ydn.db.crud.req.WebSql.REQ_PER_TX=10;ydn.db.crud.req.WebSql.RW_REQ_PER_TX=2;ydn.db.crud.req.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.crud.req.WebSql");
ydn.db.crud.req.WebSql.parseRow=function(a,b){if(b.isFixed()&&!b.usedInlineKey()&&0==b.countIndex()&&a[ydn.db.base.DEFAULT_BLOB_COLUMN]){var c=a[ydn.db.base.DEFAULT_BLOB_COLUMN];if(-1==c.indexOf(";base64,"))return ydn.json.parse(c);'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substr(1,c.length-2));for(var d=c.split(";base64,"),c=d[0].split(":")[1],d=window.atob(d[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f.buffer],{type:c})}c=a[ydn.db.base.DEFAULT_BLOB_COLUMN]?
ydn.json.parse(a[ydn.db.base.DEFAULT_BLOB_COLUMN]):{};goog.isDefAndNotNull(b.keyPath)&&(d=ydn.db.schema.Index.sql2js(a[b.keyPath],b.getType()),goog.isDefAndNotNull(d)&&b.setKeyValue(c,d));for(d=0;d<b.countIndex();d++)e=b.index(d),f=e.getSQLIndexColumnName(),f==ydn.db.base.DEFAULT_BLOB_COLUMN||e.isComposite()||e.isMultiEntry()||e.getType()!=ydn.db.schema.DataType.DATE&&!b.isFixed()||(f=ydn.db.schema.Index.sql2js(a[f],e.getType()),goog.isDef(f)&&e.applyValue(c,f));return c};
ydn.db.crud.req.WebSql.prototype.getKeyFromRow=function(a,b){return b[a.keyPath||ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME]};ydn.db.crud.req.WebSql.prototype.putData=function(a,b,c,d,e,f){throw new ydn.debug.error.NotImplementedException("putData");};
ydn.db.crud.req.WebSql.prototype.insertObjects=function(a,b,c,d,e,f){b=!b;var g=this.schema.getStore(d),h=b?"INSERT INTO ":"INSERT OR REPLACE INTO ";d=a.getTx();var k=this,l=[],m=0,n=a.getLabel()+" inserting "+e.length+" objects.",p=!1,q=function(b,d){if(!goog.isDefAndNotNull(e[b]))if(k.logger.finest("empty object at "+b+" of "+e.length),m++,m==e.length)k.logger.finer(n+" success "+n),a.setDbValue(l,p);else{var t=b+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;t<e.length&&q(t,d)}var u;u=goog.isDef(f)?g.sqlNamesValues(e[b],
f[b]):g.sqlNamesValues(e[b]);var v=h+g.getQuotedName()+" ("+u.columns.join(", ")+") VALUES ("+u.slots.join(", ")+");",t=a.getLabel()+" SQL: "+v+" PARAMS: "+u.values+" REQ: "+b+" of "+e.length;k.logger.finest(t);ydn.db.crud.req.WebSql.DEBUG&&window.console.log(v,u.values);d.executeSql(v,u.values,function(f,n){m++;var v=goog.isDef(u.key)?u.key:n.insertId;1>n.rowsAffected&&(p=!0,v=new ydn.db.ConstraintError(v+" no-op"));for(var t=function(b,c){var e=ydn.db.base.PREFIX_MULTIENTRY+g.getName()+":"+b.getName(),
e=h+goog.string.quote(e)+" ("+g.getSQLKeyColumnNameQuoted()+", "+b.getSQLIndexColumnNameQuoted()+") VALUES (?, ?)",f=[ydn.db.schema.Index.js2sql(v,g.getType()),ydn.db.schema.Index.js2sql(c,b.getType())];k.logger.finest(a.getLabel()+" multiEntry "+e+" "+f);d.executeSql(e,f,function(a,b){},function(a,b){k.logger.warning("multiEntry index insert error: "+b.message);return!1})},D=0,E=g.countIndex();D<E;D++){var C=g.index(D);if(C.isMultiEntry())for(var F=ydn.db.utils.getValueByKeys(e[b],C.getKeyPath()),
J=(F?F.length:0)||0,G=0;G<J;G++)t(C,F[G])}c?a.setDbValue(v):(l[b]=v,m==e.length?a.setDbValue(l,p):(t=b+ydn.db.crud.req.WebSql.RW_REQ_PER_TX,t<e.length&&q(t,f)))},function(d,f){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([v,u,d,f]);m++;p=!0;6==f.code?f.name="ConstraintError":k.logger.warning("error: "+f.message+" "+n);if(c)a.setDbValue(f,!0);else if(l[b]=f,m==e.length)k.logger.finest("success "+n),a.setDbValue(l,p);else{var g=b+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;g<e.length&&q(g,d)}return!1})};
if(0<e.length)for(b=0;b<ydn.db.crud.req.WebSql.RW_REQ_PER_TX&&b<e.length;b++)q(b,d);else this.logger.finer("success"),a.setDbValue([])};
ydn.db.crud.req.WebSql.prototype.putByKeys=function(a,b,c){if(0==c.length)a.setDbValue([]);else{a.getTx();for(var d=[],e=0,f=0,g=this,h=function(h,k){var l=[];g.logger.finest("put "+k.length+" objects to "+h);for(var m=g.schema.getStore(h).usedInlineKey(),n=m?void 0:[],p=0;p<k.length;p++)l.push(b[k[p]]),m||n.push(c[k[p]].getId());m=a.copy();m.addCallbacks(function(b){for(var c=0;c<k.length;c++)d[k[c]]=b[c];e++;e==f&&a.setDbValue(d)},function(b){e++;e==f&&a.setDbValue(d,!0)});g.insertObjects(m,!1,
!1,h,l,n)},k="",l=[],m=[],n=0;n<c.length;n++){var p=c[n].getStoreName(),q=c[n].getId();p!=k?(f++,0<l.length&&h(k,l),l=[n],m=[q],k=p):(l.push(n),m.push(q))}0<l.length&&h(k,l)}};
ydn.db.crud.req.WebSql.prototype.getById=function(a,b,c){var d=a.getTx(),e=this.schema.getStore(b);goog.asserts.assertInstanceof(e,ydn.db.schema.Store,b+" not found.");var f=this;b=e.getSQLKeyColumnNameQuoted();c=[ydn.db.schema.Index.js2sql(c,e.getType())];b="SELECT * FROM "+e.getQuotedName()+" WHERE "+b+" = ?";var g=a.getLabel()+" SQL: "+b+" PARAMS: "+c;this.logger.finest(g);d.executeSql(b,c,function(b,c){if(0<c.rows.length){var d=c.rows.item(0);goog.isDefAndNotNull(d)?(d=ydn.db.crud.req.WebSql.parseRow(d,
e),a.setDbValue(d)):(f.logger.finer("success no result: "+g),a.setDbValue(void 0))}else f.logger.finer("success no result: "+g),a.setDbValue(void 0)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);f.logger.warning("error: "+g+" "+c.message);a.setDbValue(c,!0);return!1})};
ydn.db.crud.req.WebSql.prototype.listByIds=function(a,b,c){var d=a.getTx(),e=this,f=[],g=0,h=this.schema.getStore(b),k=function(b,d){var n=c[b],p=h.getSQLKeyColumnNameQuoted(),n=[ydn.db.schema.Index.js2sql(n,h.getType())],q="SELECT * FROM "+h.getQuotedName()+" WHERE "+p+" = ?";e.logger.finest("SQL: "+q+" PARAMS: "+n);d.executeSql(q,n,function(d,e){g++;if(0<e.rows.length){var m=e.rows.item(0);goog.isDefAndNotNull(m)&&(f[b]=ydn.db.crud.req.WebSql.parseRow(m,h))}else f[b]=void 0;g==c.length?a.setDbValue(f):
(m=b+ydn.db.crud.req.WebSql.REQ_PER_TX,m<c.length&&k(m,d))},function(d,h){g++;ydn.db.crud.req.WebSql.DEBUG&&window.console.log([d,h]);e.logger.warning("error: "+q+" "+h.message);if(g==c.length)a.setDbValue(f);else{var m=b+ydn.db.crud.req.WebSql.REQ_PER_TX;m<c.length&&k(m,d)}return!1})};if(0<c.length)for(b=0;b<ydn.db.crud.req.WebSql.REQ_PER_TX&&b<c.length;b++)k(b,d);else e.logger.finer("success"),a.setDbValue([])};
ydn.db.crud.req.WebSql.prototype.listByKeys=function(a,b){var c=a.getTx(),d=this,e=[],f=0,g=function(c,h){var m=b[c],n=m.getStoreName(),p=d.schema.getStore(n),n=m.getNormalizedId(),m=p.getSQLKeyColumnNameQuoted(),n=[ydn.db.schema.Index.js2sql(n,p.getType())],q="SELECT * FROM "+p.getQuotedName()+" WHERE "+m+" = ?";d.logger.finest("SQL: "+q+" PARAMS: "+n);h.executeSql(q,n,function(h,l){f++;if(0<l.rows.length){var m=l.rows.item(0);goog.isDefAndNotNull(m)&&(e[c]=ydn.db.crud.req.WebSql.parseRow(m,p))}else e[c]=
void 0;f==b.length?(d.logger.finest("success "+q),a.setDbValue(e)):(m=c+ydn.db.crud.req.WebSql.REQ_PER_TX,m<b.length&&g(m,h))},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);a.setDbValue(c,!0);return!1})};if(0<b.length)for(var h=0;h<ydn.db.crud.req.WebSql.REQ_PER_TX&&h<b.length;h++)g(h,c);else this.logger.finest("success"),a.setDbValue([])};
ydn.db.crud.req.WebSql.prototype.clearByStores=function(a,b){var c=a.getTx(),d=this,e=function(c,g){var h=d.schema.getStore(b[c]),k="DELETE FROM  "+h.getQuotedName();d.logger.finest("SQL: "+k+" PARAMS: []");g.executeSql(k,[],function(g,h){c==b.length-1?(d.logger.finest("success "+k),a.setDbValue(b.length)):e(c+1,g)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);a.setDbValue(c,!0);return!1});for(var l=function(a){a=ydn.db.base.PREFIX_MULTIENTRY+h.getName()+":"+a.getName();a=
"DELETE FROM  "+goog.string.quote(a);d.logger.finest("SQL: "+a);g.executeSql(a,[])},m=0,n=h.countIndex();m<n;m++){var p=h.index(m);p.isMultiEntry()&&l(p)}};0<b.length?e(0,c):(this.logger.finest("success"),a.setDbValue(0))};
ydn.db.crud.req.WebSql.prototype.removeByKeys=function(a,b){var c=a.getTx(),d=this,e=0,f=!1,g=a.getLabel()+" removeByKeys: "+b.length+" keys";this.logger.finest(g);var h=function(g){if(g>=b.length)a.setDbValue(e,f);else{var l=d.schema.getStore(b[g].getStoreName()),m=ydn.db.schema.Index.js2sql(b[g].getId(),l.getType()),n=" WHERE "+l.getSQLKeyColumnNameQuoted()+" = ?",p="DELETE FROM "+l.getQuotedName()+n,q=a.getLabel()+" SQL: "+p+" PARAMS: "+[m];ydn.db.crud.req.WebSql.DEBUG&&window.console.log(q);c.executeSql(p,
[m],function(a,b){ydn.db.crud.req.WebSql.DEBUG&&window.console.log(b);e++;h(g)},function(a,b){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([a,b]);d.logger.warning("error: "+q+b.message);f=!0;h(g);return!1});g++;for(var p=function(b){b=ydn.db.base.PREFIX_MULTIENTRY+l.getName()+":"+b.getName();b="DELETE FROM  "+goog.string.quote(b)+n;d.logger.finest(a.getLabel()+NaN+b);c.executeSql(b,[m])},r=0,s=l.countIndex();r<s;r++){var t=l.index(r);t.isMultiEntry()&&p(t)}}};h(0)};
ydn.db.crud.req.WebSql.prototype.removeById=function(a,b,c){var d=a.getTx(),e=this.schema.getStore(b),f=ydn.db.schema.Index.js2sql(c,e.getType()),g=this,h=" WHERE "+e.getSQLKeyColumnNameQuoted()+" = ?";b="DELETE FROM "+e.getQuotedName()+h;c=a.getLabel()+" SQL: "+b+" PARAMS: "+[f];this.logger.finest(c);d.executeSql(b,[f],function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log(c);a.setDbValue(c.rowsAffected)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);a.setDbValue(c,
!0);return!1});b=function(b){b=ydn.db.base.PREFIX_MULTIENTRY+e.getName()+":"+b.getName();b="DELETE FROM  "+goog.string.quote(b)+h;g.logger.finest(a.getLabel()+NaN+b);d.executeSql(b,[f])};c=0;for(var k=e.countIndex();c<k;c++){var l=e.index(c);l.isMultiEntry()&&b(l)}};ydn.db.crud.req.WebSql.prototype.clearByKeyRange=function(a,b,c){this.clear_by_key_range_(a,b,void 0,c)};ydn.db.crud.req.WebSql.prototype.removeByKeyRange=function(a,b,c){this.clear_by_key_range_(a,b,void 0,c)};
ydn.db.crud.req.WebSql.prototype.removeByIndexKeyRange=function(a,b,c,d){this.clear_by_key_range_(a,b,c,d)};
ydn.db.crud.req.WebSql.prototype.clear_by_key_range_=function(a,b,c,d){var e=a.getTx(),f=this,g=this.schema.getStore(b);b="DELETE FROM "+g.getQuotedName();var h=[],k=[],l="";goog.isDefAndNotNull(d)&&(goog.isDef(c)?(c=g.getIndex(c),ydn.db.KeyRange.toSql(c.getSQLIndexColumnNameQuoted(),c.getType(),d,k,h)):ydn.db.KeyRange.toSql(g.getSQLKeyColumnNameQuoted(),g.getType(),d,k,h),l=" WHERE "+k.join(" AND "));b+=l;var m=a.getLabel()+" SQL: "+b+" PARAMS: "+h;this.logger.finest(m);e.executeSql(b,h,function(b,
c){f.logger.finest("success "+m);a.setDbValue(c.rowsAffected)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);f.logger.warning("error: "+m+c.message);a.setDbValue(c,!0);return!1});d=function(b){b=ydn.db.base.PREFIX_MULTIENTRY+g.getName()+":"+b.getName();b="DELETE FROM  "+goog.string.quote(b)+l;f.logger.finest(a.getLabel()+NaN+b);e.executeSql(b,k)};c=0;for(b=g.countIndex();c<b;c++)h=g.index(c),h.isMultiEntry()&&d(h)};
ydn.db.crud.req.WebSql.prototype.countStores=function(a,b){var c=a.getTx(),d=this,e=[],f=function(g){var h="SELECT COUNT(*) FROM "+goog.string.quote(b[g]);d.logger.finest("SQL: "+h+" PARAMS: []");c.executeSql(h,[],function(c,d){var h=d.rows.item(0);e[g]=parseInt(h["COUNT(*)"],10);g++;g==b.length?a.setDbValue(e):f(g)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);a.setDbValue(c,!0);return!1})};0==b.length?(this.logger.finest("success"),a.setDbValue(0)):f(0)};
ydn.db.crud.req.WebSql.prototype.countKeyRange=function(a,b,c,d,e){var f=[],g=this.schema.getStore(b).toSql(f,ydn.db.base.QueryMethod.COUNT,d,c,!1,e);b=a.getLabel()+" SQL: "+g+" PARAMS: "+f;this.logger.finest(b);a.getTx().executeSql(g,f,function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([g,c]);var d=c.rows.item(0);a.setDbValue(ydn.object.takeFirst(d))},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([g,c]);a.setDbValue(c,!0);return!1})};
ydn.db.crud.req.WebSql.prototype.list=function(a,b,c,d,e,f,g,h,k,l){var m=this,n=[],p=this.schema.getStore(c),q=p.getSQLKeyColumnName(),r=p.getType(),s=r,t=goog.isDefAndNotNull(d)&&d!==q?p.getIndex(d):null,u=d||q;t&&(s=t.getType());c=[];if(l&&goog.isDef(l[0])){var v=l[0];t&&goog.isDef(l[1])?(d=l[1],e=p.sqlContinueIndexEffectiveKey(b,c,t.getName(),e,v,!0,d,h,k)):e=p.sqlContinueEffectiveKey(b,c,d,e,h,k,v,!0)}else e=p.toSql(c,b,u,e,h,k);goog.isNumber(f)&&(e+=" LIMIT "+f);goog.isNumber(g)&&(e+=" OFFSET "+
g);var x=a+" SQL: "+e+" ;params= "+ydn.json.stringify(c);this.logger.finest(x);a.getTx().executeSql(e,c,function(c,d){var e=d.rows.length;ydn.db.crud.req.WebSql.DEBUG&&window.console.log(d);for(var f,g=0;g<e;g++)f=d.rows.item(g),ydn.db.crud.req.WebSql.DEBUG&&window.console.log(f),b==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?n[g]=ydn.db.schema.Index.sql2js(f[q],r):b==ydn.db.base.QueryMethod.LIST_KEY?n[g]=ydn.db.schema.Index.sql2js(f[u],s):b==ydn.db.base.QueryMethod.LIST_KEYS?n[g]=[ydn.db.schema.Index.sql2js(f[u],
s),ydn.db.schema.Index.sql2js(f[q],r)]:goog.isDefAndNotNull(f)&&(n[g]=ydn.db.crud.req.WebSql.parseRow(f,p));m.logger.finer("success "+a);l&&f&&(l[0]=ydn.db.schema.Index.sql2js(f[u],s),l[1]=ydn.db.schema.Index.sql2js(f[q],r));a.setDbValue(n)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&window.console.log([b,c]);m.logger.warning("error: "+x+c.message);a.setDbValue(c,!0);return!1})};ydn.db.core.req.WebSql=function(a,b){ydn.db.crud.req.WebSql.call(this,a,b)};goog.inherits(ydn.db.core.req.WebSql,ydn.db.crud.req.WebSql);ydn.db.core.req.WebSql.DEBUG=!1;ydn.db.core.req.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.core.req.WebSql");ydn.db.core.req.WebSql.prototype.getCursor=function(a,b,c,d){var e=this.schema.getStore(c);goog.asserts.assertObject(e,'store "'+c+'" not found.');return new ydn.db.core.req.WebsqlCursor(a,b,e,d)};
ydn.db.core.req.WebSql.prototype.getStreamer=function(a,b,c,d){throw"not yet";};ydn.db.core.Storage.inject_executor={};
ydn.db.core.Storage.prototype.newExecutor=function(){var a=this.getType();if(a==ydn.db.base.Mechanisms.IDB)return new ydn.db.core.req.IndexedDb(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.WEBSQL)return new ydn.db.core.req.WebSql(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.MEMORY_STORAGE||a==ydn.db.base.Mechanisms.LOCAL_STORAGE||a==ydn.db.base.Mechanisms.USER_DATA||a==ydn.db.base.Mechanisms.SESSION_STORAGE)return new ydn.db.core.req.SimpleStore(this.db_name,this.schema);throw new ydn.debug.error.InternalError("No executor for "+
a);};ydn.db.sql={};ydn.db.sql.req={};ydn.db.sql.req.IterableQuery=function(a,b,c,d,e,f,g,h){ydn.db.Iterator.call(this,a,b,c,d,e,f);this.finalize=this.reduce=this.map=this.initial=null;this.filter_fn=g||null;this.continued=h||null};goog.inherits(ydn.db.sql.req.IterableQuery,ydn.db.Iterator);
ydn.db.sql.req.IterableQuery.prototype.toJSON=function(){var a=ydn.db.sql.req.IterableQuery.superClass_.toJSON.call(this);a.initial=this.initial?this.initial.toString():null;a.map=this.map?this.map.toString():null;a.reduce=this.reduce?this.reduce.toString():null;a.finalize=this.finalize?this.finalize.toString():null;return a};ydn.db.sql.req.IterableQuery.prototype.initial=null;ydn.db.sql.req.IterableQuery.prototype.map=null;ydn.db.sql.req.IterableQuery.prototype.reduce=null;
ydn.db.sql.req.IterableQuery.prototype.finalize=null;ydn.db.sql.req.IterableQuery.prototype.toString=function(){var a=goog.isDef(this.getIndexName())?":"+this.getIndexName():"";return"Cursor:"+this.getStoreName()+a};
ydn.db.sql.req.IterableQuery.prototype.processWhereAsFilter=function(a){var b=goog.functions.TRUE;goog.isFunction(this.filter_fn)&&(b=this.filter_fn);this.filter_fn=function(c){var d=c[a.getField()],e=!0,f=a.getKeyRange();if(f){goog.isDefAndNotNull(f.lower)&&(e=f.lowerOpen?d<f.lower:d<=f.lower);var g=!0;goog.isDefAndNotNull(f.upper)&&(g=f.upperOpen?d>f.upper:d>=f.upper)}return b(c)&&e&&g}};ydn.db.sql.req.IdbQuery=function(a,b,c,d,e,f,g,h){ydn.db.sql.req.IterableQuery.call(this,a,b,c,d,e,f,g,h)};goog.inherits(ydn.db.sql.req.IdbQuery,ydn.db.sql.req.IterableQuery);ydn.db.sql.req.IdbQuery.Methods={OPEN:"op",COUNT:"cn"};ydn.db.sql.req.IdbQuery.prototype.method=ydn.db.sql.req.IdbQuery.Methods.OPEN;ydn.string={};ydn.string.split_comma_seperated=function(a){return a.match(/(?:"[^"]*"|[^,])+/g)};ydn.string.split_space_seperated=function(a){return a.match(/\w+|"[^"]+"/g)};ydn.string.split_space=function(a){return a.match(/[^\s"']+|"[^"]*"|'[^']*'/g)};ydn.string.normalizeEmail=function(a){if(!goog.isString(a)||!/[\w\+]+@\w+\.\w+/.test(a))return null;a=a.toLowerCase();return a=a.replace(/\+\w*?@/,"@")};ydn.math={};ydn.math.Expression=function(a){this.tokens=a};ydn.math.Expression.prototype.tokens=[];
ydn.math.Expression.prototype.evaluate=function(a,b){for(var c=[],d=0;d<this.tokens.length;d++){var e=this.tokens[d],f="'"===e[0]&&"'"===e[e.length-1];if('"'===e[0]&&'"'===e[e.length-1])e=goog.string.stripQuotes(e,'"').split("."),goog.asserts.assertObject(a),e=goog.object.getValueByKeys(a,e),c.push(e);else if(f)c.push(goog.string.stripQuotes(e,"'"));else if(goog.isString(e))if("true"===e)c.push(!0);else if("false"===e)c.push(!1);else if("Date"===e)c.push(new Date(parseInt(c.pop(),10)));else if("now"===
e)c.push(new Date);else if("!"===e)c[c.length-1]=!c[c.length-1];else if("=="===e)c.push(c.pop()==c.pop());else if("==="===e)c.push(c.pop()===c.pop());else if("!="===e)c.push(c.pop()!=c.pop());else if("!=="===e)c.push(c.pop()!==c.pop());else if("<="===e)c.push(c.pop()<=c.pop());else if("<"===e)c.push(c.pop()<c.pop());else if(">="===e)c.push(c.pop()>=c.pop());else if(">"===e)c.push(c.pop()>c.pop());else if("&"===e)c.push(c.pop()&c.pop());else if("|"===e)c.push(c.pop()|c.pop());else if("?"===e){var e=
!!c.pop(),f=c.pop(),g=c.pop(),e=e?f:g;c.push(e)}else"+"===e?c.push(c.pop()+c.pop()):"-"===e?c.push(c.pop()-c.pop()):"*"===e?c.push(c.pop()*c.pop()):"/"===e?c.push(c.pop()/c.pop()):"%"===e?c.push(c.pop()%c.pop()):"at"===e?(f=c.pop(),e=c.pop(),c.push(e[f])):"of"===e?(f=c.pop(),e=c.pop(),e=goog.isArray(e)?e.indexOf(f):-1,c.push(e)):"in"===e?(f=c.pop(),e=c.pop(),e=goog.isArray(e)?0<=e.indexOf(f):!1,c.push(e)):"abs"===e?c[c.length-1]=Math.abs(c[c.length-1]):"$"==e[0]&&/^\$\d$/.test(e)?(e=parseInt(e.match(/^\$(\d)$/)[1],
10),c.push(arguments[e])):c.push(parseFloat(e));else c.push(e)}return c[0]};ydn.math.Expression.prototype.compile=function(){return function(){var a=2<arguments.length?Array.prototype.slice(arguments,2):void 0;return ydn.math.Expression.prototype.evaluate.apply(null,a)}};ydn.math.Expression.prototype.toJSON=function(){return{Tokens:ydn.object.clone(this.tokens)}};ydn.math.Expression.parseRpn=function(a){return new ydn.math.Expression(ydn.string.split_space(a))};
ydn.math.Expression.parseInfix=function(a){throw new ydn.error.NotImplementedException("Too lazy to learn Dutch in Shunting Yard station, we speak Polish here.");};ydn.db.Sql=function(a){if(!goog.isString(a))throw new ydn.error.ArgumentException;this.sql_=a;this.mode_=ydn.db.base.TransactionMode.READ_WRITE;this.store_names_=[];this.parseBasic_(a);this.last_error_="";this.has_parsed_=!1};ydn.db.Sql.prototype.sql_="";ydn.db.Sql.prototype.limit_=NaN;ydn.db.Sql.prototype.offset_=NaN;ydn.db.Sql.prototype.reverse_=!1;ydn.db.Sql.prototype.last_error_="";ydn.db.Sql.prototype.has_parsed_=!1;
ydn.db.Sql.prototype.parseBasic_=function(a){var b=a.split(/\sFROM\s/i);if(2==b.length&&(a=b[1],b=b[0].match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i),3==b.length)){this.action_=b[1].toUpperCase();if("SELECT"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_ONLY;else if("INSERT"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;else if("UPDATE"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;else if("DELETE"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;
else return;var b=b[2].trim(),c=b.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);c?(this.aggregate_=c[0].toUpperCase(),b=b.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):this.aggregate_=void 0;"("==b.charAt(0)&&(")"==b.charAt(b.length-1)?b=b.substring(1,b.length-1):new ydn.db.SqlParseError("missing closing parentheses"));this.selList_=b;b=a.search(/(ORDER BY|LIMIT|OFFSET)/i);0<b?(this.modifier_=a.substring(b),a=a.substring(0,b)):this.modifier_="";b=a.search(/WHERE/i);0<b?(this.condition_=a.substring(b+6).trim(),
a=a.substring(0,b)):this.condition_="";this.store_names_=a.trim().split(",").map(function(a){a=goog.string.stripQuotes(a,'"');a=goog.string.stripQuotes(a,"'");return a.trim()});this.has_parsed_=!0}};
ydn.db.Sql.prototype.parse=function(a){if(a){for(var b=0;b<a.length;b++)this.sql_=this.sql_.replace("?",a[b]);this.parseBasic_(this.sql_)}this.wheres_=this.parseConditions();if(!this.wheres_)return this.last_error_;a=this.modifier_.length;if(b=/OFFSET\s+(\d+)/i.exec(this.modifier_))this.offset_=parseInt(b[1],10),a=this.modifier_.search(/OFFSET/i);if(b=/LIMIT\s+(\d+)/i.exec(this.modifier_))this.limit_=parseInt(b[1],10),b=this.modifier_.search(/LIMIT/i),b<a&&(a=b);a=this.modifier_.substr(0,a);(a=/ORDER BY\s+(.+)/i.exec(a))?
(a=a[1].trim(),(b=a.match(/(ASC|DESC)/i))?(this.reverse_="DESC"==b[0].toUpperCase(),a=a.replace(/\s+(ASC|DESC)/i,"")):this.reverse_=!1,this.order_=goog.string.stripQuotes(goog.string.stripQuotes(a,'"'),"'"),goog.asserts.assert(0<this.order_.length,"Invalid order by field")):this.order_=void 0;this.has_parsed_=!0;return""};ydn.db.Sql.prototype.getSelList=function(){if("*"==this.selList_)return null;var a=this.selList_.split(",");return a=a.map(function(a){return goog.string.stripQuotes(a.trim(),'"')})};
ydn.db.Sql.prototype.getSql=function(){return this.sql_};ydn.db.Sql.prototype.toJSON=function(){return{sql:this.sql_}};ydn.db.Sql.prototype.getStoreNames=function(){return goog.array.clone(this.store_names_)};ydn.db.Sql.prototype.getMode=function(){return this.mode_};ydn.db.Sql.prototype.getLimit=function(){return this.limit_};ydn.db.Sql.prototype.getOffset=function(){return this.offset_};ydn.db.Sql.prototype.getOrderBy=function(){return this.order_};ydn.db.Sql.prototype.isReversed=function(){return this.reverse_};
ydn.db.Sql.prototype.getConditions=function(){return this.wheres_};
ydn.db.Sql.prototype.parseConditions=function(){var a=[],b=/(.+?)(<=|>=|=|>|<)(.+)/i,c=function(b){return goog.array.findIndex(a,function(a){return a.getField()==b})};if(0<this.condition_.length)for(var d=this.condition_.split("AND"),e=0;e<d.length;e++){var f=d[e],g=b.exec(f);if(g){var h=g[1].trim(),h=goog.string.stripQuotes(h,'"'),h=goog.string.stripQuotes(h,"'");if(0<h.length){var k=g[3].trim(),k=goog.string.startsWith(k,'"')?goog.string.stripQuotes(k,'"'):goog.string.startsWith(k,"'")?goog.string.stripQuotes(k,
"'"):parseFloat(k),g=new ydn.db.Where(h,g[2],k),h=c(h);if(0<=h){if(a[h]=a[h].and(g),!a[h])return this.last_error_='where clause "'+f+'" conflict',null}else a.push(g)}else return this.last_error_='Invalid clause "'+f+'"',null}else return this.last_error_='Invalid clause "'+f+'"',null}return a};ydn.db.Sql.prototype.getAction=function(){return this.action_};ydn.db.Sql.prototype.toString=function(){return goog.DEBUG?"query:"+this.sql_:ydn.db.Sql.superClass_.toString.call(this)};
ydn.db.Sql.prototype.getAggregate=function(){return this.aggregate_};ydn.db.sql.req.IRequestExecutor=function(){};ydn.db.sql.IStorage=function(){};ydn.db.sql.req.nosql={};ydn.db.sql.req.nosql.Node=function(a,b){this.sql=b;this.store_schema=a};ydn.db.sql.req.nosql.Node.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.nosql.Node");ydn.db.sql.req.nosql.Node.prototype.toJSON=function(){return{sql:this.sql}};ydn.db.sql.req.nosql.Node.prototype.toString=function(){return"idb.Node:"};
ydn.db.sql.req.nosql.Node.prototype.execute=function(a,b){var c=this.sql.getStoreNames()[0],d=this.sql.getConditions(),e=this.sql.getLimit(),e=isNaN(e)?ydn.db.base.DEFAULT_RESULT_LIMIT:e,f=this.sql.getOffset(),f=isNaN(f)?0:f,g=this.sql.getOrderBy(),h=this.sql.getSelList(),k=null,l=this.sql.isReversed();if(0==d.length)k=null;else if(1==d.length)k=ydn.db.KeyRange.parseIDBKeyRange(d[0].getKeyRange());else throw new ydn.debug.error.NotSupportedException("too many conditions.");goog.isNull(h)||a.await(function(a,
b,c){var d=a;b||(d=a.map(function(a){var b=h.length;if(1==b)return ydn.db.utils.getValueByKeys(a,h[0]);for(var c={},d=0;d<b;d++)c[h[d]]=ydn.db.utils.getValueByKeys(a,h[d]);return c}));c(d,b)});var d=0<d.length?d[0].getField():void 0,m=a.getLabel()+" executing on"+c;d&&(m+=":"+d);m+=" "+ydn.db.KeyRange.toString(k);this.logger.finer(m);g&&g!=this.store_schema.getKeyPath()?b.list(a,ydn.db.base.QueryMethod.LIST_VALUE,c,g,k,e,f,l,!1):goog.isDef(d)&&d!=this.store_schema.getKeyPath()?b.list(a,ydn.db.base.QueryMethod.LIST_VALUE,
c,d,k,e,f,l,!1):b.list(a,ydn.db.base.QueryMethod.LIST_VALUE,c,null,k,e,f,l,!1)};ydn.db.sql.req.nosql.ReduceNode=function(a,b){ydn.db.sql.req.nosql.Node.call(this,a,b)};goog.inherits(ydn.db.sql.req.nosql.ReduceNode,ydn.db.sql.req.nosql.Node);
ydn.db.sql.req.nosql.ReduceNode.prototype.execute=function(a,b){var c,d=this.sql.getStoreNames()[0],e=this.sql.getConditions(),f=null;this.sql.isReversed();if(0==e.length)f=null;else if(1==e.length)f=ydn.db.KeyRange.parseIDBKeyRange(e[0].getKeyRange());else throw new ydn.debug.error.NotSupportedException("too many conditions.");var g=this.sql.getAggregate(),e=0<e.length?e[0].getField():void 0,h=a.getLabel()+" executing "+g+" on "+d;e&&(h+=":"+e);h+=" "+ydn.db.KeyRange.toString(f);this.logger.finer(h);
if("COUNT"==g)f?b.countKeyRange(a,d,f,e,!1):b.countKeyRange(a,d,null,void 0,!1);else{var k,h=this.sql.getSelList();if(!h||0==h.length)throw new ydn.error.InvalidOperationError("field name require for reduce operation: "+g);h=h[0];if("MIN"==g)k=ydn.db.sql.req.nosql.ReduceNode.reduceMin(h);else if("MAX"==g)k=ydn.db.sql.req.nosql.ReduceNode.reduceMax(h);else if("AVG"==g)c=0,k=ydn.db.sql.req.nosql.ReduceNode.reduceAverage(h);else if("SUM"==g)c=0,k=ydn.db.sql.req.nosql.ReduceNode.reduceSum(h);else throw new ydn.error.NotSupportedException(g);
var l;l=goog.isDef(e)?new ydn.db.IndexValueIterator(d,e,f):new ydn.db.ValueIterator(d,f);var d=b.getCursor(a.getTx(),a.getLabel(),d,ydn.db.base.QueryMethod.LIST_VALUE),m=l.load([d]);m.onFail=function(b){a.setDbValue(b,!0)};var n=0;m.onNext=function(b){goog.isDefAndNotNull(b)?(b=l.isKeyIterator()?m.getPrimaryKey():m.getValue(),c=k(b,c,n),m.advance(1),n++):a.setDbValue(c)}}};ydn.db.sql.req.nosql.ReduceNode.reduceAverage=function(a){return function(b,c,d){goog.isDef(c)||(c=0);return(c*d+b[a])/(d+1)}};
ydn.db.sql.req.nosql.ReduceNode.reduceSum=function(a){return function(b,c,d){return c+b[a]}};ydn.db.sql.req.nosql.ReduceNode.reduceMin=function(a){return function(b,c,d){b=b[a];return goog.isDef(c)?c<b?c:b:b}};ydn.db.sql.req.nosql.ReduceNode.reduceMax=function(a){return function(b,c,d){b=b[a];return goog.isDef(c)?c>b?c:b:b}};ydn.db.sql.req.IndexedDb=function(a,b){ydn.db.core.req.IndexedDb.call(this,a,b)};goog.inherits(ydn.db.sql.req.IndexedDb,ydn.db.core.req.IndexedDb);ydn.db.sql.req.IndexedDb.DEBUG=!1;ydn.db.sql.req.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.IndexedDb");
ydn.db.sql.req.IndexedDb.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new ydn.db.SqlParseError(c);c=b.getStoreNames();if(1==c.length){var d=this.schema.getStore(c[0]);if(!d)throw new ydn.db.NotFoundError(c[0]);var e=b.getSelList();if(e)for(var f=0;f<e.length;f++)if(!d.hasIndex(e[f]))throw new ydn.db.NotFoundError('Index "'+e[f]+'" not found in '+c[0]);(b.getAggregate()?new ydn.db.sql.req.nosql.ReduceNode(d,b):new ydn.db.sql.req.nosql.Node(d,b)).execute(a,this)}else throw new ydn.error.NotSupportedException(b.getSql());
};ydn.db.sql.req.SqlQuery=function(a,b,c,d,e,f,g,h){ydn.db.sql.req.IterableQuery.call(this,a,b,c,d,e,f,g,h);this.parseRow=ydn.db.sql.req.SqlQuery.prototype.parseRow;this.sql="";this.params=[]};goog.inherits(ydn.db.sql.req.SqlQuery,ydn.db.sql.req.IterableQuery);ydn.db.sql.req.SqlQuery.prototype.toJSON=function(){var a=ydn.db.sql.req.SqlQuery.superClass_.toJSON.call(this);a.sql=this.sql;a.params=ydn.object.clone(this.params);return a};ydn.db.sql.req.SqlQuery.prototype.sql="";
ydn.db.sql.req.SqlQuery.prototype.params=[];ydn.db.sql.req.SqlQuery.prototype.toString=function(){var a=goog.isDef(this.getIndexName())?":"+this.getIndexName():"";return"Cursor:"+this.getStoreName()+a};ydn.db.sql.req.SqlQuery.prototype.parseRow=function(a,b){return ydn.db.crud.req.WebSql.parseRow(a,b)};ydn.db.sql.req.SqlQuery.parseRowIdentity=function(a,b){return a};ydn.db.sql.req.websql={};ydn.db.sql.req.websql.Node=function(a,b){this.sql=b;this.store_schema_=a;this.sel_fields_=b.getSelList()};ydn.db.sql.req.websql.Node.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.websql.Node");ydn.db.sql.req.websql.Node.prototype.toJSON=function(){return{sql:this.sql.getSql()}};ydn.db.sql.req.websql.Node.prototype.toString=function(){return"websql.Node:"};
ydn.db.sql.req.websql.Node.prototype.parseRow=function(a){if(this.sel_fields_){if(1==this.sel_fields_.length){if(goog.isObject(a))return goog.object.getValueByKeys(a,this.sel_fields_[0]);return}for(var b={},c=0;c<this.sel_fields_.length;c++)b[this.sel_fields_[c]]=goog.object.getValueByKeys(a,this.sel_fields_[c]);return b}return ydn.db.crud.req.WebSql.parseRow(a,this.store_schema_)};
ydn.db.sql.req.websql.Node.prototype.execute=function(a,b,c){var d=this.sql.getSql(),e=this,f=[];ydn.db.sql.req.WebSql.DEBUG&&window.console.log(this+" open SQL: "+d+" PARAMS:"+ydn.json.stringify(c));b.executeSql(d,c,function(b,c){for(var d=c.rows.length,l=0;l<d;l++){var m=c.rows.item(l);if(goog.isObject(m))var n=e.parseRow(m);f.push(n)}a(f)},function(b,c){ydn.db.sql.req.WebSql.DEBUG&&window.console.log([d,b,c]);e.logger.warning("Sqlite error: "+c.message);a(c,!0);return!0})};ydn.db.sql.req.websql.ReduceNode=function(a,b){ydn.db.sql.req.websql.Node.call(this,a,b)};goog.inherits(ydn.db.sql.req.websql.ReduceNode,ydn.db.sql.req.websql.Node);
ydn.db.sql.req.websql.ReduceNode.prototype.execute=function(a,b,c){var d=this.sql.getSql(),e=this;ydn.db.sql.req.WebSql.DEBUG&&window.console.log(this+" open SQL: "+d+" PARAMS:"+ydn.json.stringify(c));b.executeSql(d,c,function(b,c){var d=c.rows.length;if(1==d)d=ydn.object.takeFirst(c.rows.item(0)),a(d);else if(0==d)a(void 0);else throw new ydn.db.InternalError;},function(b,c){ydn.db.sql.req.WebSql.DEBUG&&window.console.log([d,b,c]);e.logger.warning("Sqlite error: "+c.message);a(c,!0);return!0})};ydn.db.sql.req.WebSql=function(a,b){ydn.db.core.req.WebSql.call(this,a,b)};goog.inherits(ydn.db.sql.req.WebSql,ydn.db.core.req.WebSql);ydn.db.sql.req.WebSql.DEBUG=!1;ydn.db.sql.req.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.WebSql");
ydn.db.sql.req.WebSql.prototype.executeSql=function(a,b,c){var d=b.getStoreNames();if(1==d.length){var e=this.schema.getStore(d[0]);if(!e)throw new ydn.db.NotFoundError(d[0]);var f=b.getSelList();if(f)for(var g=0;g<f.length;g++)if(!e.hasIndex(f[g]))throw new ydn.db.NotFoundError('Index "'+f[g]+'" not found in '+d[0]);(b.getAggregate()?new ydn.db.sql.req.websql.ReduceNode(e,b):new ydn.db.sql.req.websql.Node(e,b)).execute(function(b,c){a.setDbValue(b,c)},a.getTx(),c)}else throw new ydn.error.NotSupportedException(b.getSql());
};
ydn.db.sql.req.WebSql.prototype.planQuery=function(a){var b=this.schema.getStore(a.getStoreName());if(!b)throw new ydn.db.SqlParseError("TABLE: "+a.getStoreName()+" not found.");var c=a.getKeyRange(),d=new ydn.db.sql.req.SqlQuery(a.getStoreName(),a.getIndexName(),c,a.isReversed(),a.isUnique(),a.isKeyIterator()),e=d.getIndexName(),e=(e=goog.isDef(e)?b.getIndex(e):null)?e.getKeyPath():goog.isDefAndNotNull(b.keyPath)?b.keyPath:ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;goog.asserts.assertString(e);var e=goog.string.quote(e),
b=(a.isKeyIterator()?e:"*")+" FROM "+b.getQuotedName(),f="";c&&(ydn.db.Where.resolvedStartsWith(c)?(f=e+" LIKE ?",d.params.push(c.lower+"%")):(goog.isDefAndNotNull(c.lower)&&(f+=" "+e+(c.lowerOpen?" > ":" >= ")+"?",d.params.push(c.lower)),goog.isDefAndNotNull(c.upper)&&(f+=(0<f.length?" AND ":" ")+e+(c.upperOpen?" < ":" <= ")+"?",d.params.push(c.upper))),f=" WHERE ("+f+")");c="ASC";a.isReversed()&&(c="DESC");d.sql=["SELECT",b,f,"ORDER BY "+e,c].join(" ");return d};ydn.db.sql.req.SimpleStore=function(a,b){ydn.db.core.req.SimpleStore.call(this,a,b)};goog.inherits(ydn.db.sql.req.SimpleStore,ydn.db.core.req.SimpleStore);ydn.db.sql.req.SimpleStore.DEBUG=!1;ydn.db.sql.req.SimpleStore.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sql.req.SimpleStore");
ydn.db.sql.req.SimpleStore.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new ydn.db.SqlParseError(c);c=b.getStoreNames();if(1==c.length){var d=this.schema.getStore(c[0]);if(!d)throw new ydn.db.NotFoundError(c[0]);var e=b.getSelList();if(e)for(var f=0;f<e.length;f++)if(!d.hasIndex(e[f]))throw new ydn.debug.error.ArgumentException('Index "'+e[f]+'" not found in '+c[0]);(b.getAggregate()?new ydn.db.sql.req.nosql.ReduceNode(d,b):new ydn.db.sql.req.nosql.Node(d,b)).execute(a,this)}else throw new ydn.debug.error.NotSupportedException(b.getSql());
};ydn.db.sql.DbOperator=function(a,b,c,d){ydn.db.core.DbOperator.call(this,a,b,c,d)};goog.inherits(ydn.db.sql.DbOperator,ydn.db.core.DbOperator);
ydn.db.sql.DbOperator.prototype.executeSql=function(a,b){for(var c=new ydn.db.Sql(a),d=c.getStoreNames(),e=0;e<d.length;e++){var f=this.schema.getStore(d[e]);if(!f)throw new ydn.debug.error.ArgumentException("store: "+f+" not exists.");}this.logger.finer("executeSql: "+a+" params: "+b);var g=this.tx_thread.request(ydn.db.Request.Method.SQL,c.getStoreNames(),c.getMode());g.addTxback(function(){this.getExecutor().executeSql(g,c,b||[])},this);return g};ydn.db.sql.Storage=function(a,b,c){ydn.db.core.Storage.call(this,a,b,c)};goog.inherits(ydn.db.sql.Storage,ydn.db.core.Storage);ydn.db.sql.Storage.prototype.newOperator=function(a,b){return new ydn.db.sql.DbOperator(this,this.schema,a,b)};ydn.db.sql.Storage.prototype.getSqlOperator=function(){return this.db_operator};ydn.db.sql.Storage.prototype.executeSql=function(a,b){return this.getSqlOperator().executeSql(a,b)};ydn.db.sql.Storage.inject={};
ydn.db.sql.Storage.prototype.newExecutor=function(){var a=this.getType();if(a==ydn.db.base.Mechanisms.IDB)return new ydn.db.sql.req.IndexedDb(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.WEBSQL)return new ydn.db.sql.req.WebSql(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.MEMORY_STORAGE||a==ydn.db.base.Mechanisms.LOCAL_STORAGE||a==ydn.db.base.Mechanisms.SESSION_STORAGE)return new ydn.db.sql.req.SimpleStore(this.db_name,this.schema);throw new ydn.debug.error.InternalError("No executor for "+a);
};ydn.db.con.IndexedDb=function(a,b){goog.isDef(a)&&5242880<a&&this.logger.warning("storage size request ignored, use Quota Management API instead");this.idx_db_=null;this.time_out_=b||NaN};
ydn.db.con.IndexedDb.prototype.connect=function(a,b){var c=this,d=new goog.async.Deferred,e=void 0,f=function(a,b){d.hasFired()?c.logger.warning("database already set."):goog.isDef(b)?(c.logger.warning(b?b.message:"Error received."),c.idx_db_=null,d.errback(b)):(goog.asserts.assertObject(a,"db"),c.idx_db_=a,c.idx_db_.onabort=function(a){c.logger.finest(c+": abort");c.onError(a.target.error)},c.idx_db_.onerror=function(a){ydn.db.con.IndexedDb.DEBUG&&window.console.log(a);c.logger.finest(c+": error");
c.onError(a.target.error)},c.idx_db_.onversionchange=function(a){ydn.db.con.IndexedDb.DEBUG&&window.console.log([this,a]);c.logger.finest(c+" closing connection for onversionchange to: "+a.version);if(c.idx_db_&&(c.idx_db_.onabort=null,c.idx_db_.onblocked=null,c.idx_db_.onerror=null,c.idx_db_.onversionchange=null,c.onVersionChange(a),!a.defaultPrevented)){c.idx_db_.close();c.idx_db_=null;var b=Error();b.name=a.type;c.onFail(b)}},d.callback(parseFloat(e)))},g=function(a,d,f){c.logger.finer((f?"changing":
"upgrading")+" version to "+a.version+" from "+e);for(f=0;f<b.stores.length;f++)c.update_store_(a,d,b.stores[f]);d=a.objectStoreNames;var g=d.length;for(f=0;f<g;f++)b.hasStore(d[f])||(a.deleteObjectStore(d[f]),c.logger.finer("store: "+d[f]+" deleted."))},h=b.getVersion();c.logger.finer("Opening database: "+a+" ver: "+(b.isAutoVersion()?"auto":h));var k;k=goog.isDef(h)?ydn.db.base.indexedDb.open(a,h):ydn.db.base.indexedDb.open(a);k.onsuccess=function(d){var h=d.target.result;goog.isDef(e)||(e=h.version);
c.logger.finer("Database: "+h.name+", ver: "+h.version+" opened.");if(b.isAutoVersion())c.getSchema(function(d){if(b instanceof ydn.db.schema.EditableDatabase)for(var e=0;e<d.stores.length;e++)b.hasStore(d.stores[e].getName())||b.addStore(d.stores[e].clone());d=b.difference(d,!1,!0);if(0<d.length){c.logger.finer("Schema change require for difference in "+d);var k=goog.isNumber(h.version)?h.version+1:1;if("IDBOpenDBRequest"in goog.global){h.close();var l=ydn.db.base.indexedDb.open(a,k);l.onupgradeneeded=
function(a){a=a.target.result;c.logger.finer("re-open for version "+a.version);g(a,l.transaction,!1)};l.onsuccess=function(a){f(a.target.result)};l.onerror=function(a){c.logger.finer(c+": fail.");f(null)}}else{var n=h.setVersion(k+"");n.onfailure=function(a){c.logger.warning("migrating from "+h.version+" to "+k+" failed.");f(null,a)};n.onsuccess=function(a){n.transaction.oncomplete=u;g(h,n.transaction,!0)};var u=function(b){b=ydn.db.base.indexedDb.open(a);b.onsuccess=function(a){a=a.target.result;
c.logger.finer(c+": OK.");f(a)};b.onerror=function(a){c.logger.finer(c+": fail.");f(null)}};goog.isDefAndNotNull(n.transaction)&&(n.transaction.oncomplete=u)}}else f(h)},void 0,h);else if(b.getVersion()>h.version){goog.asserts.assertFunction(h.setVersion,"Expecting IDBDatabase in old format");d=b.getVersion();var k=h.setVersion(d);k.onfailure=function(a){c.logger.warning("migrating from "+h.version+" to "+b.getVersion()+" failed.");f(null,a)};k.onsuccess=function(a){g(h,k.transaction,!0)}}else b.getVersion()==
h.version?c.logger.finer("database version "+h.version+" ready to go"):c.logger.warning("connected database version "+h.version+" is higher than requested version."),c.getSchema(function(a){a=b.difference(a,!1,!0);0<a.length?(c.logger.finer(a),f(null,new ydn.error.ConstraintError("different schema: "+a))):f(h)},void 0,h)};k.onupgradeneeded=function(a){a=a.target.result;e=NaN;c.logger.finer("upgrade needed for version "+a.version);g(a,k.transaction,!1)};k.onerror=function(d){var e=goog.isDef(b.version)?
" with version "+b.version:"",e='open request to database "'+a+'" '+e+" cause error of "+k.error.name;ydn.db.con.IndexedDb.DEBUG&&window.console.log([d,k]);c.logger.severe(e);f(null,d)};k.onblocked=function(d){ydn.db.con.IndexedDb.DEBUG&&window.console.log([d,k]);c.logger.severe("database "+a+" "+b.version+" block, close other connections.");f(null,d)};goog.isNumber(this.time_out_)&&!isNaN(this.time_out_)&&setTimeout(function(){"done"!=k.readyState&&(c.logger.severe(c+": database state is still "+
k.readyState),f(null,new ydn.db.TimeoutError("connection timeout after "+c.time_out_)))},this.time_out_);return d};ydn.db.con.IndexedDb.DEBUG=!1;ydn.db.con.IndexedDb.isSupported=function(){return!!ydn.db.base.indexedDb};ydn.db.con.IndexedDb.prototype.time_out_=18E4;ydn.db.con.IndexedDb.prototype.onFail=function(a){};ydn.db.con.IndexedDb.prototype.onError=function(a){};ydn.db.con.IndexedDb.prototype.onVersionChange=function(a){};ydn.db.con.IndexedDb.prototype.getType=function(){return ydn.db.base.Mechanisms.IDB};
ydn.db.con.IndexedDb.prototype.getDbInstance=function(){return this.idx_db_||null};ydn.db.con.IndexedDb.prototype.isReady=function(){return!!this.idx_db_};ydn.db.con.IndexedDb.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.IndexedDb");ydn.db.con.IndexedDb.prototype.idx_db_=null;ydn.db.con.IndexedDb.prototype.getVersion=function(){return this.idx_db_?parseFloat(this.idx_db_.version):void 0};
ydn.db.con.IndexedDb.prototype.getSchema=function(a,b,c){c=c||this.idx_db_;var d=ydn.db.base.TransactionMode.READ_ONLY;if(goog.isDef(b)){if(goog.isNull(b)){if(0==c.objectStoreNames.length){a(new ydn.db.schema.Database(c.version));return}throw new ydn.error.InternalError;}c=b.db}else{b=[];for(var e=c.objectStoreNames.length-1;0<=e;e--)b[e]=c.objectStoreNames[e];if(0==b.length){a(new ydn.db.schema.Database(c.version));return}b=c.transaction(b,d)}for(var d=c.objectStoreNames,f=[],g=d.length,e=0;e<g;e++){for(var h=
b.objectStore(d[e]),k=[],l=0,m=h.indexNames.length;l<m;l++){var n=h.index(h.indexNames[l]);k[l]=new ydn.db.schema.Index(n.keyPath,void 0,n.unique,n.multiEntry,n.name)}f[e]=new ydn.db.schema.Store(h.name,h.keyPath,h.autoIncrement,void 0,k)}b=new ydn.db.schema.Database(c.version,f);a(b)};
ydn.db.con.IndexedDb.prototype.update_store_=function(a,b,c){this.logger.finest("Creating Object Store for "+c.getName()+" keyPath: "+c.getKeyPath());var d=function(){var b={autoIncrement:!!c.isAutoIncrement()};goog.isDefAndNotNull(c.getKeyPath())&&(b.keyPath=c.getKeyPath());return a.createObjectStore(c.getName(),b)};if(a.objectStoreNames.contains(c.getName())){b=b.objectStore(c.getName());var e=c.getKeyPath()||"";if(ydn.db.schema.Index.compareKeyPath(e,b.keyPath||""))a.deleteObjectStore(c.getName()),
this.logger.warning("store: "+c.getName()+" deleted due to keyPath change."),b=d();else if(goog.isBoolean(b.autoIncrement)&&goog.isBoolean(c.isAutoIncrement())&&b.autoIncrement!=c.isAutoIncrement())a.deleteObjectStore(c.getName()),this.logger.warning("store: "+c.getName()+" deleted due to autoIncrement change."),b=d();else{for(var d=b.indexNames,f=e=0,g=0,h=0;h<c.countIndex();h++){var k=c.index(h),l=!1;if(d.contains(k.getName())){var m=b.index(k.getName()),n=goog.isDefAndNotNull(m.unique)&&goog.isDefAndNotNull(k.unique)&&
m.unique!=k.unique,p=goog.isDefAndNotNull(m.multiEntry)&&goog.isDefAndNotNull(k.multiEntry)&&m.multiEntry!=k.multiEntry,m=goog.isDefAndNotNull(m.keyPath)&&goog.isDefAndNotNull(k.keyPath)&&!!ydn.db.schema.Index.compareKeyPath(m.keyPath,k.keyPath);if(n||p||m)b.deleteIndex(k.getName()),l=!0,e--,g++}else k.getType()!=ydn.db.schema.DataType.BLOB&&(l=!0);l&&(k.unique||k.multiEntry?(l={unique:k.unique,multiEntry:k.multiEntry},b.createIndex(k.getName(),k.keyPath,l)):b.createIndex(k.getName(),k.keyPath),e++)}for(h=
0;h<d.length;h++)c.hasIndex(d[h])||(b.deleteIndex(d[h]),f++);this.logger.finest("Updated store: "+b.name+", "+e+" index created, "+f+" index deleted, "+g+" modified.")}}else{b=d();for(h=0;h<c.countIndex();h++)k=c.index(h),k.getType()==ydn.db.schema.DataType.BLOB?this.logger.info("Index "+k+" of blob data type ignored."):(this.logger.finest("Creating index: "+k),k.unique||k.multiEntry?(l={unique:k.unique,multiEntry:k.multiEntry},b.createIndex(k.getName(),k.keyPath,l)):b.createIndex(k.getName(),k.keyPath));
this.logger.finest("Created store: "+b)}};ydn.db.con.IndexedDb.prototype.doTransaction=function(a,b,c,d){var e=this.idx_db_;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(null):(b=e.transaction(b,c),b.oncomplete=function(a){d(ydn.db.base.TxEventTypes.COMPLETE,a)},b.onabort=function(a){d(ydn.db.base.TxEventTypes.ABORT,a)},a(b),a=null)};ydn.db.con.IndexedDb.prototype.close=function(){this.logger.finest(this+" closing connection");this.idx_db_.close()};
goog.DEBUG&&(ydn.db.con.IndexedDb.prototype.toString=function(){return"IndexedDB:"+(this.idx_db_?this.idx_db_.name+":"+this.idx_db_.version:"")},ydn.db.con.IndexedDb.deleteAllDatabases=function(){goog.global.indexedDB.webkitGetDatabaseNames().onsuccess=function(a){a=a.target.result;for(var b=0;b<a.length;b++)window.console.info("deleting "+a[b]),ydn.db.base.indexedDb.deleteDatabase(a[b])}});
ydn.db.con.IndexedDb.deleteDatabase=function(a,b){if(!ydn.db.base.indexedDb||b&&b!=ydn.db.base.Mechanisms.IDB)return null;var c=ydn.db.base.indexedDb.deleteDatabase(a),d=new ydn.db.Request(ydn.db.Request.Method.VERSION_CHANGE);c.onblocked=function(a){d.notify(a)};c.onerror=function(a){d.errback(a)};c.onsuccess=function(a){d.callback(a)};return d};ydn.db.databaseDeletors.push(ydn.db.con.IndexedDb.deleteDatabase);ydn.db.con.SimpleStorage=function(a){ydn.db.con.SimpleStorageService.call(this,a);this.version_=NaN};goog.inherits(ydn.db.con.SimpleStorage,ydn.db.con.SimpleStorageService);ydn.db.con.SimpleStorage.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.SimpleStorage");ydn.db.con.SimpleStorage.isSupported=function(){return!0};ydn.db.con.SimpleStorage.DEBUG=!1;ydn.db.con.SimpleStorage.prototype.getVersion=function(){return this.version_};
ydn.db.con.SimpleStorage.prototype.connect=function(a,b){var c=this,d=new goog.async.Deferred,e=function(a,b){setTimeout(function(){b?(c.logger.finer(c+" opening fail"),d.errback(b)):(c.logger.finer(c+" version "+c.getVersion()+" open"),d.callback(a))},10)};this.storage_=this.provider_.connectDb(a);this.dbname=a;this.schema=b;var f=ydn.db.con.simple.makeKey(this.dbname);this.version_=NaN;var g=ydn.json.parse(this.storage_.getItem(f));goog.isDef(g.version)&&!goog.isNumber(g.version)&&(g.version=NaN);
if(g)if(g=new ydn.db.schema.Database(g),this.schema.difference(g,!1,!1))if(!this.schema.isAutoVersion()&&!isNaN(g.getVersion())&&this.schema.getVersion()>g.getVersion())f=goog.DEBUG?"existing version "+g.getVersion()+" is larger than "+this.schema.getVersion():"",e(NaN,new ydn.db.VersionError(f));else{var h=this.schema.getVersion();this.version_=goog.isDef(h)?h:g.getVersion()+1;for(h=0;h<this.schema.count();h++)var k=this.schema.store(h);if(this.schema instanceof ydn.db.schema.EditableDatabase)for(h=
0;h<g.count();h++)k=g.store(h),goog.asserts.assert(!goog.isNull(k),"store at "+h+" is null"),this.schema.addStore(k);h=this.schema.toJSON();h.version=this.version_||NaN;this.storage_.setItem(f,ydn.json.stringify(h));e(g.getVersion()||NaN)}else{for(h=0;h<this.schema.count();h++)k=this.schema.store(h);this.version_=g.getVersion()||NaN;e(this.version_)}else g=b.toJSON(),this.version_=1,g.version=this.version_,this.storage_.setItem(f,ydn.json.stringify(g)),e(NaN);return d};
ydn.db.con.SimpleStorage.prototype.isReady=function(){return!!this.dbname};ydn.db.con.SimpleStorage.prototype.getDbInstance=function(){return this.storage_||null};ydn.db.con.SimpleStorage.prototype.onFail=function(a){};ydn.db.con.SimpleStorage.prototype.onError=function(a){};ydn.db.con.SimpleStorage.prototype.onVersionChange=function(a){};ydn.db.con.SimpleStorage.prototype.getType=function(){return"memory"};ydn.db.con.SimpleStorage.prototype.close=function(){};
ydn.db.con.SimpleStorage.prototype.doTransaction=function(a,b,c,d){b=new ydn.db.con.simple.TxStorage(this,function(a,b){d(a,b)});a(b)};goog.DEBUG&&(ydn.db.con.SimpleStorage.prototype.toString=function(){var a=this.dbname+":"+this.version_;return"SimpleStorage:"+this.getType()+":"+a});ydn.db.con.LocalStorage=function(){ydn.db.con.SimpleStorage.call(this,this)};goog.inherits(ydn.db.con.LocalStorage,ydn.db.con.SimpleStorage);ydn.db.con.LocalStorage.prototype.connectDb=function(a){goog.asserts.assertObject(window.localStorage);return window.localStorage};ydn.db.con.LocalStorage.isSupported=function(){return!!window.localStorage};ydn.db.con.LocalStorage.prototype.getType=function(){return ydn.db.base.Mechanisms.LOCAL_STORAGE};
ydn.db.con.LocalStorage.deleteDatabase=function(a,b){if(!b||b==ydn.db.base.Mechanisms.LOCAL_STORAGE){var c=new ydn.db.con.LocalStorage,d=new ydn.db.schema.EditableDatabase;c.connect(a,d);c.getSchema(function(a){for(var b=0;b<a.stores.length;b++)c.getSimpleStore(a.stores[b].getName()).clear()})}};ydn.db.databaseDeletors.push(ydn.db.con.LocalStorage.deleteDatabase);ydn.db.con.SessionStorage=function(){ydn.db.con.SimpleStorage.call(this,this)};goog.inherits(ydn.db.con.SessionStorage,ydn.db.con.SimpleStorage);
ydn.db.con.SessionStorage.prototype.connectDb=function(a){goog.asserts.assertObject(window.sessionStorage);return window.sessionStorage};ydn.db.con.SessionStorage.isSupported=function(){return!!window.sessionStorage};ydn.db.con.SessionStorage.prototype.getType=function(){return ydn.db.base.Mechanisms.SESSION_STORAGE};
ydn.db.con.SessionStorage.deleteDatabase=function(a,b){if(!b||b==ydn.db.base.Mechanisms.SESSION_STORAGE){var c=new ydn.db.con.SessionStorage,d=new ydn.db.schema.EditableDatabase;c.connect(a,d);c.getSchema(function(a){for(var b=0;b<a.stores.length;b++)c.getSimpleStore(a.stores[b].getName()).clear()})}};ydn.db.databaseDeletors.push(ydn.db.con.SessionStorage.deleteDatabase);ydn.db.con.WebSql=function(a){this.size_=goog.isDef(a)?a:4194304};
ydn.db.con.WebSql.prototype.connect=function(a,b){var c=this,d=NaN,e=new goog.async.Deferred,f=function(a,b){goog.isDef(b)?(c.sql_db_=null,e.errback(b)):(c.sql_db_=a,e.callback(parseFloat(d)))},g=function(b,d,e){var g=e?"changing version":"setting version",h=b.version?parseInt(b.version,10):0,k=d.isAutoVersion()?e?isNaN(h)?1:h+1:h:d.version;c.logger.fine(a+": "+g+" from "+b.version+" to "+k);var l=!1,u=0;b.changeVersion(b.version,k+"",function(a){c.getSchema(function(b){l=!0;for(var e=0;e<d.count();e++){var f=
b.getStore(d.store(e).getName()),f=f?f.hintForWebSql(d.store(e)):null;c.update_store_with_info_(a,d.store(e),function(a){a&&u++},f)}for(e=0;e<b.count();e++)f=b.store(e),d.hasStore(f.getName())||(d instanceof ydn.db.schema.EditableDatabase?d.addStore(f):(f="DROP TABLE "+f.getQuotedName(),c.logger.finer(f),a.executeSql(f,[],function(a){},function(a,b){throw b;})))},a,b)},function(d){c.logger.severe("SQLError "+d+" "+d.code+"("+d.message+") while changing version from "+b.version+" to "+k+" on "+a);
ydn.db.con.WebSql.DEBUG&&window.console.log(d);throw d;},function(){if(l){var e=".";u!=d.stores.length&&(e=" but unexpected stores exists.");c.logger.finest(a+":"+b.version+" ready"+e);f(b)}else c.logger.warning(a+": "+g+" voided.")})},h=null;try{b.isAutoVersion(),h=goog.global.openDatabase(a,"",a,this.size_)}catch(k){if("SECURITY_ERR"==k.name)this.logger.warning("SECURITY_ERR for opening "+a),h=null,this.last_error_=new ydn.db.SecurityError(k);else throw k;}if(h){var d=h.version,l="database "+a+
(0==h.version.length?"":" version "+h.version);goog.isDefAndNotNull(b.version)&&b.version==h.version?(c.logger.fine("Existing "+l+" opened as requested."),f(h)):this.getSchema(function(a){(a=b.difference(a,!0,!1))?(0==h.version.length?c.logger.fine("New "+l+" created."):b.isAutoVersion()?c.logger.fine("Existing "+l+" opened and schema change for "+a):c.logger.fine("Existing "+l+" opened and  schema change to version "+b.version+" for "+a),g(h,b,!0)):(c.logger.fine("Existing "+l+" with same schema opened."),
f(h))},null,h)}else f(null,this.last_error_);return e};ydn.db.con.WebSql.prototype.getType=function(){return ydn.db.base.Mechanisms.WEBSQL};ydn.db.con.WebSql.prototype.last_error_=null;ydn.db.con.WebSql.prototype.sql_db_=null;ydn.db.con.WebSql.prototype.getDbInstance=function(){return this.sql_db_||null};ydn.db.con.WebSql.isSupported=function(){return goog.isFunction(goog.global.openDatabase)};ydn.db.con.WebSql.DEBUG=!1;ydn.db.con.WebSql.prototype.logger=goog.debug.Logger.getLogger("ydn.db.con.WebSql");
ydn.db.con.WebSql.prototype.onFail=function(a){};ydn.db.con.WebSql.prototype.onError=function(a){};
ydn.db.con.WebSql.prototype.prepareCreateTable_=function(a){var b=a.getSqlType(),c="CREATE TABLE IF NOT EXISTS "+a.getQuotedName()+" (",d=a.getSQLKeyColumnNameQuoted(),c=c+(d+" "+b+" PRIMARY KEY ");a.autoIncrement&&(c+=" AUTOINCREMENT ");if(!a.isFixed()||!a.usedInlineKey()&&0==a.countIndex())c+=" ,"+ydn.db.base.DEFAULT_BLOB_COLUMN+" "+ydn.db.schema.DataType.BLOB;for(var e=[],f=[d],g=0,h=a.countIndex();g<h;g++){var k=a.index(g),l="";if(k.isMultiEntry()){var l=ydn.db.base.PREFIX_MULTIENTRY+a.getName()+
":"+k.getName(),m=k.isUnique()?" UNIQUE ":"",k="CREATE TABLE IF NOT EXISTS "+goog.string.quote(l)+" ("+d+" "+b+", "+k.getSQLIndexColumnNameQuoted()+" "+k.getSqlType()+m+")";e.push(k)}else k.isUnique()&&(l=" UNIQUE "),m=k.getKeyPath(),k.type!=ydn.db.schema.DataType.BLOB&&goog.isString(m)&&(m="CREATE "+l+" INDEX IF NOT EXISTS "+goog.string.quote(a.getName()+"-"+k.getName())+" ON "+a.getQuotedName()+" ("+goog.string.quote(m)+")",e.push(m)),m=k.getSQLIndexColumnNameQuoted(),-1==f.indexOf(m)&&(c+=", "+
m+" "+k.getSqlType()+l,f.push(m))}e.unshift(c+")");return e};ydn.db.con.WebSql.prototype.getVersion=function(){return this.sql_db_?parseFloat(this.sql_db_.version):void 0};
ydn.db.con.WebSql.prototype.getSchema=function(a,b,c){var d=this,e=(c=c||this.sql_db_)&&c.version?parseFloat(c.version):void 0,e=isNaN(e)?void 0:e,f=[],g=function(b,c){if(c&&c.rows){for(var g=0;g<c.rows.length;g++){var h=c.rows.item(g);if("__WebKitDatabaseInfoTable__"!=h.name&&"sqlite_sequence"!=h.name&&"table"==h.type){var p=goog.object.get(h,"sql");d.logger.finest("Parsing table schema from SQL: "+p);for(var p=p.substr(p.indexOf("("),p.lastIndexOf(")")),q=ydn.string.split_comma_seperated(p),r=void 0,
s,p=[],t=!1,u=!1,v=0;v<q.length;v++){var x=ydn.string.split_space_seperated(q[v]),y=goog.array.map(x,function(a){return a.toUpperCase()}),z=goog.string.stripQuotes(x[0],'"'),x=ydn.db.schema.Index.toType(y[1]);if(-1!=y.indexOf("PRIMARY")&&-1!=y.indexOf("KEY")){s=x;if(goog.isString(z)&&!goog.string.isEmpty(z)&&z!=ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME){var I=z.split(","),r=z;1<I.length&&(r=I,s=void 0)}-1!=y.indexOf("AUTOINCREMENT")&&(t=!0)}else if(z!=ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME)if(z==ydn.db.base.DEFAULT_BLOB_COLUMN)u=
!0;else{var D="UNIQUE"==y[2];goog.string.startsWith(z,h.tbl_name+"-")&&(z=z.substr(h.tbl_name.length+1));y=new ydn.db.schema.Index(z,x,D);p.push(y)}}if(goog.string.startsWith(h.name,ydn.db.base.PREFIX_MULTIENTRY)){var E=h.name.split(":");if(3<=E.length){var C=E[1],r=new ydn.db.schema.Index(E[2],x,D,!0),q=goog.array.findIndex(p,function(a){return a.getName()==E[2]});0<=q?p[q]=r:p.push(r);q=goog.array.findIndex(f,function(a){return a.getName()===C});0<=q?(v=f[q],f[q]=new ydn.db.schema.Store(v.getName(),
v.getKeyPath(),t,s,p,void 0,!u)):f.push(new ydn.db.schema.Store(C,void 0,!1,void 0,[r]));d.logger.finest('multi entry index "'+r.getName()+'" found in '+C+(-1==q?"*":""))}else d.logger.warning('Invalid multiEntry store name "'+h.name+'"')}else v=goog.array.findIndex(f,function(a){return a.getName()===h.name}),0<=v?(q=f[v].index(0),goog.asserts.assertInstanceof(q,ydn.db.schema.Index),p.push(q),f[v]=new ydn.db.schema.Store(h.name,r,t,s,p,void 0,!u)):(p=new ydn.db.schema.Store(h.name,r,t,s,p,void 0,
!u),f.push(p))}}g=new ydn.db.schema.Database(e,f);a(g)}},h=function(a,b){ydn.db.con.WebSql.DEBUG&&window.console.log([a,b]);throw b;};b?b.executeSql("SELECT * FROM sqlite_master",[],g,h):c.readTransaction(function(b){d.getSchema(a,b,c)},function(a){d.logger.severe("opening tx: "+a.message);throw a;},g)};ydn.db.con.WebSql.prototype.update_store_=function(a,b,c){var d=this;this.getSchema(function(e){e=e.getStore(b.getName());d.update_store_with_info_(a,b,c,e)},a)};
ydn.db.con.WebSql.prototype.update_store_with_info_=function(a,b,c,d){var e=0,f=function(d){a.executeSql(d,[],function(a,b){e++;e==g.length&&(c(!0),c=null)},function(a,f){ydn.db.con.WebSql.DEBUG&&window.console.log([a,f]);e++;e==g.length&&(c(!1),c=null);var h=goog.DEBUG?"SQLError creating table: "+b.getName()+" "+f.message+' for executing "'+d:'"';throw new ydn.db.SQLError(f,h);})},g=this.prepareCreateTable_(b),h="Create";if(d){var k=b.difference(d);if(0==k.length){this.logger.finest("same table "+
b.getName()+" exists.");c(!0);c=null;return}h="Modify";this.logger.warning("table: "+b.getName()+" has changed by "+k+" ALTER TABLE cannot run in WebSql, dropping old table.");g.unshift("DROP TABLE IF EXISTS "+goog.string.quote(b.getName()))}ydn.db.con.WebSql.DEBUG&&window.console.log([g,d]);this.logger.finest(h+" table: "+b.getName()+": "+g.join(";"));for(d=0;d<g.length;d++)f(g[d])};ydn.db.con.WebSql.prototype.isReady=function(){return!!this.sql_db_};
ydn.db.con.WebSql.prototype.close=function(){this.sql_db_=null};
ydn.db.con.WebSql.prototype.doTransaction=function(a,b,c,d){var e=this;b=function(b){a(b)};var f=function(){d(ydn.db.base.TxEventTypes.COMPLETE,{type:ydn.db.base.TxEventTypes.COMPLETE})},g=function(a){e.logger.finest(e+": Tx "+c+" request cause error.");d(ydn.db.base.TxEventTypes.ABORT,a)};goog.isNull(this.sql_db_)&&(a(null),d(ydn.db.base.TxEventTypes.ABORT,this.last_error_));c==ydn.db.base.TransactionMode.READ_ONLY?this.sql_db_.readTransaction(b,g,f):c==ydn.db.base.TransactionMode.VERSION_CHANGE?
this.sql_db_.changeVersion(this.sql_db_.version,this.sql_db_.version+1+"",b,g,f):this.sql_db_.transaction(b,g,f)};
ydn.db.con.WebSql.deleteDatabase=function(a,b){if(!b||b==ydn.db.base.Mechanisms.WEBSQL){var c=new ydn.db.con.WebSql,d=new ydn.db.schema.EditableDatabase;c.logger.finer("deleting websql database: "+a);var d=c.connect(a,d),e=function(b,d){c.logger.info("all tables in "+a+" deleted.")};d.addCallback(function(){c.doTransaction(function(b){b.executeSql('SELECT * FROM sqlite_master WHERE type = "table"',[],function(d,e){if(e&&e.rows){for(var k=e.rows.length,l=0,m=0;m<k;m++){var n=e.rows.item(m);"__WebKitDatabaseInfoTable__"!=
n.name&&"sqlite_sequence"!=n.name&&(l++,c.logger.finest("deleting table: "+n.name),b.executeSql("DROP TABLE "+n.name))}c.logger.finer(l+' tables deleted from "'+a+'"')}},function(a,b){ydn.db.con.WebSql.DEBUG&&window.console.log([a,b]);throw b;})},[],ydn.db.base.TransactionMode.READ_WRITE,e)});d.addErrback(function(){c.logger.warning("Connecting "+a+" failed.")})}};ydn.db.databaseDeletors.push(ydn.db.con.WebSql.deleteDatabase);ydn.db.con.WebSql.prototype.onVersionChange=function(a){};
goog.DEBUG&&(ydn.db.con.WebSql.prototype.toString=function(){return"WebSql:"+(this.sql_db_?":"+this.sql_db_.version:"")});ydn.db.tr.Storage.inject_db={};
ydn.db.tr.Storage.prototype.createDbInstance=function(a){return a==ydn.db.base.Mechanisms.IDB&&ydn.db.con.IndexedDb.isSupported()?new ydn.db.con.IndexedDb(this.size,this.connectionTimeout):a==ydn.db.base.Mechanisms.WEBSQL&&ydn.db.con.WebSql.isSupported()?new ydn.db.con.WebSql(this.size):a==ydn.db.base.Mechanisms.LOCAL_STORAGE&&ydn.db.con.LocalStorage.isSupported()?new ydn.db.con.LocalStorage:a==ydn.db.base.Mechanisms.SESSION_STORAGE&&ydn.db.con.SessionStorage.isSupported()?new ydn.db.con.SessionStorage:
a==ydn.db.base.Mechanisms.MEMORY_STORAGE?new ydn.db.con.SimpleStorage:null};goog.structs.SimplePool=function(a,b){goog.Disposable.call(this);this.disposeObjectFn_=this.createObjectFn_=null;this.maxCount_=b;this.freeQueue_=[];this.createInitial_(a)};goog.inherits(goog.structs.SimplePool,goog.Disposable);goog.structs.SimplePool.prototype.setCreateObjectFn=function(a){this.createObjectFn_=a};goog.structs.SimplePool.prototype.setDisposeObjectFn=function(a){this.disposeObjectFn_=a};
goog.structs.SimplePool.prototype.getObject=function(){return this.freeQueue_.length?this.freeQueue_.pop():this.createObject()};goog.structs.SimplePool.prototype.releaseObject=function(a){this.freeQueue_.length<this.maxCount_?this.freeQueue_.push(a):this.disposeObject(a)};goog.structs.SimplePool.prototype.createInitial_=function(a){if(a>this.maxCount_)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var b=0;b<a;b++)this.freeQueue_.push(this.createObject())};
goog.structs.SimplePool.prototype.createObject=function(){return this.createObjectFn_?this.createObjectFn_():{}};goog.structs.SimplePool.prototype.disposeObject=function(a){if(this.disposeObjectFn_)this.disposeObjectFn_(a);else if(goog.isObject(a))if(goog.isFunction(a.dispose))a.dispose();else for(var b in a)delete a[b]};
goog.structs.SimplePool.prototype.disposeInternal=function(){goog.structs.SimplePool.superClass_.disposeInternal.call(this);for(var a=this.freeQueue_;a.length;)this.disposeObject(a.pop());delete this.freeQueue_};goog.debug.Trace_=function(){this.events_=[];this.outstandingEvents_=new goog.structs.Map;this.tracerOverheadComment_=this.tracerOverheadEnd_=this.tracerOverheadStart_=this.startTime_=0;this.stats_=new goog.structs.Map;this.commentCount_=this.tracerCount_=0;this.nextId_=1;this.eventPool_=new goog.structs.SimplePool(0,4E3);this.eventPool_.createObject=function(){return new goog.debug.Trace_.Event_};this.statPool_=new goog.structs.SimplePool(0,50);this.statPool_.createObject=function(){return new goog.debug.Trace_.Stat_};
var a=this;this.idPool_=new goog.structs.SimplePool(0,2E3);this.idPool_.createObject=function(){return String(a.nextId_++)};this.idPool_.disposeObject=function(a){};this.defaultThreshold_=3};goog.debug.Trace_.prototype.logger_=goog.log.getLogger("goog.debug.Trace");goog.debug.Trace_.prototype.MAX_TRACE_SIZE=1E3;goog.debug.Trace_.EventType={START:0,STOP:1,COMMENT:2};goog.debug.Trace_.Stat_=function(){this.varAlloc=this.time=this.count=0};
goog.debug.Trace_.Stat_.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");this.varAlloc&&a.push(" [VarAlloc = ",this.varAlloc,"]");return a.join("")};goog.debug.Trace_.Event_=function(){};
goog.debug.Trace_.Event_.prototype.toTraceString=function(a,b,c){var d=[];-1==b?d.push("    "):d.push(goog.debug.Trace_.longToPaddedString_(this.eventTime-b));d.push(" ",goog.debug.Trace_.formatTime_(this.eventTime-a));this.eventType==goog.debug.Trace_.EventType.START?d.push(" Start        "):this.eventType==goog.debug.Trace_.EventType.STOP?(d.push(" Done "),d.push(goog.debug.Trace_.longToPaddedString_(this.stopTime-this.startTime)," ms ")):d.push(" Comment      ");d.push(c,this);0<this.totalVarAlloc&&
d.push("[VarAlloc ",this.totalVarAlloc,"] ");return d.join("")};goog.debug.Trace_.Event_.prototype.toString=function(){return null==this.type?this.comment:"["+this.type+"] "+this.comment};goog.debug.Trace_.prototype.setStartTime=function(a){this.startTime_=a};goog.debug.Trace_.prototype.initCurrentTrace=function(a){this.reset(a)};goog.debug.Trace_.prototype.clearCurrentTrace=function(){this.reset(0)};
goog.debug.Trace_.prototype.reset=function(a){this.defaultThreshold_=a;for(a=0;a<this.events_.length;a++){var b=this.eventPool_.id;b&&this.idPool_.releaseObject(b);this.eventPool_.releaseObject(this.events_[a])}this.events_.length=0;this.outstandingEvents_.clear();this.startTime_=goog.debug.Trace_.now();this.commentCount_=this.tracerCount_=this.tracerOverheadComment_=this.tracerOverheadEnd_=this.tracerOverheadStart_=0;b=this.stats_.getKeys();for(a=0;a<b.length;a++){var c=this.stats_.get(b[a]);c.count=
0;c.time=0;c.varAlloc=0;this.statPool_.releaseObject(c)}this.stats_.clear()};
goog.debug.Trace_.prototype.startTracer=function(a,b){var c=goog.debug.Trace_.now(),d=this.getTotalVarAlloc(),e=this.outstandingEvents_.getCount();if(this.events_.length+e>this.MAX_TRACE_SIZE){goog.log.warning(this.logger_,"Giant thread trace. Clearing to avoid memory leak.");if(this.events_.length>this.MAX_TRACE_SIZE/2){for(var f=0;f<this.events_.length;f++){var g=this.events_[f];g.id&&this.idPool_.releaseObject(g.id);this.eventPool_.releaseObject(g)}this.events_.length=0}e>this.MAX_TRACE_SIZE/2&&
this.outstandingEvents_.clear()}goog.debug.Logger.logToProfilers("Start : "+a);g=this.eventPool_.getObject();g.totalVarAlloc=d;g.eventType=goog.debug.Trace_.EventType.START;g.id=Number(this.idPool_.getObject());g.comment=a;g.type=b;this.events_.push(g);this.outstandingEvents_.set(String(g.id),g);this.tracerCount_++;d=goog.debug.Trace_.now();g.startTime=g.eventTime=d;this.tracerOverheadStart_+=d-c;return g.id};
goog.debug.Trace_.prototype.stopTracer=function(a,b){var c=goog.debug.Trace_.now(),d;d=0===b?0:b?b:this.defaultThreshold_;var e=this.outstandingEvents_.get(String(a));if(null==e)return null;this.outstandingEvents_.remove(String(a));var f,g=c-e.startTime;if(g<d)for(d=this.events_.length-1;0<=d;d--){if(this.events_[d]==e){this.events_.splice(d,1);this.idPool_.releaseObject(e.id);this.eventPool_.releaseObject(e);break}}else f=this.eventPool_.getObject(),f.eventType=goog.debug.Trace_.EventType.STOP,f.startTime=
e.startTime,f.comment=e.comment,f.type=e.type,f.stopTime=f.eventTime=c,this.events_.push(f);d=e.type;var h=null;d&&(h=this.getStat_(d),h.count++,h.time+=g);f&&(goog.debug.Logger.logToProfilers("Stop : "+f.comment),f.totalVarAlloc=this.getTotalVarAlloc(),h&&(h.varAlloc+=f.totalVarAlloc-e.totalVarAlloc));e=goog.debug.Trace_.now();this.tracerOverheadEnd_+=e-c;return g};goog.debug.Trace_.prototype.setGcTracer=function(a){this.gcTracer_=a};
goog.debug.Trace_.prototype.getTotalVarAlloc=function(){var a=this.gcTracer_;return a&&a.isTracing()?a.totalVarAlloc:-1};
goog.debug.Trace_.prototype.addComment=function(a,b,c){var d=goog.debug.Trace_.now(),e=c?c:d,f=this.eventPool_.getObject();f.eventType=goog.debug.Trace_.EventType.COMMENT;f.eventTime=e;f.type=b;f.comment=a;f.totalVarAlloc=this.getTotalVarAlloc();this.commentCount_++;if(c){a=this.events_.length;for(b=0;b<a;b++)if(this.events_[b].eventTime>e){goog.array.insertAt(this.events_,f,b);break}b==a&&this.events_.push(f)}else this.events_.push(f);(e=f.type)&&this.getStat_(e).count++;this.tracerOverheadComment_+=
goog.debug.Trace_.now()-d};goog.debug.Trace_.prototype.getStat_=function(a){var b=this.stats_.get(a);b||(b=this.statPool_.getObject(),b.type=a,this.stats_.set(a,b));return b};goog.debug.Trace_.prototype.getFormattedTrace=function(){return this.toString()};
goog.debug.Trace_.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.events_.length;d++){var e=this.events_[d];e.eventType==goog.debug.Trace_.EventType.STOP&&c.pop();a.push(" ",e.toTraceString(this.startTime_,b,c.join("")));b=e.eventTime;a.push("\n");e.eventType==goog.debug.Trace_.EventType.START&&c.push("|  ")}if(0!=this.outstandingEvents_.getCount()){var f=goog.debug.Trace_.now();a.push(" Unstopped timers:\n");goog.iter.forEach(this.outstandingEvents_,function(b){a.push("  ",b," (",
f-b.startTime," ms, started at ",goog.debug.Trace_.formatTime_(b.startTime),")\n")})}b=this.stats_.getKeys();for(d=0;d<b.length;d++)c=this.stats_.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",this.tracerCount_,"\n","Total comments created ",this.commentCount_,"\n","Overhead start: ",this.tracerOverheadStart_," ms\n","Overhead end: ",this.tracerOverheadEnd_," ms\n","Overhead comment: ",this.tracerOverheadComment_," ms\n");return a.join("")};
goog.debug.Trace_.longToPaddedString_=function(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a};goog.debug.Trace_.formatTime_=function(a){a=Math.round(a);var b=a%1E3;return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+b).substring(1,4)};goog.debug.Trace_.now=function(){return goog.now()};goog.debug.Trace=new goog.debug.Trace_;goog.debug.ErrorHandler=function(a){goog.Disposable.call(this);this.errorHandlerFn_=a;this.wrapErrors_=!0;this.prefixErrorMessages_=!1};goog.inherits(goog.debug.ErrorHandler,goog.Disposable);goog.debug.ErrorHandler.prototype.addTracersToProtectedFunctions_=!1;goog.debug.ErrorHandler.prototype.setAddTracersToProtectedFunctions=function(a){this.addTracersToProtectedFunctions_=a};goog.debug.ErrorHandler.prototype.wrap=function(a){return this.protectEntryPoint(goog.asserts.assertFunction(a))};
goog.debug.ErrorHandler.prototype.unwrap=function(a){goog.asserts.assertFunction(a);return a[this.getFunctionIndex_(!1)]||a};goog.debug.ErrorHandler.prototype.getStackTraceHolder_=function(a){var b=[];b.push("##PE_STACK_START##");b.push(a.replace(/(\r\n|\r|\n)/g,"##STACK_BR##"));b.push("##PE_STACK_END##");return b.join("")};goog.debug.ErrorHandler.prototype.getFunctionIndex_=function(a){return(a?"__wrapper_":"__protected_")+goog.getUid(this)+"__"};
goog.debug.ErrorHandler.prototype.protectEntryPoint=function(a){var b=this.getFunctionIndex_(!0);a[b]||((a[b]=this.getProtectedFunction(a))[this.getFunctionIndex_(!1)]=a);return a[b]};
goog.debug.ErrorHandler.prototype.getProtectedFunction=function(a){var b=this,c=this.addTracersToProtectedFunctions_;if(c)var d=goog.debug.getStacktraceSimple(15);var e=function(){if(b.isDisposed())return a.apply(this,arguments);if(c)var e=goog.debug.Trace.startTracer("protectedEntryPoint: "+b.getStackTraceHolder_(d));try{return a.apply(this,arguments)}catch(g){b.errorHandlerFn_(g);if(!b.wrapErrors_)throw b.prefixErrorMessages_&&("object"===typeof g?g.message=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+
g.message:g=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+g),goog.DEBUG&&g&&g.stack&&Error.captureStackTrace&&goog.global.console&&goog.global.console.error(g.message,g.stack),g;throw new goog.debug.ErrorHandler.ProtectedFunctionError(g);}finally{c&&goog.debug.Trace.stopTracer(e)}};e[this.getFunctionIndex_(!1)]=a;return e};goog.debug.ErrorHandler.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")};
goog.debug.ErrorHandler.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")};goog.debug.ErrorHandler.prototype.protectWindowRequestAnimationFrame=function(){for(var a=goog.getObjectByName("window"),b=["requestAnimationFrame","mozRequestAnimationFrame","webkitAnimationFrame","msRequestAnimationFrame"],c=0;c<b.length;c++){var d=b[c];b[c]in a&&(a[d]=this.protectEntryPoint(a[d]))}};
goog.debug.ErrorHandler.prototype.protectWindowFunctionsHelper_=function(a){var b=goog.getObjectByName("window"),c=b[a],d=this;b[a]=function(a,b){goog.isString(a)&&(a=goog.partial(goog.globalEval,a));a=d.protectEntryPoint(a);return c.call?c.call(this,a,b):c(a,b)};b[a][this.getFunctionIndex_(!1)]=c};goog.debug.ErrorHandler.prototype.setWrapErrors=function(a){this.wrapErrors_=a};goog.debug.ErrorHandler.prototype.setPrefixErrorMessages=function(a){this.prefixErrorMessages_=a};
goog.debug.ErrorHandler.prototype.disposeInternal=function(){var a=goog.getObjectByName("window");a.setTimeout=this.unwrap(a.setTimeout);a.setInterval=this.unwrap(a.setInterval);goog.debug.ErrorHandler.superClass_.disposeInternal.call(this)};goog.debug.ErrorHandler.ProtectedFunctionError=function(a){goog.debug.Error.call(this,goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+(a&&a.message?String(a.message):String(a)));(a=(this.cause=a)&&a.stack)&&goog.isString(a)&&(this.stack=a)};
goog.inherits(goog.debug.ErrorHandler.ProtectedFunctionError,goog.debug.Error);goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ";goog.events.EventWrapper=function(){};goog.events.EventWrapper.prototype.listen=function(a,b,c,d,e){};goog.events.EventWrapper.prototype.unlisten=function(a,b,c,d,e){};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
ydn.db.tr.events={};ydn.db.tr.Storage.prototype.getEventTarget=function(){this.event_target||(this.event_target=new goog.events.EventTarget);return this.event_target};
ydn.db.tr.Storage.prototype.addEventListener=function(a,b,c,d){if("ready"==a)goog.events.listenOnce(this.getEventTarget(),a,b,c,d);else{if(goog.DEBUG){var e=this.getEventTypes(),f=function(a){if(!goog.array.contains(e,a))throw new ydn.debug.error.ArgumentException('Invalid event type "'+a+'"');};if(goog.isArrayLike(a))for(var g=0;g<a.length;g++)f(a[g]);else f(a)}goog.events.listen(this.getEventTarget(),a,b,c,d)}};
ydn.db.tr.Storage.prototype.removeEventListener=function(a,b,c,d){goog.events.unlisten(this.getEventTarget(),a,b,c,d)};ydn.db.tr.Storage.prototype.dispatchDbEvent=function(a){this.getEventTarget().dispatchEvent(a)};ydn.db.Storage=function(a,b,c){ydn.db.sql.Storage.call(this,a,b,c)};goog.inherits(ydn.db.Storage,ydn.db.sql.Storage);ydn.atom={};ydn.atom.Link=function(){};ydn.atom.Link.Rel={ALTERNATE:"alternate",EDIT:"edit",NEXT:"next",PREVIOUS:"previous",RELATED:"related",SELF:"self",FEED:"http://schemas.google.com/g/2005#feed",LIST_FEED:"http://schemas.google.com/spreadsheets/2006#listfeed",BATCH:"http://schemas.google.com/g/2005#batch",REVISION:"http://schemas.google.com/sites/2008#revision"};
ydn.atom.Link.getLink=function(a,b){if(a.link){if(goog.isArray(a.link)){for(var c=0;c<a.link.length;c++)if(a.link[c].rel==b)return a.link[c];return null}return a.link.rel==b?a.link:null}return null};ydn.db.sync={};ydn.db.sync.Conflict=function(a,b){this.entry=a;this.data=b;this.default_prevented_=this.has_resolved_=!1;this.resolved_data=null};ydn.db.sync.Conflict.prototype.resolved_data=null;ydn.db.sync.Conflict.prototype.data=null;ydn.db.sync.Conflict.prototype.hasResolved=function(){return this.has_resolved_};ydn.db.sync.Conflict.prototype.preventDefault=function(){this.default_prevented_=!0};ydn.db.sync.Conflict.prototype.defaultPrevented=function(){return this.default_prevented_};
ydn.db.sync.Conflict.prototype.getClientValue=function(){return this.data};ydn.db.sync.Conflict.prototype.getResolvedValue=function(){return this.resolved_data};ydn.db.sync.Conflict.prototype.getEntry=function(){return this.entry};ydn.db.sync.Conflict.prototype.resolve=function(a){goog.asserts.assert(!this.has_resolved_,"conflict already resolved");this.has_resolved_=!0;this.resolved_data=a};ydn.db.sync.Conflict.prototype.runDefault=function(){};ydn.db.sync.EventTypes={CONFLICT:"conflict",DELAY:"delay"};ydn.db.sync.Event=function(a,b,c,d){goog.events.Event.call(this,a,b);this.status=c;this.entry=d};goog.inherits(ydn.db.sync.Event,goog.events.Event);ydn.db.sync.Event.prototype.status=NaN;ydn.db.sync.Event.prototype.getStatus=function(){return this.status};ydn.db.sync.Event.prototype.getDatabaseValue=function(){return this.entry.getDbValue()};ydn.db.sync.Event.prototype.getServerValue=function(){return this.entry.getServerValue()};
ydn.db.sync.ConflictEvent=function(a,b,c){ydn.db.sync.Event.call(this,ydn.db.sync.EventTypes.CONFLICT,a,b,c.getEntry());this.conflict=c};goog.inherits(ydn.db.sync.ConflictEvent,ydn.db.sync.Event);ydn.db.sync.ConflictEvent.prototype.getClientValue=function(){return this.conflict.getClientValue()};ydn.db.sync.ConflictEvent.prototype.hasDefaultPrevented=function(){return this.defaultPrevented};ydn.db.sync.DelayEvent=function(a,b,c){ydn.db.sync.Event.call(this,ydn.db.sync.EventTypes.DELAY,a,b,c)};
goog.inherits(ydn.db.sync.DelayEvent,ydn.db.sync.Event);ydn.db.sync.KeyPath=function(a,b){this.key_paths=a;if(b)throw new ydn.debug.error.NotSupportedException("optional key paths");};ydn.db.sync.KeyPath.Key={KEY:"key",DATE:"date",MODIFIED:"modified",EXPIRES:"expires",ETAG:"etag",UPDATED:"updated",URI:"uri",NEXT:"next"};ydn.db.sync.KeyPath.prototype.getPath=function(a){var b=this.key_paths[a];goog.asserts.assert(b,"path "+a+" not found");return b};
ydn.db.sync.KeyPath.prototype.getValue=function(a,b){return b&&this.key_paths[a]?ydn.db.utils.getValueByKeys(b,this.key_paths[a]):void 0};ydn.db.sync.KeyPath.prototype.setValue=function(a,b,c){this.key_paths[a]&&ydn.db.utils.setValueByKeys(b,this.key_paths[a],c)};ydn.db.sync.entry={};ydn.db.sync.entry.MetaData=function(a,b,c,d){this.key=a;this.meta_data=(this.meta_data=d?b[d]:b)||{};this.key_paths=c};ydn.db.sync.entry.MetaData.prototype.getKey=function(){return goog.isDefAndNotNull(this.key)?this.key:this.key_paths.getValue(ydn.db.sync.KeyPath.Key.KEY,this.meta_data)};ydn.db.sync.entry.MetaData.prototype.getDate=function(){return this.key_paths.getValue(ydn.db.sync.KeyPath.Key.DATE,this.meta_data)};
ydn.db.sync.entry.MetaData.prototype.getExpires=function(){return this.key_paths.getValue(ydn.db.sync.KeyPath.Key.EXPIRES,this.meta_data)};ydn.db.sync.entry.MetaData.prototype.getUpdated=function(){return this.key_paths.getValue(ydn.db.sync.KeyPath.Key.UPDATED,this.meta_data)};ydn.db.sync.entry.MetaData.prototype.getEtag=function(){return this.key_paths.getValue(ydn.db.sync.KeyPath.Key.ETAG,this.meta_data)};ydn.db.sync.entry.MetaData.prototype.stampDate=function(){this.date=goog.now()};
ydn.db.sync.entry.MetaData.prototype.toRequestReadHeader=function(){var a={},b=this.getEtag();b&&1<b.length?a["if-none-match"]=b:(b=this.getUpdated())&&(a["if-modified-since"]=b);return a};ydn.db.sync.entry.MetaData.prototype.toRequestWriteHeader=function(){var a={},b=this.getUpdated();b&&(a["if-unmodified-since"]=b);(b=this.getEtag())&&1<b.length&&(a["if-match"]=b);return a};
ydn.db.sync.entry.MetaData.prototype.toJSON=function(){var a={};this.key_paths.setValue(ydn.db.sync.KeyPath.Key.KEY,a,this.getKey());var b=this.getDate();b&&this.key_paths.setValue(ydn.db.sync.KeyPath.Key.DATE,a,b);(b=this.getExpires())&&this.key_paths.setValue(ydn.db.sync.KeyPath.Key.EXPIRES,a,b);(b=this.getUpdated())&&this.key_paths.setValue(ydn.db.sync.KeyPath.Key.UPDATED,a,b);(b=this.getEtag())&&this.key_paths.setValue(ydn.db.sync.KeyPath.Key.ETAG,a,b);return a};ydn.db.sync.entry.HttpMetaData=function(a,b,c){b.expires&&c.setValue(ydn.db.sync.KeyPath.Key.EXPIRES,b,(new Date(b.expires)).getTime());b["last-updated"]&&c.setValue(ydn.db.sync.KeyPath.Key.UPDATED,b,(new Date(b["last-updated"])).getTime());b.etag&&c.setValue(ydn.db.sync.KeyPath.Key.ETAG,b,(new Date(b.etag)).getTime());c.setValue(ydn.db.sync.KeyPath.Key.DATE,b,NaN);ydn.db.sync.entry.MetaData.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.HttpMetaData,ydn.db.sync.entry.MetaData);ydn.string.diff={};
ydn.string.diff.longest_common_subsequence=function(a,b){var c,d,e,f,g,h,k,l,m;c={};for(e=0;e<b.length;e++)d=b[e],c[d]?c[d].push(e):c[d]=[e];f=[{file1index:-1,file2index:-1,chain:null}];for(h=0;h<a.length;h++){d=a[h];d=c[d]||[];l=0;g=f[0];for(k=0;k<d.length;k++){e=d[k];for(m=l;m<f.length&&!(f[m].file2index<e&&(m==f.length-1||f[m+1].file2index>e));m++);if(m<f.length&&(e={file1index:h,file2index:e,chain:f[m]},l==f.length?f.push(g):f[l]=g,l=m+1,g=e,l==f.length))break}f[l]=g}return f[f.length-1]};
ydn.string.diff.diff_comm=function(a,b){function c(){g.common.length&&(g.common.reverse(),d.push(g),g={common:[]})}for(var d=[],e=a.length,f=b.length,g={common:[]},h=ydn.string.diff.longest_common_subsequence(a,b);null!==h;h=h.chain){for(var k={file1:[],file2:[]};--e>h.file1index;)k.file1.push(a[e]);for(;--f>h.file2index;)k.file2.push(b[f]);if(k.file1.length||k.file2.length)c(),k.file1.reverse(),k.file2.reverse(),d.push(k);0<=e&&g.common.push(a[e])}c();d.reverse();return d};
ydn.string.diff.diff_patch=function(a,b){function c(a,b,c){for(var d=[],e=0;e<c;e++)d.push(a[b+e]);return{offset:b,length:c,chunk:d}}for(var d=[],e=a.length,f=b.length,g=ydn.string.diff.longest_common_subsequence(a,b);null!==g;g=g.chain){var h=e-g.file1index-1,k=f-g.file2index-1,e=g.file1index,f=g.file2index;(h||k)&&d.push({file1:c(a,g.file1index+1,h),file2:c(b,g.file2index+1,k)})}d.reverse();return d};
ydn.string.diff.strip_patch=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push({file1:{offset:d.file1.offset,length:d.file1.length},file2:{chunk:d.file2.chunk}})}return b};ydn.string.diff.invert_patch=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.file1;c.file1=c.file2;c.file2=d}};
ydn.string.diff.patch=function(a,b){function c(b){for(;e<b;)d.push(a[e]),e++}for(var d=[],e=0,f=0;f<b.length;f++){var g=b[f];c(g.file1.offset);for(var h=0;h<g.file2.chunk.length;h++)d.push(g.file2.chunk[h]);e+=g.file1.length}c(a.length);return d};
ydn.string.diff.diff_indices=function(a,b){for(var c=[],d=a.length,e=b.length,f=ydn.string.diff.longest_common_subsequence(a,b);null!==f;f=f.chain){var g=d-f.file1index-1,h=e-f.file2index-1,d=f.file1index,e=f.file2index;(g||h)&&c.push({file1:[d+1,g],file2:[e+1,h]})}c.reverse();return c};
ydn.string.diff.diff3_merge_indices=function(a,b,c){function d(a,b){k.push([a.file1[0],b,a.file1[1],a.file2[0],a.file2[1]])}function e(a){a>m&&(l.push([1,m,a-m]),m=a)}var f,g=ydn.string.diff.diff_indices(b,a),h=ydn.string.diff.diff_indices(b,c),k=[];for(f=0;f<g.length;f++)d(g[f],0);for(f=0;f<h.length;f++)d(h[f],2);k.sort();for(var l=[],m=0,g=0;g<k.length;g++){f=g;for(var n=k[g],h=n[0],p=h+n[2];g<k.length-1;){var q=k[g+1],r=q[0];if(r>p)break;p=Math.max(p,r+q[2]);g++}e(h);if(f==g)0<n[4]&&l.push([n[1],
n[3],n[4]]);else{for(q={0:[a.length,-1,b.length,-1],2:[c.length,-1,b.length,-1]};f<=g;f++){var n=k[f],r=q[n[1]],s=n[0],t=s+n[2],u=n[3],n=u+n[4];r[0]=Math.min(u,r[0]);r[1]=Math.max(n,r[1]);r[2]=Math.min(s,r[2]);r[3]=Math.max(t,r[3])}f=q[0][0]+(h-q[0][2]);n=q[2][0]+(h-q[2][2]);l.push([-1,f,q[0][1]+(p-q[0][3])-f,h,p-h,n,q[2][1]+(p-q[2][3])-n])}m=p}e(b.length);return l};ydn.string.diff.ConflictResult=function(a,b,c,d,e,f){this.a=a;this.a_index=b;this.o=c;this.o_index=d;this.b=e;this.b_index=f};
ydn.string.diff.MergeResult=function(a,b){this.ok=a;this.conflict=b||null};
ydn.string.diff.diff3_merge=function(a,b,c,d){function e(){m.length&&h.push(new ydn.string.diff.MergeResult(m));m=[]}function f(a){for(var b=0;b<a.length;b++)m.push(a[b])}function g(b){if(b[2]!=b[6])return!0;for(var d=b[1],e=b[5],f=0;f<b[2];f++)if(a[f+d]!=c[f+e])return!0;return!1}for(var h=[],k=[a,b,c],l=ydn.string.diff.diff3_merge_indices(a,b,c),m=[],n=0;n<l.length;n++){var p=l[n],q=p[0];-1==q?d&&!g(p)?f(k[0].slice(p[1],p[1]+p[2])):(e(),h.push(new ydn.string.diff.MergeResult(null,new ydn.string.diff.ConflictResult(a.slice(p[1],
p[1]+p[2]),p[1],b.slice(p[3],p[3]+p[4]),p[3],c.slice(p[5],p[5]+p[6]),p[5])))):f(k[q].slice(p[1],p[1]+p[2]))}e();return h};ydn.db.sync.entry.Rest=function(a,b,c){this.sync_parent=a;this.client_value=c||null;this.server_value=this.db_value=null;goog.asserts.assert(goog.isDefAndNotNull(b));this.key=b};ydn.db.sync.entry.Rest.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.entry.Rest");
ydn.db.sync.entry.Rest.prototype.getServerValue=function(){if(this.server_value&&this.sync_parent.inlinedMetaData&&this.server_meta){var a=this.sync_parent.getMetaDataFieldName();this.sync_parent.keep_meta||delete this.server_value[a]}return this.server_value||null};ydn.db.sync.entry.Rest.prototype.getValue=function(){return this.client_value};ydn.db.sync.entry.Rest.prototype.getServerMeta=function(){return this.server_meta};ydn.db.sync.entry.Rest.prototype.getDbMeta=function(){return this.db_meta};
ydn.db.sync.entry.Rest.prototype.usedInlineMeta=function(){return!!this.sync_parent.getMetaDataFieldName()};ydn.db.sync.entry.Rest.prototype.getDbValue=function(){return this.db_value||null};ydn.db.sync.entry.Rest.prototype.setDbValue=function(a){this.db_value=a;a=this.sync_parent.getMetaDataFieldName();this.db_value&&a&&this.db_value[a]&&(this.db_meta=new ydn.db.sync.entry.MetaData(this.key,this.db_value,this.sync_parent.getKeyPaths(),a),this.sync_parent.keep_meta||delete this.db_value[a])};
ydn.db.sync.entry.Rest.prototype.setValue=function(a){this.client_value=a};ydn.db.sync.entry.Rest.prototype.getId=function(){goog.asserts.assertString(this.key,this+" key is not a string");return this.key};ydn.db.sync.entry.Rest.prototype.getKey=function(){return this.key};ydn.db.sync.entry.Rest.prototype.getUri=function(){return this.sync_parent.id2uri(this.getId())};
ydn.db.sync.entry.Rest.prototype.getMetaFromHeader=function(a){var b=this.getId();return new ydn.db.sync.entry.HttpMetaData(b,a.getHeaders(),this.sync_parent.getKeyPaths())};ydn.db.sync.entry.Rest.prototype.getDataFromBody=function(a,b){if(a)return a;if(b.isSuccess())return b.getJson();try{return b.getJson()}catch(c){var d=b.getBody();return goog.isObject(d)?d:{body:d}}};
ydn.db.sync.entry.Rest.prototype.save=function(a){var b=this.getId();if(a&&!this.sync_parent.inlinedMetaData)return this.server_meta.stampDate(),this.sync_parent.putMetaToDB([this.server_meta.toJSON()]);var c=this.server_value;if(a&&!c)return goog.async.Deferred.succeed();a=void 0;goog.isDefAndNotNull(this.server_meta)&&(this.server_meta.stampDate(),a=[this.server_meta.toJSON()]);return this.sync_parent.putToDB([c],a,[b])};ydn.db.sync.entry.Rest.prototype.saveOldDbData=function(){};
ydn.db.sync.entry.Rest.prototype.removeDatabase=function(){return this.sync_parent.removeFromDb(this.getId())};
ydn.db.sync.entry.Rest.prototype.readServer=function(a,b){if(this.sync_parent.isImmutable()&&goog.isObject(this.db_value))a.call(b,304),a=null;else{var c=this;this.loadMeta(function(d){if(d){var e=d.getExpires();if(e&&e>goog.now()){this.logger.finest(this+" not expired");a.call(b,304);a=null;return}}e=c.getUri();d=c.newRequest(e,"GET",d);this.sync_parent.getTransport().request(d).execute(function(d,e){c.server_meta=c.getMetaFromHeader(e);c.server_value=c.getDataFromBody(d,e);a.call(b,e.getStatus());
a=null})},this)}};ydn.db.sync.entry.Rest.prototype.newRequest=function(a,b,c,d){a=new ydn.client.HttpRequestData(a,b);if(c){var e;e=a.isWriteRequest()?c.toRequestWriteHeader():c.toRequestReadHeader();a.headers?goog.object.extend(a.headers,e):a.headers=e}a.body=goog.isObject(d)?JSON.stringify(d):d;this.logger.finest(this+" "+a.method+" "+a.getUri()+" "+ydn.json.toShortString(e));return a};
ydn.db.sync.entry.Rest.prototype.putServer=function(a,b){this.loadMeta(function(c){var d=this.getValue();c=this.newRequest(this.getUri(),"PUT",c,d);this.sync_parent.getTransport().request(c).execute(function(c,d){this.server_meta=this.getMetaFromHeader(d);this.server_value=c;a&&(a.call(b,d.getStatus()),a=null)},this)},this)};
ydn.db.sync.entry.Rest.prototype.loadMeta=function(a,b){if(this.db_meta)a.call(b,this.db_meta);else{var c=this;this.sync_parent.loadMeta(this.getId(),function(d){c.db_meta=d;a.call(b,d)})}};ydn.db.sync.entry.Rest.prototype.load=function(a,b){if(this.db_value&&this.db_meta)a&&(a.call(b,this.db_value,this.db_meta),a=void 0);else{var c=this.getId();this.sync_parent.load(c,function(c,e){this.setDbValue(c);this.db_value=c;this.db_meta=e;a&&(a.call(b,c),a=void 0)},this)}};
ydn.db.sync.entry.Rest.prototype.deleteServer=function(a){var b=this.getUri(),c=this.sync_parent.getTransport();this.loadMeta(function(d){d=this.newRequest(b,"DELETE",d);c.request(d).execute(function(c,d){this.logger.finest("deleted "+b+" "+d.getStatus());a.call(this,d.getStatus())},this)},this)};goog.DEBUG&&(ydn.db.sync.entry.Rest.prototype.toString=function(){return"sync.entry{"+this.sync_parent.getStoreName()+":"+this.key+"}"});ydn.db.sync.Rest=function(a,b,c){this.storage=a;this.store=b;this.store_name=b.getName();if(goog.DEBUG){a="format readRequestTimeout writeRequestTimeout transport Options fetchStrategies baseUri immutable keepMeta metaStoreName metaDataName prefetch prefetchRefractoryPeriod".split(" ");for(var d in c)if(-1==goog.array.indexOf(a,d))throw new ydn.debug.error.ArgumentException('Unknown Sync attribute "'+d+'"  in Sync.');}this.immutable=!!c.immutable;this.format=c.format||"rest";this.baseUri=c.baseUri;
this.meta_store_name=c.metaStoreName||this.store_name;this.meta_data_field_name=c.metaDataName;this.inlinedMetaData=this.meta_store_name==this.store_name;a=c.Options||{};if(goog.DEBUG){if(!this.meta_store_name)throw new ydn.debug.error.ArgumentException("metadata store name required.");b=this.getOptionFieldNames();for(d in a)if(-1==goog.array.indexOf(b,d))throw new ydn.debug.error.ArgumentException('Unknown Sync.Options attribute "'+d+'" in Sync.Options');}this.delimiter=a.delimiter||"";this.uriPrefix=
a.prefix||"";this.keep_meta=!!c.keepMeta;this.prefetch=c.prefetch||goog.isNumber(c.prefetchRefractoryPeriod)?"full":null;this.refractory_period=goog.isNumber(c.prefetchRefractoryPeriod)?c.prefetchRefractoryPeriod:5E3;this.transport=ydn.client.GapiClient.wrap(c.transport);this.key_paths=new ydn.db.sync.KeyPath(this.getDefaultKeyPaths(),c.metaData);this.df_prefetch_=null;this.last_prefetch_=NaN};ydn.db.sync.Rest.DEFAULT_READ_REQUEST_TIMEOUT=1E3;ydn.db.sync.Rest.DEFAULT_WRITE_REQUEST_TIMEOUT=3E4;
ydn.db.sync.Rest.prototype.getDefaultKeyPaths=function(){var a={},b;for(b in ydn.db.sync.KeyPath.Key)a[b]=b;return a};ydn.db.sync.Rest.prototype.getOptionFieldNames=function(){return[]};ydn.db.sync.Rest.prototype.getUriPrefix=function(){return this.uriPrefix};ydn.db.sync.Rest.prototype.getDelimiter=function(){return this.delimiter};ydn.db.sync.Rest.prototype.isImmutable=function(){return this.immutable};ydn.db.sync.Rest.prototype.getKeyPaths=function(){return this.key_paths};
ydn.db.sync.Rest.prototype.getStoreName=function(){return this.store_name};ydn.db.sync.Rest.prototype.getMetaStoreName=function(){return this.meta_store_name};ydn.db.sync.Rest.prototype.getMetaDataFieldName=function(){return this.meta_data_field_name};ydn.db.sync.Rest.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.Rest");ydn.db.sync.Rest.prototype.hasStrategy=function(a){return 0<=goog.array.indexOf(this.fetchStrategies,a)};ydn.db.sync.Rest.prototype.getBaseUri=function(){return this.baseUri};
ydn.db.sync.Rest.prototype.getTransport=function(){this.transport||(this.transport=new ydn.client.SimpleClient);return this.transport};goog.DEBUG&&(ydn.db.sync.Rest.prototype.toString=function(){return"sync:"+this.store_name});ydn.db.sync.Rest.prototype.serverList=function(a,b){a.callback(null)};
ydn.db.sync.Rest.prototype.putMetaToDB=function(a){goog.asserts.assert(!this.inlinedMetaData,"putMetaToDB must use only for out-of-line metadata store");return this.storage.getCoreOperator().dumpInternal(this.getMetaStoreName(),a).addErrback(function(a){throw a;})};
ydn.db.sync.Rest.prototype.ensurePrimaryKey=function(a,b){goog.asserts.assertObject(a,this+" object not defined");if(this.store.usedInlineKey()){var c=this.store.extractKey(a);goog.isDefAndNotNull(c)?goog.isDefAndNotNull(b)&&goog.asserts.assert(c==b,this+" "+c+" must equals to "+b):goog.isDefAndNotNull(b)?(c=this.store.getKeyPath(),goog.asserts.assertString(c),ydn.db.utils.setValueByKeys(a,c,b)):goog.asserts.assert(!1,this+" primary key must be specified")}};
ydn.db.sync.Rest.prototype.putToDB=function(a,b,c){c=this.store.usedInlineKey()?void 0:c;if(b){if(this.inlinedMetaData){for(f=0;f<a.length;f++)goog.isDefAndNotNull(b[f])&&goog.object.extend(a[f],b[f]);return this.storage.getCoreOperator().dumpInternal(this.store_name,a,c)}if(a){goog.asserts.assert(a.length==b.length);for(var d=[],e=a.concat(b),f=0;f<a.length;f++){var g=this.store.usedInlineKey()?NaN:c[f];d.push(new ydn.db.Key(this.store_name,g))}for(f=0;f<b.length;f++)d.push(new ydn.db.Key(this.meta_store_name,
NaN));return this.storage.getCoreOperator().dumpInternal(d,e)}return this.storage.getCoreOperator().dumpInternal(this.meta_store_name,b)}goog.asserts.assertArray(a,"putToDB:"+this.store_name);for(f=0;f<a.length;f++)g=c?c[f]:void 0,this.ensurePrimaryKey(a[f],g);return this.storage.getCoreOperator().dumpInternal(this.store_name,a,c)};ydn.db.sync.Rest.prototype.removeFromDb=function(a){var b=[new ydn.db.Key(this.store_name,a)];this.inlinedMetaData||b.push(new ydn.db.Key(this.meta_store_name,a));return this.storage.getCoreOperator().removeInternalByKeys(b)};
ydn.db.sync.Rest.prototype.getFetchUrl=function(a){var b=[];if(a)for(var c in a)b.push(c+"="+a[c]);return 0<b.length?this.baseUri+"?"+b.join("&"):this.baseUri};ydn.db.sync.Rest.prototype.getEntriesFromFeed=function(a){if(!a)return[];a=a.entry;return goog.isArray(a)?a:a?[a]:[]};ydn.db.sync.Rest.prototype.id2uri=function(a){return this.getBaseUri()+a};
ydn.db.sync.Rest.prototype.toUri=function(a,b){if(goog.isDefAndNotNull(a)){var c=ydn.db.sync.KeyPath.Key.URI;if(c&&(c=ydn.db.utils.getValueByKeys(a,c),goog.isString(c)))return c}if(goog.isString(b))return this.id2uri(b);if(goog.isObject(a))return c=a[ydn.db.sync.KeyPath.Key.KEY],goog.asserts.assertString(c),this.id2uri(c);throw new ydn.debug.error.ArgumentException("object must have URI, KEY attribute or a Key must be given");};ydn.db.sync.Rest.Precondition={ETAG:"e",UPDATED:"u",NONE:""};
ydn.db.sync.Rest.prototype.add=function(a,b,c){goog.asserts.assertObject(b,this+" cannot add no object");goog.isDefAndNotNull(c)?this.ensurePrimaryKey(b,c):this.store.usedInlineKey()&&(a=this.store.extractKey(b),goog.asserts.assertString(a,"in-line key not found in the object"),c=a);goog.asserts.assert(goog.isDefAndNotNull(c),"no key provided");var d=this.buildEntry(c,b),e=this;d.putServer(function(a){201==a||200==a?(e.logger.finest(d+" created"),d.save(!0)):e.logger.warning("Unexpected respond "+
a+" for add "+d)})};ydn.db.sync.Rest.prototype.loadMeta=function(a,b,c){var d=new ydn.db.Key(this.meta_store_name,a);this.valuesByKeys([d]).addCallbacks(function(d){d=new ydn.db.sync.entry.MetaData(a,d[0],this.key_paths,this.meta_data_field_name);b.call(c,d)},function(a){this.logger.warning(this+" error loading meta data "+a);b.call(c,null)},this)};
ydn.db.sync.Rest.prototype.loadMetas=function(a,b){var c=a.map(function(a){return new ydn.db.Key(this.meta_store_name,a)});this.valuesByKeys(c).addCallbacks(function(c){for(var e=[],f=0;f<a.length;f++)e[f]=new ydn.db.sync.entry.MetaData(a[f],c[f],this.key_paths,this.meta_data_field_name);b(e)},function(a){this.logger.warning(this+" error loading meta data "+a);b([])},this)};
ydn.db.sync.Rest.prototype.load=function(a,b,c){var d=this.getMetaStoreName(),e=this.getStoreName();goog.asserts.assertString(e);e=[new ydn.db.Key(e,a)];this.inlinedMetaData||e.push(new ydn.db.Key(d,a));this.valuesByKeys(e).addCallbacks(function(d){var e=d[0];d=new ydn.db.sync.entry.MetaData(a,this.inlinedMetaData?e:d[1],this.key_paths,this.meta_data_field_name);b.call(c,e,d)},function(a){this.logger.warning(this+" error loading meta data "+a);b.call(c,null,null)},this)};
ydn.db.sync.Rest.prototype.valuesByKeys=function(a){return this.storage.getCoreOperator().valuesInternal(a)};
ydn.db.sync.Rest.prototype.get=function(a,b){a.await(function(c,d,e){if(d)e(c,d);else{a.notify(c);var f=goog.isDef(c);if(f&&this.immutable)e(c);else{var g=this.buildEntry(b,c);g.getDbValue();g.readServer(function(a){if(304==a){if(e(c),!f)throw new ydn.debug.error.InternalError(g+" not modified, but not exist in server");}else if(200==a)g.save().addBoth(function(a){e(g.getServerValue())});else if(404==a)g.removeDatabase().addBoth(function(a){e(g.getServerValue())});else throw e(g.getServerValue()),
new ydn.debug.error.InvalidOperationException("Invalid HTTP respond "+a+" for GET "+b);},this)}}},this)};
ydn.db.sync.Rest.prototype.processEntries=function(a,b,c,d,e,f){var g=this.logger;this.logger.finer(c.length+", "+d.length+", "+e.length+", "+f.length+" records to fetch, update, delete, save");var h=c.length+d.length+e.length+f.length;if(0==h)a(b);else{var k=!1,l=function(){h--;0==h&&(a(b,k),a=null)};for(f=0;f<c.length;f++){var m=this.buildEntry(c[f]);m.index=f;m.readServer(function(a){200==a?(g.finest("A new "+this+" received from server"),this.save().addCallbacks(function(a){b[this.index]=this.getServerValue();
l()},function(a){k=!0;l()},this)):304==a?this.save(!0).addCallbacks(function(a){g.finest(this+" expires date updated");l()},function(a){k=!0;l()},this):(g.warning("Invalid status "+a+" for fetching "+this),l())},m)}for(f=0;f<d.length;f++)m=this.buildEntry(d[f]),m.index=f,m.load(function(){this.readServer(function(a){200==a?(g.finest(this+" updated from server"),this.save().addCallbacks(function(a){b[this.index]=this.getServerValue();l()},function(a){k=!0;l()},this)):(g.warning("Invalid status "+a+
" for fetching "+this),l())})});for(f=0;f<e.length;f++)m=this.buildEntry(e[f]),m.index=f,m.removeDatabase().addCallbacks(function(a){a=new ydn.db.sync.Conflict(m,null);b[this.index]=a;l()},function(a){k=!0;l()},m)}};
ydn.db.sync.Rest.prototype.valuesByIds=function(a,b){a.await(function(c,d,e){if(d)e(c,d);else if(goog.array.every(c,function(a){return goog.isDef(a)})&&this.immutable)e(c);else{a.notify(c);var f=c.length;for(d=0;d<b.length;d++)if(this.immutable&&goog.isDef(c[d]))f--,0==f&&e(c);else{var g=this.buildEntry(b[d],c[d]);g.index=d;g.readServer(function(a){200==a?(c[this.index]=this.getServerValue(),this.save()):404==a&&(c[this.index]=void 0);f--;0==f&&e(c)},g)}}},this)};
ydn.db.sync.Rest.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.Rest(this,a,b)};ydn.db.sync.Rest.prototype.count=function(a){return a};ydn.db.sync.Rest.prototype.listFromServer=function(a,b,c){throw new ydn.debug.error.NotSupportedException;};
ydn.db.sync.Rest.prototype.values=function(a,b,c){this.needPrefetch()?(this.logger.finest("prefetch queued"),a.await(function(d,e,f){a.notify(d);if(e)f(d,e);else this.onPreFetchReady(function(a){a?this.storage.getCoreOperator().listInternal(this.store_name,null,null,!1,b,c).addCallbacks(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(a){this.logger.warning(this+" prefetch fail");f(d)},this)},this)):this.listFromServer(a,b,c)};
ydn.db.sync.Rest.prototype.keys=function(a,b,c,d,e,f,g){a.await(function(h,k,l){a.notify(h);if(k)l(h,k);else this.onPreFetchReady(function(a){a?this.storage.getCoreOperator().keysInternal(this.store_name,b,c,d,e,f,g).addCallbacks(function(a){l(a)},function(a){l(a,!0)},this):l(h)},function(a){this.logger.warning(this+" prefetch fail");l(h)},this)},this)};ydn.db.sync.Rest.prototype.listByParent=function(a,b,c){};ydn.db.sync.Rest.prototype.getByIndex=function(a,b,c){};
ydn.db.sync.Rest.prototype.put=function(a,b,c){c=goog.isDef(c)?c:this.store.usedInlineKey()?this.store.extractKey(b):null;goog.asserts.assert(goog.isDefAndNotNull(c),"key must be provided");var d=this.buildEntry(c,b);a.addTxback(function(a){d.load()},this);a.await(function(c,f,g){a.notify(c);d.putServer(function(c){409==c?d.readServer(function(){var c=new ydn.db.sync.Conflict(d,b);a.notify(c);c.hasResolved()?g(c.getResolvedValue(),f):c.defaultPrevented()?(d.saveOldDbData(),g(null,f)):g(c.runDefault(),
f)}):200==c||201==c?(d.save(!0),g(b,f)):(this.logger.warning("Unexpected response for PUT: "+c),g(null,f))},this)},this)};
ydn.db.sync.Rest.prototype.remove=function(a,b){var c=this,d=this.buildEntry(b);d.load(function(){a.await(function(e,f,g){d.deleteServer(function(f){if(409==f){if(f=new ydn.db.sync.Conflict(d,null),a.notify(f),!f.hasResolved()){var k=new ydn.db.sync.ConflictEvent(c.storage,409,f);c.storage.dispatchDbEvent(k)}}else 200==f?c.logger.finest("Successfully deleted object "+b):(c.logger.warning("Unexpected response for DELETE: "+f+" "+b),a.notify(k));g(e)})})})};
ydn.db.sync.Rest.prototype.doPrefetch=function(){this.logger.finest("starting prefetch");var a=new goog.async.Deferred;this.storage.getCoreOperator().listInternal(this.store_name,"updated.$t",null,!0,1).addCallbacks(function(b){var c={};if(b=b[0])b=goog.object.getValueByKeys(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b;var d=this.getBaseUri(),e=this,c=new ydn.client.HttpRequestData(d,"GET",c);e.getTransport().request(c).execute(function(b,c){if(200==c.getStatus()){if(!b){var h=
c.getBody();goog.isString(h)&&(b=JSON.parse(h))}h=b.feed||b;goog.asserts.assert(h,"feed object missing on respond body of "+d);h=(h=h.entry)?goog.isArray(h)?h:[h]:[];0<h.length?e.putToDB(h).addBoth(function(){a.callback(!0)}):a.callback(!1)}else 302==c.getStatus()?a.callback():(h=e+": Invalid response status "+c.getStatus()+" on prefetching",e.logger.warning(h),a.errback(Error(h)))})},function(b){a.errback(b)},this);return a};
ydn.db.sync.Rest.prototype.needPrefetch=function(){return this.prefetch?this.last_prefetch_?goog.now()-this.last_prefetch_>this.refractory_period:!0:!1};
ydn.db.sync.Rest.prototype.onPreFetchReady=function(a,b,c){this.needPrefetch()?this.df_prefetch_?this.df_prefetch_.addCallbacks(a,b,c):(this.df_prefetch_=this.doPrefetch(),this.last_prefetch_=goog.now(),this.df_prefetch_.addCallbacks(a,b,c),this.df_prefetch_.addCallbacks(function(a){this.logger.finest("prefetch "+(a?"updated":"no update"));this.df_prefetch_=null},function(a){this.df_prefetch_=null;throw a;},this)):a.call(c,!1)};ydn.db.sync.Atom=function(a,b,c){ydn.db.sync.Rest.call(this,a,b,c);goog.asserts.assert(this.inlinedMetaData,"Atom datastore must use inline meta data");goog.asserts.assert(!this.meta_data_field_name,"meta data field name must not be defined for Atom datastore")};goog.inherits(ydn.db.sync.Atom,ydn.db.sync.Rest);ydn.db.sync.Atom.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.Atom");ydn.db.sync.Atom.DEBUG=!1;ydn.db.sync.Atom.prototype.getOptionFieldNames=function(){return ydn.db.sync.Atom.superClass_.getOptionFieldNames.call(this)};
ydn.db.sync.Atom.prototype.getEtag=function(a){var b=a[ydn.db.sync.KeyPath.Key.ETAG];goog.asserts.assertString(b,"etag missing in "+ydn.json.toShortString(a));return b};ydn.db.sync.Atom.prototype.getId=function(a){var b=a[ydn.db.sync.KeyPath.Key.KEY];goog.asserts.assertString(b,this+": ID missing in "+ydn.json.toShortString(a));return b};ydn.db.sync.Atom.prototype.getFetchUrl=function(a){var b=[];if(a)for(var c in a)b.push(c+"="+a[c]);return 0<b.length?this.baseUri+"?"+b.join("&"):this.baseUri};
ydn.db.sync.Atom.prototype.getEditLink=function(a){var b=ydn.atom.Link.getLink(a,ydn.atom.Link.Rel.EDIT);goog.DEBUG&&!b&&this.logger.warning("Edit link missing in "+ydn.json.toShortString(a));return b?b.href:""};ydn.db.sync.Atom.prototype.getUpdated=function(a){var b=a[ydn.db.sync.KeyPath.Key.UPDATED];goog.asserts.assertString(b,"updated date missing in "+ydn.json.toShortString(a));return b};
ydn.db.sync.Atom.prototype.getEntriesFromFeed=function(a){if(!a)return[];a=a.entry;return goog.isArray(a)?a:a?[a]:[]};ydn.db.sync.Atom.prototype.fetchEntriesFromFeed=function(a,b){var c=this.getEntriesFromFeed(a),d=this.getNextLink(a);b({entries:c,next:d})};ydn.db.sync.Atom.prototype.getNextLink=function(a){return(a=ydn.atom.Link.getLink(a,ydn.atom.Link.Rel.NEXT))?a.href:void 0};
ydn.db.sync.Atom.prototype.getSelfLink=function(a){var b=ydn.atom.Link.getLink(a,ydn.atom.Link.Rel.SELF);goog.DEBUG&&!b&&this.logger.warning("Edit link missing in "+ydn.json.toShortString(a));return b?b.href:void 0};ydn.db.sync.Atom.prototype.getUriAndEtag=function(a,b,c){c=this.getEditLink(b);b=this.getEtag(b);a(c,b)};ydn.db.sync.Atom.prototype.getMetaFromHeader=function(a,b){return{ID:a,etag:b.getHeader("etag")}};ydn.atom.Atom=function(a){this.data=a};ydn.atom.Atom.text=function(a){return{$t:a}};ydn.atom.Atom.content=function(a,b){return{$t:a,type:b}};ydn.atom.Atom.TYPE="ydn.atom.Atom";ydn.atom.Atom.prototype.getId=function(){return this.data.id.$t};ydn.atom.Atom.prototype.getTitle=function(){return this.data.title?this.data.title.$t:void 0};ydn.atom.Atom.prototype.getUpdated=function(){return this.data.updated.$t};ydn.atom.Atom.prototype.getUpdatedDate=function(){return new Date(this.getUpdated())};
ydn.atom.Atom.prototype.getLink=function(a){return ydn.atom.Link.getLink(this.data,a)};ydn.atom.Atom.prototype.getLinkEdit=function(){var a=this.getLink(ydn.atom.Link.Rel.EDIT);return a?a.href:void 0};ydn.atom.Atom.prototype.getLinkSelf=function(){var a=this.getLink(ydn.atom.Link.Rel.SELF);return a?a.href:void 0};ydn.atom.Atom.prototype.getLinkBatch=function(){var a=this.getLink(ydn.atom.Link.Rel.BATCH);return a?a.href:""};
ydn.atom.Atom.prototype.getContentType=function(){return this.data.content?this.data.content.type:void 0};ydn.atom.Atom.prototype.getContent=function(){return this.data.content||null};ydn.db.sync.entry.S3=function(a,b,c){ydn.db.sync.entry.Rest.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.S3,ydn.db.sync.entry.Rest);ydn.db.sync.entry.S3.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.entry.S3");ydn.db.sync.entry.S3.prototype.getS3Sync_=function(){return this.sync_parent};ydn.db.sync.entry.S3.prototype.getName=function(){return this.sync_parent.getUriPrefix()+this.key};ydn.db.sync.entry.S3.prototype.getKeyFromUri=function(a){return a.substring(this.sync_parent.getBaseUri().length)};
ydn.db.sync.entry.S3.prototype.newRequest=function(a,b,c,d){b=ydn.db.sync.entry.S3.superClass_.newRequest.call(this,a,b,c,d);if("PUT"==b.method||"POST"==b.method){c=(new goog.Uri(a)).getPath().substr(1);if(1>c.length)throw new ydn.debug.error.InvalidOperationException("invalid url "+a);b.headers.Key=c;a=b.headers["Content-Type"]||"application/json";d instanceof File?a=d.type:goog.isString(d)&&(a=/<*DOCTYPE html/i.test(d)?"text/html":"text/plain");b.headers.ContentType=a}return b};ydn.atom.Entry=function(a){ydn.atom.Atom.call(this,a)};goog.inherits(ydn.atom.Entry,ydn.atom.Atom);ydn.atom.Entry.TYPE="ydn.atom.Entry";ydn.atom.Entry.asText=function(a){return{$t:a}};ydn.gdata={};ydn.gdata.ExtendedProperty=function(a,b){this.xp_=a;this.parent_=b;this.data_=null};ydn.gdata.ExtendedProperty.REALM_SEP="^";ydn.gdata.ExtendedProperty.FIELD_SEP="|";ydn.gdata.ExtendedProperty.START_MARKER="^";ydn.gdata.ExtendedProperty.APP_NAME="c";ydn.gdata.ExtendedProperty.VERSION="0";ydn.gdata.ExtendedProperty.Realm={SUGAR:"s",HIGHRISE:"h",SALEFORE:"f"};
ydn.gdata.ExtendedProperty.ModuleKey={A:"Accounts",c:"Campaigns",C:"Contacts",E:"Employees",L:"Leads",O:"Opportunities",T:"Teams",U:"Users"};ydn.gdata.ExtendedProperty.KeyModule={Accounts:"A",Campaigns:"c",Contacts:"C",Employees:"E",Leads:"L",Opportunities:"O",Teams:"T",Users:"U"};ydn.gdata.ExtendedProperty.makeRealm=function(a,b,c){return a+b+(ydn.gdata.ExtendedProperty.KeyModule[c]||"")};ydn.gdata.ExtendedProperty.parseRealm=function(a){};
ydn.gdata.ExtendedProperty.indexRealm=function(a){a=a?a.gd$extendedProperty:null;if(!a)return[];a=(new ydn.gdata.ExtendedProperty(a)).getData_();return Object.keys(a)};ydn.gdata.ExtendedProperty.PREFIX=ydn.gdata.ExtendedProperty.START_MARKER+ydn.gdata.ExtendedProperty.APP_NAME+ydn.gdata.ExtendedProperty.VERSION;
ydn.gdata.ExtendedProperty.prototype.getData_=function(){if(!this.data_&&(this.data_={},this.xp_&&this.xp_.value&&this.xp_.value.charAt(0)==ydn.gdata.ExtendedProperty.START_MARKER))for(var a=this.xp_.value.substr(3).split(ydn.gdata.ExtendedProperty.REALM_SEP),b=0;b<a.length;b+=2)if(a[b]&&a[b+1]){var c=a[b],d={};d.domain=c.substr(1,c.length-2);var e=c.substr(c.length-1,1);d.module=ydn.gdata.ExtendedProperty.ModuleKey[e]||"";for(var e=a[b+1].split(ydn.gdata.ExtendedProperty.FIELD_SEP),f=0;f<e.length;f+=
2)e[f]&&(d[e[f]]=e[f+1]);this.data_[c]=d}return this.data_};ydn.gdata.ExtendedProperty.prototype.toJson=function(){if(this.data_){var a=[],b;for(b in this.data_){var c=[],d=this.data_[b],e;for(e in d)d.hasOwnProperty(e)&&(c.push(e),c.push(d[e]));a.push(b);a.push(c.join(ydn.gdata.ExtendedProperty.FIELD_SEP))}return{name:"yathit",value:ydn.gdata.ExtendedProperty.PREFIX+a.join(ydn.gdata.ExtendedProperty.REALM_SEP)}}return this.xp_};
ydn.gdata.ExtendedProperty.prototype.setRealm=function(a,b){this.getData_()[a]=b;this.xp_=this.toJson();this.parent_&&this.parent_.setExtProperty(this.xp_)};ydn.gdata.ExtendedProperty.prototype.getRealm=function(a){return this.getData_()[a]};ydn.gdata.ExtendedProperty.prototype.getAllRealmKeys=function(a,b){var c=this.getData_(),d=[],e=a+(b?b:""),f;for(f in c)goog.string.startsWith(f,e)&&d.push(f);return d};
ydn.gdata.ExtendedProperty.prototype.getAllRealm=function(a,b){var c=this.getData_(),d=[],e=a+(b?b:""),f;for(f in c)goog.string.startsWith(f,e)&&d.push(c[f]);return d};ydn.gdata.ExtendedProperty.prototype.getProperty=function(a,b){var c=this.getData_();return c[a]?c[a][b]:null};ydn.gdata.ExtendedProperty.prototype.setProperty=function(a,b,c){var d=this.getData_();d[a]||(d[a]={});d[a][b]=c;this.xp_=this.toJson();this.parent_&&this.parent_.setExtProperty(this.xp_)};ydn.gdata.base={};ydn.gdata.BatchType={INSERT:"insert",UPDATE:"update",DELETE:"delete",PATCH:"patch",QUERY:"query"};ydn.gdata.Kind={M8_CONTACT:"contact",M8_GROUP:"group",ANNOUNCEMENT:"announcement",ANNOUNCEMENTS_PAGE:"announcementspage",ATTACHMENT:"attachment",WEB_ATTACHMENT:"webattachment",FILE_CABINET_PAGE:"filecabinet",TEMPLATE:"template",LIST_PAGE:"listpage",WEB_PAGE:"webpage",ACL:"accessRule",SITE_ACL:"acl/site",SITE:"site",PAGE:"content",REVISION:"revision"};
ydn.gdata.base.CLIENT_SERVER_DISCREPANCY=1E4;ydn.gdata.Type={CONTACT:"m8",SITE:"sites"};ydn.gdata.base.logger=goog.debug.Logger.getLogger("ydn.gdata.base");
ydn.gdata.base.toKind=function(a){goog.asserts.assert(goog.array.contains([ydn.gdata.Kind.M8_CONTACT,ydn.gdata.Kind.M8_GROUP,ydn.gdata.Kind.ANNOUNCEMENT,ydn.gdata.Kind.ANNOUNCEMENTS_PAGE,ydn.gdata.Kind.FILE_CABINET_PAGE,ydn.gdata.Kind.LIST_PAGE,ydn.gdata.Kind.REVISION,ydn.gdata.Kind.ACL,ydn.gdata.Kind.SITE_ACL,ydn.gdata.Kind.PAGE,ydn.gdata.Kind.SITE,ydn.gdata.Kind.WEB_PAGE],a));return a};
ydn.gdata.base.toCategory=function(a){return{scheme:"http://schemas.google.com/g/2005#kind",term:"http://schemas.google.com/contact/2008#"+a}};ydn.gdata.base.toType=function(a){goog.asserts.assert(goog.array.contains([ydn.gdata.Type.CONTACT,ydn.gdata.Type.SITE],a),"invalid type: "+a);return a};ydn.gdata.base.feedUri2Type=function(a){if(/^https?:\/\/sites.google.com/.test(a))return ydn.gdata.Type.SITE;if(/^https?:\/\/www.google.com\/m8/.test(a))return ydn.gdata.Type.CONTACT};
ydn.gdata.base.getIdFromFeedUri=function(a){if(goog.isString(a)){var b=a.indexOf("?");0<=b&&(a=a.substring(0,b));return a.substring(a.lastIndexOf("/")+1,a.length)}if(a&&goog.isDef(a.id))return ydn.gdata.base.getIdFromFeedUri(a.id.$t);ydn.gdata.base.logger.warning("URI must be GData Object or string, but "+a);return""};ydn.gdata.base.json2atom_key=function(a){return a.replace(/\$/g,":")};ydn.gdata.xp={};ydn.gdata.xp.Source={};ydn.gdata.xp.ExtendedProperty=function(a,b){this.value=a||null;this.realm=b||null};ydn.gdata.xp.ExtendedProperty.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.xp.ExtendedProperty");ydn.gdata.xp.ExtendedProperty.prototype.tag="";ydn.gdata.xp.ExtendedProperty.prototype.getTag=function(){return this.tag};ydn.gdata.xp.ExtendedProperty.prototype.getValue=function(){return this.value||""};
ydn.gdata.xp.ExtendedProperty.prototype.toString=function(){return this.tag+":"+this.getValue()};ydn.gdata.xp.ExtendedProperty.prototype.get=function(){var a={value:this.getValue(),name:this.tag};goog.isDefAndNotNull(this.realm)&&(a.realm=this.realm);return a};ydn.gdata.xp.ExtendedProperty.prototype.toAtom=function(){var a="<gd:extendedProperty name='"+this.tag+"' value='"+this.getValue()+"'";goog.isDefAndNotNull(this.realm)&&(a+="realm='"+this.realm+"'");return a+"></gd:extendedProperty>"};
ydn.gdata.xp.Basic=function(a,b,c){ydn.gdata.xp.ExtendedProperty.call(this);this.ydn_update=goog.isString(b)&&!goog.string.isEmpty(b)?parseInt(b,10):NaN;this.unshared_since=goog.isString(c)&&!goog.string.isEmpty(c)?parseInt(c,10):NaN;this.props=a||[]};goog.inherits(ydn.gdata.xp.Basic,ydn.gdata.xp.ExtendedProperty);ydn.gdata.xp.Basic.VERSION="6";ydn.gdata.xp.Basic.TAG="s.ydn";ydn.gdata.xp.Basic.prototype.tag=ydn.gdata.xp.Basic.TAG;ydn.gdata.xp.Basic.SEP="|";
ydn.gdata.xp.Basic.prototype.getValue=function(){for(var a=isNaN(this.ydn_update)?"":this.ydn_update,b=isNaN(this.unshared_since)?"":this.unshared_since,c="",d=0;d<this.props.length;d++)c+=ydn.gdata.xp.Basic.SEP+this.props[d].getValue();return ydn.gdata.xp.Basic.VERSION+ydn.gdata.xp.Basic.SEP+a+ydn.gdata.xp.Basic.SEP+b+c};ydn.gdata.xp.Basic.prototype.count=function(){return this.props.length};ydn.gdata.xp.Basic.prototype.getProp=function(a){return this.props[a]};
ydn.gdata.xp.Basic.prototype.remove=function(a){return this.props.splice(a,1)};ydn.gdata.xp.Basic.prototype.add=function(a){for(var b=0;b<this.props.length;b++)if(this.props[b].isSame(a)){this.props.splice(b,1);break}return this.props.push(a)};ydn.gdata.xp.Basic.prototype.isShared=function(){return isNaN(this.unshared_since)};ydn.gdata.xp.Basic.prototype.getUpdated=function(){return this.ydn_update};ydn.gdata.xp.Basic.prototype.setUpdated=function(a){this.ydn_update=+a};ydn.gdata.xp.Shared=function(a){};
ydn.gdata.xp.Shared.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.xp.Shared");ydn.gdata.xp.Shared.Type={GROUP_SOURCE:"gs",GROUP_MIRROR:"gm",CONTACT_SOURCE:"cs",CONTACT_MIRROR:"cm"};ydn.gdata.xp.Shared.SEP="#";ydn.gdata.xp.Shared.PART_COUNT=0;ydn.gdata.xp.Shared.prototype.type="";ydn.gdata.SourceShareProperty=function(a){};ydn.gdata.xp.Shared.prototype.isSame=function(a){return!0};ydn.gdata.xp.Basic.prototype.setShared=function(a){this.unshared_since=a?NaN:goog.now()};
ydn.gdata.xp.Shared.prototype.toString=function(){return"prop:"+this.type.toUpperCase()};ydn.gdata.xp.Shared.prototype.getValue=function(){return this.type};ydn.gdata.xp.group={};ydn.gdata.GroupShare=function(a){ydn.gdata.xp.Shared.call(this,a);var b=a[ydn.gdata.xp.Shared.PART_COUNT];a=a[ydn.gdata.xp.Shared.PART_COUNT+1];goog.asserts.assertString(b);goog.asserts.assertString(a);this.setEmails(b.split(","),a.split(","))};goog.inherits(ydn.gdata.GroupShare,ydn.gdata.xp.Shared);ydn.gdata.GroupShare.PART_COUNT=ydn.gdata.xp.Shared.PART_COUNT+2;
ydn.gdata.GroupShare.prototype.setEmails=function(a,b){this.emails=a?goog.array.clone(a):[];this.entry_ids=b?goog.array.clone(b):[];!goog.isDef(b)&&0<this.emails.length&&(this.entry_ids.length=this.emails.length);goog.asserts.assert(this.emails.length==this.entry_ids.length,ydn.json.stringify(this.emails)+" != "+ydn.json.stringify(this.entry_ids));for(var c=this.emails.length-1;0<=c;c--){var d=!1;ydn.utils.isValidEmail(this.emails[c])||(this.emails[c]&&this.logger.warning("Ignoring invalid shared email: "+
this.emails[c]),d=!0);if(d||goog.string.isEmpty(this.emails[c])||c!=this.emails.indexOf(this.emails[c]))this.emails.splice(c,1),this.entry_ids.splice(c,1)}};ydn.gdata.GroupShare.prototype.getValue=function(){return ydn.gdata.GroupShare.superClass_.getValue.call(this)+ydn.gdata.xp.Shared.SEP+this.emails.join(",")+ydn.gdata.xp.Shared.SEP+this.entry_ids.join(",")};ydn.gdata.GroupShare.prototype.getEmails=function(){return goog.array.clone(this.emails)};ydn.gdata.GroupShare.prototype.getEntryIds=function(){return goog.array.clone(this.entry_ids)};
ydn.gdata.xp.group.Mirror=function(a){ydn.gdata.GroupShare.call(this,a);var b=a[ydn.gdata.GroupShare.PART_COUNT];a=a[ydn.gdata.GroupShare.PART_COUNT+1];goog.asserts.assertString(b);goog.asserts.assertString(a);this.origin_user_id=b;this.origin_id=a};goog.inherits(ydn.gdata.xp.group.Mirror,ydn.gdata.GroupShare);ydn.gdata.xp.group.Mirror.prototype.getOriginUserId=function(){return this.origin_user_id};ydn.gdata.xp.group.Mirror.prototype.getOriginId=function(){return this.origin_id};
ydn.gdata.xp.group.Mirror.prototype.getValue=function(){var a=this.origin_user_id||"",b=this.origin_id||"";return ydn.gdata.xp.group.Mirror.superClass_.getValue.call(this)+ydn.gdata.xp.Shared.SEP+a+ydn.gdata.xp.Shared.SEP+b};ydn.gdata.xp.group.Mirror.prototype.toString=function(){return ydn.gdata.xp.group.Mirror.superClass_.toString.call(this)+":"+this.origin_user_id+"-"+this.origin_id};ydn.gdata.xp.group.Mirror.prototype.type=ydn.gdata.xp.Shared.Type.GROUP_MIRROR;
ydn.gdata.xp.group.Source=function(a){ydn.gdata.GroupShare.call(this,a)};goog.inherits(ydn.gdata.xp.group.Source,ydn.gdata.GroupShare);ydn.gdata.xp.group.Source.prototype.type=ydn.gdata.xp.Shared.Type.GROUP_SOURCE;ydn.gdata.xp.group.Source.prototype.add=function(a,b){if(!ydn.utils.isValidEmail(a))return ydn.asserts.assert(!1,"Invalid email address: "+a),!1;a=goog.string.trim(a);for(var c=this.emails.length-1;0<=c;c--)if(this.emails[c]==a)return!1;this.emails.push(a);this.entry_ids.push(b);return!0};
ydn.gdata.xp.group.Source.prototype.remove=function(a){if(!ydn.utils.isValidEmail(a))return ydn.asserts.assert(!1,"Invalid email address: "+a),!1;a=goog.string.trim(a);for(var b=this.emails.length-1;0<=b;b--)if(this.emails[b]==a)return this.emails.splice(b,1),this.entry_ids.splice(b,1),!0;return!1};ydn.gdata.xp.group.Source.prototype.getValue=function(){return ydn.gdata.xp.group.Source.superClass_.getValue.call(this)};
ydn.gdata.xp.group.Source.prototype.toString=function(){return ydn.gdata.xp.group.Source.superClass_.toString.call(this)+":["+this.emails.join(",")+"]"};ydn.gdata.xp.contact={};
ydn.gdata.ContactShare=function(a){ydn.gdata.xp.Shared.call(this,a);var b=ydn.gdata.xp.Shared.PART_COUNT;this.group_id=a[b];b++;this.origin_group_id=a[b];b++;this.origin_group_user_id=a[b];ydn.asserts.assert(ydn.utils.isValidEmail(this.origin_group_user_id),"Invalid origin_group_user_id: "+this.origin_group_user_id);ydn.asserts.assert(!!this.origin_group_user_id==!!this.origin_group_id,"both must define or undefined: "+this.origin_group_user_id+"-"+this.origin_group_id+" in "+a.join(ydn.gdata.xp.Shared.SEP));
b++;this.parent=goog.isString(a[b])?a[b]:void 0;b++;this.parent_update=goog.isString(a[b])&&!goog.string.isEmpty(a[b])?parseInt(a[b],10):NaN};goog.inherits(ydn.gdata.ContactShare,ydn.gdata.xp.Shared);ydn.gdata.ContactShare.PART_COUNT=ydn.gdata.xp.Shared.PART_COUNT+5;ydn.gdata.ContactShare.prototype.isSame=function(a){return this.group_id===a.group_id||this.origin_group_id===a.origin_group_id&&this.origin_group_user_id===a.origin_group_user_id};
ydn.gdata.ContactShare.prototype.getValue=function(){var a=this.group_id||"",b=this.origin_group_id||"",c=this.origin_group_user_id||"",d=isNaN(this.parent_update)?"":this.parent_update,e=this.parent||"";return ydn.gdata.ContactShare.superClass_.getValue.call(this)+ydn.gdata.xp.Shared.SEP+a+ydn.gdata.xp.Shared.SEP+b+ydn.gdata.xp.Shared.SEP+c+ydn.gdata.xp.Shared.SEP+e+ydn.gdata.xp.Shared.SEP+d};
ydn.gdata.ContactShare.prototype.toString=function(){return ydn.gdata.ContactShare.superClass_.toString.call(this)+":"+this.group_id+":"+this.origin_group_user_id+"-"+this.origin_group_id};ydn.gdata.ContactShare.prototype.setSyncParent=function(a,b){goog.asserts.assertString(a);this.parent=a;this.parent_update=b};ydn.gdata.ContactShare.prototype.getSyncParent=function(){return this.parent};ydn.gdata.ContactShare.prototype.getSyncParentUpdated=function(){return this.parent_update};
ydn.gdata.xp.contact.Source=function(a){ydn.gdata.ContactShare.call(this,a)};goog.inherits(ydn.gdata.xp.contact.Source,ydn.gdata.ContactShare);ydn.gdata.xp.contact.Source.prototype.type=ydn.gdata.xp.Shared.Type.CONTACT_SOURCE;ydn.gdata.xp.contact.Source.prototype.getValue=function(){return ydn.gdata.xp.contact.Source.superClass_.getValue.call(this)};
ydn.gdata.xp.contact.Mirror=function(a){ydn.gdata.ContactShare.call(this,a);var b=a[ydn.gdata.ContactShare.PART_COUNT],c=a[ydn.gdata.ContactShare.PART_COUNT+1];ydn.asserts.assert(ydn.utils.isValidEmail(c),"Invalid origin_user_id: "+c);ydn.asserts.assert(!!c==!!b,"both must define or undefined: "+b+"-"+c+" in "+a.join(ydn.gdata.xp.Shared.SEP));this.origin_user_id=c||"";this.origin_entry_id=b||""};goog.inherits(ydn.gdata.xp.contact.Mirror,ydn.gdata.ContactShare);
ydn.gdata.xp.contact.Mirror.prototype.getValue=function(){var a=this.origin_user_id||"",b=this.origin_entry_id||"";ydn.asserts.assert(!!a==!!b,"both must define or undefined: "+b+"-"+a+" in "+this);return ydn.gdata.xp.contact.Mirror.superClass_.getValue.call(this)+ydn.gdata.xp.Shared.SEP+b+ydn.gdata.xp.Shared.SEP+a};ydn.gdata.xp.contact.Mirror.prototype.type=ydn.gdata.xp.Shared.Type.CONTACT_MIRROR;ydn.gdata.xp.parse=function(a){if(!goog.isString(a)||goog.string.isEmpty(a))return null;var b=a.split(ydn.gdata.xp.Basic.SEP),c=b.shift();if(c!=ydn.gdata.xp.Basic.VERSION)return ydn.gdata.base.logger.warning("Unsupported ExtProp version: "+c+" in "+a),null;a=b.shift();for(var c=b.shift(),d=[],e=0;e<b.length;e++){var f=b[e].split(ydn.gdata.xp.Shared.SEP),g=f.shift();g===ydn.gdata.xp.Shared.Type.GROUP_SOURCE?d.push(new ydn.gdata.xp.group.Source(f)):g===ydn.gdata.xp.Shared.Type.GROUP_MIRROR?d.push(new ydn.gdata.xp.group.Mirror(f)):
g===ydn.gdata.xp.Shared.Type.CONTACT_SOURCE?d.push(new ydn.gdata.xp.contact.Source(f)):g===ydn.gdata.xp.Shared.Type.CONTACT_MIRROR?d.push(new ydn.gdata.xp.contact.Mirror(f)):ydn.gdata.base.logger.warning("Unsupported ExtProp type: "+g+" of "+b[e])}return new ydn.gdata.xp.Basic(d,a,c)};ydn.gdata.GroupShare.parse=function(a){return(a=ydn.gdata.xp.parse(a))&&a.props[0]instanceof ydn.gdata.GroupShare?a.props[0]:null};ydn.xml={};
ydn.xml.namespaces={atom:"http://www.w3.org/2005/Atom",ydn:"http://www.yathit.com/2012/ydn",app:"http://www.w3.org/2007/app",openSearch:"http://a9.com/-/spec/opensearch/1.1/",gAcl:"http://schemas.google.com/acl/2007",sites:"http://schemas.google.com/sites/2008",gs:"http://schemas.google.com/spreadsheets/2006",dc:"http://purl.org/dc/terms",batch:"http://schemas.google.com/gdata/batch",gd:"http://schemas.google.com/g/2005",gContact:"http://schemas.google.com/contact/2008",thr:"http://purl.org/syndication/thread/1.0",xhtml:"http://www.w3.org/1999/xhtml"};
ydn.xml.nsResolver=function(a){return ydn.xml.namespaces[a]||ydn.xml.namespaces.atom};ydn.xml.insertNamespace=function(a,b){for(var c=a.indexOf(" "),d=0;d<b.length;d++){var e=b[d],f=0==d;goog.asserts.assertString(ydn.xml.namespaces[e]);e=(f?"xmlns":"xmlns:"+e)+'="'+ydn.xml.namespaces[e]+'"';-1==a.indexOf(e)&&(a=a.substring(0,c+1)+e+" "+a.substr(c+1))}return a};
ydn.xml.LoadError=function(a,b){this.stack=Error().stack||"";this.error_content=a;ydn.xml.logger.warning("Error loading xml: "+a);b&&(this.message=String(b))};goog.inherits(ydn.xml.LoadError,Error);ydn.xml.ParserError=function(a,b){ydn.xml.LoadError.call(this,a,b)};goog.inherits(ydn.xml.ParserError,ydn.xml.LoadError);ydn.xml.logger=goog.debug.Logger.getLogger("ydn.xml");
ydn.xml.getElement=function(a,b,c){goog.isDef(c)&&(b=c+":"+b);return"undefined"!=typeof a.selectSingleNode?(c=a.ownerDocument,"undefined"!=typeof c.setProperty&&c.setProperty("SelectionLanguage","XPath"),a.selectSingleNode(b)):document.implementation.hasFeature("XPath","3.0")?a.ownerDocument.evaluate(b,a,ydn.xml.resolveNS,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue:null};ydn.xml.getText=function(a,b,c){return(a=ydn.xml.getElement(a,b,c))?a.textContent:void 0};
ydn.xml.setText=function(a,b,c,d){var e=ydn.xml.getElement(a,b,d);e||(e=goog.isDef(d)?document.createElementNS(ydn.xml.resolveNS(d),b):document.createElement(b),a.appendChild(e));e.textContent=c};ydn.xml.getAttribute=function(a,b,c){return a.getAttribute(b)};ydn.xml.IterableNode=function(){};ydn.xml.IterableNode.prototype.iterateNext=function(){};
ydn.xml.getIterator=function(a,b,c){goog.isDef(c)&&(b=c+":"+b);return a.ownerDocument.evaluate(b,a,ydn.xml.resolveNS,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)};ydn.xml.getSnapshotIterator=function(a,b,c){goog.isDef(c)&&(b=c+":"+b);return a.ownerDocument.evaluate(b,a,ydn.xml.resolveNS,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null)};
ydn.xml.getElementsByXPath=function(a,b){if("undefined"!=typeof a.selectNodes){var c=goog.dom.getOwnerDocument(a);"undefined"!=typeof c.setProperty&&c.setProperty("SelectionLanguage","XPath");return a.selectNodes(b)}var c=[],d=ydn.xml.getIterator(a,b);if(d)for(var e=d.iterateNext();e;)c.push(e),e=d.iterateNext();return c};
ydn.xml.getElements=function(a,b,c){if("undefined"!=typeof a.selectNodes){var d=goog.dom.getOwnerDocument(a);"undefined"!=typeof d.setProperty&&d.setProperty("SelectionLanguage","XPath");return a.selectNodes(c?c+":"+b:b)}d=[];if(a=ydn.xml.getIterator(a,b,c))for(b=a.iterateNext();b;)d.push(b),b=a.iterateNext();return d};ydn.xml.countElements=function(a,b){var c=0,d=ydn.xml.getIterator(a,b);if(d)for(var e=d.iterateNext();e;)c++,e=d.iterateNext();return c};
ydn.xml.resolveNS=function(a){return ydn.xml.namespaces[a]||ydn.xml.namespaces.xhtml};ydn.xml.lookupNS=function(a){for(var b in ydn.xml.namespaces)if(ydn.xml.namespaces[b]===a)return b};ydn.xml.parse=function(a){var b=goog.dom.xml.loadXml(a);if(!b)throw new ydn.xml.LoadError(a,"Malformed xml");var c=ydn.xml.getElement(b.documentElement,"//xhtml:parsererror");if(c)throw new ydn.xml.ParserError(a,c.textContent);return b};
ydn.xml.loadFromUrl=function(a){ydn.xml.logger.finest("Loading XML file "+a);var b=new XMLHttpRequest;b.open("GET",a,!1);var c;b.onreadystatechange=function(a){if(4===b.readyState)if(200===b.status)c=b.responseXML;else throw Error("Error: "+b.statusText+"\n"+b.responseText);};b.send(null);return c};ydn.xml.Element=function(){};ydn.xml.Element.prototype.getElement=function(a,b){};ydn.xml.Element.prototype.getElementAt=function(a,b,c){};ydn.xml.Element.prototype.getElementAsText=function(a,b){};ydn.xml.Element.prototype.getElementByAttribute=function(a,b,c){};ydn.xml.Element.prototype.getChildElementByValue=function(a,b,c){};ydn.xml.Element.prototype.removeChild=function(a){};ydn.xml.Element.prototype.appendChild=function(a){};ydn.xml.Element.prototype.replaceChild=function(a,b){};
ydn.xml.Element.prototype.createChildElement=function(a,b){};ydn.xml.Element.prototype.createTextChildElement=function(a,b){};ydn.xml.Element.prototype.getName=function(){};ydn.xml.Element.prototype.getText=function(){};ydn.xml.Element.prototype.toXmlString=function(){};ydn.xml.Element.prototype.setText=function(a){};ydn.xml.Element.prototype.getAttribute=function(a){};ydn.xml.Element.prototype.setAttribute=function(a,b){};ydn.xml.Element.prototype.removeAttribute=function(a){};
ydn.xml.Element.prototype.countChildren=function(a,b){};ydn.xml.Element.prototype.getElements=function(a,b){};ydn.xml.Element.prototype.getChildrenNames=function(){};ydn.xml.Element.prototype.getAttributes=function(){};ydn.xml.Element.prototype.clone=function(a){};ydn.xml.Element.prototype.copy=function(a,b,c,d){};ydn.xml.Element.prototype.merge=function(a,b,c,d,e){};ydn.xml.Element.prototype.toJSON=function(){};ydn.xml.Element.prototype.toJsonData=function(){};
ydn.xml.Element.prototype.toElement=function(a){};
ydn.xml.Element.equals=function(a,b,c,d,e){e=!!e;if(a.getName()!=b.getName())return!1;if(!d){d=a.getAttributes();var f=b.getAttributes();if(!e&&d.length!=f.length||e&&f.length>d.length)return!1;for(d=0;d<f.length;d++)if(a.getAttribute(f[d])!=b.getAttribute(f[d]))return!1}var g=a.getChildrenNames(),f=b.getChildrenNames();if(c){for(d=g.length-1;0<=d;d--)!0!==c[g[d]]&&goog.array.remove(g,g[d]);for(d=f.length-1;0<=d;d--)!0!==c[f[d]]&&goog.array.remove(f,f[d])}if(!e&&g.length!=f.length||e&&f.length>g.length)return!1;
if(0==g.length||0==g.length)return a.getText()===b.getText();for(d=0;d<f.length;d++){c=a.getElements(f[d]);var h=b.getElements(f[d]);if(!e&&c.length!=h.length||e&&h.length>c.length)return!1;for(var k=0;k<h.length;k++)if(-1==goog.array.findIndex(c,function(a){return ydn.xml.Element.equals(a,h[k],void 0,void 0,e)}))return!1}return!0};ydn.xml.Element.isSubset=function(a,b,c,d){return ydn.xml.Element.equals(a,b,c,d,!0)};ydn.xml.JsonElement=function(a,b,c){if(goog.isDef(b))this.setTagName(b),goog.isDef(c)||(goog.asserts.assertObject(a,"parent must be specified if data is not specified"),c=a[b],goog.asserts.assertObject(c,a+" do not have "+b));else{goog.asserts.assert(!goog.isDef(c),"tagName must be specified.");for(var d in a)if(a.hasOwnProperty(d)&&goog.isObject(a[d])&&goog.isString(a[d].xmlns)){this.namespaceURI=[d].xmlns;this.setTagName(d);c=a[d];break}}goog.asserts.assertObject(c);this.data=c;this.parent=a};
ydn.xml.JsonElement.prototype.namespaceURI="http://www.w3.org/2005/Atom";ydn.xml.JsonElement.prototype.setTagName=function(a){goog.asserts.assert(!this.tagName,"Element must have only one tagName. "+a+"+"+this.tagName);goog.asserts.assertString(a);var b=a.split(":");1<b.length&&(this.namespaceURI=ydn.xml.resolveNS(b[0])||ydn.xml.JsonElement.prototype.namespaceURI,a=b[1]);this.tagName=a};ydn.xml.JsonElement.prototype.getNamespace=function(){return this.namespaceURI};
ydn.xml.JsonElement.prototype.resolveNamespace=function(a,b){var c=a;if(goog.isDef(b))"atom"!=b&&(c=b+"$"+a);else{var d=a.split(":"),c=a.replace(/:/,"$");2==d.length&&(b=d[0],a=d[1])}d=goog.isDef(b)?ydn.xml.resolveNS(b):void 0;return goog.isDef(this.data[a])&&goog.isDef(d)&&this.data[a].xmlns==d?a:c};
ydn.xml.JsonElement.prototype.getElement=function(a,b){var c=this.resolveNamespace(a,b);return goog.isArray(this.data[c])?new ydn.xml.JsonElement(this.data,c,this.data[c][0]):goog.isObject(this.data[c])?new ydn.xml.JsonElement(this.data,c,this.data[c]):null};ydn.xml.JsonElement.prototype.getElementAsText=function(a,b){var c=this.resolveNamespace(a,b);if(goog.isObject(this.data[c]))return this.data[c].$t};
ydn.xml.JsonElement.prototype.getElementAt=function(a,b,c){b=this.resolveNamespace(b,c);return goog.isArray(this.data[b])&&goog.isObject(this.data[b][a])?new ydn.xml.JsonElement(this.data,b,this.data[b][a]):0==a&&goog.isObject(this.data[b])?new ydn.xml.JsonElement(this.data,b,this.data[b]):null};
ydn.xml.JsonElement.prototype.createChildElement=function(a,b){var c=this.resolveNamespace(a,b);if(this.data[c])return goog.isArray(this.data[c])||(this.data[c]=[this.data[c]]),this.data[c].push({}),new ydn.xml.JsonElement(this.data,c,this.data[c][this.data[c].length-1]);this.data[c]={};return new ydn.xml.JsonElement(this.data,c,this.data[c])};ydn.xml.JsonElement.prototype.toString=function(){return"JsonElement:"+this.tagName};
ydn.xml.JsonElement.prototype.getElementByAttribute=function(a,b,c){a=a.replace(/:/,"$");var d=this.data[a];if(goog.isArray(d))for(var e=0;e<d.length;e++){if(d[e][b]==c)return new ydn.xml.JsonElement(this.data,a,d[e])}else if(goog.isObject(d)&&d[b]==c)return new ydn.xml.JsonElement(this.data,a,d);return null};
ydn.xml.JsonElement.prototype.getChildElementByValue=function(a,b,c){a=a.replace(/:/,"$");b=b.replace(/:/,"$");if(goog.isArray(this.data[a]))for(var d=0;d<this.data[a].length;d++){if(this.data[a][d][b]&&this.data[a][d][b].$t===c)return new ydn.xml.JsonElement(this.data,a,this.data[a][d])}else if(goog.isObject(this.data[a])&&goog.isObject(this.data[a][b])&&this.data[a][b].$t==c)return new ydn.xml.JsonElement(this.data,a,this.data[a]);return null};ydn.xml.JsonElement.prototype.getName=function(){return this.tagName};
ydn.xml.JsonElement.prototype.getText=function(){return this.data.$t};ydn.xml.JsonElement.prototype.setText=function(a){for(var b in this.data)this.data.hasOwnProperty(b)&&goog.isObject(this.data[b])&&delete this.data[b];this.data.$t=a};ydn.xml.JsonElement.prototype.getAttribute=function(a){a=a.replace(/:/,"$");return this.data[a]};ydn.xml.JsonElement.prototype.setAttribute=function(a,b){a=a.replace(/:/,"$");this.data[a]=b};
ydn.xml.JsonElement.prototype.removeAttribute=function(a){a=a.replace(/:/,"$");delete this.data[a]};ydn.xml.JsonElement.prototype.getAttributes=function(){var a=[],b;for(b in this.data)this.data.hasOwnProperty(b)&&goog.isString(this.data[b])&&"$t"!=b&&a.push(b);return a};
ydn.xml.JsonElement.prototype.getElements=function(a,b){goog.isDef(b)?a=b+"$"+a:goog.isDef(a)&&(a=a.replace(/:/,"$"));var c=[];if(goog.isDef(a)){var d=this.data[a];if(goog.isArray(d))for(var e=0;e<d.length;e++)c.push(new ydn.xml.JsonElement(this.data,a,d[e]));else goog.isObject(d)&&c.push(new ydn.xml.JsonElement(this.data,a,d))}else for(d in this.data)if(goog.isArray(this.data[d]))for(e=0;e<this.data[d].length;e++)c.push(new ydn.xml.JsonElement(this.data,d,this.data[d][e]));else goog.isObject(this.data[d])&&
c.push(new ydn.xml.JsonElement(this.data,d,this.data[d]));return c};ydn.xml.JsonElement.prototype.getChildrenNames=function(){var a=[],b;for(b in this.data)goog.isObject(this.data[b])&&a.push(b.replace("$",":"));return a};
ydn.xml.JsonElement.prototype.appendChild=function(a){goog.asserts.assertInstanceof(a,ydn.xml.JsonElement);var b=a.getName();goog.asserts.assertString(b,"tagName require in "+a);this.data[b]?(goog.isArray(this.data[b])||(this.data[b]=[this.data[b]]),this.data[b].push(ydn.object.clone(a.data))):this.data[b]=ydn.object.clone(a.data)};
ydn.xml.JsonElement.prototype.removeChild=function(a){goog.asserts.assertInstanceof(a,ydn.xml.JsonElement);if(a.parent!=this.data)throw Error("NOT_FOUND_ERR: JSON:DOM Exception 8: "+a+" not in "+this);var b=a.getName();goog.isArray(this.data[b])?(b=goog.array.remove(this.data[b],a.data),goog.asserts.assert(b,"NOT_FOUND_ERR: JSON:DOM Exception 8: "+a+" not in "+this)):delete this.data[b]};ydn.xml.JsonElement.prototype.replaceChild=function(a,b){this.removeChild(b);this.appendChild(a)};
ydn.xml.JsonElement.prototype.createTextChildElement=function(a,b){goog.asserts.assert(!goog.isArray(this.data),"cannot append text to array element");var c=new ydn.xml.JsonElement(this.data,a,{$t:b||""});this.appendChild(c);return c};
ydn.xml.JsonElement.prototype.update=function(a,b,c,d,e){var f=!1;c=c||{};var g=goog.isDef(b),h=!0===b||!g,k=!1===b;goog.asserts.assertInstanceof(a,ydn.xml.JsonElement);var l=this.getAttributes(),m=a.getAttributes();if(!g)for(var n=0;n<l.length;n++)goog.isDef(e)&&!e[l[n].replace("$",":")]||goog.array.contains(m,l[n])||(this.removeAttribute(l[n]),f=!0);for(n=0;n<m.length;n++){var p=a.getAttribute(m[n]);if(!goog.isDef(e)||e[m[n].replace("$",":")])goog.array.contains(l,m[n])?k||p==this.getAttribute(m[n])||
(this.setAttribute(m[n],p),f=!0):(this.setAttribute(m[n],p),f=!0)}if(0==a.countChildren()&&h&&(e=this.getText(),k=a.getText(),goog.isDef(k)&&e!=k))return this.setText(k),!0;if(!g)for(var q in this.data)d&&!d[q.replace("$",":")]||!goog.isObject(this.data[q])||goog.isObject(a.data[q])||(delete this.data[q],f=!0);q=a.getChildrenNames();for(e=0;e<q.length;e++)if(k=q[e],!d||!0==d[k]){var r=a.getElements(k),l=this.getElements(k),s=k.replace(":","$");if(1==r.length)0==l.length?(this.data[s]=ydn.object.clone(r[0].data),
f=!0):1==l.length?c[k]?h&&!ydn.xml.Element.isSubset(l[0],r[0])&&(goog.isArray(this.data[s])||(this.data[s]=[this.data[s]]),this.data[s].push(ydn.object.clone(r[0].data)),f=!0):f=l[0].update(r[0],b)||f:g?(k=goog.array.findIndex(l,function(a){return ydn.xml.Element.isSubset(a,r[0])}),-1==k&&h&&(this.data[s].push(ydn.object.clone(r[0].data)),f=!0)):(this.data[s]=ydn.object.clone(r[0].data),f=!0);else if(!goog.isArray(this.data[s]))if(h)this.data[s]=ydn.object.clone(a.data[s]),f=!0;else{if(g){l=ydn.object.clone(a.data[s]);
goog.asserts.assertArray(l);var t=this,k=goog.array.findIndex(l,function(a){return ydn.object.equals(t.data[s],a)});-1==k&&(l.push(this.data[s]),this.data[s]=l,f=!0)}}else if(h)for(l.length>r.length&&(this.data[s].splice(r.length,l.length-r.length),f=!0),n=0;n<r.length;n++)goog.isDef(l[n])?ydn.object.equals(l[n].data,r[n].data)||(this.data[s][n]=ydn.object.clone(r[n].data),f=!0):(this.data[s][n]=ydn.object.clone(r[n].data),f=!0);else if(g)for(n=0;n<a.data[s].length;n++)k=goog.array.findIndex(this.data[s],
function(b){return ydn.object.equals(a.data[s][n],b)}),-1==k&&(this.data[s].push(ydn.object.clone(a.data[s][n])),f=!0)}return f};ydn.xml.JsonElement.prototype.copy=function(a,b,c,d){return this.update(a,void 0,b,c,d)};ydn.xml.JsonElement.prototype.merge=function(a,b,c,d,e){goog.isDef(b)||(b=!1);return this.update(a,b,c,d,e)};ydn.xml.JsonElement.prototype.toJSON=function(){return{data:this.data,tagName:this.tagName}};ydn.xml.JsonElement.prototype.toJsonData=function(){return this.data||{}};
ydn.xml.JsonElement.fromJSON=function(a){return new ydn.xml.JsonElement(null,a.tagName,a.data)};
ydn.xml.JsonElement.prototype.toXmlString=function(){var a=goog.dom.xml.createDocument(this.getName(),this.getNamespace()),b=function(a,b){for(var c in b)b.hasOwnProperty(c)&&"$t"!=c&&goog.isString(b[c])&&a.setAttribute(c.replace("$",":"),b[c])},c=function(b){return a.createElement(b.replace("$",":"))},d=function(e,f){b(f,e);var g,h;for(h in e)if(e.hasOwnProperty(h)&&!goog.isString(e[h]))if(goog.isString(e[h].$t)&&"xhtml"==e[h].type){g=c(h);b(g,e[h]);var k=goog.dom.xml.loadXml(e[h].$t);a.importNode(k.documentElement,
!0);g.appendChild(k.documentElement);f.appendChild(g)}else if(goog.isString(e[h].$t))g=c(h),g.textContent=e[h].$t,b(g,e[h]),f.appendChild(g);else if(goog.isArray(e[h])&&e[h][0]&&goog.isString(e[h][0].$t))for(k=0;k<e[h].length;k++)g=c(h),g.textContent=e[h][k].$t,b(g,e[h][k]),f.appendChild(g);else if(goog.isArray(e[h]))for(k=0;k<e[h].length;k++)g=c(h),f.appendChild(g),d(e[h][k],g);else goog.isObject(e[h])&&(g=c(h),f.appendChild(g),d(e[h],g))};d(this.data,a.documentElement);return goog.dom.xml.serialize(a.documentElement)};
ydn.xml.JsonElement.prototype.countChildren=function(a,b){goog.isDef(b)?a=b+"$"+a:goog.isDef(a)&&(a=a.replace(/:/,"$"));var c=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(goog.isArray(a[c])?b+=a[c].length:goog.isObject(a[c])&&b++);return b};return goog.isDef(a)?goog.isArray(this.data[a])?this.data[a].length:goog.isObject(this.data[a])?c(this.data[a]):0:c(this.data)};
ydn.xml.JsonElement.parse=function(a){a=ydn.json.parse(a);for(var b in a)if(a.hasOwnProperty(b)&&goog.isObject(a[b]))return new ydn.xml.JsonElement(a,b);throw Error("root tagName not found.");};ydn.xml.JsonElement.prototype.clone=function(a){var b={};if(goog.isDef(a))for(var c in this.data){var d=c.replace("$",":");goog.isString(this.data[c])?b[c]=this.data[c]:!0==a[d]&&(b[c]=ydn.object.clone(this.data[c]))}else b=ydn.object.clone(this.data);return new ydn.xml.JsonElement(null,this.tagName,b)};
ydn.xml.JsonElement.prototype.toElement=function(a){var b=a.ownerDocument.createElementNS(this.getNamespace(),this.getName()),c;for(c in this.data)if(this.data.hasOwnProperty(c)){var d=c.replace("$",":");if(goog.isString(this.data[c]))"$t"==c?b.textContent=this.data[c]:(d=b.ownerDocument.createAttribute(d),d.nodeValue=this.data[c],b.setAttributeNode(d));else if(goog.isArray(this.data[c]))for(var e=0;e<this.data[c].length;e++){var f=new ydn.xml.JsonElement(this.data[c],d,this.data[c][e]);f.toElement(b)}else goog.isObject(this.data[c])&&
(f=new ydn.xml.JsonElement(this.data,d,this.data[c]),f.toElement(b))}return a.appendChild(b)};ydn.gdata.Entry=function(a){var b;if(goog.isDef(a.id))b=a.id.$t;else if(goog.isDef(a.batch$id))b=a.batch$id.$t;else if(goog.isDef(a.gd$batch))b=a.gd$batch.$t;else throw new ydn.error.ArgumentException("id or batch:id required.");goog.asserts.assertString(b,"Invalid GDataEntry: "+ydn.json.stringify(a));this.id=b;this.last_commit=void 0;ydn.atom.Entry.call(this,a)};goog.inherits(ydn.gdata.Entry,ydn.atom.Entry);ydn.gdata.Entry.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.Entry");
ydn.gdata.Entry.XMLNS='xmlns="http://www.w3.org/2005/Atom" xmlns:gd="http://schemas.google.com/g/2005"';ydn.gdata.Entry.prototype.getType=function(){return this.type};ydn.gdata.Entry.prototype.getKind=function(){return this.kind};ydn.gdata.Entry.prototype.getData=function(){return this.data};ydn.gdata.Entry.prototype.getTitle=ydn.atom.Atom.prototype.getTitle;ydn.gdata.Entry.prototype.getId=function(){return this.id};
ydn.gdata.Entry.prototype.getEntryId=function(){return this.data.id?this.data.id.$t:void 0};ydn.gdata.Entry.prototype.getSingleId=function(){return this.id.match(/\w+$/)[0]};ydn.gdata.Entry.prototype.getEtag=function(){return this.getData().gd$etag};ydn.gdata.Entry.prototype.getExtProperty=function(){this.data.gd$extendedProperty||(this.data.gd$extendedProperty={});return new ydn.gdata.ExtendedProperty(this.data.gd$extendedProperty,this)};
ydn.gdata.Entry.prototype.getBatchId=function(){return this.data.batch$id?this.data.batch$id.$t:void 0};ydn.gdata.Entry.STATUS={NONE:"",DELETE:"delete",DELETED:"deleted",GD_DELETED:"gd:deleted",MODIFIED:"modified",COMMITTED:"committed"};ydn.gdata.Entry.TAGNAME_STATUS="status";ydn.gdata.Entry.BatchType={INSERT:"insert",UPDATE:"update",DELETE:"delete",PATCH:"patch",QUERY:"query"};
ydn.gdata.Entry.toBatchType=function(a){goog.asserts.assert(goog.array.contains([ydn.gdata.Entry.BatchType.INSERT,ydn.gdata.Entry.BatchType.PATCH,ydn.gdata.Entry.BatchType.UPDATE,ydn.gdata.Entry.BatchType.DELETE,ydn.gdata.Entry.BatchType.QUERY],a));return a};
ydn.gdata.Entry.prototype.normalize=function(){for(var a=0;a<this.array_fields.length;a++)goog.isDefAndNotNull(this.data[this.array_fields[a]])&&!goog.isArray(this.data[this.array_fields[a]])&&(this.data[this.array_fields[a]]=[this.data[this.array_fields[a]]]);this.removeStatus();a=this.getData();a.batch$status&&(a.batch$status=void 0);a.batch$operation&&(a.batch$operation=void 0)};ydn.gdata.Entry.prototype.array_fields=["link","category"];
ydn.gdata.Entry.prototype.identifier_fields=["id","batch$id","link","category"];ydn.gdata.Entry.prototype.getContent=ydn.atom.Atom.prototype.getContent;ydn.gdata.Entry.setEntryStatus=function(a,b){a[ydn.gdata.Entry.TAGNAME_STATUS]=b==ydn.gdata.Entry.STATUS.NONE?void 0:b};ydn.gdata.Entry.prototype.setEntryStatus=function(a){if(a)ydn.gdata.Entry.setEntryStatus(this.getData(),a);else{var b=this.getData();b[ydn.gdata.Entry.TAGNAME_STATUS]&&(b[ydn.gdata.Entry.TAGNAME_STATUS]=a)}};
ydn.gdata.Entry.getEntryStatus=function(a){return goog.isDef(a.gd$deleted)?ydn.gdata.Entry.STATUS.GD_DELETED:(a=a[ydn.gdata.Entry.TAGNAME_STATUS])?a:ydn.gdata.Entry.STATUS.NONE};ydn.gdata.Entry.prototype.getEntryStatus=function(){return ydn.gdata.Entry.getEntryStatus(this.getData())};ydn.gdata.Entry.prototype.deleteEntry=function(){this.setEntryStatus(ydn.gdata.Entry.STATUS.DELETE)};ydn.gdata.Entry.prototype.hasDeleted=function(){return this.getEntryStatus()==ydn.gdata.Entry.STATUS.DELETE};
ydn.gdata.Entry.prototype.setDeleted=function(){this.setEntryStatus(ydn.gdata.Entry.STATUS.DELETED)};ydn.gdata.Entry.prototype.wasDeleted=function(){return this.getEntryStatus()==ydn.gdata.Entry.STATUS.DELETED};ydn.gdata.Entry.prototype.isDeleted=function(){return this.getEntryStatus()==ydn.gdata.Entry.STATUS.GD_DELETED};ydn.gdata.Entry.prototype.isEditable=function(){return!this.isDeleted()&&!this.wasDeleted()&&this.canModify()};
ydn.gdata.Entry.prototype.notDeleted=function(){return!this.isDeleted()&&!this.wasDeleted()};ydn.gdata.Entry.prototype.setCommitted=function(){this.setEntryStatus(ydn.gdata.Entry.STATUS.COMMITTED)};ydn.gdata.Entry.prototype.clearStatus=function(){this.setEntryStatus(ydn.gdata.Entry.STATUS.NONE)};ydn.gdata.Entry.prototype.removeStatus=function(){this.setEntryStatus(null)};
ydn.gdata.Entry.prototype.getBatchOperationType=function(){var a=this.getData().batch$operation,a=a?a.type:void 0;return goog.isDef(a)?ydn.gdata.Entry.toBatchType(a):void 0};ydn.gdata.Entry.prototype.getBatchStatus=function(){return this.data.batch$status};ydn.gdata.Entry.prototype.getBatchStatusCode=function(){var a=this.getBatchStatus();return a?a.code:void 0};ydn.gdata.Entry.prototype.getBatchStatusReason=function(){var a=this.getBatchStatus();return a?a.reason:void 0};
ydn.gdata.Entry.prototype.setTitle=function(a){throw new ydn.error.NotImplementedException;};ydn.gdata.Entry.prototype.setModified=function(){var a=this.getEntryStatus();a==ydn.gdata.Entry.STATUS.DELETE?this.logger.warning(this+" marked for deletion. Cannot mark modify flag."):a==ydn.gdata.Entry.STATUS.COMMITTED?this.logger.severe(this+" already committed. All changes must wait until updated from the server."):this.setEntryStatus(ydn.gdata.Entry.STATUS.MODIFIED)};
ydn.gdata.Entry.prototype.canModify=function(){return this.getEntryStatus()!=ydn.gdata.Entry.STATUS.COMMITTED};
ydn.gdata.Entry.prototype.setExtProp=function(a,b){for(var c=goog.isArray(this.data.gd$extendedProperty)?this.data.gd$extendedProperty:this.data.gd$extendedProperty?[this.data.gd$extendedProperty]:[],d=0;d<c.length;d++)if(a.getTag()==c[d].name){var e=a.getValue();return e!=c[d].value?(c[d].value=e,b||this.setModified(),!0):!1}c={name:a.getTag(),value:a.getValue()};goog.isDef(this.data.gd$extendedProperty)?goog.isArray(this.data.gd$extendedProperty)||(this.data.gd$extendedProperty=[this.data.gd$extendedProperty]):
this.data.gd$extendedProperty=[];this.data.gd$extendedProperty.push(c);b||this.setModified();return!0};ydn.gdata.Entry.prototype.setExtProperty=function(a,b){this.data.gd$extendedProperty=a;b||this.setModified();return!0};
ydn.gdata.Entry.prototype.removeExtendedProperty=function(a,b,c){var d=goog.isArray(this.data.gd$extendedProperty)?this.data.gd$extendedProperty:this.data.gd$extendedProperty?[this.data.gd$extendedProperty]:[];if(goog.isArray(this.data.gd$extendedProperty))for(var e=0;e<d.length;e++){var f=d[e],g=goog.isDef(c)?f.realm===c:!0,h=goog.isDef(b)?f.value===b:!0;if(f.name===a&&g&&h)return goog.array.removeAt(this.data.gd$extendedProperty,e),!0}else if(this.data.gd$extendedProperty&&(f=this.data.gd$extendedProperty,
g=goog.isDef(c)?f.realm===c:!0,h=goog.isDef(b)?f.value===b:!0,f.name===a&&g&&h))return delete this.data.gd$extendedProperty,!0;return!1};ydn.gdata.Entry.prototype.http_client_=null;ydn.gdata.Entry.prototype.getClient=function(){return this.http_client_?this.http_client_:ydn.client.getClient(ydn.http.Scopes.GSE)};
ydn.gdata.Entry.prototype.commit=function(){if(!this.isDirty())throw Error("nothing to commit");var a=new goog.async.Deferred;ydn.gdata.Entry.commit(this.getClient(),this,function(b,c){if(c.isSuccess())a.callback(b);else{var d=c.getBody();if(goog.isString(d)&&/html/.test(c.getHeader("content-type")))try{var e=(new DOMParser).parseFromString(d,"text/html");e.body&&(d=e.body.innerHTML)}catch(f){}a.errback(c.getStatus()+" "+c.getStatusText()+" "+d)}},this);return a};
ydn.gdata.Entry.commit=function(a,b,c,d){goog.asserts.assertInstanceof(b,ydn.gdata.Entry);if(b.isDirty()){var e={"Content-Type":"application/atom+xml"};b.gdata_version&&(e["GData-Version"]=b.gdata_version);var f={},g="POST",h=b.getFeedUri(),h=h.replace("%40","@"),k=b.getLinkEdit();k&&(g=b.hasDeleted()?"DELETE":"PUT",h=k);try{var l=b.toXmlString()}catch(m){ydn.debug.ILogger.log({"class":"ydn.gdata.Entry",method:"ydn.gdata.Entry.commit","entry.data":b.getData(),context:"toXmlString",error:{name:m.name,
message:m.message,stack:m.stack}})}l=ydn.gdata.Entry.insertNamespaceFor(l,b.type);ydn.gdata.Entry.DEBUG&&(b.last_commit=[h,f,g,e,l],ydn.gdata.Entry.last_commit_entry=b);b=new ydn.client.HttpRequestData(h,g,f,e,l);a.request(b).execute(c,d)}else b.logger.finer(b+" commit ignore since not modified."),c&&c.call(d,null,null)};ydn.gdata.Entry.isDirty=function(a){if(!goog.isDefAndNotNull(a.id))return!0;a=ydn.gdata.Entry.getEntryStatus(a);return a===ydn.gdata.Entry.STATUS.MODIFIED||a===ydn.gdata.Entry.STATUS.DELETE};
ydn.gdata.Entry.prototype.isDirty=function(){return ydn.gdata.Entry.isDirty(this.getData())};ydn.gdata.Entry.prototype.getDataForXml=function(){return this.data};
ydn.gdata.Entry.prototype.toXmlString=function(a){var b=new ydn.xml.JsonElement(null,"entry",this.getDataForXml());if(a){a=!1;b.xmlns||(b.xmlns="http://www.w3.org/2005/Atom",a=!0);var c=["atom"],d;for(d in this.data){var e=d.match(/^(\w+)\$\w+/);e&&(e=e[1],e in ydn.xml.namespaces&&(goog.array.contains(c,e)||c.push(e)))}d=b.toXmlString();a&&delete b.xmlns;return ydn.xml.insertNamespace(d,c)}return b.toXmlString()};
ydn.gdata.Entry.insertNamespaceFor=function(a,b){var c=["atom","app","gd","batch","ydn"];if(b==ydn.gdata.Type.SITE||b==ydn.gdata.Kind.SITE||b==ydn.gdata.Kind.PAGE||b==ydn.gdata.Kind.WEB_PAGE)c=c.concat("xhtml","sites");else if(b==ydn.gdata.Type.CONTACT||b==ydn.gdata.Kind.M8_CONTACT)c=c.concat("gContact");return ydn.xml.insertNamespace(a,c)};
ydn.gdata.Entry.prototype.isSame=function(a){for(var b in this.data)if(this.data.hasOwnProperty(b)&&!goog.array.contains(this.identifier_fields,b))if(goog.isDefAndNotNull(a.data[b])){if(!ydn.object.equals(this.data[b],a.data[b]))return!1}else return!1;for(b in a.data)if(a.data.hasOwnProperty(b)&&!goog.array.contains(a.identifier_fields,b)&&!goog.isDefAndNotNull(this.data[b]))return!1;return!0};
ydn.gdata.Entry.prototype.copy=function(a){if(this.getType()!=a.getType())throw new ydn.error.InvalidOperationException("Invalid type: "+this.getType()+" - "+a.getType());if(this.getKind()&&this.getKind()!=a.getKind())throw new ydn.error.InvalidOperationException("Invalid kind: "+this.getKind()+" - "+a.getKind());this.getUpdated()>a.getUpdated()&&this.logger.warning("Updating "+this+" with less updated entry "+a);if(a.isDeleted()||a.hasDeleted()){if(this.isDeleted()||this.hasDeleted())return!1;this.deleteEntry();
return!0}var b=!1,c;for(c in a.data)a.data.hasOwnProperty(c)&&goog.isObject(a.data[c])&&!goog.array.contains(this.identifier_fields,c)&&!ydn.object.equals(this.data[c],a.data[c])&&(b=!0,this.data[c]=ydn.object.clone(a.data[c]));b&&this.setModified();return b};
ydn.gdata.Entry.prototype.update=function(a){goog.asserts.assert(goog.isDef(this.getEntryId())&&this.getEntryId()===a.getEntryId()||goog.isDef(this.getBatchId())&&this.getBatchId()===a.getBatchId());var b=["batch$status","batch$operation","status"],c;for(c in a.data)a.data.hasOwnProperty(c)&&goog.isObject(a.data[c])&&!goog.array.contains(b,c)&&!goog.array.contains(this.identifier_fields,c)&&(this.data[c]=a.data[c])};
ydn.gdata.Entry.prototype.mergeField=function(a,b){if(ydn.object.equals(this.data[a],b))return!1;this.data[a]=ydn.object.clone(b);return!0};ydn.gdata.Entry.prototype.merge=function(a){if(a.getUpdated()>=this.getUpdated()&&a.isDeleted()){if(this.isDeleted()||this.hasDeleted())return!1;this.deleteEntry();return!0}var b=!1,c;for(c in a.data)a.data.hasOwnProperty(c)&&goog.isObject(a.data[c])&&!goog.array.contains(this.identifier_fields,c)&&this.mergeField(c,a.data[c])&&(b=!0);b&&this.setModified();return b};
ydn.gdata.Entry.json2xml=function(a){};ydn.gdata.Entry.prototype.toElement=function(a){return(new ydn.xml.JsonElement(null,"entry",this.data)).toElement(a)};goog.DEBUG&&(ydn.gdata.Entry.prototype.toDispString=function(){var a=this.isDeleted()?" (deleted)":"",b=this.isDirty()?" (dirty)":"";return this.getTitle()+a+b},ydn.gdata.Entry.prototype.disp=function(){window.console.log(this.toDispString())});ydn.db.sync.entry.GData=function(a,b,c){ydn.db.sync.entry.Rest.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.GData,ydn.db.sync.entry.Rest);ydn.db.sync.entry.GData.prototype.getGDataSync_=function(){return this.sync_parent};ydn.db.sync.entry.GData.prototype.getUri=function(){return this.key};ydn.db.sync.entry.GData.json2xml=function(a){return(new ydn.gdata.Entry(a)).toXmlString()};
ydn.db.sync.entry.GData.prototype.newRequest=function(a,b,c,d){b=ydn.db.sync.entry.GData.superClass_.newRequest.call(this,a,b,c,d);this.getGDataSync_().useGapiToken(b.method)&&goog.global.gapi&&goog.global.gapi.auth&&(c=gapi.auth.getToken())&&c.access_token&&(b.headers.Authorization=c.token_type+" "+c.access_token);if("GET"==b.method)b.params.alt="json";else if("PUT"==b.method||"POST"==b.method)goog.asserts.assertObject(d,"Invalid request body "+a),a=new ydn.gdata.Entry(d),b.body=a.toXmlString(!0),
b.headers["Content-Type"]="application/atom+xml";return b};ydn.db.sync.entry.GData.prototype.getDataFromBody=function(a,b){a=ydn.db.sync.entry.GData.superClass_.getDataFromBody.call(this,a,b);a.feed&&(a=a.feed);a.entry&&(a=a.entry);return a};ydn.db.sync.GData=function(a,b,c){ydn.db.sync.Atom.call(this,a,b,c);a=c.Options;goog.asserts.assertString(a.kind,"gdata kind must be defined in "+b.getName());this.kind=a.kind;this.version=a.version;this.projection=a.projection;this.maxKeys=a.maxResults};goog.inherits(ydn.db.sync.GData,ydn.db.sync.Atom);ydn.db.sync.GData.prototype.projection=null;ydn.db.sync.GData.prototype.version=null;ydn.db.sync.GData.prototype.getKind=function(){return this.kind};ydn.db.sync.GData.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.GData");
ydn.db.sync.GData.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.GData(this,a,b)};ydn.db.sync.GData.prototype.getDefaultKeyPaths=function(){var a=ydn.db.sync.GData.superClass_.getDefaultKeyPaths.call(this);a[ydn.db.sync.KeyPath.Key.KEY]=["id","$t"];a[ydn.db.sync.KeyPath.Key.ETAG]="gd$etag";a[ydn.db.sync.KeyPath.Key.UPDATED]=["updated","$t"];return a};
ydn.db.sync.GData.prototype.getOptionFieldNames=function(){var a=ydn.db.sync.GData.superClass_.getOptionFieldNames.call(this);return a=a.concat(["version","projection","kind","maxResults"])};ydn.db.sync.GData.prototype.getBaseUri=function(){return"https://www.googleapis.com/"+this.kind+"/"};ydn.db.sync.GData.prototype.useGapiToken=function(a){return!1};ydn.db.sync.GData.prototype.getId=function(a){return a?a.id?a.id.$t:"":""};ydn.db.sync.GData.prototype.getEtag=function(a){return a.gd$etag||a.etag};
ydn.db.sync.GData.prototype.toUri=function(a){return a.replace("http://","https://").replace("/base","/full")};
ydn.db.sync.GData.prototype.fetchFeed=function(a,b){var c=b||this.getBaseUri();b&&this.logger.finest("continuing "+b);var d=this,e=new ydn.client.HttpRequestData(c,"GET",a),f=new goog.async.Deferred;d.getTransport().request(e).execute(function(a,e){if(200==e.getStatus()){if(!a){var k=e.getBody();goog.isString(k)&&(a=JSON.parse(k))}k=a.feed||a;goog.asserts.assert(k,"feed object missing on respond body of "+c);var l=k.entry,l=l?goog.isArray(l)?l:[l]:[];0<l.length&&d.putToDB(l);for(var l=null,k=k.link,
k=goog.isArray(k)?k:[k],m=0;m<k.length;m++)"next"==k[m].rel&&(l=k[m].href);l?d.fetchFeed({},l).chainDeferred(f):(d.logger.finest("prefetch "+d.store_name+" done"),f.callback(!!b))}else 302==e.getStatus()?f.callback():(k=d+": Invalid response status "+e.getStatus()+" on prefetching",d.logger.warning(k),f.errback(Error(k)))});return f};
ydn.db.sync.GData.prototype.doPrefetch=function(){this.logger.finest("starting prefetch");var a=new goog.async.Deferred;this.storage.getCoreOperator().listInternal(this.store_name,"updated.$t",null,!0,1).addCallback(function(b){var c={alt:"json",kind:this.kind};this.maxKeys&&(c["max-results"]=this.maxKeys);(b=b[0])?(b=goog.object.getValueByKeys(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b,this.logger.finest(this.store_name+" fetching entries later then "+b)):this.logger.finest(this.store_name+
" fetching entries from beginning");this.fetchFeed(c).chainDeferred(a)},this);return a};ydn.db.sync.GData.prototype.getUpdated=function(a){return(new ydn.atom.Atom(a)).getUpdated()};
ydn.db.sync.GData.prototype.count=function(a){var b=this.store.getIndexByKeyPath("updated.$t");if(!b)return a;var c=a.copy();a.addCallbacks(function(a){c.notify(a);this.storage.getCoreOperator().listInternal(this.store_name,b.getName(),null,!1,1).addCallbacks(function(b){var f={alt:"json"};if(b=goog.isArray(b)?b[0]:b)b=goog.object.getValueByKeys(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),f["updated-min"]=b;var g=this,f=new ydn.client.HttpRequestData(this.getBaseUri(),"GET",f);this.getTransport().request(f).execute(function(b,
e){if(200==e.getStatus()){if(!b){var f=e.getBody();goog.isString(f)&&(b=JSON.parse(f))}f=b.feed;goog.asserts.assertObject(f,g+" feed object missing");f=goog.object.getValueByKeys(f,"openSearch$totalResults");c.callback(a+parseFloat(f||0))}else g.logger.warning(g+":Unexpected respond status "+e.getStatus())})},function(a){c.errback(a)},this)},function(a){c.errback(a)},this);return c};
ydn.db.sync.GData.prototype.gdataListFromServer_=function(a,b){var c=this,d=function(a){var d=new goog.async.Deferred,g={alt:"json",kind:c.kind};a&&(g["updated-min"]=a);b&&(g["max-results"]=b);var h=c.getBaseUri();a=new ydn.client.HttpRequestData(h,"GET",g,{});c.getTransport().request(a).execute(function(a,b){if(200==b.getStatus()){if(!a){var e=b.getBody();goog.isString(e)&&(a=JSON.parse(e))}e=a.feed;goog.asserts.assert(e,"feed object missing on respond body of "+h);var g=(e=e.entry)?goog.isArray(e)?
e:[e]:[];c.putToDB(g).addBoth(function(){d.callback(g)})}else e=c+": Invalid response status "+b.getStatus()+" for querying "+h,c.logger.warning(e),d.errback(Error(e))});return d};a.await(function(e,f,g){a.notify(e);c.loadMetas(e,function(a){a.length!=b&&0==a.length&&d().addCallbacks(function(a){g(a,!1)},function(a){g(a,!0)})})},this)};ydn.db.sync.entry.GDataJson=function(a,b,c){ydn.db.sync.entry.GData.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.GDataJson,ydn.db.sync.entry.GData);ydn.db.sync.GDataJson=function(a,b,c){ydn.db.sync.GData.call(this,a,b,c);goog.asserts.assertString(this.baseUri,"baseUri require in "+this.store_name);goog.asserts.assert(goog.string.startsWith(this.baseUri,"https://www.googleapis.com/"),"baseUri must start with https://www.googleapis.com/ for gdata-json sync format in "+this.store_name);this.baseUri=this.baseUri.substr(27);goog.asserts.assert(!this.transport,"transport must not be specified gdata-json sync format in "+this.store_name);this.pathPrefix=
c.Options.prefix;goog.asserts.assert(this.pathPrefix&&1<this.pathPrefix.length,"prefix must be specified for gdata-json sync format in "+this.store_name)};goog.inherits(ydn.db.sync.GDataJson,ydn.db.sync.GData);
ydn.db.sync.GDataJson.prototype.getTransport=function(){this.transport||(goog.asserts.assert(goog.isDef(goog.global.gapi),"Google javascript client library required."),goog.asserts.assert(goog.isDef(goog.global.gapi.client),"Google client library not ready."),this.transport=new ydn.client.GapiClient(gapi.client));return this.transport};ydn.db.sync.GDataJson.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.GDataJson(this,a,b)};
ydn.db.sync.GDataJson.prototype.getBaseUri=function(){return this.baseUri+this.pathPrefix};
ydn.db.sync.GDataJson.prototype.doPrefetch=function(){this.logger.finest("starting prefetch");var a=new goog.async.Deferred;this.storage.getCoreOperator().listInternal(this.store_name,"updated",null,!0,1).addCallbacks(function(b){var c={alt:"json"};if(b=b[0])b=goog.object.getValueByKeys(b,"updated"),b=(new Date(1+ +new Date(b))).toISOString(),c.updatedMin=b;b=this.getBaseUri();var d=this,c=new ydn.client.HttpRequestData(b,"GET",c);d.getTransport().request(c).execute(function(b,c){if(b){var g=b.items||
[];0<g.length?d.putToDB(g).addBoth(function(){a.callback(!0)}):a.callback(!1)}else 302==c.getStatus()?a.callback():(g=d+": Invalid response status "+c.getStatus()+" on prefetching",d.logger.warning(g),a.errback(Error(g)))})},function(b){a.errback(b)},this);return a};ydn.client.aws={};ydn.client.aws.S3=function(a,b){if(!goog.isDef(goog.global.AWS))throw new ydn.debug.error.InvalidOperationException("AWS JS SDK not loaded");this.default_bucket_name=a;this.region=b;this.cached_bucket=this.default_bucket=null;this.cached_bucket_name=a};ydn.client.aws.DEBUG=!1;ydn.client.aws.S3.prototype.request=function(a){return new ydn.client.aws.HttpRequest(this,a)};
ydn.client.aws.S3.prototype.getBucket=function(a){var b={params:{Bucket:this.default_bucket_name,region:this.region}};if(a&&a!=this.default_bucket_name)return this.cached_bucket&&this.cached_bucket_name==a||(b.params.Bucket=a,this.cached_bucket=new AWS.S3(b),this.cached_bucket_name=a),this.cached_bucket;if(!this.default_bucket_name)throw new ydn.debug.error.ArgumentException("bucket name required");this.default_bucket||(this.default_bucket=new AWS.S3(b));return this.default_bucket};
ydn.client.aws.HttpRequest=function(a,b){this.parent=a;this.req_data_=b};
ydn.client.aws.HttpRequest.prototype.execute_=function(a,b,c,d){var e=NaN,f="",g={};ydn.client.aws.DEBUG&&window.console.log(a,b);var h=this.parent.getBucket()[a](b);h.on("complete",function(a){ydn.client.aws.DEBUG&&window.console.log(a);a.httpResponse&&(e=a.httpResponse.statusCode,goog.isString(e)&&(e=parseInt(e,10)),g=a.httpResponse.headers);a.error&&(f=a.error.message,e||(e=400))});h.send(function(h,l){ydn.client.aws.DEBUG&&window.console.log(a,b,h,l);var m=new ydn.client.HttpRespondData(e,l,g,
f);h?c.call(d,null,m):c.call(d,l,m)})};ydn.client.aws.HttpRequest.prototype.execute=function(a,b){var c=(new goog.Uri(this.req_data_.getUri())).getPath(),c="/"==c.charAt(0)?c.substr(1):c,d=this.req_data_.headers||{};c&&(d.Key=c);if(c)if("GET"==this.req_data_.method)this.execute_("getObject",d,a,b);else if("PUT"==this.req_data_.method)this.execute_("putObject",d,a,b);else throw new ydn.debug.error.NotSupportedException("HTTP method "+this.req_data_.method);};ydn.db.sync.S3List=function(a,b){this.doc=a;this.prefix=this.getFields("Prefix")[0];this.primary_key_type=b.getType()};ydn.db.sync.S3List.resolver=function(a){return"http://doc.storage.googleapis.com/2010-04-03"};ydn.db.sync.S3List.prototype.getCount=function(){return this.doc.documentElement.getElementsByTagName("Contents").length};
ydn.db.sync.S3List.prototype.keys=function(){var a=this.getFields("Key");if(this.prefix){var b=this.prefix.length,a=a.map(function(a){return a.substr(b)});this.primary_key_type==ydn.db.schema.DataType.INTEGER?a=a.map(function(a){return parseInt(a,10)}):this.primary_key_type==ydn.db.schema.DataType.NUMERIC&&(a=a.map(function(a){return parseFloat(a)}))}return a};
ydn.db.sync.S3List.prototype.getFields=function(a){var b=[];a=this.doc.documentElement.getElementsByTagName(a);for(var c=a.length,d=0;d<c;d++)b[d]=a[d].textContent;return b};ydn.db.sync.S3List.prototype.getLastModifiedGMT=function(){return this.getFields("LastModified").map(function(a){return(new Date(Date.parse(a))).toGMTString()})};
ydn.db.sync.S3List.prototype.getNextMarker=function(){var a=this.doc.documentElement.getElementsByTagName("NextMarker");return 1==a.length?a[0].textContent:"true"==this.doc.documentElement.getElementsByTagName("IsTruncated")[0].textContent&&(a=this.doc.documentElement.firstElementChild.lastElementChild)&&"Contents"==a.tagName?a.getElementsByTagName("Key")[0]:null};ydn.xml.utils={};
ydn.xml.utils.xml2json=function(a,b){var c="atom"==b,d=!b,e=function(a){c&&goog.string.startsWith(a,"atom:")&&(a=a.substring(5,a.length));return a.replace("#text","$t").replace(/:/g,"$")};goog.isString(a)&&(a=goog.dom.xml.loadXml(a));var f={};if(1==a.nodeType){if(!d&&0<a.attributes.length)for(var g=0,h=a.attributes.length;g<h;g++){var k=a.attributes.item(g);f[e(k.nodeName)]=k.nodeValue}}else 3==a.nodeType&&(f=a.nodeValue);if(a.hasChildNodes())for(g=0,h=a.childNodes.length;g<h;g++){var k=a.childNodes.item(g),
l=e(k.nodeName);if(d&&"$t"==l)f=k.nodeValue;else if(goog.isDef(f[l])){if(!goog.isArray(f[l])){var m=f[l];f[l]=[];f[l].push(m)}f[l].push(ydn.xml.utils.xml2json(k,b))}else f[l]=ydn.xml.utils.xml2json(k,b)}return f};ydn.db.sync.S3=function(a,b,c){ydn.db.sync.Rest.call(this,a,b,c);this.maxKeys=c.Options.maxKeys;this.bucket=c.Options.bucket;if(!goog.isString(this.bucket)||goog.string.isEmpty(this.bucket))throw new ydn.debug.error.ArgumentException("bucket name required.");this.baseUri||(this.baseUri="https://"+this.bucket+".s3.amazonaws.com/");if(!0===b.isAutoIncrement())throw new ydn.debug.error.ArgumentException('S3 object store "'+b.getName()+'" must not set autoIncrement to true.');};
goog.inherits(ydn.db.sync.S3,ydn.db.sync.Rest);ydn.db.sync.S3.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.S3");ydn.db.sync.S3.DEBUG=!1;ydn.db.sync.S3.prototype.getOptionFieldNames=function(){var a=ydn.db.sync.S3.superClass_.getOptionFieldNames.call(this);return a=a.concat(["bucket","maxKeys","prefix","delimiter"])};ydn.db.sync.S3.prototype.getAwsS3=function(){var a=this.getTransport();goog.asserts.assertInstanceof(a,ydn.client.aws.S3);return a.getBucket()};
ydn.db.sync.S3.prototype.getTransport=function(){this.transport||(this.transport=new ydn.client.aws.S3(this.bucket));return this.transport};ydn.db.sync.S3.prototype.id2uri=function(a){return this.baseUri+this.uriPrefix+a};ydn.db.sync.S3.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.S3(this,a,b)};ydn.db.sync.S3.prototype.getBucket=function(){return this.bucket};
ydn.db.sync.S3.prototype.getFetchUrl=function(a){a=a||{};var b=[];this.delimiter&&b.push("delimiter="+this.delimiter);this.maxKeys&&b.push("max-keys="+this.maxKeys);(a=a.marker)&&b.push("marker="+a);return 0<b.length?this.baseUri+"?"+b.join("&"):this.baseUri};
ydn.db.sync.S3.prototype.parseFeed=function(a){var b=a.getStatus();a=a.getBody();if(200==b)return b=a instanceof Document?a:goog.isString(a)?goog.dom.xml.loadXml(a):null,goog.asserts.assert(b,"Invalid respond body "+a),b=ydn.xml.utils.xml2json(b,"plain"),ydn.db.sync.Atom.DEBUG&&window.console.log(b),b.ListBucketResult;this.logger.warning("Request failed: "+b+" "+a);return null};ydn.db.sync.S3.prototype.getKeyFromUri=function(a){return a.substring(this.baseUri.length)};
ydn.db.sync.S3.prototype.listFromServer=function(a,b,c){var d=this;a.await(function(c,f,g){a.notify(c);d.loadMetas(c,function(a){var f={},l=a[0]?a[0].getKey():null;goog.isDefAndNotNull(l)&&(f.marker=l);0<d.uriPrefix.length&&(f.prefix=d.uriPrefix);0<b&&(f["max-keys"]=b);d.logger.finest(d+" querying for newer entries starting from "+l);f=new ydn.client.HttpRequestData(d.baseUri,"GET",f);d.getTransport().request(f).execute(function(b,f){if(200==f.getStatus()){var k=f.getBody(),k=k instanceof Document?
k:goog.dom.xml.loadXml(k),l=new ydn.db.sync.S3List(k,d.store),k=l.keys(),l=l.getLastModifiedGMT();goog.asserts.assert(k.length==l.length,"server_keys and server_updated must be equal, but found "+k.length+" and "+l.length);for(var r=[],s=[],t=[],u=0,v=0;u<=a.length&&v<k.length;){var x=a[u]?a[u].getKey():null,y=k[v];if(u==a.length)s.push(y),v++;else{var z=x?ydn.db.cmp(x,y):-1;0==z?((y=a[u].getUpdated())&&l[v]&&y!=l[v]&&(l[v]>y?t.push(x):d.logger.warning('record "'+x+'" in database is more recent than server '+
y+" vs "+l[v])),u++,v++):1==z?(r.push(x),u++):(s.push(y),v++)}}d.processEntries(g,c,s,t,r,[])}else d.logger.warning("Invalid response status "+f.getStatus())})})},this)};
ydn.db.sync.S3.prototype.populate=function(a,b){this.storage.getCoreOperator();var c={};0<this.uriPrefix.length&&(c.prefix=this.uriPrefix);var d=this,e=this.getTransport(),f=function(b){goog.isDefAndNotNull(b)&&(c.marker=b);d.logger.finest(d+" querying for newer entries starting from "+b);b=new ydn.client.HttpRequestData(d.baseUri,"GET",c);e.request(b).execute(function(b,c){if(200==c.getStatus()){var e=c.getBody(),e=e instanceof Document?e:goog.dom.xml.loadXml(e),e=new ydn.db.sync.S3List(e,d.store),
g=e.getNextMarker(),e=e.keys(),n=e.length;if(0==n)a([]),a=null;else for(var p=0,q=0;q<n;q++)d.buildEntry(e[q]).readServer(function(b){p++;p==n&&(g?f(g):a&&(a([this.getServerValue()]),a=null))})}else d.logger.warning("Invalid response status "+c.getStatus())})};f();this.has_updated=!0};ydn.db.sync.S3.prototype.getLast=function(a){this.has_updated||a.await(function(a,c,d){goog.isDef(a[0])?d(a):this.populate(d)},this)};ydn.db.sync.entry.Gcs=function(a,b,c){ydn.db.sync.entry.S3.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.Gcs,ydn.db.sync.entry.S3);ydn.db.sync.entry.Gcs.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.entry.Gcs");ydn.db.sync.entry.Gcs.prototype.getGcsSync_=function(){return this.sync_parent};ydn.db.sync.Gcs=function(a,b,c){ydn.db.sync.S3.call(this,a,b,c);this.baseUri="https://"+this.bucket+".storage.googleapis.com/"};goog.inherits(ydn.db.sync.Gcs,ydn.db.sync.S3);ydn.db.sync.Gcs.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.Gcs");ydn.db.sync.Gcs.prototype.getTransport=function(){this.transport||(this.transport=new ydn.client.SimpleClient);return this.transport};ydn.db.sync.Gcs.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.Gcs(this,a,b)};ydn.client.SimpleClient=function(a,b,c){this.xm_=goog.isDef(a)?a:ydn.client.getXhrManager();this.header_=b;this.proxy_url_=c};ydn.client.SimpleClient.prototype.request=function(a){if(this.header_){a.headers||(a.headers={});for(var b in this.header_)a.headers[b]=this.header_[b]}this.proxy_url_&&(a.path=this.proxy_url_+a.path);return new ydn.client.SimpleHttpRequest(a,this.xm_)};
ydn.client.SimpleClient.getInstance=function(){ydn.client.SimpleClient.instance_||(ydn.client.SimpleClient.instance_=new ydn.client.SimpleClient);return ydn.client.SimpleClient.instance_};ydn.client.GapiClient=function(a,b){goog.asserts.assert(a&&"request"in a,"HTTP client must have a request method");this.client_=a;this.immediately=!!b};ydn.client.GapiClient.prototype.request=function(a){var b={path:a.path,method:a.method,headers:a.headers,params:a.params,body:a.body};this.immediately&&(b.callback=function(a,e){c.callback(a,e);b.callback=null});a=this.client_.request(b);var c=new ydn.client.GapiClient.Request(a);return c};ydn.client.GapiClient.Request=function(a){this.req_=a||null};
ydn.client.GapiClient.Request.prototype.callback=function(a,b){this.cb_&&(this.cb_(a,ydn.client.HttpRespondData.wrap(b)),this.cb_=null);this.result_={json:a,raw:b}};ydn.client.GapiClient.Request.prototype.execute=function(a){this.req_?(this.req_.execute(function(b,c){a(b,ydn.client.HttpRespondData.wrap(c))}),this.req_=null):this.result_?(a(this.result_.json,ydn.client.HttpRespondData.wrap(this.result_.raw)),this.result_=null):this.cb_=a};
ydn.client.GapiClient.wrap=function(a){if(a){if(a instanceof ydn.client.SimpleClient)return a;if(goog.isFunction(a))return new ydn.client.GapiClient({request:function(b){a(b)}},!0);if("request"in a)return new ydn.client.GapiClient(a);throw new ydn.debug.error.ArgumentException(a+" is not a valid HTTP Client");}return null};ydn.db.sync.entry.GcsJson=function(a,b,c){ydn.db.sync.entry.Gcs.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.GcsJson,ydn.db.sync.entry.Gcs);ydn.db.sync.entry.GcsJson.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.entry.GcsJson");ydn.db.sync.entry.GcsJson.prototype.getGcsJsonSync_=function(){return this.sync_parent};
ydn.db.sync.entry.GcsJson.prototype.readServer=function(a){var b=this.getGcsJsonSync_(),c=this;this.loadMeta(function(d){var e={method:"GET",path:"storage/v1beta2/b/"+b.getBucket()+"/o/"+encodeURIComponent(c.getName())};d&&(e.headers=d.toRequestReadHeader());gapi.client.request(e).execute(function(d,e){var h=ydn.client.HttpRespondData.wrap(e);c.server_meta=new ydn.db.sync.entry.HttpMetaData(c.getId(),h.getHeaders(),b.getKeyPaths());d?(c.logger.finest(c+": readServer updated"),c.server_value=d):(c.logger.finest(c+
": readServer request fail "+e),c.server_meta=null,c.server_value=null);a.call(c,200)},e)})};ydn.db.sync.GcsJson=function(a,b,c){ydn.db.sync.Gcs.call(this,a,b,c)};goog.inherits(ydn.db.sync.GcsJson,ydn.db.sync.Gcs);ydn.db.sync.GcsJson.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.GcsJson");ydn.db.sync.GcsJson.prototype.getDefaultKeyPaths=function(){var a=ydn.db.sync.GcsJson.superClass_.getDefaultKeyPaths.call(this);a[ydn.db.sync.KeyPath.Key.KEY]="name";return a};
ydn.db.sync.GcsJson.prototype.getTransport=function(){if(!this.transport)if(goog.isDef(goog.global.gapi))this.transport=new ydn.client.GapiClient(gapi.client);else throw new ydn.debug.error.InvalidOperationException("gapi not loaded");return ydn.db.sync.GcsJson.superClass_.getTransport.call(this)};ydn.db.sync.GcsJson.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.GcsJson(this,a,b)};
ydn.db.sync.GcsJson.prototype.doPrefetch=function(){this.logger.finer("starting prefetch");var a=new goog.async.Deferred;this.storage.getCoreOperator().keysInternal(this.store_name,null,null,1,0,!0,!1).addCallbacks(function(b){var c={bucket:this.bucket};(b=b[0])&&(c.marker=b);this.getBaseUri();var d=this;if(!goog.global.gapi||goog.global.gapi.client)throw Error("gapi lib not loaded");gapi.client.load("storage","v1beta2",function(){var b=gapi.client.storage.objects.list({bucket:d.bucket});this.pathPrefix&&
(c.prefix=this.pathPrefix);b.execute(function(b,c){if(b&&!b.error){var e=b.items||[];0<e.length?d.putToDB(null,e).addBoth(function(){a.callback(!0)}):a.callback(!1)}else e=d+": "+c,d.logger.warning(e),a.errback(Error(e))})})},function(b){a.errback(b)},this);return a};ydn.db.sync.GcsMeta=function(a,b,c){ydn.db.sync.Gcs.call(this,a,b,c);this.prefetch="full"};goog.inherits(ydn.db.sync.GcsMeta,ydn.db.sync.Gcs);ydn.db.sync.GcsMeta.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.GcsMeta");ydn.db.sync.GcsMeta.prototype.getDefaultKeyPaths=function(){var a=ydn.db.sync.GcsMeta.superClass_.getDefaultKeyPaths.call(this);a[ydn.db.sync.KeyPath.Key.KEY]="name";return a};
ydn.db.sync.GcsMeta.prototype.getTransport=function(){!this.transport&&gapi&&(this.transport=new ydn.client.GapiClient(gapi.client));return ydn.db.sync.GcsMeta.superClass_.getTransport.call(this)};ydn.db.sync.GcsMeta.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.GcsJson(this,a,b)};
ydn.db.sync.GcsMeta.prototype.serverList=function(a){this.logger.finer("starting prefetch");if(!goog.global.gapi||!goog.global.gapi.client)throw Error("gapi lib not loaded");var b=this;gapi.client.load("storage","v1beta2",function(){var c={bucket:b.bucket};this.pathPrefix&&(c.prefix=this.pathPrefix);var d=function(e){e&&(c.pageToken=e);gapi.client.storage.objects.list(c).execute(function(c,e){if(c&&!c.error){var h=c.items||[];c.nextPageToken?(a.notify(h),d(c.nextPageToken)):a.callback(h)}else h=b+
": "+e,b.logger.warning(h),a.errback(Error(h))})};d()})};
ydn.db.sync.GcsMeta.prototype.doPrefetch=function(){this.logger.finer("starting prefetch");var a=new goog.async.Deferred;if(!goog.global.gapi||!goog.global.gapi.client)throw Error("gapi lib not loaded");var b=this;gapi.client.load("storage","v1beta2",function(){var c={bucket:b.bucket};this.pathPrefix&&(c.prefix=this.pathPrefix);var d=function(e){e&&(c.pageToken=e);gapi.client.storage.objects.list(c).execute(function(e,g){if(e&&!e.error){var h=e.items||[];if(e.nextPageToken)b.logger.finest("receiving "+
h.length+" meta records, continuing next"),b.putToDB(h),d(e.nextPageToken);else if(0<h.length)b.putToDB(h).addBoth(function(){b.logger.finest("receiving "+h.length+" meta records, prefetching dane.");a.callback(!0)});else{var k=!!c.pageToken;b.logger.finest("prefetching done");a.callback(k)}}else k=b+": "+g,b.logger.warning(k),a.errback(Error(k))})};d()});return a};
ydn.db.sync.GcsMeta.prototype.loadMetas=function(a,b){if(0==a.length)b([]);else{var c=this.getStoreName(),d=goog.array.map(a,function(a){return new ydn.db.Key(c,a)});this.valuesByKeys(d).addCallbacks(function(d){for(var f=[],g=0;g<a.length;g++)f[g]=new ydn.db.sync.entry.MetaData(a[g],d[g],this.key_paths,c);b(f)},function(a){this.logger.warning(this+" error loading meta data "+a);b([])},this)}};ydn.db.sync.Json=function(a,b,c){ydn.db.sync.Rest.call(this,a,b,c)};goog.inherits(ydn.db.sync.Json,ydn.db.sync.Rest);ydn.db.sync.Json.prototype.id2uri=function(a){return this.baseUri+this.uriPrefix+this.store_name+this.delimiter+a};ydn.db.sync.Json.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.Json");
ydn.db.sync.Json.prototype.listFromServer=function(a,b,c){var d=new ydn.async.Deferred,e=this,f=this.baseUri+this.uriPrefix+this.store_name,g=function(a,b){var c=new ydn.client.HttpRequestData(f);e.getTransport().request(c).execute(function(c){if(200==c.status){var d=(c.response instanceof Object?c.response:ydn.json.parse(c.responseText)).items;goog.asserts.assertArray(d,"json respond object must have array of items field.");c=goog.array.map(d,function(a){return a.id});for(var d=goog.array.map(d,
function(a){return a.updated}),f=[],g=[],l=[],s=0,t=0;s<=a.length&&t<c.length;){var u=a[s].getKey(),v=c[t];if(s==a.length)g.push(v),t++;else{var x=ydn.db.cmp(u,v);0==x?((v=a[s].getUpdated())&&d[t]&&v!=d[t]&&(new Date(d[t])>v?l.push(u):e.logger.warning('record "'+u+'" in database is more recent than server '+v+" vs "+d[t])),s++,t++):1==x?(f.push(u),s++):(g.push(v),t++)}}e.processEntries(function(a,b){},b,g,l,f,[])}else e.logger.warning("Invalid response status "+c.status)})};a.addCallback(function(a){d.notify(a);
this.loadMetas(a,function(b){g(b,a)})},this)};ydn.db.sync.OData=function(a,b,c){ydn.db.sync.Atom.call(this,a,b,c)};goog.inherits(ydn.db.sync.OData,ydn.db.sync.Atom);ydn.db.sync.OData.prototype.getFetchUrl=function(a){var b=this.baseUri+"?alt=json";a&&(b+="&updated-min="+a);return b};ydn.db.sync.entry.S3Meta=function(a,b,c){ydn.db.sync.entry.S3.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.S3Meta,ydn.db.sync.entry.S3);ydn.db.sync.entry.S3Meta.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.entry.S3Meta");ydn.db.sync.entry.S3Meta.prototype.getS3MetaSync_=function(){return this.sync_parent};ydn.db.sync.S3Meta=function(a,b,c){ydn.db.sync.S3.call(this,a,b,c);this.pathPrefix=c.Options.prefix;if("Key"!=b.getKeyPath())throw new ydn.debug.error.ArgumentException('s3-meta store "'+b.getName()+'" must use inline key with keyPath "Key"');this.prefetch="meta"};goog.inherits(ydn.db.sync.S3Meta,ydn.db.sync.S3);ydn.db.sync.S3Meta.prototype.logger=goog.debug.Logger.getLogger("ydn.db.sync.S3Meta");
ydn.db.sync.S3Meta.prototype.getDefaultKeyPaths=function(){var a=ydn.db.sync.S3Meta.superClass_.getDefaultKeyPaths.call(this);a[ydn.db.sync.KeyPath.Key.KEY]="Key";a[ydn.db.sync.KeyPath.Key.MODIFIED]="LastModified";a[ydn.db.sync.KeyPath.Key.ETAG]="ETag";return a};ydn.db.sync.S3Meta.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.S3Meta(this,a,b)};
ydn.db.sync.S3Meta.prototype.doPrefetch=function(){this.logger.finer("starting prefetch");var a=new goog.async.Deferred,b=this.getAwsS3(),c=this,d={};this.pathPrefix&&(d.prefix=this.pathPrefix);var e=function(f){f&&(d.marker=f);b.listObjects(d).send(function(b,f){if(b){var k=c+": "+ydn.json.toShortString(b);c.logger.warning(k);a.errback(b instanceof Error?b:Error(k))}else{var l=f.Contents||[];f.IsTruncated?(c.logger.finest("receiving "+l.length+" meta records, continuing next"),c.putToDB(l),e(l[l.length-
1].Key+"\uffff")):0<l.length?c.putToDB(l).addBoth(function(){c.logger.finest("receiving "+l.length+" meta records, prefetching dane.");a.callback(!0)}):(k=!!d.marker,c.logger.finest("prefetching done"),a.callback(k))}})};e();return a};ydn.db.sync.S3Meta.prototype.loadMetas=function(a,b){throw new ydn.debug.error.InvalidOperationException("loading meta data should not be necessary");};ydn.db.sync.entry.GDataSites=function(a,b,c){ydn.db.sync.entry.GData.call(this,a,b,c)};goog.inherits(ydn.db.sync.entry.GDataSites,ydn.db.sync.entry.GData);ydn.db.sync.entry.GDataSites.prototype.getSiteSync_=function(){return this.sync_parent};ydn.db.sync.SitesGData=function(a,b,c){ydn.db.sync.GData.call(this,a,b,c);a=c.Options;this.domain=a.domain;this.site_name=a.siteName;goog.asserts.assertString(this.domain,"domain name is require for GData sites format");goog.asserts.assertString(this.site_name,"siteName name is require for GData sites format");goog.asserts.assert(!this.meta_data_field_name,"meta data field name on GData sites must not be defined");if(a=b.getIndex("sites$parent"))a.setGenerator(function(a){for(var b=a.link||[],c=0;c<
b.length;c++)if("http://schemas.google.com/sites/2008#parent"==b[c].rel)return b[c].href;return a.id.$t.replace(/\w+$/,"0")}),this.logger.fine("index sites$parent in "+b.getName()+" has set a generator.");if(a=b.getIndex("alternate"))a.setGenerator(function(a){a=a.link||[];for(var b=0;b<a.length;b++)if("alternate"==a[b].rel)return a[b].href}),this.logger.fine("index alternate in "+b.getName()+" has set a generator.")};goog.inherits(ydn.db.sync.SitesGData,ydn.db.sync.GData);
ydn.db.sync.SitesGData.prototype.buildEntry=function(a,b){return new ydn.db.sync.entry.GDataSites(this,a,b)};ydn.db.sync.SitesGData.prototype.getOptionFieldNames=function(){var a=ydn.db.sync.SitesGData.superClass_.getOptionFieldNames.call(this);return a=a.concat(["domain","siteName"])};ydn.db.sync.SitesGData.prototype.getBaseUri=function(){return"https://sites.google.com/feeds/content/"+this.domain+"/"+this.site_name+"/"};ydn.db.sync.SitesGData.prototype.useGapiToken=function(a){return"GET"!=a};
ydn.db.sync.SitesGData.prototype.getByIndexSites_=function(a,b,c){var d={alt:"json",kind:this.kind};"sites$parent"==b?(goog.asserts.assertString(c,"parent key must be a string"),b=c.match(/\w+$/)[0],d.parent=b):"alternate"==b?(goog.asserts.assertString(c,"alternate key must be a string"),b=c.replace(/https:\/\/sites.google.com\/a\/[^\/]+\/[^\/]+/,""),d.path=b):goog.asserts.assert(!1,"Invalid index "+b);var e={},f=this.getBaseUri(),g=this;a.await(function(b,k,l){a.notify(b);if(k=b[0])k=goog.object.getValueByKeys(k,
"updated","$t"),k=(new Date(1+ +new Date(k))).toISOString(),d["updated-min"]=k;k=new ydn.client.HttpRequestData(f,"GET",d,e);g.getTransport().request(k).execute(function(a,d){if(200==d.getStatus()){if(!a){var e=d.getBody();goog.isString(e)&&(a=JSON.parse(e))}e=a.feed||a;goog.asserts.assert(e,"feed object missing on respond body of "+f);var k=(e=e.entry)?goog.isArray(e)?e:[e]:[];0<k.length?g.putToDB(k).addBoth(function(){l(k)}):l(b)}else 302==d.getStatus()?l(b):(e=g+": Invalid response status "+d.getStatus()+
" for querying pageName: "+c,g.logger.warning(e),l(Error(e),!0))})},this)};
ydn.db.sync.SitesGData.prototype.getByIndex=function(a,b,c){if(this.needPrefetch())a.await(function(d,e,f){a.notify(d);this.onPreFetchReady(function(a){!0===a?this.storage.getCoreOperator().listInternal(this.store_name,b,ydn.db.KeyRange.only(c),!1,0).addCallbacks(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(a){f(a,!0)},this)},this);else return"alternate"==b||"alternate"==b?this.getByIndexSites_(a,b,c):ydn.db.sync.SitesGData.superClass_.getByIndex.call(this,a,b,c)};ydn.db.schema.Store.prototype.resolver=null;ydn.db.schema.Store.prototype.resolveConflict=function(a,b,c,d){return this.resolver?this.resolver(a,b,c,d):b};ydn.db.schema.Store.prototype.synchronizer=null;
ydn.db.crud.Storage.prototype.addSynchronizer=function(a,b){var c=b.format;if("gdata-sites"==c)a.synchronizer=new ydn.db.sync.SitesGData(this,a,b);else if("gdata"==c)a.synchronizer=new ydn.db.sync.GData(this,a,b);else if("gdata-json"==c)a.synchronizer=new ydn.db.sync.GDataJson(this,a,b);else if("odata"==c)a.synchronizer=new ydn.db.sync.OData(this,a,b);else if("s3"==c)a.synchronizer=new ydn.db.sync.S3(this,a,b);else if("s3-meta"==c)a.synchronizer=new ydn.db.sync.S3Meta(this,a,b);else if("gcs"==c)a.synchronizer=
new ydn.db.sync.Gcs(this,a,b);else if("gcs-json"==c)a.synchronizer=new ydn.db.sync.GcsJson(this,a,b);else if("gcs-meta"==c)a.synchronizer=new ydn.db.sync.GcsMeta(this,a,b);else if("atom"==c)a.synchronizer=new ydn.db.sync.Atom(this,a,b);else if("json"==c)a.synchronizer=new ydn.db.sync.Json(this,a,b);else if("rest"==c)a.synchronizer=new ydn.db.sync.Rest(this,a,b);else throw new ydn.debug.error.NotSupportedException("Sync format: "+c);a.addHook(function(b,c){var f=b.getMethod();if(!(this instanceof ydn.db.tr.DbOperator)||
this.sync_thread)if(!window.navigator||!goog.isDef(window.navigator.onLine)||window.navigator.onLine)if(f==ydn.db.Request.Method.ADD)f=c[1],a.synchronizer.add(b,f);else if(f==ydn.db.Request.Method.COUNT)c[1]||c[2]||a.synchronizer.count(b);else if(f==ydn.db.Request.Method.PUT){var f=c[1],g=c[2];a.synchronizer.put(b,f,g)}else if(f==ydn.db.Request.Method.REMOVE)g=c[1],a.synchronizer.remove(b,g);else if(f==ydn.db.Request.Method.VALUES_INDEX){var f=c[1],g=c[2],h=c[3],k=c[4],l=c[5];!h&&!l&&g&&goog.isDefAndNotNull(g.lower)&&
goog.isDefAndNotNull(g.upper)&&0==ydn.db.cmp(g.lower,g.upper)&&a.synchronizer.getByIndex(b,f,g.lower)}else if(f==ydn.db.Request.Method.KEYS)g=c[1],k=c[2],h=c[3],l=c[4],a.synchronizer.keys(b,null,g,k,h,l,!1);else if(f==ydn.db.Request.Method.KEYS_INDEX)f=c[1],g=c[2],k=c[3],h=c[4],l=c[5],a.synchronizer.keys(b,f,g,k,h,l,c[6]);else if(f==ydn.db.Request.Method.VALUES)g=c[1],k=c[2],h=c[3],l=c[4],g||l?g&&g.lower&&goog.isString(g.lower)&&g.lower==g.upper?a.synchronizer.listByParent(b,k,h):!g&&l&&1==k&&h&&
a.synchronizer.getLast(b):a.synchronizer.values(b,k,h);else if(f!=ydn.db.Request.Method.NONE)if(f==ydn.db.Request.Method.GET)g=c[1],a.synchronizer.get(b,g);else if(f==ydn.db.Request.Method.VALUES_IDS)a.synchronizer.valuesByIds(b,c[1]);else throw Error(f);})};ydn.crm.data={};
ydn.crm.data.schema={stores:[{name:"gdata-"+ydn.gdata.Kind.M8_CONTACT,keyPath:"id.$t",type:"TEXT",indexes:[{name:"updated.$t",type:"TEXT"},{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[];a=goog.isArray(a.gd$email)?a.gd$email:goog.isObject(a.gd$email)?[a.gd$email]:[];for(var c=0;c<a.length;c++){var d=ydn.string.normalizeEmail(a[c].address);d&&b.push(d)}return b}},{name:"ydn$externalIds",multiEntry:!0,generator:function(a){return(goog.isArray(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?
[a.gContact$externalId]:[]).map(function(a){return a.value})}}]}]};ydn.crm.data.db=new ydn.db.Storage(void 0,ydn.crm.data.schema);ydn.crm.data.initDb=function(a){goog.asserts.assertString(a);var b=a+"-gdata";a=ydn.crm.data.db.getName();if(a!=b){a?ydn.crm.data.db=new ydn.db.Storage(b,ydn.crm.data.schema):ydn.crm.data.db.setName(b);var c="reload-versionchange"+ydn.crm.data.db.getName();ydn.crm.data.db.addEventListener("ready",function(){ydn.crm.shared.logger.finer("db "+b+" connected.");window.sessionStorage.removeItem(c)})}};
ydn.crm.data.db.addEventListener("fail",function(a){ydn.crm.shared.logger.finer("database fail "+a.name);var b="reload-versionchange"+ydn.crm.data.db.getName();if(a.error&&"versionchange"==a.error.name){if(window.sessionStorage.getItem(b))throw a;window.sessionStorage.setItem(b,"1");location.reload()}else throw ydn.crm.data.db=null,a;});
ydn.crm.data.getSugarSchema=function(){return{stores:[{name:"Meta"},{name:"Accounts",keyPath:"id",indexes:[{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[],c;for(c in a)if(goog.string.startsWith(c,"email")){var d=ydn.string.normalizeEmail(a[c]);d&&b.push(d)}return b}},{name:"account_name"},{name:"first_name"},{name:"full_name"},{name:"last_name"},{name:"date_modified"}]},{name:"Contacts",keyPath:"id",indexes:[{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[],c;for(c in a)if(goog.string.startsWith(c,
"email")){var d=ydn.string.normalizeEmail(a[c]);d&&b.push(d)}return b}},{name:"account_name"},{name:"first_name"},{name:"full_name"},{name:"last_name"},{name:"date_modified"}]},{name:"Leads",keyPath:"id",indexes:[{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[],c;for(c in a)if(goog.string.startsWith(c,"email")){var d=ydn.string.normalizeEmail(a[c]);d&&b.push(d)}return b}},{name:"account_name"},{name:"first_name"},{name:"full_name"},{name:"last_name"},{name:"date_modified"}]},{name:"Opportunities",
keyPath:"id",indexes:[{name:"account_id"},{name:"date_modified"}]},{name:"Teams",keyPath:"id",indexes:[{name:"account_id"},{name:"date_modified"}]},{name:"TeamSets",keyPath:"id",indexes:[{name:"account_id"},{name:"date_modified"}]}]}};ydn.crm.sugar={};ydn.crm.sugar.Module={ACCOUNTS:"Accounts",CAMPAIGNS:"Campaigns",CONTACTS:"Contacts",EMPLOYEES:"Employees",LEADS:"Leads",OPPORTUNITIES:"Opportunities",TEAMS:"Teams",TEAM_SETS:"TeamSets",USERS:"Users"};ydn.crm.sugar.Modules=[ydn.crm.sugar.Module.ACCOUNTS,ydn.crm.sugar.Module.CONTACTS,ydn.crm.sugar.Module.EMPLOYEES,ydn.crm.sugar.Module.LEADS,ydn.crm.sugar.Module.OPPORTUNITIES,ydn.crm.sugar.Module.TEAMS,ydn.crm.sugar.Module.TEAM_SETS,ydn.crm.sugar.Module.USERS];
ydn.crm.sugar.SyncModules=[ydn.crm.sugar.Module.ACCOUNTS,ydn.crm.sugar.Module.CONTACTS,ydn.crm.sugar.Module.LEADS,ydn.crm.sugar.Module.OPPORTUNITIES,ydn.crm.sugar.Module.TEAMS];ydn.crm.sugar.PANEL_MODULES=[ydn.crm.sugar.Module.ACCOUNTS,ydn.crm.sugar.Module.LEADS,ydn.crm.sugar.Module.CONTACTS];ydn.crm.sugar.toModuleName=function(a){var b=ydn.crm.sugar.Modules.indexOf(a);goog.asserts.assert(0<=b,"Invalid module name "+a);return ydn.crm.sugar.Modules[b]};
ydn.crm.sugar.isValidModule=function(a){return 0<=ydn.crm.sugar.Modules.indexOf(a)};ydn.crm.sugar.getViewLink=function(a,b,c){return"https://"+a+"/index.php?module="+b+"&action=DetailView&record="+c};ydn.crm.sugar.Record=function(a,b,c){this.domain=a;this.module=b;this.obj=c||null};ydn.crm.sugar.Record.prototype.getViewLink=function(){return ydn.crm.sugar.getViewLink(this.domain,this.module,this.getId())};ydn.crm.sugar.Record.prototype.getDomain=function(){return this.domain};ydn.crm.sugar.Record.prototype.getModule=function(){return this.module};ydn.crm.sugar.Record.prototype.getData=function(){return this.obj};
ydn.crm.sugar.Record.prototype.getId=function(){var a=this.obj.id;goog.asserts.assert(a);return a};ydn.crm.sugar.Record.prototype.getUpdated=function(){return this.obj?+new Date(this.obj.date_modified):NaN};ydn.crm.sugar.Record.prototype.getFullName=function(){if(!this.obj)return"";var a=this.obj.full_name||"";if(a)return a;var a=(this.obj.first_name||"").trim(),b=(this.obj.last_name||"").trim();return a+" "+b};
ydn.crm.sugar.Record.prototype.names=function(){return this.obj?Object.keys(this.obj):[]};ydn.crm.sugar.Record.prototype.value=function(a){return this.obj?this.obj[a]:void 0};ydn.crm.sugar.gdata={};
ydn.crm.sugar.gdata.collectAddress=function(a,b,c){var d=0;if(!b)return d;b.gd$city&&a[c+"_address_city"]!=b.gd$city.$t&&(a[c+"_address_city"]=b.gd$city.$t,d++);b.gd$country&&a[c+"_address_country"]!=b.gd$country.$t&&(a[c+"_address_country"]=b.gd$country.$t,d++);b.gd$postcode&&a[c+"_address_postalcode"]!=b.gd$postcode.$t&&(a[c+"_address_postalcode"]=b.gd$postcode.$t,d++);b.gd$region&&a[c+"_address_state"]!=b.gd$region.$t&&(a[c+"_address_state"]=b.gd$region.$t,d++);b.gd$street&&a[c+"_address_street"]!=
b.gd$street.$t&&(a[c+"_address_street"]=b.gd$street.$t,d++);b.gd$housename&&a[c+"_address_street_2"]!=b.gd$neighborhood.$t&&(a[c+"_address_street_2"]=b.gd$neighborhood.$t,d++);b.gd$neighborhood&&a[c+"_address_street_3"]!=b.gd$city.$t&&(a[c+"_address_street_3"]=b.gd$city.$t,d++);return d};
ydn.crm.sugar.gdata.compileAddress=function(a,b,c){var d=0;if(!a)return 0;b||(b={});var e=function(e,g){!a[c+g]||b[e]&&b[e].$t==a[c+g]||(d++,b[e]={$t:a[c+g]})};e("gd$city","_address_city");e("gd$country","_address_country");e("gd$postcode","_address_postalcode");e("gd$region","_address_state");e("gd$street","_address_street");e("gd$neighborhood","_address_street_2");e("gd$city","_address_street_3");return d};ydn.crm.sugar.gdata.SYNC_ORGANIZATION=!1;
ydn.crm.sugar.gdata.gdataContact2Record=function(a,b,c,d){a=0;!c.title||d.name&&d.name==c.title.$t||(d.name=c.title.$t,a++);for(b=0;c.gd$email&&b<c.gd$email.length;b++){var e=c.gd$email[b];"http://schemas.google.com/g/2005#work"==e.rel?d.email1!=e.address&&(a++,d.email1=e.address):"http://schemas.google.com/g/2005#home"==e.rel?d.email2!=e.address&&(a++,d.email2=e.address):"http://schemas.google.com/g/2005#other"==e.rel&&d.email!=e.address&&(a++,d.email=e.address)}c.gd$name?(c.gd$name.gd$namePrefix&&
d.salutation!=c.gd$name.gd$namePrefix.$t&&(a++,d.salutation=c.gd$name.gd$namePrefix.$t),c.gd$name.gd$givenName&&d.first_name!=c.gd$name.gd$givenName.$t&&(d.first_name=c.gd$name.gd$givenName.$t,a++),c.gd$name.gd$familyName&&d.last_name!=c.gd$name.gd$familyName.$t&&(d.last_name=c.gd$name.gd$familyName.$t,a++),c.gd$name.gd$fullName&&d.full_name!=c.gd$name.gd$fullName.$t&&(d.full_name=c.gd$name.gd$fullName.$t,a++)):d.full_name=c.title.$t;c.gd$organization&&c.gd$organization[0]&&(b=c.gd$organization[0],
b.gd$orgTitle&&b.gd$orgTitle.$t!=d.title&&(d.title=b.gd$orgTitle.$t,a++),b.gd$orgDepartment&&b.gd$orgDepartment.$t!=d.department&&(d.department=b.gd$orgDepartment.$t,a++),b.gd$orgJobDescription&&b.gd$orgJobDescription.$t!=d.description&&(d.description=b.gd$orgJobDescription.$t,a++));if(c.gd$im)for(b=0;b<c.gd$im.length;b++)"Twitter"==c.gd$im[b].label&&d.twitter!=c.gd$im[b].address?(d.twitter=c.gd$im[b].address,a++):"Facebook"==c.gd$im[b].label&&d.facebook!=c.gd$im[b].address?(d.facebook=c.gd$im[b].address,
a++):"Google Plus"==c.gd$im[b].label&&d.googleplus!=c.gd$im[b].address?(d.googleplus=c.gd$im[b].address,a++):"Linkedin"==c.gd$im[b].label&&d.linkedin!=c.gd$im[b].address&&(d.linkedin=c.gd$im[b].address,a++);c.gContact$birthday&&d.birthdate!=c.gContact$birthday.when&&(d.birthdate=c.gContact$birthday.when,a++);for(b=0;c.gd$phoneNumber&&b<c.gd$phoneNumber.length;b++)if(e=c.gd$phoneNumber[b],e.$t)if("http://schemas.google.com/g/2005#mobile"==e.rel)d.phone_mobile!=e.$t&&(d.phone_mobile=e.$t,a++);else if("http://schemas.google.com/g/2005#work"==
e.rel)d.phone_work!=e.$t&&(d.phone_work=e.$t,a++);else if("http://schemas.google.com/g/2005#home"==e.rel)d.phone_home!=e.$t&&(d.phone_home=e.$t,a++);else if("http://schemas.google.com/g/2005#fax"==e.rel||"http://schemas.google.com/g/2005#home_fax"==e.rel||"http://schemas.google.com/g/2005#work_fax"==e.rel)d.phone_fax!=e.$t&&(d.phone_fax=e.$t,a++);else if(d.phone_other=e.$t)d.phone_other=e.$t,a++;if(c.gd$structuredPostalAddress){var f=e=-1;for(b=0;b<c.gd$structuredPostalAddress.length;b++){var g=c.gd$structuredPostalAddress[b];
"http://schemas.google.com/g/2005#work"==g.rel||g.primary?e=b:f=b}-1==e&&(f=-1);a+=ydn.crm.sugar.gdata.collectAddress(d,c.gd$structuredPostalAddress[e],"primary");a+=ydn.crm.sugar.gdata.collectAddress(d,c.gd$structuredPostalAddress[f],"alt")}return a};
ydn.crm.sugar.gdata.record2GDataContact=function(a,b){a.getDomain();a.getModule();var c=a.getData(),d=0;!c.name||b.title&&b.title.$t==c.name||(b.title=ydn.atom.Entry.asText(c.name),d++);var e=[],f=function(a,f){if(c[a]){b.gd$email||(b.gd$email=[]);var g;a:{g=c[a];for(var h=0;b.gd$email&&h<b.gd$email.length;h++)if(!(0<=e.indexOf(h))&&b.gd$email[h].address==g){g=h;break a}g=-1}0<=g?(h=b.gd$email[g],h.rel!=f&&(d++,h.rel=f),e.push(g)):(b.gd$email.push({rel:f,address:c[a]}),e.push(b.gd$email.length-1),
d++)}};f("email1","http://schemas.google.com/g/2005#work");f("email2","http://schemas.google.com/g/2005#home");f("email","http://schemas.google.com/g/2005#other");f=function(){b.gd$name||(b.gd$name={},d++)};c.salutation&&(f(),b.gd$name.gd$namePrefix&&b.gd$name.gd$namePrefix.$t==c.salutation||(b.gd$name.gd$namePrefix=ydn.atom.Entry.asText(c.salutation),d++));c.first_name&&(f(),b.gd$name.gd$givenName&&b.gd$name.gd$givenName.$t==c.first_name||(b.gd$name.gd$givenName=ydn.atom.Entry.asText(c.first_name),
d++));c.last_name&&(f(),b.gd$name.gd$familyName&&b.gd$name.gd$familyName.$t==c.last_name||(b.gd$name.gd$familyName=ydn.atom.Entry.asText(c.last_name),d++));c.full_name&&(f(),b.gd$name.gd$fullName&&b.gd$name.gd$fullName.$t==c.full_name||(b.gd$name.gd$fullName=ydn.atom.Entry.asText(c.full_name),d++));f=function(a){b.gd$im||(b.gd$im=[]);for(var c=0;c<b.gd$im.length;c++)if(b.gd$im[c].label==a)return b.gd$im[c];return null};if(c.twitter){var g=f("Twitter");g?g.address!=c.twitter&&(g.address=c.twitter,
d++):(b.gd$im.push({label:"Twitter",address:c.twitter}),d++)}c.facebook&&((g=f("Facebook"),g)?g.address!=c.facebook&&(g.address=c.facebook,d++):(b.gd$im.push({label:"Facebook",address:c.facebook}),d++));c.googleplus&&((g=f("Google Plus"),g)?g.address!=c.googleplus&&(g.address=c.googleplus,d++):(b.gd$im.push({label:"Google Plus",address:c.googleplus}),d++));c.linkedin&&((g=f("Linkedin"),g)?g.address!=c.linkedin&&(g.address=c.linkedin,d++):(b.gd$im.push({label:"Linkedin",address:c.linkedin}),d++));
!c.birthdate||b.gContact$birthday&&b.gContact$birthday.when==c.birthdate||(b.gContact$birthday={when:c.birthdate},d++);f=function(a,e){if(c[a]){b.gd$phoneNumber||(b.gd$phoneNumber=[]);var f;a:{for(f=0;b.gd$phoneNumber&&f<b.gd$phoneNumber.length;f++)if(b.gd$phoneNumber[f].rel==e){f=b.gd$phoneNumber[f];break a}f=null}f?f.$t!=c[a]&&(f.$t=c[a],d++):(b.gd$phoneNumber.push({rel:e,$t:c[a]}),d++)}};f("phone_mobile","http://schemas.google.com/g/2005#mobile");f("phone_work","http://schemas.google.com/g/2005#work");
f("phone_home","http://schemas.google.com/g/2005#home");f("phone_fax","http://schemas.google.com/g/2005#work_fax");f("phone_other","http://schemas.google.com/g/2005#other");for(var f=g=-1,h=0;b.gd$structuredPostalAddress&&h<b.gd$structuredPostalAddress.length;h++)-1==g&&"true"==b.gd$structuredPostalAddress[h].primary||"http://schemas.google.com/g/2005#work"==b.gd$structuredPostalAddress[h].rel?g=h:-1==f&&(f=h);-1==g&&0<=f&&(g=f,b.gd$structuredPostalAddress[g].primary="true",f=-1);0<=g?d+=ydn.crm.sugar.gdata.compileAddress(c,
b.gd$structuredPostalAddress[g],"primary"):(g={primary:"true",rel:"http://schemas.google.com/g/2005#work"},h=ydn.crm.sugar.gdata.compileAddress(c,g,"primary"),0<h&&(b.gd$structuredPostalAddress||(b.gd$structuredPostalAddress=[]),b.gd$structuredPostalAddress.push(g),d+=h));0<=f?d+=ydn.crm.sugar.gdata.compileAddress(c,b.gd$structuredPostalAddress[f],"alt"):(g={},h=ydn.crm.sugar.gdata.compileAddress(c,g,"alt"),0<h&&(b.gd$structuredPostalAddress||(b.gd$structuredPostalAddress=[]),b.gd$structuredPostalAddress.push(g),
d+=h));return d};ydn.crm.sugar.utils={};ydn.crm.sugar.utils.toRecordEntry=function(a){if(goog.isArray(a))return a.map(function(a){return ydn.crm.sugar.utils.toRecordEntry(a)});if(goog.isObject(a)){var b={},c;for(c in a.name_value_list)b[c]=a.name_value_list[c].value;return b}throw Error("Invalid name_value_entries");};ydn.crm.sugar.Client=function(a,b,c){ydn.crm.Client.call(this);a=goog.string.startsWith(a,"http")?new goog.Uri(a):(new goog.Uri).setDomain(a).setScheme("https");a.setFragment("");a.setQueryData(null);this.instance_domain=a.getDomain();this.base_url=a.toString().replace(/\/$/,"");this.service_url=this.base_url+"/service/v4/rest.php";this.user_name=b;this.hash_password_=c;this.application_name="Yathit CRM";this.http_client=this.login_data_=null;this.db=new ydn.db.Storage(this.instance_domain,ydn.crm.data.getSugarSchema());
this.th_updators_={};this.initUpdator_();this.server_info_=null;this.request_interval_=ydn.crm.sugar.Client.REQUEST_INTERVAL;this.prev_request_=NaN};goog.inherits(ydn.crm.sugar.Client,ydn.crm.Client);ydn.crm.sugar.Client.DEBUG=goog.DEBUG;ydn.crm.sugar.Client.prototype.getDomain=function(){return this.instance_domain};ydn.crm.sugar.Client.REQUEST_INTERVAL=100;
ydn.crm.sugar.Client.prototype.getRealm=function(a){return ydn.gdata.ExtendedProperty.makeRealm(ydn.gdata.ExtendedProperty.Realm.SUGAR,this.instance_domain,a)};ydn.crm.sugar.Client.prototype.getUserName=function(){return this.user_name};
ydn.crm.sugar.Client.prototype.request=function(a,b,c,d,e,f){for(var g="{",h=0;h<b.length;h++)g+=(0==h?"":",")+'"'+b[h]+'":'+JSON.stringify(c[h]);g+="}";h=new goog.Uri.QueryData;h.add("method",a);h.add("input_type","json");h.add("response_type","json");h.add("rest_data",g);goog.string.hashCode(a+g);ydn.crm.shared.getXhrManager();var g=new ydn.client.HttpRequestData(this.service_url,"POST",{},{"Content-Type":"application/x-www-form-urlencoded"},h.toString()),k=this.getClient().request(g),g=function(){k.execute(function(g,
h){this.prev_request_=goog.now();if(!f&&g&&11==g.number)this.login().addCallbacks(function(){this.request(a,b,c,d,e,!0)},function(a){a=new ydn.client.HttpRespondData(0,null,{},"Login fail");d.call(e,null,a)},this);else{var k=g;if(goog.isString(k))try{g=JSON.parse(k)}catch(p){}d.call(e,g,h)}},this)},h=goog.now()-this.prev_request_;0<h&&h<this.request_interval_?(this.prev_request_=this.request_interval_+this.prev_request_,this.logger.finest("request will call after "+h+" ms."),goog.Timer.callOnce(g,
h,this)):g.call(this)};ydn.crm.sugar.Client.prototype.setClient=function(a){this.http_client=a};
ydn.crm.sugar.Client.prototype.updateClient=function(){if(this.http_client){var a=new goog.async.Deferred,b=new goog.Uri(this.base_url);b.setPath("/");var c=this;chrome.permissions.contains({origins:[b.toString()]},function(b){var e=c.http_client instanceof ydn.client.Proxy;b&&e||!b&&!e?c.logout().addBoth(function(){c.http_client=null;c.login().addBoth(function(){a.callback(c.about())})}):a.callback(c.about())});return a}return this.login().addBoth(function(){return this.about()})};
ydn.crm.sugar.Client.prototype.getClient=function(a,b){if(!this.http_client){var c=new goog.Uri(this.base_url);c.setPath("/");c={origins:[c.toString()]};this.http_client=ydn.client.getClient(ydn.http.Scopes.PROXY);var d=this;chrome.permissions.contains(c,function(c){c&&(d.http_client=ydn.client.getClient(ydn.http.Scopes.DEFAULT));a&&a.call(b,d.http_client)})}return this.http_client};ydn.crm.sugar.Client.prototype.getSessionId=function(){return this.login_data_?this.login_data_.id:null};
ydn.crm.sugar.Client.MAX_LOGIN_RETRY=2;ydn.crm.sugar.Client.MAX_ENTRIES=25;
ydn.crm.sugar.Client.prototype.prepareRestParam=function(a,b){var c=b.module_name,d=["session","module_name"],c=[this.getSessionId(),c],e=[!1,!1];if("get_entry_list"==a){var f=b.query||"";d.push("query");c.push(f);e.push(""==f);d.push("order_by");f=b.order_by||"";c.push(f);e.push(""==f);f=b.offset||0;goog.asserts.assertNumber(f,"offset must be a number");d.push("offset");c.push(f);e.push(0==f);var g=b.select_fields||[];goog.asserts.assertArray(g,"select_fields must be an array");d.push("select_fields");
c.push(g);e.push(0==g.length);var h=b.link_name_to_fields_array||[];goog.asserts.assertArray(g,"link_name_to_fields_array must be an array");d.push("link_name_to_fields_array");c.push(h);e.push(0==h.length);g=b.max_results||ydn.crm.sugar.Client.MAX_ENTRIES;goog.asserts.assertNumber(f,"max_results must be a number");d.push("max_results");c.push(g);e.push(goog.isDefAndNotNull(b.max_results));f=b.deleted||0;goog.asserts.assertNumber(f,"deleted must be a number");d.push("deleted");c.push(f);e.push(0==
f);f=!!b.favorites;d.push("favorites");c.push(f);e.push(!1==f)}else if("get_available_modules"==a)f=b.filter||"",goog.asserts.assertArray(f,"filter must be string"),d.push("filter"),c.push(f),e.push(0==f.length);else if("get_module_fields"==a)f=b.fields||[],goog.asserts.assertArray(f,"fields must be an array"),d.push("fields"),c.push(f),e.push(0==f.length);else if("get_entries"==a)f=b.ids||[],goog.asserts.assertArray(f,"ids must be an array"),d.push("ids"),c.push(f),e.push(!1),g=b.select_fields||
[],goog.asserts.assertArray(g,"select_fields must be an array"),d.push("select_fields"),c.push(g),e.push(0==g.length),h=b.link_name_to_fields_array||[],goog.asserts.assertArray(g,"link_name_to_fields_array must be an array"),d.push("link_name_to_fields_array"),c.push(h),e.push(0==h.length);else for(f in b)"module_name"!=f&&(d.push(f),c.push(b[f]),e.push(!1));goog.asserts.assert(d.length==c.length);goog.asserts.assert(d.length==e.length);for(f=e.length-1;0<=f;f--)if(e[f])d.pop(),c.pop();else break;
return{keys:d,values:c}};ydn.crm.sugar.Client.prototype.getModule2QueryColumnName=function(a,b){return a.toLowerCase()+"."+b};
ydn.crm.sugar.Client.prototype.fetchModule_=function(a){var b=a.module_name;return this.rest("get_entry_list",a).addCallback(function(c){var d=c.result_count,e=c.offset||0,f=c.entry_list,g=parseInt(c.next_offset,10);if(goog.isDef(d)&&goog.isArray(f))return 0<f.length&&(c=ydn.crm.sugar.utils.toRecordEntry(f),this.db.put(b,c)),0<f.length&&d>=f.length&&g>e?(a.offset=g,this.fetchModule_(a)):g;throw Error("Invalid REST respond on entry list query on "+b+": "+JSON.stringify(c));},this)};
ydn.crm.sugar.Client.prototype.getModuleFields=function(a){if(-1==ydn.crm.sugar.Modules.indexOf(a))return goog.async.Deferred.fail("module name "+a+" invalid.");var b={module_name:a},c="module/"+a;return this.db.get("Meta",c).addCallback(function(a){return a?a:this.rest("get_module_fields",b).addCallback(function(a){goog.asserts.assertString(a.module_name,"module_name missing");goog.asserts.assertObject(a.module_fields,"module_fields missing");this.db.put("Meta",a,c);return a},this)},this)};
ydn.crm.sugar.Client.prototype.updateModule=function(a){var b=new ydn.db.IndexIterator(a,"date_modified",null,!0);return this.db.keys(b,1).addCallback(function(b){var d={};b[0]&&(d.query=this.getModule2QueryColumnName(a,"date_modified")+">'"+b[0]+"'");d.module_name=a;d.order_by="date_modified";return this.fetchModule_(d)},this)};ydn.crm.sugar.Client.prototype.update=function(){for(var a in this.th_updators_)this.th_updators_[a].fire()};
ydn.crm.sugar.Client.prototype.rest=function(a,b,c){var d=c||0,e=new goog.async.Deferred,f=this;if(!this.login_data_||!this.login_data_.id)return d<ydn.crm.sugar.Client.MAX_LOGIN_RETRY?(this.logger.finest("Request require login, tried "+d),this.login().addCallback(function(){d++;f.rest(a,b,d).chainDeferred(e)})):(this.logger.finer("Cannot do request, not login. Give up after "+d+" retry"),e.errback()),e;c=this.prepareRestParam(a,b);this.request(a,c.keys,c.values,function(c,h){h.isSuccess()?11==c.number&&
/invalid/i.test(c.name)?(this.login_data_=null,f.rest(a,b,d).chainDeferred(e)):e.callback(c):e.errback(h.getStatus()+" "+h.getStatusText())},this);return e};ydn.crm.sugar.Client.prototype.getLogin=function(){return ydn.object.clone(this.login_data_)};
ydn.crm.sugar.Client.prototype.list=function(a){if(!goog.isArray(a)||0==a.length)return goog.async.Deferred.fail("invalid query");for(var b=[],c=0;c<a.length;c++){var d=a[c];if(!goog.isObject(d))return goog.async.Deferred.fail("invalid query at "+c+"");var e=d.store;if(!goog.isString(e)||0==e.length)return goog.async.Deferred.fail("store name required at "+c);var f=d.index;if(!goog.isString(f)||0==f.length)return goog.async.Deferred.fail("index name missing in "+e);var g=null;goog.isDefAndNotNull(d.key)?
g=ydn.db.KeyRange.only(d.key):goog.isDefAndNotNull(d.keyRange)&&(g=ydn.db.KeyRange.parseKeyRange(d.keyRange));"id"==f?b.push(this.db.values(e,g)):b.push(this.db.values(e,f,g));this.th_updators_[e].fire()}return(new goog.async.DeferredList(b)).addCallbacks(function(b){for(var c=0;c<b.length;c++)b[c][0]?a[c].result=b[c][1]:(this.logger.warning("query "+c+" failed."),a[c].result=[]);return a},function(b){this.logger.warning("list failed "+b);return a},this)};
ydn.crm.sugar.Client.prototype.getEntry=function(a){var b=a.store;if(!goog.isString(b)||0==b.length)return goog.async.Deferred.fail("store name required.");a=a.id;return goog.isString(a)&&0!=a.length?this.db.get(b,a):goog.async.Deferred.fail("id required.")};
ydn.crm.sugar.Client.prototype.getServerInfo=function(){if(this.server_info_&&this.server_info_.isLogin)return goog.async.Deferred.succeed(this.server_info_);var a=new goog.async.Deferred;this.db.get("Meta","info/server").addBoth(function(b){b&&b.version?(this.server_info_=b,a.callback(b)):this.getClient(function(b){b instanceof ydn.client.Proxy&&/proxy/.test(b.getProxyPath());this.request("get_server_info",[],[],function(b,c){if(0==c.getStatus())this.server_info_=null,a.errback("service "+this.service_url+
" not responding");else if(c.isSuccess()){var f=c.getBody();if((!b||!b.version)&&goog.isString(f))try{b=JSON.parse(f)}catch(g){b=c.getBody()}b&&b.version?(f=b,this.server_info_=goog.object.clone(f),a.callback({info:f,about:this.about()}),this.db.put("Meta",f,"info/server")):(this.server_info_=null,a.errback("invalid respond "+c.getBody()))}else this.server_info_=null,a.errback("request fail "+c.getStatus()+" "+c.getStatusText())},this)},this)},this);return a};
ydn.crm.sugar.Client.prototype.getAvailableModules=function(){var a=new goog.async.Deferred;this.request("get_available_modules",["filter"],["all"],function(b){a.callback(b)},this);return a};ydn.crm.sugar.Client.prototype.about=function(){var a=this.getClient(),a=a instanceof ydn.client.Proxy&&/proxy/.test(a.getProxyPath());return{baseUrl:this.base_url,domain:this.getDomain(),userName:this.getUserName(),isLogin:this.isLogin(),hostPermission:!a}};
ydn.crm.sugar.Client.prototype.getDetails=function(){return(new goog.async.DeferredList([this.getServerInfo(),this.getAvailableModules()])).addCallback(function(a){return{serverInfo:a[0][1],availableModules:a[1][1],about:this.about()}},this)};ydn.crm.sugar.Client.prototype.getViewLink=function(a,b){return ydn.crm.sugar.getViewLink(this.instance_domain,a,b)};
ydn.crm.sugar.Client.prototype.putEntry=function(a,b){goog.asserts.assert(goog.isString(a)&&0<a.length,"module name required.");var c=[],d;for(d in b)c.push({name:d,value:b[d]});c={module_name:a,name_value_list:c};ydn.crm.sugar.Client.DEBUG&&window.console.log("set_entry",c);return this.rest("set_entry",c).addCallback(function(b){if(b&&b.id){var c={id:b.id};b=b.entry_list||{};for(var d in b)c[d]=b[d].value;ydn.crm.sugar.Client.DEBUG&&window.console.log("set_entry result",c);this.db.put(a,c);return c}throw Error("creating "+
a+" entry fail");},this)};ydn.crm.sugar.Client.prototype.syncEntry=function(a){a=a.listExternalId("sugarcrm",this.getDomain());for(var b=0;b<a.length;b++)0<=ydn.crm.sugar.SyncModules.indexOf(a[b].module)&&this.db.get(a[b].module,a[b].id).addCallback(function(a){a&&window.console.log(a)},this)};
ydn.crm.sugar.Client.prototype.putGData=function(a,b){goog.asserts.assert(goog.isString(a)&&0<a.length,"module name required.");var c={};ydn.crm.sugar.gdata.gdataContact2Record(this.getDomain(),a,b,c);return this.putEntry(a,c)};ydn.crm.sugar.Client.prototype.isLogin=function(){return!!this.getSessionId()};
ydn.crm.sugar.Client.prototype.initUpdator_=function(){for(var a=function(a){this.th_updators_[a]=new goog.async.Throttle(function(){this.isLogin()&&(this.logger.finer("Updating "+a),this.updateModule(a))},12E4,this)},b=0;b<ydn.crm.sugar.SyncModules.length;b++)a.call(this,ydn.crm.sugar.SyncModules[b])};
ydn.crm.sugar.Client.prototype.login=function(a,b){a&&(this.user_name=a);b&&(this.hash_password_=b);if(!this.user_name)return goog.async.Deferred.fail("username required.");if(!this.hash_password_)return goog.async.Deferred.fail("password required.");var c=new goog.async.Deferred,d=["user_auth","application_name","name_value_list"],e=[{user_name:this.user_name,password:this.hash_password_},this.application_name,{language:"",notifyonsave:"false"}];this.getClient(function(){this.request("login",d,e,
function(a,b){if(a&&a.id)this.login_data_=goog.object.clone(a),c.callback(a);else if(a&&a.description)c.errback(a.description+" ("+a.name+")");else{var d=b.getStatus()+" "+b.getStatusText()+" "+b.getBody();c.errback("Login fail: "+d.substr(0,200))}},this,!0)},this);return c};
ydn.crm.sugar.Client.prototype.logout=function(){var a=new goog.async.Deferred;this.request("logout",[],[],function(b,c){this.login_data_=null;c.isSuccess()?(this.logger.warning("Logout request fail with "+c.getStatus()+" "+c.getStatusText()),a.callback(!0)):a.errback(c.getStatus()+" "+c.getStatusText())},this,!0);return a};ydn.crm.sugar.Client.PATH_REST_V4="/service/v4/rest.php";
ydn.crm.sugar.Client.sniffServerInfo=function(a,b){var c=new goog.async.Deferred;a=a.trim();goog.string.startsWith(a,"http")||(a="https://"+a);var d=new goog.Uri(a);d.setFragment("");d.setQueryData(null);var e=ydn.client.getClient(ydn.http.Scopes.PROXY),f=function(a,b){var c=new goog.Uri.QueryData;c.add("method","get_server_info");c.add("input_type","json");c.add("response_type","json");c.add("rest_data","{}");c=new ydn.client.HttpRequestData(a,"POST",{},{"Content-Type":"application/x-www-form-urlencoded"},
c.toString());e.request(c).execute(b)},g=function(){var a=new ydn.client.HttpRequestData(d.toString());e.request(a).execute(function(a,b){/sugarcrm/i.test(b.getBody())?c.errback("Look like SugarCRM web site, but REST V4 API is not available."):200==b.getStatus()?c.errback("Not a SugarCRM web site"):c.errback("Invalid respond, "+b.getStatus())})},h=d.clone(),k=d.getPath();/rest.php$/.test(k)||(/index.php$/.test(k)?h.setPath(k.replace("/index.php","")):h.setPath(""));var l=h.toString();(function(a,
b){f(a+ydn.crm.sugar.Client.PATH_REST_V4,function(a,c){if(200==c.getStatus()){if(!a||!a.version){var d=c.getBody();if(goog.isString(d))try{a=JSON.parse(d)}catch(e){b(null,c);return}else a=d}a&&a.version&&b(a,c)}else b(0,c)})})(l,function(a,b){a?(a.isLogin=!1,a.userName=null,a.domain=h.getDomain(),a.baseUrl=l,c.callback(a)):0==a?"https"==d.getScheme()?(h.setScheme("http"),f(h.toString(),function(a,b){a?c.callback(c):g()})):c.errback(b.getStatus()+" "+b.getStatusText()+" "+b.getBody()):g()});return c};
goog.DEBUG&&(ydn.crm.sugar.Client.prototype.toString=function(){return"SugarClient:"+this.instance_domain});ydn.gdata.EntryEventType={CREATED:goog.events.getUniqueId("created"),UPDATED:goog.events.getUniqueId("updated"),DELETED:goog.events.getUniqueId("deleted")};ydn.gdata.EntryEvent=function(a,b,c){goog.events.Event.call(this,a,b);this.entry=c};goog.inherits(ydn.gdata.EntryEvent,goog.events.Event);ydn.gdata.EntryCreatedEvent=function(a,b){ydn.gdata.EntryEvent.call(this,ydn.gdata.EntryEventType.CREATED,a,b)};goog.inherits(ydn.gdata.EntryCreatedEvent,ydn.gdata.EntryEvent);
ydn.gdata.EntryDeletedEvent=function(a,b,c){this.old_entry=c;ydn.gdata.EntryEvent.call(this,ydn.gdata.EntryEventType.DELETED,a,b)};goog.inherits(ydn.gdata.EntryDeletedEvent,ydn.gdata.EntryEvent);ydn.gdata.EntryUpdatedEvent=function(a,b,c){this.old_entry=c;ydn.gdata.EntryEvent.call(this,ydn.gdata.EntryEventType.UPDATED,a,b)};goog.inherits(ydn.gdata.EntryUpdatedEvent,ydn.gdata.EntryEvent);ydn.gdata.error={};ydn.gdata.error.InvalidAtomFormatError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.gdata.error.InvalidAtomFormatError):this.stack=Error().stack||"";a&&(this.message=String(a))};goog.inherits(ydn.gdata.error.InvalidAtomFormatError,Error);ydn.gdata.error.InvalidAtomFormatError.prototype.name="ydn.gdata.error.InvalidAtomFormatError";
ydn.gdata.error.IncompatibleError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.gdata.error.IncompatibleError):this.stack=Error().stack||"";a&&(this.message=String(a))};goog.inherits(ydn.gdata.error.IncompatibleError,Error);ydn.gdata.error.IncompatibleError.prototype.name="ydn.gdata.error.IncompatibleError";ydn.gdata.xml={};ydn.gdata.xml.LoadError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.gdata.xml.LoadError):this.stack=Error().stack||"";this.error_content=a;b&&(this.message=String(b))};goog.inherits(ydn.gdata.xml.LoadError,Error);
ydn.gdata.xml.ConflictError=function(a,b,c,d,e){e=e||"";c&&(e="reference: "+c+" "+e);b&&(e="existing_entry_id: "+b+" "+e);a&&(e=a+" ConflictError. "+e);ydn.gdata.xml.LoadError.call(this,d,e);this.existing_entry_id=b;this.reference=c;this.reason=a};goog.inherits(ydn.gdata.xml.ConflictError,ydn.gdata.xml.LoadError);
ydn.gdata.xml.loadXml=function(a){try{var b=ydn.xml.parse(a)}catch(c){if(c instanceof ydn.xml.ParserError&&(a=c.error_content.match(/Duplicate insert.+?&quot;(.+?)&quot;.+?(\d+)$/)))throw new ydn.gdata.xml.ConflictError("Duplicate insert",a[2],a[1],c.error_content,c.message);throw new ydn.gdata.xml.LoadError(c.error_content,c.message);}return b};ydn.gdata.xml.GDATA_XMLNS="atom app gd xhtml batch openSearch".split(" ");
ydn.gdata.xml.buildFeedXml=function(a,b,c){goog.isDef(c)||(c=ydn.gdata.xml.GDATA_XMLNS);for(var d="",e=0;e<c.length;e++)var f=c[e],d=0==e?d+(' xmlns="'+ydn.xml.namespaces[f]+'" '):d+(" xmlns:"+f+'="'+ydn.xml.namespaces[f]+'" ');b=b||"";a=goog.isDef(a)?"<id>"+a+"</id>":"";return"<feed"+d+">"+a+b+"</feed>"};ydn.testing={};ydn.testing.Sniffer=function(a,b){this.id=a;this.codes=[];this.console=b};ydn.testing.Sniffer.prototype.setLogger=function(a){this.logger=a};ydn.testing.Sniffer.prototype.setId=function(a){this.id=a};ydn.testing.Sniffer.prototype.message=function(a){this.codes.push(a.id+" "+a.code);this.console&&this.console.log(this.id+" "+a.id+" "+a.code);this.logger&&goog.isDef(a.level)&&goog.isDef(a.message)&&this.logger.log(a.level,a.message)};
ydn.testing.Sniffer.prototype.setMessenger=function(a){this.message=a};ydn.testing.Sniffer.prototype.received=function(){return goog.bind(this.message,this)};ydn.testing.Sniffer.prototype.has=function(a){return this.codes.some(function(b){return a.test(b)})};ydn.testing.Sniffer.prototype.find=function(a){goog.isString(a)&&(a=RegExp(a));return this.codes.filter(function(b){return a.test(b)}).join("\n")};ydn.testing.Sniffer.prototype.has_synced=function(){return this.has(/need_syncing 1/)};
ydn.testing.Sniffer.prototype.has_not_synced=function(){return this.has(/need_syncing 0/)};ydn.testing.Sniffer.prototype.disp=function(a){for(var b=0;b<this.codes.length;b++)if(a){var c=this.codes[b].split(" ");a==c[0]&&this.console.info(this.codes[b])}else this.console.info(this.codes[b])};ydn.gdata.Feed=function(a){if(!goog.isDef(this.type))throw new ydn.error.InvalidOperationException("Abstract class cannot be instantiated.");if(goog.isString(a))a={id:{$t:a}};else if(!goog.isDef(a.id)||!goog.isString(a.id.$t))throw new ydn.error.ArgumentException("Invalid GDataFeed");this.id=a.id.$t;this.data=a;goog.isDef(this.data.entry)?goog.isArray(this.data.entry)||(this.data.entry=[this.data.entry]):this.data.entry=[];this.entry_id_hash_={};this.entry_simple_id_hash_={};a=goog.isArray(this.data.entry)?
this.data.entry.length:0;for(var b=0;b<a;b++){var c=this.data.entry[b],c=c.id?c.id.$t:c.batch?c.batch.$t:"";if(0==c.length)throw new ydn.gdata.error.InvalidAtomFormatError("entry "+b);if(0==c.match(/\w+$/)[0].length)throw new ydn.gdata.error.InvalidAtomFormatError("entry "+b+" of "+c);var d=c.match(/\w+$/)[0];this.entry_id_hash_[c]=this.data.entry[b];this.entry_simple_id_hash_[d]=this.data.entry[b]}this.is_ready=!0;this.txQueue=[];this.updated_min=NaN;this.new_data_received_firrer=new goog.async.Delay(function(a){this.dispatchEvent(ydn.gdata.Feed.EventType.NEW_DATA_RECEIVED)},
300,this);this.transport_=null;this.last_fetch=NaN;this.last_result=null;this.last_fetch_next_uri=void 0;this.last_fetch_entry_=null;ydn.gdata.Feed.DEBUG&&(this.last_batch_feed=this.last_commit=null)};goog.inherits(ydn.gdata.Feed,ydn.EventState);ydn.gdata.Feed.EventType={INVALIDATED:goog.events.getUniqueId("invalidated"),RESTORED:goog.events.getUniqueId("restored"),LOADED:goog.events.getUniqueId("loaded"),UPDATED:goog.events.getUniqueId("updated"),NEW_DATA_RECEIVED:goog.events.getUniqueId("lap")};
ydn.gdata.Feed.UpdateStrategy={LAST_FETCH:"lf",LAST_UPDATED_ENTRY:"lu",LAST_ONE:"lo",NONE:"no"};ydn.gdata.Feed.DEBUG=!1;ydn.gdata.Feed.prototype.getType=function(){return this.type};ydn.gdata.Feed.prototype.getFeedData=function(){return this.data};ydn.gdata.Feed.prototype.getKind=function(){return this.kind};ydn.gdata.Feed.prototype.getTitle=ydn.atom.Atom.prototype.getTitle;ydn.gdata.Feed.prototype.getUpdatedDate=ydn.atom.Atom.prototype.getUpdatedDate;ydn.gdata.Feed.prototype.getUpdated=ydn.atom.Atom.prototype.getUpdated;
ydn.gdata.Feed.prototype.updateStrategy=ydn.gdata.Feed.UpdateStrategy.LAST_UPDATED_ENTRY;ydn.gdata.Feed.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.Feed");
ydn.gdata.Feed.prototype.onReady=function(a){var b=new goog.async.Deferred;this.logger.finest(this+" receiving a task, ready: "+this.is_ready);var c=this;this.is_ready?(this.is_ready=!1,b.addBoth(function(){c.logger.finest(c+" finish the task.");c.is_ready=!0;var a=c.txQueue.shift();a&&a.call(this)}),a.call(this,b)):this.txQueue.push(goog.partial(goog.bind(a,this),b));return b};ydn.gdata.Feed.prototype.transport_=null;ydn.gdata.Feed.prototype.getTransport=function(){return this.transport_||ydn.http.getTransport(this.getFeedUri())};
ydn.gdata.Feed.prototype.setTransport=function(a){this.transport_=a};ydn.gdata.Feed.prototype.invalidate=function(){this.dispatchEvent(ydn.gdata.Feed.EventType.INVALIDATED)};ydn.gdata.Feed.prototype.getBatchXmlNs=function(){return ydn.gdata.xml.GDATA_XMLNS};ydn.gdata.Feed.DELAY_DISPATCH=300;ydn.gdata.Feed.prototype.queue_commit=function(){this.delay_timer_queue_commit||(this.delay_timer_queue_commit=new goog.async.Delay(function(){this.commit()},ydn.gdata.Feed.DELAY_DISPATCH,this));this.delay_timer_queue_commit.start()};
ydn.gdata.Feed.prototype.handle_200=function(a){var b=this.getEntry(a.getId());if(b){if(ydn.gdata.Feed.DEBUG){var c=b.getEtag(),d=a.getEtag(),e=a.getBatchOperationType()+b+" old etag: "+c+" --\x3e new etag: "+d;c&&c==d?this.logger.warning(e+" (no change)"):this.logger.finest(e)}b.update(a);a.getBatchOperationType()===ydn.gdata.Entry.BatchType.DELETE?(b.setDeleted(),goog.Timer.callOnce(function(){this.dispatchEvent(new ydn.gdata.EntryDeletedEvent(this,b,a))},0,this)):goog.Timer.callOnce(function(){this.dispatchEvent(new ydn.gdata.EntryUpdatedEvent(this,
b,a))},0,this)}else this.logger.warning("Receiving created with 200 status code."),this.handle_201(a)};ydn.gdata.Feed.prototype.handle_201=function(a){var b=a.getBatchId(),c=goog.isDef(b)?this.getEntry(b):null;c?c.update(a):(b&&this.logger.warning("Entry for "+b+" not found."),this.addEntry(a));goog.Timer.callOnce(function(){this.dispatchEvent(new ydn.gdata.EntryCreatedEvent(this,a))},0,this)};
ydn.gdata.Feed.prototype.commit_callback=function(a){ydn.gdata.Feed.DEBUG&&(ydn.gdata.Feed.last_commit_result=a);a.isSuccessStatusCode()||this.logger.warning("Batch submission failed. "+a.responseText)};ydn.gdata.Feed.prototype.commit_content=function(a,b){ydn.gdata.Feed.DEBUG&&(this.last_commit=a);this.delay_timer_queue_commit&&this.delay_timer_queue_commit.stop();var c=this.getTransport(),d=this.getBatchUri();c.send(d,b,{method:"POST",body:a,headers:{"Content-Type":"application/atom+xml"},params:{}})};
ydn.gdata.Feed.prototype.commit=function(a,b){for(var c=goog.dom.xml.loadXml(ydn.gdata.xml.buildFeedXml(void 0,void 0,this.getBatchXmlNs())),d=0,e,f=0;e=this.getEntryAt(f);f++)if(e.isDeleted())e.clearStatus();else if(e.isDirty()){var g=e.hasDeleted(),h=!!e.getEntryId();e.removeStatus();var k=e.toElement(c.documentElement),l=k.getElementsByTagNameNS(ydn.xml.resolveNS("batch"),"operation"),l=l[0]?l[0]:k.appendChild(c.createElementNS(ydn.xml.resolveNS("batch"),"operation")),k=c.createAttribute("type");
k.nodeValue=g?ydn.gdata.BatchType.DELETE:h?ydn.gdata.BatchType.UPDATE:ydn.gdata.BatchType.INSERT;l.setAttributeNode(k);e.setCommitted();d++;goog.DEBUG&&a&&a.message({id:this.getKey(),code:"operation: "+k.nodeValue+" "+e})}if(0==d)return this.logger.fine(this+" Nothing to commit."),0;this.logger.fine(this+" committing "+d+" entries.");e=goog.dom.xml.serialize(c);ydn.gdata.Feed.DEBUG&&(this.last_batch_feed=c);b?(this.logger.info("Commit ignored for dry run."),goog.DEBUG&&window.console.log(e)):this.commit_content(e,
goog.bind(this.commit_callback,this));return d};ydn.gdata.Feed.prototype.addEntry=function(a){var b=a instanceof ydn.gdata.Entry?a:this.buildEntry(a);b.normalize();var c=b.getId(),d=this.getEntry(c),e=!!d;e?d.update(b):(d=b.getSingleId(),this.data.entry.push(a),this.entry_id_hash_[c]=b.getData(),this.entry_simple_id_hash_[d]=b.getData());return!e};ydn.gdata.Feed.prototype.buildEntry=function(a){return new ydn.gdata.Entry(a)};
ydn.gdata.Feed.prototype.getEntryAt=function(a){return 0<=a&&a<this.data.entry.length?this.buildEntry(this.data.entry[a]):null};ydn.gdata.Feed.prototype.getEntry=function(a){return(a=this.entry_id_hash_[a])?this.buildEntry(a):null};ydn.gdata.Feed.prototype.getEntryBySimpleId=function(a){return(a=this.entry_simple_id_hash_[a])?this.buildEntry(a):null};ydn.gdata.Feed.prototype.getLastUpdatedEntry=function(){for(var a=0,b=-1,c,d=0;c=this.getEntryAt(d);d++)c=c.getUpdated(),a<c&&(a=c,b=d);return this.getEntryAt(b)};
ydn.gdata.Feed.STORE_NAME_FEED="ydn.gdata.feed";ydn.gdata.Feed.STORE_NAME_ENTRY="ydn.gdata.entry";ydn.gdata.Feed.STORE_SCHEMA_FEED={name:ydn.gdata.Feed.STORE_NAME_FEED,keyPath:"key",type:"TEXT"};ydn.gdata.Feed.STORE_SCHEMA_ENTRY={name:ydn.gdata.Feed.STORE_NAME_ENTRY,keyPath:"id.$t",type:"TEXT"};ydn.gdata.Feed.prototype.getParentKeyRange=function(){return ydn.db.KeyRange.starts(this.getKey())};ydn.gdata.Feed.prototype.setStore=function(a,b){this.store=a;return b&&this.store?this.restore():goog.async.Deferred.succeed(!0)};
ydn.gdata.Feed.prototype.restore=function(){if(this.store){var a=this,b=ydn.gdata.Feed.STORE_NAME_FEED,c=ydn.gdata.Feed.STORE_NAME_ENTRY,d=this.getKey(),e=this.getParentKeyRange(),f=new goog.async.Deferred;this.onReady(function(g){f.chainDeferred(g);var h=a.store.get(b,d);h.addCallback(function(b){if(b){var d=a.store.values(c,e);d.addCallback(function(c){b.data={};b.data.id={$t:a.id};b.data.entry=c;a.fromJSON(b,g)});d.addErrback(function(b){ydn.gdata.Feed.DEBUG&&window.console.log([a,b]);b=a+": error retrieving entries: "+
b.message;a.logger.severe(b);g.errback(b)})}else g.errback("feed not found.")});h.addErrback(function(b){ydn.gdata.Feed.DEBUG&&window.console.log([a,b]);b=a+": error retrieving feed: "+b.message;a.logger.severe(b);g.errback(b)})});return f}return goog.async.Deferred.fail(!1)};
ydn.gdata.Feed.prototype.save=function(a){if(this.store){var b=this,c=ydn.gdata.Feed.STORE_NAME_FEED,d=ydn.gdata.Feed.STORE_NAME_ENTRY;this.saver||(this.saver=new goog.async.Delay(function(){this.onReady(function(a){var f=b.toJSON(),g=b.data.entry,h,k,l;b.store.run(function(a){a.put(c,f).addErrback(function(a){throw a;}).addCallback(function(){h=!0});goog.asserts.assertArray(g,"entry_json");a.put(d,g).addErrback(function(a){throw a;}).addCallback(function(a){l=a.length;k=!0})},[c,d],ydn.db.base.StandardTransactionMode.READ_WRITE).addCallbacks(function(){h&&
k?this.logger.finest(b+": saved "+l+" entries."):this.logger.finest(b+": saved failed"+g.length+" entries.");a.callback(!0)},function(a){throw a;},this)})},1E3,this));a?this.saver.fire():this.saver.start()}};ydn.gdata.Feed.prototype.on_new_data_received=function(){this.save();this.new_data_received_firrer.start()};
ydn.gdata.Feed.prototype.fetch_all_=function(a,b){b=b||new goog.async.Deferred;var c=this,d=this.getTransport();if(!d)return this.logger.warning(this+": No transport available."),b.errback(Error("No transport available.")),b;d.send(a,function(a){if(200==a.status){ydn.gdata.Feed.DEBUG&&(c.last_result=a);c.last_fetch=goog.now();a=a.getResponseJson();if(!a.feed)throw new ydn.gdata.error.InvalidAtomFormatError("feed missing.");var d=a.feed;if(!goog.isDef(d))throw a=ydn.json.stringify(d),new ydn.gdata.error.InvalidAtomFormatError(a.substr(0,
50));if(d.id.$t!=c.getId())throw new ydn.gdata.error.IncompatibleError(d.id.$t+" is not "+c.getId());var g=a=0,h=goog.isArray(d.entry)?d.entry:d.entry?[d.entry]:[];a=h.length;0==a&&c.logger.finest(c+": fetch return no result.");for(var k=0;k<a;k++)c.addEntry(h[k])&&g++;c.logger.fine(c+" "+a+" ("+g+" new) entries received");c.invalidate();if(d=ydn.atom.Link.getLink(d,ydn.atom.Link.Rel.NEXT))c.on_new_data_received(),c.last_fetch_next_uri=d.$t,c.fetch_all_(d.href,b);else{if(0<a)c.on_new_data_received();
b.callback(!0)}}else c.logger.warning("Fetching "+a.uri+" failed: "+a.status),b.errback(!1)});return b};ydn.gdata.Feed.prototype.include_deleted=!0;ydn.gdata.Feed.prototype.toString=function(){return this.type+":"+this.id};ydn.gdata.Feed.prototype.setIncludeDeleted=function(a){this.include_deleted=!!a};ydn.gdata.Feed.prototype.setUpdatedMin=function(a){this.updated_min=a?+a:NaN};ydn.gdata.Feed.prototype.getUpdatedMin=function(){return this.updated_min};
ydn.gdata.Feed.prototype.setBasicParameters=function(a){this.gdata_version&&a.setParameterValue("v",this.gdata_version);a.setParameterValue("alt","json");this.include_deleted&&a.setParameterValue("showdeleted",!0)};
ydn.gdata.Feed.prototype.setQueryParameters=function(a,b){var c=!1;if(ydn.gdata.Feed.UpdateStrategy.LAST_FETCH==a){if(this.last_fetch){var c=!0,d=new Date(this.last_fetch);b.setParameterValue("updated-min",d.toISOString())}}else if(ydn.gdata.Feed.UpdateStrategy.LAST_UPDATED_ENTRY==a){if(d=this.getLastUpdatedEntry())d=d.getUpdatedDate(),d=new Date(1+ +d),b.setParameterValue("updated-min",d.toISOString())}else ydn.gdata.Feed.UpdateStrategy.LAST_ONE==a?(b.setParameterValue("orderby","lastmodified"),
this.last_fetch&&b.setParameterValue("max-results","1")):a=ydn.gdata.Feed.UpdateStrategy.NONE;this.logger.finest(this+" updating "+(c?"continue":"begin")+" by "+a);return c};ydn.gdata.Feed.prototype.getLink=ydn.atom.Atom.prototype.getLink;ydn.gdata.Feed.prototype.getId=ydn.atom.Atom.prototype.getId;ydn.gdata.Feed.prototype.getLinkEdit=ydn.atom.Atom.prototype.getLinkEdit;ydn.gdata.Feed.prototype.getLinkSelf=ydn.atom.Atom.prototype.getLinkSelf;ydn.gdata.Feed.prototype.getLinkBatch=ydn.atom.Atom.prototype.getLinkBatch;
ydn.gdata.Feed.prototype.getFeedUri=function(){return this.getLinkSelf()||""};ydn.gdata.Feed.prototype.getKey=function(){return this.id};ydn.gdata.Feed.prototype.getBatchUri=function(){return this.getLinkBatch()};
ydn.gdata.Feed.prototype.update_=function(a){return this.onReady(function(b){var c=new goog.Uri(this.getFeedUri());this.setBasicParameters(c);this.setQueryParameters(a,c);this.setState(ydn.State.StateValue.DONE,!1);this.fetch_all_(c.toString()).addBoth(function(a){this.setDone();a?b.callback(!0):b.errback(void 0)},this)})};
ydn.gdata.Feed.prototype.probeLastUpdated=function(a){var b=this.getTransport(),c=new goog.Uri(this.getLinkSelf());this.setBasicParameters(c);c.setParameterValue("alt","json");c.setParameterValue("orderby","lastmodified");c.setParameterValue("sortorder","descending");c.setParameterValue("max-results","1");b.send(c.toString(),function(b){b.isSuccessStatusCode()?(b=b.getResponseJson(),b=goog.object.getValueByKeys(b,["feed","entry",0,"updated","$t"]),a(Date.parse(b))):a(NaN)})};
ydn.gdata.Feed.prototype.update=function(a){var b=this,c=this.updateStrategy||ydn.gdata.Feed.UpdateStrategy.NONE;if(!a&&this.isDone())return this.logger.finest(this+" already loaded."),goog.async.Deferred.succeed(!1);if(c==ydn.gdata.Feed.UpdateStrategy.LAST_ONE){var d=new goog.async.Deferred;this.probeLastUpdated(function(a){var c=b.getLastUpdatedEntry();c&&c.getUpdated()<a?d.chainDeferred(b.update_(ydn.gdata.Feed.UpdateStrategy.NONE)):(b.logger.finest(this+" update not required."),d.callback(!1))});
return d}return this.update_(c)};ydn.gdata.Feed.prototype.count=function(a){if(a){a=0;for(var b,c=0;b=this.getEntryAt(c);c++)b.notDeleted()&&a++;return a}return this.data.entry.length};ydn.gdata.Feed.prototype.toJSON=function(){return{id:this.id,key:this.getKey(),last_fetch_next_uri:this.last_fetch_next_uri,last_fetch:this.last_fetch}};
ydn.gdata.Feed.prototype.setLoaded=function(){this.setState(ydn.State.StateValue.LOADED,!0);goog.Timer.callOnce(function(){this.dispatchEvent(ydn.gdata.Feed.EventType.LOADED)},0,this)};
ydn.gdata.Feed.prototype.fromJSON=function(a,b){var c=this,d=function(b){if(a.id!=c.id){var d=c+": incompatible JSON object ignored: "+a.id;c.logger.warning(d);return b.errback(d)}goog.isDef(a.last_fetch_next_uri)&&(c.last_fetch_next_uri=a.last_fetch_next_uri);goog.isDef(a.last_fetch)&&(c.last_fetch=a.last_fetch);if(goog.isDef(a.data)){goog.array.clear(c.data.entry);c.invalidate();d=a.data;d.id.$t!=c.id&&c.logger.warning("Feed id: "+d.id.$t+" is not "+c.id);for(var g=goog.isArray(d.entry)?d.entry.length:
0,h=0;h<g;h++)c.addEntry(d.entry[h]);c.logger.finest(c+": "+g+" entries loaded.")}b.callback(!0);c.setLoaded()};return goog.isDef(b)?(d(b),b):this.onReady(function(a){d(a)})};ydn.gdata.Feed.prototype.delay_timer_update_event_=null;
ydn.gdata.Feed.prototype.delay_dispatch_updated_event=function(){this.delay_timer_update_event_||(this.delay_timer_update_event_=new goog.async.Delay(function(){this.logger.finest("Firing delay_dispatch_updated_event");this.dispatchEvent(ydn.gdata.Feed.EventType.UPDATED)},ydn.gdata.Feed.DELAY_DISPATCH,this));this.delay_timer_update_event_.start()};
ydn.gdata.Feed.prototype.fetchEntry_=function(a){if(goog.DEBUG){var b={alt:"json"};!/v=/.test(a)&&this.gdata_version&&(b.v=this.gdata_version);this.getTransport().send(a,function(a){this.last_fetch_entry_=a;window.console.log(a)},{params:b})}};ydn.gdata.Feed.prototype.fetchFeed_=function(a){if(goog.DEBUG){var b={alt:"json"};a=a||this.getFeedUri();!/v=/.test(a)&&this.gdata_version&&(b.v=this.gdata_version);this.getTransport().send(a,function(a){this.last_fetch_entry_=a;window.console.log(a)},{params:b})}};
ydn.gdata.Feed.prototype.disp=function(){window.console.log("Feed: "+this.getKey());window.console.log(this.count()+" entries.");for(var a,b=0;a=this.getEntryAt(b);b++)window.console.log(b+". "+a.toDispString())};ydn.gdata.Feed.prototype._setDone=function(){goog.DEBUG&&this.setDone()};ydn.gdata.m8={};ydn.gdata.m8.utils={};ydn.gdata.m8.utils.gdata_version="3.0";ydn.gdata.m8.utils.parseFeedUri=function(a){return(a=a.match(/https?:\/\/www.google.com\/m8\/feeds\/(group|contact|batch)s?\/([^\/]+)\/?(\w+)\/?(\w*)?/))?{gdata_type:ydn.gdata.Type.CONTACT,kind:ydn.gdata.base.toKind(a[1]),user_id:a[2]?a[2].replace("%40","@"):"",projection:a[3],id:a[4]}:null};
ydn.gdata.m8.utils.buildFeedUri=function(a,b,c,d,e){b=b||"base";goog.isDef(e)||(e="base"!=b);d=d?"/"+d:"";return(e?"https":"http")+"://www.google.com/m8/feeds/"+(c||"contact")+"s/"+a.replace("@","%40")+"/"+b+d};ydn.gdata.m8.utils.structuredPhone=function(a){var b,c=a.match(/^\D*0*(\d{1,2}\D)?\D*0*(.+)/);c?(b=c[1].replace(/\D/g,""),a=c[2].replace(/\D/g,"")):a=a.replace(/\D/g,"");return{cc:b,pn:a}};
ydn.gdata.m8.utils.isSubsetOf=function(a,b){var c=ydn.gdata.m8.utils.structuredPhone(a),d=ydn.gdata.m8.utils.structuredPhone(b);if(goog.isDef(c.cc)&&goog.isDef(d.cc)&&0!=c.cc.length&&0!=d.cc.length&&c.cc!==d.cc)return 0;if(goog.isDef(c.ph)&&0!=c.ph.length){if(goog.isDef(d.ph)&&0!=d.ph.length){if(c.ph.length>=d.ph.length){for(var e=0;e<d.ph.length;e++)if(c.ph[e]!=d.ph[e])return 0;return 1}for(e=0;e<c.ph.length;e++)if(c.ph[e]!=d.ph[e])return 0}return-1}return 1};
ydn.gdata.m8.utils.phoneSimilarScore=function(a,b){if(!a||!b||0==a.length||0==b.length)return 0;a=a.trim();b=b.trim();var c=ydn.gdata.m8.utils.structuredPhone(a),d=ydn.gdata.m8.utils.structuredPhone(b);return c.cc&&c.pn&&c.cc==d.cc&&c.pn==d.pn?6<=c.pn.length?1:4<=c.pn.length?0.8:0.4:c.pn&&4<=c.pn.length&&c.pn==d.pn?8<=c.pn.length?0.8:4<=c.pn.length?0.6:0.4:0};
ydn.gdata.m8.utils._contactSimilarityScore=function(a,b,c){var d=0;if(a.gd$email&&b.gd$email)for(var e=a.gd$email.length;e--;)for(var f=b.gd$email.length;f--;)a.gd$email[e].address==b.gd$email[f].address&&(d+=1);if(a.gContact$groupMembershipInfo&&b.gContact$groupMembershipInfo)for(e=a.gContact$groupMembershipInfo.length;e--;)if(f=a.gContact$groupMembershipInfo[e],"true"!=f.deleted)for(var g=ydn.gdata.base.getIdFromFeedUri(f.href),f=b.gContact$groupMembershipInfo.length;f--;){var h=b.gContact$groupMembershipInfo[f];
"true"!=h.deleted&&(h=ydn.gdata.base.getIdFromFeedUri(h.href),c[g]==h&&(d+=1))}if(a.gd$name&&b.gd$name)for(e=a.gd$name,f=b.gd$name,c=["gd$familyName","gd$givenName","gd$additionalName","gd$fullName"],g=[0.1,0.1,0.05,0.2],h=0;4>h;h++)e[c[h]]&&f[c[h]]&&e[c[h]].$t==f[c[h]].$t&&(d+=g[h]);a.title&&b.title&&a.title.$t==b.title.$t&&(d+=0.2);if(a.gd$phoneNumber&&b.gd$phoneNumber)for(e=a.gd$phoneNumber.length;e--;)for(c=a.gd$phoneNumber[e],f=b.gd$phoneNumber.length;f--;)g=b.gd$phoneNumber[f],c.$t&&g.$t&&(d+=
0.7*ydn.gdata.m8.utils.phoneSimilarScore(c.$t.trim(),g.$t.trim()));return d};ydn.gdata.m8.Entry=function(a){ydn.gdata.Entry.call(this,a);a=ydn.gdata.m8.utils.parseFeedUri(this.id);ydn.asserts.assert(a,"Invalid m8 entry: "+this.id);goog.asserts.assertString(a.user_id,"Invalid id: "+this.id);this.user_id=a.user_id;ydn.asserts.assert(a.kind==this.kind,"Invalid kind: "+a.kind+" vs "+this.kind)};goog.inherits(ydn.gdata.m8.Entry,ydn.gdata.Entry);ydn.gdata.m8.Entry.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.m8.Entry");ydn.gdata.m8.Entry.prototype.gdata_version=ydn.gdata.m8.utils.gdata_version;
ydn.gdata.m8.Entry.prototype.type=ydn.gdata.Type.CONTACT;ydn.gdata.m8.Entry.prototype.getFeedUri=function(){return ydn.gdata.m8.utils.buildFeedUri(this.user_id,"full",this.kind)};ydn.gdata.m8.Entry.prototype.getType=function(){return this.type};ydn.gdata.m8.Entry.prototype.getUserId=function(){return this.user_id};ydn.gdata.m8.Entry.prototype.getLabel=function(){return this.getTitle()+" ("+this.getUserId()+")"};
ydn.gdata.m8.Entry.prototype.getSyncExtPropValue=function(){var a=this.data.gd$extendedProperty;if(goog.isArray(a))for(var b=0;b<a.length;b++){if(a[b].name===ydn.gdata.xp.Basic.TAG)return a[b].value||""}else if(goog.isDef(a)&&a.name===ydn.gdata.xp.Basic.TAG)return a.value||"";return""};ydn.gdata.m8.Entry.prototype.getSyncExtProp=function(){return ydn.gdata.xp.parse(this.getSyncExtPropValue())};
ydn.gdata.m8.Entry.prototype.removeSyncExtProp=function(){var a=!!this.data.gd$extendedProperty;delete this.data.gd$extendedProperty;return a};ydn.gdata.m8.Entry.prototype.getSyncUpdated=function(){var a=this.getSyncExtProp();return a?a.getUpdated():NaN};ydn.gdata.m8.Entry.prototype.setSyncUpdated=function(a){var b=this.getSyncExtProp();b?(b.setUpdated(a),this.setExtProp(b)):this.logger.warning("ExpProp not found to update in "+this)};
ydn.gdata.m8.Entry.isUpdated=function(a,b){a=a instanceof Date?+a:a;b=b instanceof Date?+b:b;return!isNaN(a)&&(isNaN(b)||a-b>ydn.gdata.base.CLIENT_SERVER_DISCREPANCY)};ydn.gdata.m8.Entry.prototype.isUserUpdated=function(){var a=this.getSyncUpdated(),b=this.getUpdatedDate();return ydn.gdata.m8.Entry.isUpdated(b,a)};ydn.gdata.m8.Entry.prototype.getKey=function(){return"gdata.m8-"+this.kind+":"+this.getUserId()+":"+this.getId()};ydn.gdata.m8.Feed=function(a){if(!goog.isDef(this.kind))throw new ydn.error.InvalidOperationException("Abstract class cannot be instantiated.");ydn.gdata.Feed.call(this,a);this.user_id=this.buildUserId()};goog.inherits(ydn.gdata.m8.Feed,ydn.gdata.Feed);ydn.gdata.m8.Feed.prototype.getKind=function(){return this.kind};ydn.gdata.m8.Feed.prototype.gdata_version="3.0";ydn.gdata.m8.Feed.prototype.type=ydn.gdata.Type.CONTACT;ydn.gdata.m8.Feed.prototype.getUserId=function(){return this.user_id};
ydn.gdata.m8.Feed.prototype.buildUserId=function(){return this.getId()};ydn.gdata.m8.Feed.prototype.toString=function(){return"Feed:"+this.kind+":"+this.user_id};ydn.gdata.m8.Feed.prototype.disp=function(){ydn.gdata.m8.Feed.superClass_.disp.call(this)};ydn.gdata.m8.Feed.prototype.getFeedUri=function(){return"https://www.google.com/m8/feeds/"+this.getKind()+"s/"+this.user_id.replace("@","%40")+"/full?v="+ydn.gdata.m8.utils.gdata_version};
ydn.gdata.m8.Feed.prototype.getBatchUri=function(){var a=ydn.gdata.m8.Feed.superClass_.getBatchUri.call(this);return a?a:"https://www.google.com/m8/feeds/"+this.getKind()+"s/"+this.user_id.replace("@","%40")+"/full/batch?v="+ydn.gdata.m8.utils.gdata_version};ydn.gdata.m8.Feed.batch_xml_ns_=ydn.gdata.xml.GDATA_XMLNS.concat(["gContact"]);ydn.gdata.m8.Feed.prototype.getBatchXmlNs=function(){return ydn.gdata.m8.Feed.batch_xml_ns_};ydn.gdata.m8.ContactEntry=function(a){ydn.gdata.m8.Entry.call(this,a)};goog.inherits(ydn.gdata.m8.ContactEntry,ydn.gdata.m8.Entry);ydn.gdata.m8.ContactEntry.DEBUG=!1;ydn.gdata.m8.ContactEntry.prototype.kind=ydn.gdata.Kind.M8_CONTACT;ydn.gdata.m8.ContactEntry.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.m8.ContactEntry");ydn.gdata.m8.ContactEntry.prototype.isMemberOf=function(a){return!!this.getGroupMembershipInfo(a)};
ydn.gdata.m8.ContactEntry.prototype.getGroupMembershipInfo=function(a){for(var b=this.getGroupMembershipInfos(),c=0;c<b.length;c++)if(b[c].href===a&&!b[c].deleted)return b[c];return null};ydn.gdata.m8.ContactEntry.prototype.getGroupMembershipInfos=function(){goog.isArray(this.data.gContact$groupMembershipInfo)||(goog.isDef(this.data.gContact$groupMembershipInfo)?this.data.gContact$groupMembershipInfo=[this.data.gContact$groupMembershipInfo]:this.data.gContact$groupMembershipInfo=[]);return this.data.gContact$groupMembershipInfo};
ydn.gdata.m8.ContactEntry.prototype.getKind=function(){return ydn.gdata.Kind.M8_CONTACT};ydn.gdata.m8.ContactEntry.prototype.addGroup=function(a){for(var b=this.getGroupMembershipInfos(),c=0;c<b.length;c++){var d=b[c];if(d.href===a)return d.deleted&&"true"===d.deleted?(delete d.deleted,!0):!1}b.push({href:a});return!0};
ydn.gdata.m8.ContactEntry.prototype.removeGroup=function(a){for(var b=this.getGroupMembershipInfos(),c=0;c<b.length;c++){var d=b[c];if(d.href===a){if(!d.deleted||"false"===d.deleted)return b.splice(c,1),!0;break}}return!1};ydn.gdata.m8.ContactEntry.prototype.getGroups=function(a){for(var b=[],c=this.getGroupMembershipInfos(),d=0;d<c.length;d++)(a||"false"===c[d].deleted)&&b.push(c[d].href);return b};
ydn.gdata.m8.ContactEntry.prototype.getGroupIds=function(a){var b=[];a=this.getGroups(a);for(var c=0;c<a.length;c++)b.push(a[c].match(/\w+$/)[0]);return b};ydn.gdata.m8.ContactEntry.prototype.getFullName=function(){var a=this.getData();return goog.object.getValueByKeys(a,"gd$name","gd$fullName","$t")||""};
ydn.gdata.m8.ContactEntry.prototype.getName=function(a){var b=a?"":this.getTitle();if(a||0==b.length)a=this.getData().gd$name,goog.isObject(a)&&(b=a.gd$fullName.$t||"",0==b.length&&(b=(a.gd$givenName.$t||"")+" "+(a.gd$familyName.$t||"")));return goog.string.trim(b)};ydn.gdata.m8.ContactEntry.prototype.getEmails=function(){for(var a=this.getContactEntry().gd$email,b=[],a=goog.isArray(a)?a:a?[a]:[],c=0;c<a.length;c++)b.push(a[c].address);return b};
ydn.gdata.m8.ContactEntry.prototype.getPhoneNumbers=function(){for(var a=this.getContactEntry().gd$phoneNumber,a=goog.isArray(a)?a:goog.isObject(a)?[a]:[],b=[],c=0;c<a.length;c++)a[c].$t&&!goog.string.isEmpty(a[c].$t)&&b.push(a[c].$t);return b};ydn.gdata.m8.ContactEntry.prototype.getLabel=function(){return this.getName()+" ("+this.getUserId()+")"};
ydn.gdata.m8.ContactEntry.prototype.getDataForXml=function(){var a=ydn.gdata.m8.ContactEntry.superClass_.getDataForXml.call(this);if(a.ydn$emails||a.ydn$xp||a.ydn$externalIds)a==this.data&&(a=ydn.object.clone(this.data)),delete a.ydn$emails,delete a.ydn$xp,delete a.ydn$externalIds;return a};
ydn.gdata.m8.ContactEntry.prototype.setSyncParent=function(a,b,c,d){var e=this.getSyncExtProp();e||(e=new ydn.gdata.xp.Basic);e.setUpdated(d);for(d=0;d<e.count();d++){var f=e.getProp(d);if(f instanceof ydn.gdata.ContactShare&&f.group_id===a)return f.setSyncParent(b,c),this.setExtProp(e),!0}return!1};
ydn.gdata.m8.ContactEntry.prototype.addSource=function(a,b,c){goog.asserts.assertString(a);var d=ydn.gdata.m8.utils.parseFeedUri(a);d&&(goog.asserts.assertString(d.id),a=d.id);d=ydn.gdata.m8.utils.parseFeedUri(b);goog.asserts.assertObject(d,"Invalid origin_group_id: "+b);(b=this.getSyncExtProp())||(b=new ydn.gdata.xp.Basic);a=new ydn.gdata.xp.contact.Source([a,d.id,d.user_id]);b.add(a);this.setExtProp(b,c);return a};
ydn.gdata.m8.ContactEntry.prototype.getContactShare=function(a){var b=this.getSyncExtProp();if(b)for(var c=0;c<b.count();c++){var d=b.getProp(c);if(d instanceof ydn.gdata.ContactShare&&d.group_id===a)return d}return null};
ydn.gdata.m8.ContactEntry.prototype.addMirrorByEntryId=function(a,b,c){b=ydn.gdata.m8.utils.parseFeedUri(b);goog.asserts.assertObject(b);goog.asserts.assertString(b.id);goog.asserts.assertString(b.user_id);c=ydn.gdata.m8.utils.parseFeedUri(c);goog.asserts.assertObject(c);goog.asserts.assertString(c.id);goog.asserts.assertString(c.user_id);return this.addMirror(a,b.id,b.user_id,c.id,c.user_id)};
ydn.gdata.m8.ContactEntry.prototype.addMirror=function(a,b,c,d,e){goog.asserts.assertString(a);goog.asserts.assertString(b);goog.asserts.assertString(c);goog.asserts.assertString(d);goog.asserts.assertString(e);var f=this.getSyncExtProp();f||(f=new ydn.gdata.xp.Basic);a=new ydn.gdata.xp.contact.Mirror([a,b,c,null,null,d,e]);f.add(a);this.setExtProp(f);return a};ydn.gdata.m8.ContactEntry.prototype.array_fields="link category gd$email gd$im gd$organization gd$phoneNumber gd$structuredPostalAddress gd$formattedAddress".split(" ");
ydn.gdata.m8.ContactEntry.ensure_single_primary=function(a){if(a&&!(2>a.length))for(var b=!1,c=0;c<a.length;c++){var d=a[c];d.getAttribute("primary")&&(b?d.removeAttribute("primary"):b=!0)}};
ydn.gdata.m8.ContactEntry.prototype.mergeEmail=function(a){for(var b=[ydn.object.clone(this.data.gd$email[0])],c=!!this.data.gd$email[0].primary,d=function(a,d){a=ydn.object.clone(a);c&&delete a.primary;goog.isDef(d)&&(a.rel=d);b.push(a)},e=function(a){var c=goog.array.find(b,function(b){return b.address===a.address});c?c.rel=goog.isDef(a.rel)?a.rel:c.rel:d(a)},f=1;f<this.data.gd$email.length;f++)e(this.data.gd$email[f]);for(f=0;f<a.length;f++)e(a[f]);a=ydn.object.equals(b,this.data.gd$email);a||
(this.data.gd$email=b);return!a};
ydn.gdata.m8.ContactEntry.prototype.mergePhoneNumber=function(a){for(var b=[ydn.object.clone(this.data.gd$phoneNumber[0])],c=!!this.data.gd$phoneNumber[0].primary,d=function(a,d){a=ydn.object.clone(a);c&&delete a.primary;goog.isDef(d)&&(a.rel=d);b.push(a)},e=function(a){var c=goog.array.map(b,function(b){return ydn.gdata.m8.utils.phoneSimilarScore(b.$t,a.$t)}),e=ydn.utils.max(c);if(0.4<e.value){var c=b[e.index],f=goog.isDef(a.rel)?a.rel:c.rel;1==e.value?(c.rel=f,c.$t=a.$t):goog.isDef(a.rel)&&goog.isDef(c.rel)&&
c.rel!==a.rel?d(a,f):(c.rel=f,e=ydn.gdata.m8.utils.isSubsetOf(c,a),-1==e?c.$t=a.$t:0==e&&(c.$t=a.$t))}else d(a)},f=1;f<this.data.gd$phoneNumber.length;f++)e(this.data.gd$phoneNumber[f]);for(f=0;f<a.length;f++)e(a[f]);a=ydn.object.equals(b,this.data.gd$phoneNumber);a||(this.data.gd$phoneNumber=b);return!a};
ydn.gdata.m8.ContactEntry.prototype.mergeField=function(a,b){if("gd$phoneNumber"==a){goog.asserts.assertArray(b);if(goog.isDefAndNotNull(this.data.gd$phoneNumber))return goog.asserts.assertArray(this.data.gd$phoneNumber),this.mergePhoneNumber(b);this.data.gd$phoneNumber=ydn.object.clone(b);return!0}if("gd$email"==a){goog.asserts.assertArray(b);if(goog.isDefAndNotNull(this.data.gd$email))return goog.asserts.assertArray(this.data.gd$email),this.mergeEmail(b);this.data.gd$email=ydn.object.clone(b);return!0}return ydn.gdata.m8.ContactEntry.superClass_.mergeField.call(this,
a,b)};ydn.gdata.m8.ContactEntry.prototype.getContactShareByOriginGroup=function(a){var b=this.getSyncExtProp();a=ydn.gdata.m8.utils.parseFeedUri(a);goog.asserts.assertString(a.id,"has id");if(b)for(var c=0;c<b.count();c++){var d=b.getProp(c);if(d instanceof ydn.gdata.ContactShare&&d.origin_group_id===a.id&&d.origin_group_user_id==a.user_id)return d}return null};
ydn.gdata.m8.ContactEntry.prototype.removeContactShare=function(a){var b=this.getSyncExtProp();if(b)for(var c=0;c<b.count();c++){var d=b.getProp(c);if(d instanceof ydn.gdata.ContactShare&&d.group_id===a)return b.remove(c),!0}return!1};ydn.gdata.m8.ContactEntry.prototype.getContactEntry=function(){return this.data};
ydn.gdata.m8.ContactEntry.prototype.scoreSimilarity=function(a){for(var b=0,c=this.getEmails(),d=a.getEmails(),e=0;e<c.length;e++)for(var f=c[e],g=0;g<d.length;g++){var h=d[g];f&&f==h&&(b+=1)}c=0;f=this.data.gd$name;g=a.data.gd$name;if(f&&g)for(h=["gd$familyName","gd$givenName","gd$additionalName","gd$fullName"],d=[0.06,0.06,0.06,0.12],e=0;4>e;e++){var k=f[h[e]],l=g[h[e]];k&&l==k&&(c+=d[e])}e=0;d=this.getTitle();f=a.getTitle();d&&d==f&&(e+=0.2);k=0;f=this.getPhoneNumbers();g=a.getPhoneNumbers();h=
f.length;for(d=[];h--;){k=f[h];l=g.length;for(d[h]=0;l--;){var m=g[l];k.$t&&m.$t&&(m=0.7*ydn.gdata.m8.utils.phoneSimilarScore(k,m),d[h]=Math.max(d[h],m))}k=ydn.utils.max(d).value}d=b+c+e+k;ydn.gdata.m8.ContactEntry.DEBUG&&window.console.log(this.getKey()+" vs. "+a.getKey()+" = "+d+" ("+b+","+c+","+e+","+k+")");return d};
ydn.gdata.m8.ContactEntry.prototype.getExternalId=function(a,b,c,d){for(var e=this.getData(),e=goog.isArray(e.gContact$externalId)?e.gContact$externalId:e.gContact$externalId?[e.gContact$externalId]:[],f=0;f<e.length;f++)if(e[f].value){var g=e[f].value.match(/(\w+):\/\/([^\/]+)\/([^\/]+)\/(.*)/);if(g){var h=g[1],k=g[2],l=g[3],g=g[4];if(!(a&&a!=h||b&&b!=k||d&&d!=g||c&&c!=l))return{domain:k,module:l,id:g,scheme:h}}}return null};
ydn.gdata.m8.ContactEntry.prototype.listExternalId=function(a,b,c,d){for(var e=this.getData(),e=goog.isArray(e.gContact$externalId)?e.gContact$externalId:e.gContact$externalId?[e.gContact$externalId]:[],f=[],g=0;g<e.length;g++)if(e[g].value){var h=e[g].value.match(/(\w+):\/\/([^\/]+)\/([^\/]+)\/(.*)/);if(h){var k=h[1],l=h[2],m=h[3],h=h[4];a&&a!=k||b&&b!=l||d&&!goog.string.startsWith(h,d)||c&&c!=m||f.push({domain:l,module:m,id:h,scheme:k})}}return f};
ydn.gdata.m8.ContactEntry.prototype.toElement=function(a){return ydn.gdata.m8.ContactEntry.superClass_.toElement.call(this,a)};ydn.gdata.m8.ContactFeed=function(a){ydn.gdata.m8.Feed.call(this,a);this.cache={}};goog.inherits(ydn.gdata.m8.ContactFeed,ydn.gdata.m8.Feed);ydn.gdata.m8.ContactFeed.prototype.logger=goog.debug.Logger.getLogger("ydn.gdata.m8.ContactFeed");ydn.gdata.m8.ContactFeed.prototype.kind=ydn.gdata.Kind.M8_CONTACT;ydn.gdata.m8.ContactFeed.prototype.invalidate=function(){this.cache={};ydn.gdata.m8.ContactFeed.superClass_.invalidate.call(this)};
ydn.gdata.m8.ContactFeed.prototype.getEntry=function(a){return ydn.gdata.m8.ContactFeed.superClass_.getEntry.call(this,a)};ydn.gdata.m8.ContactFeed.prototype.buildEntry=function(a){return new ydn.gdata.m8.ContactEntry(a)};
ydn.gdata.m8.ContactFeed.prototype.cloneOriginEntry=function(a,b){if(a.getUserId()==this.getUserId())throw Error("Cannot clone to itself.");var c=this.findMirror(a.getUserId(),a.getId(),b);if(c)throw Error("Already mirrored "+a+" for group "+b+") as "+c+" in "+this);var c=ydn.object.clone(a.getData()),d=ydn.gdata.m8.utils.buildFeedUri(this.getUserId(),"base",a.getKind(),a.getSingleId()+"-clone");c.gd$batch={$t:d};delete c.id;this.addEntry(c);return this.getEntry(d)};
ydn.gdata.m8.ContactFeed.prototype.findMirror=function(a,b,c,d){for(var e=null,f,g=0;f=this.getEntryAt(g);g++){var h=f.getSyncExtProp();if(h)for(var k=0;k<h.count();k++)if(h[k]instanceof ydn.gdata.xp.contact.Mirror){var l=h[k];if(l.origin_user_id==a&&l.origin_entry_id==b&&c==l.group_id){if(f.notDeleted())return f;e=f}}}return d&&!goog.isNull(e)?e:null};
ydn.gdata.m8.ContactFeed.prototype.scoreEntry=function(a){for(var b={},c,d=0;c=this.getEntryAt(d);d++)a.notDeleted()&&(b[c.getId()]=c.scoreSimilarity(a));return b};ydn.gdata.m8.ContactFeed.prototype.getEntryAt=function(a){return ydn.gdata.m8.ContactFeed.superClass_.getEntryAt.call(this,a)};
ydn.gdata.m8.ContactFeed.prototype.contactsInGroup=function(a,b){if(this.cache.contactsInGroup&&this.cache.contactsInGroup[a])return this.cache.contactsInGroup[a];for(var c=[],d,e=0;d=this.getEntryAt(e);e++)(!b||d.notDeleted())&&d.isMemberOf(a)&&c.push(d.getId());this.cache.contactsInGroup=this.cache.contactsInGroup||{};return this.cache.contactsInGroup[a]=c};
ydn.gdata.m8.ContactFeed.prototype.listNamesAndEmails=function(){if(this.cache.listNamesAndEmails)return this.cache.listNamesAndEmails;for(var a={},b={},c=[],d=[],e=[],f,g=0;f=this.getEntryAt(g);g++)if(f.notDeleted()){var h=f.getId(),k=f.getName();c.push(h);d.push(k);f=f.getEmails();for(var l=0;l<f.length;l++){var m=f[l];a[m]=k;b[m]=h;-1==e.indexOf(m)&&e.push(m)}}this.cache.listNamesAndEmails={names:a,emails:e,ids:b};this.cache.idListNameList={ids:c,names:d};return this.cache.listNamesAndEmails};
ydn.gdata.m8.ContactFeed.prototype.getContactLabels=function(){var a=this.listNamesAndEmails();if(!a)return[];for(var b=[],c=0;a.emails&&c<a.emails.length;c++){var d=a.emails[c],e=a.names[d];b.push(goog.isDef(e)?e+" <"+d+">":d)}return b};
ydn.gdata.m8.ContactFeed.prototype.getContactLabelsAndEmails=function(){if(this.cache.getContactLabelsAndEmails)return this.cache.getContactLabelsAndEmails;var a=this.listNamesAndEmails(),b={labels:[],emails:[]};if(!a)return b;for(var c=0;a.emails&&c<a.emails.length;c++){var d=a.emails[c],e=a.names[d];b.labels.push(goog.isDef(e)?e+" <"+d+">":d);b.emails.push(d)}return this.cache.getContactLabelsAndEmails=b};
ydn.gdata.m8.ContactFeed.prototype.getContactIdsAndNames=function(){this.listNamesAndEmails();return this.cache.idListNameList};ydn.gdata.m8.ContactFeed.prototype.listContact=function(){for(var a=this.listNamesAndEmails(),b=[],c={},d=0;d<a.emails.length;d++){var e=a.emails[d];if(!c[a.ids[e]]){var f=a.names[e];b.push(goog.isDef(f)?f+" <"+e+">":e)}}return b};
ydn.gdata.m8.ContactFeed.prototype.getContactListInGroups=function(){if(this.cache.getContactListInGroups)return this.cache.getContactListInGroups;for(var a={},b,c=0;b=this.getEntryAt(c);c++)if(b.notDeleted()){var d=b.getId();b=b.getGroups();for(var e=0;e<b.length;e++)a[d]?a[d].push(b[e]):a[d]=[b[e]]}return this.cache.getContactListInGroups};
ydn.gdata.m8.ContactFeed.prototype.countInGroup=function(a){for(var b=0,c,d=0;c=this.getEntryAt(d);d++)if(c.notDeleted()){c=c.getGroups();for(var e=0;e<c.length;e++)c[e]==a&&b++}return b};ydn.gdata.m8.ContactFeed.prototype.getFeedUri=function(){return"https://www.google.com/m8/feeds/contacts/"+this.getId()+"/full"};ydn.gdata.m8.ContactFeed.prototype.getKey=function(){return"http://www.google.com/m8/feeds/contacts/"+this.getId().replace("@","%40")};
ydn.gdata.m8.ContactFeed.prototype.getParentKeyRange=function(){return ydn.db.KeyRange.starts("http://www.google.com/m8/feeds/contacts/"+this.getId().replace("@","%40")+"/base/")};ydn.gdata.site={};ydn.gdata.site.utils={};ydn.gdata.site.PageType={ANNOUNCEMENT:"announcement",ANNOUNCEMENTS_PAGE:"announcementspage",ATTACHMENT:"attachment",COMMENT:"comment",FILE_CABINET_PAGE:"filecabinet",LIST_ITEM:"listitem",LIST_PAGE:"listpage",WEB_ATTACHMENT:"webattachment",TEMPLATE:"template",WEB_PAGE:"webpage"};
ydn.gdata.site.PageTypes=[ydn.gdata.site.PageType.ANNOUNCEMENT,ydn.gdata.site.PageType.ANNOUNCEMENTS_PAGE,ydn.gdata.site.PageType.ATTACHMENT,ydn.gdata.site.PageType.ANNOUNCEMENT,ydn.gdata.site.PageType.COMMENT,ydn.gdata.site.PageType.FILE_CABINET_PAGE,ydn.gdata.site.PageType.LIST_ITEM,ydn.gdata.site.PageType.LIST_PAGE,ydn.gdata.site.PageType.WEB_ATTACHMENT,ydn.gdata.site.PageType.TEMPLATE,ydn.gdata.site.PageType.WEB_PAGE];
ydn.gdata.site.utils.getKind=function(a){if(a&&"category"in a){a=goog.isArray(a.category)?a.category:[a.category];for(var b=0;b<a.length;b++)if("http://schemas.google.com/g/2005#kind"==a[b].scheme){a=a[b].term.match(/\w+$/)[0];if(goog.DEBUG&&!goog.array.contains(ydn.gdata.site.PageTypes,a))throw new ydn.error.ArgumentException(a);return a}}};
ydn.gdata.site.utils.buildFeedUri=function(a,b,c,d){var e="";goog.isDef(c)?(goog.asserts.assert(goog.array.contains(["site","content","activity","revision","webpage"],c)),e="/"+c):e="/site";c=goog.isDef(d)?"/"+d:"";return"https://sites.google.com/feeds"+e+"/"+a+"/"+b+c};ydn.gdata.site.utils.buildPageUrl=function(a,b,c){c=c||"";var d="/"==c.charAt(0)?"":"/";return"https://sites.google.com/a/"+a+"/"+b+d+c};
ydn.gdata.site.utils.simplify=function(a){a=a.toLowerCase().replace(/\W/g,"-");return a=a.replace(/--/g,"-")};ydn.gdata.site.utils.parseFeedUri=function(a){if(a=a.match(/https?:\/\/sites.google.com\/feeds\/(content|revision|acl\/site|site)\/([^\/]+)\/?([^\/]*)\/?(.*)?/)){var b=void 0,c=a[4];"batch"==a[4]&&(b="batch",c=void 0);return{gdata_type:ydn.gdata.Type.SITE,kind:ydn.gdata.base.toKind(a[1]),domain_name:a[2],site_name:a[3],projection:b,id:c}}return null};
ydn.gdata.site.utils.parseUrl=function(a){if("string"!=typeof a)return null;var b=a.length;a=a.replace(/_\/rsrc\/\d+\//g,"");var c=a.match(/https:\/\/sites.google.com\/a\/([^\/]+)\/([^\/]+)(\/?[^(?|#)]*)/);if(!c||3>c.length)return null;var d=c[3].split("/");return{domain:c[1],site_url:"https://sites.google.com/a/"+c[1]+"/"+c[2],site_name:c[2],page_name:0<d.length?d[d.length-1]:"",path:c[3],url:c[0],is_temp_path:b!==a.length}};ydn.gdata.utils={};ydn.gdata.utils.parseFeedUri=function(a){if(goog.isString(a)){var b=ydn.gdata.base.feedUri2Type(a);return b==ydn.gdata.Type.CONTACT?ydn.gdata.m8.utils.parseFeedUri(a):b==ydn.gdata.Type.SITE?ydn.gdata.site.utils.parseFeedUri(a):null}return null};
ydn.gdata.utils.getNameFromEntry=function(a){var b="";a.title&&goog.isString(a.title.$t)&&0<a.title.$t.length&&(b=a.title.$t);0==b.length&&goog.isDefAndNotNull(a.gd$name)&&(a=a.gd$name,goog.isDefAndNotNull(a.gd$fullName)&&0<a.gd$fullName.$t.length&&(b=a.gd$fullName.$t),0==b.length&&goog.isDefAndNotNull(a.gd$givenName)&&goog.isDefAndNotNull(a.gd$familyName)&&(b=a.gd$givenName.$t+" "+a.gd$familyName.$t));return goog.string.trim(b)};
ydn.gdata.utils.isNestedObject=function(a){if(!goog.isObject(a))return!1;for(var b in a)if(a.hasOwnProperty(b))return goog.isObject(a[b]);return!1};ydn.gdata.utils.FeedUriPart=function(a,b,c){this.email=a;this.id=b;this.type=c};
ydn.gdata.utils.xml2json=function(a){var b=function(a){goog.string.startsWith(a,"atom:")&&(a=a.substring(5,a.length));return a.replace("#text","$t").replace(/:/g,"$")};goog.isString(a)&&(a=goog.dom.xml.loadXml(a));var c={};if(1==a.nodeType){if(0<a.attributes.length)for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c[b(e.nodeName)]=e.nodeValue}}else 3==a.nodeType&&(c=a.nodeValue);if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++){var e=a.childNodes.item(d),f=b(e.nodeName);if("undefined"==
typeof c[f])"content"==f?(c[f]={$t:goog.dom.xml.serialize(e)},e.namespaceURI&&(c[f].xmlns=e.namespaceURI)):c[f]=ydn.gdata.utils.xml2json(e);else{if("undefined"==typeof c[f].length){var g=c[f];c[f]=[];c[f].push(g)}c[f].push(ydn.gdata.utils.xml2json(e))}}return c};
ydn.gdata.utils.compareUpdated=function(a,b){if(!(a&&goog.isDef(a.updated)&&b&&goog.isDef(b.updated)))return 0;try{return Date.parse(a.updated.$t)>Date.parse(b.updated.$t)?1:-1}catch(c){goog.DEBUG&&window.console.error("Parsing date fail: "+a.updated.$t+" "+b.updated.$t)}return 0};ydn.gdata.COMPRESS_MARKER="!";ydn.gdata.utils.compressString=function(a){if(a.charAt(0)==ydn.gdata.COMPRESS_MARKER)return a;a=a.length;for(var b=0;b<a;b++);return""};ydn.gdata.utils.unCompressString=function(a){return a};
ydn.gdata.XMLNS="atom app gd gContact xhtml batch openSearch".split(" ");ydn.gdata.utils.buildFeedXml=function(a,b,c){goog.isDef(c)||(c=ydn.gdata.XMLNS);for(var d="",e=0;e<c.length;e++)var f=c[e],d=0==e?d+(' xmlns="'+ydn.xml.namespaces[f]+'" '):d+(" xmlns:"+f+'="'+ydn.xml.namespaces[f]+'" ');b=b||"";a=goog.isDef(a)?"<id>"+a+"</id>":"";return"<feed"+d+">"+a+b+"</feed>"};ydn.ds={};ydn.ds.gdata={};ydn.ds.gdata.GData=function(a,b){this.storage=a;this.id=b.id?b.id.replace("@","%40"):b.id;this.client=this.fetch_df_=null;this.th_updator_=new goog.async.Throttle(function(){this.fetch().addCallbacks(function(a){this.logger.finer(this+" updated, "+a+" new entries.")},function(a){this.logger.warning(this+" update failed.")},this)},6E4,this);this.db_=null};ydn.ds.gdata.GData.prototype.logger=goog.debug.Logger.getLogger("ydn.ds.gdata.GData");ydn.ds.gdata.GData.DEBUG=!1;
ydn.ds.gdata.GData.prototype.getClient=function(){return this.client?this.client:ydn.client.getClient(ydn.http.Scopes.GSE)};ydn.ds.gdata.GData.prototype.update=function(){this.th_updator_.fire()};ydn.ds.gdata.GData.prototype.setClient=function(a){this.client=a};ydn.ds.gdata.GData.prototype.getStorage=function(){return this.db_?this.db_:ydn.crm.data.db};
ydn.ds.gdata.GData.prototype.fetch_=function(a){goog.asserts.assertInstanceof(a,ydn.client.HttpRequestData);a=this.getClient().request(a);var b=new goog.async.Deferred;a.execute(function(a,d){if(a){var e=a.feed;goog.asserts.assert(e,"invalid respond "+ydn.json.toShortString(a));if(e.entry){var f=this.getStorage().put(this.getStoreName(),e.entry).addCallback(function(a){return a.length}),g=(new ydn.gdata.m8.ContactFeed(e)).getLink(ydn.atom.Link.Rel.NEXT);g?(f=new ydn.client.HttpRequestData(g.href),
this.fetch_(f).addCallback(function(a){b.callback(this+a)},e.entry.length)):f.chainDeferred(b)}else b.callback(0)}else this.logger.warning("fetching fail "+(d?d.getStatus()+" "+d.getStatusText():"")),b.errback(d)},this);return b};ydn.ds.gdata.GData.prototype.getParams=function(){return{alt:"json"}};
ydn.ds.gdata.GData.prototype.serverGet=function(a){a=this.getBaseUri()+"/full/"+a;var b=this.getParams();a=new ydn.client.HttpRequestData(a,"GET",b);a=this.getClient().request(a);var c=new goog.async.Deferred;a.execute(function(a,b){a?c.callback(a):c.errback(b)});return c};ydn.ds.gdata.GData.prototype.get=function(a){return goog.isString(a)&&0!=a.length?this.getStorage().get(this.getStoreName(),a):goog.async.Deferred.fail("invalid key")};
ydn.ds.gdata.GData.prototype.put=function(a){return this.getStorage().put(this.getStoreName(),a)};ydn.ds.gdata.GData.ExternalIdRel={ACCOUNT:"account",CUSTOMER:"customer",NETWORK:"network",ORGANIZATION:"organization"};
ydn.ds.gdata.GData.prototype.patchExternalId=function(a,b,c){return this.getStorage().get(this.getStoreName(),a).addCallback(function(d){if(d){d.gContact$externalId=goog.isArray(d.gContact$externalId)?d.gContact$externalId:d.gContact$externalId?[d.gContact$externalId]:[];for(var e=new ydn.gdata.m8.ContactEntry(d),f=!1,g=0;g<d.gContact$externalId.length;g++)if(d.gContact$externalId[g].value==c){d.gContact$externalId[g].label=b;f=!0;break}f||d.gContact$externalId.push({label:b,value:c});e.setEntryStatus(ydn.gdata.Entry.STATUS.MODIFIED);
return e.commit().addCallback(function(a){var b=ydn.gdata.utils.xml2json(a);ydn.ds.gdata.GData.DEBUG&&window.console.log(a,b);a=b.entry;if(!a||!a.id)throw Error("Invalid respond on saving gdata "+ydn.json.toShortString(b));this.getStorage().put(this.getStoreName(),a);return a},this)}throw Error("gdata entry "+a+" not found");},this)};ydn.ds.gdata.GData.prototype.buildEntry=function(a){return new ydn.gdata.Entry(a)};
ydn.ds.gdata.GData.prototype.newEntry=function(a){return this.buildEntry(a).commit().addCallback(function(a){var c=ydn.gdata.utils.xml2json(a);ydn.ds.gdata.GData.DEBUG&&window.console.log(a,c);a=c.entry;if(!a||!a.id)throw Error("Invalid respond on saving gdata "+ydn.json.toShortString(c));this.getStorage().put(this.getStoreName(),a);return a},this)};
ydn.ds.gdata.GData.prototype.fetch=function(){if(!this.getStorage().getName())return goog.async.Deferred.fail(Error("database not ready"));if(!this.fetch_df_){var a=new ydn.db.IndexIterator(this.getStoreName(),"updated.$t",null,!0);this.fetch_df_=new goog.async.Deferred;this.getStorage().keys(a,1).addCallback(function(a){var c=this.getParams();c.orderby="lastmodified";a[0]?(c.sortorder="descending",a=(new Date(1+ +new Date(a[0]))).toISOString(),c["updated-min"]=a):c.sortorder="ascending";a=this.getBaseUri()+
"/full";c=new ydn.client.HttpRequestData(a,"GET",c);this.fetch_(c).addCallbacks(function(a){this.fetch_df_.callback(a);this.fetch_df_=null},function(a){this.fetch_df_.callback(a);this.fetch_df_=null},this)},this)}return this.fetch_df_};ydn.ds.gdata.GData.prototype.toString=function(){return this.getKind()};ydn.ds.gdata.Contact=function(a,b){ydn.ds.gdata.GData.call(this,a,b)};goog.inherits(ydn.ds.gdata.Contact,ydn.ds.gdata.GData);ydn.ds.gdata.Contact.prototype.getStoreName=function(){return"gdata-contact"};ydn.ds.gdata.Contact.prototype.getParams=function(){var a=ydn.ds.gdata.Contact.superClass_.getParams.call(this);a.v="3.0";return a};ydn.ds.gdata.Contact.prototype.getBaseUri=function(){return"https://www.google.com/m8/feeds/contacts/"+this.id};ydn.ds.gdata.Contact.prototype.getKind=function(){return ydn.gdata.Kind.M8_CONTACT};
ydn.ds.gdata.Contact.prototype.buildEntry=function(a){var b=!!a.id;b||(a.id=ydn.atom.Entry.asText(this.getBaseUri()+"/base/0"));var c=new ydn.gdata.m8.ContactEntry(a);b||delete a.id;return c};ydn.ds.gdata.Contact.prototype.getContactsByEmail=function(a){return a&&0!=a.length?this.getStorage().values(this.getStoreName(),"ydn$emails",ydn.db.KeyRange.only(a),100,0,!1,!0):goog.async.Deferred.succeed([])};ydn.gmail={};ydn.gmail.Utils=function(){};ydn.gmail.Utils.getUserEmail=function(){var a=new ydn.client.HttpRequestData("https://mail.google.com/mail/feed/atom/bazinga","GET",{zx:"124"}),a=ydn.client.getClient(ydn.http.Scopes.DEFAULT).request(a),b=new goog.async.Deferred;window.setTimeout(function(){b.hasFired()||(b.errback(),b=null)},2E3);a.execute(function(a,d){if(b)if(d.isSuccess()){var e=d.getBody().match(/<title>(.+?)(\S+)<\/title>/);e?b.callback(e[2]):b.errback()}else b.errback()});return b};ydn.logo={};ydn.logo.Yathit=function(a){this.size=a;this.default_fill="black";this.layer=new Kinetic.Layer};ydn.logo.Yathit.prototype.clear=function(){this.layer=new Kinetic.Layer};
ydn.logo.Yathit.prototype.drawLogo=function(a){var b=["#FCCA03","#0140CA","#16A61E","#DD1812"];2===a?b=["#FAFAFA","#D8D8D8","#C2C2C2","#D8D8D8"]:1===a&&(b=["#C2C2C2","#525252","#3D3D3D","#6B6B6B"]);a=["m252,324c0,-59.647 48.354,-108 108,-108c26.90799,0 51.51501,9.843 70.42401,26.121c1.03198,-8.564 1.57599,-17.27901 1.57599,-26.121c0,-119.126 -96.43701,-215.722 -215.49899,-215.994c40.89099,0.137 73.99899,33.321 73.99899,74.244c0,41.007 -33.24301,74.25 -74.25,74.25c-41.008,0 -74.25,-33.243 -74.25,-74.25c0,-40.979 33.19701,-74.203 74.16701,-74.248c-0.05602,0 -0.11201,-0.002 -0.16701,-0.002c-119.294,0 -216,96.707 -216,216c0,8.843 0.544,17.55701 1.577,26.121c18.908,-16.278 43.515,-26.121 70.423,-26.121c59.646,0 108,48.353 108,108c0,37.93399 -19.561,71.29401 -49.14301,90.56c26.127,11.21701 54.90701,17.44 85.14301,17.44s59.01599,-6.22299 85.14301,-17.44c-29.582,-19.26599 -49.14301,-52.62601 -49.14301,-90.56z","m142,74.25c0,41.007 33.242,74.25 74.25,74.25c41.00699,0 74.25,-33.243 74.25,-74.25c0,-40.923 -33.108,-74.107 -73.99899,-74.244c-0.112,0 -0.22301,-0.004 -0.334,-0.004c-40.97,0.045 -74.16701,33.269 -74.16701,74.248z",
"m180,324c0,-59.647 -48.354,-108 -108,-108c-26.908,0 -51.515,9.843 -70.424,26.121c9.366,77.69 59.967,142.67798 129.28099,172.43799c29.582,-19.26498 49.14301,-52.625 49.14301,-90.55899z","m430.42401,242.121c-18.909,-16.278 -43.51602,-26.121 -70.42401,-26.121c-59.646,0 -108,48.353 -108,108c0,37.93399 19.561,71.29401 49.142,90.56c69.315,-29.76199 119.91602,-94.74899 129.28201,-172.439z"];for(var c=new Kinetic.Group({scale:this.size/435}),d=0;d<a.length;d++){var e=new Kinetic.Path({data:a[d],fill:b[d]});
c.add(e)}this.layer.add(c);return c};
ydn.logo.Yathit.prototype.drawBell=function(a){a=new Kinetic.Path({data:"M24.264,20.958C21.78,16.732,22.096,7.758999999999999,18.121,5.471999999999998C18.375,5.076999999999998,18.525,4.610999999999998,18.525,4.105999999999998C18.525,2.709999999999998,17.395999999999997,1.5799999999999983,15.998999999999999,1.5799999999999983C14.602999999999998,1.5799999999999983,13.471999999999998,2.7109999999999985,13.471999999999998,4.105999999999998C13.471999999999998,4.610999999999998,13.622999999999998,5.078999999999998,13.877999999999998,5.472999999999998C9.905,7.76,10.221,16.732,7.736,20.958C5.585,21.523,4.25,22.311,4.25,23.18V24.305C4.25,25.909,8.126999999999999,27.243,13.327,27.588C13.324,27.636,13.312,27.684,13.312,27.733C13.312,29.216,14.514999999999999,30.421,16,30.421C17.484,30.421,18.688,29.218,18.688,27.733C18.688,27.684,18.676,27.636,18.673,27.588C23.872,27.239,27.75,25.900000000000002,27.75,24.305V23.18C27.75,22.311,26.415,21.523,24.264,20.958ZM14.472,4.105C14.474,3.2620000000000005,15.157,2.5800000000000005,15.998999999999999,2.5780000000000003C16.842,2.58,17.525,3.2630000000000003,17.526999999999997,4.105C17.525,4.477,17.383,4.813000000000001,17.165999999999997,5.079000000000001C16.806999999999995,4.9830000000000005,16.420999999999996,4.929,15.999999999999996,4.929S15.192999999999996,4.984,14.832999999999997,5.079000000000001C14.612,4.814,14.473,4.478,14.472,4.105Z",fill:a||
"#FF8000",scale:this.size/32,x:0.3125,y:0.3125});this.layer.add(a);return a};
ydn.logo.Yathit.prototype.drawKey=function(a){a=new Kinetic.Path({data:"M18.386,16.009L18.395,16.003L17.815,15.091C19.469,12.864999999999998,19.691000000000003,9.771999999999998,18.115000000000002,7.2909999999999995C16.072000000000003,4.077999999999999,11.812000000000001,3.13,8.599000000000002,5.173C5.387000000000002,7.215,4.436000000000002,11.475,6.479000000000002,14.69C8.007000000000001,17.092,10.779000000000002,18.227,13.423000000000002,17.791999999999998L13.847000000000001,18.461L14.053,18.506L14.832,18.059L14.527000000000001,19.436L17.01,19.988L16.714000000000002,21.313L18.617,21.737L17.937,24.796999999999997L19.343,25.109999999999996L18.919,27.015999999999995L23.054000000000002,27.933999999999994L23.812,24.541999999999994L18.386,16.009ZM10.996,8.944C10.311,9.38,9.403,9.177000000000001,8.967,8.492C8.532,7.807,8.733,6.898,9.418,6.463S11.011999999999999,6.23,11.446,6.915C11.883,7.6,11.68,8.509,10.996,8.944Z",fill:a||
"#FF8000",scale:this.size/32,x:0.3125,y:0.3125});this.layer.add(a);return a};ydn.logo.Yathit.prototype.render=function(a){(new Kinetic.Stage({container:a,width:this.size,height:this.size})).add(this.layer)};ydn.logo.Logo=function(){this.state_=ydn.logo.Logo.State.LOGOFF;this.yathit=new ydn.logo.Yathit(19);chrome.runtime.onSuspend.addListener(function(a){chrome.browserAction.setTitle({title:"suspended"});this.setState(ydn.logo.Logo.State.LOGOFF)}.bind(this))};ydn.logo.Logo.State={LOGOFF:"lo",LOGIN:"li"};
ydn.logo.Logo.prototype.setState=function(a){goog.Timer.callOnce(function(){this.yathit.clear();this.state=a;this.yathit.drawLogo(a==ydn.logo.Logo.State.LOGOFF?1:0);var b=document.getElementById("canvas-19");this.yathit.render(b);this.canvas_19=b.querySelector("canvas");b=this.canvas_19.getContext("2d");chrome.browserAction.setIcon({imageData:b.getImageData(0,0,this.canvas_19.width,this.canvas_19.height)})},1,this)};goog.crypt.BlockCipher=function(){};goog.crypt.Aes=function(a){goog.crypt.Aes.assertKeyArray_(a);this.key_=a;this.keyLength_=this.key_.length/4;this.numberOfRounds_=this.keyLength_+6;this.state_=[[],[],[],[]];this.temp_=[[],[],[],[]];this.keyExpansion_()};goog.crypt.Aes.ENABLE_TEST_MODE=!1;
goog.crypt.Aes.prototype.encrypt=function(a){goog.crypt.Aes.ENABLE_TEST_MODE&&this.testKeySchedule_(0,this.keySchedule_,0);this.copyInput_(a);this.addRoundKey_(0);for(a=1;a<this.numberOfRounds_;++a)goog.crypt.Aes.ENABLE_TEST_MODE&&(this.testKeySchedule_(a,this.keySchedule_,a),this.testStartRound_(a,this.state_)),this.subBytes_(goog.crypt.Aes.SBOX_),goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterSubBytes_(a,this.state_),this.shiftRows_(),goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterShiftRows_(a,
this.state_),this.mixColumns_(),goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterMixColumns_(a,this.state_),this.addRoundKey_(a);this.subBytes_(goog.crypt.Aes.SBOX_);goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterSubBytes_(a,this.state_);this.shiftRows_();goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterShiftRows_(a,this.state_);this.addRoundKey_(this.numberOfRounds_);return this.generateOutput_()};
goog.crypt.Aes.prototype.decrypt=function(a){goog.crypt.Aes.ENABLE_TEST_MODE&&this.testKeySchedule_(0,this.keySchedule_,this.numberOfRounds_);this.copyInput_(a);this.addRoundKey_(this.numberOfRounds_);for(a=1;a<this.numberOfRounds_;++a)goog.crypt.Aes.ENABLE_TEST_MODE&&(this.testKeySchedule_(a,this.keySchedule_,this.numberOfRounds_-a),this.testStartRound_(a,this.state_)),this.invShiftRows_(),goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterShiftRows_(a,this.state_),this.subBytes_(goog.crypt.Aes.INV_SBOX_),
goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterSubBytes_(a,this.state_),this.addRoundKey_(this.numberOfRounds_-a),goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterAddRoundKey_(a,this.state_),this.invMixColumns_();this.invShiftRows_();goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterShiftRows_(a,this.state_);this.subBytes_(goog.crypt.Aes.INV_SBOX_);goog.crypt.Aes.ENABLE_TEST_MODE&&this.testAfterSubBytes_(this.numberOfRounds_,this.state_);goog.crypt.Aes.ENABLE_TEST_MODE&&this.testKeySchedule_(this.numberOfRounds_,
this.keySchedule_,0);this.addRoundKey_(0);return this.generateOutput_()};goog.crypt.Aes.BLOCK_SIZE_=4;goog.crypt.Aes.assertKeyArray_=function(a){if(goog.asserts.ENABLE_ASSERTS){goog.asserts.assert(16==a.length||24==a.length||32==a.length,"Key must have length 16, 24, or 32.");for(var b=0;b<a.length;b++)goog.asserts.assertNumber(a[b]),goog.asserts.assert(0<=a[b]&&255>=a[b])}};goog.crypt.Aes.prototype.testStartRound_=goog.nullFunction;goog.crypt.Aes.prototype.testAfterSubBytes_=goog.nullFunction;
goog.crypt.Aes.prototype.testAfterShiftRows_=goog.nullFunction;goog.crypt.Aes.prototype.testAfterMixColumns_=goog.nullFunction;goog.crypt.Aes.prototype.testAfterAddRoundKey_=goog.nullFunction;goog.crypt.Aes.prototype.testKeySchedule_=goog.nullFunction;
goog.crypt.Aes.prototype.copyInput_=function(a){var b,c;goog.asserts.assert(a.length==4*goog.crypt.Aes.BLOCK_SIZE_,"Expecting input of 4 times block size.");for(var d=0;d<goog.crypt.Aes.BLOCK_SIZE_;d++)for(var e=0;4>e;e++)c=4*e+d,b=a[c],goog.asserts.assert(255>=b&&0<=b,"Invalid input. Value %s at position %s is not a byte.",b,c),this.state_[d][e]=b};
goog.crypt.Aes.prototype.generateOutput_=function(){for(var a=[],b=0;b<goog.crypt.Aes.BLOCK_SIZE_;b++)for(var c=0;4>c;c++)a[4*c+b]=this.state_[b][c];return a};goog.crypt.Aes.prototype.addRoundKey_=function(a){for(var b=0;4>b;b++)for(var c=0;4>c;c++)this.state_[b][c]^=this.keySchedule_[4*a+c][b]};goog.crypt.Aes.prototype.subBytes_=function(a){for(var b=0;4>b;b++)for(var c=0;4>c;c++)this.state_[b][c]=a[this.state_[b][c]]};
goog.crypt.Aes.prototype.shiftRows_=function(){for(var a=1;4>a;a++)for(var b=0;4>b;b++)this.temp_[a][b]=this.state_[a][b];for(a=1;4>a;a++)for(b=0;4>b;b++)this.state_[a][b]=this.temp_[a][(b+a)%goog.crypt.Aes.BLOCK_SIZE_]};goog.crypt.Aes.prototype.invShiftRows_=function(){for(var a=1;4>a;a++)for(var b=0;4>b;b++)this.temp_[a][(b+a)%goog.crypt.Aes.BLOCK_SIZE_]=this.state_[a][b];for(a=1;4>a;a++)for(b=0;4>b;b++)this.state_[a][b]=this.temp_[a][b]};
goog.crypt.Aes.prototype.mixColumns_=function(){for(var a=this.state_,b=this.temp_[0],c=0;4>c;c++)b[0]=a[0][c],b[1]=a[1][c],b[2]=a[2][c],b[3]=a[3][c],a[0][c]=goog.crypt.Aes.MULT_2_[b[0]]^goog.crypt.Aes.MULT_3_[b[1]]^b[2]^b[3],a[1][c]=b[0]^goog.crypt.Aes.MULT_2_[b[1]]^goog.crypt.Aes.MULT_3_[b[2]]^b[3],a[2][c]=b[0]^b[1]^goog.crypt.Aes.MULT_2_[b[2]]^goog.crypt.Aes.MULT_3_[b[3]],a[3][c]=goog.crypt.Aes.MULT_3_[b[0]]^b[1]^b[2]^goog.crypt.Aes.MULT_2_[b[3]]};
goog.crypt.Aes.prototype.invMixColumns_=function(){for(var a=this.state_,b=this.temp_[0],c=0;4>c;c++)b[0]=a[0][c],b[1]=a[1][c],b[2]=a[2][c],b[3]=a[3][c],a[0][c]=goog.crypt.Aes.MULT_E_[b[0]]^goog.crypt.Aes.MULT_B_[b[1]]^goog.crypt.Aes.MULT_D_[b[2]]^goog.crypt.Aes.MULT_9_[b[3]],a[1][c]=goog.crypt.Aes.MULT_9_[b[0]]^goog.crypt.Aes.MULT_E_[b[1]]^goog.crypt.Aes.MULT_B_[b[2]]^goog.crypt.Aes.MULT_D_[b[3]],a[2][c]=goog.crypt.Aes.MULT_D_[b[0]]^goog.crypt.Aes.MULT_9_[b[1]]^goog.crypt.Aes.MULT_E_[b[2]]^goog.crypt.Aes.MULT_B_[b[3]],
a[3][c]=goog.crypt.Aes.MULT_B_[b[0]]^goog.crypt.Aes.MULT_D_[b[1]]^goog.crypt.Aes.MULT_9_[b[2]]^goog.crypt.Aes.MULT_E_[b[3]]};
goog.crypt.Aes.prototype.keyExpansion_=function(){this.keySchedule_=Array(goog.crypt.Aes.BLOCK_SIZE_*(this.numberOfRounds_+1));for(var a=0;a<this.keyLength_;a++)this.keySchedule_[a]=[this.key_[4*a],this.key_[4*a+1],this.key_[4*a+2],this.key_[4*a+3]];for(var b=Array(4),a=this.keyLength_;a<goog.crypt.Aes.BLOCK_SIZE_*(this.numberOfRounds_+1);a++)b[0]=this.keySchedule_[a-1][0],b[1]=this.keySchedule_[a-1][1],b[2]=this.keySchedule_[a-1][2],b[3]=this.keySchedule_[a-1][3],0==a%this.keyLength_?(this.rotWord_(b),
this.subWord_(b),b[0]^=goog.crypt.Aes.RCON_[a/this.keyLength_][0],b[1]^=goog.crypt.Aes.RCON_[a/this.keyLength_][1],b[2]^=goog.crypt.Aes.RCON_[a/this.keyLength_][2],b[3]^=goog.crypt.Aes.RCON_[a/this.keyLength_][3]):6<this.keyLength_&&4==a%this.keyLength_&&this.subWord_(b),this.keySchedule_[a]=Array(4),this.keySchedule_[a][0]=this.keySchedule_[a-this.keyLength_][0]^b[0],this.keySchedule_[a][1]=this.keySchedule_[a-this.keyLength_][1]^b[1],this.keySchedule_[a][2]=this.keySchedule_[a-this.keyLength_][2]^
b[2],this.keySchedule_[a][3]=this.keySchedule_[a-this.keyLength_][3]^b[3]};goog.crypt.Aes.prototype.subWord_=function(a){a[0]=goog.crypt.Aes.SBOX_[a[0]];a[1]=goog.crypt.Aes.SBOX_[a[1]];a[2]=goog.crypt.Aes.SBOX_[a[2]];a[3]=goog.crypt.Aes.SBOX_[a[3]];return a};goog.crypt.Aes.prototype.rotWord_=function(a){var b=a[0];a[0]=a[1];a[1]=a[2];a[2]=a[3];a[3]=b;return a};
goog.crypt.Aes.SBOX_=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,
23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];
goog.crypt.Aes.INV_SBOX_=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,
220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125];
goog.crypt.Aes.RCON_=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];
goog.crypt.Aes.MULT_2_=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,27,25,31,29,19,17,23,
21,11,9,15,13,3,1,7,5,59,57,63,61,51,49,55,53,43,41,47,45,35,33,39,37,91,89,95,93,83,81,87,85,75,73,79,77,67,65,71,69,123,121,127,125,115,113,119,117,107,105,111,109,99,97,103,101,155,153,159,157,147,145,151,149,139,137,143,141,131,129,135,133,187,185,191,189,179,177,183,181,171,169,175,173,163,161,167,165,219,217,223,221,211,209,215,213,203,201,207,205,195,193,199,197,251,249,255,253,243,241,247,245,235,233,239,237,227,225,231,229];
goog.crypt.Aes.MULT_3_=[0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,48,51,54,53,60,63,58,57,40,43,46,45,36,39,34,33,96,99,102,101,108,111,106,105,120,123,126,125,116,119,114,113,80,83,86,85,92,95,90,89,72,75,78,77,68,71,66,65,192,195,198,197,204,207,202,201,216,219,222,221,212,215,210,209,240,243,246,245,252,255,250,249,232,235,238,237,228,231,226,225,160,163,166,165,172,175,170,169,184,187,190,189,180,183,178,177,144,147,150,149,156,159,154,153,136,139,142,141,132,135,130,129,155,152,157,158,151,
148,145,146,131,128,133,134,143,140,137,138,171,168,173,174,167,164,161,162,179,176,181,182,191,188,185,186,251,248,253,254,247,244,241,242,227,224,229,230,239,236,233,234,203,200,205,206,199,196,193,194,211,208,213,214,223,220,217,218,91,88,93,94,87,84,81,82,67,64,69,70,79,76,73,74,107,104,109,110,103,100,97,98,115,112,117,118,127,124,121,122,59,56,61,62,55,52,49,50,35,32,37,38,47,44,41,42,11,8,13,14,7,4,1,2,19,16,21,22,31,28,25,26];
goog.crypt.Aes.MULT_9_=[0,9,18,27,36,45,54,63,72,65,90,83,108,101,126,119,144,153,130,139,180,189,166,175,216,209,202,195,252,245,238,231,59,50,41,32,31,22,13,4,115,122,97,104,87,94,69,76,171,162,185,176,143,134,157,148,227,234,241,248,199,206,213,220,118,127,100,109,82,91,64,73,62,55,44,37,26,19,8,1,230,239,244,253,194,203,208,217,174,167,188,181,138,131,152,145,77,68,95,86,105,96,123,114,5,12,23,30,33,40,51,58,221,212,207,198,249,240,235,226,149,156,135,142,177,184,163,170,236,229,254,247,200,193,
218,211,164,173,182,191,128,137,146,155,124,117,110,103,88,81,74,67,52,61,38,47,16,25,2,11,215,222,197,204,243,250,225,232,159,150,141,132,187,178,169,160,71,78,85,92,99,106,113,120,15,6,29,20,43,34,57,48,154,147,136,129,190,183,172,165,210,219,192,201,246,255,228,237,10,3,24,17,46,39,60,53,66,75,80,89,102,111,116,125,161,168,179,186,133,140,151,158,233,224,251,242,205,196,223,214,49,56,35,42,21,28,7,14,121,112,107,98,93,84,79,70];
goog.crypt.Aes.MULT_B_=[0,11,22,29,44,39,58,49,88,83,78,69,116,127,98,105,176,187,166,173,156,151,138,129,232,227,254,245,196,207,210,217,123,112,109,102,87,92,65,74,35,40,53,62,15,4,25,18,203,192,221,214,231,236,241,250,147,152,133,142,191,180,169,162,246,253,224,235,218,209,204,199,174,165,184,179,130,137,148,159,70,77,80,91,106,97,124,119,30,21,8,3,50,57,36,47,141,134,155,144,161,170,183,188,213,222,195,200,249,242,239,228,61,54,43,32,17,26,7,12,101,110,115,120,73,66,95,84,247,252,225,234,219,
208,205,198,175,164,185,178,131,136,149,158,71,76,81,90,107,96,125,118,31,20,9,2,51,56,37,46,140,135,154,145,160,171,182,189,212,223,194,201,248,243,238,229,60,55,42,33,16,27,6,13,100,111,114,121,72,67,94,85,1,10,23,28,45,38,59,48,89,82,79,68,117,126,99,104,177,186,167,172,157,150,139,128,233,226,255,244,197,206,211,216,122,113,108,103,86,93,64,75,34,41,52,63,14,5,24,19,202,193,220,215,230,237,240,251,146,153,132,143,190,181,168,163];
goog.crypt.Aes.MULT_D_=[0,13,26,23,52,57,46,35,104,101,114,127,92,81,70,75,208,221,202,199,228,233,254,243,184,181,162,175,140,129,150,155,187,182,161,172,143,130,149,152,211,222,201,196,231,234,253,240,107,102,113,124,95,82,69,72,3,14,25,20,55,58,45,32,109,96,119,122,89,84,67,78,5,8,31,18,49,60,43,38,189,176,167,170,137,132,147,158,213,216,207,194,225,236,251,246,214,219,204,193,226,239,248,245,190,179,164,169,138,135,144,157,6,11,28,17,50,63,40,37,110,99,116,121,90,87,64,77,218,215,192,205,238,
227,244,249,178,191,168,165,134,139,156,145,10,7,16,29,62,51,36,41,98,111,120,117,86,91,76,65,97,108,123,118,85,88,79,66,9,4,19,30,61,48,39,42,177,188,171,166,133,136,159,146,217,212,195,206,237,224,247,250,183,186,173,160,131,142,153,148,223,210,197,200,235,230,241,252,103,106,125,112,83,94,73,68,15,2,21,24,59,54,33,44,12,1,22,27,56,53,34,47,100,105,126,115,80,93,74,71,220,209,198,203,232,229,242,255,180,185,174,163,128,141,154,151];
goog.crypt.Aes.MULT_E_=[0,14,28,18,56,54,36,42,112,126,108,98,72,70,84,90,224,238,252,242,216,214,196,202,144,158,140,130,168,166,180,186,219,213,199,201,227,237,255,241,171,165,183,185,147,157,143,129,59,53,39,41,3,13,31,17,75,69,87,89,115,125,111,97,173,163,177,191,149,155,137,135,221,211,193,207,229,235,249,247,77,67,81,95,117,123,105,103,61,51,33,47,5,11,25,23,118,120,106,100,78,64,82,92,6,8,26,20,62,48,34,44,150,152,138,132,174,160,178,188,230,232,250,244,222,208,194,204,65,79,93,83,121,119,
101,107,49,63,45,35,9,7,21,27,161,175,189,179,153,151,133,139,209,223,205,195,233,231,245,251,154,148,134,136,162,172,190,176,234,228,246,248,210,220,206,192,122,116,102,104,66,76,94,80,10,4,22,24,50,60,46,32,236,226,240,254,212,218,200,198,156,146,128,142,164,170,184,182,12,2,16,30,52,58,40,38,124,114,96,110,68,74,88,86,55,57,43,37,15,1,19,29,71,73,91,85,127,113,99,109,215,217,203,197,239,225,243,253,167,169,187,181,159,145,131,141];goog.crypt.Cbc=function(a,b){this.cipher_=a;this.blockSize_=b||16};goog.crypt.Cbc.prototype.encrypt=function(a,b){goog.asserts.assert(0==a.length%this.blockSize_,"Data's length must be multiple of block size.");goog.asserts.assert(b.length==this.blockSize_,"Initial vector must be size of one block.");for(var c=[],d=b,e=0;e<a.length;e+=this.blockSize_){var f=goog.array.slice(a,e,e+this.blockSize_),d=goog.crypt.xorByteArray(f,d),d=this.cipher_.encrypt(d);goog.array.extend(c,d)}return c};
goog.crypt.Cbc.prototype.decrypt=function(a,b){goog.asserts.assert(0==a.length%this.blockSize_,"Data's length must be multiple of block size.");goog.asserts.assert(b.length==this.blockSize_,"Initial vector must be size of one block.");for(var c=[],d=0,e=b;d<a.length;){var f=goog.array.slice(a,d,d+this.blockSize_),g=this.cipher_.decrypt(f),e=goog.crypt.xorByteArray(e,g);goog.array.extend(c,e);e=f;d+=this.blockSize_}return c};goog.crypt.Sha2=function(){goog.crypt.Hash.call(this);this.chunk=[];this.total=this.inChunk=0;this.pad_=goog.array.repeat(0,64);this.pad_[0]=128;this.hash=[];this.numHashBlocks=0;this.reset()};goog.inherits(goog.crypt.Sha2,goog.crypt.Hash);
goog.crypt.Sha2.prototype.computeChunk_=function(a){goog.asserts.assert(64==a.length);for(var b=[],c=0,d=0;d<a.length;)b[c++]=a[d]<<24|a[d+1]<<16|a[d+2]<<8|a[d+3],d=4*c;for(a=16;64>a;a++)b[a]=b[a-16]+((b[a-15]>>>7|b[a-15]<<25)^(b[a-15]>>>18|b[a-15]<<14)^b[a-15]>>>3)+b[a-7]+((b[a-2]>>>17|b[a-2]<<15)^(b[a-2]>>>19|b[a-2]<<13)^b[a-2]>>>10)&4294967295;var c=this.hash[0],d=this.hash[1],e=this.hash[2],f=this.hash[3],g=this.hash[4],h=this.hash[5],k=this.hash[6],l=this.hash[7];for(a=0;64>a;a++)var m=((c>>>
2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10))+(c&d^c&e^d&e)&4294967295,n=l+((g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&h^~g&k)+this.K_[a]+b[a]&4294967295,l=k,k=h,h=g,g=f+n&4294967295,f=e,e=d,d=c,c=n+m&4294967295;this.hash[0]=this.hash[0]+c&4294967295;this.hash[1]=this.hash[1]+d&4294967295;this.hash[2]=this.hash[2]+e&4294967295;this.hash[3]=this.hash[3]+f&4294967295;this.hash[4]=this.hash[4]+g&4294967295;this.hash[5]=this.hash[5]+h&4294967295;this.hash[6]=this.hash[6]+k&4294967295;this.hash[7]=this.hash[7]+
l&4294967295};goog.crypt.Sha2.prototype.update=function(a,b){goog.isDef(b)||(b=a.length);var c=0,d=this.inChunk;if(goog.isString(a))for(;c<b;)this.chunk[d++]=a.charCodeAt(c++),64==d&&(this.computeChunk_(this.chunk),d=0);else for(;c<b;)this.chunk[d++]=a[c++],64==d&&(this.computeChunk_(this.chunk),d=0);this.inChunk=d;this.total+=b};
goog.crypt.Sha2.prototype.digest=function(){var a=[],b=8*this.total;56>this.inChunk?this.update(this.pad_,56-this.inChunk):this.update(this.pad_,64-(this.inChunk-56));for(var c=63;56<=c;c--)this.chunk[c]=b&255,b/=256;this.computeChunk_(this.chunk);for(c=b=0;c<this.numHashBlocks;c++)for(var d=24;0<=d;d-=8)a[b++]=this.hash[c]>>d&255;return a};
goog.crypt.Sha2.prototype.K_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,
3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];goog.crypt.Sha256=function(){goog.crypt.Sha2.call(this)};goog.inherits(goog.crypt.Sha256,goog.crypt.Sha2);goog.crypt.Sha256.prototype.reset=function(){this.chunk=[];this.total=this.inChunk=0;this.hash=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];this.numHashBlocks=8};ydn.testing.ErrorLogger=function(a,b){this.db_=a;this.secret_=goog.crypt.stringToByteArray("requestAnimationFrame");this.filter=b||null;var c=this;setTimeout(function(){c.upload()},6E5*Math.random())};ydn.testing.ErrorLogger.BUCKET="mhardartway";
ydn.testing.ErrorLogger.prototype.upload_=function(){var a=this.db_.getName(),b="https://"+ydn.testing.ErrorLogger.BUCKET+".s3.amazonaws.com/",c={"Content-Type":"application/json"};this.db_.values("log",null,20).addCallback(function(d){if(0!=d.length){var e=d.map(function(a){return a.key});d=JSON.stringify(d);d=new ydn.client.HttpRequestData(b+(a+"/"+e[0]),"PUT",null,c,d);var f=ydn.client.getClient(),e=e.map(function(a){return new ydn.db.Key("log",a)});f.request(d).execute(function(a,b){b.isSuccess()&&
this.db_.remove(e).addCallback(function(a){a==e.length&&this.upload_()},this)},this)}},this)};ydn.testing.ErrorLogger.prototype.upload=function(){this.upload_()};ydn.testing.ErrorLogger.RC4=!1;
ydn.testing.ErrorLogger.prototype.encryptValue_=function(a,b,c,d){var e=new goog.crypt.Sha256;e.update(goog.crypt.stringToByteArray(b));e.update(a);e.update(this.secret_);b=e.digest();c=goog.crypt.stringToByteArray(c);if(ydn.testing.ErrorLogger.RC4)a=new goog.crypt.Arc4,a.setKey(b),a.discard(1536),a.crypt(c);else{for(var e=a.length-c.length%a.length,f=0;f<e;f++)c.push(10);b=new goog.crypt.Aes(b);b=new goog.crypt.Cbc(b);c=d?b.decrypt(c,a):b.encrypt(c,a)}return goog.crypt.byteArrayToString(c)};
ydn.testing.ErrorLogger.prototype.decryptValue_=function(a,b,c){return this.encryptValue_(a,b,c,!0)};ydn.testing.ErrorLogger.prototype.log=function(a){this.filter&&(a=this.filter(a));if(a){var b=JSON.stringify(a);a=String(goog.now());for(var c=[],d=0;16>d;++d)c[d]=256*Math.random()|0;b=this.encryptValue_(c,a,b);this.db_.put("log",{key:a,salt:c,value:b})}};
ydn.testing.ErrorLogger.tail=function(a){ydn.debug.ILogger.instance.db_.values("log",null,a||10,0,!0).addCallback(function(a){for(var c=0;c<a.length;c++){var d=ydn.debug.ILogger.instance.decryptValue_(a[c].salt,a[c].key,a[c].value);try{var e=d,f=e.lastIndexOf(String.fromCharCode(10));32>=e.length-f&&(e=e.substr(0,f));window.console.log(JSON.parse(e))}catch(g){window.console.log(d)}}})};ydn.crm.app={};
ydn.crm.app.App=function(){this.setting=null;this.user_gmail="";this.sugars={};this.gdata_contact=null;this.user=new ydn.api.User;this.user.setRedirectUrl(chrome.extension.getURL(ydn.crm.base.OPTION_PAGE));this.user_info=this.df_login_=this.df_gdata_token_=this.gdata_token_=null;var a="XMLHttpRequest"+location.host,b=new goog.storage.mechanism.HTML5LocalStorage;this.encrypt_storage=new goog.storage.EncryptedStorage(b,a);this.logo=new ydn.logo.Logo;var a=new ydn.db.Storage("ydn.crm",{stores:[{name:"log",
keyPath:"key"}]}),c=this,d=goog.now();ydn.debug.ILogger.instance=new ydn.testing.ErrorLogger(a,function(a){if(!a||a.HttpRequestData&&"https://mail.google.com/mail/feed/atom/bazinga"==a.HttpRequestData.path)return null;c.user_info&&c.user_info.Id&&(a.id=c.user_info.Id.$t);a.gmail=c.user_gmail;a.uptime=d;return a});ydn.client.error_logger=ydn.debug.ILogger.instance;chrome.permissions.onAdded.addListener(this.handleNewPermission.bind(this))};ydn.crm.app.App.prototype.logger=goog.debug.Logger.getLogger("ydn.crm.app.App");
ydn.crm.app.App.prototype.handleNewPermission=function(a){for(var b=a.origins?a.origins.length:0,c=0;c<b;c++){var d=a.origins[c].match(/https:\/\/([^\/]+)/);if(d){var d=d[1],e=this.sugars[d];e?(this.logger.fine("host permission granted to "+e),e.setClient(ydn.client.getClient(ydn.http.Scopes.DEFAULT))):this.logger.warning("Host "+d+" not found.")}}};ydn.crm.app.App.prototype.getGDataContact=function(){return this.gdata_contact};
ydn.crm.app.App.prototype.init=function(a){this.setting=a||{};this.setting.logging&&ydn.crm.shared.log();this.logger.finer("init "+this);this.logo.setState(ydn.logo.Logo.State.LOGOFF);ydn.crm.shared.getLoginClient()};
ydn.crm.app.App.prototype.initSugarClient=function(a){var b=a.baseUrl,c=a.domain||b;if(!c)return goog.async.Deferred.fail("domain or url required.");c=c.trim();goog.string.startsWith(c,"http")&&(c=(new goog.Uri(c)).getDomain());/\//.test(c)&&(c=(new goog.Uri("https://"+c)).getDomain());var d=this.sugars[c];if(!d){var e="sugar-client-"+c,f=this.encrypt_storage.get(e)||{},g=a.username||f.username;b||(b=f.base_url);b||(b="https://"+c);if(!g)return goog.async.Deferred.fail("username required.");a=(a=
a.password)?CryptoJS.MD5(a).toString():f.password;if(!g)return goog.async.Deferred.fail("username required.");f.username=g;f.password=a;f.base_url=b;d=new ydn.crm.sugar.Client(b,g,a)}else if(d.isLogin())return goog.async.Deferred.succeed(d.about());return d.login().addCallback(function(a){this.logger.fine("initializing sugarcrm client: "+c+" login="+d.isLogin());d.isLogin()&&(this.sugars[c]=d,this.encrypt_storage.set(e,f),a=Object.keys(this.sugars),ydn.crm.shared.setSetting(ydn.crm.shared.Setting.SUGAR_DOMAINS,
a),d.update());return d.about()},this)};
ydn.crm.app.App.prototype.removeSugarClient=function(a){if(!a)return goog.async.Deferred.fail("domain required");this.encrypt_storage.remove("sugar-client-"+a);var b=ydn.crm.shared.getSetting(ydn.crm.shared.Setting.SUGAR_DOMAINS)||[],c=b.indexOf(a);0<=c&&(b.splice(c,1),ydn.crm.shared.setSetting(ydn.crm.shared.Setting.SUGAR_DOMAINS,b));var d=new goog.async.Deferred;this.sugars[a]?this.sugars[a].logout().addCallbacks(function(){delete this.sugars[a];d.callback(!0)},function(a){d.errback(!1)},this):
d.callback(!1);return d};
ydn.crm.app.App.prototype.handleLoginResult=function(a){var b=new goog.async.Deferred,c=a.email||"";if(this.user_info&&this.user_info.email==c)return this.logger.finer("already running for "+c),b.callback(this.user_info),b;this.user_info=a;this.user_info.updated=goog.now();if(c){if(this.user_gmail&&this.user_gmail!=c)return this.logger.info("invalid gmail user"),a=goog.object.clone(this.user_info),a.gmail=this.user_gmail,b.errback(a),b;goog.asserts.assertObject(a.Id,"user id not provided");this.logger.finer("running "+
this+" for "+c);var d=a.Id.$t;ydn.crm.shared.setupClients(this);ydn.crm.shared.setupSetting(d,function(){var a={id:c};ydn.crm.data.initDb(d);this.gdata_contact=new ydn.ds.gdata.Contact(ydn.crm.data.db,a);a=ydn.client.getClient(ydn.http.Scopes.GSE);goog.asserts.assert(a,"GSE client not ready");this.gdata_contact.setClient(a);this.gdata_contact.update();for(var a=ydn.crm.shared.getSetting(ydn.crm.shared.Setting.SUGAR_DOMAINS)||[],f=0;f<a.length;f++)a[f]&&this.initSugarClient({domain:a[f]});b.callback(this.user_info);
this.logo.setState(ydn.logo.Logo.State.LOGIN)},this)}else b.callback(this.user_info),this.logo.setState(ydn.logo.Logo.State.LOGOFF);return b};
ydn.crm.app.App.prototype.getOAuthToken=function(a){if(this.df_gdata_token_)return this.df_gdata_token_;if(this.gdata_token_&&this.gdata_token_.expires<goog.now())return goog.async.Deferred.succeed(this.gdata_token_);this.df_gdata_token_=new goog.async.Deferred;a={url:a||chrome.extension.getURL(ydn.crm.base.OPTION_PAGE)};a=new ydn.client.HttpRequestData("/token","GET",a);ydn.crm.shared.getAppClient().request(a).execute(function(a,c){if(c.isSuccess()){var d=a.Tokens[0];if(!d.has_token){this.df_gdata_token_.errback(d);
return}d.expires=1E3*d.expires_in+goog.now();this.gdata_token_=d;this.df_gdata_token_.callback(d)}else this.gdata_token_=null,this.df_gdata_token_.errback(c);this.df_gdata_token_=null},this);return this.df_gdata_token_};ydn.crm.app.App.prototype.isLogin=function(){return!!this.user_info&&this.user_info.is_login};
ydn.crm.app.App.prototype.doLogin=function(a){if(this.df_login_)return this.df_login_;var b=this;return this.df_login_=ydn.gmail.Utils.getUserEmail().addBoth(function(c){b.user_gmail=c;return this.user.getLoginInfo(a).addCallback(function(a){return this.handleLoginResult(a).addCallback(function(a){b.isLogin()?setTimeout(function(){b.df_login_=null},9E5):b.df_login_=null})},this)},this)};ydn.crm.app.App.prototype.logout=function(){this.user_info=this.df_login_=null;this.logo.setState(ydn.logo.Logo.State.LOGOFF)};
ydn.crm.app.App.prototype.run=function(){this.doLogin()};ydn.crm.app.App.prototype.toString=function(){return"SugarApp:"+ydn.crm.version};ydn.gdata.site.Entry=function(a){ydn.gdata.Entry.call(this,a);a=ydn.gdata.site.utils.parseFeedUri(this.id);if(!a||!goog.isString(a.domain_name)||!goog.isString(a.site_name))throw new ydn.error.ArgumentException("Invalid id: "+this.id);this.domain_name=a.domain_name;this.site_name=a.site_name};goog.inherits(ydn.gdata.site.Entry,ydn.gdata.Entry);ydn.gdata.site.Entry.prototype.kind=ydn.gdata.Kind.PAGE;ydn.gdata.site.Entry.XMLNS=ydn.gdata.Entry.XMLNS+' xmlns:sites="http://schemas.google.com/sites/2008" xmlns:gs="http://schemas.google.com/spreadsheets/2006"';
ydn.gdata.site.Entry.prototype.getDomainName=function(){return this.domain_name};ydn.gdata.site.Entry.prototype.getSiteName=function(){return this.site_name};ydn.gdata.site.Entry.prototype.getFeedUri=function(){return ydn.gdata.site.utils.buildFeedUri(this.getDomainName(),this.getSiteName(),ydn.gdata.Kind.PAGE)};ydn.gdata.site.Page=function(a){ydn.gdata.site.Entry.call(this,a)};goog.inherits(ydn.gdata.site.Page,ydn.gdata.site.Entry);ydn.gdata.site.Page.prototype.kind=ydn.gdata.Kind.PAGE;ydn.gdata.site.Page.prototype.getData=function(){return this.data};ydn.gdata.site.Page.prototype.getHtmlContent=function(){if(goog.isDef(this.data.content)){var a=this.data.content.$t,a=a.replace(/^<div xmlns=["']http:\/\/www.w3.org\/1999\/xhtml["']>/,"");return a=a.replace(/<\/div>$/,"")}return""};
ydn.gdata.site.Page.prototype.getDocument=function(){var a=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),b=a.createElement("body");b.innerHTML=this.data.content.$t;a.documentElement.appendChild(b);return a};
ydn.gdata.site.Page.prototype.setDocument=function(a){if(a.documentElement)a=a.documentElement.querySelectorAll("body")[0].innerHTML;else{a=goog.dom.xml.serialize(a);var b=a.indexOf("<body>"),c=a.indexOf("</body>");a=a.substring(b+6,c)}this.data.content=ydn.atom.Atom.content(a,"xhtml");this.setModified()};ydn.gdata.site.Page.prototype.getWikiContent=function(){return this.getDocument().getElementsByClassName("sites-layout-tile sites-tile-name-content-1")[0].innerHTML};
ydn.gdata.site.Page.prototype.setWikiContent=function(a){var b=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),c=b.createElement("body");c.innerHTML='<div xmlns="http://www.w3.org/1999/xhtml"><table cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1">'+a+"</td></tr></tbody></table></div>";b.documentElement.appendChild(c);this.setDocument(b)};
ydn.gdata.site.Page.prototype.setHtmlContent=function(a,b){var c='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>";if(!b&&!ydn.gdata.xml.loadXml(c))throw new ydn.error.ArgumentException("Invalid XHTML content: "+a.substr(0,50));this.data.content=ydn.atom.Atom.content(c,"xhtml");this.setModified()};ydn.gdata.site.Page.prototype.getUrl=function(){var a=this.getLink(ydn.atom.Link.Rel.ALTERNATE);goog.asserts.assert(a,this+": require alternate Link element missing.");return a.href};
ydn.gdata.site.Page.prototype.getSiteName=function(){return this.data.sites$siteName?this.data.sites$siteName.$t:ydn.gdata.site.utils.parseFeedUri(this.getId()).site_name||""};ydn.gdata.site.Page.prototype.getName=function(){return this.data.sites$pageName?this.data.sites$pageName.$t:""};ydn.gdata.site.Page.prototype.toString=function(){return"Page:"+(this.data?this.data.id?this.data.id.$t:"?":"?")};ydn.crm.feed={};ydn.crm.feed.Message=function(a,b){goog.Disposable.call(this);this.id=b||"f"+this.count();this.root=null;this.ele_title=document.createElement("span");a&&(this.ele_title.textContent=a);this.ele_link=document.createElement("a");this.ele_status=document.createElement("span");this.created=goog.now();this.stream_scope_=this.stream_cb_=null};goog.inherits(ydn.crm.feed.Message,goog.Disposable);
ydn.crm.feed.Message.prototype.toJSON=function(){return{id:this.id,message:{title:this.ele_title.textContent,status:this.ele_status.textContent,link:{href:this.ele_link.href,text:this.ele_link.textContent,title:this.ele_link.title}}}};ydn.crm.feed.Message.prototype.fromJSON=function(a){goog.asserts.assert(a.id==this.id,"expect id "+this.id+" but "+a.id);if(a=a.message)this.ele_title.textContent=a.title,this.ele_status.textContent=a.status,this.link(a.link.href,a.link.text,a.link.title)};
ydn.crm.feed.Message.prototype.getId=function(){return this.id};ydn.crm.feed.Message.prototype.getTitle=function(){return this.ele_title.textContent};ydn.crm.feed.Message.count_=0;ydn.crm.feed.Message.prototype.count=function(){ydn.crm.feed.Message.count_++;return ydn.crm.feed.Message.count_};ydn.crm.feed.Message.prototype.done_=!1;
ydn.crm.feed.Message.prototype.init=function(a){if(this.root)throw Error("Already initialized");this.root=a;this.root.appendChild(this.ele_title);this.root.appendChild(this.ele_link);this.root.appendChild(this.ele_status)};ydn.crm.feed.Message.prototype.getRoot=function(){return this.root};ydn.crm.feed.Message.prototype.disposeInternal=function(){this.stream_scope_=this.stream_cb_=this.root=null};
ydn.crm.feed.Message.prototype.title=function(a,b){this.ele_title.textContent=a;this.ele_title.title=b||"";this.dispatch_()};
ydn.crm.feed.Message.prototype.link=function(a,b,c){a?(goog.style.setElementShown(this.ele_link,!0),20<b.length&&(c||(c=b),b=b.substr(0,9)+"..."+b.substring(b.length-7)),this.ele_link.href=a,this.ele_link.textContent=b||a.substr(-10),goog.string.startsWith(a,"#")||(this.ele_link.target="_blank"),this.ele_link.title=c||"",this.dispatch_()):goog.style.setElementShown(this.ele_link,!1)};ydn.crm.feed.Message.prototype.status=function(a){this.ele_status.textContent=a;this.dispatch_()};
ydn.crm.feed.Message.prototype.dispatch_=function(){this.stream_cb_&&this.stream_cb_.call(this.stream_scope_,this.toJSON())};ydn.crm.feed.Message.prototype.stream=function(a,b){this.stream_cb_=a;this.stream_scope_=b;this.dispatch_()};ydn.crm.feed.Message.prototype.done=function(a){this.done_||(goog.isDef(a)&&this.status(a),this.done_=!0,this.stream_cb_&&this.stream_cb_.call(this.stream_scope_,this.toJSON()),this.dispose())};ydn.crm.feed.Feed=function(){this.ul=this.root=null;this.messages=[];this.statusListener=null};ydn.crm.feed.Feed.MAX=20;ydn.crm.feed.Feed.prototype.init=function(a){this.root=a;this.ul=document.createElement("UL");this.root.appendChild(this.ul)};ydn.crm.feed.Feed.prototype.setVisible=function(a){goog.style.setElementShown(this.root,a)};ydn.crm.feed.Feed.prototype.notify=function(a){a=new ydn.crm.feed.Message(a);this.add(a);return a};
ydn.crm.feed.Feed.prototype.getMessage=function(a){for(var b=0;b<this.messages.length;++b)if(this.messages[b].getId()==a)return this.messages[b];return null};
ydn.crm.feed.Feed.prototype.add=function(a){var b=document.createElement("li");this.ul.insertBefore(b,this.ul.children[0]);a.init(b);0<this.messages.length&&this.messages[this.messages.length-1].stream(null,null);a.stream(this.statusListener,null);this.messages.push(a);this.messages.length>ydn.crm.feed.Feed.MAX&&(a=this.messages[this.messages.length-1],this.ul.removeChild(a.getRoot()),a.dispose(),this.messages.length-=1)};ydn.crm.feed.Feed.prototype.toString=function(){return"Feed"};
ydn.crm.feed.feed=new ydn.crm.feed.Feed;templ.ydn.crm.inj={};templ.ydn.crm.inj.debug=function(a,b){return'<div class="debug-panel"><div id="debug-channel"><h4>Channel</h4><select><option value="guf">GOOGLE_USERINFO</option><option value="gdf">GDATA_FETCH</option><option value="gdls">GDATA_LINK_SUGAR</option><option value="gdcm">GDATA_CONTACT_MERGE</option><option value="gdce">GDATA_LIST_CONTACT_BY_EMAIL</option><option value="sd">SUGAR_DETAILS</option><option value="sl">SUGAR_LOGIN</option><option value="sfm">SUGAR_FETCH_MODULE</option><option value="sr">SUGAR_REST</option><option value="slm">SUGAR_LIST_MODULE</option><option value="sim">SUGAR_INFO_MODULE</option><option value="slem">SUGAR_FIND_BY_EMAIL</option><option value="sic">SUGAR_IMPORT_CONTACT</option></select><br /><textarea cols="80" rows="6" name="params"></textarea><br /><button>Send</button></div><hr /><details id="debug-sugar-rest"><summary>REST call</summary><select class="sugar-rest-module"><option value="Leads">Leads</option><option value="User">User</option><option value="Contacts" selected>Contacts</option></select><select class="sugar-rest-method"><option value="get_module_fields">Retrieving a List of Fields From a Module</option><option value="get_entries">Retrieving Multiple Records by ID From a Module</option><option value="get_entry_list" selected>Retrieving a List of Records</option></select><div><textarea class="sugar-rest-params" cols="80" rows="6" name="params"></textarea></div><button class="sugar-rest-load">Load</button></details><span><button class="debug-sugar-nude">Nude</button></span><hr /><textarea id="debug-status" cols="80" rows=10" ></textarea></div>'};
templ.ydn.crm.inj.tabContent=function(a,b){return'<div id="tab-content-internal"><div id="home-panel" style="display: none;"><div class="home-panel-greeting">Welcome to YDN!</div><div class="home-panel-message">Welcome to YDN!</div><div class="home-panel-more"></div></div><div style="display: none;">Search</div><div  style="display: none;">Feed</div><div id="setting-panel">'+templ.ydn.crm.inj.mainLoginPanel(null)+'<div><a href="'+soy.$$escapeHtml(a.option_page)+'">More settings</a></div></div></div>'};
templ.ydn.crm.inj.panel=function(a,b){return'<div id="ydn-tabbar" class="goog-tab-bar goog-tab-bar-top"><div  class="goog-tab goog-tab-selected"><div title="Home" class="home"></div></div><div class="goog-tab"><div title="Search" class="search"></div></div><div class="goog-tab"><div title="Feed" class="feed"></div></div><div class="goog-tab"><div title="Setting" class="setting"></div></div>\x3c!-- Use goog-tab-bar-clear to separate the tabs from the content. --\x3e<div class="goog-tab-bar-clear"></div><div id="tabbar_content" class="goog-tab-content"></div></div>'};
templ.ydn.crm.inj.mainLoginPanel=function(a,b){return'<div class="main-login"><div><span id="user-name"></span><a id="user-login" target="crm-ex">login</a></div><p class="login-message">Login to Yathit: Gmail-to-SugarCrm extension to get started.</p></div>'};templ.ydn.crm.inj.sugarLoginPanel=function(a,b){return'<div class="sugar-login"><div><div>Enter your SugarCRM web site url</div><div><input name="domain" type="text" placeholder="https://tocahz5358.sugarcrm.com"/></div></div><div><div>Username</div><div><input name="username" type="text"/></div></div><div><div>Password</div><div><input name="password" type="password"/></div></div><div><div class="message"></div></div><div><button name="login">Login</button></div></div>'};
templ.ydn.crm.inj.sugarSetupPanel=function(a,b){return'<details><summary>Setup SugarCRM</summary><div class="sugar-setup"><p class="domain"><div><label>Enter your SugarCRM web site url</label></div><div><input name="domain" type="text" placeholder="https://test.sugarcrm.com/index.php" /><span class="message"></span></div></p><p class="username"><div><label>Username</label></div><div><input name="username" type="text"/></div></p><p class="password"><div><label>Password</label></div><div><input name="password" type="password"/></div></p><p><div class="message"></div></p><p><button name="login">Login</button></p></div></details>'};ydn.crm.inj={};ydn.crm.ui={};ydn.crm.ui.Debug=function(){this.ele_status=this.root=null;this.sugar=ydn.msg.getChannel(ydn.msg.Group.SUGAR,"test.example.com")};ydn.crm.ui.Debug.prototype.logger=goog.debug.Logger.getLogger("ydn.crm.ui.Debug");ydn.crm.ui.Debug.DEBUG=goog.DEBUG;
ydn.crm.ui.Debug.prototype.status=function(a){this.ele_status&&!ydn.crm.ui.Debug.DEBUG||window.console.log(a);this.ele_status&&(goog.isObject(a)?a=JSON.stringify(a,null,2):goog.isString(a)&&"{"==a.charAt(0)&&(a=JSON.parse(a),a=JSON.stringify(a,null,2)),this.ele_status.textContent=a)};
ydn.crm.ui.Debug.prototype.renderParams=function(a){if("get_entry_list"==a)a={query:"",order_by:"",offset:0,select_fields:[],link_name_to_fields_array:[],max_results:2,deleted:0,Favorites:!1};else if("get_available_modules"==a)a={filter:""};else if("get_entries"==a)a={ids:[],select_fields:[],link_name_to_fields_array:[]};else if("get_module_fields"==a)a={fields:[]};else throw Error(a);goog.dom.getElementByClass("sugar-rest-params",this.root).value=JSON.stringify(a,null,2)};
ydn.crm.ui.Debug.prototype.init=function(a){if(this.root=a){goog.soy.renderElement(this.root,templ.ydn.crm.inj.debug);this.ele_status=document.getElementById("debug-status");goog.dom.getElementByClass("debug-greet",this.root);goog.events.listen(goog.dom.getElementByClass("debug-sugar-nude",this.root),"click",function(a){ydn.db.deleteDatabase(ydn.crm.data.db.getName(),ydn.crm.data.db.getType())},!0,this);goog.events.listen(goog.dom.getElementByClass("sugar-rest-method",this.root),goog.events.EventType.CHANGE,
function(a){this.renderParams(goog.dom.getElementByClass("sugar-rest-method",this.root).value)},!0,this);a=goog.dom.getElementByClass("sugar-rest-load",this.root);goog.events.listen(a,"click",function(a){try{var b=JSON.parse(goog.dom.getElementByClass("sugar-rest-params",this.root).value),c;for(c in b){var d=b[c];(goog.isString(d)&&goog.string.isEmpty(d)||goog.isArray(d)&&0==d.length)&&delete b[c]}}catch(k){throw this.status("Invalid params values"),k;}b.module_name=goog.dom.getElementByClass("sugar-rest-module",
this.root).value;this.sugar.send(ydn.crm.Ch.SReq.REST,{method:goog.dom.getElementByClass("sugar-rest-method",this.root).value,params:b}).addCallback(function(a){this.status(a)},this)},!1,this);this.renderParams("get_entry_list");a=document.getElementById("debug-channel");var b=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.BUTTON,null,a)[0],c=a.querySelector("select"),d=a.querySelector("textarea");goog.events.listen(c,goog.events.EventType.CHANGE,function(a){c.value==ydn.crm.Ch.Req.GDATA_FETCH?
d.value=ydn.gdata.Kind.M8_CONTACT:c.value==ydn.crm.Ch.Req.GDATA_LIST_CONTACT_BY_EMAIL?d.value="kyawtuns@gmail.com":c.value==ydn.crm.Ch.SReq.LIST_MODULE?d.value="":c.value==ydn.crm.Ch.SReq.INFO_MODULE?d.value="Contacts":c.value==ydn.crm.Ch.SReq.LIST&&(d.value="kyawtuns@gmail.com")},!1,this);goog.events.listen(b,"click",function(a){a=c.value;var b=d.value,b="{"==b.charAt(0)?JSON.parse(b):b;this.sugar.send(a,b).addBoth(function(a){this.status(a)},this)},!0,this)}};
ydn.crm.ui.Debug.prototype.testService=function(){this.logger.finest("testing service");var a="ok"+goog.now();ydn.msg.getChannel().send(ydn.crm.Ch.Req.ECHO,a).addCallbacks(function(b){b==a&&(b="inj.Main "+ydn.crm.version+" ready.",this.logger.info(b));this.status(b)},function(a){this.status("test fail "+a.message)},this)};ydn.crm.app.Page=function(){ydn.crm.app.App.call(this)};goog.inherits(ydn.crm.app.Page,ydn.crm.app.App);ydn.crm.app.Page.prototype.logger=goog.debug.Logger.getLogger("ydn.crm.app.Page");ydn.crm.app.Page.prototype.init=function(a){ydn.crm.app.Page.superClass_.init.call(this,a);a=goog.soy.renderAsElement(templ.ydn.crm.app.body,{theme:this.setting.theme,editable:!0});document.body.appendChild(a);a=new ydn.crm.ui.Debug;var b=document.getElementById("section-debug");a.init(b)};
ydn.crm.app.Page.runApp=function(){goog.DEBUG&&ydn.crm.shared.log();var a=new ydn.crm.app.Page;window.onerror=function(b,c,d){c&&(b+=" on "+d+" of "+c);a.logger.warning(b)};return a};ydn.crm.app.EventPage=function(){ydn.crm.app.Page.call(this);this.ports_={};this.listenConnection_()};goog.inherits(ydn.crm.app.EventPage,ydn.crm.app.Page);ydn.crm.app.EventPage.prototype.logger=goog.debug.Logger.getLogger("ydn.crm.app.EventPage");ydn.crm.app.EventPage.prototype.init=function(a){ydn.crm.app.EventPage.superClass_.init.call(this,a)};
ydn.crm.app.EventPage.prototype.handleMainChannel_=function(a,b){var c=b.req;b.done=!0;this.logger.finer("service req: "+c+":"+b.id);var d=this;if(c==ydn.crm.Ch.Req.ECHO)this.logger.finer("resp: "+c+":"+b.id),a.postMessage(b);else if(c==ydn.crm.Ch.Req.LIST_SUGAR){var c=[],e;for(e in this.sugars)c.push(this.sugars[e].about());d.logger.finer("resp: "+b.req+":"+b.id);b.data=c;a.postMessage(b)}else if(c==ydn.crm.Ch.Req.GDATA_FETCH)e=b.data,e==ydn.gdata.Kind.M8_CONTACT?this.getGDataContact()?this.getGDataContact().fetch().addCallbacks(function(b){this.data=
b;a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},b):(b.error="gdata not ready",a.postMessage(b)):(b.error="invalid kind "+e,a.postMessage(b));else if(c==ydn.crm.Ch.Req.GDATA_LIST_CONTACT_BY_EMAIL)this.gdata_contact.getContactsByEmail(b.data).addCallback(function(b){d.logger.finer("resp: "+this.req+":"+this.id);this.data=b;a.postMessage(this)},b);else if(c==ydn.crm.Ch.Req.GDATA_TOKEN)this.getOAuthToken(b.data).addBoth(function(b){d.logger.finer("resp: "+this.req+":"+this.id);this.data=
b;a.postMessage(this)},b);else if(c==ydn.crm.Ch.Req.LOG)ydn.debug.ILogger.log(b.data),a.postMessage(b);else if(c==ydn.crm.Ch.Req.LOGIN_INFO)this.doLogin(b.data).addCallbacks(function(b){d.logger.finer("resp: "+this.req+":"+this.id);this.data=b;a.postMessage(this)},function(b){this.data=b;this.error="invalid login";a.postMessage(this)},b);else if(c==ydn.crm.Ch.Req.LOGOUT)d.logout(),a.postMessage(b);else if(c==ydn.crm.Ch.Req.NEW_ENTRY)goog.isObject(b.data)?this.getGDataContact().newEntry(b.data).addCallbacks(function(b){d.logger.finer("resp: "+
this.req+":"+this.id);this.data=b;a.postMessage(this)},function(b){this.data=b;this.error="failed to create a new entry";a.postMessage(this)},b):(b.error="Invalid gdata entry data",a.postMessage(b));else if(c==ydn.crm.Ch.Req.NEW_SUGAR)this.initSugarClient(b.data).addCallbacks(function(b){d.logger.finer("resp: "+this.req+":"+this.id);this.data=!0;a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},b);else if(c==ydn.crm.Ch.Req.SUGAR_SERVER_INFO)e=b.data,goog.asserts.assertString(e),e=
/https?:/.test(e)?new goog.Uri(e):(new goog.Uri).setDomain(e),(e=d.sugars[e.getDomain()])?e.getServerInfo().addCallback(function(b){d.logger.finer("resp: "+this.req+":"+this.id);this.data=b;a.postMessage(this)},b):ydn.crm.sugar.Client.sniffServerInfo(b.data).addCallbacks(function(b){d.logger.finer("resp: "+this.req+":"+this.id);this.data=b;a.postMessage(this)},function(b){d.logger.finer("resp error: "+this.req+":"+this.id+" "+b);this.error=b;a.postMessage(this)},b);else if(c==ydn.crm.Ch.Req.UPDATE_HOST_PERMISSION){for(var f in this.sugars)this.sugars[f].updateClient();
a.postMessage(b)}else c==ydn.crm.Ch.Req.REMOVE_SUGAR?this.removeSugarClient(b.data).addBoth(function(b){this.data=b;a.postMessage(this)},b):this.logger.warning("Main channel unknown req: "+c)};
ydn.crm.app.EventPage.prototype.handleSugarChannel_=function(a,b,c){var d=c.req;c.done=!0;this.logger.fine("sugar service req: "+b+":"+d+":"+c.id);var e=this;if(e.isLogin())if(d==ydn.crm.Ch.SReq.ABOUT)c.data=b.about(),a.postMessage(c);else if(d==ydn.crm.Ch.SReq.DETAILS)b.getDetails().addCallbacks(function(b){e.logger.finer("resp: "+this.req+":"+this.id);this.data=b;a.postMessage(this)},function(b){e.logger.finer("resp error: "+this.req+":"+this.id+" "+b);this.error=b;a.postMessage(this)},c);else if(d==
ydn.crm.Ch.SReq.LOGIN)this.initSugarClient(c.data).addCallbacks(function(b){this.data=b;a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},c);else if(d==ydn.crm.Ch.Req.ECHO)a.postMessage(c);else if(d==ydn.crm.Ch.SReq.GET)b.getEntry(c.data).addCallbacks(function(b){this.data=b;a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},c);else if(d==ydn.crm.Ch.SReq.FETCH_MODULE)b.updateModule(c.data).addCallbacks(function(b){e.logger.finer("resp: "+this.req+":"+this.id+" "+b);
this.data=b;a.postMessage(this)},function(b){e.logger.finer("resp error: "+this.req+":"+this.id+" "+b);this.error=b;a.postMessage(this)},c);else if(d==ydn.crm.Ch.SReq.INFO_MODULE)b.getModuleFields(c.data).addCallbacks(function(b){this.data=b;e.logger.finer("resp: "+this.req+":"+this.id);a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},c);else if(d==ydn.crm.Ch.SReq.IMPORT_GDATA){var f=c.data,g=f?f["gdata-id"]:"";g?ydn.crm.sugar.isValidModule(f.module)?e.getGDataContact().get(g).addCallbacks(function(c){var d=
ydn.crm.sugar.toModuleName(this.data.module);c?b.putGData(d,c).addCallbacks(function(b){b&&b.id?this.data=b:this.error="Set Entry to "+this.module+" failed";a.postMessage(this)},function(b){this.error=JSON.stringify(b);a.postMessage(this)},this):(this.error="contact entry "+this.data+" not found",a.postMessage(this))},function(a){throw a;},c):(e.logger.warning("resp error: "+d+":"+c.id),c.error="invalid module name "+f.module,a.postMessage(c)):(e.logger.warning("resp error: "+d+":"+c.id),c.error=
"gdata id required",a.postMessage(c))}else d==ydn.crm.Ch.SReq.LINK?(d=this.getGDataContact(),(f=c.data["gdata-id"])?(g=c.data["external-id"])&&g.label&&g.value?d.patchExternalId(f,g.label,g.value).addCallbacks(function(b){this.data=b;a.postMessage(this)},function(b){e.logger.warning("error linking gdata "+this.req+":"+this.id);this.error="error "+b;a.postMessage(this)},c):(c.error="invalid external_id",a.postMessage(c)):(c.error="gdata-id not required",a.postMessage(c))):d==ydn.crm.Ch.SReq.LIST?b.list(c.data).addCallbacks(function(b){e.logger.finer("resp: "+
this.req+":"+this.id);this.data=b;a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},c):d==ydn.crm.Ch.SReq.LIST_MODULE?b.getAvailableModules().addCallbacks(function(b){e.logger.finer("resp: "+this.req+":"+this.id);this.data=b;e.logger.finer("resp: "+this.req+":"+this.id);a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},c):d==ydn.crm.Ch.SReq.NEW_RECORD?(d=c.data.module)?(f=c.data.record,goog.isObject(f)?b.putEntry(d,f).addCallbacks(function(b){this.data=b;e.logger.finer("resp: "+
this.req+":"+this.id);a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},c):(c.error="record object required",a.postMessage(c))):(c.error="module required",a.postMessage(c)):d==ydn.crm.Ch.SReq.SERVER_INFO?b.getServerInfo().addCallbacks(function(b){e.logger.finer("resp: "+this.req+":"+this.id);this.data=b;a.postMessage(this)},function(b){e.logger.finer("resp error: "+this.req+":"+this.id+" "+b);this.error=b;a.postMessage(this)},c):d==ydn.crm.Ch.SReq.SYNC_ENTRY?(f=c.data,this.gdata_contact.get(f).addCallbacks(function(b){b?
new ydn.gdata.m8.ContactEntry(b):(b="GData entry "+this.data+" not found.",e.logger.finer(b),this.error=b,a.postMessage(this))},function(b){e.logger.finer("resp error: "+this.req+":"+this.id+" "+b);this.error=b;a.postMessage(this)},c)):d==ydn.crm.Ch.SReq.REST?(g=c.data,goog.isObject(g)?(f=g.method,g=g.params,goog.isString(f)&&0!=f.length?goog.isObject(g)?b.rest(f,g).addCallbacks(function(b){this.data=b;e.logger.finer("resp: "+this.req+":"+this.id);a.postMessage(this)},function(b){this.error=b;a.postMessage(this)},
c):(c.error="REST parameter must be an object",e.logger.finer("resp: error "+d+":"+c.id),a.postMessage(c)):(c.error="method must be valid string",e.logger.finer("resp: error "+d+":"+c.id),a.postMessage(c))):(c.error="REST parameter must be an object",e.logger.finer("resp: error "+d+":"+c.id),a.postMessage(c))):d==ydn.crm.Ch.Req.UPDATE_HOST_PERMISSION?b.updateClient().addBoth(function(b){this.data=b;a.postMessage(this)},c):this.logger.warning(b+" unknown req: "+d);else c.error="Not login",a.postMessage(c)};
ydn.crm.app.EventPage.prototype.listenConnection_=function(){var a=this;chrome.runtime.onConnect.addListener(function(b){var c=b.sender.url;goog.string.startsWith(b.name,"main")?(a.logger.info("Channel "+b.name+" connected for "+c),b.onMessage.addListener(function(c){if(c.id)if(c.group==ydn.msg.Group.SUGAR){var e=c.name,f=a.sugars[e];f?a.handleSugarChannel_(b,f,c):a.logger.warning("SugarCRM instance "+e+" not found.")}else if(c.group==ydn.msg.Group.GMAIL)for(f in a.ports_)e=a.ports_[f],e.group!=f||
c.name&&c.name!=e.name||e.port.postMessage(c);else a.handleMainChannel_(b,c);else c.req==ydn.msg.RReq.INFO&&(f=c.data.group,0<=[ydn.msg.Group.GMAIL].indexOf(f)?a.ports_[b.name]={name:c.data.name,group:f,port:b}:a.logger.warning("Unknown group in pipe info "+f+" from "+b.name))}),b.onDisconnect.addListener(function(c){a.logger.info("disconnected "+b.name);delete a.ports_[b.name]}),b.postMessage({req:ydn.msg.RReq.INFO})):a.logger.warning("channel "+b.name+" ignored")});this.logger.info("event page start listening incoming connection")};
ydn.crm.app.EventPage.runApp=function(){goog.DEBUG&&(ydn.debug.log("ydn.crm","finest"),ydn.debug.log("ydn.ds","finer"));var a=new ydn.crm.app.EventPage;a.init(null);a.run();return a};goog.exportSymbol("runApp",ydn.crm.app.EventPage.runApp);ydn.debug.exports={};goog.DEBUG&&goog.exportSymbol("ydn.debug.log",ydn.debug.log);ydn.crm.exports={};goog.exportSymbol("ydn.crm.shared.setSetting",ydn.crm.shared.setSetting);goog.exportSymbol("ydn.crm.version",ydn.crm.version);goog.exportProperty(ydn.msg.Pipe.prototype,"listen",ydn.msg.Pipe.prototype.listen);goog.exportSymbol("ydn.msg.getChannel",ydn.msg.getChannel);goog.exportProperty(ydn.msg.Channel.prototype,"send",ydn.msg.Channel.prototype.send);goog.exportSymbol("goog.async.Deferred",goog.async.Deferred);goog.exportProperty(goog.async.Deferred.prototype,"addCallback",goog.async.Deferred.prototype.addCallback);
goog.exportProperty(goog.async.Deferred.prototype,"addErrback",goog.async.Deferred.prototype.addErrback);goog.exportProperty(goog.async.Deferred.prototype,"addBoth",goog.async.Deferred.prototype.addBoth);goog.exportProperty(goog.async.Deferred.prototype,"addCallbacks",goog.async.Deferred.prototype.addCallbacks);})();
