(function(){var h,aa=aa||{},q=this;function t(a){return void 0!==a}function ba(a){a=a.split(".");for(var b=q,c;c=a.shift();)if(null!=b[c])b=b[c];else return null;return b}function ca(){}function da(a){a.T=function(){return a.Sg?a.Sg:a.Sg=new a}}
function ea(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function u(a){return"array"==ea(a)}function fa(a){var b=ea(a);return"array"==b||"object"==b&&"number"==typeof a.length}function v(a){return"string"==typeof a}function ga(a){return"boolean"==typeof a}function ha(a){return"number"==typeof a}function ia(a){return"function"==ea(a)}function x(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function ja(a){return a[ka]||(a[ka]=++la)}
var ka="closure_uid_"+(1E9*Math.random()>>>0),la=0;function ma(a,b,c){return a.call.apply(a.bind,arguments)}function na(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function oa(a,b,c){oa=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ma:na;return oa.apply(null,arguments)}function pa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var z=Date.now||function(){return+new Date};
function qa(a,b){var c=a.split("."),d=q;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&t(b)?d[e]=b:d[e]?d=d[e]:d=d[e]={}}function A(a,b){function c(){}c.prototype=b.prototype;a.m=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Dj=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};function ra(a){a.prototype.then=a.prototype.then;a.prototype.$goog_Thenable=!0}function sa(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}};function ta(a){if(Error.captureStackTrace)Error.captureStackTrace(this,ta);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}A(ta,Error);ta.prototype.name="CustomError";var va;function wa(a,b){return 0==a.lastIndexOf(b,0)}function xa(a,b){var c=a.length-b.length;return 0<=c&&a.indexOf(b,c)==c}function ya(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}function za(a){return/^[\s\xa0]*$/.test(a)}function Aa(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")}function Ba(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}
function Ca(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")}function Da(a){if(!Ea.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Fa,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Ga,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Ha,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ia,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ja,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(Ka,"&#0;"));return a}var Fa=/&/g,Ga=/</g,Ha=/>/g,Ia=/"/g,Ja=/'/g,Ka=/\x00/g,Ea=/[\x00&<>"']/;
function La(a){return Ca(a.replace(/  /g," &#160;"),void 0)}function Ma(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a}var Na={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"},Oa={"'":"\\'"};
function Pa(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0),f=c+1,g;if(!(g=Na[d])){if(!(31<e&&127>e))if(d in Oa)d=Oa[d];else if(d in Na)d=Oa[d]=Na[d];else{e=d;g=d.charCodeAt(0);if(31<g&&127>g)e=d;else{if(256>g){if(e="\\x",16>g||256<g)e+="0"}else e="\\u",4096>g&&(e+="0");e+=g.toString(16).toUpperCase()}d=Oa[d]=e}g=d}b[f]=g}b.push('"');return b.join("")}function Qa(a,b){return-1!=a.indexOf(b)}function Ra(a,b){return a<b?-1:a>b?1:0}
function Sa(){return"transform".replace(/\-([a-z])/g,function(a,b){return b.toUpperCase()})}function Ta(a){var b=v(void 0)?"undefined".replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};function Ua(a,b){b.unshift(a);ta.call(this,ya.apply(null,b));b.shift()}A(Ua,ta);Ua.prototype.name="AssertionError";function Va(a,b){throw new Ua("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};function Wa(a){q.setTimeout(function(){throw a;},0)}var Xa;
function Ya(){if(q.Promise&&q.Promise.resolve){var a=q.Promise.resolve();return function(b){a.then(function(){try{b()}catch(a){Wa(a)}})}}var b=q.MessageChannel;"undefined"===typeof b&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&(b=function(){var a=document.createElement("iframe");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d=b.location.protocol+
"//"+b.location.host,a=oa(function(a){if(a.origin==d||a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof b){var c=new b,d={},e=d;c.port1.onmessage=function(){d=d.next;var a=d.sg;d.sg=null;a()};return function(a){e.next={sg:a};e=e.next;c.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("script")?function(a){var b=document.createElement("script");
b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){q.setTimeout(a,0)}};function Za(a,b){if(!$a){var c=ab;ia(q.setImmediate)?q.setImmediate(c):(Xa||(Xa=Ya()),Xa(c));$a=!0}bb.push(new cb(a,b))}var $a=!1,bb=[];[].push(function(){$a=!1;bb=[]});function ab(){for(;bb.length;){var a=bb;bb=[];for(var b=0;b<a.length;b++){var c=a[b];try{c.g.call(c.h)}catch(d){Wa(d)}}}$a=!1}function cb(a,b){this.g=a;this.h=b};function db(a,b){this.h=eb;this.o=void 0;this.g=this.i=null;this.j=this.l=!1;try{var c=this;a.call(b,function(a){fb(c,gb,a)},function(a){fb(c,hb,a)})}catch(d){fb(this,hb,d)}}var eb=0,gb=2,hb=3;db.prototype.then=function(a,b,c){return ib(this,ia(a)?a:null,ia(b)?b:null,c)};ra(db);function jb(a){a.h==eb&&Za(function(){var a=new kb(void 0);lb(this,a)},a)}
function lb(a,b){if(a.h==eb)if(a.i){var c=a.i;if(c.g){for(var d=0,e=-1,f=0,g;g=c.g[f];f++)if(g=g.Jd)if(d++,g==a&&(e=f),0<=e&&1<d)break;0<=e&&(c.h==eb&&1==d?lb(c,b):(d=c.g.splice(e,1)[0],mb(c,d,hb,b)))}}else fb(a,hb,b)}function nb(a,b){a.g&&a.g.length||a.h!=gb&&a.h!=hb||ob(a);a.g||(a.g=[]);a.g.push(b)}
function ib(a,b,c,d){var e={Jd:null,Zg:null,dh:null};e.Jd=new db(function(a,g){e.Zg=b?function(c){try{var e=b.call(d,c);a(e)}catch(m){g(m)}}:a;e.dh=c?function(b){try{var e=c.call(d,b);!t(e)&&b instanceof kb?g(b):a(e)}catch(m){g(m)}}:g});e.Jd.i=a;nb(a,e);return e.Jd}db.prototype.p=function(a){this.h=eb;fb(this,gb,a)};db.prototype.u=function(a){this.h=eb;fb(this,hb,a)};
function fb(a,b,c){if(a.h==eb){if(a==c)b=hb,c=new TypeError("Promise cannot resolve to itself");else{if(sa(c)){a.h=1;c.then(a.p,a.u,a);return}if(x(c))try{var d=c.then;if(ia(d)){pb(a,c,d);return}}catch(e){b=hb,c=e}}a.o=c;a.h=b;ob(a);b!=hb||c instanceof kb||qb(a,c)}}function pb(a,b,c){function d(b){f||(f=!0,a.u(b))}function e(b){f||(f=!0,a.p(b))}a.h=1;var f=!1;try{c.call(b,e,d)}catch(g){d(g)}}function ob(a){a.l||(a.l=!0,Za(a.I,a))}
db.prototype.I=function(){for(;this.g&&this.g.length;){var a=this.g;this.g=[];for(var b=0;b<a.length;b++)mb(this,a[b],this.h,this.o)}this.l=!1};function mb(a,b,c,d){if(c==gb)b.Zg(d);else{for(;a&&a.j;a=a.i)a.j=!1;b.dh(d)}}function qb(a,b){a.j=!0;Za(function(){a.j&&rb.call(null,b)})}var rb=Wa;function kb(a){ta.call(this,a)}A(kb,ta);kb.prototype.name="cancel";var sb=Array.prototype,tb=sb.indexOf?function(a,b,c){return sb.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(v(a))return v(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},ub=sb.lastIndexOf?function(a,b,c){return sb.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(v(a))return v(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;
return-1},vb=sb.forEach?function(a,b,c){sb.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},wb=sb.filter?function(a,b,c){return sb.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=v(a)?a.split(""):a,k=0;k<d;k++)if(k in g){var l=g[k];b.call(c,l,k,a)&&(e[f++]=l)}return e},xb=sb.map?function(a,b,c){return sb.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=v(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=
b.call(c,f[g],g,a));return e},yb=sb.some?function(a,b,c){return sb.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},zb=sb.every?function(a,b,c){return sb.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};function Ab(a,b){var c=Bb(a,b,void 0);return 0>c?null:v(a)?a.charAt(c):a[c]}
function Bb(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Cb(a,b){return 0<=tb(a,b)}function Db(a){if(!u(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Eb(a,b){var c=tb(a,b),d;(d=0<=c)&&sb.splice.call(a,c,1);return d}function Fb(a){return sb.concat.apply(sb,arguments)}function Gb(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}
function Hb(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(u(d)||(e=fa(d))&&Object.prototype.hasOwnProperty.call(d,"callee"))a.push.apply(a,d);else if(e)for(var f=a.length,g=d.length,k=0;k<g;k++)a[f+k]=d[k];else a.push(d)}}function Ib(a,b,c,d){sb.splice.apply(a,Jb(arguments,1))}function Jb(a,b,c){return 2>=arguments.length?sb.slice.call(a,b):sb.slice.call(a,b,c)}function Kb(a,b,c){for(var d=0,e=a.length,f;d<e;){var g=d+e>>1,k;k=b(c,a[g]);0<k?d=g+1:(e=g,f=!k)}return f?d:~d}
function Lb(a,b){if(!fa(a)||!fa(b)||a.length!=b.length)return!1;for(var c=a.length,d=Mb,e=0;e<c;e++)if(!d(a[e],b[e]))return!1;return!0}function Nb(a,b){return a>b?1:a<b?-1:0}function Mb(a,b){return a===b}function Ob(a,b){var c=Kb(a,Pb||Nb,b);0>c&&Ib(a,-(c+1),0,b)};/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
function B(a,b){this.u=[];this.bb=a;this.M=b||null;this.l=this.h=!1;this.j=void 0;this.Y=this.aa=this.I=!1;this.o=0;this.i=null;this.N=0}function Qb(a,b){if(a.h)a.j instanceof B&&Qb(a.j);else{if(a.i){var c=a.i;delete a.i;b?Qb(c,b):(c.N--,0>=c.N&&Qb(c))}a.bb?a.bb.call(a.M,a):a.Y=!0;a.h||a.F(new Rb)}}h=B.prototype;h.Ld=function(a,b){this.I=!1;Sb(this,a,b)};function Sb(a,b,c){a.h=!0;a.j=c;a.l=!b;a.Ye()}function Tb(a){if(a.h){if(!a.Y)throw new Ub;a.Y=!1}}h.callback=function(a){Tb(this);Sb(this,!0,a)};
h.F=function(a){Tb(this);Sb(this,!1,a)};h.w=function(a,b){return this.A(a,null,b)};h.Vc=function(a,b){return this.A(null,a,b)};h.fa=function(a,b){return this.A(a,a,b)};h.A=function(a,b,c){this.u.push([a,b,c]);this.h&&this.Ye();return this};h.then=function(a,b,c){var d,e,f=new db(function(a,b){d=a;e=b});this.A(d,function(a){a instanceof Rb?jb(f):e(a)});return f.then(a,b,c)};ra(B);function Vb(a,b){a.A(b.callback,b.F,b)}function Wb(a){var b=new B;Vb(a,b);return b}
function Xb(a){return yb(a.u,function(a){return ia(a[1])})}
B.prototype.Ye=function(){this.o&&this.h&&Xb(this)&&(Yb(this.o),this.o=0);this.i&&(this.i.N--,delete this.i);for(var a=this.j,b=!1,c=!1;this.u.length&&!this.I;){var d=this.u.shift(),e=d[0],f=d[1],d=d[2];if(e=this.l?f:e)try{var g=e.call(d||this.M,a);t(g)&&(this.l=this.l&&(g==a||g instanceof Error),this.j=a=g);sa(a)&&(this.I=c=!0)}catch(k){a=k,this.l=!0,Xb(this)||(b=!0)}}this.j=a;c&&(c=oa(this.Ld,this,!0),g=oa(this.Ld,this,!1),a instanceof B?(a.A(c,g),a.aa=!0):a.then(c,g));b&&(a=new Zb(a),$b[a.$d]=
a,this.o=a.$d)};function ac(a){var b=new B;b.callback(a);return b}function bc(a){var b=new B;b.F(a);return b}function Ub(){ta.call(this)}A(Ub,ta);Ub.prototype.message="Deferred has already fired";Ub.prototype.name="AlreadyCalledError";function Rb(){ta.call(this)}A(Rb,ta);Rb.prototype.message="Deferred was canceled";Rb.prototype.name="CanceledError";function Zb(a){this.$d=q.setTimeout(oa(this.h,this),0);this.g=a}Zb.prototype.h=function(){delete $b[this.$d];throw this.g;};var $b={};
function Yb(a){var b=$b[a];b&&(q.clearTimeout(b.$d),delete $b[a])};function cc(){0!=dc&&(ec[ja(this)]=this)}var dc=0,ec={};cc.prototype.I=!1;cc.prototype.ca=function(){if(!this.I&&(this.I=!0,this.H(),0!=dc)){var a=ja(this);delete ec[a]}};cc.prototype.H=function(){if(this.bb)for(;this.bb.length;)this.bb.shift()()};function fc(a){a&&"function"==typeof a.ca&&a.ca()};var gc;a:{var hc=q.navigator;if(hc){var ic=hc.userAgent;if(ic){gc=ic;break a}}gc=""};var jc,kc;function lc(){return q.navigator||null}var mc=Qa(gc,"Opera")||Qa(gc,"OPR"),C=Qa(gc,"Trident")||Qa(gc,"MSIE"),nc=Qa(gc,"Gecko")&&!Qa(gc.toLowerCase(),"webkit")&&!(Qa(gc,"Trident")||Qa(gc,"MSIE")),oc=Qa(gc.toLowerCase(),"webkit");oc&&Qa(gc,"Mobile");var pc,qc=lc();pc=qc&&qc.platform||"";jc=Qa(pc,"Mac");Qa(pc,"Win");Qa(pc,"Linux");kc=!!lc()&&Qa(lc().appVersion||"","X11");var rc=gc;rc&&Qa(rc,"Android");rc&&Qa(rc,"iPhone");rc&&Qa(rc,"iPad");
function sc(){var a=q.document;return a?a.documentMode:void 0}var tc=function(){var a="",b;if(mc&&q.opera)return a=q.opera.version,ia(a)?a():a;nc?b=/rv\:([^\);]+)(\)|;)/:C?b=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:oc&&(b=/WebKit\/(\S+)/);b&&(a=(a=b.exec(gc))?a[1]:"");return C&&(b=sc(),b>parseFloat(a))?String(b):a}(),uc={};
function vc(a){var b;if(!(b=uc[a])){b=0;for(var c=Ba(String(tc)).split("."),d=Ba(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",k=d[f]||"",l=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var n=l.exec(g)||["","",""],p=m.exec(k)||["","",""];if(0==n[0].length&&0==p[0].length)break;b=Ra(0==n[1].length?0:parseInt(n[1],10),0==p[1].length?0:parseInt(p[1],10))||Ra(0==n[2].length,0==p[2].length)||Ra(n[2],p[2])}while(0==b)}b=uc[a]=0<=b}return b}
var wc=q.document,xc=wc&&C?sc()||("CSS1Compat"==wc.compatMode?parseInt(tc,10):5):void 0;var yc=!C||C&&9<=xc,zc=!C||C&&9<=xc,Ac=C&&!vc("9");!oc||vc("528");nc&&vc("1.9b")||C&&vc("8")||mc&&vc("9.5")||oc&&vc("528");nc&&!vc("8")||C&&vc("9");function E(a,b){this.type=a;this.i=this.target=b;this.p=this.l=!1;this.hh=!0}E.prototype.ca=function(){};E.prototype.j=function(){this.l=!0};E.prototype.preventDefault=function(){this.p=!0;this.hh=!1};function Bc(a){Bc[" "](a);return a}Bc[" "]=ca;function Cc(a,b){E.call(this,a?a.type:"");this.o=this.i=this.target=null;this.g=this.clientY=this.clientX=0;this.u=this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.h=null;a&&this.init(a,b)}A(Cc,E);var Dc=[1,4,2];
Cc.prototype.init=function(a,b){var c=this.type=a.type;this.target=a.target||a.srcElement;this.i=b;var d=a.relatedTarget;if(d){if(nc){var e;a:{try{Bc(d.nodeName);e=!0;break a}catch(f){}e=!1}e||(d=null)}}else"mouseover"==c?d=a.fromElement:"mouseout"==c&&(d=a.toElement);this.o=d;this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.g=a.keyCode||0;this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.u=jc?a.metaKey:
a.ctrlKey;this.h=a;a.defaultPrevented&&this.preventDefault()};function Ec(a){return(yc?0==a.h.button:"click"==a.type?!0:!!(a.h.button&Dc[0]))&&!(oc&&jc&&a.ctrlKey)}Cc.prototype.j=function(){Cc.m.j.call(this);this.h.stopPropagation?this.h.stopPropagation():this.h.cancelBubble=!0};Cc.prototype.preventDefault=function(){Cc.m.preventDefault.call(this);var a=this.h;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Ac)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Fc="closure_listenable_"+(1E6*Math.random()|0);function Gc(a){return!(!a||!a[Fc])}var Hc=0;function Ic(a,b,c,d,e){this.wc=a;this.proxy=null;this.src=b;this.type=c;this.Hd=!!d;this.Ha=e;this.key=++Hc;this.removed=this.Gd=!1}function Jc(a){a.removed=!0;a.wc=null;a.proxy=null;a.src=null;a.Ha=null};function Kc(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function Lc(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Mc(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Nc(a,b){for(var c=fa(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],t(a));c++);return a}function Oc(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');a[b]=c}function Pc(a,b){return b in a?a[b]:void 0}function Qc(a){var b={},c;for(c in a)b[a[c]]=c;return b}var Rc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Sc(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Rc.length;f++)c=Rc[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Tc(a){var b=arguments.length;if(1==b&&u(arguments[0]))return Tc.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c}
function Uc(a){var b=arguments.length;if(1==b&&u(arguments[0]))return Uc.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};function Vc(a){this.src=a;this.g={};this.h=0}Vc.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.g[f];a||(a=this.g[f]=[],this.h++);var g=Wc(a,b,d,e);-1<g?(b=a[g],c||(b.Gd=!1)):(b=new Ic(b,this.src,f,!!d,e),b.Gd=c,a.push(b));return b};Vc.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.g))return!1;var e=this.g[a];b=Wc(e,b,c,d);return-1<b?(Jc(e[b]),sb.splice.call(e,b,1),0==e.length&&(delete this.g[a],this.h--),!0):!1};
function Xc(a,b){var c=b.type;if(!(c in a.g))return!1;var d=Eb(a.g[c],b);d&&(Jc(b),0==a.g[c].length&&(delete a.g[c],a.h--));return d}Vc.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.g)if(!a||c==a){for(var d=this.g[c],e=0;e<d.length;e++)++b,Jc(d[e]);delete this.g[c];this.h--}return b};function Yc(a,b,c,d,e){a=a.g[b.toString()];b=-1;a&&(b=Wc(a,c,d,e));return-1<b?a[b]:null}
function Wc(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.wc==b&&f.Hd==!!c&&f.Ha==d)return e}return-1};var Zc="closure_lm_"+(1E6*Math.random()|0),$c={},ad=0;function cd(a,b,c,d,e){if(u(b)){for(var f=0;f<b.length;f++)cd(a,b[f],c,d,e);return null}c=dd(c);return Gc(a)?a.listen(b,c,d,e):ed(a,b,c,!1,d,e)}function ed(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,k=fd(a);k||(a[Zc]=k=new Vc(a));c=k.add(b,c,d,e,f);if(c.proxy)return c;d=gd();c.proxy=d;d.src=a;d.wc=c;a.addEventListener?a.addEventListener(b.toString(),d,g):a.attachEvent(hd(b.toString()),d);ad++;return c}
function gd(){var a=id,b=zc?function(c){return a.call(b.src,b.wc,c)}:function(c){c=a.call(b.src,b.wc,c);if(!c)return c};return b}function jd(a,b,c,d,e){if(u(b)){for(var f=0;f<b.length;f++)jd(a,b[f],c,d,e);return null}c=dd(c);return Gc(a)?a.Fb.add(String(b),c,!0,d,e):ed(a,b,c,!0,d,e)}function kd(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)kd(a,b[f],c,d,e);else c=dd(c),Gc(a)?a.ka(b,c,d,e):a&&(a=fd(a))&&(b=Yc(a,b,c,!!d,e))&&ld(b)}
function ld(a){if(ha(a)||!a||a.removed)return!1;var b=a.src;if(Gc(b))return Xc(b.Fb,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.Hd):b.detachEvent&&b.detachEvent(hd(c),d);ad--;(c=fd(b))?(Xc(c,a),0==c.h&&(c.src=null,b[Zc]=null)):Jc(a);return!0}function hd(a){return a in $c?$c[a]:$c[a]="on"+a}function md(a,b,c,d){var e=1;if(a=fd(a))if(b=a.g[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.Hd==c&&!f.removed&&(e&=!1!==nd(f,d))}return Boolean(e)}
function nd(a,b){var c=a.wc,d=a.Ha||a.src;a.Gd&&ld(a);return c.call(d,b)}
function id(a,b){if(a.removed)return!0;if(!zc){var c=b||ba("window.event"),d=new Cc(c,this),e=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(g){f=!0}if(f||void 0==c.returnValue)c.returnValue=!0}c=[];for(f=d.i;f;f=f.parentNode)c.push(f);for(var f=a.type,k=c.length-1;!d.l&&0<=k;k--)d.i=c[k],e&=md(c[k],f,!0,d);for(k=0;!d.l&&k<c.length;k++)d.i=c[k],e&=md(c[k],f,!1,d)}return e}return nd(a,new Cc(b,this))}
function fd(a){a=a[Zc];return a instanceof Vc?a:null}var od="__closure_events_fn_"+(1E9*Math.random()>>>0);function dd(a){return ia(a)?a:a[od]||(a[od]=function(b){return a.handleEvent(b)})};function pd(){cc.call(this);this.Fb=new Vc(this);this.hg=this;this.L=null}A(pd,cc);pd.prototype[Fc]=!0;h=pd.prototype;h.Sf=function(a){this.L=a};h.addEventListener=function(a,b,c,d){cd(this,a,b,c,d)};h.removeEventListener=function(a,b,c,d){kd(this,a,b,c,d)};
h.dispatchEvent=function(a){var b,c=this.L;if(c)for(b=[];c;c=c.L)b.push(c);var c=this.hg,d=a.type||a;if(v(a))a=new E(a,c);else if(a instanceof E)a.target=a.target||c;else{var e=a;a=new E(d,c);Sc(a,e)}var e=!0,f;if(b)for(var g=b.length-1;!a.l&&0<=g;g--)f=a.i=b[g],e=qd(f,d,!0,a)&&e;a.l||(f=a.i=c,e=qd(f,d,!0,a)&&e,a.l||(e=qd(f,d,!1,a)&&e));if(b)for(g=0;!a.l&&g<b.length;g++)f=a.i=b[g],e=qd(f,d,!1,a)&&e;return e};h.H=function(){pd.m.H.call(this);this.Fb&&this.Fb.removeAll(void 0);this.L=null};
h.listen=function(a,b,c,d){return this.Fb.add(String(a),b,!1,c,d)};h.ka=function(a,b,c,d){return this.Fb.remove(String(a),b,c,d)};function qd(a,b,c,d){b=a.Fb.g[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.removed&&g.Hd==c){var k=g.wc,l=g.Ha||g.src;g.Gd&&Xc(a.Fb,g);e=!1!==k.call(l,d)&&e}}return e&&!1!=d.hh};function rd(a,b,c){this.i=a;this.h=b;this.g=c;this.id=this.h+(this.g?"-"+this.g:"")}rd.prototype.send=function(a,b){var c=new sd(a),d=this.g;c.o=this.h;c.p=d;b&&(c.h=b);var d=c.j,e=this.i,f=c.toJSON();td(e).postMessage(f);e.g.push(c);50<e.g.length&&(e.g.length-=1);return d};function ud(a){E.call(this,a.req||"event");this.h=a}A(ud,E);ud.prototype.getMessage=function(){return this.h};ud.prototype.getData=function(){return this.h.data};function F(a){ta.call(this,a);this.name="ydn.error.ArgumentException"}A(F,ta);function vd(a){ta.call(this,a);this.name="ydn.error.NotSupportedException"}A(vd,ta);function wd(a){ta.call(this,a);this.name="ydn.error.NotImplementedException"}A(wd,ta);function xd(a){ta.call(this,a);this.name="ydn.error.InvalidOperationException"}A(xd,ta);
function yd(a){Error.captureStackTrace?Error.captureStackTrace(this,yd):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}A(yd,Error);yd.prototype.name="ydn.error.InternalError";function zd(a){if("function"==typeof a.Ca)return a.Ca();if(v(a))return a.split("");if(fa(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Lc(a)}
function Ad(a,b){if("function"==typeof a.forEach)a.forEach(b,void 0);else if(fa(a)||v(a))vb(a,b,void 0);else{var c;if("function"==typeof a.Pa)c=a.Pa();else if("function"!=typeof a.Ca)if(fa(a)||v(a)){c=[];for(var d=a.length,e=0;e<d;e++)c.push(e)}else c=Mc(a);else c=void 0;for(var d=zd(a),e=d.length,f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}};var Bd="StopIteration"in q?q.StopIteration:Error("StopIteration");function Cd(){}Cd.prototype.next=function(){throw Bd;};Cd.prototype.Tb=function(){return this};function Dd(a){if(a instanceof Cd)return a;if("function"==typeof a.Tb)return a.Tb(!1);if(fa(a)){var b=0,c=new Cd;c.next=function(){for(;;){if(b>=a.length)throw Bd;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");}
function Ed(a,b){if(fa(a))try{vb(a,b,void 0)}catch(c){if(c!==Bd)throw c;}else{a=Dd(a);try{for(;;)b.call(void 0,a.next(),void 0,a)}catch(d){if(d!==Bd)throw d;}}}function Fd(a){if(fa(a))return Gb(a);a=Dd(a);var b=[];Ed(a,function(a){b.push(a)});return b};function Gd(a,b){this.h={};this.g=[];this.j=this.i=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof Gd?(c=a.Pa(),d=a.Ca()):(c=Mc(a),d=Lc(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}h=Gd.prototype;h.ga=function(){return this.i};h.Ca=function(){Hd(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a};h.Pa=function(){Hd(this);return this.g.concat()};
h.Sa=function(){return 0==this.i};h.clear=function(){this.h={};this.j=this.i=this.g.length=0};h.remove=function(a){return Id(this.h,a)?(delete this.h[a],this.i--,this.j++,this.g.length>2*this.i&&Hd(this),!0):!1};function Hd(a){if(a.i!=a.g.length){for(var b=0,c=0;b<a.g.length;){var d=a.g[b];Id(a.h,d)&&(a.g[c++]=d);b++}a.g.length=c}if(a.i!=a.g.length){for(var e={},c=b=0;b<a.g.length;)d=a.g[b],Id(e,d)||(a.g[c++]=d,e[d]=1),b++;a.g.length=c}}h.get=function(a,b){return Id(this.h,a)?this.h[a]:b};
h.set=function(a,b){Id(this.h,a)||(this.i++,this.g.push(a),this.j++);this.h[a]=b};h.forEach=function(a,b){for(var c=this.Pa(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};h.clone=function(){return new Gd(this)};h.Tb=function(a){Hd(this);var b=0,c=this.g,d=this.h,e=this.j,f=this,g=new Cd;g.next=function(){for(;;){if(e!=f.j)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw Bd;var g=c[b++];return a?g:d[g]}};return g};
function Id(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function Jd(a){this.g=new Gd;if(a){a=zd(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])}}function Ld(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+ja(a):b.substr(0,1)+a}h=Jd.prototype;h.ga=function(){return this.g.ga()};h.add=function(a){this.g.set(Ld(a),a)};h.removeAll=function(a){a=zd(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};h.remove=function(a){return this.g.remove(Ld(a))};h.clear=function(){this.g.clear()};h.Sa=function(){return this.g.Sa()};
h.contains=function(a){a=Ld(a);return Id(this.g.h,a)};h.Ca=function(){return this.g.Ca()};h.clone=function(){return new Jd(this)};h.Tb=function(){return this.g.Tb(!1)};function Md(a){var b;b||(b=Nd(a||arguments.callee.caller,[]));return b}
function Nd(a,b){var c=[];if(Cb(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(Od(a)+"(");for(var d=a.arguments,e=0;d&&e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=Od(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(Nd(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?
c.push("[...long stack...]"):c.push("[end]");return c.join("")}function Od(a){if(Pd[a])return Pd[a];a=String(a);if(!Pd[a]){var b=/function ([^\(]+)/.exec(a);Pd[a]=b?b[1]:"[Anonymous]"}return Pd[a]}var Pd={};function Qd(a,b,c,d,e){this.o="number"==typeof e?e:Rd++;this.l=d||z();this.j=a;this.p=b;this.h=c;delete this.i;delete this.g}Qd.prototype.o=0;Qd.prototype.i=null;Qd.prototype.g=null;var Rd=0;Qd.prototype.getMessage=function(){return this.p};function Sd(a){this.l=a;this.g=this.j=this.h=this.i=null}function Td(a,b){this.name=a;this.value=b}Td.prototype.toString=function(){return this.name};var Ud=new Td("SHOUT",1200),Vd=new Td("SEVERE",1E3),Wd=new Td("WARNING",900),Xd=new Td("INFO",800),Yd=new Td("CONFIG",700),Zd=new Td("FINE",500),$d=new Td("FINER",400),ae=new Td("FINEST",300),be=[new Td("OFF",Infinity),Ud,Vd,Wd,Xd,Yd,Zd,$d,ae,new Td("ALL",0)],ce=null;h=Sd.prototype;h.getName=function(){return this.l};
function de(a,b){a.g||(a.g=[]);a.g.push(b)}h.getParent=function(){return this.i};h.getChildren=function(){this.j||(this.j={});return this.j};function ee(a){if(a.h)return a.h;if(a.i)return ee(a.i);Va("Root logger has no level set.");return null}
h.log=function(a,b,c){if(a.value>=ee(this).value)for(ia(b)&&(b=b()),a=this.Fg(a,b,c,Sd.prototype.log),b="log:"+a.getMessage(),q.console&&(q.console.timeStamp?q.console.timeStamp(b):q.console.markTimeline&&q.console.markTimeline(b)),q.msWriteProfilerMark&&q.msWriteProfilerMark(b),b=this;b;){c=b;var d=a;if(c.g)for(var e=0,f=void 0;f=c.g[e];e++)f(d);b=b.getParent()}};
h.Fg=function(a,b,c,d){a=new Qd(a,String(b),this.l);if(c){a.i=c;var e;d=d||Sd.prototype.Fg;try{var f;var g=ba("window.location.href");if(v(c))f={message:c,name:"Unknown error",lineNumber:"Not available",fileName:g,stack:"Not available"};else{var k,l;b=!1;try{k=c.lineNumber||c.Hj||"Not available"}catch(m){k="Not available",b=!0}try{l=c.fileName||c.filename||c.sourceURL||q.$googDebugFname||g}catch(n){l="Not available",b=!0}f=!b&&c.lineNumber&&c.fileName&&c.stack&&c.message&&c.name?c:{message:c.message||
"Not available",name:c.name||"UnknownError",lineNumber:k,fileName:l,stack:c.stack||"Not available"}}e="Message: "+Da(f.message)+'\nUrl: <a href="view-source:'+f.fileName+'" target="_new">'+f.fileName+"</a>\nLine: "+f.lineNumber+"\n\nBrowser stack:\n"+Da(f.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+Da(Md(d)+"-> ")}catch(p){e="Exception trying to expose exception! You win, we lose. "+p}a.g=e}return a};function H(a,b,c){a.log(Wd,b,c)}h.info=function(a,b){this.log(Xd,a,b)};
function fe(a,b,c){a.log(Zd,b,c)}function J(a,b,c){a.log($d,b,c)}function ge(a,b,c){a.log(ae,b,c)}var he={},ie=null;function je(){ie||(ie=new Sd(""),he[""]=ie,ie.h=Yd)}function ke(){je();return ie}function L(a){je();var b;if(!(b=he[a])){b=new Sd(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=L(a.substr(0,c));c.getChildren()[d]=b;b.i=c;he[a]=b}return b};function le(a,b,c){a&&a.log(b,c,void 0)}function me(a,b){a&&a.log(Vd,b,void 0)}function N(a,b){a&&H(a,b,void 0)}function ne(a,b){a&&fe(a,b,void 0)};function O(a,b){a&&ge(a,b,void 0)}function P(a,b){a&&J(a,b,void 0)};function oe(a,b){B.call(this,a,b);this.p=[]}A(oe,B);function pe(a,b){for(var c=0;c<a.p.length;c++)a.p[c][0].call(a.p[c][1],b)}oe.prototype.callback=function(a){this.p.length=0;oe.m.callback.call(this,a)};oe.prototype.F=function(a){this.p.length=0;oe.m.F.call(this,a)};function sd(a){this.id="i"+this.count();this.req=a;this.i=!0;this.g=this.h=null;this.j=new oe;this.l=NaN}sd.prototype.G=function(){return this.id};var qe=0;h=sd.prototype;h.count=function(){qe++;return qe};
h.listen=function(a){if(a&&a.id==this.id){this.h=a.data;var b=a.error;b&&(b instanceof Error?this.g=b:x(b)?(this.g=Error(b.message),this.g.name=b.name,this.g.source=b,this.g.result=this.h):(this.g=Error(b),this.g.name="UnknownError"));a.done?(this.i=!1,this.g?this.j.F(this.g):this.j.callback(this.h),window.clearTimeout(this.l)):pe(this.j,a.data);return!0}return!1};h.toString=function(){return"Message:"+this.id+(this.i?"*":"")};h.getData=function(){return this.h};
h.toJSON=function(){var a=this;this.l=window.setTimeout(function(){if(a.i){var b=Error("message timeout");b.name="TimeOutError";a.listen({id:a.id,req:a.req,error:b})}},1E4);return{id:this.id,req:this.req,group:this.o,name:this.p,data:this.h}};function re(a){pd.call(this);var b=v(a)?null:a;this.name=v(a)?a:a.name;this.g=[];this.o=b;this.h=null;this.i={}}A(re,pd);re.prototype.H=function(){if(this.h){var a=this;this.h.disconnect(function(){a.h=null;a.g.length=0})}else this.g.length=0};
re.prototype.l=function(a){if(a)if(a.id)for(var b=this.g.length-1;0<=b;b--){if(this.g[b].G()==a.id){if(this.g[b].listen(a)){this.g[b].i?25<b&&(a=this.g.splice(b,1),this.g.unshift(a[0])):this.g.splice(b,1);break}break}}else"info"==a.req?(a.data=this.o,this.h.postMessage(a)):"html-body-inner"==a.req?(window.console.log("html",a),a.req="",a.done=!0,a.data=document&&document.body?document.body.innerHTML:"",this.h.postMessage(a)):this.dispatchEvent(new ud(a))};
re.prototype.toString=function(){return"Pipe:"+this.name};re.prototype.j=function(a,b){var c=a||se,d=c+(b?"-"+b:"");this.i[d]||(this.i[d]=new rd(this,c,b||""));return this.i[d]};function td(a){if(!a.h){a.h=chrome.runtime.connect({name:a.name});var b=oa(a.l,a);a.h.onMessage.addListener(b);a.h.onDisconnect.addListener(function(){a.h.onMessage.removeListener(b);a.h=null;a.g.length=0})}return a.h}var te=null;function ue(){if(!te){var a=se+"-"+z();te=new re(a)}return te}
function ve(a){var b=a;v(a)&&(b={group:a,name:a+"-"+z()});return te=new re(b)}var se="default",we="dev gmail hostper popup options setup".split(" ");function xe(a,b){return ue().j(a,b)};var ye=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function ze(a){if(Ae){Ae=!1;var b=q.location;if(b){var c=b.href;if(c&&(c=(c=ze(c)[3]||null)&&decodeURIComponent(c))&&c!=b.hostname)throw Ae=!0,Error();}}return a.match(ye)}var Ae=oc;function Be(a,b){var c;if(a instanceof Be)this.nc=t(b)?b:a.nc,Ce(this,a.Qc),this.ze=a.ze,De(this,a.Ub),Ee(this,a.Zd),Fe(this,a.yc),Ge(this,a.g.clone()),He(this,a.$e);else if(a&&(c=ze(String(a)))){this.nc=!!b;Ce(this,c[1]||"",!0);var d=c[2]||"";this.ze=d?decodeURIComponent(d):"";De(this,c[3]||"",!0);Ee(this,c[4]);Fe(this,c[5]||"",!0);Ge(this,c[6]||"",!0);He(this,c[7]||"",!0)}else this.nc=!!b,this.g=new Ie(null,0,this.nc)}h=Be.prototype;h.Qc="";h.ze="";h.Ub="";h.Zd=null;h.yc="";h.$e="";h.nc=!1;
h.toString=function(){var a=[],b=this.Qc;b&&a.push(Je(b,Ke),":");if(b=this.Ub){a.push("//");var c=this.ze;c&&a.push(Je(c,Ke),"@");a.push(encodeURIComponent(String(b)));b=this.Zd;null!=b&&a.push(":",String(b))}if(b=this.yc)this.Ub&&"/"!=b.charAt(0)&&a.push("/"),a.push(Je(b,"/"==b.charAt(0)?Le:Me));(b=this.g.toString())&&a.push("?",b);(b=this.$e)&&a.push("#",Je(b,Ne));return a.join("")};h.clone=function(){return new Be(this)};
function Ce(a,b,c){a.Qc=c?b?decodeURIComponent(b):"":b;a.Qc&&(a.Qc=a.Qc.replace(/:$/,""));return a}function Oe(a){return a.Ub}function De(a,b,c){a.Ub=c?b?decodeURIComponent(b):"":b;return a}function Ee(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Zd=b}else a.Zd=null}function Pe(a){return a.yc}function Fe(a,b,c){a.yc=c?b?decodeURIComponent(b):"":b}function Ge(a,b,c){b instanceof Ie?(a.g=b,Qe(a.g,a.nc)):(c||(b=Je(b,Re)),a.g=new Ie(b,0,a.nc))}
function He(a,b,c){a.$e=c?b?decodeURIComponent(b):"":b}function Je(a,b){return v(a)?encodeURI(a).replace(b,Se):null}function Se(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Ke=/[#\/\?@]/g,Me=/[\#\?:]/g,Le=/[\#\?]/g,Re=/[\#\?@]/g,Ne=/#/g;function Ie(a,b,c){this.g=a||null;this.h=!!c}
function Te(a){if(!a.ma&&(a.ma=new Gd,a.Ra=0,a.g))for(var b=a.g.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=null,f=null;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c];e=decodeURIComponent(e.replace(/\+/g," "));e=Ue(a,e);a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}h=Ie.prototype;h.ma=null;h.Ra=null;h.ga=function(){Te(this);return this.Ra};h.add=function(a,b){Te(this);this.g=null;a=Ue(this,a);var c=this.ma.get(a);c||this.ma.set(a,c=[]);c.push(b);this.Ra++;return this};
h.remove=function(a){Te(this);a=Ue(this,a);return Id(this.ma.h,a)?(this.g=null,this.Ra-=this.ma.get(a).length,this.ma.remove(a)):!1};h.clear=function(){this.ma=this.g=null;this.Ra=0};h.Sa=function(){Te(this);return 0==this.Ra};function Ve(a,b){Te(a);b=Ue(a,b);return Id(a.ma.h,b)}h.Pa=function(){Te(this);for(var a=this.ma.Ca(),b=this.ma.Pa(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};
h.Ca=function(a){Te(this);var b=[];if(v(a))Ve(this,a)&&(b=Fb(b,this.ma.get(Ue(this,a))));else{a=this.ma.Ca();for(var c=0;c<a.length;c++)b=Fb(b,a[c])}return b};h.set=function(a,b){Te(this);this.g=null;a=Ue(this,a);Ve(this,a)&&(this.Ra-=this.ma.get(a).length);this.ma.set(a,[b]);this.Ra++;return this};h.get=function(a,b){var c=a?this.Ca(a):[];return 0<c.length?String(c[0]):b};
h.toString=function(){if(this.g)return this.g;if(!this.ma)return"";for(var a=[],b=this.ma.Pa(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.Ca(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f])));a.push(g)}return this.g=a.join("&")};h.clone=function(){var a=new Ie;a.g=this.g;this.ma&&(a.ma=this.ma.clone(),a.Ra=this.Ra);return a};function Ue(a,b){var c=String(b);a.h&&(c=c.toLowerCase());return c}
function Qe(a,b){b&&!a.h&&(Te(a),a.g=null,a.ma.forEach(function(a,b){var e=b.toLowerCase();b!=e&&(this.remove(b),this.remove(e),0<a.length&&(this.g=null,this.ma.set(Ue(this,e),Gb(a)),this.Ra+=a.length))},a));a.h=b};var Ye;
Ye={l:["BC","AD"],j:["Before Christ","Anno Domini"],I:"JFMAMJJASOND".split(""),ba:"JFMAMJJASOND".split(""),u:"January February March April May June July August September October November December".split(" "),aa:"January February March April May June July August September October November December".split(" "),N:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),sa:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),Le:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Sb:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
Y:"Sun Mon Tue Wed Thu Fri Sat".split(" "),Na:"Sun Mon Tue Wed Thu Fri Sat".split(" "),L:"SMTWTFS".split(""),bb:"SMTWTFS".split(""),M:["Q1","Q2","Q3","Q4"],D:["1st quarter","2nd quarter","3rd quarter","4th quarter"],g:["AM","PM"],h:["EEEE, MMMM d, y","MMMM d, y","MMM d, y","M/d/yy"],gc:["h:mm:ss a zzzz","h:mm:ss a z","h:mm:ss a","h:mm a"],i:["{1} 'at' {0}","{1} 'at' {0}","{1}, {0}","{1}, {0}"],o:6,hg:[5,6],p:5};function Ze(a){a=String(a);if(void 0===Ye.Ih)return a;for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);b.push(48<=d&&57>=d?String.fromCharCode(Ye.Ih+d-48):a.charAt(c))}return b.join("")};var $e={yh:{1E3:{other:"0K"},1E4:{other:"00K"},1E5:{other:"000K"},1E6:{other:"0M"},1E7:{other:"00M"},1E8:{other:"000M"},1E9:{other:"0B"},1E10:{other:"00B"},1E11:{other:"000B"},1E12:{other:"0T"},1E13:{other:"00T"},1E14:{other:"000T"}},xh:{1E3:{other:"0 thousand"},1E4:{other:"00 thousand"},1E5:{other:"000 thousand"},1E6:{other:"0 million"},1E7:{other:"00 million"},1E8:{other:"000 million"},1E9:{other:"0 billion"},1E10:{other:"00 billion"},1E11:{other:"000 billion"},1E12:{other:"0 trillion"},1E13:{other:"00 trillion"},
1E14:{other:"000 trillion"}}},af=$e,af=$e;var bf={eg:".",gg:",",ig:"%",Me:"0",Gh:"+",Ch:"-",fg:"E",jg:"\u2030",Ke:"\u221e",Eh:"NaN",dg:"#,##0.###",Hh:"#E0",Fh:"#,##0%",zh:"\u00a4#,##0.00",Ah:"USD"},cf=bf,cf=bf;var df={AED:[2,"dh","\u062f.\u0625.","DH"],ALL:[0,"Lek","Lek"],AUD:[2,"$","AU$"],BDT:[2,"\u09f3","Tk"],BGN:[2,"lev","lev"],BRL:[2,"R$","R$"],CAD:[2,"$","C$"],CDF:[2,"FrCD","CDF"],CHF:[2,"CHF","CHF"],CLP:[0,"$","CL$"],CNY:[2,"\u00a5","RMB\u00a5"],COP:[0,"$","COL$"],CRC:[0,"\u20a1","CR\u20a1"],CZK:[50,"K\u010d","K\u010d"],DKK:[18,"kr","kr"],DOP:[2,"$","RD$"],EGP:[2,"\u00a3","LE"],ETB:[2,"Birr","Birr"],EUR:[2,"\u20ac","\u20ac"],GBP:[2,"\u00a3","GB\u00a3"],HKD:[2,"$","HK$"],HRK:[2,"kn","kn"],HUF:[0,"Ft",
"Ft"],IDR:[0,"Rp","Rp"],ILS:[2,"\u20aa","IL\u20aa"],INR:[2,"\u20b9","Rs"],IRR:[0,"Rial","IRR"],ISK:[0,"kr","kr"],JMD:[2,"$","JA$"],JPY:[0,"\u00a5","JP\u00a5"],KRW:[0,"\u20a9","KR\u20a9"],LKR:[2,"Rs","SLRs"],LTL:[2,"Lt","Lt"],LVL:[2,"Ls","Ls"],MNT:[0,"\u20ae","MN\u20ae"],MXN:[2,"$","Mex$"],MYR:[2,"RM","RM"],NOK:[50,"kr","NOkr"],PAB:[2,"B/.","B/."],PEN:[2,"S/.","S/."],PHP:[2,"\u20b1","Php"],PKR:[0,"Rs","PKRs."],PLN:[50,"z\u0142","z\u0142"],RON:[2,"RON","RON"],RSD:[0,"din","RSD"],RUB:[50,"\u0440\u0443\u0431.",
"\u0440\u0443\u0431."],SAR:[2,"Rial","Rial"],SEK:[2,"kr","kr"],SGD:[2,"$","S$"],THB:[2,"\u0e3f","THB"],TRY:[2,"TL","YTL"],TWD:[2,"NT$","NT$"],TZS:[0,"TSh","TSh"],UAH:[2,"\u20b4","UAH"],USD:[2,"$","US$"],UYU:[2,"$","$U"],VND:[0,"\u20ab","VN\u20ab"],YER:[0,"Rial","Rial"],ZAR:[2,"R","ZAR"]};function ef(a,b,c){this.u=b||cf.Ah;this.sa=c||ff;this.D=40;this.g=1;this.aa=0;this.j=3;this.N=this.h=0;this.bb=!1;this.L=this.l="";this.i="-";this.o="";this.I=1;this.Y=3;this.M=this.ba=!1;this.p=gf;if("number"==typeof a)switch(a){case 1:hf(this,cf.dg);break;case 2:hf(this,cf.Hh);break;case 3:hf(this,cf.Fh);break;case 4:a=cf.zh;b=["0"];c=df[this.u][0]&7;if(0<c){b.push(".");for(var d=0;d<c;d++)b.push("0")}a=a.replace(/0.00/g,b.join(""));hf(this,a);break;case 5:jf(this,1);break;case 6:jf(this,2);break;
default:throw Error("Unsupported pattern type.");}else hf(this,a)}var ff=0,gf=0;
function hf(a,b){b.replace(/ /g,"\u00a0");var c=[0];a.l=kf(a,b,c);for(var d=c[0],e=-1,f=0,g=0,k=0,l=-1,m=b.length,n=!0;c[0]<m&&n;c[0]++)switch(b.charAt(c[0])){case "#":0<g?k++:f++;0<=l&&0>e&&l++;break;case "0":if(0<k)throw Error('Unexpected "0" in pattern "'+b+'"');g++;0<=l&&0>e&&l++;break;case ",":l=0;break;case ".":if(0<=e)throw Error('Multiple decimal separators in pattern "'+b+'"');e=f+g+k;break;case "E":if(a.M)throw Error('Multiple exponential symbols in pattern "'+b+'"');a.M=!0;a.N=0;c[0]+1<
m&&"+"==b.charAt(c[0]+1)&&(c[0]++,a.bb=!0);for(;c[0]+1<m&&"0"==b.charAt(c[0]+1);)c[0]++,a.N++;if(1>f+g||1>a.N)throw Error('Malformed exponential pattern "'+b+'"');n=!1;break;default:c[0]--,n=!1}0==g&&0<f&&0<=e&&(g=e,0==g&&g++,k=f-g,f=g-1,g=1);if(0>e&&0<k||0<=e&&(e<f||e>f+g)||0==l)throw Error('Malformed pattern "'+b+'"');k=f+g+k;a.j=0<=e?k-e:0;0<=e&&(a.h=f+g-e,0>a.h&&(a.h=0));a.g=(0<=e?e:k)-f;a.M&&(a.D=f+a.g,0==a.j&&0==a.g&&(a.g=1));a.Y=Math.max(0,l);a.ba=0==e||e==k;d=c[0]-d;a.L=kf(a,b,c);c[0]<b.length&&
b.charAt(c[0])==lf?(c[0]++,a.i=kf(a,b,c),c[0]+=d,a.o=kf(a,b,c)):(a.i=a.l+a.i,a.o+=a.L)}function jf(a,b){a.p=b;hf(a,cf.dg);a.h=0;a.j=2;if(0<a.h)throw Error("Can't combine significant digits and minimum fraction digits");a.aa=2}
ef.prototype.parse=function(a,b){var c=b||[0];if(this.p!=gf)throw Error("Parsing of compact numbers is unimplemented");var d=NaN;a=a.replace(/ /g,"\u00a0");var e=a.indexOf(this.l,c[0])==c[0],f=a.indexOf(this.i,c[0])==c[0];e&&f&&(this.l.length>this.i.length?f=!1:this.l.length<this.i.length&&(e=!1));e?c[0]+=this.l.length:f&&(c[0]+=this.i.length);if(a.indexOf(cf.Ke,c[0])==c[0])c[0]+=cf.Ke.length,d=Infinity;else{var d=a,g=!1,k=!1,l=!1,m=1,n=cf.eg,p=cf.gg,r=cf.fg;if(this.p!=gf)throw Error("Parsing of compact style numbers is not implemented");
for(var s="";c[0]<d.length;c[0]++){var w=d.charAt(c[0]),y=mf(w);if(0<=y&&9>=y)s+=y,l=!0;else if(w==n.charAt(0)){if(g||k)break;s+=".";g=!0}else if(w==p.charAt(0)&&("\u00a0"!=p.charAt(0)||c[0]+1<d.length&&0<=mf(d.charAt(c[0]+1)))){if(g||k)break}else if(w==r.charAt(0)){if(k)break;s+="E";k=!0}else if("+"==w||"-"==w)s+=w;else if(w==cf.ig.charAt(0)){if(1!=m)break;m=100;if(l){c[0]++;break}}else if(w==cf.jg.charAt(0)){if(1!=m)break;m=1E3;if(l){c[0]++;break}}else break}d=parseFloat(s)/m}if(e){if(a.indexOf(this.L,
c[0])!=c[0])return NaN;c[0]+=this.L.length}else if(f){if(a.indexOf(this.o,c[0])!=c[0])return NaN;c[0]+=this.o.length}return f?-d:d};function nf(a,b){var c=Math.pow(10,a.j),d=0>=a.aa?Math.round(b*c):Math.round(of(b*c,a.aa,a.j)),e;isFinite(d)?(e=Math.floor(d/c),c=Math.floor(d-e*c)):(e=b,c=0);return{Tg:e,Oh:c}}
function pf(a,b,c,d){if(a.h>a.j)throw Error("Min value must be less than max value");b=nf(a,b);var e=Math.pow(10,a.j),f=b.Tg,g=b.Oh,k=0<a.h||0<g||!1;b=a.h;k&&(b=a.h);for(var l="",m=f;1E20<m;)l="0"+l,m=Math.round(m/10);var l=m+l,n=cf.eg,p=cf.gg,m=cf.Me.charCodeAt(0),r=l.length;if(0<f||0<c){for(f=r;f<c;f++)d.push(String.fromCharCode(m));for(f=0;f<r;f++)d.push(String.fromCharCode(m+1*l.charAt(f))),1<r-f&&0<a.Y&&1==(r-f)%a.Y&&d.push(p)}else k||d.push(String.fromCharCode(m));(a.ba||k)&&d.push(n);a=""+
(g+e);for(c=a.length;"0"==a.charAt(c-1)&&c>b+1;)c--;for(f=1;f<c;f++)d.push(String.fromCharCode(m+1*a.charAt(f)))}function qf(a,b,c){c.push(cf.fg);0>b?(b=-b,c.push(cf.Ch)):a.bb&&c.push(cf.Gh);b=""+b;for(var d=cf.Me,e=b.length;e<a.N;e++)c.push(d);c.push(b)}function mf(a){a=a.charCodeAt(0);if(48<=a&&58>a)return a-48;var b=cf.Me.charCodeAt(0);return b<=a&&a<b+10?a-b:-1}var lf=";";
function kf(a,b,c){for(var d="",e=!1,f=b.length;c[0]<f;c[0]++){var g=b.charAt(c[0]);if("'"==g)c[0]+1<f&&"'"==b.charAt(c[0]+1)?(c[0]++,d+="'"):e=!e;else if(e)d+=g;else switch(g){case "#":case "0":case ",":case ".":case lf:return d;case "\u00a4":if(c[0]+1<f&&"\u00a4"==b.charAt(c[0]+1))c[0]++,d+=a.u;else switch(a.sa){case ff:d+=df[a.u][1];break;case 2:var g=a.u,k=df[g],d=d+(g==k[1]?g:g+" "+k[1]);break;case 1:d+=df[a.u][2]}break;case "%":if(1!=a.I)throw Error("Too many percent/permill");a.I=100;d+=cf.ig;
break;case "\u2030":if(1!=a.I)throw Error("Too many percent/permill");a.I=1E3;d+=cf.jg;break;default:d+=g}}return d}var rf={prefix:"",mh:"",We:0};function sf(a,b){var c=1==a.p?af.yh:af.xh;if(3>b)return rf;b=Math.min(14,b);c=c[Math.pow(10,b)];if(!c)return rf;c=c.other;return c&&"0"!=c?(c=/([^0]*)(0+)(.*)/.exec(c))?{prefix:c[1],mh:c[3],We:b-(c[2].length-1)}:rf:rf}function tf(a){for(var b=0;1<=(a/=10);)b++;return b}
function of(a,b,c){if(!a)return a;b=b-tf(a)-1;if(b<-c)return c=Math.pow(10,c),Math.round(a/c)*c;c=Math.pow(10,b);return Math.round(a*c)/c};function uf(a){return 1==a%10&&11!=a%100?"one":2==a%10&&12!=a%100?"two":3==a%10&&13!=a%100?"few":"other"}var vf=uf,vf=uf;function wf(a){a=a+"";var b=a.indexOf(".");return-1==b?0:a.length-b-1}function xf(a,b){var c,d=a|0;c=void 0===b?Math.min(wf(a),3):b;return 1==d&&0==c?"one":"other"}var yf=xf,yf=xf;function zf(a){this.g=[];this.j=[];this.i=new ef(1);a&&(a=Af(this,a),this.j=Bf(this,a))}var Cf=RegExp("'([{}#].*?)'","g"),Df=RegExp("''","g");
function Ef(a,b,c,d,e){for(var f=0;f<b.length;f++)switch(b[f].type){case 4:e.push(b[f].value);break;case 3:var g=b[f].value,k=a,l=e,m=c[g];t(m)?(k.g.push(m),l.push(k.h(k.g))):l.push("Undefined parameter - "+g);break;case 2:g=b[f].value;k=e;l=g.Dd;t(c[l])?(l=g[c[l]],t(l)||(l=g.other),Ef(a,l,c,d,k)):k.push("Undefined parameter - "+l);break;case 0:g=b[f].value;Ff(a,g,c,yf,d,e);break;case 1:g=b[f].value;Ff(a,g,c,vf,d,e);break;default:Va("Unrecognized block type: "+b[f].type)}}
function Ff(a,b,c,d,e,f){var g=b.Dd,k=b.ng,l=+c[g];if(isNaN(l))f.push("Undefined or invalid parameter - "+g);else if(k=l-k,g=b[c[g]],t(g)||(d=a.i.Na?d(k,a.i.Na()):d(k),g=b[d],t(g)||(g=b.other)),b=[],Ef(a,g,c,e,b),c=b.join(""),e)f.push(c);else{a=a.i;if(isNaN(k))a=cf.Eh;else{e=[];g=d=k;a.p==gf?b=rf:(d=Math.abs(d),g=Math.abs(g),b=sf(a,1>=d?0:tf(d)).We,nf(a,g/Math.pow(10,b)),d=nf(a,d/Math.pow(10,b)),b=sf(a,b+tf(d.Tg)));k/=Math.pow(10,b.We);e.push(b.prefix);d=0>k||0==k&&0>1/k;e.push(d?a.i:a.l);if(isFinite(k))if(k=
k*(d?-1:1)*a.I,a.M)if(0==k)pf(a,k,a.g,e),qf(a,0,e);else{g=Math.log(k)/Math.log(10);g=Math.floor(g+2E-15);k/=Math.pow(10,g);l=a.g;if(1<a.D&&a.D>a.g){for(;0!=g%a.D;)k*=10,g--;l=1}else 1>a.g?(g++,k/=10):(g-=a.g-1,k*=Math.pow(10,a.g-1));pf(a,k,l,e);qf(a,g,e)}else pf(a,k,a.g,e);else e.push(cf.Ke);e.push(d?a.o:a.L);e.push(b.mh);a=e.join("")}f.push(c.replace(/#/g,a))}}
function Af(a,b){var c=a.g,d=oa(a.h,a);b=b.replace(Df,function(){c.push("'");return d(c)});return b=b.replace(Cf,function(a,b){c.push(b);return d(c)})}function Gf(a){var b=0,c=[],d=[],e=/[{}]/g;e.lastIndex=0;for(var f;f=e.exec(a);){var g=f.index;"}"==f[0]?(c.pop(),0==c.length&&(f={type:1},f.value=a.substring(b,g),d.push(f),b=g+1)):(0==c.length&&(b=a.substring(b,g),""!=b&&d.push({type:0,value:b}),b=g+1),c.push("{"))}b=a.substring(b);""!=b&&d.push({type:0,value:b});return d}
var Hf=/^\s*(\w+)\s*,\s*plural\s*,(?:\s*offset:(\d+))?/,If=/^\s*(\w+)\s*,\s*selectordinal\s*,/,Jf=/^\s*(\w+)\s*,\s*select\s*,/;
function Bf(a,b){for(var c=[],d=Gf(b),e=0;e<d.length;e++){var f={};if(0==d[e].type)f.type=4,f.value=d[e].value;else if(1==d[e].type){var g=d[e].value;switch(Hf.test(g)?0:If.test(g)?1:Jf.test(g)?2:/^\s*\w+\s*/.test(g)?3:5){case 2:f.type=2;f.value=Kf(a,d[e].value);break;case 0:f.type=0;f.value=Lf(a,d[e].value);break;case 1:f.type=1;f.value=Mf(a,d[e].value);break;case 3:f.type=3;f.value=d[e].value;break;default:Va("Unknown block type for pattern: "+d[e].value)}}else Va("Unknown part of the pattern.");
c.push(f)}return c}function Kf(a,b){var c="";b=b.replace(Jf,function(a,b){c=b;return""});var d={};d.Dd=c;for(var e=Gf(b),f=0;f<e.length;){var g=e[f].value;f++;if(1==e[f].type)var k=Bf(a,e[f].value);else Va("Expected block type.");d[g.replace(/\s/g,"")]=k;f++}return d}
function Lf(a,b){var c="",d=0;b=b.replace(Hf,function(a,b,e){c=b;e&&(d=parseInt(e,10));return""});var e={};e.Dd=c;e.ng=d;for(var f=Gf(b),g=0;g<f.length;){var k=f[g].value;g++;if(1==f[g].type)var l=Bf(a,f[g].value);else Va("Expected block type.");e[k.replace(/\s*(?:=)?(\w+)\s*/,"$1")]=l;g++}return e}
function Mf(a,b){var c="";b=b.replace(If,function(a,b){c=b;return""});var d={};d.Dd=c;d.ng=0;for(var e=Gf(b),f=0;f<e.length;){var g=e[f].value;f++;if(1==e[f].type)var k=Bf(a,e[f].value);else Va("Expected block type.");d[g.replace(/\s*(?:=)?(\w+)\s*/,"$1")]=k;f++}return d}zf.prototype.h=function(a){return"\ufddf_"+(a.length-1).toString(10)+"_"};function Nf(a,b,c){a=new zf(a);b={COUNT:b,TEXT:c};if(0==a.j.length)a="";else{c=[];Ef(a,a.j,b,!1,c);for(b=c.join("");0<a.g.length;)b=b.replace(a.h(a.g),a.g.pop());a=b}return a};function Of(a){cc.call(this);this.g=a;this.h={}}A(Of,cc);var Pf=[];h=Of.prototype;h.listen=function(a,b,c,d){u(b)||(b&&(Pf[0]=b.toString()),b=Pf);for(var e=0;e<b.length;e++){var f=cd(a,b[e],c||this.handleEvent,d||!1,this.g||this);if(!f)break;this.h[f.key]=f}return this};function Qf(a,b,c){Rf(a,b,"hide",c,!1)}function Rf(a,b,c,d,e,f){if(u(c))for(var g=0;g<c.length;g++)Rf(a,b,c[g],d,e,f);else(b=jd(b,c,d||a.handleEvent,e,f||a.g||a))&&(a.h[b.key]=b)}
h.ka=function(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)this.ka(a,b[f],c,d,e);else c=c||this.handleEvent,e=e||this.g||this,c=dd(c),d=!!d,b=Gc(a)?Yc(a.Fb,String(b),c,d,e):a?(a=fd(a))?Yc(a,b,c,d,e):null:null,b&&(ld(b),delete this.h[b.key]);return this};h.removeAll=function(){Kc(this.h,ld);this.h={}};h.H=function(){Of.m.H.call(this);this.removeAll()};h.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};function Sf(a,b){pd.call(this);this.h=a||1;this.g=b||q;this.i=oa(this.$i,this);this.j=z()}A(Sf,pd);h=Sf.prototype;h.dd=!1;h.ea=null;h.setInterval=function(a){this.h=a;this.ea&&this.dd?(this.stop(),Tf(this)):this.ea&&this.stop()};h.$i=function(){if(this.dd){var a=z()-this.j;0<a&&a<.8*this.h?this.ea=this.g.setTimeout(this.i,this.h-a):(this.ea&&(this.g.clearTimeout(this.ea),this.ea=null),this.dispatchEvent(Uf),this.dd&&(this.ea=this.g.setTimeout(this.i,this.h),this.j=z()))}};
function Tf(a){a.dd=!0;a.ea||(a.ea=a.g.setTimeout(a.i,a.h),a.j=z())}h.stop=function(){this.dd=!1;this.ea&&(this.g.clearTimeout(this.ea),this.ea=null)};h.H=function(){Sf.m.H.call(this);this.stop();delete this.g};var Uf="tick";function Vf(a,b,c){if(ia(a))c&&(a=oa(a,c));else if(a&&"function"==typeof a.handleEvent)a=oa(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<b?-1:q.setTimeout(a,b||0)};var Wf=q.JSON.parse,Xf=q.JSON.stringify;function Yf(){}
function Zf(a,b,c){switch(typeof b){case "string":$f(b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case "boolean":c.push(b);break;case "undefined":c.push("null");break;case "object":if(null==b){c.push("null");break}if(u(b)){var d=b.length;c.push("[");for(var e="",f=0;f<d;f++)c.push(e),Zf(a,b[f],c),e=",";c.push("]");break}c.push("{");d="";for(e in b)Object.prototype.hasOwnProperty.call(b,e)&&(f=b[e],"function"!=typeof f&&(c.push(d),$f(e,c),c.push(":"),Zf(a,f,c),d=","));c.push("}");
break;case "function":break;default:throw Error("Unknown type: "+typeof b);}}var ag={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},bg=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function $f(a,b){b.push('"',a.replace(bg,function(a){if(a in ag)return ag[a];var b=a.charCodeAt(0),e="\\u";16>b?e+="000":256>b?e+="00":4096>b&&(e+="0");return ag[a]=e+b.toString(16)}),'"')};function cg(){}cg.prototype.g=null;function dg(a){var b;(b=a.g)||(b={},eg(a)&&(b[0]=!0,b[1]=!0),b=a.g=b);return b};var fg;function gg(){}A(gg,cg);function hg(a){return(a=eg(a))?new ActiveXObject(a):new XMLHttpRequest}function eg(a){if(!a.h&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.h=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return a.h}fg=new gg;function ig(a){pd.call(this);this.headers=new Gd;this.aa=a||null;this.h=!1;this.Y=this.X=null;this.Na=this.u="";this.o=0;this.p="";this.i=this.sa=this.D=this.ba=!1;this.l=0;this.N=null;this.j=jg;this.M=this.Ae=!1}A(ig,pd);var jg="";ig.prototype.g=L("goog.net.XhrIo");var kg=/^https?$/i,lg=["POST","PUT"];h=ig.prototype;h.Gg=function(){return this.j};
h.send=function(a,b,c,d){if(this.X)throw Error("[goog.net.XhrIo] Object is active with another request="+this.u+"; newUri="+a);b=b?b.toUpperCase():"GET";this.u=a;this.p="";this.o=0;this.Na=b;this.ba=!1;this.h=!0;this.X=this.aa?hg(this.aa):hg(fg);this.Y=this.aa?dg(this.aa):dg(fg);this.X.onreadystatechange=oa(this.bh,this);try{ne(this.g,mg(this,"Opening Xhr")),this.sa=!0,this.X.open(b,String(a),!0),this.sa=!1}catch(e){ne(this.g,mg(this,"Error opening Xhr: "+e.message));ng(this,e);return}a=c||"";var f=
this.headers.clone();d&&Ad(d,function(a,b){f.set(b,a)});d=Ab(f.Pa(),og);c=q.FormData&&a instanceof q.FormData;!Cb(lg,b)||d||c||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");f.forEach(function(a,b){this.X.setRequestHeader(b,a)},this);this.j&&(this.X.responseType=this.j);"withCredentials"in this.X&&(this.X.withCredentials=this.Ae);try{pg(this),0<this.l&&(this.M=qg(this.X),ne(this.g,mg(this,"Will abort after "+this.l+"ms if incomplete, xhr2 "+this.M)),this.M?(this.X.timeout=
this.l,this.X.ontimeout=oa(this.nh,this)):this.N=Vf(this.nh,this.l,this)),ne(this.g,mg(this,"Sending request")),this.D=!0,this.X.send(a),this.D=!1}catch(g){ne(this.g,mg(this,"Send error: "+g.message)),ng(this,g)}};function qg(a){return C&&vc(9)&&ha(a.timeout)&&t(a.ontimeout)}function og(a){return"content-type"==a.toLowerCase()}h.nh=function(){"undefined"!=typeof aa&&this.X&&(this.p="Timed out after "+this.l+"ms, aborting",this.o=8,ne(this.g,mg(this,this.p)),this.dispatchEvent("timeout"),this.abort(8))};
function ng(a,b){a.h=!1;a.X&&(a.i=!0,a.X.abort(),a.i=!1);a.p=b;a.o=5;rg(a);sg(a)}function rg(a){a.ba||(a.ba=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}h.abort=function(a){this.X&&this.h&&(ne(this.g,mg(this,"Aborting")),this.h=!1,this.i=!0,this.X.abort(),this.i=!1,this.o=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),sg(this))};h.H=function(){this.X&&(this.h&&(this.h=!1,this.i=!0,this.X.abort(),this.i=!1),sg(this,!0));ig.m.H.call(this)};
h.bh=function(){this.I||(this.sa||this.D||this.i?tg(this):this.Ri())};h.Ri=function(){tg(this)};function tg(a){if(a.h&&"undefined"!=typeof aa)if(a.Y[1]&&4==ug(a)&&2==a.Q())ne(a.g,mg(a,"Local request error detected and ignored"));else if(a.D&&4==ug(a))Vf(a.bh,0,a);else if(a.dispatchEvent("readystatechange"),4==ug(a)){ne(a.g,mg(a,"Request complete"));a.h=!1;try{vg(a)?(a.dispatchEvent("complete"),a.dispatchEvent("success")):(a.o=6,a.p=a.Qa()+" ["+a.Q()+"]",rg(a))}finally{sg(a)}}}
function sg(a,b){if(a.X){pg(a);var c=a.X,d=a.Y[0]?ca:null;a.X=null;a.Y=null;b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){me(a.g,"Problem encountered resetting onreadystatechange: "+e.message)}}}function pg(a){a.X&&a.M&&(a.X.ontimeout=null);ha(a.N)&&(q.clearTimeout(a.N),a.N=null)}
function vg(a){var b=a.Q(),c;a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:c=!0;break a;default:c=!1}if(!c){if(b=0===b)a=ze(String(a.u))[1]||null,!a&&self.location&&(a=self.location.protocol,a=a.substr(0,a.length-1)),b=!kg.test(a?a.toLowerCase():"");c=b}return c}function ug(a){return a.X?a.X.readyState:0}h.Q=function(){try{return 2<ug(this)?this.X.status:-1}catch(a){return-1}};
h.Qa=function(){try{return 2<ug(this)?this.X.statusText:""}catch(a){return ne(this.g,"Can not get status: "+a.message),""}};function wg(a){try{if(!a.X)return null;if("response"in a.X)return a.X.response;switch(a.j){case jg:case "text":return a.X.responseText;case "arraybuffer":if("mozResponseArrayBuffer"in a.X)return a.X.mozResponseArrayBuffer}me(a.g,"Response type "+a.j+" is not supported on this browser");return null}catch(b){return ne(a.g,"Can not get response: "+b.message),null}}
function mg(a,b){return b+" ["+a.Na+" "+a.u+" "+a.Q()+"]"};function xg(){this.g=[];this.h=[]}function yg(a){0==a.g.length&&(a.g=a.h,a.g.reverse(),a.h=[]);return a.g.pop()}h=xg.prototype;h.ga=function(){return this.g.length+this.h.length};h.Sa=function(){return 0==this.g.length&&0==this.h.length};h.clear=function(){this.g=[];this.h=[]};h.contains=function(a){return Cb(this.g,a)||Cb(this.h,a)};h.remove=function(a){var b=ub(this.g,a);if(0>b)return Eb(this.h,a);sb.splice.call(this.g,b,1);return!0};
h.Ca=function(){for(var a=[],b=this.g.length-1;0<=b;--b)a.push(this.g[b]);for(var c=this.h.length,b=0;b<c;++b)a.push(this.h[b]);return a};function zg(a,b){cc.call(this);this.o=a||0;this.i=b||10;if(this.o>this.i)throw Error(Ag);this.g=new xg;this.h=new Jd;this.l=null;this.Ad()}A(zg,cc);var Ag="[goog.structs.Pool] Min can not be greater than max";h=zg.prototype;h.ae=function(){var a=z();if(!(null!=this.l&&0>a-this.l)){for(var b;0<this.g.ga()&&(b=yg(this.g),!this.Nf(b));)this.Ad();!b&&this.ga()<this.i&&(b=this.kf());b&&(this.l=a,this.h.add(b));return b}};h.Wc=function(a){this.h.remove(a);this.Nf(a)&&this.ga()<this.i?this.g.h.push(a):Bg(a)};
h.Ad=function(){for(var a=this.g;this.ga()<this.o;){var b=this.kf();a.h.push(b)}for(;this.ga()>this.i&&0<this.g.ga();)Bg(yg(a))};h.kf=function(){return{}};function Bg(a){if("function"==typeof a.ca)a.ca();else for(var b in a)a[b]=null}h.Nf=function(a){return"function"==typeof a.Kh?a.Kh():!0};h.contains=function(a){return this.g.contains(a)||this.h.contains(a)};h.ga=function(){return this.g.ga()+this.h.ga()};h.Sa=function(){return this.g.Sa()&&this.h.Sa()};
h.H=function(){zg.m.H.call(this);if(0<this.h.ga())throw Error("[goog.structs.Pool] Objects not released");delete this.h;for(var a=this.g;!a.Sa();)Bg(yg(a));delete this.g};function Cg(a,b){this.g=a;this.h=b}Cg.prototype.U=function(){return this.h};Cg.prototype.clone=function(){return new Cg(this.g,this.h)};function Dg(a){this.g=[];if(a)a:{var b,c;if(a instanceof Dg){if(b=a.Pa(),c=a.Ca(),0>=a.ga()){a=this.g;for(var d=0;d<b.length;d++)a.push(new Cg(b[d],c[d]));break a}}else b=Mc(a),c=Lc(a);for(d=0;d<b.length;d++)Eg(this,b[d],c[d])}}function Eg(a,b,c){var d=a.g;d.push(new Cg(b,c));b=d.length-1;a=a.g;for(c=a[b];0<b;)if(d=b-1>>1,a[d].g>c.g)a[b]=a[d],b=d;else break;a[b]=c}h=Dg.prototype;
h.remove=function(){var a=this.g,b=a.length,c=a[0];if(!(0>=b)){if(1==b)Db(a);else{a[0]=a.pop();for(var a=0,b=this.g,d=b.length,e=b[a];a<d>>1;){var f=2*a+1,g=2*a+2,f=g<d&&b[g].g<b[f].g?g:f;if(b[f].g>e.g)break;b[a]=b[f];a=f}b[a]=e}return c.U()}};h.Ca=function(){for(var a=this.g,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].U());return b};h.Pa=function(){for(var a=this.g,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].g);return b};h.clone=function(){return new Dg(this)};h.ga=function(){return this.g.length};
h.Sa=function(){return 0==this.g.length};h.clear=function(){Db(this.g)};function Fg(){Dg.call(this)}A(Fg,Dg);function Gg(a,b){this.j=new Fg;zg.call(this,a,b)}A(Gg,zg);h=Gg.prototype;h.ae=function(a,b){if(!a)return Gg.m.ae.call(this);Eg(this.j,t(b)?b:100,a);this.xf()};h.xf=function(){for(var a=this.j;0<a.ga();){var b=this.ae();if(b)a.remove().apply(this,[b]);else break}};h.Wc=function(a){Gg.m.Wc.call(this,a);this.xf()};h.Ad=function(){Gg.m.Ad.call(this);this.xf()};h.H=function(){Gg.m.H.call(this);q.clearTimeout(void 0);this.j.clear();this.j=null};function Hg(a,b,c){Gg.call(this,b,c);this.p=a}A(Hg,Gg);Hg.prototype.kf=function(){var a=new ig,b=this.p;b&&b.forEach(function(b,d){a.headers.set(d,b)});return a};Hg.prototype.Nf=function(a){return!a.I&&!a.X};function Ig(a,b,c,d,e){pd.call(this);this.j=t(a)?a:1;this.l=t(e)?Math.max(0,e):0;this.i=new Hg(b,c,d);this.h=new Gd;this.g=new Of(this)}A(Ig,pd);var Jg="ready complete success error abort timeout".split(" ");h=Ig.prototype;h.send=function(a,b,c,d,e,f,g,k,l,m){if(this.h.get(a))throw Error("[goog.net.XhrManager] ID in use");b=new Kg(b,oa(this.ii,this,a),c,d,e,g,t(k)?k:this.j,l,m);this.h.set(a,b);a=oa(this.Zh,this,a);this.i.ae(a,f);return b};
h.abort=function(a,b){var c=this.h.get(a);if(c){var d=c.ud;c.kg=!0;b&&(d&&(this.g.ka(d,Jg,c.Xf),jd(d,"ready",function(){var a=this.i;a.h.remove(d)&&a.Wc(d)},!1,this)),this.h.remove(a));d&&d.abort()}};h.Zh=function(a,b){var c=this.h.get(a);c&&!c.ud?(this.g.listen(b,Jg,c.Xf),b.l=Math.max(0,this.l),b.j=c.Gg(),c.ud=b,c.ud.Ae=c.Ae,this.dispatchEvent(new Lg("ready",this,a,b)),Mg(this,a,b),c.kg&&b.abort()):(c=this.i,c.h.remove(b)&&c.Wc(b))};
h.ii=function(a,b){var c=b.target;switch(b.type){case "ready":Mg(this,a,c);break;case "complete":a:{var d=this.h.get(a);if(7==c.o||vg(c)||d.Ed>d.hf)if(this.dispatchEvent(new Lg("complete",this,a,c)),d&&(d.xg=!0,d.wg)){c=d.wg.call(c,b);break a}c=null}return c;case "success":this.dispatchEvent(new Lg("success",this,a,c));break;case "timeout":case "error":d=this.h.get(a);d.Ed>d.hf&&this.dispatchEvent(new Lg("error",this,a,c));break;case "abort":this.dispatchEvent(new Lg("abort",this,a,c))}return null};
function Mg(a,b,c){var d=a.h.get(b);!d||d.xg||d.Ed>d.hf?(d&&(a.g.ka(c,Jg,d.Xf),a.h.remove(b)),a=a.i,a.h.remove(c)&&a.Wc(c)):(d.Ed++,c.send(d.bj,d.Yd(),d.qa(),d.bd()))}h.H=function(){Ig.m.H.call(this);this.i.ca();this.i=null;this.g.ca();this.g=null;this.h.clear();this.h=null};function Lg(a,b,c,d){E.call(this,a,b);this.id=c;this.ud=d}A(Lg,E);
function Kg(a,b,c,d,e,f,g,k,l){this.Ae=!!l;this.bj=a;this.i=c||"GET";this.g=d;this.h=e||null;this.hf=t(g)?g:1;this.Ed=0;this.kg=this.xg=!1;this.Xf=b;this.wg=f;this.j=k||jg;this.ud=null}Kg.prototype.Yd=function(){return this.i};Kg.prototype.qa=function(){return this.g};Kg.prototype.bd=function(){return this.h};Kg.prototype.Gg=function(){return this.j};function Ng(a){for(var b=[],c=0,d=0;d<a.length;d++){for(var e=a.charCodeAt(d);255<e;)b[c++]=e&255,e>>=8;b[c++]=e}return b}function Og(a){if(8192>a.length)return String.fromCharCode.apply(null,a);for(var b="",c=0;c<a.length;c+=8192)b+=String.fromCharCode.apply(null,Jb(a,c,c+8192));return b};function Pg(){this.i=[];this.h=this.g=0};function Qg(){this.h=-1};function Rg(){this.h=-1;this.h=64;this.g=[];this.p=[];this.I=[];this.o=[];this.o[0]=128;for(var a=1;a<this.h;++a)this.o[a]=0;this.j=this.i=0;this.u()}A(Rg,Qg);Rg.prototype.u=function(){this.g[0]=1732584193;this.g[1]=4023233417;this.g[2]=2562383102;this.g[3]=271733878;this.g[4]=3285377520;this.j=this.i=0};
function Sg(a,b,c){c||(c=0);var d=a.I;if(v(b))for(var e=0;16>e;e++)d[e]=b.charCodeAt(c)<<24|b.charCodeAt(c+1)<<16|b.charCodeAt(c+2)<<8|b.charCodeAt(c+3),c+=4;else for(e=0;16>e;e++)d[e]=b[c]<<24|b[c+1]<<16|b[c+2]<<8|b[c+3],c+=4;for(e=16;80>e;e++){var f=d[e-3]^d[e-8]^d[e-14]^d[e-16];d[e]=(f<<1|f>>>31)&4294967295}b=a.g[0];c=a.g[1];for(var g=a.g[2],k=a.g[3],l=a.g[4],m,e=0;80>e;e++)40>e?20>e?(f=k^c&(g^k),m=1518500249):(f=c^g^k,m=1859775393):60>e?(f=c&g|k&(c|g),m=2400959708):(f=c^g^k,m=3395469782),f=(b<<
5|b>>>27)+f+l+m+d[e]&4294967295,l=k,k=g,g=(c<<30|c>>>2)&4294967295,c=b,b=f;a.g[0]=a.g[0]+b&4294967295;a.g[1]=a.g[1]+c&4294967295;a.g[2]=a.g[2]+g&4294967295;a.g[3]=a.g[3]+k&4294967295;a.g[4]=a.g[4]+l&4294967295}
Rg.prototype.update=function(a,b){t(b)||(b=a.length);for(var c=b-this.h,d=0,e=this.p,f=this.i;d<b;){if(0==f)for(;d<=c;)Sg(this,a,d),d+=this.h;if(v(a))for(;d<b;){if(e[f]=a.charCodeAt(d),++f,++d,f==this.h){Sg(this,e);f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,f==this.h){Sg(this,e);f=0;break}}this.i=f;this.j+=b};
Rg.prototype.l=function(){var a=[],b=8*this.j;56>this.i?this.update(this.o,56-this.i):this.update(this.o,this.h-(this.i-56));for(var c=this.h-1;56<=c;c--)this.p[c]=b&255,b/=256;Sg(this,this.p);for(c=b=0;5>c;c++)for(var d=24;0<=d;d-=8)a[b]=this.g[c]>>d&255,++b;return a};var Tg=null,Ug=null;function Vg(a){this.g=a}Vg.prototype.set=function(a,b){t(b)?this.g.set(a,Xf(b)):this.g.remove(a)};Vg.prototype.get=function(a){var b;try{b=this.g.get(a)}catch(c){return}if(null!==b)try{return Wf(b)}catch(d){throw"Storage: Invalid value was encountered";}};Vg.prototype.remove=function(a){this.g.remove(a)};function Wg(){};function Xg(a){this.g=a}A(Xg,Vg);function Yg(a){this.data=a}function Zg(a){return!t(a)||a instanceof Yg?a:new Yg(a)}function $g(a){a=a.data;if(!t(a))throw"Storage: Invalid value was encountered";return a}Xg.prototype.set=function(a,b){Xg.m.set.call(this,a,Zg(b))};Xg.prototype.cd=function(a){a=Xg.m.get.call(this,a);if(!t(a)||a instanceof Object)return a;throw"Storage: Invalid value was encountered";};Xg.prototype.get=function(a){return(a=this.cd(a))?$g(a):void 0};function ah(a){this.g=a}A(ah,Xg);ah.prototype.set=function(a,b,c){if(b=Zg(b)){if(c){if(c<z()){ah.prototype.remove.call(this,a);return}b.expiration=c}b.creation=z()}ah.m.set.call(this,a,b)};ah.prototype.cd=function(a,b){var c=ah.m.cd.call(this,a);if(c){var d;if(d=!b){d=c.creation;var e=c.expiration;d=!!e&&e<z()||!!d&&d>z()}if(d)ah.prototype.remove.call(this,a);else return c}};function bh(a){this.g=a}A(bh,ah);function ch(){}A(ch,Wg);ch.prototype.ga=function(){var a=0;Ed(this.Tb(!0),function(){a++});return a};ch.prototype.clear=function(){var a=Fd(this.Tb(!0)),b=this;vb(a,function(a){b.remove(a)})};function dh(a,b){this.g=a;this.jf=Ng(b);this.tg=new Yf}A(dh,bh);h=dh.prototype;h.jf=null;h.tg=null;
function eh(a,b){var c=new Rg;c.update(Ng(b));c.update(a.jf);c=c.l();if(!fa(c))throw Error("encodeByteArray takes an array as a parameter");if(!Tg){Tg={};Ug={};for(var d=0;65>d;d++)Tg[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d),Ug[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(d)}for(var d=Ug,e=[],f=0;f<c.length;f+=3){var g=c[f],k=f+1<c.length,l=k?c[f+1]:0,m=f+2<c.length,n=m?c[f+2]:0,p=g>>2,g=(g&3)<<4|l>>4,l=(l&15)<<2|n>>6,n=n&63;
m||(n=64,k||(l=64));e.push(d[p],d[g],d[l],d[n])}return e.join("")}
function fh(a,b,c,d){if(!(0<b.length))throw Error("Non-empty salt must be provided");var e=new Rg;e.update(Ng(c));e.update(b);e.update(a.jf);a=new Pg;var e=e.l(),f;f||(f=e.length);b=a.i;for(c=0;256>c;++c)b[c]=c;var g=0;for(c=0;256>c;++c){var g=g+b[c]+e[c%f]&255,k=b[c];b[c]=b[g];b[g]=k}a.g=0;a.h=0;f=a.g;e=a.h;b=a.i;for(c=0;1536>c;++c)f=f+1&255,e=e+b[f]&255,g=b[f],b[f]=b[e],b[e]=g;a.g=f;a.h=e;d=Ng(d);var l;l||(l=d.length);f=a.g;e=a.h;b=a.i;for(c=0;c<l;++c)f=f+1&255,e=e+b[f]&255,g=b[f],b[f]=b[e],b[e]=
g,d[c]^=b[b[f]+b[e]&255];a.g=f;a.h=e;return Og(d)}h.set=function(a,b,c){if(t(b)){for(var d=[],e=0;8>e;++e)d[e]=Math.floor(256*Math.random());e=[];Zf(this.tg,b,e);b=new Yg(fh(this,d,a,e.join("")));b.salt=d;dh.m.set.call(this,eh(this,a),b,c)}else dh.prototype.remove.call(this,a)};
h.cd=function(a,b){var c=dh.m.cd.call(this,eh(this,a),b);if(c){var d=$g(c),e=c.salt;if(!v(d)||!u(e)||!e.length)throw"Storage: Invalid value was encountered";d=fh(this,e,a,d);try{c.data=Wf(d)}catch(f){throw"Storage: The value could not be decrypted";}return c}};h.remove=function(a){dh.m.remove.call(this,eh(this,a))};function gh(a){this.g=a}A(gh,ch);h=gh.prototype;h.set=function(a,b){try{this.g.setItem(a,b)}catch(c){if(0==this.g.length)throw"Storage mechanism: Storage disabled";throw"Storage mechanism: Quota exceeded";}};h.get=function(a){a=this.g.getItem(a);if(!v(a)&&null!==a)throw"Storage mechanism: Invalid value was encountered";return a};h.remove=function(a){this.g.removeItem(a)};h.ga=function(){return this.g.length};
h.Tb=function(a){var b=0,c=this.g,d=new Cd;d.next=function(){if(b>=c.length)throw Bd;var d=c.key(b++);if(a)return d;d=c.getItem(d);if(!v(d))throw"Storage mechanism: Invalid value was encountered";return d};return d};h.clear=function(){this.g.clear()};h.key=function(a){return this.g.key(a)};function hh(){var a=null;try{a=window.localStorage||null}catch(b){}this.g=a}A(hh,gh);var ih=!C||C&&9<=xc,jh=!nc&&!C||C&&C&&9<=xc||nc&&vc("1.9.1"),kh=C&&!vc("9");function lh(a,b){this.x=t(a)?a:0;this.y=t(b)?b:0}h=lh.prototype;h.clone=function(){return new lh(this.x,this.y)};h.toString=function(){return"("+this.x+", "+this.y+")"};function mh(a,b){return new lh(a.x-b.x,a.y-b.y)}h.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};h.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};h.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function nh(a,b){this.width=a;this.height=b}h=nh.prototype;h.clone=function(){return new nh(this.width,this.height)};h.toString=function(){return"("+this.width+" x "+this.height+")"};h.Sa=function(){return!(this.width*this.height)};h.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};h.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
h.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function oh(a){return a?new ph(qh(a)):va||(va=new ph)}function rh(a,b){var c=b||document,d=null;c.querySelectorAll&&c.querySelector?d=c.querySelector("."+a):d=sh(document,"*",a,b)[0];return d||null}
function sh(a,b,c,d){a=d||a;b=b&&"*"!=b?b.toUpperCase():"";if(a.querySelectorAll&&a.querySelector&&(b||c))return a.querySelectorAll(b+(c?"."+c:""));if(c&&a.getElementsByClassName){a=a.getElementsByClassName(c);if(b){d={};for(var e=0,f=0,g;g=a[f];f++)b==g.nodeName&&(d[e++]=g);d.length=e;return d}return a}a=a.getElementsByTagName(b||"*");if(c){d={};for(f=e=0;g=a[f];f++)b=g.className,"function"==typeof b.split&&Cb(b.split(/\s+/),c)&&(d[e++]=g);d.length=e;return d}return a}
function th(a,b){Kc(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in uh?a.setAttribute(uh[d],b):wa(d,"aria-")||wa(d,"data-")?a.setAttribute(d,b):a[d]=b})}var uh={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function vh(a){a=(a||window).document;a="CSS1Compat"==a.compatMode?a.documentElement:a.body;return new nh(a.clientWidth,a.clientHeight)}function wh(a){return oc||"CSS1Compat"!=a.compatMode?a.body||a.documentElement:a.documentElement}function xh(a){return a?yh(a):window}function yh(a){return a.parentWindow||a.defaultView}function zh(a,b,c){return Ah(document,arguments)}
function Ah(a,b){var c=b[0],d=b[1];if(!ih&&d&&(d.name||d.type)){c=["<",c];d.name&&c.push(' name="',Da(d.name),'"');if(d.type){c.push(' type="',Da(d.type),'"');var e={};Sc(e,d);delete e.type;d=e}c.push(">");c=c.join("")}c=a.createElement(c);d&&(v(d)?c.className=d:u(d)?c.className=d.join(" "):th(c,d));2<b.length&&Bh(a,c,b,2);return c}function Bh(a,b,c,d){function e(c){c&&b.appendChild(v(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var f=c[d];!fa(f)||x(f)&&0<f.nodeType?e(f):vb(Ch(f)?Gb(f):f,e)}}
function Dh(a,b){Bh(qh(a),a,arguments,1)}function Eh(a){for(var b;b=a.firstChild;)a.removeChild(b)}function Fh(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)}function Gh(a){return a&&a.parentNode?a.parentNode.removeChild(a):null}function Hh(a){if(void 0!=a.firstElementChild)a=a.firstElementChild;else for(a=a.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return a}function Ih(a){return x(a)&&1==a.nodeType}
function Jh(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function qh(a){return 9==a.nodeType?a:a.ownerDocument||a.document}
function Kh(a,b){if("textContent"in a)a.textContent=b;else if(3==a.nodeType)a.data=b;else if(a.firstChild&&3==a.firstChild.nodeType){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else Eh(a),a.appendChild(qh(a).createTextNode(String(b)))}var Lh={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},Mh={IMG:" ",BR:"\n"};function Nh(a,b){b?a.tabIndex=0:(a.tabIndex=-1,a.removeAttribute("tabIndex"))}function Oh(a){a=a.getAttributeNode("tabindex");return null!=a&&a.specified}
function Ph(a){a=a.tabIndex;return ha(a)&&0<=a&&32768>a}function Qh(a){if(kh&&"innerText"in a)a=a.innerText.replace(/(\r\n|\r|\n)/g,"\n");else{var b=[];Rh(a,b,!0);a=b.join("")}a=a.replace(/ \xAD /g," ").replace(/\xAD/g,"");a=a.replace(/\u200B/g,"");kh||(a=a.replace(/ +/g," "));" "!=a&&(a=a.replace(/^\s*/,""));return a}function Sh(a){var b=[];Rh(a,b,!1);return b.join("")}
function Rh(a,b,c){if(!(a.nodeName in Lh))if(3==a.nodeType)c?b.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):b.push(a.nodeValue);else if(a.nodeName in Mh)b.push(Mh[a.nodeName]);else for(a=a.firstChild;a;)Rh(a,b,c),a=a.nextSibling}function Ch(a){if(a&&"number"==typeof a.length){if(x(a))return"function"==typeof a.item||"string"==typeof a.item;if(ia(a))return"function"==typeof a.item}return!1}
function Th(a,b,c){if(!b&&!c)return null;var d=b?b.toUpperCase():null;return Uh(a,function(a){return(!d||a.nodeName==d)&&(!c||v(a.className)&&Cb(a.className.split(/\s+/),c))})}function Uh(a,b){for(var c=0;a;){if(b(a))return a;a=a.parentNode;c++}return null}function ph(a){this.g=a||q.document||document}h=ph.prototype;h.n=function(a){return v(a)?this.g.getElementById(a):a};h.s=function(a,b,c){return Ah(this.g,arguments)};h.createElement=function(a){return this.g.createElement(a)};
function Vh(a,b){return a.g.createTextNode(String(b))}function Wh(a){return"CSS1Compat"==a.g.compatMode}function Xh(a){var b=a.g;a=wh(b);b=yh(b);return C&&vc("10")&&b.pageYOffset!=a.scrollTop?new lh(a.scrollLeft,a.scrollTop):new lh(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)}h.appendChild=function(a,b){a.appendChild(b)};h.Af=Fh;h.Hg=Gh;h.getChildren=function(a){return jh&&void 0!=a.children?a.children:wb(a.childNodes,function(a){return 1==a.nodeType})};h.Eg=Hh;h.Ki=Ih;h.contains=Jh;C&&vc(8);Uc("area base br col command embed hr img input keygen link meta param source track wbr".split(" "));function Yh(){this.g="";this.h=Zh;this.i=null}Yh.prototype.toString=function(){return"SafeHtml{"+this.g+"}"};function $h(a){if(a instanceof Yh&&a.constructor===Yh&&a.h===Zh)return a.g;Va("expected object of type SafeHtml, got '"+a+"'");return"type_error:SafeHtml"}Uc("action","cite","data","formaction","href","manifest","poster","src");Uc("link","script","style");var Zh={};function ai(a,b){var c=new Yh;c.g=a;c.i=b;return c}var bi=ai("",0);var ci={Ij:!0},di={Jj:!0};function ei(a){if(!x(a))return String(a);Va("Soy template output is unsafe for use as HTML: "+a);return"zSoyz"}var fi=/^<(body|caption|col|colgroup|head|html|tr|td|tbody|thead|tfoot)>/i;function gi(a){return a&&a.Te&&a.Te===ci?a.content:String(a).replace(hi,ii)}var ji={"\x00":"&#0;",'"':"&quot;","&":"&amp;","'":"&#39;","<":"&lt;",">":"&gt;","\t":"&#9;","\n":"&#10;","\x0B":"&#11;","\f":"&#12;","\r":"&#13;"," ":"&#32;","-":"&#45;","/":"&#47;","=":"&#61;","`":"&#96;","\u0085":"&#133;","\u00a0":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};function ii(a){return ji[a]}var hi=/[\x00\x22\x26\x27\x3c\x3e]/g;function ki(){return'<div class="setting-dialog"><form class="basic-setting"><div><input type="checkbox" name="log-on-console"/> Log on console<br /></div><div class="group-panel"><div>Gmail context panel location</div>\x3c!-- see this value in ydn.crm.ui.ContextPanelPosition --\x3e<input type="radio" name="context-panel-position" value="in"/> Inline<br /><input type="radio" name="context-panel-position" value="st"/> Stick on right side<br /><input type="radio" name="context-panel-position" value="wg"/> Inside widget panel<br /></div></form></div>'}
ki.g="templ.ydn.crm.app.setting";function li(a,b,c){cc.call(this);this.i=a;this.o=b||0;this.g=c;this.l=oa(this.j,this)}A(li,cc);li.prototype.h=0;li.prototype.H=function(){li.m.H.call(this);this.stop();delete this.i;delete this.g};function mi(a){a.stop();a.h=Vf(a.l,t(void 0)?void 0:a.o)}li.prototype.stop=function(){0!=this.h&&q.clearTimeout(this.h);this.h=0};function ni(a){a.stop();a.j()}li.prototype.j=function(){this.h=0;this.i&&this.i.call(this.g)};function oi(a,b,c){cc.call(this);this.j=a;this.i=b;this.g=c;this.h=oa(this.Ui,this)}A(oi,cc);h=oi.prototype;h.qd=!1;h.ea=null;h.stop=function(){this.ea&&(q.clearTimeout(this.ea),this.ea=null,this.qd=!1)};h.H=function(){oi.m.H.call(this);this.stop()};h.Ui=function(){this.ea=null;this.qd&&(this.qd=!1,pi(this))};function pi(a){a.ea=Vf(a.h,a.i);a.j.call(a.g)};L("ydn");var qi=Math.pow(2,3),ri=Math.pow(2,6);function si(){pd.call(this);this.key=this.g=void 0}A(si,pd);si.prototype.S=function(a,b){if("boolean"!=typeof b)throw Error("Invalid value");if("number"!=typeof a||0>a)throw Error("Invalid state");"undefined"==typeof this.g&&(this.g=0);this.g=b?this.g|a:this.g&~a};function ti(a){a.S(qi,!0);Vf(function(){this.dispatchEvent(ui)},0,a)}var ui="a";function vi(a,b,c){E.call(this,a,b);this.url=c}A(vi,E);L("ydn");function wi(a){return!v(a)||za(a)?{}:JSON.parse(a)}function xi(a){var b;try{b=yi(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""}function yi(a){return JSON.stringify(a,void 0,void 0)};function zi(a,b){if(b&&!a)throw Error("Can't create document with namespace and no root tag");if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(b||"",a||"",null);if("undefined"!=typeof ActiveXObject){var c=Ai();if(c)return a&&c.appendChild(c.createNode(1,a,b||"")),c}throw Error("Your browser does not support creating new documents");}
function Bi(a){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(a,"application/xml");if("undefined"!=typeof ActiveXObject){var b=Ai();b.loadXML(a);return b}throw Error("Your browser does not support loading xml documents");}function Ci(a){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(a);if(a=a.xml)return a;throw Error("Your browser does not support serializing XML documents");}
function Ai(){var a=new ActiveXObject("MSXML2.DOMDocument");if(a){a.resolveExternals=!1;a.validateOnParse=!1;try{a.setProperty("ProhibitDTD",!0),a.setProperty("MaxXMLSize",2048),a.setProperty("MaxElementDepth",256)}catch(b){}}return a};function Di(a){Error.captureStackTrace?Error.captureStackTrace(this,Di):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"}A(Di,Error);function Ei(a){Error.captureStackTrace?Error.captureStackTrace(this,Ei):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotSupportedException"}A(Di,Error);Ei.prototype.name="ydn.error.NotSupportedException";
function Fi(a){Error.captureStackTrace?Error.captureStackTrace(this,Fi):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"}A(Fi,Error);function Gi(a){Error.captureStackTrace?Error.captureStackTrace(this,Gi):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}A(Gi,Error);Gi.prototype.name="ydn.InternalError";
function Hi(a){Error.captureStackTrace?Error.captureStackTrace(this,Hi):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"}A(Hi,Error);Hi.prototype.name="ydn.error.ConstraintError";function Ii(a){Error.captureStackTrace?Error.captureStackTrace(this,Ii):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"}A(Di,Error);
function Ji(a){Error.captureStackTrace?Error.captureStackTrace(this,Ji):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"}A(Ji,Error);var Ki,Li,Mi,Ni;Ni=Mi=Li=Ki=!1;var Oi=gc;Oi&&(-1!=Oi.indexOf("Firefox")?Ki=!0:-1!=Oi.indexOf("Camino")||(-1!=Oi.indexOf("iPhone")||-1!=Oi.indexOf("iPod")?Li=!0:-1!=Oi.indexOf("iPad")?Mi=!0:-1!=Oi.indexOf("Chrome")?Ni=!0:-1!=Oi.indexOf("Android")||Oi.indexOf("Safari")));var Pi=Ki,Qi=Li,Ri=Mi,Si=Ni;function Ti(a){if(!u(a))throw new Di("Array required.");if(t(void 0))return a=xb(a,function(a){return a[void 0]}),Ti(a);for(var b=Number.NaN,c=-1,d=0;d<a.length;d++)!isNaN(a[d])&&(isNaN(b)||a[d]>b)&&(b=a[d],c=d);return{value:b,index:c}};function Ui(){si.call(this);this.h=null;cd(this,"user-login",this.fh,!1,this);cd(this,"user-logout",this.fh,!1,this);this.p=window.top.location.href.replace(/[?#]\S+/,"")}A(Ui,si);h=Ui.prototype;h.logger=L("ydn.api.AbstractUser");h.fh=function(){this.display?(this.display.i(this.email||""),this.isLogin()?this.l&&this.display.h(this.l):this.j&&this.display.g(this.j),ge(this.logger,"Refreshed.")):ge(this.logger,"No UI refreshed.")};
h.toJSON=function(){return{nickname:this.o,email:this.email,is_login:this.h,login_url:this.j,logout_url:this.l,user_id:this.user_id}};h.isLogin=function(){return!0===this.h};h.toString=function(){return"User:"+(!0===this.h?this.email:!1===this.h?"logout":"?")};h.od=0;
h.Lh=function(){if(this.isLogin())this.i.stop();else if(1<this.od)H(this.logger,"Cannot login to the API server, tried "+this.od+" times."),this.i.stop(),this.od=0;else{this.od++;fe(this.logger,"Sending login request.");var a=Vi(Wi),b=window.top.location.href.replace(/[?#]\S+/,"");a.request(new Xi("/rpc_login","GET",{url:b})).execute(oa(this.u,this))}};
h.refresh=function(a){!a&&this.isLogin()?ge(this.logger,"Already login"):(this.i||(this.i=new oi(this.Lh,5E3,this)),this.od=0,a=this.i,a.ea?a.qd=!0:pi(a))};function Yi(a,b,c){vi.call(this,a,b,c)}A(Yi,vi);function Zi(){Ui.call(this)}var $i;A(Zi,Ui);Zi.prototype.logger=L("ydn.api.User");
Zi.prototype.load=function(a){fe(this.logger,"getting user info");if(a.logout_url)return this.o=a.nickname,this.email=a.email,this.user_id=a.user_id,this.h=a.is_login,this.l=a.logout_url,this.j=a.login_url,fe(this.logger,a.email+" login"),this.l=a.logout_url,this.user_id=a.Id?a.Id.$t:void 0,this.h=!0,this.j=void 0,this.S(ri,!0),ti(this),!0;a.login_url&&(fe(this.logger,"NO user"),this.j=a.login_url,this.h=!1,this.email=this.user_id=this.l=this.o=void 0,this.S(ri,!0),ti(this));return!1};
Zi.prototype.u=function(a,b){ge(this.logger,"Receiving "+(aj(b)?"":"fail")+" login info from server.");if(aj(b)){var c=a.User;if(c){var d;d=this.load(c)?new Yi("user-login",this,this.l):new Yi("user-logout",this,this.j);Vf(function(){this.dispatchEvent(d)},0,this)}}else H(this.logger,"Server return error with: "+b.Qa());this.i&&this.i.stop()};
function bj(a,b){var c=new B,d=Vi(Wi);if(!d)return bc("login server not available.");var e={pm:a.p,state:Math.random().toString().substr(2,6)};if(b)for(var f in b)e[f]=b[f];d.request(new Xi("/rpc_login","GET",e)).execute(function(a,b){if(a){var d=a.User;this.load(d);c.callback(d)}else c.F(b)},a);return c};function cj(){this.g=z()}var dj=new cj;cj.prototype.set=function(a){this.g=a};cj.prototype.get=function(){return this.g};function ej(a){this.j=a||"";this.l=dj}ej.prototype.g=!0;ej.prototype.h=!1;function fj(a){a=new Date(a.l);return gj(a.getFullYear()-2E3)+gj(a.getMonth()+1)+gj(a.getDate())+" "+gj(a.getHours())+":"+gj(a.getMinutes())+":"+gj(a.getSeconds())+"."+gj(Math.floor(a.getMilliseconds()/10))}function gj(a){return 10>a?"0"+a:String(a)}function hj(a,b){var c=(a.l-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d}function ij(a){ej.call(this,a)}A(ij,ej);ij.prototype.h=!0;
ij.prototype.i=function(a){var b;switch(a.j.value){case Ud.value:b="dbg-sh";break;case Vd.value:b="dbg-sev";break;case Wd.value:b="dbg-w";break;case Xd.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.j," ");this.g&&c.push("[",fj(a),"] ");c.push("[",La(hj(a,this.l.get())),"s] ");c.push("[",Da(a.h),"] ");c.push('<span class="',b,'">',Ca(La(Da(a.getMessage()))));this.h&&a.i&&c.push("<br>",Ca(La(a.g||"")));c.push("</span>");c.push("<br>");return c.join("")};
function jj(a){ej.call(this,a)}A(jj,ej);jj.prototype.i=function(a){var b=[];b.push(this.j," ");this.g&&b.push("[",fj(a),"] ");b.push("[",hj(a,this.l.get()),"s] ");b.push("[",a.h,"] ");b.push(a.getMessage());this.h&&a.i&&b.push("\n",a.g);b.push("\n");return b.join("")};function kj(){this.j=oa(this.o,this);this.g=new jj;this.g.g=!1;this.h=this.g.h=!1;this.i="";this.l={}}function lj(a){var b=mj;if(a!=b.h){var c=ke();a?de(c,b.j):(c=c.g)&&Eb(c,b.j);b.h=a}}kj.prototype.o=function(a){if(!this.l[a.h]){var b=this.g.i(a),c=nj;if(c)switch(a.j){case Ud:oj(c,"info",b);break;case Vd:oj(c,"error",b);break;case Wd:oj(c,"warn",b);break;default:oj(c,"debug",b)}else window.opera?window.opera.postError(b):this.i+=b}};var nj=window.console;
function oj(a,b,c){if(a[b])a[b](c);else a.log(c)};function pj(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d}h=pj.prototype;h.clone=function(){return new pj(this.top,this.right,this.bottom,this.left)};h.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"};h.contains=function(a){return this&&a?a instanceof pj?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom:!1};
h.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};h.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};h.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};function qj(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}h=qj.prototype;h.clone=function(){return new qj(this.left,this.top,this.width,this.height)};h.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"};h.contains=function(a){return a instanceof qj?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};
h.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};h.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};h.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function rj(a,b){var c=qh(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))?c[b]||c.getPropertyValue(b)||"":""}function sj(a,b){return rj(a,b)||(a.currentStyle?a.currentStyle[b]:null)||a.style&&a.style[b]}function tj(a){return sj(a,"position")}function uj(a,b,c){var d,e=nc&&(jc||kc)&&vc("1.9");b instanceof lh?(d=b.x,b=b.y):(d=b,b=c);a.style.left=vj(d,e);a.style.top=vj(b,e)}
function wj(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}C&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function xj(a){if(C&&!(C&&8<=xc))return a.offsetParent;var b=qh(a),c=sj(a,"position"),d="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=sj(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null}
function yj(a){for(var b=new pj(0,Infinity,Infinity,0),c=oh(a),d=c.g.body,e=c.g.documentElement,f=wh(c.g);a=xj(a);)if(!(C&&0==a.clientWidth||oc&&0==a.clientHeight&&a==d)&&a!=d&&a!=e&&"visible"!=sj(a,"overflow")){var g=zj(a),k;k=a;if(nc&&!vc("1.9")){var l=parseFloat(rj(k,"borderLeftWidth"));if(Aj(k))var m=k.offsetWidth-k.clientWidth-l-parseFloat(rj(k,"borderRightWidth")),l=l+m;k=new lh(l,parseFloat(rj(k,"borderTopWidth")))}else k=new lh(k.clientLeft,k.clientTop);g.x+=k.x;g.y+=k.y;b.top=Math.max(b.top,
g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}d=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,d);b.top=Math.max(b.top,f);c=vh(yh(c.g));b.right=Math.min(b.right,d+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null}
function zj(a){var b,c=qh(a),d=sj(a,"position"),e=nc&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==d&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new lh(0,0),g;b=c?qh(c):document;g=!C||C&&9<=xc||Wh(oh(b))?b.documentElement:b.body;if(a==g)return f;if(a.getBoundingClientRect)b=wj(a),a=Xh(oh(c)),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!e)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=
b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);if(oc&&"fixed"==tj(b)){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(mc||oc&&"absolute"==d)f.y-=c.body.offsetTop;for(b=a;(b=xj(b))&&b!=c.body&&b!=g;)f.x-=b.scrollLeft,mc&&"TR"==b.tagName||(f.y-=b.scrollTop)}return f}function Bj(a,b,c){if(b instanceof nh)c=b.height,b=b.width;else if(void 0==c)throw Error("missing height argument");a.style.width=vj(b,!0);a.style.height=vj(c,!0)}
function vj(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a}function Cj(a){var b=Dj;if("none"!=sj(a,"display"))return b(a);var c=a.style,d=c.display,e=c.visibility,f=c.position;c.visibility="hidden";c.position="absolute";c.display="inline";a=b(a);c.display=d;c.position=f;c.visibility=e;return a}function Dj(a){var b=a.offsetWidth,c=a.offsetHeight,d=oc&&!b&&!c;return t(b)&&!d||!a.getBoundingClientRect?new nh(b,c):(a=wj(a),new nh(a.right-a.left,a.bottom-a.top))}
function Ej(a){var b=zj(a);a=Cj(a);return new qj(b.x,b.y,a.width,a.height)}function Fj(a,b){var c=a.style;"opacity"in c?c.opacity=b:"MozOpacity"in c?c.MozOpacity=b:"filter"in c&&(c.filter=""===b?"":"alpha(opacity="+100*b+")")}function Q(a,b){a.style.display=b?"":"none"}function Aj(a){return"rtl"==sj(a,"direction")}var Gj=nc?"MozUserSelect":oc?"WebkitUserSelect":null;
function Hj(a,b,c){c=c?null:a.getElementsByTagName("*");if(Gj){if(b=b?"none":"",a.style[Gj]=b,c){a=0;for(var d;d=c[a];a++)d.style[Gj]=b}}else if(C||mc)if(b=b?"on":"",a.setAttribute("unselectable",b),c)for(a=0;d=c[a];a++)d.setAttribute("unselectable",b)}function Ij(a,b){if(/^\d+px?$/.test(b))return parseInt(b,10);var c=a.style.left,d=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var e=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=d;return e}
function Jj(a,b){var c=a.currentStyle?a.currentStyle[b]:null;return c?Ij(a,c):0}var Kj={thin:2,medium:4,thick:6};function Lj(a,b){if("none"==(a.currentStyle?a.currentStyle[b+"Style"]:null))return 0;var c=a.currentStyle?a.currentStyle[b+"Width"]:null;return c in Kj?Kj[c]:Ij(a,c)}
function Mj(a){if(C&&!(C&&9<=xc)){var b=Lj(a,"borderLeft"),c=Lj(a,"borderRight"),d=Lj(a,"borderTop");a=Lj(a,"borderBottom");return new pj(d,c,a,b)}b=rj(a,"borderLeftWidth");c=rj(a,"borderRightWidth");d=rj(a,"borderTopWidth");a=rj(a,"borderBottomWidth");return new pj(parseFloat(d),parseFloat(c),parseFloat(a),parseFloat(b))}var Nj=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;function Oj(a){this.j=oa(this.l,this);this.g=new ij;this.h=this.g.g=!1;this.C=a;this.i=this.C.ownerDocument||this.C.document;a=oh(this.C);var b=null,c=a.g;if(C&&c.createStyleSheet)a=b=c.createStyleSheet(),C&&t(a.cssText)?a.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":
a.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}";else{c=sh(a.g,"head",void 0,void 0)[0];c||(b=sh(a.g,"body",void 0,void 0)[0],c=a.s("head"),b.parentNode.insertBefore(c,b));var d=b=a.s("style");C&&t(d.cssText)?d.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":
d.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}";a.appendChild(c,b)}this.C.className+=" logdiv"}
Oj.prototype.l=function(a){var b=100>=this.C.scrollHeight-this.C.scrollTop-this.C.clientHeight,c=this.i.createElement("div");c.className="logmsg";c.innerHTML=this.g.i(a);this.C.appendChild(c);b&&(this.C.scrollTop=this.C.scrollHeight)};Oj.prototype.clear=function(){this.C.innerHTML=""};var mj=null,Pj=null;L("ydn.debug");function Qj(a,b,c){if(ha(b))b=new Td("log",b);else if(v(b)){b=b.toUpperCase();if(!ce){ce={};for(var d=0,e;e=be[d];d++)ce[e.value]=e,ce[e.name]=e}b=ce[b]||null}else b=Zd;L(a||"ydn").h=b;t(c)?Pj||(a=Pj=new Oj(c),!0!=a.h&&(c=ke(),de(c,a.j),a.h=!0),ke().h=Wd):mj||Pj||(mj=new kj,lj(!0),ke().h=Wd)}var Rj=null;function Sj(a){Rj&&setTimeout(function(){Rj.log(a)},10)};var Wi="login",Tj=L("ydn.http"),Uj={},Vj=[];var Wj,Xj={},Yj=[];function Zj(a,b){Xj[b||"default"]=a}function Vi(a){if(!t(a))return Xj["default"];for(var b=a,c=0;c<Yj.length;c++){var d=(0,Yj[c])(a);if(d){b=d;break}}return Xj[b]||null}function ak(){Wj||(Wj=new Ig);return Wj}function bk(a,b,c,d){v(a)?this.raw=a:(this.raw=null,this.status=a,this.body=b,this.headers=c||{},this.g=d)}function ck(a){if(a.raw){var b=wi(a.raw);b.gapiRequest&&(b=b.gapiRequest.data);a.status=b.status;a.g=b.statusText;a.headers=b.headers;a.body=b.body;a.raw=null}}
bk.prototype.Q=function(){ck(this);return this.status};function aj(a){ck(a);return 200<=a.status&&400>a.status}bk.prototype.Qa=function(){ck(this);return this.g||""};function dk(a){ck(a);return a.body}function ek(a,b){ck(a);return a.headers[b]}bk.prototype.bd=function(){ck(this);return this.headers};
function fk(a){var b;ck(a);"application/json"==ek(a,"content-type")?b=!0:(b=a.body,b=v(b)&&!za(b)?/^[\],:{}\s]*$/.test(b.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")):!1);return b&&v(a.body)?JSON.parse(a.body):a.body}function gk(a){return a instanceof bk?a:v(a)?new bk(a):new bk(a.status,a.body,a.headers,a.statusText)}
function Xi(a,b,c,d,e){this.path=a;this.method=b?b.toUpperCase():"GET";this.params=c||{};this.headers=d||{};this.body=e}var hk=null;function ik(a,b,c,d){this.o=t(b)?b:ak();this.l="sr"+jk++;this.p=c||0;this.j=!!d;this.g=a}var jk=0;ik.prototype.G=function(){return this.l};
ik.prototype.execute=function(a,b){var c=this.g,d=new Be(c.path),e;for(e in c.params)d.g.set(e,c.params[e]);this.o.send(this.l,d.toString(),c.method,c.body,c.headers,void 0,function(d){d=d.target;for(var e=(d.X&&4==ug(d)?d.X.getAllResponseHeaders():"").split("\n"),k={},l=0;l<e.length;l++){var m=e[l].indexOf(":");0<m&&(k[e[l].substr(0,m).toLowerCase()]=e[l].substr(m+1).trim())}e=l=wg(d);if(k["content-type"]&&/json/.test(k["content-type"]))if(x(l))e=l;else if(v(l))try{e=wi(l)}catch(n){e=l}k=new bk(d.Q(),
l,k,d.Qa());hk&&!aj(k)&&hk.log({"class":"ydn.gdata.Entry",method:"commit",context:"HTTP request",HttpRequestData:{path:c.path,uri:String(d.u),method:c.method,params:c.params,headers:c.headers,body:c.body},HttpRespondData:{status:k.Q(),statusText:k.Qa(),body:dk(k),headers:k.bd()}});a&&(a.call(b,e,k),a=null)},this.p,void 0,this.j);this.o=null};ik.prototype.toString=function(){return"HTTPRequest:"+this.l};function kk(a,b,c){this.h=a;this.i=b;this.g=null;this.cj=t(c)?c:!0}kk.prototype.request=function(a){return new lk(a,this)};function lk(a,b){ik.call(this,a,b.i);this.parent=b}A(lk,ik);var ok=new bk(0,null,null,"No access token");
lk.prototype.execute=function(a,b){function c(){this.cj?d.g.headers.Authorization="Bearer "+d.parent.g.access_token:d.g.params.access_token=d.parent.g.access_token}var d=this;d.parent.g&&d.parent.g.expires>z()?(c(),lk.m.execute.call(this,function(e,f){401==f.Q()?pk(d.parent.h).A(function(e){d.parent.g=e;c();lk.m.execute.call(d,a,b)},function(){d.parent.g=null;a.call(b,null,ok)},d):a.call(b,e,f)},this)):pk(this.parent.h).A(function(e){d.parent.g=e;c();lk.m.execute.call(this,a,b)},function(){d.parent.g=
null;a.call(b,null,ok)},this)};function R(a,b,c,d){this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d;ia(Object.freeze)&&Object.freeze(this)}R.prototype.lower=void 0;R.prototype.upper=void 0;R.prototype.toJSON=function(){return qk(this)};function rk(a){return sk(a)}R.only=function(a){return new R(a,a,!1,!1)};R.bound=function(a,b,c,d){return new R(a,b,c,d)};R.upperBound=function(a,b){return new R(void 0,a,void 0,!!b)};R.lowerBound=function(a,b){return new R(a,void 0,!!b,void 0)};
function tk(a){var b;if(u(a))b=Gb(a),b.push("\uffff");else if(v(a))b=a+"\uffff";else if(ha(a))b=a+2.220460492503131E-16,a-=2.220460492503131E-16;else return R.only(a);return R.bound(a,b,!1,!0)}function qk(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}}function uk(a){if(null==a)return null;if(a instanceof R)return a;if(x(a))return new R(a.lower,a.upper,a.lowerOpen,a.upperOpen);throw new F("Invalid key range: "+a+" of type "+typeof a);}
function sk(a){return null!=a?null!=a.upper&&null!=a.lower?vk.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):null!=a.upper?vk.upperBound(a.upper,a.upperOpen):null!=a.lower?vk.lowerBound(a.lower,a.lowerOpen):null:null}function wk(a){if(a instanceof R)return"";if(null!=a){if(x(a)){for(var b in a)if(a.hasOwnProperty(b)&&!Cb(["lower","upper","lowerOpen","upperOpen"],b))return'invalid attribute "'+b+'" in key range object';return""}return"key range must be an object"}return""}
R.prototype.Oe=function(a){var b=this.lower,c=this.upper,d=this.lowerOpen,e=this.upperOpen;null!=a.lower&&(null==this.lower||a.lower>=this.lower)&&(b=a.lower,d=a.lowerOpen||this.lowerOpen);null!=a.upper&&(null==this.upper||a.upper<=this.upper)&&(c=a.upper,e=a.upperOpen||this.upperOpen);return R.bound(b,c,d,e)};function xk(a){if(!a)return"";var b=a.lowerOpen?"(":"[";null!=a.lower&&(b+=a.lower+", ");null!=a.upper&&(b+=a.upper);return b+=a.upperOpen?")":"]"}
function yk(a,b,c,d,e){if(c)if(c.lowerOpen||c.upperOpen||null==c.lower||null==c.upper||0!==zk(c.lower,c.upper)){if(null!=c.lower){var f=c.lowerOpen?" > ":" >= ";d.push(a+f+"?");e.push(Ak(c.lower,b))}null!=c.upper&&(f=c.upperOpen?" < ":" <= ",d.push(a+f+"?"),e.push(Ak(c.upper,b)))}else d.push(a+" = ?"),e.push(Ak(c.lower,b))}var vk=q.IDBKeyRange||q.webkitIDBKeyRange||R;function Bk(a,b){var c,d;2==arguments.length&&v(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=fa(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],t(a));c++);return a}function Ck(a,b,c){if(a)if(-1==b.indexOf("."))a[b]=c;else{b=b.split(".");for(var d=b.pop(),e;e=b.shift();)x(a[e])||(a[e]={}),a=a[e];a[d]=c}}var Dk={};
function Ek(a){a=[a];for(var b=new Fk,c=0,d,e;void 0!==(e=a.pop());){0===c%4&&12<c+4&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=4,0<e.length){a.push(Dk);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=1,b.write(c),Gk(b,e);else if(e instanceof Date)c+=2,b.write(c),Gk(b,e.valueOf());else if("string"===d){c+=3;b.write(c);c=b;for(d=0;d<e.length;d++){var f=e.charCodeAt(d);126>=f?c.write(f+1):16510>=f?(f-=127,c.write(128|f>>8,f&255)):c.write(192|f>>10,f>>
2|255,(f|3)<<6)}c.write(0)}else if(e===Dk)b.write(0);else return"";c=0}return b.trim().toString()}function Hk(a){for(var b=[],c=b,d=[],e,f,g=new Ik(a);null!=g.read();)if(0===g.current)c=d.pop();else{if(null===g.current)break;do{e=g.current/4|0;a=g.current%4;for(var k=0;k<e;k++)f=[],c.push(f),d.push(c),c=f;if(0===a&&12<g.current+4)g.read();else break}while(1);1===a?c.push(Jk(g)):2===a?c.push(new Date(Jk(g))):3===a?c.push(Kk(g)):0===a&&(c=d.pop())}return b[0]}
function Gk(a,b){var c,d,e;c=b;var f=e=d=0;if(0!==c)if(isFinite(c)){0>c&&(d=1,c=-c);f=0;if(2.2250738585072014E-308<=c){for(e=c;1>e;)f--,e*=2;for(;2<=e;)f++,e/=2;e=f+1023}f=e?Math.floor(4503599627370496*(c/Math.pow(2,f)-1)):Math.floor(c/4.9E-324)}else e=2047,isNaN(c)?f=0x8000000000000:-Infinity===c&&(d=1);c=d;d=e;e=f;c&&(e=0xfffffffffffff-e,d=2047-d);a.write((c?0:128)|d>>4);a.write((d&15)<<4|0|e/281474976710656);e%=281474976710656;c=0|e/4294967296;a.write(c>>8,c&255);e%=4294967296;c=0|e/65536;a.write(c>>
8,c&255);c=e%65536;a.write(c>>8,c&255)}function Jk(a){var b=a.read()|0,c=b>>7?!1:!0,d=c?-1:1,e=(b&127)<<4,b=a.read()|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(a.read()|0):a.read()|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d}
function Kk(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=a.read();if(0===f||null==f)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")}function Ik(a){this.current=null;this.g=a;this.h=this.g.length-1;this.index=-1}
Ik.prototype.read=function(){return this.current=this.index<this.h?parseInt(this.g[++this.index]+this.g[++this.index],16):null};function Fk(){this.g=[];this.h=void 0}Fk.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.h=arguments[b].toString(16),this.g.push(2===this.h.length?this.h:this.h="0"+this.h)};Fk.prototype.trim=function(){for(var a=this.g.length;"00"===this.g[--a];);this.g.length=++a;return this};Fk.prototype.toString=function(){return this.g.length?this.g.join(""):""};
function Lk(a,b){var c=Ek(a),d=Ek(b);return c>d?1:c==d?0:-1};function Mk(a,b,c,d,e){if(!(b instanceof R))if(v(b)&&t(c)){var f,g,k,l;if("starts"==b||"^"==b)b=tk(c);else{if("<"==b||"<="==b)f=c,k="<"==b;else if(">"==b||">="==b)g=c,l=">"==b;else if("="==b||"=="==b)f=g=c;else throw new F("invalid op: "+b);if("<"==d||"<="==d)f=e,k="<"==d;else if(">"==d||">="==d)g=e,l=">"==d;else if(t(d))throw new F("invalid op2: "+d);b=R.bound(g,f,l,k)}}else b=uk(b);this.g=b;this.h=a}Mk.prototype.h="";Mk.prototype.Xd=function(){return this.h};
Mk.prototype.Oe=function(a){if(this.h!=a.h)return null;a=null!=this.g&&null!=a.g?this.g.Oe(a.g):this.g||a.g;return new Mk(this.h,a)};var Nk={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},Ok=q.IDBRequest&&"LOADING"in q.IDBRequest?q.IDBTransaction:q.webkitIDBRequest&&"LOADING"in q.webkitIDBRequest&&1===q.webkitIDBTransaction.READ_WRITE?q.webkitIDBTransaction:Nk,Pk=Ok.READ_ONLY,Qk=Ok.READ_WRITE,Rk=Ok.VERSION_CHANGE,Sk=q.indexedDB||q.mozIndexedDB||q.webkitIndexedDB||q.moz_indexedDB||q.msIndexedDB;function Tk(a,b,c,d){cc.call(this);this.h=c;this.V=c.getName();this.mb=void 0;this.j=!1;this.da=null;this.o=a;this.Sb=b;this.sa=0;this.aa=this.N=!1;this.M=d||4;this.u=this.i=this.g=void 0;this.L=function(){throw new yd;};this.Y=function(){throw new yd;};this.Na=function(){}}A(Tk,cc);h=Tk.prototype;
h.init=function(a,b,c,d,e){if(t(b)){a=this.h;var f,g=b;u(b)?(f=Uk(a,b),g=b.join(", ")):f=Vk(a,b);if(!f)throw new F('require index "'+g+'" not found in store "'+a.getName()+'"');this.mb=f.getName()}this.j=v(this.mb);this.da=c||null;this.sa=0;this.aa=this.N=!1;this.reverse="prev"==d||"prevunique"==d;this.unique="nextunique"==d||"prevunique"==d;this.Ab=d;this.nd=e;this.u=this.i=this.g=void 0};h.Ab="";h.da=null;h.unique=!1;h.reverse=!1;h.nd=!0;h.logger=L("ydn.db.core.req.AbstractCursor");
function Wk(a,b){a.Y(b);Xk(a);a.N=!0}h.xb=function(a,b,c){null==a&&(P(this.logger,this+" finished."),this.N=!0);this.g=a;this.i=b;this.u=c;this.sa++;this.N?(O(this.logger,this+" DONE."),this.L(),Xk(this)):(O(this.logger,this+" new cursor position {"+(this.j?this.g+", "+this.i:this.g)+"}"),this.L(this.g))};h.H=function(){this.o=null};h.toString=function(){return"Cursor:"+this.V+(t(this.mb)?":"+this.mb:"")+"["+(this.o?"":"~")+this.Sb+"]"};
function Xk(a){null!=a.i?a.i=Yk(a.i):a.i=void 0;null!=a.g?a.g=Yk(a.g):a.g=void 0;a.Na(a.aa,a.g,a.i)}h.open=function(a,b,c,d){this.o=a;this.Sb=b;this.N=this.aa=!1;this.g=c;this.i=d;this.openCursor(this.g,this.i)};function Zk(a){a.aa=!0;O(a.logger,a+": exit");Xk(a)}h.ga=function(){return this.sa};h.ja=function(){return this.j?this.i:this.g};h.U=function(){return this.nd?this.ja():this.u};h.Xc=function(){};h.jc=function(){};
h.restart=function(a,b){O(this.logger,this+" restarting");this.aa=this.N=!1;this.openCursor(b,a)};function $k(){};function al(a,b,c,d,e,f,g){if(!v(a))throw new TypeError("store name must be a string, but "+a+" found.");this.i=a;this.h=b;this.o=g;this.p=!!this.h;if(t(d)&&!ga(d))throw new F("reverse value must be a boolean, but "+typeof d+" found");if(t(e)&&!ga(e))throw new F("unique value must be a boolean, but "+typeof e+" found");if(t(f)&&!ga(f))throw new F("key_only value must be a boolean, but "+typeof f+" found");this.g=t(f)?f:!!v(this.h);a="next";d&&e?a="prevunique":d?a="prev":e&&(a="nextunique");this.l=
a;if(d=wk(c))throw new F("Invalid key range: "+d);this.j=sk(c);this.u=bl;this.D=NaN}A(al,$k);al.prototype.g=!0;function cl(a,b,c,d,e){if(!v(b))throw new F("index name must be string");al.call(this,a,b,c,d,e,!0)}A(cl,al);function dl(a,b,c){if(3<arguments.length)throw new F("too many argument");al.call(this,a,void 0,b,c,void 0,!1)}A(dl,al);function el(a,b,c,d,e){if(!v(b))throw new F("index name must be string");al.call(this,a,b,c,d,e,!1)}A(el,al);var bl="init";h=al.prototype;h.logger=L("ydn.db.Iterator");
h.K=function(){return this.i};h.clone=function(){var a=new al(this.i,this.h,this.j,fl(this),gl(this),this.g,this.o);a.D=this.D;return a};h.unique=function(a){return new al(this.i,this.h,this.j,fl(this),a,this.g,this.o)};h.toJSON=function(){return{store:this.i,index:this.h,keyRange:this.j?qk(this.j):null,direction:this.l}};
h.toString=function(){var a=t(this.o)?":"+this.o.join(","):t(this.h)?":"+this.h:"",a=a+xk(this.j);this.u!=bl&&(a+=this.u+"{"+this.L,this.p&&(a+=", "+this.I),a+="}");var b=this.p?"Index":"",b=b+(this.g?"Key":"Value");return b+"Iterator:"+this.i+a};h.reverse=function(){return new al(this.i,this.h,this.j,!fl(this),gl(this),this.g,this.o)};function fl(a){return"prev"===a.l||"prevunique"===a.l}function gl(a){return"nextunique"===a.l||"prevunique"===a.l}
h.load=function(a){a=a[0];a.init(this.i,this.o||this.h,this.j,this.l,this.g);this.u="busy";var b=this;a.Na=function(a,d,e){b.L=d;b.I=e;b.u=a?"rest":"done"};a.openCursor(this.L,this.I);return a};h.ja=function(){return this.I};h.stores=function(){return[this.i]};function hl(a,b,c){oe.call(this,b,c);this.D=a;this.p=[];this.L=[];this.sa=[];this.g=null;this.Sc="";this.ba=0}A(hl,oe);h=hl.prototype;h.Sc="";h.logger=L("ydn.db.Request");function il(a,b,c){a.g=b;a.Sc=c;P(a.logger,a+" BEGIN");if(b){for(c=0;c<a.L.length;c++)a.L[c][0].call(a.L[c][1],b);a.L.length=0}}function jl(a){var b=new hl(a.D);a.ba++;il(b,a.g,a.Sc+"C"+a.ba);return b}function kl(a){P(a.logger,a+" END");a.g=null}h.Yd=function(){return this.D};
h.abort=function(){P(this.logger,this+" aborting "+this.g);if(this.g)if(ia(this.g.abort))this.g.abort();else if(ia(this.g.executeSql))this.g.executeSql("ABORT",[],function(){},function(){return!0});else throw new vd;else throw new ll(this+" No active transaction");};function T(a,b,c){var d=a.sa.shift();c=!!c;d?d[0].call(d[1],b,c,function(b,c){T(a,b,c)}):c?a.F(b):a.callback(b)}function ml(a,b,c){a.sa.push([b,c])}function U(a,b,c){a.g?b.call(c,a.g):a.L.push([b,c])}
h.callback=function(a){P(this.logger,this+" SUCCESS");hl.m.callback.call(this,a)};h.F=function(a){P(this.logger,this+" ERROR");hl.m.F.call(this,a)};function nl(a){var b="";a.Sc&&(b=a.g?"*":"",b="["+a.Sc+b+"]");return a.D+b}function ol(a,b){var c=new hl(a);T(c,b);return c}h.toString=function(){return"Request:"+nl(this)};
h.Ye=function(){this.o&&this.h&&Xb(this)&&(Yb(this.o),this.o=0);this.i&&(this.i.N--,delete this.i);for(var a=this.j,b=!1;this.u.length&&!this.I;){var c=this.u.shift(),d=c[0],e=c[1],c=c[2];if(d=this.l?e:d)d=d.call(c||this.M,a),t(d)&&(this.l=this.l&&(d==a||d instanceof Error),this.j=a=d),sa(a)&&(this.I=b=!0)}this.j=a;b&&(b=oa(this.Ld,this,!0),d=oa(this.Ld,this,!1),a instanceof B?(a.A(b,d),a.aa=!0):a.then(b,d))};
h.toJSON=function(){var a=(this.Sc||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.D?this.D.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};var zk=Sk&&Sk.cmp?oa(Sk.cmp,Sk):Lk,pl=[];function ql(a){Error.captureStackTrace?Error.captureStackTrace(this,ql):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ConstraintError"}A(ql,Error);ql.prototype.name="ConstraintError";ql.prototype.toString=function(){return this.name+": "+this.message};function rl(a){Error.captureStackTrace?Error.captureStackTrace(this,rl):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"}A(rl,Error);
rl.prototype.toString=function(){return this.name+": "+this.message};function sl(a){Error.captureStackTrace?Error.captureStackTrace(this,sl):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.VersionError"}A(sl,Error);sl.prototype.name="ydn.db.VersionError";sl.prototype.toString=function(){return this.name+": "+this.message};function tl(a){Error.captureStackTrace?Error.captureStackTrace(this,tl):this.stack=Error().stack||"";a&&(this.message=String(a))}A(tl,Error);
tl.prototype.name="ydn.db.InternalError";function ll(a){Error.captureStackTrace?Error.captureStackTrace(this,ll):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"}A(ll,Error);function ul(a){Error.captureStackTrace?Error.captureStackTrace(this,ul):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"}A(ul,Error);
function vl(a){Error.captureStackTrace?Error.captureStackTrace(this,vl):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"}A(vl,Error);vl.prototype.name="NotFoundError";vl.prototype.toString=function(){return this.name+": "+this.message};function wl(a,b){Error.captureStackTrace?Error.captureStackTrace(this,wl):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"}A(wl,Error);
wl.prototype.toString=function(){return this.name+": "+this.message};function xl(a,b){Error.captureStackTrace?Error.captureStackTrace(this,xl):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"}A(xl,Error);xl.prototype.toString=function(){return this.name+": "+this.message};function yl(a){Error.captureStackTrace?Error.captureStackTrace(this,yl):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.SqlParseError"}
A(yl,Error);function zl(a){Error.captureStackTrace?Error.captureStackTrace(this,zl):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"}A(zl,Error);function Al(a,b,c){var d;if(x(a))d=a.store,b=a.id,null!=a.parent&&(c=new Al(a.parent));else if(t(b))d=a;else if(d=a.lastIndexOf("^|"),b=a,0<d&&(b=a.substr(d),c=new Al(a.substring(0,d))),b=b.split("^:"),d=b[0],b=b[1],!t(b))throw Error("Invalid key value: "+a);this.V=d;this.id=b;this.parent=c||null}h=Al.prototype;h.toJSON=function(){var a={store:this.V,id:this.id};this.parent&&(a.parent=this.parent.toJSON());return a};
h.valueOf=function(){return(this.parent?this.parent.valueOf()+"^|":"")+this.V+"^:"+this.id};h.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};h.K=function(){return this.V};h.G=function(){return this.id};function Bl(a){return u(a.id)?a.id.join("^|"):a.id instanceof Date?+a.id:a.id}h.getParent=function(){return this.parent};function Cl(a){return ha(a)||v(a)||u(a)&&zb(a,Cl)||a instanceof Date}
function Yk(a){if(fa(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};function Dl(a,b){this.g=b}Dl.prototype.logger=L("ydn.db.crud.req.RequestExecuto");Dl.prototype.toString=function(){return"RequestExecutor"};function El(a){this.i=a;this.g=null;this.h=0}El.prototype.logger=L("ydn.db.tr.Mutex");El.prototype.qb=null;function Fl(a){return!!a.g&&!a.j}El.prototype.hb=null;El.prototype.toString=function(){return"Mutex:"+("B"+this.i+"T"+this.h)+(this.g?"*":"")};function Gl(a,b,c,d,e,f){this.M=a;this.Y=b;this.g=this.l=0;this.N=d;this.D=e;this.j=c||Hl;this.u=f||0}Gl.prototype.logger=L("ydn.db.tr.Thread");Gl.prototype.type=function(){return Il(this.M)};Gl.prototype.O=function(){return this.M};Gl.prototype.Va=function(){return"B"+this.Y+"T"+this.l};var Hl="single";function Jl(a){if(a)if(ia(a.abort))a.abort();else if(ia(a.executeSql))a.executeSql("ABORT",[],null,function(){return!0});else throw new vd;else throw new ll("No active transaction");};function Kl(a,b,c,d,e,f){Gl.call(this,a,b,c,d,e,f);this.i=[];this.o=[];this.p=null;this.h=new El(b);this.I=f||0;this.L=!1}A(Kl,Gl);h=Kl.prototype;h.logger=L("ydn.db.tr.Serial");
function Ll(a,b,c){if("multi"==a.j)a:if(a=a.h,!a.qb||!a.mode||c!=a.mode&&(a.mode!=Qk||c!=Pk)||b.length>a.qb.length)b=!1;else{for(c=0;c<b.length;c++)if(-1==a.qb.indexOf(b[c])){b=!1;break a}b=!0}else if("repeat"==a.j)a:if(a=a.h,a.qb&&a.mode&&c==a.mode&&a.qb.length==b.length){for(c=0;c<b.length;c++)if(-1==a.qb.indexOf(b[c])){b=!1;break a}b=!0}else b=!1;else b="all"==a.j?!0:!1;return b}
function Ml(a){var b=0<a.i.length?a.i[0].qb:null,c=0<a.i.length?a.i[0].mode:null;return null!=b&&null!=c?Ll(a,b,c):!1}function Nl(a,b,c,d,e){O(a.logger,"push tx queue["+a.i.length+"]");a.i.push({Ud:b,qb:c,mode:d,hb:e})}h.abort=function(){P(this.logger,this+": aborting");Jl(this.p)};
h.zc=function(a,b,c,d){var e=v(b)?[b]:b;if(fa(e)){if(0==e.length)throw new F("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!v(e[f]))throw new F("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.aa&&!Cb(this.aa,e[f]))throw new F('store name "'+f+e[f]+'" in scope of '+this);}}else throw new F("store names must be an array");var g=t(c)?c:Pk,k=this;if(this.h.g||!Ol(this.O())&&this.L)Nl(this,a,b,g,d);else{var l=this.Va();d&&this.o.push(d);
if(this.I&&this.l>=this.I)throw new xd("Exceed maximum number of transactions of "+this.I);this.L=!0;this.O().transaction(function(c){var d=k.h;d.g=c;d.j=!1;d.qb=b;d.mode=g;d.h++;d.hb=null;l=k.Va();ne(k.logger,l+" BEGIN "+yi(b)+" "+g);a(k);for(a=null;Ml(k);)c=k.i.shift(),c.hb&&k.o.push(c.hb),O(k.logger,"pop tx queue"+(k.i.length+1)+" reusing T"+k.l),c.Ud()},e,g,function(a,b){ne(k.logger,l+" "+a);var c=k.h;c.g?(c.g=null,c.qb=null,c.mode=null,ia(c.hb)&&c.hb(a,b),c.hb=null):N(c.logger,c+" has no TX to be unlocked for "+
a);for(c=0;c<k.o.length;c++)(0,k.o[c])(a,b);k.o.length=0;(c=k.i.shift())&&k.zc(c.Ud,c.qb,c.mode,c.hb);k.g=0})}};h.Va=function(){var a=this.h;return"B"+a.i+"T"+a.h};h.request=function(a,b,c,d){function e(a,b){kl(f);d&&d(a,b)}var f=new hl(a);a=c||Pk;var g=this;Fl(this.h)&&Ll(this,b,a)?(b=this.h.g,this.g++,il(f,b,this.Va()+"R"+this.g),this.o.push(e)):g.zc(function(){var a=g.h.g;g.g++;il(f,a,g.Va()+"R"+g.g)},b,a,e);return f};
h.fc=function(a,b,c,d,e){d=d||Pk;var f=this,g;if(Fl(f.h)&&Ll(this,c,d)){var k=f.h.g;f.g++;g=f.Va()+"R"+f.g;P(f.logger,g+" BEGIN");b(k,g,function(b,c){f.p=k;c?(P(f.logger,g+" ERROR"),a.F(b)):(P(f.logger,g+" SUCCESS"),a.callback(b));f.p=null});P(f.logger,g+" END");b=null}else f.zc(function(){var c=f.h.g;f.g++;g=f.Va()+"R"+f.g;P(f.logger,g+" BEGIN");b(c,g,function(b,d){f.p=c;d?(P(f.logger,g+" ERROR"),a.F(b)):(P(f.logger,g+" SUCCESS"),a.callback(b));f.p=null});P(f.logger,g+" END");b=null},c,d,e)};
h.getName=function(){return this.O().getName()};h.toString=function(){return"Serial:"+this.Va()+(this.p?"*":"")};function Pl(a,b){Kl.call(this,a,b)}A(Pl,Kl);Pl.prototype.logger=L("ydn.db.tr.AtomicSerial");Pl.prototype.request=function(a,b,c){var d,e,f,g=Pl.m.request.call(this,a,b,c,function(a,b){kl(g);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new zl;T(g,c,!0)}});ml(g,function(a,b,c){f=b;e=a;d=c});return g};
Pl.prototype.fc=function(a,b,c,d,e){var f,g,k=new B;k.A(function(a){g=!1;f=a},function(a){g=!0;f=a});Pl.m.fc.call(this,k,b,c,d,function(b,c){if("complete"!=b)a.F(c);else if(!0===g)a.F(f);else if(!1===g)a.callback(f);else{var d=new zl;a.F(d)}e&&(e(b,c),e=void 0)})};Pl.prototype.toString=function(){return"Atomic"+Pl.m.toString.call(this)};function Ql(a,b,c,d){this.j=a;this.h=b;this.g=c;this.ab=d;this.i=null}Ql.prototype.logger=L("ydn.db.tr.DbOperator");Ql.prototype.abort=function(){this.g.abort()};function V(a){a.i||(a.i=a.j.L());return a.i}Ql.prototype.O=function(){return this.j};
function Rl(a,b){var c=a.O(),d=b instanceof Sl?b:Tl(b),e=b.name,f=W(c.h,e);if(0==Ul(d,f).length)ac(!1);else if(f=f?"update":"add",c.h instanceof Vl)Wl(c.h,d),c.i?(c.i.close(),c.i=null,Xl(c)):ac(!1);else throw new Hi("Cannot "+f+" store: "+e+". Not auto schema generation mode.");}Ql.prototype.toString=function(){return"TxStorage:"+this.O().getName()};function Yl(a,b,c,d){Ql.call(this,a,b,c,d)}A(Yl,Ql);h=Yl.prototype;h.logger=L("ydn.db.crud.DbOperator");
h.count=function(a,b,c,d){var e,f,g,k;if(null!=a)if(u(a)){if(t(c)||t(b))throw new F("too many arguments.");f=a;for(var l=0;l<f.length;l++)if(!Zl(this.h,f[l]))throw new F('store name "'+f[l]+'" at '+l+" not found.");P(this.logger,"countStores: "+yi(f));e=this.g.request("count",f);U(e,function(){V(this).Md(e,f)},this)}else if(v(a)){l=W(this.h,a);if(!l)throw new F('store name "'+a+'" not found.');if(t(d)&&!ga(d))throw new F('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(v(b))if(g=
b,x(c)){var m=wk(c);if(m)throw new F("invalid key range: "+xi(c)+" "+m);k=sk(c)}else{if(null!=c)throw new F("invalid key range: "+xi(c)+" of type "+typeof c);k=null}else if(x(b)||null==b)if(x(b)){if(m=wk(b))throw new F("invalid key range: "+xi(b)+" "+m);k=sk(b)}else{if(null!=b)throw new F("key range must be  an object but found "+xi(b)+" of type "+typeof b);k=null}else throw new F('invalid second argument for count "'+xi(c)+'" of type '+typeof b);P(this.logger,"countKeyRange: "+a+" "+(g?g:"")+yi(k));
e=this.g.request("count",f);$l(l,e,arguments);U(e,function(){V(this).Yc(e,f[0],k,g,!!d)},this)}else throw new F("Invalid store name or store names.");else N(this.logger,"count method requires store name(s)"),l=am(this.h),e=this.g.request("count",l),ml(e,function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),U(e,function(){V(this).Md(e,f)},this);return e};
h.get=function(a,b){var c=this,d;if(a instanceof Al){var e=a,f=e.K(),g=W(this.h,f);if(!g){if(this.h.kb()){if(Ol(this.O()))return ol("get",void 0);d=new hl("get");this.O().gb(function(){c.get(a,b).A(function(a){d.callback(a)},function(a){d.F(a)})});return d}throw new F("Store: "+f+" not found.");}var k=e.G();P(this.logger,"getByKey: "+f+":"+k);d=this.g.request("get:key",[f]);$l(g,d,arguments,void 0,this);U(d,function(){V(this).Wd(d,f,k)},this)}else if(v(a)&&t(b)){var l=a,g=W(this.h,l);if(!g){if(this.h.kb()){if(Ol(this.O()))return ol("get",
void 0);d=new hl("get");this.O().gb(function(){c.get(a,b).A(function(a){d.callback(a)},function(a){d.F(a)})});return d}throw new F('Store name "'+l+'" not found.');}var m=b;P(this.logger,"getById: "+l+":"+m);d=this.g.request("get",[l]);$l(g,d,arguments,void 0,this);U(d,function(){V(this).Wd(d,l,m)},this)}else throw new F("get require valid input arguments.");return d};
h.keys=function(a,b,c,d,e,f,g){var k,l,m=null,n=!1,p=!1,r=a,s=W(this.h,r);if(!v(r))throw new F("store name must be a string, but "+r+" of type "+typeof r+" is not.");if(!this.h.kb()){if(!s)throw new F('store name "'+r+'" not found.');if(v(b)&&!Vk(s,b))throw new F('index "'+b+'" not found in store "'+r+'".');}if(this.h.kb()&&!s)return ol("keys",[]);var w;if(v(b)){var y=b,G=wk(c);if(G)throw new F("invalid key range: "+c+" "+G);m=sk(c);if(ha(d))k=d;else{if(t(d))throw new F("limit must be a number");
k=100}if(ha(e))l=e;else{if(t(e))throw new F("offset must be a number");l=0}if(t(f))if(ga(f))n=f;else throw new F("reverse must be a boolean");if(t(g))if(ga(g))p=g;else throw new F("unique must be a boolean");P(this.logger,"keysByIndexKeyRange: "+r);w=this.g.request("keys:iter:index",[r]);$l(s,w,arguments);U(w,function(){V(this).list(w,2,r,y,m,k,l,n,p)},this)}else{if(x(b)){if(G=wk(b))throw new F("invalid key range: "+xi(b)+" "+G);m=sk(b)}else{if(null!=b)throw new F("invalid key range: "+xi(b)+" of type "+
typeof b);m=null}if(ha(c))k=c;else{if(t(c))throw new F("limit must be a number");k=100}if(ha(d))l=d;else{if(t(d))throw new F("offset must be a number");l=0}if(t(e))if(ga(e))n=e;else throw new F("reverse must be a boolean");P(this.logger,"keysByKeyRange: "+r);w=this.g.request("keys",[r]);$l(s,w,arguments);U(w,function(){V(this).list(w,2,r,null,m,k,l,n,!1)},this)}return w};
h.values=function(a,b,c,d,e,f,g){var k=this,l,m,n,p=!1,r=!1;if(v(a)){var s=a,w=W(this.h,s);if(!w){if(this.h.kb()){if(Ol(this.O()))return ol("values",[]);l=new hl("values");this.O().gb(function(){k.values(a,b,c,d,e,f).A(function(a){l.callback(a)},function(a){l.F(a)})});return l}throw new vl(s);}if(u(b)){if(t(c)||t(d))throw new F("too many input arguments");var y=b;P(this.logger,"listByIds: "+s+" "+y.length+" ids");l=this.g.request("values:array",[s]);$l(w,l,arguments,void 0,this);U(l,function(){V(this).Ff(l,
s,y)},this)}else if(v(b)){var G=b;if(!bm(w,G))throw new F('index "'+G+'" not found in store "'+s+'"');var D=wk(c);if(D)throw new F("invalid key range: "+c+" "+D);var I=sk(c);if(t(d))if(ha(d))m=d;else throw new F("limit must be a number.");else m=100;if(t(e))if(ha(e))n=e;else throw new F("offset must be a number.");else n=0;if(ga(f))p=f;else if(t(f))throw new F("reverse must be a boolean, but "+f);if(t(g))if(ga(g))r=g;else throw new F("unique must be a boolean");P(this.logger,"listByIndexKeyRange: "+
s+":"+G);l=this.g.request("values:iter:index",[s]);$l(w,l,arguments);U(l,function(){V(this).list(l,4,s,G,I,m,n,p,r)},this)}else{I=null;if(x(b)){if(D=wk(b))throw new F("invalid key range: "+b+" "+D);I=sk(b)}else if(null!=b)throw new F('expect key range object, but found "'+xi(b)+'" of type '+typeof b);if(t(c))if(ha(c))m=c;else throw new F("limit must be a number, but "+c+" is "+typeof c);else m=100;if(t(d))if(ha(d))n=d;else throw new F("offset must be a number, but "+d+" is "+typeof d);else n=0;if(t(e))if(ga(e))p=
e;else throw new F("reverse must be a boolean, but "+e+" is "+typeof e);P(this.logger,(I?"listByKeyRange: ":"listByStore: ")+s);l=this.g.request("values",[s]);$l(w,l,arguments);U(l,function(){V(this).list(l,4,s,null,I,m,n,p,!1)},this)}}else if(u(a))if(a[0]instanceof Al){for(var w=[],S=a,D=0;D<S.length;D++){var ua=S[D].K();if(!Zl(this.h,ua)){if(this.h.kb())return w=[],w[S.length-1]=void 0,ol("get",w);throw new F("Store: "+ua+" not found.");}Cb(w,ua)||w.push(ua)}P(this.logger,"listByKeys: "+yi(w)+" "+
S.length+" keys");l=this.g.request("values:keys",w);U(l,function(){V(this).le(l,S)},this)}else throw new F("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found.");else throw new F("first argument "+a+" is invalid.");return l};
h.list=function(a,b,c,d,e,f,g,k,l){var m=W(this.h,b);if(!m){if(this.h.kb())return ol("get",[]);throw new vl(b);}var n;if(c&&!bm(m,c))throw new F('index "'+c+'" not found in store "'+b+'"');if(m=wk(d))throw new F("invalid key range: "+d+" "+m);var p=sk(d),r=100;if(ha(e))r=e;else if(null!=e)throw new F('limit must be a number but "'+e+'" of type '+typeof e+" found.");var s=0;if(ha(f))s=f;else if(null!=f)throw new F('offset must be a number but "'+f+'" of type '+typeof f+" found.");var w=!1;if(ga(g))w=
g;else if(null!=g)throw new F('reverse must be a boolean but "'+g+'" of type '+typeof g+" found.");var y=!1;if(ga(k))y=k;else if(null!=k)throw new F('unique must be a boolean but "'+k+'" of type '+typeof k+" found.");if(s&&l&&t(l[0]))throw new F("offset must not given when initial cursor position is defined");P(this.logger,a+": "+b+":"+c);n=this.g.request("values:iter:index",[b]);U(n,function(){V(this).list(n,a,b,c||null,p,r,s,w,y,l)},this);return n};
h.add=function(a,b,c){var d=v(a)?a:x(a)?a.name:void 0;if(!v(d))throw new F("store name "+d+" must be a string, but "+typeof d);var e=W(this.h,d);if(!e){if(!this.h.kb())throw new F('store name "'+d+'" not found.');e=Tl(x(a)?a:{name:d});P(this.logger,"Adding object store: "+d);Rl(this,e)}else if(this.h.kb()&&x(a)&&(a=Tl(a),a=Ul(e,a)))throw new vd(a);var f;if(!e)throw new F('store name "'+d+'" not found.');if(v(e.keyPath)&&t(c))throw new F("key must not be provided while the store uses in-line key.");
if(!e.keyPath&&!e.autoIncrement&&!t(c))throw new F("out-of-line key must be provided.");if(u(b)){P(this.logger,"addObjects: "+d+" "+b.length+" objects");for(a=0;a<b.length;a++)cm(e,b[a]);f=this.g.request("add:array",[d],Qk);U(f,function(){V(this).wb(f,!1,!1,d,b,c)},this);e.kc&&f.w(function(a){a=new dm(em,this.O(),e.getName(),a,b);this.O().cb(a)},this)}else if(x(b))a="store: "+d+" key: "+fm(e,b,c),P(this.logger,"addObject: "+a),cm(e,b),f=this.g.request("add",[d],Qk),U(f,function(){V(this).wb(f,!1,
!0,d,[b],[c])},this),e.kc&&f.w(function(a){a=new gm(em,this.O(),e.getName(),a,b);this.O().cb(a)},this);else throw new F("record must be an object or array list of objects, but "+b+" of type "+typeof b+" found.");return f};
function hm(a,b){var c=v(b)?b:x(b)?b.name:void 0;if(!v(c))throw new F("store name must be a string");var d=W(a.h,c);if(!d){if(!a.h.kb())throw new vl(c);d=Tl(x(b)?b:{name:c});P(a.logger,"Adding object store: "+c);Rl(a,d)}else if(a.h.kb()&&x(b)){var e=Tl(b);if(e=Ul(d,e))throw new vd(e);}if(!d)throw new vl(c);return d}h.load=function(a,b,c){var d=c||",",e=hm(this,a).getName();a=this.g.request("load",[e]);var f=this;this.g.fc(a,function(a,c,l){V(f).Of(a,c,l,e,b,d)},[e],Qk);return a};
h.search=function(a){var b=im(a);O(this.logger,"query "+a);var c=this.g.request("search",b,Pk);U(c,function(){var b=V(this);jm(a,function(e,f,g,k){var l=jl(c);b.list(l,4,e,f,sk(g),100,0,!1,!1);l.fa(function(b){var d=null;b instanceof Array||(d=b,b=[]);for(var e=0;e<b.length;e++){var f;f=b[e];var g=f.id,g=v(g)?Hk(g):g,k=g[3];(f=1==this.type&&k!=this.value?null:new km(this,g[0],g[2],g[1],k,f.k,f.loc))&&a.j.push(f)}a.i--;b=0==a.i?!1:a.h[a.h.length-1].l===this.l?!0:null;!0===b?pe(c,a):!1===b&&c.callback(lm(a));
if(d)throw d;},k)})},this);return c};
h.put=function(a,b,c){var d,e=this;if(a instanceof Al){var f=a,g=f.K(),k=W(this.h,g);if(!k)throw new F('store "'+g+'" not found.');if(k.keyPath){var l=fm(k,b);if(null!=l){if(0!=zk(l,f.G()))throw new F("Inline key must be "+f+" but "+l+" found.");}else mm(k,b,f.G());return this.put(g,b)}return this.put(g,b,f.G())}if(u(a)){if(t(c))throw new F("too many arguments");var m=a;if(!t(b))throw new F("record values required");for(var n=b,f=[],g=0,k=m.length;g<k;g++){l=m[g].K();-1==tb(f,l)&&f.push(l);var p=
W(this.h,l);if(!p)throw new F('store "'+l+'" not found.');p.keyPath&&mm(p,n[g],m[g].G())}P(this.logger,"putByKeys: to "+yi(f)+" "+n.length+" objects");for(g=0;g<n.length;g++)cm(p,n[g]);d=this.g.request("put:keys",f,Qk);$l(p,d,arguments);U(d,function(){V(e).te(d,n,m)},this)}else if(v(a)||x(a)){var p=hm(this,a),r=p.getName();if(p.keyPath&&t(c))throw new F("key must not be provided while the store uses in-line key.");if(!p.keyPath&&!p.autoIncrement&&!t(c))throw new F("out-of-line key must be provided.");
if(u(b)){var s=b,w=c;P(this.logger,"putObjects: "+r+" "+s.length+" objects");for(g=0;g<s.length;g++)cm(p,s[g]);d=this.g.request("put:array",[r],Qk);$l(p,d,arguments);U(d,function(){V(this).wb(d,!0,!1,r,s,w)},this);p.kc&&d.w(function(a){a=new dm(nm,this.O(),r,a,s);this.O().cb(a)},this)}else if(x(b)){var y=b,G=c;P(this.logger,"putObject: "+r+" "+(t(G)?G:"(without-key)"));if(t(q.Blob)&&y instanceof Blob&&p.Dc&&!p.keyPath&&0==p.indexes.length&&oc)d=new hl("put"),f=new FileReader,f.onload=function(a){var b=
a.target.result,c=e.g.request("put",[r],Qk);$l(p,c,[r,y,G]);U(c,function(){V(e).wb(c,!0,!0,r,[b],[G])},this);c.A(function(a){d.callback(a)},function(a){d.F(a)})},f.onerror=function(a){d.F(a)},f.onabort=function(a){d.F(a)},f.readAsDataURL(y);else{cm(p,y);d=this.g.request("put",[r],Qk);var D=[r,y,G];$l(p,d,D);U(d,function(){var a=t(G)?[D[2]]:void 0;V(e).wb(d,!0,!0,r,[D[1]],a)},this)}p.kc&&d.w(function(a){a=new gm(nm,this.O(),r,a,y);this.O().cb(a)},this)}else throw new F("put record value must be Object or array of Objects");
}else throw new F("the first argument of put must be store name, store schema or array of keys.");return d};
function om(a,b,c,d){var e=a.ab,f,g;if(v(b)){var k=W(a.h,b);if(k){if(!k.keyPath&&!k.autoIncrement&&null==d)throw new F('key required for store "'+b+'"');}else throw new vl(b);for(var l=0;l<c.length;l++)cm(k,c[l]);f=[b]}else{g=b;f=[];for(var l=0,m=g.length;l<m;l++){var n=g[l].K(),k=W(a.h,n);-1==tb(f,n)&&f.push(n);if(!k)throw new vl(n);cm(k,c[l])}}var p;v(b)?(k=W(a.h,b),p=e.request("put:array",f,Qk),U(p,function(){V(this).wb(p,!0,!1,b,c,d)},a)):(p=e.request("put:keys",f,Qk),U(p,function(){V(this).te(p,
c,g)},a));return p}function pm(a,b){for(var c=[],d=0,e=b.length;d<e;d++){var f=b[d].K();-1==tb(c,f)&&c.push(f);if(!Zl(a.h,f))throw new vl(f);}var g=a.ab.request("rm:keys",c,Qk);U(g,function(){V(this).ve(g,b)},a);return g}function qm(a,b,c){var d=a.ab.request("rm:iter",[b],Qk);U(d,function(){V(this).pd(d,b,c||null)},a);return d}
function rm(a,b,c,d,e,f,g){f=f||100;var k,l=g||0;if(g=W(a.h,b)){if(c&&!bm(g,c))throw new vl('index "'+c+'" in store "'+b+'"');}else throw new vl(b);var m=sk(d);v(c)?(k=a.ab.request("values:iter:index",[b]),U(k,function(){V(this).list(k,4,b,c,m,f,l,e,!1)},a)):(k=a.ab.request("values",[b]),U(k,function(){V(this).list(k,4,b,null,m,f,l,e,!1)},a));return k}
function sm(a,b){var c=[],d=b.length;if(0==d)return ol("keys",[]);for(var e=0;e<d;e++){var f=b[e].K();-1==tb(c,f)&&c.push(f);if(!Zl(a.h,f))throw new vl(f);}var g=a.ab.request("keys",c);U(g,function(){V(a).le(g,b)},a);return g}
function tm(a,b,c,d,e,f,g,k){var l;e=e||100;var m=W(a.h,b);if(m){if(c&&!bm(m,c))throw new vl('index "'+c+'" in store "'+b+'"');}else throw new vl(b);v(c)?(l=a.ab.request("keys:iter:index",[b]),U(l,function(){V(this).list(l,2,b,c,d,e,f,g,k)},a)):(l=a.ab.request("keys",[b]),U(l,function(){V(this).list(l,2,b,null,d,e,f,g,k)},a));return l}
h.clear=function(a,b,c){if(t(c))throw new F("too many input arguments");var d;if(v(a)){c=W(this.h,a);if(!c)throw new F('store name "'+a+'" not found.');if(x(b)){var e=sk(b);if(null===e)throw new F("clear method requires a valid non-null KeyRange object.");P(this.logger,"clearByKeyRange: "+a+":"+yi(e));d=this.g.request("clear",[a],Qk);$l(c,d,[a,e]);U(d,function(){V(this).Re(d,a,e)},this)}else{if(t(b))throw new F("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+
typeof b);P(this.logger,"clearByStore: "+a);d=this.g.request("clear",[a],Qk);U(d,function(){V(this).Kd(d,[a])},this)}}else if(!t(a)||u(a)&&v(a[0])){var f=a||am(this.h);P(this.logger,"clearByStores: "+yi(f));d=this.g.request("clear",f,Qk);U(d,function(){V(this).Kd(d,f)},this)}else throw new F('first argument "'+a+'" is invalid.');return d};
h.remove=function(a,b,c){var d;if(v(a)){var e=W(this.h,a);if(!e)throw new F('store name "'+a+'" not found.');if(t(c))if(v(b)){var f=Vk(e,b);if(!f)throw new F("index: "+b+" not found in "+a);if(x(c)||null===c){var g=sk(c);P(this.logger,"removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.g.request("rm:iter:index",[a],Qk);U(d,function(){V(this).Pf(d,a,f.getName(),g)},this)}else throw new F("key range "+c+' is invalid type "'+typeof c+'".');}else throw new F('index name "'+b+'" must be a string, but '+
typeof b+" found.");else if(v(b)||ha(b)||fa(b)||b instanceof Date){P(this.logger,"removeById: "+a+":"+b);d=this.g.request("rm",[a],Qk);var k=[a,b];$l(e,d,k);U(d,function(){V(this).ue(d,a,k[1])},this);e.kc&&d.w(function(c){c=1==c?b:void 0;c=new gm(um,this.O(),a,c,void 0);this.O().cb(c)},this)}else if(x(b))g=sk(b),P(this.logger,"removeByKeyRange: "+a+":"+yi(g)),d=this.g.request("rm:iter",[a],Qk),$l(e,d,[a,g]),U(d,function(){V(this).pd(d,a,g)},this),e.kc&&d.w(function(b){var c=[];c.length=b;b=new dm(um,
this.O(),a,c,void 0);this.O().cb(b)},this);else throw new F('Invalid key or key range "'+b+'" of type '+typeof b);}else if(a instanceof Al){var l=a.K(),e=W(this.h,l);d=this.g.request("rm",[l],Qk);var m=[l,a.G()];$l(e,d,m);U(d,function(){V(this).ue(d,l,m[1])},this)}else if(u(a)){c=[];for(var e=0,n=a.length;e<n;e++){if(!(a[e]instanceof Al))throw new F("key list element at "+e+" of "+n+' must be yn.db.Key, but "'+xi(a[e])+'" ('+ea(a[e])+") is not ydn.db.Key.");var p=a[e].K();-1==tb(c,p)&&c.push(p)}if(1>
c.length)throw new F('at least one valid key required in key list "'+xi(a)+'"');d=this.g.request("rm:keys",c,Qk);U(d,function(){V(this).ve(d,a)},this)}else throw new F('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+xi(a)+'" ('+ea(a)+") found.");return d};h.toString=function(){return"DbOperator:"+this.O().getName()};function vm(a,b,c,d){Ql.call(this,a,b,c,d)}A(vm,Yl);h=vm.prototype;h.logger=L("ydn.db.core.DbOperator");h.get=function(a,b){if(a instanceof al){var c=a.K(),d=W(this.h,c);if(!d)throw new F('store "'+c+'" not found.');var e=a.h;if(t(e)&&!bm(d,e))throw new F('index "'+e+'" not found in store "'+c+'".');P(this.logger,"getByIterator:"+a);var f=this.g.request("get:iter",[c]);U(f,function(){wm(this,5,f,a,1)},this);return f}return vm.m.get.call(this,a,b)};
h.keys=function(a,b,c,d,e,f,g){if(a instanceof al){var k=100;if(ha(b)){if(k=b,1>k)throw new F("limit must be a positive value, but "+b);}else if(t(b))throw new F("limit must be a number,  but "+b);if(t(c))throw new F("offset must not be specified");P(this.logger,"keysByIterator:"+a);var l=this.g.request("keys:iter",[a.K()]);U(l,function(){a.p?wm(this,1,l,a,k):wm(this,2,l,a,k)},this);return l}return vm.m.keys.call(this,a,b,c,d,e,f,g)};
h.count=function(a,b,c,d){if(a instanceof al){if(t(b)||t(c))throw new F("too many arguments.");P(this.logger,"countIterator:"+a);var e=this.g.request("count",[a.K()]);U(e,function(){wm(this,6,e,a)},this);return e}return vm.m.count.call(this,a,b,c,d)};
h.values=function(a,b,c,d,e,f){if(a instanceof al){var g;if(ha(b)){if(g=b,1>g)throw new F("limit must be a positive value, but "+g);}else if(t(b))throw new F("limit must be a number, but "+b);if(t(c))throw new F("offset must not be specified");P(this.logger,"listByIterator:"+a);var k=this.g.request("values:iter",[a.K()]);U(k,function(){a.g?wm(this,2,k,a,g):wm(this,4,k,a,g)},this);return k}return vm.m.values.call(this,a,b,c,d,e,f)};
function xm(a,b,c){if(!u(c))throw new F("iterators argument must be an array, but "+c+" of type "+typeof c+" found");for(var d=0;d<c.length;d++)if(!(c[d]instanceof al))throw new F("Iterator at "+d+" must be cursor range iterator.");for(var e=[],d=0;d<c.length;d++)for(var f=c[d].stores(),g=0;g<f.length;g++)Cb(e,f[g])||e.push(f[g]);P(a.logger,a+": scan for "+c.length+" iterators on "+e);d=a.g.request("scan",e);a.g.fc(d,function(d,e,f){function g(b){for(var c=0;c<I.length;c++)Zk(I[c]);Db(I);P(a.logger,
r+" error");f(b,!0)}function p(d,e){if(s)throw new Gi;S++;var g=S===w,k=y[d],l=c[k],n=I[k],k=n.ja(),n=n.U();G[d]=e;D[d]=l.p?l.g?k:n:l.g?e:n;if(g){var p;p=b(G,D);g=[];l=[];k=[];n=[];if(u(p))for(var M=0;M<p.length;M++)!0===p[M]?k[M]=1:!1===p[M]?n[M]=!0:l[M]=p[M];else if(null===p)g=[];else if(t(p))if(x(p)){g=["advance","continue","continuePrimary","restart"];for(M in p)if(!Cb(g,M))throw new xd('Unknown attribute "'+M+'" in cursor advancement object');g=p.continuePrimary||[];l=p["continue"]||[];k=p.advance||
[];n=p.restart||[]}else throw new xd("scan callback output");else for(g=[],M=0;M<c.length;M++)t(y[M])&&(k[M]=1);for(M=S=p=0;M<c.length;M++)null!=g[M]||t(l[M])||null!=n[M]||null!=k[M]||S++;for(M=0;M<c.length;M++)if(null!=g[M]||t(l[M])||null!=n[M]||null!=k[M]){var nk=y[M];if(!t(nk))throw new Ii(M+" is not an iterator.");var nk=c[nk],Xe=I[M];if(null==G[M]){var $n=M+"/"+c.length;if(null!=k[M])throw new Ji(Xe+" "+$n+" must not advance "+k[M]+" steps");if(t(l[M]))throw new Ji(Xe+" "+$n+" must not continue to key "+
l[M]);if(null!=g[M])throw new Ji(Xe+" "+$n+" must not continue to primary key "+g[M]);}G[M]=void 0;D[M]=void 0;if(null!=n[M])Xe.restart();else if(t(l[M]))Xe.jc(l[M]);else if(null!=g[M])Xe.Xc(g[M]);else if(null!=k[M])Xe.advance(1);else throw new Gi(nk+": has no action");p++}if(0==p){for(M=0;M<I.length;M++)Zk(I[M]);s=!0;Db(I);P(a.logger,"success "+r);f(void 0)}}}var r=e+" "+a+" scanning";O(a.logger,r);var s=!1,w,y=[],G=[],D=[],I=[],S=0;(function(){for(var b=0,f=0;f<c.length;f++){var m=c[f],r=[V(a).h(d,
e,m.K())],m=m.load(r);m.Y=g;m.L=pa(p,b);I[f]=m;y[b]=f;b++}w=c.length})()},e,Pk);return d}
h.open=function(a,b,c,d){if(!(b instanceof al))throw new F("Second argument must be cursor range iterator.");for(var e=b.stores(),f=0;f<e.length;f++)if(!W(this.h,e[f]))throw new F('Store "'+e[f]+'" not found.');c=c||Pk;var g=this,k=this.g.request("open",b.stores(),c);P(this.logger,"open:"+c+" "+b);U(k,function(c){var e=nl(k);P(g.logger,e+" iterating "+b);for(var f=b.stores(),p=[],r=0;r<f.length;r++)p[r]=V(g).h(c,e,f[r]);var s=b.load(p);s.Y=function(a){T(k,a,!0)};s.L=function(b){null!=b?(b=a.call(d,
s),!0===b?s.restart():x(b)?!0===b.restart?s.restart(b["continue"],b.continuePrimary):null!=b["continue"]?s.jc(b["continue"]):null!=b.continuePrimary?s.Xc(b.continuePrimary):(Zk(s),T(k,void 0)):null===b?(Zk(s),T(k,void 0)):null!=b?s.jc(b):s.advance(1)):(Zk(s),T(k,void 0))}},this);return k};
h.map=function(a,b){for(var c=this,d=a.stores(),e,f=0;e=d[f];f++)if(!e)throw new F('Store "'+e+'" not found.');e=this.g.request("map",d);O(this.logger,"map:"+a);this.g.fc(e,function(d,e,f){O(c.logger,e+" iterating "+a);for(var m=a.stores(),n=[],p=0;p<m.length;p++)n[p]=V(c).h(d,e,m[p]);var r=a.load(n);r.Y=function(a){f(a,!1)};r.L=function(c){if(null!=c){var d;a.p?a.g?d=c:d=r.ja():a.g?d=c:d=r.U();b(d);r.advance(1)}else f(void 0),b=null}},d,Pk);return e};
function wm(a,b,c,d,e){var f=[],g=c.g,k=nl(c),l=k+" "+b+"ByIterator "+d;0<e&&(l+=" limit "+e);P(a.logger,l);for(var m=V(a),n=[],p=d.stores(),r=0;r<p.length;r++)n[r]=m.h(g,k,p[r]);var s=d.load(n);s.Y=function(a){Zk(s);T(c,a,!0)};var w=0,y=!1;s.L=function(d){y||(O(a.logger,l+" starting"),y=!0);null!=d?(s.ja(),w++,1==b?f.push(d):2==b?f.push(s.ja()):3==b?f.push([d,s.ja()]):6!=b&&f.push(s.U()),5==b?(Zk(s),T(c,f[0])):6==b||!t(e)||w<e?s.jc():(P(a.logger,"success:"+l+" yields "+f.length+" records"),Zk(s),
T(c,f))):(P(a.logger,"success:"+l+" yields "+f.length+" records"),Zk(s),T(c,5==b?f[0]:6==b?w:f))}};var em="created",um="deleted",nm="updated";function ym(a,b){E.call(this,a,b)}A(ym,E);ym.prototype.K=function(){return this.V};function zm(a,b,c){E.call(this,a,b);this.version=c}A(zm,ym);zm.prototype.name="ReadyEvent";zm.prototype.version=NaN;function Am(a,b,c){E.call(this,c||"error",a);this.error=b}A(Am,ym);Am.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};Am.prototype.name="ErrorEvent";Am.prototype.error=null;function Bm(a,b){Am.call(this,a,b,"fail")}A(Bm,Am);
Bm.prototype.name="FailEvent";function gm(a,b,c,d,e){E.call(this,a,b);this.V=c;this.key=d;this.value=e}A(gm,ym);gm.prototype.name="RecordEvent";gm.prototype.U=function(){return this.value};function dm(a,b,c,d,e){E.call(this,a,b);this.V=c;this.keys=d;this.values=e}A(dm,ym);dm.prototype.name="StoreEvent";dm.prototype.Pa=function(){return this.keys};dm.prototype.Ca=function(){return this.values};function Cm(a,b,c,d,e,f){t(e)||(e=u(a)?a.join(", "):a);if(null!=a&&!v(a)&&!fa(a))throw new F("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);u(a)&&Object.freeze&&Object.freeze(a);!t(a)&&t(e)&&(a=e);this.keyPath=a;this.o=fa(this.keyPath);this.h=e;this.type=Dm(b);if(t(b)){if(!t(this.type))throw new F("type invalid in index: "+this.h);if(u(this.keyPath))throw new F('composite key for store "'+this.h+'" must not specified type');}this.unique=!!c;this.multiEntry=!!d;this.p=
v(this.type)?this.type:Em;this.j=v(e)?e:u(a)?this.keyPath.join(","):a;this.i=Pa(this.j);this.g=this.o?null:this.keyPath.split(".");this.l=f||null}function Fm(a,b){if(null!=b){if(fa(a.keyPath)){for(var c=[],d=0,e=a.keyPath.length;d<e;d++){var f=Bk(b,a.keyPath[d]);c[d]=f}return c}return Bk(b,a.keyPath)}}function Gm(a,b,c){for(var d=0;d<a.g.length;d++)d==a.g.length-1?b[a.g[d]]=c:x(b[a.g[d]])||(b[a.g[d]]={})}var Em="TEXT";
function Ak(a,b){if("DATE"==b){if(a instanceof Date)return+a}else return null!=b?a:Ek(a)}function Hm(a,b){return"DATE"==b?new Date(a):t(b)?a:Hk(a)}var Im=["BLOB","DATE","INTEGER","NUMERIC",Em];function Dm(a){if(v(a))return a=tb(Im,a),Im[a]}h=Cm.prototype;h.getName=function(){return this.h};h.toJSON=function(){return{name:this.h,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};
h.clone=function(){var a=u(this.keyPath)?Gb(this.keyPath):this.keyPath;return new Cm(a,this.type,this.unique,this.multiEntry,this.h,this.l)};function Jm(a,b){return null!=a||null!=b?null!=a?null!=b?fa(a)&&fa(b)?Lb(a,b)?null:"expect: "+a+", but: "+b:Km(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null}
h.hint=function(a){if(!a)return this;var b=u(this.keyPath)?Gb(this.keyPath):this.keyPath,c=this.type;t(a.type)||"TEXT"!=c||(c=void 0);return new Cm(b,c,this.unique,this.multiEntry,a.h)};function Lm(a,b){a.l=b}h.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.g&&1<this.g.length&&(a+="Compound");return a+"Index:"+this.h};function Sl(a,b,c,d,e,f,g,k){this.h=a;if(!v(this.h))throw new F("store name must be a string");this.keyPath=t(b)?b:null;this.p=fa(this.keyPath);if(null!==this.keyPath&&!v(this.keyPath)&&!this.p)throw new F("keyPath must be a string or array");this.autoIncrement=c;var l;if(null!=d){l=Dm(d);if(!t(l))throw new F('type "'+d+'" for primary key in store "'+this.h+'" is invalid.');if(this.p)throw new F('composite key for store "'+this.h+'" must not specified type');}this.type=null!=l?l:this.autoIncrement?
"INTEGER":void 0;this.l=v(this.keyPath)?this.keyPath.split("."):[];this.indexes=e||[];this.kc=!!f;this.Dc=!!g;this.I=v(this.type)?this.type:Em;this.j=u(this.keyPath)?this.keyPath.join(","):v(this.keyPath)?this.keyPath:"_ROWID_";this.i=Pa(this.j);if(this.u=!!k){if(this.keyPath)throw new F('encrypted store "'+this.h+'" must not use inline key');if(this.autoIncrement)throw new F('encrypted store "'+this.h+'" must not use key generator');}this.o=[]}h=Sl.prototype;h.kc=!1;h.Dc=!1;
h.toJSON=function(){for(var a=[],b=0;b<this.indexes.length;b++)a.push(this.indexes[b].toJSON());return{name:this.h,keyPath:this.keyPath,autoIncrement:this.autoIncrement,type:this.type,indexes:a}};
function Tl(a){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==tb(b,c))throw new F('Unknown attribute "'+c+'"');b=[];c=a.indexes||[];if(u(c))for(var d=0;d<c.length;d++){var e;e=c[d];var f="name unique type keyPath multiEntry generator".split(" "),g=void 0;for(g in e)if(e.hasOwnProperty(g)&&-1==tb(f,g))throw new F("Unknown field: "+g+" in "+yi(e));e=new Cm(e.keyPath,e.type,e.unique,e.multiEntry,e.name,e.generator);
t(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new Sl(a.name,a.keyPath,a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)}function Mm(a,b,c,d,e,f,g){a=Nm(a,b,c,d,e,f,g);b="";0!=c&&(b+="SELECT "+a.select);b+=" FROM "+a.Ic;a.ia&&(b+=" WHERE "+a.ia);a.group&&(b+=" GROUP BY "+a.group);a.bc&&(b+=" ORDER BY "+a.bc);return b}
function Nm(a,b,c,d,e,f,g){var k={select:"",Ic:"",ia:"",group:"",bc:""},l=a.j,m=a.i,n=null;d!==l&&v(d)&&(n=Vk(a,d));var p=!!n,r=d||l,s=Pa(r),w=p?n.type:a.type,y=p&&n.multiEntry;k.Ic=Om(a);6===c?k.select="COUNT("+m+")":3===c||1===c||2===c?(k.select=m,null!=d&&d!=l&&(k.select+=", "+s)):k.select="*";d=g?"DISTINCT ":"";l=[];y?(y=Pa("ydn.db.me:"+a.getName()+":"+n.getName()),k.select=6===c?"COUNT("+d+y+"."+s+")":3===c||1===c||2===c?"DISTINCT "+Om(a)+"."+m+", "+y+"."+s+" AS "+r:"DISTINCT "+Om(a)+".*, "+
y+"."+s+" AS "+r,k.Ic=y+" INNER JOIN "+Om(a)+" USING ("+m+")",null!=e&&(yk(y+"."+s,w,e,l,b),0<l.length&&(k.ia=k.ia?k.ia+(" AND "+l.join(" AND ")):l.join(" AND ")))):null!=e&&(yk(s,w,e,l,b),0<l.length&&(k.ia=k.ia?k.ia+(" AND "+l.join(" AND ")):l.join(" AND ")));p&&!n.unique&&g&&(k.group=s);a=f?"DESC":"ASC";k.bc=s+" "+a;p&&(k.bc+=", "+m+" "+a);return k}
function Pm(a,b,c,d,e,f,g,k,l){var m,n,p,r;null!=e?(m=e.lower,n=e.upper,p=e.lowerOpen,r=e.upperOpen,f?null!=n?(e=zk(k,n),-1==e?(n=k,r=l):0==e&&(r=l||r)):(n=k,r=l):null!=m?(e=zk(k,m),1==e?(m=k,p=l):0==e&&(p=l||p)):(m=k,p=l)):f?(n=k,r=l):(m=k,p=l);e=new R(m,n,!!p,!!r);d=d?Vk(a,d):null;b=Nm(a,c,b,d?d.j:a.j,e,f,g);b="SELECT "+b.select+" FROM "+b.Ic+(b.ia?" WHERE "+b.ia:"")+(b.group?" GROUP BY "+b.group:"")+" ORDER BY "+b.bc;d&&(b+=", "+a.i+(f?"DESC":"ASC"));return b}
function Qm(a,b,c,d,e,f,g,k,l,m){var n=Vk(a,d),p=n.j;d=n.i;var r=a.i,s=l?" <":" >",s=g?s+" ":s+"= ";g=Ak(f,n.type);k=Ak(k,a.type);n="";e?(a=Nm(a,c,b,p,e,l,m),a.ia+=" AND ",n=d+s+"?",c.push(g)):(e=l?R.upperBound(f,!0):R.lowerBound(f,!0),a=Nm(a,c,b,p,e,l,m),n=a.ia,a.ia="");a.ia+="("+n+" OR ("+d+" = ? AND "+r+s+"?))";c.push(g);c.push(k);return"SELECT "+a.select+" FROM "+a.Ic+" WHERE "+a.ia+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.bc}h.clone=function(){return Tl(this.toJSON())};
h.index=function(a){return this.indexes[a]||null};function Vk(a,b){return Ab(a.indexes,function(a){return a.getName()==b})}function Uk(a,b){for(var c=0;c<a.indexes.length;c++)if(!Jm(a.indexes[c].keyPath,b))return a.indexes[c];return null}function bm(a,b){return b===a.keyPath?!0:yb(a.indexes,function(a){return a.getName()==b})}function Om(a){return Pa(a.h)}
function Rm(a,b){if(!b)return a;var c=a.autoIncrement,d=u(a.keyPath)?Gb(a.keyPath):a.keyPath,e=a.type,f=xb(a.indexes,function(a){return a.clone()});t(b.type)||"TEXT"!=e||(e=void 0);u(b.keyPath)&&v(d)&&d==b.keyPath.join(",")&&(d=Gb(b.keyPath));for(var g=0,k=b.indexes.length;g<k;g++)if(b.indexes[g].o)for(var l=b.indexes[g].getName(),m=f.length-1;0<=m;m--)if(0<=l.indexOf(f[m].getName())){f[m]=b.indexes[g].clone();break}for(g=0;g<f.length;g++)(k=Vk(b,f[g].getName()))&&(f[g]=f[g].hint(k));return new Sl(b.h,
d,c,e,f)}h.getName=function(){return this.h};function Sm(a){return!!a.keyPath}function fm(a,b,c){if(b){if(!a.keyPath&&null!=c)return c;if(a.p){c=[];for(var d=0;d<a.keyPath.length;d++)c.push(Bk(b,a.keyPath[d]));return c}if(a.keyPath)return Nc(b,a.l)}}function mm(a,b,c){for(var d=0;d<a.l.length;d++){var e=a.l[d];if(d==a.l.length-1){b[e]=c;break}t(b[e])||(b[e]={});b=b[e]}}
function Tm(a,b,c){var d=[],e=[];c=t(c)?c:fm(a,b);t(c)&&(e.push(a.i),d.push(Ak(c,a.type)));for(var f=0;f<a.indexes.length;f++){var g=a.indexes[f];if(!g.multiEntry&&g.getName()!==a.keyPath&&"_default_"!=g.getName()){var k=Fm(g,b);null!=k&&(d.push(Ak(k,g.type)),e.push(g.i))}}a.Dc?a.Dc&&!a.keyPath&&0==a.indexes.length&&(v(b)&&-1==b.indexOf(";base64,")?d.push(b):d.push(yi(b)),e.push("_default_")):(d.push(yi(b)),e.push("_default_"));a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{ug:e,ih:a,values:d,key:c}}
function Ul(a,b){if(!b)return"missing store: "+a.h;if(a.h!=b.h)return"store name, expect: "+a.h+", but: "+b.h;var c=Jm(a.keyPath,b.keyPath);if(c)return"keyPath, "+c;if(t(a.autoIncrement)&&t(b.autoIncrement)&&a.autoIncrement!=b.autoIncrement)return"autoIncrement, expect:  "+a.autoIncrement+", but: "+b.autoIncrement;if(a.indexes.length!=b.indexes.length)return"indexes length, expect:  "+a.indexes.length+", but: "+b.indexes.length;if(t(a.type)&&t(b.type)&&(fa(a.type)?!Lb(a.type,b.type):a.type!=b.type))return"data type, expect:  "+
a.type+", but: "+b.type;for(c=0;c<a.indexes.length;c++){var d=Vk(b,a.indexes[c].getName()),e;e=a.indexes[c];if(d)if(e.h!=d.h)e="name, expect: "+e.h+", but: "+d.h;else{var f=Jm(e.keyPath,d.keyPath);e=f?"keyPath, "+f:null!=e.unique&&null!=d.unique&&e.unique!=d.unique?"unique, expect: "+e.unique+", but: "+d.unique:null!=e.multiEntry&&null!=d.multiEntry&&e.multiEntry!=d.multiEntry?"multiEntry, expect: "+e.multiEntry+", but: "+d.multiEntry:t(e.type)&&t(d.type)&&(fa(e.type)?!Lb(e.type,d.type):e.type!=d.type)?
"data type, expect: "+e.type+", but: "+d.type:""}else e="no index for "+e.h;if(0<e.length)return'index "'+a.indexes[c].getName()+'" '+e}return""}function cm(a,b){if(b)for(var c=0;c<a.indexes.length;c++){var d=a.indexes[c],e=b;if(d.l){var f=d.l(e),g=typeof f;if("string"==g||"number"==g||f instanceof Date||u(f)){for(g=0;g<d.g.length-1;g++)x(e[d.g[g]])||(e[d.g[g]]={});e[d.g[d.g.length-1]]=f}}}}function Um(a,b){a.o.push(b)}
function $l(a,b,c,d,e){for(var f=0;f<a.o.length;f++)d!==f&&a.o[f].call(e,b,c)}h.toString=function(){return"Store:"+this.h+"["+this.indexes.length+"index]"};function Vm(a,b,c){if(!a||za(a))throw new F("store_name must be provided for primary full text index");if(!b||za(b))throw new F("index_name must be provided for primary full text index");this.V=a;this.g=b;this.h=c||1}Vm.prototype.K=function(){return this.V};function Wm(a,b,c,d){this.name=a;this.indexes=b;this.lang=c||"";if(-1==["","en","fr"].indexOf(this.lang))throw new F('Unsupported lang "'+c+" for full text search index "+a);this.h=d||null;this.g=null}Wm.prototype.getName=function(){return this.name};Wm.prototype.count=function(){return this.indexes.length};Wm.prototype.index=function(a){return this.indexes[a]};function Xm(a,b,c){return Ab(a.indexes,function(a){return a.K()==b&&a.g==c})}
function Ym(a){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==tb(b,c))throw new F("Unknown field: "+c+" in "+yi(a));if(!u(a.sources))throw new F("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==tb(b,c))throw new F("Unknown field: "+c+" in "+xi(a));return new Vm(a.storeName,a.keyPath,a.weight)});return new Wm(a.name,
b,a.lang)};function Zm(a,b){var c,d,e=b;if(x(a)){d=a;c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==tb(c,f))throw new F("Unknown field: "+f+" in schema.");c=d.version;var e=[],g=d.stores||[];if(!u(g))throw new F("stores must be array");for(f=0;f<g.length;f++){var k=Tl(g[f]);if(-1!=Bb(e,function(a){return a.name==k.getName()}))throw new F('duplicate store name "'+k.getName()+'".');e.push(k)}}else v(a)?c=0==a.length?void 0:parseFloat(a):ha(a)&&(c=a);if(t(c)){if(!ha(c)||0>
c)throw new F("Invalid version: "+c+" ("+a+")");isNaN(c)&&(c=void 0)}if(t(b)&&(!u(b)||0<b.length&&!(b[0]instanceof Sl)))throw new F("stores");this.version=c;this.vc=!t(this.version);this.stores=e||[];c=[];if(d&&d.fullTextCatalogs)for(f=0;f<d.fullTextCatalogs.length;f++)e=Ym(d.fullTextCatalogs[f]),c[f]=e,W(this,e.getName())||(g=[new Cm("k",Em),new Cm("v",Em)],e=new Sl(e.getName(),"id",!1,void 0,g,!1,!1,!1),this.stores.push(e));this.g=c}h=Zm.prototype;
h.toJSON=function(){var a=xb(this.stores,function(a){return a.toJSON()}),b={};b.stores=a;t(this.version)&&(b.version=this.version);return b};h.vc=!1;h.kb=function(){return!1};function am(a){return xb(a.stores,function(a){return a.getName()})}h.store=function(a){return this.stores[a]||null};h.count=function(){return this.stores.length};function W(a,b){return Ab(a.stores,function(a){return a.getName()==b})}function Zl(a,b){return yb(a.stores,function(a){return a.getName()==b})}
function $m(a,b,c,d){if(!b||a.stores.length!=b.stores.length)return"Number of store: "+a.stores.length+" vs "+b.stores.length;for(var e=0;e<a.stores.length;e++){var f=W(b,a.stores[e].getName());if(f){c&&(f=Rm(f,a.stores[e]));if(d)for(var g=f,k=a.stores[e],l=0;l<k.indexes.length;l++){var m=k.indexes[l];bm(g,m.getName())||"BLOB"!=m.type||(m=new Cm(m.keyPath,m.type,m.unique,m.multiEntry,m.getName()),g.indexes.push(m))}f=Ul(a.stores[e],f);if(0<f.length)return'store: "'+a.stores[e].getName()+'" '+f}else return'missing object store "'+
a.stores[e].getName()+'"'}return""}function an(a,b){return Ab(a.g,function(a){return a.getName()==b})};function Vl(a,b){Zm.call(this,a,b)}A(Vl,Zm);Vl.prototype.kb=function(){return!0};function Wl(a,b){a.stores.push(b)};function bn(a){return wi(yi(a))}function Km(a,b){var c;c=c||{};if(null!=a&&null!=b){if(fa(a)&&fa(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(-1==Ab(b,function(b){return Km(b,a[d])}))return!1;return!0}if(fa(a))return 1==a.length&&Km(a[0],b);if(fa(b))return 1==b.length&&Km(b[0],a);if(x(a)&&x(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=Km(a[e],b[e]);if(!f)return!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=Km(a[e],b[e]),!f))return!1;return!0}return a===b}return!1}
function cn(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return a[b]};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function dn(a,b,c){c=c||{};var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==tb(d,e))throw new F('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!u(c.mechanisms))throw new F("mechanisms attribute must be an array but "+ea(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!Cb(en,c.mechanisms[e]))throw new F('Invalid mechanism "'+c.mechanisms[e]+'"');}this.D=c.mechanisms||en;this.I=c.size;this.N=
t(c.connectionTimeout)?c.connectionTimeout:3E3;this.i=null;this.j=[];this.he=!1;var f;if(b instanceof Zm)f=b;else if(x(b))for(c.autoSchema||!t(b.stores)?f=new Vl(b):f=new Zm(b),c=b.stores?b.stores.length:0,e=0;e<c;e++)d=W(f,b.stores[e].name),b.stores[e].Sync&&this.mg(d,b.stores[e].Sync);else f=new Vl;this.h=f;for(e=0;e<this.h.count();e++)if(this.h.store(e).u)throw Error("encryption option must be defined");if(t(a)){if(this.i)throw new xd("Already connected with "+this.u);this.u=a;Xl(this)}this.p=
null;this.o=new B}dn.prototype.logger=L("ydn.db.con.Storage");function fn(a,b,c){return(a=W(a.h,b))?bm(a,c):!1}function gn(a){var b;if(t(b)){var c=function(a){b(a.toJSON());b=void 0};a.i?a.i.tb(c):a.transaction(function(b){a.i.tb(c,b)},null,Pk)}return a.h?a.h.toJSON():null}dn.prototype.getName=function(){return this.u};var en="indexeddb sqlite websql localstorage sessionstorage userdata memory".split(" ");h=dn.prototype;h.Ue=function(){return null};
function Xl(a){function b(b,e){b?(O(a.logger,a+": ready."),a.Ug=NaN,d.xd=function(b){a.cb(new Am(a,b))},d.Fe=function(b){a.cb(new Bm(a,b));a.i=null},d.se=function(b){a.cb(b)},setTimeout(function(){hn(a,e);jn(a)},10),c.callback(e)):(N(a.logger,a+": database connection fail "+e.name),setTimeout(function(){hn(a,new Bm(a,e));if(a.j){var b=a.logger;for(b&&b.info("Purging "+a.j.length+" transactions request.",void 0);b=a.j.shift();)b.hb&&b.hb("error",e)}},10),c.F(e))}for(var c=new B,d=null,e=a.D,f=0;f<
e.length;f++){var g=e[f].toLowerCase();if(d=a.Ue(g)){d=a.Ue(g);break}}null===d?(e=new Hi("No storage mechanism found."),b(!1,new Bm(a,e))):(a.init(),d.connect(a.u,a.h).A(function(){this.i=d;b(!0,new zm("ready",this,parseFloat(d.De())))},function(a){N(this.logger,this+": opening fail");b(!1,a)},a))}function Il(a){if(a.i)return a.i.Tc()}h.gb=function(a,b){this.o.fa(a,b)};function hn(a,b){setTimeout(function(){a.h.vc&&a.o.h||(b instanceof Am?a.o.F(b.error):a.o.callback(),a.cb(b))},4)}
function Ol(a){return!!a.i&&a.i.Ee()}h.init=function(){};h.close=function(){this.i&&(this.i.close(),this.i=null,O(this.logger,this+" closed"))};h.Ug=NaN;function jn(a){var b=a.j.shift();b&&(O(a.logger,"pop tx queue["+(a.j.length+1)+"]"),a.transaction(b.Ud,b.scopes,b.mode,b.hb));a.Ug=z()}
function kn(a,b,c,d,e){O(a.logger,"push tx queue["+a.j.length+"]");a.j.push({Ud:b,scopes:c,mode:d,hb:e});100<a.j.length&&0==a.j.length%100&&N(a.logger,"Transaction queue stack size is "+a.j.length+". It is too large, possibility due to incorrect usage.")}h.he=!1;
h.transaction=function(a,b,c,d){var e=b;if(v(b))e=[b];else if(null!=b)if(fa(b)){if(0==b.length)throw new F("number of store names must more than 0");for(var f=0;f<b.length;f++)if(!v(b[f]))throw new F("store name at "+f+" must be string but found "+typeof b[f]);}else throw new F("store names must be an array");else e=null;if(this.i&&this.i.Ee()&&!this.he){var g=this,k=t(c)?c:Pk;k==Rk&&(this.he=!0);this.i.Qd(function(b){a(b);a=null},e,k,function(a,b){ia(d)&&(d(a,b),d=void 0);k==Rk&&(g.he=!1);jn(g)})}else kn(this,
a,e,c,d)};h.mg=function(a){N(this.logger,"Synchronization option for "+a.getName()+" ignored.")};h.lg=function(a){N(this.logger,"Full text indexer option for "+a.getName()+" ignored.")};h.cb=function(){};h.toString=function(){return"Storage:"+this.i};function ln(a,b,c,d){this.j=a;this.l=b;this.g=Gb(c);this.h=d;this.i=[]}ln.prototype.j=null;ln.prototype.onCompleted=function(a,b){for(var c=0;c<this.i.length;c++)this.i[c](a,b);this.i.length=0;this.i=this.g=this.j=null};function mn(a,b,c){if(a.j)c&&a.i.push(c),b(a.j);else throw new yd("tx committed on ParallelTxExecutor");}ln.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.l+" mode:"+this.h+" scopes:"+yi(this.g)};function nn(a,b,c,d,e,f){Gl.call(this,a,b,c,d,e,f);this.i=this.h=null}A(nn,Gl);h=nn.prototype;h.logger=L("ydn.db.tr.Parallel");h.abort=function(){P(this.logger,this+": aborting");Jl(this.i)};
h.uh=function(a,b){var c;if("multi"==this.j)a:if(c=this.h,!c.g||!c.h||b!=c.h&&(c.h!=Qk||b!=Pk)||a.length>c.g.length)c=!1;else{for(var d=0;d<a.length;d++)if(-1==c.g.indexOf(a[d])){c=!1;break a}c=!0}else if("repeat"==this.j)a:if(c=this.h,c.g&&c.h&&b==c.h&&c.g.length==a.length){for(d=0;d<a.length;d++)if(-1==c.g.indexOf(a[d])){c=!1;break a}c=!0}else c=!1;else c="all"==this.j?!0:!1;return c};
h.zc=function(a,b,c,d){function e(c){l.l++;m=new ln(c,l.l,b,k);g=l.Va();ne(l.logger,g+" BEGIN "+yi(b)+" "+k);l.h=m;mn(l.h,a,d)}function f(a,b){ne(l.logger,g+" "+a);if(m)m.onCompleted(a,b);l.g=0}var g;this.N&&(b=this.N);this.D&&(c=this.D);var k=t(c)?c:Pk,l=this,m;if(this.h&&this.h.j&&this.uh(b,k))mn(this.h,a,d);else{if(this.u&&this.l>=this.u)throw new xd("Exceed maximum number of transactions of "+this.u);this.O().transaction(e,b,k,f)}};
h.request=function(a,b,c,d){var e=new hl(a),f=this;this.zc(function(a){f.g++;il(e,a,f.Va()+"R"+f.g)},b,c||Pk,function(a,b){kl(e);d&&d(a,b)});return e};h.fc=function(a,b,c,d,e){var f=this,g;this.zc(function(c){f.g++;g=f.Va()+"R"+f.g;P(f.logger,g+" BEGIN");b(c,g,function(b,d){f.i=c;g=f.Va()+"R"+f.g;d?(P(f.logger,g+" ERROR"),a.F(b)):(P(f.logger,g+" SUCCESS"),a.callback(b));f.i=null});b=null;P(f.logger,g+" END")},c,d,e)};h.toString=function(){return"Parallel:"+this.j+":"+this.Va()+(this.i?"*":"")};function on(a,b){nn.call(this,a,b,Hl)}A(on,nn);h=on.prototype;h.logger=L("ydn.db.tr.AtomicParallel");h.uh=function(){return!1};h.request=function(a,b,c){var d,e,f,g=this,k=on.m.request.call(this,a,b,c,function(a,b){kl(k);P(g.logger,"transaction "+a);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new zl;T(k,c,!0)}});ml(k,function(a,b,c){f=b;e=a;d=c});return k};
h.fc=function(a,b,c,d,e){var f,g,k=new B;k.A(function(a){g=!1;f=a},function(a){g=!0;f=a});on.m.fc.call(this,k,b,c,d,function(b,c){if("complete"!=b)a.F(c);else if(!0===g)a.F(f);else if(!1===g)a.callback(f);else{var d=new zl;a.F(d)}e&&(e(b,c),e=void 0)})};h.toString=function(){return"Atomic"+on.m.toString.call(this)};function pn(a,b,c){dn.call(this,a,b,c);this.l=0;a=!0;b=Hl;c&&(t(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=qn(this,b,a);this.ab=qn(this,"atomic",!1);this.g=this.Pc(c,this.ab)}A(pn,dn);pn.prototype.l=0;pn.prototype.Pc=function(a,b){return new Ql(this,this.h,a,b)};
function qn(a,b,c,d,e,f){if(c){if("multi"==b||"repeat"==b||"all"==b||b==Hl)return new Kl(a,a.l++,b,d,e,f);if("atomic"==b)return new Pl(a,a.l++);throw new F('Invalid requestType "'+b+'"');}if("multi"==b||"repeat"==b||"all"==b||b==Hl)return new nn(a,a.l++,b,d,e,f);if("atomic"==b)return new on(a,a.l++);throw new F('Invalid requestType "'+b+'"');}
pn.prototype.M=function(a,b,c){if(3<arguments.length)throw new F("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.l++;var d=b||am(this.h),e=Pk;if(c)if("readwrite"==c)e=Qk;else if("readonly"!=c)throw new F('Invalid transaction mode "'+c+'"');var f=qn(this,"all",!1,d,e,1),g=this.Pc(f,this.ab),k=new hl("run"),l=this;f.zc(function(b){O(l.logger,"executing run in transaction on "+f);il(k,b,f.Va()+"R0");a(g)},d,e,function(a){kl(k);T(k,f.l,"complete"!==
a)});return k};function rn(a,b,c){pn.call(this,a,b,c);a=this.h;for(b=0;b<a.g.length;b++){c=a.g[b];var d=W(a,c.getName());if(d){if(!bm(d,"k"))throw new F('full text index store "'+d.getName()+'" must have "keyword" index');if(!bm(d,"v"))throw new F('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.keyPath)throw new F('full text index store "'+d.getName()+'" must use "id" as key path.');}else throw new F('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=
c.index(d),f=W(a,e.K());if(f)this.lg(f,c);else throw new F('full text source store "'+e.K()+'" does not exist for full text index "'+c.getName()+'"');}}}A(rn,pn);h=rn.prototype;h.init=function(){rn.m.init.call(this)};h.Pc=function(a,b){return new Yl(this,this.h,a,b)};h.add=function(a,b,c){return this.g.add(a,b,c)};h.count=function(a,b,c,d){return this.g.count(a,b,c,d)};h.get=function(a,b){return this.g.get(a,b)};h.keys=function(a,b,c,d,e,f,g){return this.g.keys(a,b,c,d,e,f,g)};
h.values=function(a,b,c,d,e,f){return this.g.values(a,b,c,d,e,f)};h.list=function(a,b,c,d,e,f,g,k,l){return this.g.list(a,b,c,d,e,f,g,k,l)};h.load=function(a,b,c){return this.g.load(a,b,c)};h.put=function(a,b,c){return this.g.put(a,b,c)};h.clear=function(a,b,c){return this.g.clear(a,b,c)};h.remove=function(a,b,c){return this.g.remove(a,b,c)};h.toString=function(){var a="Storage:"+this.getName();Ol(this)&&(a+=" ["+Il(this)+"]");return a};function sn(a,b,c){rn.call(this,a,b,c)}A(sn,rn);sn.prototype.Pc=function(a,b){return new vm(this,this.h,a,b)};sn.prototype.open=function(a,b,c,d){return this.g.open(a,b,c,d)};function tn(a,b,c){return xm(a.g,b,c)}sn.prototype.map=function(a,b){return this.g.map(a,b)};function un(a,b,c,d){Tk.call(this,a,b,c,d);this.l=null}A(un,Tk);h=un.prototype;h.logger=L("ydn.db.core.req.IDBCursor");h.Od=function(a){(a=a.target.result)?this.xb(a.key,a.primaryKey,a.value):this.xb()};
h.openCursor=function(a,b){function c(a,b,c){p.l=n;p.l.onsuccess=oa(p.Od,p);p.xb(a,p.j?b:void 0,c);n=null}var d=this+" opening ";null!=a&&(d+="{"+a,d=null!=b?d+(";"+b+"}"):d+"}");O(this.logger,d);var e=this.da,d=this.o.objectStore(this.V),f=v(this.mb)?d.index(this.mb):null;if(t(a))var g=f?!t(b):!0,k=e?e.lower:void 0,l=e?e.upper:void 0,m=e?!!e.lowerOpen:!1,e=e?!!e.upperOpen:!1,e=rk(this.reverse?new R(k,a,m,g):new R(a,l,g,e));var n;this.nd?f?n=null!=this.Ab?f.openKeyCursor(e,this.Ab):null!=e?f.openKeyCursor(e):
f.openKeyCursor():n=null!=this.Ab?d.openCursor(e,this.Ab):null!=e?d.openCursor(e):d.openCursor():f?n=null!=this.Ab?f.openCursor(e,this.Ab):null!=e?f.openCursor(e):f.openCursor():n=null!=this.Ab?d.openCursor(e,this.Ab):null!=e?d.openCursor(e):d.openCursor();var p=this;n.onerror=function(a){var b=n.error;a.preventDefault();Wk(p,b)};null!=a?n.onsuccess=function(d){if(d=d.target.result){var e=Sk.cmp(d.key,a),f=p.reverse?-1:1;if(e==f)c(d.key,d.primaryKey,d.value);else if(e==-f)d["continue"](a);else if(null!=
b)if(Sk.cmp(d.primaryKey,b)==f)c(d.key,d.primaryKey,d.value);else d["continue"]();else d["continue"]()}else c()}:(p.l=n,p.l.onsuccess=oa(p.Od,p))};h.ge=function(){return!!this.l};h.update=function(a){var b=this.l.result;if(b){var c=new B;a=b.update(a);a.onsuccess=function(a){c.callback(a.target.result)};a.onerror=function(a){a.preventDefault();c.F(a)};return c}throw new ul("cursor gone");};
h.clear=function(){var a=this.l.result;if(a){var b=new B,a=a["delete"]();a.onsuccess=function(){b.callback(1)};a.onerror=function(a){a.preventDefault();b.F(a)};return b}throw new ul("cursor gone");};h.advance=function(a){var b=this.l.result;if(1==a)b["continue"]();else b.advance(a)};
h.Xc=function(a){var b=this.l.result,c=Sk.cmp(a,b.primaryKey);if(c!=(this.reverse?-1:1))throw new yd('continuing primary key "'+a+'" must '+(this.reverse?"lower":"higher")+' than current primary key "'+b.primaryKey+'"');var d=this;this.l.onsuccess=function(e){if(b=e.target.result)if(c=Sk.cmp(b.primaryKey,a),0==c||1==c&&!d.reverse||-1==c&&d.reverse)d.l.onsuccess=oa(d.Od,d),d.xb(b.key,d.j?b.primaryKey:void 0,b.value);else b["continue"]();else d.l.onsuccess=oa(d.Od,d),d.xb()};b["continue"]()};
h.jc=function(a){var b=this.l.result;if(null!=a)b["continue"](a);else b["continue"]()};h.H=function(){un.m.H.call(this);this.l=null};h.toString=function(){return"IDB"+un.m.toString.call(this)};function vn(a,b,c,d,e,f){B.call(this,e,f);this.p=a;this.g=[];this.L=!!b;this.Na=!!c;this.sa=!!d;for(b=this.ba=0;b<a.length;b++)a[b].A(oa(this.D,this,b,!0),oa(this.D,this,b,!1));0!=a.length||this.L||this.callback(this.g)}A(vn,B);vn.prototype.D=function(a,b,c){this.ba++;this.g[a]=[b,c];this.h||(this.L&&b?this.callback([a,c]):this.Na&&!b?this.F(c):this.ba==this.p.length&&this.callback(this.g));this.sa&&!b&&(c=null);return c};vn.prototype.F=function(a){vn.m.F.call(this,a);for(a=0;a<this.p.length;a++)Qb(this.p[a])};
function wn(a){return(new vn(a,!1,!0)).w(function(a){for(var c=[],d=0;d<a.length;d++)c[d]=a[d][1];return c})};function xn(a,b){this.g=b}A(xn,Dl);h=xn.prototype;h.logger=L("ydn.db.crud.req.IndexedDb");h.Md=function(a,b){function c(e){var f=a.g.objectStore(b[e]).count();f.onsuccess=function(f){d[e]=f.target.result;e++;e==b.length?T(a,d):c(e)};f.onerror=function(b){b.preventDefault();T(a,f.error,!0)}}var d=[];0==b.length?T(a,[]):c(0)};
h.wb=function(a,b,c,d,e,f){function g(s){if(null==e[s])if(O(n.logger,"empty object at "+s+" of "+e.length),l++,l==e.length)T(a,k,m);else{var y=s+10;y<e.length&&g(y)}var G,y=e[s];G=f&&null!=f[s]?b?r.put(y,f[s]):r.add(y,f[s]):b?r.put(y):r.add(y);G.onsuccess=function(b){l++;k[s]=b.target.result;l==e.length?T(a,c?k[0]:k,m):(b=s+10,b<e.length&&g(b))};G.onerror=function(b){l++;var f=G.error;O(n.logger,nl(a)+p+' request to "'+d+'" cause '+f.name+' for object "'+xi(e[s])+'" at index '+s+" of "+e.length+" objects.");
k[s]=f;m=!0;b.preventDefault();l==e.length?T(a,c?k[0]:k,m):(b=s+10,b<e.length&&g(b))}}var k=[],l=0,m=!1,n=this,p=b?"put":"add",r=a.g.objectStore(d);O(this.logger,nl(a)+" "+p+" "+e.length+' objects to store "'+d+'"');if(0<e.length)for(var s=0;10>s&&s<e.length;s++)g(s);else T(a,[])};
h.te=function(a,b,c){function d(l){var n=c[l],p=n.K(),r=a.g.objectStore(p),s;s=null===r.keyPath?r.put(b[l],n.G()):r.put(b[l]);s.onsuccess=function(c){f++;e[l]=c.target.result;f==b.length?T(a,e,g):(c=l+10,c<b.length&&d(c))};s.onerror=function(c){f++;N(k.logger,"request result "+c.name+' error when put keys to "'+p+'" for object "'+xi(b[l])+'" at index '+l+" of "+b.length+" objects.");e[l]=s.error;g=!0;c.preventDefault();f==b.length?T(a,e,g):(c=l+10,c<b.length&&d(c))}}var e=[],f=0,g=!1,k=this;O(this.logger,
nl(a)+" putByKeys: of "+b.length+" objects");if(0<b.length)for(var l=0;10>l&&l<b.length;l++)d(l);else T(a,e,g)};
h.Of=function(a,b,c,d,e,f){function g(){var a={},b=e.indexOf("\n",n),d=!1,s;-1==b?(d=!0,s=e.substring(n)):(s=e.substring(n,b),n=b+1);for(var b=s.split(f),I=0;I<p.length;I++){var S=b[I];r[I]&&(r[I]==Em?S=Ma(S,'"'):"INTEGER"==r[I]?S=parseInt(S,10):"NUMERIC"==r[I]&&(S=parseFloat(S)));a[p[I]]=S}var ua=l.put(a);ua.onsuccess=function(a){m.push(a.target.result);d?c(m):g()};ua.onerror=function(a){"DataError"==a.name&&(a=new rl(k+": "+s.substring(0,70)));a.preventDefault();c(ua.error,!0)}}var k=W(this.g,d),
l=a.objectStore(d),m=[],n=e.indexOf("\n"),p=e.substr(0,n).split(f),r=[];for(a=0;a<p.length;a++){var s=Vk(k,p[a]);s?r[a]=s.type:p[a]==k.keyPath&&(r[a]=k.type)}n++;O(this.logger,b+" Loading data  of "+p.length+"-fields record to "+d);g()};
h.ue=function(a,b,c){var d=a.g.objectStore(b);O(this.logger,nl(a)+" clearById: "+b+" "+c);var e=d.openCursor(vk.only(c));e.onsuccess=function(b){if(b=b.target.result){var c=b["delete"]();c.onsuccess=function(){T(a,1)};c.onerror=function(){T(a,c.error,!0)}}else T(a,0)};e.onerror=function(b){b.preventDefault();T(a,e.error,!0)}};
h.ve=function(a,b){function c(k){k++;if(k>=b.length)0<g.length?T(a,g,!0):T(a,d);else{b[k].K()!=e&&(e=b[k].K(),f=a.g.objectStore(e));var l=f["delete"](b[k].G());l.onsuccess=function(){d++;c(k)};l.onerror=function(a){a.preventDefault();g[k]=l.error;c(k)}}}var d=0,e,f;O(this.logger,nl(a)+" removeByKeys: "+b.length+" keys");var g=[];c(-1)};
h.pd=function(a,b,c){var d=a.g.objectStore(b),e=d.count(c);O(this.logger,nl(a)+" clearByKeyRange: "+b+" "+c);e.onsuccess=function(b){var e=b.target.result,k=d["delete"](c);k.onsuccess=function(){T(a,e)};k.onerror=function(){T(a,k.error,!0)}};e.onerror=function(b){b.preventDefault();T(a,e.error,!0)}};h.Re=function(a,b,c){var d=a.g.objectStore(b);O(this.logger,nl(a)+" "+b+" "+c);var e=d["delete"](c);e.onsuccess=function(){T(a,void 0)};e.onerror=function(b){b.preventDefault();T(a,e.error,!0)}};
h.Pf=function(a,b,c,d){var e=a.g.objectStore(b).index(c);O(this.logger,nl(a)+" clearByIndexKeyRange: "+b+":"+c+" "+d);var f=[],g=e.openCursor(d),k=0;g.onsuccess=function(b){var c=b.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){k++;c["continue"]()};d.onerror=function(a){f.push(d.error);a.preventDefault();c["continue"]()}}else 0<f.length?T(a,f,!0):T(a,k)};g.onerror=function(b){b.preventDefault();T(a,g.error,!0)}};
h.Kd=function(a,b){var c=b.length,d=0;O(this.logger,nl(a)+" clearByStores: "+b);for(var e=0;e<c;e++){var f=a.g.objectStore(b[e]).clear();f.onsuccess=function(){d++;d==c&&T(a,d)};f.onerror=function(b){d++;b.preventDefault();d==c&&T(a,f.error,!0)}}};
h.Wd=function(a,b,c){var d=this;O(this.logger,nl(a)+b+":"+c);var e=a.g.objectStore(b),f=e.get(c);f.onsuccess=function(b){O(d.logger,nl(a)+" record "+c+(null!=b.target.result?" ":" not ")+" exists.");var f=b.target.result;if(!e.keyPath&&0==e.indexNames.length&&oc&&v(f)&&0<=f.indexOf(";base64,")){'"'==f.charAt(0)&&'"'==f.charAt(f.length-1)&&(f=f.substr(1,f.length-2));f=f.split(";base64,");b=f[0].split(":")[1];for(var f=window.atob(f[1]),l=f.length,m=new Uint8Array(l),n=0;n<l;++n)m[n]=f.charCodeAt(n);
T(a,new Blob([m.buffer],{type:b}))}else T(a,b.target.result)};f.onerror=function(b){b.preventDefault();T(a,f.error,!0)}};
h.Ff=function(a,b,c){function d(b){if(null==c[b])if(f++,e[b]=void 0,f==k)T(a,e);else{var m=b+10;m<k&&d(m)}var n;n=g.get(c[b]);n.onsuccess=function(c){f++;e[b]=c.target.result;f==k?T(a,e):(c=b+10,c<k&&d(c))};n.onerror=function(b){f++;b.preventDefault();T(a,n.error,!0)}}var e=[];e.length=c.length;var f=0,g=a.g.objectStore(b),k=c.length;O(this.logger,nl(a)+" "+b+":"+k+" ids");if(0<k)for(b=0;10>b&&b<k;b++)d(b);else T(a,[])};
h.le=function(a,b){function c(f){var k=b[f],l=a.g.objectStore(k.K()).get(k.G());l.onsuccess=function(k){e++;d[f]=k.target.result;e==b.length?T(a,d):(k=f+10,k<b.length&&c(k))};l.onerror=function(b){e++;b.preventDefault();T(a,l.error,!0)}}var d=[];d.length=b.length;var e=0;O(this.logger,nl(a)+" "+b.length+" ids");if(0<b.length)for(var f=0;10>f&&f<b.length;f++)c(f);else T(a,[])};
h.Yc=function(a,b,c,d,e){if(d&&e)throw new xd("unique count not available in IndexedDB");e=a.g.objectStore(b);b=nl(a)+" "+b+(d?":"+d:"")+(c?":"+yi(c):"");O(this.logger,b);var f;null!=d?(d=e.index(d),f=null!=c?d.count(c):d.count()):f=null!=c?e.count(c):e.count();f.onsuccess=function(b){T(a,b.target.result)};f.onerror=function(b){b.preventDefault();T(a,f.error,!0)}};
h.list=function(a,b,c,d,e,f,g,k,l,m){var n=[],p=a.g.objectStore(c),r=k?l?"prevunique":"prev":l?"nextunique":"next";c=nl(a)+" "+b+" "+c+(d?":"+d:"")+(e?yi(e):"");k&&(c+=" reverse");l&&(c+=" unique");if(m&&t(m[0])){l=d?!t(m[1]):!0;var s=m[0],w=e?e.lower:void 0,y=e?e.upper:void 0,G=e?!!e.lowerOpen:!1;e=e?!!e.upperOpen:!1;e=rk(k?new R(w,s,G,l):new R(s,y,l,e));c+=" starting from "+yi(m[0]);t(m[1])&&(c+=", "+yi(m[1]))}O(this.logger,c);var D;D=1==b||2==b||3==b?d?p.index(d).openKeyCursor(e,r):p.openCursor(e,
r):d?p.index(d).openCursor(e,r):p.openCursor(e,r);var I=!1;D.onsuccess=function(c){if(c=c.target.result){if(!I){if(0<g){I=!0;c.advance(g);return}if(m&&d&&t(m[0]))if(t(m[1])){var e=Sk.cmp(c.key,m[0]),l=k?-1:1;if(0==e){e=Sk.cmp(c.primaryKey,m[1]);if(0==e){I=!0;c["continue"]();return}if(e==l)I=!0;else{c["continue"]();return}}else I=!0}else I=!0;else I=!0}1==b?n.push(c.key):2==b?n.push(c.primaryKey):3==b?(l={},d&&(l[d]=c.key),p.keyPath?l[p.keyPath]=c.primaryKey:l._ROWID_=c.primaryKey,n.push(l)):4==b?
n.push(c.value):n.push([c.key,c.primaryKey,c.value]);if(n.length<f)c["continue"]();else m&&(m[0]=Yk(c.key),m[1]=Yk(c.primaryKey)),T(a,n)}else m&&(m[0]=void 0,m[1]=void 0),T(a,n)};D.onerror=function(b){b.preventDefault();T(a,D.error,!0)}};function yn(a,b){this.g=b}A(yn,xn);yn.prototype.logger=L("ydn.db.core.req.IndexedDb");yn.prototype.h=function(a,b,c,d){c=W(this.g,c);return new un(a,b,c,d)};function zn(){this.g=!1}zn.prototype.g=!1;function An(a,b,c,d){Tk.call(this,a,b,c,d);this.u=this.i=this.g=void 0;this.p=this.l=null;this.D=new zn;this.xe=this.ic=null}A(An,Tk);h=An.prototype;h.logger=L("ydn.db.core.req.SimpleCursor");h.ge=function(){return!!this.o};h.update=function(a){Bn(this.xe,this.ja(),a);return ac()};h.advance=function(a){function b(b){d++;if(!b||d>=a)return Cn(c,b)}var c=this,d=this.l?-1:0;this.reverse?Dn(this.ic,b,this.l):En(this.ic,b,this.l)};
h.jc=function(a){if(null!=a){var b=this,c=new Fn(a),d=function(c){b.l=c;if(!c)return Cn(b,c);var d=zk(c.value.key,a);if(b.reverse){if(1!=d)return Cn(b,c)}else if(-1!=d)return Cn(b,c)};this.reverse?Dn(this.ic,d,c):En(this.ic,d,c)}else this.advance(1)};function Gn(a){setTimeout(function(){a.D.g?(a.D.g=!1,a.xb(a.g,a.i,a.u),Gn(a)):(a.p(),a.p=null)},4)}
function Cn(a,b){if(a.l=b){var c=b.value;if(a.da)if(a.reverse||null==a.da.upper)a.reverse&&null!=a.da.lower&&(d=zk(c.key,a.da.lower),-1==d||0==d&&a.da.lowerOpen)&&(a.l=null);else{var d=zk(c.key,a.da.upper);if(1==d||0==d&&a.da.upperOpen)a.l=null}if(a.l){if(a.unique&&null!=a.g&&null!=c.key&&0==zk(a.g,c.key))return;a.g=c.key;a.i=a.j?c.ja():a.g;4==a.M&&(a.nd?a.u=a.i:a.u=Hn(a.xe,a.i))}}a.l||(a.g=void 0,a.i=void 0,a.u=void 0);return a.D.g=!0}
h.openCursor=function(a,b){var c=null;if(this.da)if(this.reverse){var d=this.j?"\uffff":void 0;null!=this.da.upper&&(c=new Fn(this.da.upper,d))}else null!=this.da.lower&&(c=new Fn(this.da.lower));null!=a&&(c=this.j?new Fn(a,b):new Fn(a));this.p=this.o.O(function(b){function d(b){var e=b.value,f=e.key;if(b&&null!=f)if(null!=a){if(0==In(c,e))return}else if(this.da&&(!this.reverse&&this.da.lowerOpen&&null!=this.da.lower&&(e=zk(f,this.da.lower),0==e)||this.reverse&&this.da.upperOpen&&null!=this.da.upper&&
(e=zk(f,this.da.upper),0==e)))return;return Cn(this,b)}this.xe=Jn(b,this.V);this.ic=Kn(this.xe,this.mb);this.reverse?Dn(this.ic,oa(d,this),c):En(this.ic,oa(d,this),c);Gn(this)},this)};h.clear=function(){throw new wd;};h.Xc=function(){throw new wd;};h.toString=function(){return"Simple"+An.m.toString.call(this)};function Ln(a,b,c){a=["ydn.db",a];t(b)&&(a.push(b),t(c)&&(a.push(c),t(void 0)&&a.push(Ek(void 0))));return a.join("^|")};function Fn(a,b){this.key=a;this.g=b}Fn.prototype.ja=function(){return this.g};Fn.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(null!=this.g?", "+this.g+")":")")};function In(a,b){var c=zk(a.key,b.key);return 0===c?null!=a.g?null!=b.g?zk(a.g,b.g):1:null!=b.g?-1:0:c};function Mn(a){this.ub=a||Nn}function Nn(a,b){return String(a)<String(b)?-1:String(a)>String(b)?1:0}h=Mn.prototype;h.Da=null;h.ub=null;h.Pb=null;h.Nb=null;
h.add=function(a){if(null==this.Da)return this.Nb=this.Pb=this.Da=new On(a),!0;var b=null;Pn(this,function(c){var d=null,e=this.ub(c.value,a);0<e?(d=c.left,null==c.left&&(b=new On(a,c),c.left=b,c==this.Pb&&(this.Pb=b))):0>e&&(d=c.right,null==c.right&&(b=new On(a,c),c.right=b,c==this.Nb&&(this.Nb=b)));return d});b&&(Pn(this,function(a){a.count++;return a.parent},b.parent),Qn(this,b.parent));return!!b};
h.remove=function(a){var b=null;Pn(this,function(c){var d=null,e=this.ub(c.value,a);0<e?d=c.left:0>e?d=c.right:(b=c.value,Rn(this,c));return d});return b};h.clear=function(){this.Nb=this.Pb=this.Da=null};h.contains=function(a){var b=!1;Pn(this,function(c){var d=null,e=this.ub(c.value,a);0<e?d=c.left:0>e?d=c.right:b=!0;return d});return b};
h.indexOf=function(a){var b=-1,c=0;Pn(this,function(d){var e=this.ub(d.value,a);if(0<e)return d.left;d.left&&(c+=d.left.count);if(0>e)return c++,d.right;b=c;return null});return b};h.ga=function(){return this.Da?this.Da.count:0};h.Ca=function(){var a=[];Sn(this,function(b){a.push(b)});return a};
function Sn(a,b){if(a.Da){var c,d=c=Tn(a);for(c=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=c&&d.right!=c)d=d.left;else{if(d.right!=c&&b(d.value))break;var e=d,d=null!=d.right&&d.right!=c?d.right:d.parent;c=e}}}function Pn(a,b,c){for(c=c?c:a.Da;c&&null!=c;)c=b.call(a,c)}
function Qn(a,b){Pn(a,function(a){var b=a.left?a.left.height:0,e=a.right?a.right.height:0;1<b-e?(a.left.right&&(!a.left.left||a.left.left.height<a.left.right.height)&&Un(this,a.left),Vn(this,a)):1<e-b&&(a.right.left&&(!a.right.right||a.right.right.height<a.right.left.height)&&Vn(this,a.right),Un(this,a));b=a.left?a.left.height:0;e=a.right?a.right.height:0;a.height=Math.max(b,e)+1;return a.parent},b)}
function Un(a,b){Wn(b)?(b.parent.left=b.right,b.right.parent=b.parent):Xn(b)?(b.parent.right=b.right,b.right.parent=b.parent):(a.Da=b.right,a.Da.parent=null);var c=b.right;b.right=b.right.left;null!=b.right&&(b.right.parent=b);c.left=b;b.parent=c;c.count=b.count;b.count-=(c.right?c.right.count:0)+1}
function Vn(a,b){Wn(b)?(b.parent.left=b.left,b.left.parent=b.parent):Xn(b)?(b.parent.right=b.left,b.left.parent=b.parent):(a.Da=b.left,a.Da.parent=null);var c=b.left;b.left=b.left.right;null!=b.left&&(b.left.parent=b);c.right=b;b.parent=c;c.count=b.count;b.count-=(c.left?c.left.count:0)+1}
function Rn(a,b){if(null!=b.left||null!=b.right){var c=null,d;if(null!=b.left){d=Yn(a,b.left);Pn(a,function(a){a.count--;return a.parent},d);if(d!=b.left){if(d.parent.right=d.left)d.left.parent=d.parent;d.left=b.left;d.left.parent=d;c=d.parent}d.parent=b.parent;d.right=b.right;d.right&&(d.right.parent=d);b==a.Nb&&(a.Nb=d)}else{d=Tn(a,b.right);Pn(a,function(a){a.count--;return a.parent},d);if(d!=b.right){if(d.parent.left=d.right)d.right.parent=d.parent;d.right=b.right;d.right.parent=d;c=d.parent}d.parent=
b.parent;d.left=b.left;d.left&&(d.left.parent=d);b==a.Pb&&(a.Pb=d)}d.count=b.count;Wn(b)?b.parent.left=d:Xn(b)?b.parent.right=d:a.Da=d;Qn(a,c?c:d)}else Pn(a,function(a){a.count--;return a.parent},b.parent),Wn(b)?(b.parent.left=null,b==a.Pb&&(a.Pb=b.parent),Qn(a,b.parent)):Xn(b)?(b.parent.right=null,b==a.Nb&&(a.Nb=b.parent),Qn(a,b.parent)):a.clear()}function Tn(a,b){if(!b)return a.Pb;var c=b;Pn(a,function(a){var b=null;a.left&&(b=c=a.left);return b},b);return c}
function Yn(a,b){if(!b)return a.Nb;var c=b;Pn(a,function(a){var b=null;a.right&&(b=c=a.right);return b},b);return c}function On(a,b){this.value=a;this.parent=b?b:null;this.count=1}On.prototype.left=null;On.prototype.right=null;On.prototype.height=1;function Xn(a){return!!a.parent&&a.parent.right==a}function Wn(a){return!!a.parent&&a.parent.left==a};function Zn(a){this.ub=a||Nn}A(Zn,Mn);function En(a,b,c){if(a.Da){var d;if(c instanceof On)d=c;else if(c){if(Pn(a,function(a){var b=null;0<this.ub(a.value,c)?(b=a.left,d=a):0>this.ub(a.value,c)?b=a.right:d=a;return b}),!d)return}else d=Tn(a);a=d;for(var e=d.left?d.left:d;null!=a;)if(null!=a.left&&a.left!=e&&a.right!=e)a=a.left;else{if(a.right!=e&&b(a))return;var f=a;a=null!=a.right&&a.right!=e?a.right:a.parent;e=f}b(null)}}
function Dn(a,b,c){if(a.Da){var d;if(c instanceof On)d=c;else if(c){if(Pn(a,oa(function(a){var b=null;0<this.ub(a.value,c)?b=a.left:(0>this.ub(a.value,c)&&(b=a.right),d=a);return b},a)),!d)return}else d=Yn(a);a=d;for(var e=d.right?d.right:d;null!=a;)if(null!=a.right&&a.right!=e&&a.left!=e)a=a.right;else{if(a.left!=e&&b(a))return;var f=a;a=null!=a.left&&a.left!=e?a.left:a.parent;e=f}b(null)}};function ao(a,b,c){this.l=a;this.storage=b;this.h=c;this.g={};a=this.h.keyPath;this.i=u(a)?a.join(","):a||"_ROWID_";this.g[this.i]=null;this.j=Ln(this.l,this.h.getName(),this.i)+"^|"}
function Kn(a,b){var c=b||a.i;if(!a.g[c]){a.g[c]=new Zn(In);for(var d=a.storage.length,e=0;e<d;e++){var f=a.storage.key(e);if(null!==f&&wa(f,a.j)){var g=Hk(f.substr(a.j.length));if(c==a.i)a.g[c].add(new Fn(g));else{var k=a.storage.getItem(f);if(null!==k)if(f=Vk(a.h,c),k=wi(k),k=Fm(f,k),f.multiEntry){if(u(k))for(f=0;f<k.length;f++)a.g[c].add(new Fn(k[f],g))}else a.g[c].add(new Fn(k,g))}}}}return a.g[c]}
function bo(a,b,c){for(var d in a.g){var e=a.g[d];if(e)if(d==a.i)e.remove(new Fn(b));else{var f=Vk(a.h,d),f=Bk(c,f.keyPath);e.remove(new Fn(b,f))}}}function co(a){for(var b in a.g){var c=a.g[b];c&&c.clear()}a.g={}}
function Bn(a,b,c,d){if(null==b&&(a.h.keyPath&&(b=fm(a.h,c)),a.h.autoIncrement&&null==b)){b=a.j+Ek(void 0);var e=wi(a.storage.getItem(b));e.key_count||(e.key_count=0);e.key_count++;a.storage.setItem(b,yi(e));b=e.key_count}d&&(d=null!==a.storage.getItem(a.j+Ek(b)));if(d)return null;a.storage.setItem(a.j+Ek(b),yi(c));d=b;for(var f in a.g)if(e=a.g[f])if(f==a.i)e.add(new Fn(d));else{var g=Vk(a.h,f),g=Bk(c,g.keyPath);null!=g&&e.add(new Fn(d,g))}return b}
function eo(a,b){var c=a.j+Ek(b),d=a.storage.getItem(c);if(null===d)return 0;a.storage.removeItem(c);c=wi(d);bo(a,b,c);return 1}h=ao.prototype;h.clear=function(){co(this);fo(this)};function Hn(a,b){var c=a.storage.getItem(a.j+Ek(b)),d=void 0;if(null!==c)for(var d=wi(c),c=0,e=a.h.indexes.length;c<e;c++){var f=a.h.index(c);if("DATE"==f.type){var g=Fm(f,d);g&&Gm(f,d,new Date(g))}}return d}h.getName=function(){return this.h.getName()};
function go(a,b,c){b=b||a.i;a=Kn(a,b);var d=null,e=null,f=0,g=!1,k=!1;null!=c&&(null!=c.lower&&(d=new Fn(c.lower)),null!=c.upper&&(e=new Fn(c.upper)),g=c.lowerOpen,k=c.upperOpen);En(a,function(a){if(null!=a&&(a=a.value,!g||null==d||0!=zk(a.key,d.key))){if(null!=e&&(a=zk(a.key,e.key),1===a||0===a&&k))return!0;f++}},d);return f}
function fo(a,b){var c=Kn(a,a.i),d=null,e=null,f=0,g=[],k=[],l=!1,m=!1;null!=b&&(null!=b.lower&&(d=new Fn(b.lower)),null!=b.upper&&(e=new Fn(b.upper)),l=b.lowerOpen,m=b.upperOpen);En(c,function(b){if(null!=b&&(b=b.value,!l||null==d||0!=In(b,d))){if(null!=e){var c=In(b,e);if(1===c||0===c&&m)return!0}var c=a.j+Ek(b.key),r=a.storage.getItem(c);null!==r&&(a.storage.removeItem(c),f++,10>g.length&&(g.push(b.key),k.push(wi(r))))}},d);if(10>g.length)for(c=0;c<g.length;c++)bo(a,g[c],k[c]);else co(a);return f}
h.Kc=function(a,b,c,d,e,f,g,k){function l(b){if(b&&(y++,!(y<f))){var c=b.value;if(d){if(D&&null!=w&&(b=p?In(c,w):zk(c.key,w.key),0==b))return;if(null!=s&&(b=p?In(c,s):zk(c.key,s.key),-1==b||0==b&&G))return k&&(k[0]=void 0,k[1]=void 0),!0}else{if(G&&null!=s&&(b=p?In(c,s):zk(c.key,s.key),0==b))return;if(null!=w&&(b=p?In(c,w):zk(c.key,w.key),1==b||0==b&&D))return k&&(k[0]=void 0,k[1]=void 0),!0}b=c.key;if(!g||!r||null==n||0!=zk(n,b)){c=r?c.ja():b;if(2==a)m.push(c);else if(1==a)m.push(b);else if(3==a)m.push([b,
c]);else if(4==a){var l=Hn(S,c);m.push(l)}else m.push([b,c,Hn(S,c)]);k&&(k[0]=b,k[1]=c)}n=b;if(t(e)&&m.length>=e)return!0}}var m=[],n,p=!!k&&null!=k[0];b=b||this.i;var r=b!=this.i;b=Kn(this,b);var s=null,w=null;t(f)||(f=0);var y=-1,G=!1,D=!1;null!=c&&(null!=c.lower&&(s=r&&d?new Fn(c.lower,"\uffff"):new Fn(c.lower)),null!=c.upper&&(w=r&&!d?new Fn(c.upper,"\uffff"):new Fn(c.upper)),G=!!c.lowerOpen,D=!!c.upperOpen);if(p){d?D=!0:G=!0;c=k[0];var I=t(k[1])?k[1]:"\uffff";d?w=r?new Fn(c,I):new Fn(c):s=r?
new Fn(c,I):new Fn(c)}var S=this;d?Dn(b,l,w):En(b,l,s);return m};h.Pa=function(a,b,c,d,e){return this.Kc(2,a,b,c,d,e)};h.toString=function(){return"ydn.db.con.simple.Store:"+this.l+":"+this.h.getName()};function ho(){this.clear()}h=ho.prototype;h.Se=function(){return this};h.setItem=function(a,b){t(this.g[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.g[a]=b};h.getItem=function(a){return t(this.g[a])?this.g[a]:null};h.removeItem=function(a){delete this.g[a];Eb(this.keys,a.toString());this.length=this.keys.length};h.length=0;h.key=function(a){a=this.keys[a];return t(a)?this.g[a]:null};h.clear=function(){this.g={};this.keys=[];this.length=0};function jo(a){this.o=a||new ho;this.l={}}function Jn(a,b){var c=W(a.g,b);if(c)a.l[b]||(a.l[b]=new ao(a.i,a.j,c));else throw new yd('store name "'+b+'" not found.');return a.l[b]}jo.prototype.tb=function(a){var b=this;setTimeout(function(){var c=Ln(b.i),c=b.j.getItem(c),c=new Zm(c);a(c)},10)};function ko(a,b){this.h=a;this.g=b}ko.prototype.O=function(a,b){var c=this.h;setTimeout(function(){a.call(b,c)},4);var d=this;return function(){d.g("complete",null);d.g=null;d.h=null}};function lo(a,b){this.g=b}A(lo,Dl);h=lo.prototype;h.logger=L("ydn.db.crud.req.SimpleStore");h.te=function(a,b,c){this.wb(a,!0,!1,null,b,c)};
h.wb=function(a,b,c,d,e,f){O(this.logger,nl(a)+" "+(b?"put":"add")+"Object"+(c?"":"s "+e.length+" objects"));var g=a.g.O(function(k){var l;if(c)l=Jn(k,d),k=f?f[0]:void 0,k=Bn(l,k,e[0],!b),null!=k?T(a,k):(l=xi(k),l=new ql(l),T(a,l,!0));else{for(var m=d,n=[],p=!1,r=f||{},s=0;s<e.length;s++){var w;d?w=r[s]:(m=f[s],w=m.G(),m=m.K());l&&l.getName()==m||(l=Jn(k,m));w=Bn(l,w,e[s],!b);null!=w?n.push(w):(p=!0,n.push(new ql))}T(a,n,p)}g();g=null},this)};h.Of=function(){throw new wd("putData");};
h.Wd=function(a,b,c){var d=a.g.O(function(e){e=Hn(Jn(e,b),c);T(a,e);d();d=null},this)};function mo(a,b,c,d){var e=b.g.O(function(a){for(var g=[],k=c,l,m=0;m<d.length;m++){var n=d[m];n instanceof Al&&(k=n,n=k.G(),k=k.K());l&&l.getName()==k||(l=Jn(a,k));n=Hn(l,n);g[m]=n}T(b,g,!1);e();e=null},a)}h.Ff=function(a,b,c){mo(this,a,b,c)};h.le=function(a,b){mo(this,a,null,b)};
h.ue=function(a,b,c){var d=nl(a)+" removeById "+b+" "+c;O(this.logger,d);var e=this,f=a.g.O(function(g){g=eo(Jn(g,b),c);P(e.logger,"success "+d+(0==g?" [not found]":""));T(a,g);f();f=null},this)};h.ve=function(a,b){O(this.logger,nl(a)+" removeByKeys "+b.length+" keys");var c,d=0,e=a.g.O(function(f){for(var g=0;g<b.length;g++){var k=b[g].K(),l=b[g].G();c&&c.getName()==k||(c=Jn(f,k));d+=eo(c,l)}T(a,d);e();e=null},this)};h.Re=function(a,b,c){this.pd(a,b,c)};
h.pd=function(a,b,c){var d=nl(a)+" removeByKeyRange "+(c?yi(c):"");O(this.logger,d);var e=this,f=a.g.O(function(g){g=fo(Jn(g,b),c);P(e.logger,d+" deleted "+g+" records.");T(a,g);f();f=null},this)};h.Pf=function(a,b,c,d){var e=nl(a)+" removeByIndexKeyRange "+(d?yi(d):"");O(this.logger,e);var f=a.g.O(function(e){e=Jn(e,b);for(var k=e.Pa(c,d),l=k.length,m=0;m<l;m++)eo(e,k[m]);T(a,l);f();f=null},this)};
h.Kd=function(a,b){var c=nl(a)+" clearByStores";O(this.logger,c);var d=a.g.O(function(e){for(var f=0;f<b.length;f++)Jn(e,b[f]).clear();P(this.logger,"success "+c);T(a,b.length);d();d=null},this)};h.Md=function(a,b){var c=a.g.O(function(d){for(var e=[],f=0;f<b.length;f++){var g=Jn(d,b[f]);e.push(go(g))}T(a,e);c();c=null},this)};
h.Yc=function(a,b,c,d){var e=nl(a)+" count"+(null!=d?"Index":"")+(null!=c?"KeyRange":"Store");O(this.logger,e);var f=a.g.O(function(g){g=go(Jn(g,b),d,c);P(this.logger,"success "+e);T(a,g);f();f=null},this)};h.list=function(a,b,c,d,e,f,g,k,l,m){var n=nl(a)+" "+c+" "+(e?xi(e):"");O(this.logger,n);var p=a.g.O(function(r){r=Jn(r,c).Kc(b,d,e,k,f,g,l,m);P(this.logger,n+" "+r.length+" records found.");T(a,r);p();p=null},this)};function no(a,b){this.g=b}A(no,lo);no.prototype.h=function(a,b,c,d){c=W(this.g,c);return new An(a,b,c,d)};function oo(a,b,c,d){Tk.call(this,a,b,c,d);this.ba=null;this.l=this.p=void 0}A(oo,Tk);h=oo.prototype;h.logger=L("ydn.db.core.req.WebsqlCursor");h.ja=function(){return this.l};h.init=function(a,b,c,d,e){oo.m.init.call(this,a,b,c,d,e);this.ba=v(b)?Vk(this.h,b):null};h.U=function(){return this.D};function po(a,b){a.p=void 0;a.l=void 0;a.D=void 0;if(t(b))if(x(b)){var c=Hm(b[a.h.j],a.h.type);a.l=c;if(a.j){var d=Vk(a.h,a.mb);a.p=Hm(b[a.mb],d.type)}else a.p=c;a.D=a.nd?c:qo(b,a.h)}else a.D=b}
function ro(a,b,c){Vk(a.h,a.mb);var d=[],e=a.mb,f=a.da,g=a.p;if(null!=f){var k=f.lower,l=f.upper,m=f.lowerOpen,n=f.upperOpen;a.reverse?l=null!=l&&-1==zk(l,g)?l:g:k=null!=k&&1==zk(k,g)?k:g;null!=k&&null!=l?f=R.bound(k,l,!!m,!!n):f=null!=k?vk.lowerBound(k,!!m):vk.upperBound(l,!!n)}else f=a.reverse?vk.upperBound(g):vk.lowerBound(g);e=Nm(a.h,d,a.M,e,f,a.reverse,a.unique);c=a.reverse?vk.upperBound(c,!1):vk.lowerBound(c,!1);c=Nm(a.h,d,a.M,a.h.j,c,a.reverse,a.unique);e.ia=e.ia?e.ia+(" AND "+c.ia):c.ia;c=
"SELECT "+e.select+" FROM "+e.Ic+(e.ia?" WHERE "+e.ia:"")+(e.group?" GROUP BY "+e.group:"")+" ORDER BY "+e.bc;c+=" LIMIT 1";O(a.logger,a+": continuePrimary:  SQL: "+c+" : "+yi(d));a.o.executeSql(c,d,function(c,d){0<d.rows.length?po(a,d.rows.item(0)):po(a);b.call(a,a.p,a.l,a.D);b=null},function(c,d){N(a.logger,"get error: "+d.message);Wk(a,d);po(a);b.call(a,a.l,a.p,a.D);b=null;return!1})}
function so(a,b,c,d,e,f){var g=!d;d=[];a.j&&null!=f&&null!=c?c=Qm(a.h,a.M,d,a.ba.getName(),a.da,c,g,f,a.reverse,a.unique):null!=c?(f=a.ba?a.ba.getName():null,c=Pm(a.h,a.M,d,f,a.da,a.reverse,a.unique,c,g)):(c=Mm(a.h,d,a.M,a.j?a.ba.j:a.h.j,a.da,a.reverse,a.unique),a.j&&(c+=", "+a.h.i+" ASC"));c+=" LIMIT 1";0<e&&(c+=" OFFSET "+e);O(a.logger,a+": continue:  SQL: "+c+" : "+yi(d));a.o.executeSql(c,d,function(c,d){0<d.rows.length?po(a,d.rows.item(0)):po(a);b.call(a,a.p,a.l,a.D);b=null},function(c,d){N(a.logger,
"get error: "+d.message);Wk(a,d);po(a);b.call(a,a.l,a.p,a.D);b=null;return!1})}h.ge=function(){return!!this.o};h.update=function(a){if(!this.ge())throw new ul;var b=new B,c=this.ja();a=Tm(this.h,a,c);var d="REPLACE INTO "+Om(this.h)+" ("+a.ug.join(", ")+") VALUES ("+a.ih.join(", ")+")";O(this.logger,this+': update "'+d+'" : '+yi(a.values));this.o.executeSql(d,a.values,function(){b.callback(c)},function(a,c){b.F(c);return!1});return b};
h.advance=function(a){var b=this.p,c=this.l,d=!0;null==this.p||this.j&&null==this.l||(a-=1,d=!1);so(this,function(a,d,g){var k=null!=b&&null!=a&&0==zk(b,a);if(this.j){var l=null!=d&&null!=c&&0==zk(d,c);if(k&&l)throw new yd("current: "+b+";"+c+" next: "+a+";"+d);}else if(k)throw new yd("current: "+b+" next: "+a);this.xb(a,d,g)},this.p,d,a,this.l)};h.jc=function(a){null!=a?so(this,this.xb,a,!0):this.advance(1)};h.openCursor=function(a,b){so(this,this.xb,a,!1,0,b)};
h.clear=function(){if(!this.ge())throw new ul;var a=new B,b=this.h.j,b="DELETE FROM "+Om(this.h)+" WHERE "+b+" = ?",c=[this.ja()];O(this.logger,this+': clear "'+b+'" : '+yi(c));this.o.executeSql(b,c,function(b,c){a.callback(c.rowsAffected)},function(b,c){a.F(c);return!1});return a};h.Xc=function(a){var b=zk(a,this.l);if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new Ji(this+" to continuePrimaryKey  from "+this.l+" to "+a+" on "+this.Ab+" direction is wrong");ro(this,this.xb,a)};
h.toString=function(){return"WebSql"+oo.m.toString.call(this)};function to(a,b){this.g=b}A(to,Dl);h=to.prototype;h.logger=L("ydn.db.crud.req.WebSql");
function qo(a,b){if(b.Dc&&!b.keyPath&&0==b.indexes.length&&a._default_){var c=a._default_;if(-1==c.indexOf(";base64,"))return wi(c);'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substr(1,c.length-2));for(var d=c.split(";base64,"),c=d[0].split(":")[1],d=window.atob(d[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f.buffer],{type:c})}c=a._default_?wi(a._default_):{};null!=b.keyPath&&(d=Hm(a[b.keyPath],b.type),null!=d&&mm(b,c,d));for(d=0;d<b.indexes.length;d++)e=
b.index(d),f=e.j,"_default_"==f||e.o||e.multiEntry||"DATE"!=e.type&&!b.Dc||(f=Hm(a[f],e.type),t(f)&&Gm(e,c,f));return c}h.Of=function(){throw new wd("putData");};
h.wb=function(a,b,c,d,e,f){function g(b,d){if(null==e[b])if(O(m.logger,"empty object at "+b+" of "+e.length),p++,p==e.length)P(m.logger,r+" success "+r),T(a,n,s);else{var G=b+2;G<e.length&&g(G,d)}var D;D=t(f)?Tm(k,e[b],f[b]):Tm(k,e[b]);G=l+Om(k)+" ("+D.ug.join(", ")+") VALUES ("+D.ih.join(", ")+");";O(m.logger,nl(a)+" SQL: "+G+" PARAMS: "+D.values+" REQ: "+b+" of "+e.length);d.executeSql(G,D.values,function(f,r){function G(b,c){var e="ydn.db.me:"+k.getName()+":"+b.getName(),e=l+Pa(e)+" ("+k.i+", "+
b.i+") VALUES (?, ?)",f=[Ak(K,k.type),Ak(c,b.type)];O(m.logger,nl(a)+" multiEntry "+e+" "+f);d.executeSql(e,f,function(){},function(a,b){N(m.logger,"multiEntry index insert error: "+b.message);return!1})}p++;var K=t(D.key)?D.key:r.insertId;1>r.rowsAffected&&(s=!0,K=new ql(K+" no-op"));for(var bd=0,mk=k.indexes.length;bd<mk;bd++){var Kd=k.index(bd);if(Kd.multiEntry)for(var We=Bk(e[b],Kd.keyPath),dz=(We?We.length:0)||0,M=0;M<dz;M++)G(Kd,We[M])}c?T(a,K):(n[b]=K,p==e.length?T(a,n,s):(bd=b+2,bd<e.length&&
g(bd,f)))},function(d,f){p++;s=!0;6==f.code?f.name="ConstraintError":N(m.logger,"error: "+f.message+" "+r);if(c)T(a,f,!0);else if(n[b]=f,p==e.length)O(m.logger,"success "+r),T(a,n,s);else{var k=b+2;k<e.length&&g(k,d)}return!1})}b=!b;var k=W(this.g,d),l=b?"INSERT INTO ":"INSERT OR REPLACE INTO ";d=a.g;var m=this,n=[],p=0,r=nl(a)+" inserting "+e.length+" objects.",s=!1;if(0<e.length)for(b=0;2>b&&b<e.length;b++)g(b,d);else P(this.logger,"success"),T(a,[])};
h.te=function(a,b,c){if(0==c.length)T(a,[]);else{for(var d=[],e=0,f=0,g=this,k=function(k,l){var m=[];O(g.logger,"put "+l.length+" objects to "+k);for(var n=Sm(W(g.g,k)),p=n?void 0:[],r=0;r<l.length;r++)m.push(b[l[r]]),n||p.push(c[l[r]].G());n=jl(a);n.A(function(b){for(var c=0;c<l.length;c++)d[l[c]]=b[c];e++;e==f&&T(a,d)},function(){e++;e==f&&T(a,d,!0)});g.wb(n,!1,!1,k,m,p)},l="",m=[],n=[],p=0;p<c.length;p++){var r=c[p].K(),s=c[p].G();r!=l?(f++,0<m.length&&k(l,m),m=[p],n=[s],l=r):(m.push(p),n.push(s))}0<
m.length&&k(l,m)}};h.Wd=function(a,b,c){var d=a.g,e=W(this.g,b),f=this;b=e.i;c=[Ak(c,e.type)];b="SELECT * FROM "+Om(e)+" WHERE "+b+" = ?";var g=nl(a)+" SQL: "+b+" PARAMS: "+c;O(this.logger,g);d.executeSql(b,c,function(b,c){if(0<c.rows.length){var d=c.rows.item(0);null!=d?(d=qo(d,e),T(a,d)):(P(f.logger,"success no result: "+g),T(a,void 0))}else P(f.logger,"success no result: "+g),T(a,void 0)},function(b,c){N(f.logger,"error: "+g+" "+c.message);T(a,c,!0);return!1})};
h.Ff=function(a,b,c){function d(b,e){var p=l.i,r=[Ak(c[b],l.type)],s="SELECT * FROM "+Om(l)+" WHERE "+p+" = ?";O(f.logger,"SQL: "+s+" PARAMS: "+r);e.executeSql(s,r,function(e,f){k++;if(0<f.rows.length){var n=f.rows.item(0);null!=n&&(g[b]=qo(n,l))}else g[b]=void 0;k==c.length?T(a,g):(n=b+10,n<c.length&&d(n,e))},function(e,l){k++;N(f.logger,"error: "+s+" "+l.message);if(k==c.length)T(a,g);else{var n=b+10;n<c.length&&d(n,e)}return!1})}var e=a.g,f=this,g=[],k=0,l=W(this.g,b);if(0<c.length)for(b=0;10>
b&&b<c.length;b++)d(b,e);else P(f.logger,"success"),T(a,[])};
h.le=function(a,b){function c(d,k){var n=b[d],p=W(e.g,n.K()),r=Bl(n),n=p.i,r=[Ak(r,p.type)],s="SELECT * FROM "+Om(p)+" WHERE "+n+" = ?";O(e.logger,"SQL: "+s+" PARAMS: "+r);k.executeSql(s,r,function(k,m){g++;if(0<m.rows.length){var n=m.rows.item(0);null!=n&&(f[d]=qo(n,p))}else f[d]=void 0;g==b.length?(O(e.logger,"success "+s),T(a,f)):(n=d+10,n<b.length&&c(n,k))},function(b,c){T(a,c,!0);return!1})}var d=a.g,e=this,f=[],g=0;if(0<b.length)for(var k=0;10>k&&k<b.length;k++)c(k,d);else O(this.logger,"success"),
T(a,[])};
h.Kd=function(a,b){function c(d,g){function k(a){a="ydn.db.me:"+l.getName()+":"+a.getName();a="DELETE FROM  "+Pa(a);O(e.logger,"SQL: "+a);g.executeSql(a,[])}var l=W(e.g,b[d]),m="DELETE FROM  "+Om(l);O(e.logger,"SQL: "+m+" PARAMS: []");g.executeSql(m,[],function(g){d==b.length-1?(O(e.logger,"success "+m),T(a,b.length)):c(d+1,g)},function(b,c){T(a,c,!0);return!1});for(var n=0,p=l.indexes.length;n<p;n++){var r=l.index(n);r.multiEntry&&k(r)}}var d=a.g,e=this;0<b.length?c(0,d):(O(this.logger,"success"),
T(a,0))};
h.ve=function(a,b){function c(k){if(k>=b.length)T(a,f,g);else{var l=W(e.g,b[k].K()),m=Ak(b[k].G(),l.type),n=" WHERE "+l.i+" = ?",p="DELETE FROM "+Om(l)+n,r=nl(a)+" SQL: "+p+" PARAMS: "+[m];d.executeSql(p,[m],function(){f++;c(k)},function(a,b){N(e.logger,"error: "+r+b.message);g=!0;c(k);return!1});k++;for(var p=function(b){b="ydn.db.me:"+l.getName()+":"+b.getName();b="DELETE FROM  "+Pa(b)+n;O(e.logger,nl(a)+NaN+b);d.executeSql(b,[m])},s=0,w=l.indexes.length;s<w;s++){var y=l.index(s);y.multiEntry&&p(y)}}}
var d=a.g,e=this,f=0,g=!1;O(this.logger,nl(a)+" removeByKeys: "+b.length+" keys");c(0)};
h.ue=function(a,b,c){function d(b){b="ydn.db.me:"+f.getName()+":"+b.getName();b="DELETE FROM  "+Pa(b)+l;O(k.logger,nl(a)+NaN+b);e.executeSql(b,[g])}var e=a.g,f=W(this.g,b),g=Ak(c,f.type),k=this,l=" WHERE "+f.i+" = ?";b="DELETE FROM "+Om(f)+l;O(this.logger,nl(a)+" SQL: "+b+" PARAMS: "+[g]);e.executeSql(b,[g],function(b,c){T(a,c.rowsAffected)},function(b,c){T(a,c,!0);return!1});b=0;for(c=f.indexes.length;b<c;b++){var m=f.index(b);m.multiEntry&&d(m)}};h.Re=function(a,b,c){uo(this,a,b,void 0,c)};
h.pd=function(a,b,c){uo(this,a,b,void 0,c)};h.Pf=function(a,b,c,d){uo(this,a,b,c,d)};
function uo(a,b,c,d,e){function f(c){c="ydn.db.me:"+k.getName()+":"+c.getName();c="DELETE FROM  "+Pa(c)+n;O(a.logger,nl(b)+NaN+c);g.executeSql(c,m)}var g=b.g,k=W(a.g,c);c="DELETE FROM "+Om(k);var l=[],m=[],n="";null!=e&&(t(d)?(d=Vk(k,d),yk(d.i,d.type,e,m,l)):yk(k.i,k.type,e,m,l),n=" WHERE "+m.join(" AND "));c+=n;var p=nl(b)+" SQL: "+c+" PARAMS: "+l;O(a.logger,p);g.executeSql(c,l,function(c,d){O(a.logger,"success "+p);T(b,d.rowsAffected)},function(c,d){N(a.logger,"error: "+p+d.message);T(b,d,!0);return!1});
e=0;for(d=k.indexes.length;e<d;e++)c=k.index(e),c.multiEntry&&f(c)}h.Md=function(a,b){function c(g){var k="SELECT COUNT(*) FROM "+Pa(b[g]);O(e.logger,"SQL: "+k+" PARAMS: []");d.executeSql(k,[],function(d,e){var k=e.rows.item(0);f[g]=parseInt(k["COUNT(*)"],10);g++;g==b.length?T(a,f):c(g)},function(b,c){T(a,c,!0);return!1})}var d=a.g,e=this,f=[];0==b.length?(O(this.logger,"success"),T(a,0)):c(0)};
h.Yc=function(a,b,c,d,e){var f=[];b=Mm(W(this.g,b),f,6,d,c,!1,e);O(this.logger,nl(a)+" SQL: "+b+" PARAMS: "+f);a.g.executeSql(b,f,function(b,c){var d=c.rows.item(0);T(a,cn(d))},function(b,c){T(a,c,!0);return!1})};
h.list=function(a,b,c,d,e,f,g,k,l,m){var n=this,p=[],r=W(this.g,c),s=r.j,w=r.type,y=w,G=null!=d&&d!==s?Vk(r,d):null,D=d||s;G&&(y=G.type);c=[];if(m&&t(m[0])){var I=m[0];G&&t(m[1])?(d=m[1],e=Qm(r,b,c,G.getName(),e,I,!0,d,k,l)):e=Pm(r,b,c,d,e,k,l,I,!0)}else e=Mm(r,c,b,D,e,k,l);ha(f)&&(e+=" LIMIT "+f);ha(g)&&(e+=" OFFSET "+g);var S=a+" SQL: "+e+" ;params= "+yi(c);O(this.logger,S);a.g.executeSql(e,c,function(c,d){for(var e=d.rows.length,f,g=0;g<e;g++)f=d.rows.item(g),2==b?p[g]=Hm(f[s],w):1==b?p[g]=Hm(f[D],
y):3==b?p[g]=[Hm(f[D],y),Hm(f[s],w)]:null!=f&&(p[g]=qo(f,r));P(n.logger,"success "+a);m&&f&&(m[0]=Hm(f[D],y),m[1]=Hm(f[s],w));T(a,p)},function(b,c){N(n.logger,"error: "+S+c.message);T(a,c,!0);return!1})};function vo(a,b){this.g=b}A(vo,to);vo.prototype.logger=L("ydn.db.core.req.WebSql");vo.prototype.h=function(a,b,c,d){c=W(this.g,c);return new oo(a,b,c,d)};sn.prototype.L=function(){var a=Il(this);if("indexeddb"==a)return new yn(0,this.h);if("websql"==a||"sqlite"==a)return new vo(0,this.h);if("memory"==a||"localstorage"==a||"userdata"==a||"sessionstorage"==a)return new no(0,this.h);throw new yd("No executor for "+a);};function wo(a){return v(a)?a.replace(/\D/g,"").replace(/^0+/,""):null}function xo(a){if(!v(a)||!/[\w\+]+@\w+\.\w+/.test(a))return null;a=a.replace(/.*</,"").replace(/>.*/,"");a=a.toLowerCase();a=a.replace(/\+\w*?@/,"@");for(var b=a.indexOf("@");0<=b;b--);return a};function yo(a){if(!v(a))throw new Di;this.jb=a;this.j=Qk;this.g=[];zo(this,a);this.wd=""}h=yo.prototype;h.jb="";h.Vg=NaN;h.Wg=NaN;h.Zf=!1;h.wd="";
function zo(a,b){var c=b.split(/\sFROM\s/i);if(2==c.length){var d=c[1],c=c[0].match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i);if(3==c.length){a.l=c[1].toUpperCase();if("SELECT"==a.l)a.j=Pk;else if("INSERT"==a.l)a.j=Qk;else if("UPDATE"==a.l)a.j=Qk;else if("DELETE"==a.l)a.j=Qk;else return;var c=c[2].trim(),e=c.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);e?(a.i=e[0].toUpperCase(),c=c.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):a.i=void 0;"("==c.charAt(0)&&(")"==c.charAt(c.length-1)?c=c.substring(1,c.length-
1):new yl("missing closing parentheses"));a.I=c;c=d.search(/(ORDER BY|LIMIT|OFFSET)/i);0<c?(a.h=d.substring(c),d=d.substring(0,c)):a.h="";c=d.search(/WHERE/i);0<c?(a.o=d.substring(c+6).trim(),d=d.substring(0,c)):a.o="";a.g=d.trim().split(",").map(function(a){a=Ma(a,'"');a=Ma(a,"'");return a.trim()})}}}
h.parse=function(a){if(a){for(var b=0;b<a.length;b++)this.jb=this.jb.replace("?",a[b]);zo(this,this.jb)}this.p=Ao(this);if(!this.p)return this.wd;a=this.h.length;if(b=/OFFSET\s+(\d+)/i.exec(this.h))this.Wg=parseInt(b[1],10),a=this.h.search(/OFFSET/i);if(b=/LIMIT\s+(\d+)/i.exec(this.h))this.Vg=parseInt(b[1],10),b=this.h.search(/LIMIT/i),b<a&&(a=b);(a=/ORDER BY\s+(.+)/i.exec(this.h.substr(0,a)))?(a=a[1].trim(),(b=a.match(/(ASC|DESC)/i))?(this.Zf="DESC"==b[0].toUpperCase(),a=a.replace(/\s+(ASC|DESC)/i,
"")):this.Zf=!1,this.u=Ma(Ma(a,'"'),"'")):this.u=void 0;return""};function Bo(a){if("*"==a.I)return null;a=a.I.split(",");return a=a.map(function(a){return Ma(a.trim(),'"')})}h.toJSON=function(){return{sql:this.jb}};
function Ao(a){function b(a){return Bb(c,function(b){return b.Xd()==a})}var c=[],d=/(.+?)(<=|>=|=|>|<)(.+)/i;if(0<a.o.length)for(var e=a.o.split("AND"),f=0;f<e.length;f++){var g=e[f],k=d.exec(g);if(k){var l=k[1].trim(),l=Ma(l,'"'),l=Ma(l,"'");if(0<l.length){var m=k[3].trim();wa(m,'"')?m=Ma(m,'"'):wa(m,"'")?m=Ma(m,"'"):m=parseFloat(m);k=new Mk(l,k[2],m);l=b(l);if(0<=l){if(c[l]=c[l].Oe(k),!c[l])return a.wd='where clause "'+g+'" conflict',null}else c.push(k)}else return a.wd='Invalid clause "'+g+'"',
null}else return a.wd='Invalid clause "'+g+'"',null}return c}h.toString=function(){return"query:"+this.jb};function Co(a,b){this.g=b;this.h=a}Co.prototype.logger=L("ydn.db.sql.req.nosql.Node");Co.prototype.toJSON=function(){return{sql:this.g}};Co.prototype.toString=function(){return"idb.Node:"};
Co.prototype.execute=function(a,b){var c=Gb(this.g.g)[0],d=this.g.p,e=this.g.Vg,e=isNaN(e)?100:e,f=this.g.Wg,f=isNaN(f)?0:f,g=this.g.u,k=Bo(this.g),l=null,m=this.g.Zf;if(0==d.length)l=null;else if(1==d.length)l=sk(d[0].g);else throw new vd("too many conditions.");null===k||ml(a,function(a,b,c){var d=a;b||(d=a.map(function(a){var b=k.length;if(1==b)return Bk(a,k[0]);for(var c={},d=0;d<b;d++)c[k[d]]=Bk(a,k[d]);return c}));c(d,b)});var d=0<d.length?d[0].Xd():void 0,n=nl(a)+" executing on"+c;d&&(n+=":"+
d);n+=" "+xk(l);P(this.logger,n);g&&g!=this.h.keyPath?b.list(a,4,c,g,l,e,f,m,!1):t(d)&&d!=this.h.keyPath?b.list(a,4,c,d,l,e,f,m,!1):b.list(a,4,c,null,l,e,f,m,!1)};function Do(a,b){Co.call(this,a,b)}A(Do,Co);
Do.prototype.execute=function(a,b){var c,d=Gb(this.g.g)[0],e=this.g.p,f=null;if(0==e.length)f=null;else if(1==e.length)f=sk(e[0].g);else throw new vd("too many conditions.");var g=this.g.i,e=0<e.length?e[0].Xd():void 0,k=nl(a)+" executing "+g+" on "+d;e&&(k+=":"+e);k+=" "+xk(f);P(this.logger,k);if("COUNT"==g)f?b.Yc(a,d,f,e,!1):b.Yc(a,d,null,void 0,!1);else{var l,k=Bo(this.g);if(!k||0==k.length)throw new Ji("field name require for reduce operation: "+g);k=k[0];if("MIN"==g)l=Eo(k);else if("MAX"==g)l=
Fo(k);else if("AVG"==g)c=0,l=Go(k);else if("SUM"==g)c=0,l=Ho(k);else throw new Ei(g);var m;t(e)?m=new el(d,e,f):m=new dl(d,f);var d=b.h(a.g,nl(a),d,4),n=m.load([d]);n.Y=function(b){T(a,b,!0)};var p=0;n.L=function(b){null!=b?(b=m.g?n.ja():n.U(),c=l(b,c,p),n.advance(1),p++):T(a,c)}}};function Go(a){return function(b,c,d){t(c)||(c=0);return(c*d+b[a])/(d+1)}}function Ho(a){return function(b,c){return c+b[a]}}function Eo(a){return function(b,c){var d=b[a];return t(c)?c<d?c:d:d}}
function Fo(a){return function(b,c){var d=b[a];return t(c)?c>d?c:d:d}};function Io(a,b){this.g=b}A(Io,yn);Io.prototype.logger=L("ydn.db.sql.req.IndexedDb");Io.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new yl(c);c=Gb(b.g);if(1==c.length){var d=W(this.g,c[0]);if(!d)throw new vl(c[0]);var e=Bo(b);if(e)for(var f=0;f<e.length;f++)if(!bm(d,e[f]))throw new vl('Index "'+e[f]+'" not found in '+c[0]);var g;b.i?g=new Do(d,b):g=new Co(d,b);g.execute(a,this)}else throw new Ei(b.jb);};function Jo(a,b){this.h=b;this.i=a;this.g=Bo(b)}Jo.prototype.logger=L("ydn.db.sql.req.websql.Node");Jo.prototype.toJSON=function(){return{sql:this.h.jb}};Jo.prototype.toString=function(){return"websql.Node:"};function Ko(a,b){if(a.g){if(1==a.g.length){if(x(b))return Nc(b,a.g[0]);return}for(var c={},d=0;d<a.g.length;d++)c[a.g[d]]=Nc(b,a.g[d]);return c}return qo(b,a.i)}
Jo.prototype.execute=function(a,b,c){var d=this,e=[];b.executeSql(this.h.jb,c,function(b,c){for(var k=c.rows.length,l=0;l<k;l++){var m=c.rows.item(l);if(x(m))var n=Ko(d,m);e.push(n)}a(e)},function(b,c){N(d.logger,"Sqlite error: "+c.message);a(c,!0);return!0})};function Lo(a,b){Jo.call(this,a,b)}A(Lo,Jo);Lo.prototype.execute=function(a,b,c){var d=this;b.executeSql(this.h.jb,c,function(b,c){var d=c.rows.length;if(1==d)d=cn(c.rows.item(0)),a(d);else if(0==d)a(void 0);else throw new tl;},function(b,c){N(d.logger,"Sqlite error: "+c.message);a(c,!0);return!0})};function Mo(a,b){this.g=b}A(Mo,vo);Mo.prototype.logger=L("ydn.db.sql.req.WebSql");Mo.prototype.executeSql=function(a,b,c){var d=Gb(b.g);if(1==d.length){var e=W(this.g,d[0]);if(!e)throw new vl(d[0]);var f=Bo(b);if(f)for(var g=0;g<f.length;g++)if(!bm(e,f[g]))throw new vl('Index "'+f[g]+'" not found in '+d[0]);var k;b.i?k=new Lo(e,b):k=new Jo(e,b);k.execute(function(b,c){T(a,b,c)},a.g,c)}else throw new Ei(b.jb);};function No(a,b){this.g=b}A(No,no);No.prototype.logger=L("ydn.db.sql.req.SimpleStore");No.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new yl(c);c=Gb(b.g);if(1==c.length){var d=W(this.g,c[0]);if(!d)throw new vl(c[0]);var e=Bo(b);if(e)for(var f=0;f<e.length;f++)if(!bm(d,e[f]))throw new F('Index "'+e[f]+'" not found in '+c[0]);var g;b.i?g=new Do(d,b):g=new Co(d,b);g.execute(a,this)}else throw new vd(b.jb);};function Oo(a,b,c,d){Ql.call(this,a,b,c,d)}A(Oo,vm);Oo.prototype.executeSql=function(a,b){for(var c=new yo(a),d=Gb(c.g),e=0;e<d.length;e++){var f=W(this.h,d[e]);if(!f)throw new F("store: "+f+" not exists.");}P(this.logger,"executeSql: "+a+" params: "+b);var g=this.g.request("sql",Gb(c.g),c.j);U(g,function(){V(this).executeSql(g,c,b||[])},this);return g};function Po(a,b,c){rn.call(this,a,b,c)}A(Po,sn);Po.prototype.Pc=function(a,b){return new Oo(this,this.h,a,b)};Po.prototype.executeSql=function(a,b){return this.g.executeSql(a,b)};Po.prototype.L=function(){var a=Il(this);if("indexeddb"==a)return new Io(0,this.h);if("websql"==a||"sqlite"==a)return new Mo(0,this.h);if("memory"==a||"localstorage"==a||"sessionstorage"==a)return new No(0,this.h);throw new yd("No executor for "+a);};function Qo(a,b){t(a)&&5242880<a&&le(this.logger,Wd,"storage size request ignored, use Quota Management API instead");this.la=null;this.sd=b||NaN}h=Qo.prototype;
h.connect=function(a,b){function c(a,c,d){P(e.logger,(d?"changing":"upgrading")+" version to "+a.version+" from "+g);for(d=0;d<b.stores.length;d++)Ro(e,a,c,b.stores[d]);c=a.objectStoreNames;var f=c.length;for(d=0;d<f;d++)Zl(b,c[d])||(a.deleteObjectStore(c[d]),P(e.logger,"store: "+c[d]+" deleted."))}function d(a,b){f.h?N(e.logger,"database already set."):t(b)?(N(e.logger,b?b.message:"Error received."),e.la=null,f.F(b)):(e.la=a,e.la.onabort=function(a){O(e.logger,e+": abort");e.xd(a.target.error)},
e.la.onerror=function(a){O(e.logger,e+": error");e.xd(a.target.error)},e.la.onversionchange=function(a){O(e.logger,e+" closing connection for onversionchange to: "+a.version);if(e.la&&(e.la.onabort=null,e.la.onblocked=null,e.la.onerror=null,e.la.onversionchange=null,e.se(a),!a.defaultPrevented)){e.la.close();e.la=null;var b=Error();b.name=a.type;e.Fe(b)}},f.callback(parseFloat(g)))}var e=this,f=new B,g=void 0,k=b.version;le(this.logger,$d,"Opening database: "+a+" ver: "+(b.vc?"auto":k));var l;l=t(k)?
Sk.open(a,k):Sk.open(a);l.onsuccess=function(f){var k=f.target.result;t(g)||(g=k.version);le(e.logger,$d,"Database: "+k.name+", ver: "+k.version+" opened.");if(b.vc)e.tb(function(f){if(b instanceof Vl)for(var g=0;g<f.stores.length;g++)Zl(b,f.stores[g].getName())||Wl(b,f.stores[g].clone());f=$m(b,f,!1,!0);if(0<f.length){le(e.logger,$d,"Schema change require for difference in "+f);var l=ha(k.version)?k.version+1:1;if("IDBOpenDBRequest"in q){k.close();var m=Sk.open(a,l);m.onupgradeneeded=function(a){a=
a.target.result;le(e.logger,$d,"re-open for version "+a.version);c(a,m.transaction,!1)};m.onsuccess=function(a){d(a.target.result)};m.onerror=function(){le(e.logger,$d,e+": fail.");d(null)}}else{var p=k.setVersion(l+"");p.g=function(a){N(e.logger,"migrating from "+k.version+" to "+l+" failed.");d(null,a)};p.onsuccess=function(){p.transaction.oncomplete=D;c(k,p.transaction,!0)};var D=function(){var b=Sk.open(a);b.onsuccess=function(a){a=a.target.result;le(e.logger,$d,e+": OK.");d(a)};b.onerror=function(){le(e.logger,
$d,e+": fail.");d(null)}};null!=p.transaction&&(p.transaction.oncomplete=D)}}else d(k)},void 0,k);else if(b.version>k.version){var l=k.setVersion(b.version);l.g=function(a){N(e.logger,"migrating from "+k.version+" to "+b.version+" failed.");d(null,a)};l.onsuccess=function(){c(k,l.transaction,!0)}}else b.version==k.version?le(e.logger,$d,"database version "+k.version+" ready to go"):N(e.logger,"connected database version "+k.version+" is higher than requested version."),e.tb(function(a){a=$m(b,a,!1,
!0);0<a.length?(le(e.logger,$d,a),d(null,new Hi("different schema: "+a))):d(k)},void 0,k)};l.onupgradeneeded=function(a){a=a.target.result;g=NaN;le(this.logger,$d,"upgrade needed for version "+a.version);c(a,l.transaction,!1)};l.onerror=function(c){me(e.logger,'open request to database "'+a+'" '+(t(b.version)?" with version "+b.version:"")+" cause error of "+l.error.name);d(null,c)};l.onblocked=function(c){me(e.logger,"database "+a+" "+b.version+" block, close other connections.");d(null,c)};ha(this.sd)&&
!isNaN(this.sd)&&setTimeout(function(){"done"!=l.readyState&&(me(e.logger,e+": database state is still "+l.readyState),d(null,new zl("connection timeout after "+e.sd)))},this.sd);return f};h.sd=18E4;h.Fe=function(){};h.xd=function(){};h.se=function(){};h.Tc=function(){return"indexeddb"};h.Ee=function(){return!!this.la};h.logger=L("ydn.db.con.IndexedDb");h.la=null;h.De=function(){return this.la?parseFloat(this.la.version):void 0};
h.tb=function(a,b,c){c=c||this.la;if(t(b)){if(null===b){if(0==c.objectStoreNames.length){a(new Zm(c.version));return}throw new Gi;}c=b.db}else{b=[];for(var d=c.objectStoreNames.length-1;0<=d;d--)b[d]=c.objectStoreNames[d];if(0==b.length){a(new Zm(c.version));return}b=c.transaction(b,Pk)}for(var e=c.objectStoreNames,f=[],g=e.length,d=0;d<g;d++){for(var k=b.objectStore(e[d]),l=[],m=0,n=k.indexNames.length;m<n;m++){var p=k.index(k.indexNames[m]);l[m]=new Cm(p.keyPath,void 0,p.unique,p.multiEntry,p.name)}f[d]=
new Sl(k.name,k.keyPath,k.autoIncrement,void 0,l)}b=new Zm(c.version,f);a(b)};
function Ro(a,b,c,d){function e(){var a={autoIncrement:!!d.autoIncrement};null!=d.keyPath&&(a.keyPath=d.keyPath);return b.createObjectStore(d.getName(),a)}le(a.logger,ae,"Creating Object Store for "+d.getName()+" keyPath: "+d.keyPath);if(b.objectStoreNames.contains(d.getName())){c=c.objectStore(d.getName());Jm(d.keyPath||"",c.keyPath||"")?(b.deleteObjectStore(d.getName()),le(a.logger,Wd,"store: "+d.getName()+" deleted due to keyPath change."),c=e()):ga(c.autoIncrement)&&ga(d.autoIncrement)&&c.autoIncrement!=
d.autoIncrement&&(b.deleteObjectStore(d.getName()),le(a.logger,Wd,"store: "+d.getName()+" deleted due to autoIncrement change."),c=e());for(var f=c.indexNames,g=0;g<d.indexes.length;g++){var k=d.index(g);!f.contains(k.getName())&&k.l&&(c.clear(),le(a.logger,Wd,"store: "+d.getName()+" cleared since generator index need re-indexing."))}for(var l=0,m=0,n=0,g=0;g<d.indexes.length;g++){var k=d.index(g),p=!1;if(f.contains(k.getName())){var r=c.index(k.getName()),s=null!=r.unique&&null!=k.unique&&r.unique!=
k.unique,w=null!=r.multiEntry&&null!=k.multiEntry&&r.multiEntry!=k.multiEntry,r=null!=r.keyPath&&null!=k.keyPath&&!!Jm(r.keyPath,k.keyPath);if(s||w||r)c.deleteIndex(k.getName()),p=!0,l--,n++}else"BLOB"!=k.type&&(p=!0);p&&(k.unique||k.multiEntry?(p={unique:k.unique,multiEntry:k.multiEntry},c.createIndex(k.getName(),k.keyPath,p)):c.createIndex(k.getName(),k.keyPath),l++)}for(g=0;g<f.length;g++)bm(d,f[g])||(c.deleteIndex(f[g]),m++);le(a.logger,ae,"Updated store: "+c.name+", "+l+" index created, "+m+
" index deleted, "+n+" modified.")}else{c=e();for(g=0;g<d.indexes.length;g++)k=d.index(g),"BLOB"==k.type?le(a.logger,Xd,"Index "+k+" of blob data type ignored."):(le(a.logger,ae,"Creating index: "+k),k.unique||k.multiEntry?(p={unique:k.unique,multiEntry:k.multiEntry},c.createIndex(k.getName(),k.keyPath,p)):c.createIndex(k.getName(),k.keyPath));le(a.logger,ae,"Created store: "+c)}}
h.Qd=function(a,b,c,d){var e=this.la;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(null):(b=e.transaction(b,c),b.oncomplete=function(a){d("complete",a)},b.onabort=function(a){d("abort",a)},a(b),a=null)};h.close=function(){le(this.logger,ae,this+" closing connection");this.la.close()};h.toString=function(){return"IndexedDB:"+(this.la?this.la.name+":"+this.la.version:"")};
pl.push(function(a,b){if(!Sk||b&&"indexeddb"!=b)return null;var c=Sk.deleteDatabase(a),d=new hl("IDBVersionChangeEvent ");c.onblocked=function(a){pe(d,a)};c.onerror=function(a){d.F(a)};c.onsuccess=function(a){d.callback(a)};return d});function So(a){jo.call(this,a);this.h=NaN}A(So,jo);h=So.prototype;h.logger=L("ydn.db.con.SimpleStorage");h.De=function(){return this.h};
h.connect=function(a,b){function c(a,b){setTimeout(function(){b?(P(d.logger,d+" opening fail"),e.F(b)):(P(d.logger,d+" version "+d.De()+" open"),e.callback(a))},10)}var d=this,e=new B;this.j=this.o.Se(a);this.i=a;this.g=b;var f=Ln(this.i);this.h=NaN;var g=wi(this.j.getItem(f));t(g.version)&&!ha(g.version)&&(g.version=NaN);if(g)if(g=new Zm(g),$m(this.g,g,!1,!1))if(!this.g.vc&&!isNaN(g.version)&&this.g.version>g.version)c(NaN,new sl("existing version "+g.version+" is larger than "+this.g.version));
else{var k=this.g.version;this.h=t(k)?k:g.version+1;for(k=0;k<this.g.count();k++)var l=this.g.store(k);if(this.g instanceof Vl)for(k=0;k<g.count();k++)l=g.store(k),Wl(this.g,l);k=this.g.toJSON();k.version=this.h||NaN;this.j.setItem(f,yi(k));c(g.version||NaN)}else{for(k=0;k<this.g.count();k++)l=this.g.store(k);this.h=g.version||NaN;c(this.h)}else g=b.toJSON(),this.h=1,g.version=this.h,this.j.setItem(f,yi(g)),c(NaN);return e};h.Ee=function(){return!!this.i};h.Fe=function(){};h.xd=function(){};
h.se=function(){};h.Tc=function(){return"memory"};h.close=function(){};h.Qd=function(a,b,c,d){a(new ko(this,function(a,b){d(a,b)}))};h.toString=function(){return"SimpleStorage:"+this.Tc()+":"+(this.i+":"+this.h)};function To(){So.call(this,this)}A(To,So);To.prototype.Se=function(){return window.localStorage};To.prototype.Tc=function(){return"localstorage"};pl.push(function(a,b){if(!b||"localstorage"==b){var c=new To,d=new Vl;c.connect(a,d);c.tb(function(a){for(var b=0;b<a.stores.length;b++)Jn(c,a.stores[b].getName()).clear()})}});function Uo(){So.call(this,this)}A(Uo,So);Uo.prototype.Se=function(){return window.sessionStorage};Uo.prototype.Tc=function(){return"sessionstorage"};
pl.push(function(a,b){if(!b||"sessionstorage"==b){var c=new Uo,d=new Vl;c.connect(a,d);c.tb(function(a){for(var b=0;b<a.stores.length;b++)Jn(c,a.stores[b].getName()).clear()})}});function Vo(a,b){this.g=t(a)?a:4194304;this.h=b||"websql"}h=Vo.prototype;
h.connect=function(a,b){function c(b,c){var f=b.version?parseInt(b.version,10):0,g=c.vc?isNaN(f)?1:f+1:c.version;ne(e.logger,a+": changing version from "+b.version+" to "+g);var k=!1,l=0;b.changeVersion(b.version,g+"",function(a){e.tb(function(b){k=!0;for(var d=0;d<c.count();d++){var f=W(b,c.store(d).getName()),f=f?Rm(f,c.store(d)):null;Wo(e,a,c.store(d),function(a){a&&l++},f)}for(d=0;d<b.count();d++)f=b.store(d),Zl(c,f.getName())||(c instanceof Vl?Wl(c,f):(f="DROP TABLE "+Om(f),P(e.logger,f),a.executeSql(f,
[],function(){},function(a,b){throw b;})))},a,b)},function(c){me(e.logger,"SQLError "+c+" "+c.code+"("+c.message+") while changing version from "+b.version+" to "+g+" on "+a);throw c;},function(){if(k){var f=".";l!=c.stores.length&&(f=" but unexpected stores exists.");O(e.logger,a+":"+b.version+" ready"+f);d(b)}else N(e.logger,a+": changing version voided.")})}function d(a,b){t(b)?(e.Ka=null,g.F(b)):(e.Ka=a,g.callback(parseFloat(f)))}var e=this,f=NaN,g=new B,k=null;try{"sqlite"==this.h?q.sqlitePlugin?
(k=q.sqlitePlugin.openDatabase(a,"",a,this.g),k.readTransaction||(k.readTransaction=k.transaction),k.changeVersion=function(a,b,c,d,e){k.transaction(c,d,e)}):(N(this.logger,"sqlitePlugin not found."),k=null,this.Ge=Error("sqlitePlugin not found.")):k=q.openDatabase(a,"",a,this.g)}catch(l){if("SECURITY_ERR"==l.name)N(this.logger,"SECURITY_ERR for opening "+a),k=null,this.Ge=new xl(l);else throw l;}if(k){var f=k.version||"",m="database "+a+(0==f.length?"":" version "+k.version);null!=b.version&&b.version==
k.version?(ne(e.logger,"Existing "+m+" opened as requested."),d(k)):this.tb(function(a){(a=$m(b,a,!0,!1))?(0==f?ne(e.logger,"New "+m+" created."):b.vc?ne(e.logger,"Existing "+m+" opened and schema change for "+a):ne(e.logger,"Existing "+m+" opened and  schema change to version "+b.version+" for "+a),c(k,b)):(ne(e.logger,"Existing "+m+" with same schema opened."),d(k))},null,k)}else d(null,this.Ge);return g};h.Tc=function(){return this.h};h.Ge=null;h.Ka=null;h.logger=L("ydn.db.con.WebSql");h.Fe=function(){};
h.xd=function(){};
function Xo(a){var b=a.I,c="CREATE TABLE IF NOT EXISTS "+Om(a)+" (",d=a.i,c=c+(d+" "+b+" PRIMARY KEY ");a.autoIncrement&&(c+=" AUTOINCREMENT ");if(!a.Dc||!a.keyPath&&0==a.indexes.length)c+=" ,_default_ BLOB";for(var e=[],f=[d],g=0,k=a.indexes.length;g<k;g++){var l=a.index(g),m="";if(l.multiEntry){var m="ydn.db.me:"+a.getName()+":"+l.getName(),n=l.unique?" UNIQUE ":"",l="CREATE TABLE IF NOT EXISTS "+Pa(m)+" ("+d+" "+b+", "+l.i+" "+l.p+n+")";e.push(l)}else l.unique&&(m=" UNIQUE "),n=l.keyPath,"BLOB"!=
l.type&&v(n)&&(n="CREATE "+m+" INDEX IF NOT EXISTS "+Pa(a.getName()+"-"+l.getName())+" ON "+Om(a)+" ("+l.i+")",e.push(n)),n=l.i,-1==f.indexOf(n)&&(c+=", "+n+" "+l.p+m,f.push(n))}e.unshift(c+")");return e}h.De=function(){return this.Ka?parseFloat(this.Ka.version):void 0};
h.tb=function(a,b,c){function d(a,b){throw b;}function e(b,c){if(c&&c.rows){for(var d=0;d<c.rows.length;d++){var e=c.rows.item(d);if("__WebKitDatabaseInfoTable__"!=e.name&&"sqlite_sequence"!=e.name&&"table"==e.type){var r=Pc(e,"sql");O(f.logger,"Parsing table schema from SQL: "+r);for(var s=r.substr(r.indexOf("("),r.lastIndexOf(")")).match(/(?:"[^"]*"|[^,])+/g),w=void 0,y,r=[],G=!1,D=!1,I=0;I<s.length;I++){var S=s[I].match(/\w+|"[^"]+"/g),ua=xb(S,function(a){return a.toUpperCase()}),K=Ma(S[0],'"'),
S=Dm(ua[1]);if(-1!=ua.indexOf("PRIMARY")&&-1!=ua.indexOf("KEY")){y=S;if(v(K)&&!za(K)&&"_ROWID_"!=K){var bd=K.split(","),w=K;1<bd.length&&(w=bd,y=void 0)}-1!=ua.indexOf("AUTOINCREMENT")&&(G=!0)}else if("_ROWID_"!=K)if("_default_"==K)D=!0;else{var mk="UNIQUE"==ua[2];wa(K,e.tbl_name+"-")&&(K=K.substr(e.tbl_name.length+1));ua=new Cm(K,S,mk);r.push(ua)}}if(wa(e.name,"ydn.db.me:")){var Kd=e.name.split(":");if(3<=Kd.length){var We=Kd[1],w=new Cm(Kd[2],S,mk,!0),s=Bb(r,function(a){return a.getName()==Kd[2]});
0<=s?r[s]=w:r.push(w);s=Bb(k,function(a){return a.getName()===We});0<=s?(I=k[s],k[s]=new Sl(I.getName(),I.keyPath,G,y,r,void 0,!D)):k.push(new Sl(We,void 0,!1,void 0,[w]));O(f.logger,'multi entry index "'+w.getName()+'" found in '+We+(-1==s?"*":""))}else N(f.logger,'Invalid multiEntry store name "'+e.name+'"')}else I=Bb(k,function(a){return a.getName()===e.name}),0<=I?(s=k[I].index(0),r.push(s),k[I]=new Sl(e.name,w,G,y,r,void 0,!D)):(r=new Sl(e.name,w,G,y,r,void 0,!D),k.push(r))}}d=new Zm(g,k);a(d)}}
var f=this,g=(c=c||this.Ka)&&c.version?parseFloat(c.version):void 0,g=isNaN(g)?void 0:g,k=[];b?b.executeSql("SELECT * FROM sqlite_master",[],e,d):c.readTransaction(function(b){f.tb(a,b,c)},function(a){me(f.logger,"opening tx: "+a.message);throw a;},e)};
function Wo(a,b,c,d,e){function f(a){b.executeSql(a,[],function(){g++;g==k.length&&(d(!0),d=null)},function(b,e){g++;g==k.length&&(d(!1),d=null);var f="SQLError creating table: "+c.getName()+" "+e.message+' for executing "'+a;throw new wl(e,f);})}var g=0,k=Xo(c),l="Create";if(e){e=Ul(c,e);if(0==e.length){O(a.logger,"same table "+c.getName()+" exists.");d(!0);d=null;return}l="Modify";N(a.logger,"table: "+c.getName()+" has changed by "+e+" ALTER TABLE cannot run in WebSql, dropping old table.");k.unshift("DROP TABLE IF EXISTS "+
Pa(c.getName()))}O(a.logger,l+" table: "+c.getName()+": "+k.join(";"));for(a=0;a<k.length;a++)f(k[a])}h.Ee=function(){return!!this.Ka};h.close=function(){this.Ka=null};
h.Qd=function(a,b,c,d){function e(a){O(k.logger,k+": Tx "+c+" request cause error.");d("abort",a)}function f(){d("complete",{type:"complete"})}function g(b){a(b)}var k=this;null===this.Ka&&(a(null),d("abort",this.Ge));c==Pk?this.Ka.readTransaction(g,e,f):c==Rk?this.Ka.changeVersion(this.Ka.version,this.Ka.version+1+"",g,e,f):this.Ka.transaction(g,e,f)};
pl.push(function(a,b){if(ia(q.openDatabase)&&(!b||"websql"==b)){var c=new Vo,d=new Vl;P(c.logger,"deleting websql database: "+a);var d=c.connect(a,d),e=function(){var b=c.logger;b&&b.info("all tables in "+a+" deleted.",void 0)};d.w(function(){c.Qd(function(b){b.executeSql('SELECT * FROM sqlite_master WHERE type = "table"',[],function(d,e){if(e&&e.rows){for(var l=e.rows.length,m=0,n=0;n<l;n++){var p=e.rows.item(n);"__WebKitDatabaseInfoTable__"!=p.name&&"sqlite_sequence"!=p.name&&(m++,O(c.logger,"deleting table: "+
p.name),b.executeSql("DROP TABLE "+p.name))}P(c.logger,m+' tables deleted from "'+a+'"')}},function(a,b){throw b;})},[],Qk,e)});d.Vc(function(){N(c.logger,"Connecting "+a+" failed.")})}});Vo.prototype.se=function(){};Vo.prototype.toString=function(){return"WebSql:"+(this.Ka?":"+this.Ka.version:"")};pn.prototype.Ue=function(a){return"indexeddb"==a&&Sk?new Qo(this.I,this.N):"sqlite"==a&&q.sqlitePlugin?new Vo(this.I,"sqlite"):"websql"==a&&ia(q.openDatabase)?new Vo(this.I):"localstorage"==a&&window.localStorage?new To:"sessionstorage"==a&&window.sessionStorage?new Uo:"memory"==a?new So:null};function Yo(a,b){cc.call(this);this.j=b;this.h=[];if(a>this.j)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var c=0;c<a;c++)this.h.push(this.g())}A(Yo,cc);Yo.prototype.g=function(){return{}};Yo.prototype.i=function(a){if(x(a))if(ia(a.ca))a.ca();else for(var b in a)delete a[b]};Yo.prototype.H=function(){Yo.m.H.call(this);for(var a=this.h;a.length;)this.i(a.pop());delete this.h};function Zo(){this.g=[];this.i=new Gd;this.j=new Gd;this.o=1;this.l=new Yo(0,4E3);this.l.g=function(){return new $o};this.p=new Yo(0,50);this.p.g=function(){return new ap};var a=this;this.h=new Yo(0,2E3);this.h.g=function(){return String(a.o++)};this.h.i=function(){}}L("goog.debug.Trace");function ap(){this.time=this.count=0}ap.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");return a.join("")};function $o(){}
function bp(a,b,c){var d=[];-1==b?d.push("    "):d.push(cp(a.eventTime-b));d.push(" ",dp(a.eventTime-0));0==a.g?d.push(" Start        "):1==a.g?(d.push(" Done "),d.push(cp(a.i-a.startTime)," ms ")):d.push(" Comment      ");d.push(c,a);0<a.h&&d.push("[VarAlloc ",a.h,"] ");return d.join("")}$o.prototype.toString=function(){return null==this.type?this.comment:"["+this.type+"] "+this.comment};
Zo.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.g.length;d++){var e=this.g[d];1==e.g&&c.pop();a.push(" ",bp(e,b,c.join("")));b=e.eventTime;a.push("\n");0==e.g&&c.push("|  ")}if(0!=this.i.ga()){var f=z();a.push(" Unstopped timers:\n");Ed(this.i,function(b){a.push("  ",b," (",f-b.startTime," ms, started at ",dp(b.startTime),")\n")})}b=this.j.Pa();for(d=0;d<b.length;d++)c=this.j.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",0,"\n","Total comments created ",
0,"\n","Overhead start: ",0," ms\n","Overhead end: ",0," ms\n","Overhead comment: ",0," ms\n");return a.join("")};function cp(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a}function dp(a){a=Math.round(a);return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+a%1E3).substring(1,4)}new Zo;/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function ep(a){a.p||(a.p=new pd);return a.p}pn.prototype.addEventListener=function(a,b,c,d){if("ready"==a)jd(ep(this),a,b,c,d);else{var e="created error fail ready deleted updated versionchange".split(" "),f=function(a){if(!Cb(e,a))throw new F('Invalid event type "'+a+'"');};if(fa(a))for(var g=0;g<a.length;g++)f(a[g]);else f(a);cd(ep(this),a,b,c,d)}};pn.prototype.removeEventListener=function(a,b,c,d){kd(ep(this),a,b,c,d)};pn.prototype.cb=function(a){ep(this).dispatchEvent(a)};function fp(a,b,c){rn.call(this,a,b,c)}A(fp,Po);L("ydn.gdata.base");function gp(a){this.i=a||null;this.g=this.h=null;a&&hp(this,a)}gp.prototype.logger=L("ydn.crm.UserSetting");
var ip={stores:[{name:"general"},{name:"sugar"}]},jp={stores:[{name:"contact",keyPath:"id.$t",type:"TEXT",indexes:[{name:"updated.$t",type:"TEXT"},{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[];a=u(a.gd$email)?a.gd$email:x(a.gd$email)?[a.gd$email]:[];for(var c=0;c<a.length;c++){var d=xo(a[c].address);d&&b.push(d)}return b}},{name:"ydn$externalIds",multiEntry:!0,generator:function(a){return(u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:
[]).map(function(a){return a.value})}}]}]};function hp(a,b){if(!a.i||a.i!=b){q.sessionStorage.setItem("last-user-id",b);var c="setting-"+b,d="gdata-"+b;a.h&&a.h.getName()!=c&&(a.h.close(),a.h=null);a.g&&a.g.getName()!=d&&(a.g.close(),a.g=null);a.h||(a.h=new fp(c,ip));a.g||(a.g=new fp(d,jp))}}function kp(a){return a.i?a.i+"-sd":q.sessionStorage.getItem("last-user-id")+"-sd"}function lp(a){var b=kp(a),c=new B;chrome.storage.local.get(b,function(a){c.callback(a[b])});return c}
function mp(a,b){var c=kp(a),d=new B,e={};e[c]=b;chrome.storage.local.set(e,function(){d.callback(!0)})};function np(a){a.preventDefault();var b=200,c=100,d=a.target.getAttribute("data-window-height"),e=a.target.getAttribute("data-window-width");e&&(b=parseInt(e,10));d&&(c=parseInt(d,10));window.open(a.target.href,void 0,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+b+", height="+c+", top="+(window.innerWidth/2-c/2+window.screenTop)+", left="+(window.innerWidth/2-b/2+window.screenLeft))}
function op(){var a=new B;chrome.storage.sync.get("user-setting",function(b){a.callback(b["user-setting"])});return a};function pp(){pd.call(this)}A(pp,pd);pp.prototype.logger=L("ydn.crm.Client");function qp(a,b,c){this.h=a;this.i=b;this.g=c}qp.prototype.request=function(a){return this.h(a)?this.i.request(a):this.g.request(a)};function rp(a,b,c){this.client=a;this.i=b;this.h=NaN;this.j=[];this.g=!1;this.l=!!c}rp.prototype.request=function(a){return new sp(a,this)};function sp(a,b){a.path=b.i+a.path;this.req=b.client.request(a);this.parent=b;b.l&&(this.req instanceof ik&&(this.req.j=!0),this.j=!0);this.i=null;this.h=void 0}A(sp,ik);
sp.prototype.execute=function(a,b){if(this.parent.g)this.i=a,this.h=b,this.parent.j.push(this);else{this.parent.g=!0;var c=function(c,d){var g=ek(d,"retry-after");this.parent.h=g?/[^0-9|\.]/.test(g)?(new Date(g)).getTime():1E3*parseFloat(g)+z():NaN;a&&a.call(b,c,d);this.parent.g=!1;if(g=this.parent.j.pop())g.execute(g.i,g.h),g.i=null,g.h=null},d=this.parent.h-z();0<d?Vf(function(){this.parent.h=NaN;this.req.execute(c,this)},d,this):this.req.execute(c,this)}};function tp(a,b,c,d,e){this.l=t(a)?a:ak();this.g=b;this.h=c;this.i=d||0;this.j=!!e}tp.prototype.request=function(a){if(this.g){a.headers||(a.headers={});for(var b in this.g)a.headers[b]=this.g[b]}this.h&&(a.path=this.h+a.path);return new ik(a,this.l,this.i,this.j)};function up(a,b,c){this.i=t(a)?a:ak();this.g=b;this.h=c}up.prototype.request=function(a){if(this.g){a.headers||(a.headers={});for(var b in this.g)a.headers[b]=this.g[b]}this.h&&(a.path=this.h+a.path);return new ik(a,this.i)};function vp(a){for(var b=gn(a),c=0;c<b.stores.length;c++);b=(b=Hl)||Hl;b=qn(a,b,!1,void 0,void 0,void 0);this.g=a.Pc(b,a.ab);this.j=!1;a.gb(this.I,this);this.h=1E4;this.l=ae.value;this.i=0;this.u=oa(this.L,this);this.p=!1;this.o={}}function wp(a){if(a.h&&a.i>=a.h){var b=a.h/100;100<b&&(b=100);a.g.keys("db-logger",null,b).w(function(a){a=a.map(function(a){return new Al("db-logger",a)});this.g.remove(a).w(function(){this.g.count("db-logger").w(function(a){this.i=a},this)},this)},a)}}
function xp(){var a=yp;a.h=1E4;wp(a)}vp.prototype.I=function(){this.h&&(this.j=!0,this.g.count("db-logger").w(function(a){this.i=a;wp(this)},this))};function zp(a){var b=yp;if(a!=b.p){var c=ke();a?de(c,b.u):(c=c.g)&&Eb(c,b.u);b.p=a}}vp.prototype.L=function(a){if(this.j){var b=a.h;wa(b,"ydn.db.")||this.o[b]||!(b=a.j)||b.value<=this.l||(a={exception:a.g,level:b.value,logger:a.h,name:b.name,time:a.l,message:a.getMessage(),seq:a.o},this.g.put("db-logger",a),this.i++,wp(this))}};
function Ap(a,b){var c=yp,d=a||100,e=b||0,f=tk(["INFO"]);return c.g.values("db-logger","name, time",f,d,e,!0)}var yp=null;function Bp(a){this.j=a;this.h=this.j.length/4;this.l=this.h+6;this.i=[[],[],[],[]];this.o=[[],[],[],[]];this.g=Array(4*(this.l+1));for(a=0;a<this.h;a++)this.g[a]=[this.j[4*a],this.j[4*a+1],this.j[4*a+2],this.j[4*a+3]];var b=Array(4);for(a=this.h;a<4*(this.l+1);a++){b[0]=this.g[a-1][0];b[1]=this.g[a-1][1];b[2]=this.g[a-1][2];b[3]=this.g[a-1][3];if(0==a%this.h){var c=b,d=c[0];c[0]=c[1];c[1]=c[2];c[2]=c[3];c[3]=d;Cp(b);b[0]^=Dp[a/this.h][0];b[1]^=Dp[a/this.h][1];b[2]^=Dp[a/this.h][2];b[3]^=Dp[a/this.h][3]}else 6<
this.h&&4==a%this.h&&Cp(b);this.g[a]=Array(4);this.g[a][0]=this.g[a-this.h][0]^b[0];this.g[a][1]=this.g[a-this.h][1]^b[1];this.g[a][2]=this.g[a-this.h][2]^b[2];this.g[a][3]=this.g[a-this.h][3]^b[3]}}function Ep(a,b){for(var c=0;4>c;c++)for(var d=0;4>d;d++)a.i[c][d]^=a.g[4*b+d][c]}function Fp(a){for(var b=Gp,c=0;4>c;c++)for(var d=0;4>d;d++)a.i[c][d]=b[a.i[c][d]]}function Hp(a){for(var b=1;4>b;b++)for(var c=0;4>c;c++)a.o[b][c]=a.i[b][c];for(b=1;4>b;b++)for(c=0;4>c;c++)a.i[b][c]=a.o[b][(c+b)%4]}
function Cp(a){a[0]=Gp[a[0]];a[1]=Gp[a[1]];a[2]=Gp[a[2]];a[3]=Gp[a[3]]}
var Gp=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,
61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Dp=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,
0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],Ip=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,
27,25,31,29,19,17,23,21,11,9,15,13,3,1,7,5,59,57,63,61,51,49,55,53,43,41,47,45,35,33,39,37,91,89,95,93,83,81,87,85,75,73,79,77,67,65,71,69,123,121,127,125,115,113,119,117,107,105,111,109,99,97,103,101,155,153,159,157,147,145,151,149,139,137,143,141,131,129,135,133,187,185,191,189,179,177,183,181,171,169,175,173,163,161,167,165,219,217,223,221,211,209,215,213,203,201,207,205,195,193,199,197,251,249,255,253,243,241,247,245,235,233,239,237,227,225,231,229],Jp=[0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,
17,48,51,54,53,60,63,58,57,40,43,46,45,36,39,34,33,96,99,102,101,108,111,106,105,120,123,126,125,116,119,114,113,80,83,86,85,92,95,90,89,72,75,78,77,68,71,66,65,192,195,198,197,204,207,202,201,216,219,222,221,212,215,210,209,240,243,246,245,252,255,250,249,232,235,238,237,228,231,226,225,160,163,166,165,172,175,170,169,184,187,190,189,180,183,178,177,144,147,150,149,156,159,154,153,136,139,142,141,132,135,130,129,155,152,157,158,151,148,145,146,131,128,133,134,143,140,137,138,171,168,173,174,167,
164,161,162,179,176,181,182,191,188,185,186,251,248,253,254,247,244,241,242,227,224,229,230,239,236,233,234,203,200,205,206,199,196,193,194,211,208,213,214,223,220,217,218,91,88,93,94,87,84,81,82,67,64,69,70,79,76,73,74,107,104,109,110,103,100,97,98,115,112,117,118,127,124,121,122,59,56,61,62,55,52,49,50,35,32,37,38,47,44,41,42,11,8,13,14,7,4,1,2,19,16,21,22,31,28,25,26];function Kp(a){this.g=a};function Lp(a,b){this.h=-1;this.h=Mp;this.j=q.Uint8Array?new Uint8Array(this.h):Array(this.h);this.o=this.i=0;this.g=[];this.I=a;this.p=b;this.L=q.Int32Array?new Int32Array(64):Array(64);t(Np)||(q.Int32Array?Np=new Int32Array(Op):Np=Op);this.u()}var Np;A(Lp,Qg);for(var Mp=64,Pp=Mp-1,Qp=[],Rp=0;Rp<Pp;Rp++)Qp[Rp]=0;var Sp=Fb(128,Qp);Lp.prototype.u=function(){this.o=this.i=0;this.g=q.Int32Array?new Int32Array(this.p):Gb(this.p)};
function Tp(a){for(var b=a.j,c=a.L,d=0,e=0;e<b.length;)c[d++]=b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3],e=4*d;for(b=16;64>b;b++){var e=c[b-15]|0,d=c[b-2]|0,f=(c[b-16]|0)+((e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3)|0,g=(c[b-7]|0)+((d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10)|0;c[b]=f+g|0}for(var d=a.g[0]|0,e=a.g[1]|0,k=a.g[2]|0,l=a.g[3]|0,m=a.g[4]|0,n=a.g[5]|0,p=a.g[6]|0,f=a.g[7]|0,b=0;64>b;b++)var r=((d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10))+(d&e^d&k^e&k)|0,g=m&n^~m&p,f=f+((m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<
7))|0,g=g+(Np[b]|0)|0,g=f+(g+(c[b]|0)|0)|0,f=p,p=n,n=m,m=l+g|0,l=k,k=e,e=d,d=g+r|0;a.g[0]=a.g[0]+d|0;a.g[1]=a.g[1]+e|0;a.g[2]=a.g[2]+k|0;a.g[3]=a.g[3]+l|0;a.g[4]=a.g[4]+m|0;a.g[5]=a.g[5]+n|0;a.g[6]=a.g[6]+p|0;a.g[7]=a.g[7]+f|0}
Lp.prototype.update=function(a,b){t(b)||(b=a.length);var c=0,d=this.i;if(v(a))for(;c<b;)this.j[d++]=a.charCodeAt(c++),d==this.h&&(Tp(this),d=0);else if(u(a))for(;c<b;){var e=a[c++];if(!("number"==typeof e&&0<=e&&255>=e&&e==(e|0)))throw Error("message must be a byte array");this.j[d++]=e;d==this.h&&(Tp(this),d=0)}else throw Error("message must be string or array");this.i=d;this.o+=b};
Lp.prototype.l=function(){var a=[],b=8*this.o;56>this.i?this.update(Sp,56-this.i):this.update(Sp,this.h-(this.i-56));for(var c=63;56<=c;c--)this.j[c]=b&255,b/=256;Tp(this);for(c=b=0;c<this.I;c++)for(var d=24;0<=d;d-=8)a[b++]=this.g[c]>>d&255;return a};
var Op=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,
4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Up(){Lp.call(this,8,Vp)}A(Up,Lp);var Vp=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Wp(a,b){this.g=a;this.j=Ng("requestAnimationFrame");this.filter=b||null;this.i=!1;this.h=this.prefix=""}function Xp(){var a=Rj;a.i||(Yp(a),a.i=!0,window.setInterval(function(){a.count().w(function(b){20<b&&Yp(a)})},6E5))}Wp.prototype.count=function(){return this.g.count("log")};
function Yp(a){var b=Vi();if(b){var c={"Content-Type":"application/json"};a.g.values("log",null,40).w(function(a){if(0!=a.length){var e=a.map(function(a){return a.key});a=JSON.stringify(a);a=new Xi("https://mhardartway.s3.amazonaws.com/"+(this.prefix+e[0]+this.h),"PUT",null,c,a);e=e.map(function(a){return new Al("log",a)});b.request(a).execute(function(a,b){aj(b)&&this.g.remove(e).w(function(a){a==e.length&&Yp(this)},this)},this)}},a)}}
Wp.prototype.log=function(a){this.filter&&(a=this.filter(a));if(a){var b=JSON.stringify(a);a=String(z());for(var c=[],d=0;16>d;++d)c[d]=256*Math.random()|0;var d=this.j,e=new Up;e.update(Ng(a));e.update(c);e.update(d);for(var e=e.l(),d=Ng(b),b=c.length-d.length%c.length,f=0;f<b;f++)d.push(10);for(var b=new Bp(e),b=new Kp(b),e=[],g=c,f=0;f<d.length;f+=16){for(var k=Jb(d,f,f+16),l=[],m=0;m<k.length;m++)l.push(k[m]^g[m]);for(var g=k=b.g,n=void 0,n=void 0,m=0;4>m;m++)for(var p=0;4>p;p++)n=4*p+m,n=l[n],
g.i[m][p]=n;Ep(k,0);for(g=1;g<k.l;++g){Fp(k);Hp(k);l=k.i;m=k.o[0];for(p=0;4>p;p++)m[0]=l[0][p],m[1]=l[1][p],m[2]=l[2][p],m[3]=l[3][p],l[0][p]=Ip[m[0]]^Jp[m[1]]^m[2]^m[3],l[1][p]=m[0]^Ip[m[1]]^Jp[m[2]]^m[3],l[2][p]=m[0]^m[1]^Ip[m[2]]^Jp[m[3]],l[3][p]=Jp[m[0]]^m[1]^m[2]^Ip[m[3]];Ep(k,g)}Fp(k);Hp(k);Ep(k,k.l);g=[];for(l=0;4>l;l++)for(m=0;4>m;m++)g[4*m+l]=k.i[l][m];k=g;Hb(e,k);g=k}this.g.put("log",{key:a,salt:c,value:Og(e)})}};var Zp,$p,aq=L("ydn.crm");function bq(){Zp||(Zp=new Ig(0));return Zp}var cq=null,dq={};function eq(a,b){"sync"==b&&(x(a["lg-cc"])&&lj(!!a["lg-cc"].newValue),x(a["lg-br"])&&zp(!!a["lg-br"].newValue),x(a["cp-po"])&&(dq["cp-po"]=a["cp-po"].newValue||fq))}var gq=!1,hq="";z();
function iq(){if(!gq){gq=!0;var a;a="Yathit CRM Bridge ydn.crm.version 0.10.11 (dev)";Qj("ydn.crm","fine");Qj("ydn.crm.inj.App","finer");Qj("ydn.ds","fine");q.console.info(a);q.console.info("API documentation: http://dev.yathit.com/\nFeedback and suggestion: https://yathit.uservoice.com/\nBug report: https://github.com/yathit/sugarcrm-gmail-chrome-extension");lj(!1);cq=new fp("ydn.crm",{stores:[{name:"log",keyPath:"key"},{name:"db-logger",autoIncrement:!0,indexes:[{name:"level"},{name:"time"},{name:"name"},
{name:"name, time",keyPath:["name","time"]}]},{name:"default",autoIncrement:!0}]});yp=new vp(cq);xp();yp.l=300;yp.o["ydn.db.tr.DbOperator"]=!0;zp(!1);cq.gb(function(){cq.get("default","install-id").w(function(a){a?hq=a["install-id"]:(hq=z()+Math.random().toFixed(8).substr(2),a={},a["install-id"]=hq,cq.put("default",a,"install-id"));Rj.h=hq})});aq.info("Starting ydn.crm.App:0.10.11");var b=["lg-cc","cp-po","lg-br"];chrome.storage.sync.get(b,function(a){for(var d={},e=0;e<b.length;e++)t(a[b[e]])&&(d[b[e]]=
{newValue:a[b[e]]});eq(d,"sync")});chrome.storage.onChanged.addListener(eq);hk=Rj=new Wp(cq,function(a){return!a||a.HttpRequestData&&"https://mail.google.com/mail/feed/atom/bazinga"==a.HttpRequestData.path?null:a});window.onerror=function(a,b,e,f){var g="";f&&f instanceof Error&&(g=f.stack+"");Sj({message:a,url:b,lineNumber:e,stack:g})}}}
function jq(a){kq();lq();mq();a=new kk(a,Zp,!1);Zj(a,"gc");Zj(new qp(function(a){return"GET"==a.method},a,new rp(a,"https://yathit-app.appspot.com/proxy/",!0)),"gse")}function kq(){var a=Vi(Wi);a||($p||($p=new up(bq()),Zj($p,"default")),a=new tp(bq(),void 0,"https://yathit-app.appspot.com",0,!0),Zj(a,Wi));return a}function lq(){var a=Vi("proxy");a||(a=new rp(kq(),"/proxy/"),Zj(a,"proxy"))}
function mq(){var a=Vi("auth");a||(a=new tp(bq(),void 0,"https://yathit-app.appspot.com/a/cm",0,!0),Zj(a,"auth"));return a}function nq(a){var b=new B;a=new Xi("/info","GET",{email:a});kq().request(a).execute(function(a,d){window.console.log(a);a?b.callback(a):b.F(d)});return b};function oq(a,b){this.timestamp=b||z();this.type=a;this.i=this.g=this.h=void 0}function pq(a,b){x(b)?a.h=bn(b):a.h=b}oq.prototype.toJSON=function(){return{type:this.type,timestamp:this.timestamp,newValue:this.g,oldValue:this.h,meta:this.i}};function qq(a){this.g=a}qq.prototype.add=function(a){this.g.add("history",a.toJSON())};function rq(a,b){if(a.link){if(u(a.link)){for(var c=0;c<a.link.length;c++)if(a.link[c].rel==b)return a.link[c];return null}return a.link.rel==b?a.link:null}return null};function sq(a,b){this.entry=a;this.data=b;this.g=!1}sq.prototype.data=null;sq.prototype.preventDefault=function(){this.g=!0};function tq(a,b,c,d){E.call(this,a,b);this.status=c;this.entry=d}A(tq,E);tq.prototype.status=NaN;tq.prototype.Q=function(){return this.status};tq.prototype.Kb=function(){return this.entry.Kb()};function uq(a,b,c){tq.call(this,"conflict",a,b,c.entry)}A(uq,tq);function vq(a,b){this.g=a;if(b)throw new vd("optional key paths");}var wq={wj:"key",sj:"date",xj:"modified",vj:"expires",uj:"etag",Bj:"updated",Cj:"uri",NEXT:"next"};vq.prototype.U=function(a,b){return b&&this.g[a]?Bk(b,this.g[a]):void 0};function xq(a,b,c,d){a.g[b]&&Ck(c,a.g[b],d)};function yq(a,b,c,d){this.key=a;this.h=(this.h=d?b[d]:b)||{};this.g=c}function zq(a){return null!=a.key?a.key:a.g.U("key",a.h)}yq.prototype.getDate=function(){return this.g.U("date",this.h)};function Aq(a){return a.g.U("updated",a.h)}function Bq(a){return a.g.U("etag",a.h)}function Cq(a){var b={},c=Bq(a);c&&1<c.length?b["if-none-match"]=c:(a=Aq(a))&&(b["if-modified-since"]=a);return b}
yq.prototype.toJSON=function(){var a={};xq(this.g,"key",a,zq(this));var b=this.getDate();b&&xq(this.g,"date",a,b);(b=this.g.U("expires",this.h))&&xq(this.g,"expires",a,b);(b=Aq(this))&&xq(this.g,"updated",a,b);(b=Bq(this))&&xq(this.g,"etag",a,b);return a};function Dq(a,b,c){b.expires&&xq(c,"expires",b,(new Date(b.expires)).getTime());b["last-updated"]&&xq(c,"updated",b,(new Date(b["last-updated"])).getTime());b.etag&&xq(c,"etag",b,(new Date(b.etag)).getTime());xq(c,"date",b,NaN);yq.call(this,a,b,c)}A(Dq,yq);function Eq(a,b,c){this.g=a;this.o=c||null;this.i=this.h=null;this.key=b}h=Eq.prototype;h.logger=L("ydn.db.sync.entry.Rest");h.Kb=function(){if(this.i&&this.g.p&&this.j){var a=this.g.u;this.g.N||delete this.i[a]}return this.i||null};h.U=function(){return this.o};h.G=function(){return this.key};h.He=function(){return this.g.zf(this.G())};function Fq(a,b){var c=a.G();return new Dq(c,b.bd(),a.g.o)}
h.df=function(a,b){if(a)return a;if(aj(b))return fk(b);try{return fk(b)}catch(c){var d=dk(b);return x(d)?d:{body:d}}};h.save=function(a){var b=this.G();if(a&&!this.g.p)return z(),Gq(this.g,[this.j.toJSON()]);var c=this.i;if(a&&!c)return ac();a=void 0;null!=this.j&&(z(),a=[this.j.toJSON()]);return Hq(this.g,[c],a,[b])};
h.Ac=function(a,b){if(this.g.L&&x(this.h))a.call(b,304),a=null;else{var c=this;Iq(this,function(d){if(d){var e=d.g.U("expires",d.h);if(e&&e>z()){O(this.logger,this+" not expired");a.call(b,304);a=null;return}}e=c.He();d=c.xc(e,"GET",d);this.g.xa().request(d).execute(function(d,e){c.j=Fq(c,e);c.i=c.df(d,e);a.call(b,e.Q());a=null})},this)}};
h.xc=function(a,b,c,d){a=new Xi(a,b);if(c){var e;"POST"==a.method||"PUT"==a.method||"DELETE"==a.method?(e={},(b=Aq(c))&&(e["if-unmodified-since"]=b),(c=Bq(c))&&1<c.length&&(e["if-match"]=c),c=e):c=Cq(c);e=c;a.headers?Sc(a.headers,e):a.headers=e}a.body=x(d)?JSON.stringify(d):d;O(this.logger,this+" "+a.method+" "+a.path+" "+xi(e));return a};
function Jq(a,b,c){Iq(a,function(a){var e=this.U();a=this.xc(this.He(),"PUT",a,e);this.g.xa().request(a).execute(function(a,d){this.j=Fq(this,d);this.i=a;b&&(b.call(c,d.Q()),b=null)},this)},a)}function Iq(a,b,c){a.l?b.call(c,a.l):Kq(a.g,a.G(),function(d){a.l=d;b.call(c,d)})}
h.load=function(a,b){if(this.h&&this.l)a&&(a.call(b,this.h,this.l),a=void 0);else{var c=this.G();this.g.load(c,function(c,e){this.h=c;var f=this.g.u;this.h&&f&&this.h[f]&&(this.l=new yq(this.key,this.h,this.g.o,f),this.g.N||delete this.h[f]);this.h=c;this.l=e;a&&(a.call(b,c),a=void 0)},this)}};function Lq(a,b){var c=a.He(),d=a.g.xa();Iq(a,function(a){a=this.xc(c,"DELETE",a);d.request(a).execute(function(a,d){O(this.logger,"deleted "+c+" "+d.Q());b.call(this,d.Q())},this)},a)}
h.toString=function(){return"sync.entry{"+this.g.K()+":"+this.key+"}"};function Mq(a,b,c){this.storage=a;this.store=b;this.V=b.getName();a="format readRequestTimeout writeRequestTimeout transport Options fetchStrategies baseUri immutable keepMeta metaStoreName metaDataName prefetch prefetchRefractoryPeriod".split(" ");for(var d in c)if(-1==tb(a,d))throw new F('Unknown Sync attribute "'+d+'"  in Sync.');this.L=!!c.immutable;this.h=c.baseUri;this.Ob=c.metaStoreName||this.V;this.u=c.metaDataName;this.p=this.Ob==this.V;a=c.Options||{};if(!this.Ob)throw new F("metadata store name required.");
b=this.Ib();for(d in a)if(-1==tb(b,d))throw new F('Unknown Sync.Options attribute "'+d+'" in Sync.Options');this.aa=a.delimiter||"";this.j=a.prefix||"";this.N=!!c.keepMeta;this.D=c.prefetch||ha(c.prefetchRefractoryPeriod)?"full":null;this.Y=ha(c.prefetchRefractoryPeriod)?c.prefetchRefractoryPeriod:5E3;this.g=Nq(c.transport);this.o=new vq(this.Hb(),c.metaData);this.l=null;this.I=NaN}h=Mq.prototype;h.Hb=function(){var a={},b;for(b in wq)a[b]=b;return a};h.Ib=function(){return[]};h.K=function(){return this.V};
h.logger=L("ydn.db.sync.Rest");h.Rb=function(){return this.h};h.xa=function(){this.g||(this.g=new up);return this.g};h.toString=function(){return"sync:"+this.V};function Gq(a,b){return om(a.storage.g,a.Ob,b).Vc(function(a){throw a;})}function Oq(a,b,c){a.store.keyPath&&null==fm(a.store,b)&&null!=c&&Ck(b,a.store.keyPath,c)}
function Hq(a,b,c,d){d=a.store.keyPath?void 0:d;if(c){if(a.p){for(g=0;g<b.length;g++)null!=c[g]&&Sc(b[g],c[g]);return om(a.storage.g,a.V,b,d)}if(b){for(var e=[],f=b.concat(c),g=0;g<b.length;g++){var k=a.store.keyPath?NaN:d[g];e.push(new Al(a.V,k))}for(g=0;g<c.length;g++)e.push(new Al(a.Ob,NaN));return om(a.storage.g,e,f)}return om(a.storage.g,a.Ob,c)}for(g=0;g<b.length;g++)k=d?d[g]:void 0,Oq(a,b[g],k);return om(a.storage.g,a.V,b,d)}
function Pq(a,b){var c=[new Al(a.V,b)];a.p||c.push(new Al(a.Ob,b));return pm(a.storage.g,c)}h.zf=function(a){return this.Rb()+a};h.add=function(a,b,c){null!=c?Oq(this,b,c):this.store.keyPath&&(c=fm(this.store,b));var d=this.Aa(c,b),e=this;Jq(d,function(a){201==a||200==a?(O(e.logger,d+" created"),d.save(!0)):N(e.logger,"Unexpected respond "+a+" for add "+d)})};
function Kq(a,b,c){var d=new Al(a.Ob,b);Qq(a,[d]).A(function(a){c.call(void 0,new yq(b,a[0],this.o,this.u))},function(a){N(this.logger,this+" error loading meta data "+a);c.call(void 0,null)},a)}h.ne=function(a,b){var c=a.map(function(a){return new Al(this.Ob,a)});Qq(this,c).A(function(c){for(var e=[],f=0;f<a.length;f++)e[f]=new yq(a[f],c[f],this.o,this.u);b(e)},function(a){N(this.logger,this+" error loading meta data "+a);b([])},this)};
h.load=function(a,b,c){var d=this.Ob,e=[new Al(this.K(),a)];this.p||e.push(new Al(d,a));Qq(this,e).A(function(d){var e=d[0];b.call(c,e,new yq(a,this.p?e:d[1],this.o,this.u))},function(a){N(this.logger,this+" error loading meta data "+a);b.call(c,null,null)},this)};function Qq(a,b){return sm(a.storage.g,b)}
h.get=function(a,b){this.I||this.lc();ml(a,function(c,d,e){if(d)e(c,d);else{pe(a,c);var f=t(c);if(f&&this.L)e(c);else{var g=this.Aa(b,c);g.Ac(function(a){if(304==a){if(e(c),!f)throw new yd(g+" not modified, but not exist in server");}else if(200==a)g.save().fa(function(){e(g.Kb())});else if(404==a)Pq(g.g,g.G()).fa(function(){e(g.Kb())});else throw e(g.Kb()),new xd("Invalid HTTP respond "+a+" for GET "+b);},this)}}},this)};
function Rq(a,b,c,d,e,f){var g=[],k=a.logger;P(a.logger,d.length+", "+e.length+", "+f.length+", "+g.length+" records to fetch, update, delete, save");var l=d.length+e.length+f.length+g.length;if(0==l)b(c);else{for(var m=!1,n=function(){l--;0==l&&(b(c,m),b=null)},g=0;g<d.length;g++){var p=a.Aa(d[g]);p.index=g;p.Ac(function(a){200==a?(ge(k,"A new "+this+" received from server"),this.save().A(function(){c[this.index]=this.Kb();n()},function(){m=!0;n()},this)):304==a?this.save(!0).A(function(){ge(k,this+
" expires date updated");n()},function(){m=!0;n()},this):(H(k,"Invalid status "+a+" for fetching "+this),n())},p)}for(g=0;g<e.length;g++)p=a.Aa(e[g]),p.index=g,p.load(function(){this.Ac(function(a){200==a?(ge(k,this+" updated from server"),this.save().A(function(){c[this.index]=this.Kb();n()},function(){m=!0;n()},this)):(H(k,"Invalid status "+a+" for fetching "+this),n())})});for(g=0;g<f.length;g++)p=a.Aa(f[g]),p.index=g,Pq(p.g,p.G()).A(function(){c[this.index]=new sq(p,null);n()},function(){m=!0;
n()},p)}}function Sq(a,b,c){ml(b,function(a,e,f){if(e)f(a,e);else if(zb(a,function(a){return t(a)})&&this.L)f(a);else{pe(b,a);var g=a.length;for(e=0;e<c.length;e++)if(this.L&&t(a[e]))g--,0==g&&f(a);else{var k=this.Aa(c[e],a[e]);k.index=e;k.Ac(function(b){200==b?(a[this.index]=this.Kb(),this.save()):404==b&&(a[this.index]=void 0);g--;0==g&&f(a)},k)}}},a)}h.Aa=function(a,b){return new Eq(this,a,b)};h.count=function(a){return a};h.Gf=function(){throw new vd;};
h.values=function(a,b,c){Tq(this)?(O(this.logger,"prefetch queued"),ml(a,function(d,e,f){pe(a,d);e?f(d,e):Uq(this,function(a){a?rm(this.storage.g,this.V,null,null,!1,b,c).A(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(){N(this.logger,this+" prefetch fail");f(d)},this)},this)):this.Gf(a,b,c)};
h.keys=function(a,b,c,d,e,f,g){ml(a,function(k,l,m){pe(a,k);l?m(k,l):Uq(this,function(a){a?tm(this.storage.g,this.V,b,c,d,e,f,g).A(function(a){m(a)},function(a){m(a,!0)},this):m(k)},function(){N(this.logger,this+" prefetch fail");m(k)},this)},this)};h.bf=function(){};
h.put=function(a,b,c){c=t(c)?c:this.store.keyPath?fm(this.store,b):null;var d=this.Aa(c,b);U(a,function(){d.load()},this);ml(a,function(c,f,g){pe(a,c);Jq(d,function(c){409==c?d.Ac(function(){var c=new sq(d,b);pe(a,c);c.g?g(null,f):g(void 0,f)}):200==c||201==c?(d.save(!0),g(b,f)):(N(this.logger,"Unexpected response for PUT: "+c),g(null,f))},this)},this)};
h.remove=function(a,b){var c=this,d=this.Aa(b);d.load(function(){ml(a,function(e,f,g){Lq(d,function(f){if(409==f){f=new sq(d,null);pe(a,f);var l=new uq(c.storage,409,f);c.storage.cb(l)}else 200==f?O(c.logger,"Successfully deleted object "+b):(N(c.logger,"Unexpected response for DELETE: "+f+" "+b),pe(a,l));g(e)})})})};
h.lc=function(){O(this.logger,this+" starting prefetch");var a=new B;rm(this.storage.g,this.V,"updated.$t",null,!0,1).A(function(b){var c={};if(b=b[0])b=Nc(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b;var d=this,c=new Xi(this.Rb(),"GET",c);d.xa().request(c).execute(function(b,c){if(200==c.Q()){if(!b){var g=dk(c);v(g)&&(b=JSON.parse(g))}g=(g=(b.feed||b).entry)?u(g)?g:[g]:[];0<g.length?Hq(d,g).fa(function(){a.callback(!0)}):a.callback(!1)}else 302==c.Q()?a.callback():
(g=d+": Invalid response status "+c.Q()+" on prefetching",N(d.logger,g),a.F(Error(g)))})},function(b){a.F(b)},this);return a};function Tq(a){return a.D?a.I?z()-a.I>a.Y:!0:!1}function Uq(a,b,c,d){Tq(a)?a.l?a.l.A(b,c,d):(a.l=a.lc(),a.I=z(),a.l.A(b,c,d),a.l.A(function(a){O(this.logger,"prefetch "+(a?"updated":"no update"));this.l=null},function(a){this.l=null;throw a;},a)):b.call(d,!1)};function Vq(a,b,c){Mq.call(this,a,b,c)}A(Vq,Mq);Vq.prototype.logger=L("ydn.db.sync.Atom");Vq.prototype.Ib=function(){return Vq.m.Ib.call(this)};Vq.prototype.G=function(a){return a.key};function Wq(a){this.data=a}h=Wq.prototype;h.G=function(){return this.data.id.$t};h.vd=function(){return this.data.title?this.data.title.$t:void 0};h.Be=function(a){return rq(this.data,a)};h.ej=function(){var a=this.Be("self");return a?a.href:void 0};h.dj=function(){var a=this.Be("http://schemas.google.com/g/2005#batch");return a?a.href:""};h.qa=function(){return this.data.content||null};function Xq(a,b,c){Eq.call(this,a,b,c)}A(Xq,Eq);Xq.prototype.logger=L("ydn.db.sync.entry.S3");Xq.prototype.getName=function(){return this.g.j+this.key};Xq.prototype.xc=function(a,b,c,d){b=Xq.m.xc.call(this,a,b,c,d);if("PUT"==b.method||"POST"==b.method){c=Pe(new Be(a)).substr(1);if(1>c.length)throw new xd("invalid url "+a);b.headers.Key=c;a=b.headers["Content-Type"]||"application/json";d instanceof File?a=d.type:v(d)&&(a=/<*DOCTYPE html/i.test(d)?"text/html":"text/plain");b.headers.ContentType=a}return b};function Yq(a){this.data=a}A(Yq,Wq);var Zq={atom:"http://www.w3.org/2005/Atom",ydn:"http://www.yathit.com/2012/ydn",app:"http://www.w3.org/2007/app",openSearch:"http://a9.com/-/spec/opensearch/1.1/",gAcl:"http://schemas.google.com/acl/2007",sites:"http://schemas.google.com/sites/2008",gs:"http://schemas.google.com/spreadsheets/2006",dc:"http://purl.org/dc/terms",batch:"http://schemas.google.com/gdata/batch",gd:"http://schemas.google.com/g/2005",gContact:"http://schemas.google.com/contact/2008",thr:"http://purl.org/syndication/thread/1.0",
xhtml:"http://www.w3.org/1999/xhtml"};function $q(a,b){for(var c=a.indexOf(" "),d=0;d<b.length;d++){var e=b[d],e=(0==d?"xmlns":"xmlns:"+e)+'="'+Zq[e]+'"';-1==a.indexOf(e)&&(a=a.substring(0,c+1)+e+" "+a.substr(c+1))}return a}L("ydn.xml");function ar(a){return Zq[a]||Zq.xhtml};function br(a,b,c){c=!!c;if(a.getName()!=b.getName())return!1;var d=cr(a),e=cr(b);if(!c&&d.length!=e.length||c&&e.length>d.length)return!1;for(d=0;d<e.length;d++)if(a.getAttribute(e[d])!=b.getAttribute(e[d]))return!1;d=dr(a);e=dr(b);if(!c&&d.length!=e.length||c&&e.length>d.length)return!1;if(0==d.length||0==d.length)return a.data.$t===b.data.$t;for(d=0;d<e.length;d++){var f=er(a,e[d]),g=er(b,e[d]);if(!c&&f.length!=g.length||c&&g.length>f.length)return!1;for(var k=0;k<g.length;k++)if(-1==Bb(f,function(a){return br(a,
g[k],c)}))return!1}return!0};function fr(a,b,c){if(t(b))gr(this,b),t(c)||(c=a[b]);else for(var d in a)if(a.hasOwnProperty(d)&&x(a[d])&&v(a[d].xmlns)){this.yd=[d].xmlns;gr(this,d);c=a[d];break}this.data=c;this.parent=a}h=fr.prototype;h.yd="http://www.w3.org/2005/Atom";function gr(a,b){var c=b.split(":");1<c.length&&(a.yd=ar(c[0])||fr.prototype.yd,b=c[1]);a.tagName=b}
h.n=function(a,b){var c;c=a;var d=b,e=c;if(t(d))"atom"!=d&&(e=d+"$"+c);else{var f=c.split(":"),e=c.replace(/:/,"$");2==f.length&&(d=f[0],c=f[1])}d=t(d)?ar(d):void 0;c=t(this.data[c])&&t(d)&&this.data[c].xmlns==d?c:e;return u(this.data[c])?new fr(this.data,c,this.data[c][0]):x(this.data[c])?new fr(this.data,c,this.data[c]):null};h.toString=function(){return"JsonElement:"+this.tagName};h.getName=function(){return this.tagName};
function hr(a,b){for(var c in a.data)a.data.hasOwnProperty(c)&&x(a.data[c])&&delete a.data[c];a.data.$t=b}h.getAttribute=function(a){a=a.replace(/:/,"$");return this.data[a]};h.setAttribute=function(a,b){a=a.replace(/:/,"$");this.data[a]=b};h.removeAttribute=function(a){a=a.replace(/:/,"$");delete this.data[a]};function cr(a){var b=[],c;for(c in a.data)a.data.hasOwnProperty(c)&&v(a.data[c])&&"$t"!=c&&b.push(c);return b}
function er(a,b){t(void 0)?b="undefined$"+b:t(b)&&(b=b.replace(/:/,"$"));var c=[];if(t(b)){var d=a.data[b];if(u(d))for(var e=0;e<d.length;e++)c.push(new fr(a.data,b,d[e]));else x(d)&&c.push(new fr(a.data,b,d))}else for(d in a.data)if(u(a.data[d]))for(e=0;e<a.data[d].length;e++)c.push(new fr(a.data,d,a.data[d][e]));else x(a.data[d])&&c.push(new fr(a.data,d,a.data[d]));return c}function dr(a){var b=[],c;for(c in a.data)x(a.data[c])&&b.push(c.replace("$",":"));return b}
h.appendChild=function(a){var b=a.getName();this.data[b]?(u(this.data[b])||(this.data[b]=[this.data[b]]),this.data[b].push(bn(a.data))):this.data[b]=bn(a.data)};h.removeChild=function(a){if(a.parent!=this.data)throw Error("NOT_FOUND_ERR: JSON:DOM Exception 8: "+a+" not in "+this);var b=a.getName();u(this.data[b])?Eb(this.data[b],a.data):delete this.data[b]};
h.update=function(a,b,c,d,e){var f=!1;c=c||{};var g=t(b),k=!0===b||!g,l=!1===b,m=cr(this),n=cr(a);if(!g)for(var p=0;p<m.length;p++)t(e)&&!e[m[p].replace("$",":")]||Cb(n,m[p])||(this.removeAttribute(m[p]),f=!0);for(p=0;p<n.length;p++){var r=a.getAttribute(n[p]);if(!t(e)||e[n[p].replace("$",":")])Cb(m,n[p])?l||r==this.getAttribute(n[p])||(this.setAttribute(n[p],r),f=!0):(this.setAttribute(n[p],r),f=!0)}if(0==ir(a)&&k&&(e=this.data.$t,l=a.data.$t,t(l)&&e!=l))return hr(this,l),!0;if(!g)for(var s in this.data)d&&
!d[s.replace("$",":")]||!x(this.data[s])||x(a.data[s])||(delete this.data[s],f=!0);s=dr(a);for(e=0;e<s.length;e++)if(l=s[e],!d||!0==d[l]){var w=er(a,l),m=er(this,l),y=l.replace(":","$");if(1==w.length)0==m.length?(this.data[y]=bn(w[0].data),f=!0):1==m.length?c[l]?k&&!br(m[0],w[0],!0)&&(u(this.data[y])||(this.data[y]=[this.data[y]]),this.data[y].push(bn(w[0].data)),f=!0):f=m[0].update(w[0],b)||f:g?(l=Bb(m,function(a){return br(a,w[0],!0)}),-1==l&&k&&(this.data[y].push(bn(w[0].data)),f=!0)):(this.data[y]=
bn(w[0].data),f=!0);else if(!u(this.data[y]))if(k)this.data[y]=bn(a.data[y]),f=!0;else{if(g){var m=bn(a.data[y]),G=this,l=Bb(m,function(a){return Km(G.data[y],a)});-1==l&&(m.push(this.data[y]),this.data[y]=m,f=!0)}}else if(k)for(m.length>w.length&&(this.data[y].splice(w.length,m.length-w.length),f=!0),p=0;p<w.length;p++)t(m[p])?Km(m[p].data,w[p].data)||(this.data[y][p]=bn(w[p].data),f=!0):(this.data[y][p]=bn(w[p].data),f=!0);else if(g)for(p=0;p<a.data[y].length;p++)l=Bb(this.data[y],function(b){return Km(a.data[y][p],
b)}),-1==l&&(this.data[y].push(bn(a.data[y][p])),f=!0)}return f};h.If=function(a,b,c,d,e){t(b)||(b=!1);return this.update(a,b,c,d,e)};h.toJSON=function(){return{data:this.data,tagName:this.tagName}};
function jr(a){function b(a,g){d(g,a);var k,l;for(l in a)if(a.hasOwnProperty(l)&&!v(a[l]))if(v(a[l].$t)&&"xhtml"==a[l].type){k=c(l);d(k,a[l]);var m=Bi(a[l].$t);e.importNode(m.documentElement,!0);k.appendChild(m.documentElement);g.appendChild(k)}else if(v(a[l].$t))k=c(l),k.textContent=a[l].$t,d(k,a[l]),g.appendChild(k);else if(u(a[l])&&a[l][0]&&v(a[l][0].$t))for(m=0;m<a[l].length;m++)k=c(l),k.textContent=a[l][m].$t,d(k,a[l][m]),g.appendChild(k);else if(u(a[l]))for(m=0;m<a[l].length;m++)k=c(l),g.appendChild(k),
b(a[l][m],k);else x(a[l])&&(k=c(l),g.appendChild(k),b(a[l],k))}function c(a){return e.createElement(a.replace("$",":"))}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&"$t"!=c&&v(b[c])&&a.setAttribute(c.replace("$",":"),b[c])}var e=zi(a.getName(),a.yd);b(a.data,e.documentElement);return Ci(e.documentElement)}
function ir(a){function b(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(u(a[c])?b+=a[c].length:x(a[c])&&b++);return b}var c;t(void 0)?c="undefined$"+c:t(c)&&(c=c.replace(/:/,"$"));return t(c)?u(a.data[c])?a.data[c].length:x(a.data[c])?b(a.data[c]):0:b(a.data)}h.clone=function(a){var b={};if(t(a))for(var c in this.data){var d=c.replace("$",":");v(this.data[c])?b[c]=this.data[c]:!0==a[d]&&(b[c]=bn(this.data[c]))}else b=bn(this.data);return new fr(null,this.tagName,b)};
function kr(a,b){var c=b.ownerDocument.createElementNS(a.yd,a.getName()),d;for(d in a.data)if(a.data.hasOwnProperty(d)){var e=d.replace("$",":");if(v(a.data[d]))"$t"==d?c.textContent=a.data[d]:(e=c.ownerDocument.createAttribute(e),e.nodeValue=a.data[d],c.setAttributeNode(e));else if(u(a.data[d]))for(var f=0;f<a.data[d].length;f++){var g=new fr(a.data[d],e,a.data[d][f]);kr(g,c)}else x(a.data[d])&&(g=new fr(a.data,e,a.data[d]),kr(g,c))}return b.appendChild(c)};function lr(a){var b;if(t(a.id))b=a.id.$t;else if(t(a.batch$id))b=a.batch$id.$t;else if(t(a.g))b=a.g.$t;else throw new Di("id or batch:id required.");this.id=b;this.h=void 0;this.data=a}A(lr,Yq);h=lr.prototype;h.logger=L("ydn.gdata.Entry");h.$f=function(){return this.kind};h.getData=function(){return this.data};h.vd=Wq.prototype.vd;h.G=function(){return this.id};function mr(a){return a.id.match(/\w+$/)[0]}h.Ec=["link","category"];h.Rg=["id","batch$id","link","category"];h.qa=Wq.prototype.qa;
function nr(a,b){if(b)a.getData().status=""==b?void 0:b;else{var c=a.getData();c.status&&(c.status=b)}}function or(a){return t(a.gd$deleted)?"gd:deleted":(a=a.status)?a:""}function pr(a){return"gd:deleted"==or(a.getData())}h.setTitle=function(){throw new Fi;};
h.vg=function(){if(!qr(this.getData()))throw Error("nothing to commit");var a=new B;rr(this,function(b,c){if(aj(c))a.callback(b);else{var d=dk(c);if(v(d)&&/html/.test(ek(c,"content-type")))try{var e=(new DOMParser).parseFromString(d,"text/html");e.body&&(d=e.body.innerHTML)}catch(f){}a.F(c.Q()+" "+c.Qa()+" "+d)}},this);return a};
function rr(a,b,c){var d=Vi("gse");if(qr(a.getData())){var e={"Content-Type":"application/atom+xml"};a.g&&(e["GData-Version"]=a.g);var f={},g="POST",k,l,m;m="full";t(l)||(l="base"!=m);var n=a.kind||"contact";k=k?"/"+k:"";k=(l?"https":"http")+"://www.google.com/m8/feeds/"+n+"s/"+a.user_id.replace("@","%40")+"/"+m+k;k=k.replace("%40","@");if(l=(l=a.Be("edit"))?l.href:void 0)g="delete"==or(a.getData())?"DELETE":"PUT",k=l;try{var p=sr(a)}catch(r){Sj({"class":"ydn.gdata.Entry",method:"ydn.gdata.Entry.commit",
"entry.data":a.getData(),context:"toXmlString",error:{name:r.name,message:r.message,stack:r.stack}})}l=a.type;m=["atom","app","gd","batch","ydn"];if("sites"==l||"site"==l||"content"==l||"webpage"==l)m=m.concat("xhtml","sites");else if("m8"==l||"contact"==l)m=m.concat("gContact");p=$q(p,m);lr.g&&(a.h=[k,f,g,e,p]);d.request(new Xi(k,g,f,e,p)).execute(b,c)}else J(a.logger,a+" commit ignore since not modified."),b&&b.call(c,null,null)}
function qr(a){if(null==a.id)return!0;a=or(a);return"modified"===a||"delete"===a}h.cf=function(){return this.data};function sr(a){var b=new fr(null,"entry",a.cf()),c=!1;b.xmlns||(b.xmlns="http://www.w3.org/2005/Atom",c=!0);var d=["atom"],e;for(e in a.data)if(a=e.match(/^(\w+)\$\w+/))a=a[1],a in Zq&&(Cb(d,a)||d.push(a));e=jr(b);c&&delete b.xmlns;return $q(e,d)}
h.update=function(a){var b=["batch$status","batch$operation","status"],c;for(c in a.data)a.data.hasOwnProperty(c)&&x(a.data[c])&&!Cb(b,c)&&!Cb(this.Rg,c)&&(this.data[c]=a.data[c])};h.Jf=function(a,b){if(Km(this.data[a],b))return!1;this.data[a]=bn(b);return!0};
h.If=function(a){if(a.data.updated.$t>=this.data.updated.$t&&pr(a)){if(pr(this)||"delete"==or(this.getData()))return!1;nr(this,"delete");return!0}var b=!1,c;for(c in a.data)a.data.hasOwnProperty(c)&&x(a.data[c])&&!Cb(this.Rg,c)&&this.Jf(c,a.data[c])&&(b=!0);b&&(a=or(this.getData()),"delete"==a?H(this.logger,this+" marked for deletion. Cannot mark modify flag."):"committed"==a?this.logger.log(Vd,this+" already committed. All changes must wait until updated from the server.",void 0):nr(this,"modified"));
return b};function tr(a,b,c){Eq.call(this,a,b,c)}A(tr,Eq);tr.prototype.He=function(){return this.key};tr.prototype.xc=function(a,b,c,d){a=tr.m.xc.call(this,a,b,c,d);this.g.qh(a.method)&&q.gapi&&q.gapi.auth&&(b=gapi.auth.getToken())&&b.access_token&&(a.headers.Authorization=b.token_type+" "+b.access_token);if("GET"==a.method)a.params.alt="json";else if("PUT"==a.method||"POST"==a.method)d=new lr(d),a.body=sr(d),a.headers["Content-Type"]="application/atom+xml";return a};
tr.prototype.df=function(a,b){a=tr.m.df.call(this,a,b);a.feed&&(a=a.feed);a.entry&&(a=a.entry);return a};function ur(a,b,c){Mq.call(this,a,b,c);a=c.Options;this.kind=a.kind;this.version=a.version;this.projection=a.projection;this.i=a.maxResults}A(ur,Vq);h=ur.prototype;h.projection=null;h.version=null;h.logger=L("ydn.db.sync.GData");h.Aa=function(a,b){return new tr(this,a,b)};h.Hb=function(){var a=ur.m.Hb.call(this);a.key=["id","$t"];a.etag="gd$etag";a.updated=["updated","$t"];return a};h.Ib=function(){var a=ur.m.Ib.call(this);return a=a.concat(["version","projection","kind","maxResults"])};
h.Rb=function(){return"https://www.googleapis.com/"+this.kind+"/"};h.qh=function(){return!1};h.G=function(a){return a?a.id?a.id.$t:"":""};
function vr(a,b,c){var d=c||a.Rb();c&&O(a.logger,"continuing "+c);b=new Xi(d,"GET",b);var e=new B;a.xa().request(b).execute(function(b,d){if(200==d.Q()){if(!b){var k=dk(d);v(k)&&(b=JSON.parse(k))}var k=b.feed||b,l=k.entry,l=l?u(l)?l:[l]:[];0<l.length&&Hq(a,l);for(var l=null,k=k.link,k=u(k)?k:[k],m=0;m<k.length;m++)"next"==k[m].rel&&(l=k[m].href);l?Vb(vr(a,{},l),e):(O(a.logger,"prefetch "+a.V+" done"),e.callback(!!c))}else 302==d.Q()?e.callback():(k=a+": Invalid response status "+d.Q()+" on prefetching",
N(a.logger,k),e.F(Error(k)))});return e}h.lc=function(){O(this.logger,"starting prefetch");var a=new B;rm(this.storage.g,this.V,"updated.$t",null,!0,1).w(function(b){var c={alt:"json",kind:this.kind};this.i&&(c["max-results"]=this.i);(b=b[0])?(b=Nc(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b,O(this.logger,this.V+" fetching entries later then "+b)):O(this.logger,this.V+" fetching entries from beginning");Vb(vr(this,c),a)},this);return a};
h.count=function(a){var b=Uk(this.store,"updated.$t");if(!b)return a;var c=jl(a);a.A(function(a){pe(c,a);rm(this.storage.g,this.V,b.getName(),null,!1,1).A(function(b){var f={alt:"json"};if(b=u(b)?b[0]:b)b=Nc(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),f["updated-min"]=b;var g=this,f=new Xi(this.Rb(),"GET",f);this.xa().request(f).execute(function(b,e){if(200==e.Q()){if(!b){var f=dk(e);v(f)&&(b=JSON.parse(f))}f=Nc(b.feed,"openSearch$totalResults");c.callback(a+parseFloat(f||0))}else N(g.logger,
g+":Unexpected respond status "+e.Q())})},function(a){c.F(a)},this)},function(a){c.F(a)},this);return c};function wr(a,b,c){Eq.call(this,a,b,c)}A(wr,tr);function xr(a,b,c){ur.call(this,a,b,c);this.h=this.h.substr(27);this.ec=c.Options.prefix}A(xr,ur);xr.prototype.xa=function(){this.g||(this.g=new yr(gapi.client));return this.g};xr.prototype.Aa=function(a,b){return new wr(this,a,b)};xr.prototype.Rb=function(){return this.h+this.ec};
xr.prototype.lc=function(){O(this.logger,"starting prefetch");var a=new B;rm(this.storage.g,this.V,"updated",null,!0,1).A(function(b){var c={alt:"json"};if(b=b[0])b=Nc(b,"updated"),b=(new Date(1+ +new Date(b))).toISOString(),c.updatedMin=b;var d=this,c=new Xi(this.Rb(),"GET",c);d.xa().request(c).execute(function(b,c){if(b){var g=b.items||[];0<g.length?Hq(d,g).fa(function(){a.callback(!0)}):a.callback(!1)}else 302==c.Q()?a.callback():(g=d+": Invalid response status "+c.Q()+" on prefetching",N(d.logger,
g),a.F(Error(g)))})},function(b){a.F(b)},this);return a};function zr(a,b){if(!t(q.AWS))throw new xd("AWS JS SDK not loaded");this.h=a;this.region=b;this.g=null}zr.prototype.request=function(a){return new Ar(this,a)};function Br(a){var b={params:{Bucket:a.h,region:a.region}};if(!a.h)throw new F("bucket name required");a.g||(a.g=new AWS.S3(b));return a.g}function Ar(a,b){this.parent=a;this.g=b}
function Cr(a,b,c,d,e){var f=NaN,g="",k={};a=Br(a.parent)[b](c);a.on("complete",function(a){a.httpResponse&&(f=a.httpResponse.statusCode,v(f)&&(f=parseInt(f,10)),k=a.httpResponse.headers);a.error&&(g=a.error.message,f||(f=400))});a.send(function(a,b){var c=new bk(f,b,k,g);a?d.call(e,null,c):d.call(e,b,c)})}
Ar.prototype.execute=function(a,b){var c=Pe(new Be(this.g.path)),c="/"==c.charAt(0)?c.substr(1):c,d=this.g.headers||{};c&&(d.Key=c);if(c)if("GET"==this.g.method)Cr(this,"getObject",d,a,b);else if("PUT"==this.g.method)Cr(this,"putObject",d,a,b);else throw new vd("HTTP method "+this.g.method);};function Dr(a,b){this.g=a;this.prefix=Er(this,"Prefix")[0];this.h=b.type}Dr.prototype.ga=function(){return this.g.documentElement.getElementsByTagName("Contents").length};Dr.prototype.keys=function(){var a=Er(this,"Key");if(this.prefix){var b=this.prefix.length,a=a.map(function(a){return a.substr(b)});"INTEGER"==this.h?a=a.map(function(a){return parseInt(a,10)}):"NUMERIC"==this.h&&(a=a.map(function(a){return parseFloat(a)}))}return a};
function Er(a,b){for(var c=[],d=a.g.documentElement.getElementsByTagName(b),e=d.length,f=0;f<e;f++)c[f]=d[f].textContent;return c}function Fr(a){return Er(a,"LastModified").map(function(a){return(new Date(Date.parse(a))).toGMTString()})}
function Gr(a){var b=a.g.documentElement.getElementsByTagName("NextMarker");return 1==b.length?b[0].textContent:"true"==a.g.documentElement.getElementsByTagName("IsTruncated")[0].textContent&&(a=a.g.documentElement.firstElementChild.lastElementChild)&&"Contents"==a.tagName?a.getElementsByTagName("Key")[0]:null};function Hr(a,b,c){Mq.call(this,a,b,c);this.i=c.Options.bucket;if(!v(this.i)||za(this.i))throw new F("bucket name required.");this.h||(this.h="https://"+this.i+".s3.amazonaws.com/");if(!0===b.autoIncrement)throw new F('S3 object store "'+b.getName()+'" must not set autoIncrement to true.');}A(Hr,Mq);h=Hr.prototype;h.logger=L("ydn.db.sync.S3");h.Ib=function(){var a=Hr.m.Ib.call(this);return a=a.concat(["bucket","maxKeys","prefix","delimiter"])};h.xa=function(){this.g||(this.g=new zr(this.i));return this.g};
h.zf=function(a){return this.h+this.j+a};h.Aa=function(a,b){return new Xq(this,a,b)};
h.Gf=function(a,b){var c=this;ml(a,function(d,e,f){pe(a,d);c.ne(d,function(a){var e={},l=a[0]?zq(a[0]):null;null!=l&&(e.marker=l);0<c.j.length&&(e.prefix=c.j);0<b&&(e["max-keys"]=b);O(c.logger,c+" querying for newer entries starting from "+l);e=new Xi(c.h,"GET",e);c.xa().request(e).execute(function(b,e){if(200==e.Q()){for(var k=dk(e),k=k instanceof Document?k:Bi(k),l=new Dr(k,c.store),k=l.keys(),l=Fr(l),s=[],w=[],y=[],G=0,D=0;G<=a.length&&D<k.length;){var I=a[G]?zq(a[G]):null,S=k[D];if(G==a.length)w.push(S),
D++;else{var ua=I?zk(I,S):-1;0==ua?((S=Aq(a[G]))&&l[D]&&S!=l[D]&&(l[D]>S?y.push(I):N(c.logger,'record "'+I+'" in database is more recent than server '+S+" vs "+l[D])),G++,D++):1==ua?(s.push(I),G++):(w.push(S),D++)}}Rq(c,f,d,w,y,s)}else N(c.logger,"Invalid response status "+e.Q())})})},this)};
function Ir(a,b){function c(f){null!=f&&(d.marker=f);O(a.logger,a+" querying for newer entries starting from "+f);e.request(new Xi(a.h,"GET",d)).execute(function(d,e){if(200==e.Q()){var f=dk(e),f=f instanceof Document?f:Bi(f),f=new Dr(f,a.store),m=Gr(f),f=f.keys(),n=f.length;if(0==n)b([]),b=null;else for(var p=0,r=0;r<n;r++)a.Aa(f[r]).Ac(function(){p++;p==n&&(m?c(m):b&&(b([this.Kb()]),b=null))})}else N(a.logger,"Invalid response status "+e.Q())})}var d={};0<a.j.length&&(d.prefix=a.j);var e=a.xa();
c();a.M=!0}function Jr(a,b){a.M||ml(b,function(a,b,e){t(a[0])?e(a):Ir(this,e)},a)};function Kr(a,b,c){Eq.call(this,a,b,c)}A(Kr,Xq);Kr.prototype.logger=L("ydn.db.sync.entry.Gcs");function Lr(a,b,c){Hr.call(this,a,b,c);this.h="https://"+this.i+".storage.googleapis.com/"}A(Lr,Hr);Lr.prototype.logger=L("ydn.db.sync.Gcs");Lr.prototype.xa=function(){this.g||(this.g=new up);return this.g};Lr.prototype.Aa=function(a,b){return new Kr(this,a,b)};function yr(a,b){this.h=a;this.g=!!b}yr.prototype.request=function(a){var b={path:a.path,method:a.method,headers:a.headers,params:a.params,body:a.body};this.g&&(b.callback=function(a,e){c.callback(a,e);b.callback=null});a=this.h.request(b);var c=new Mr(a);return c};function Mr(a){this.h=a||null}Mr.prototype.callback=function(a,b){this.i&&(this.i(a,gk(b)),this.i=null);this.g={json:a,raw:b}};
Mr.prototype.execute=function(a){this.h?(this.h.execute(function(b,c){a(b,gk(c))}),this.h=null):this.g?(a(this.g.json,gk(this.g.raw)),this.g=null):this.i=a};function Nq(a){if(a){if(a instanceof up)return a;if(ia(a))return new yr({request:function(b){a(b)}},!0);if("request"in a)return new yr(a);throw new F(a+" is not a valid HTTP Client");}return null};function Nr(a,b,c){Eq.call(this,a,b,c)}A(Nr,Kr);Nr.prototype.logger=L("ydn.db.sync.entry.GcsJson");Nr.prototype.Ac=function(a){var b=this.g,c=this;Iq(this,function(d){var e={method:"GET",path:"storage/v1beta2/b/"+b.i+"/o/"+encodeURIComponent(c.getName())};d&&(e.headers=Cq(d));gapi.client.request(e).execute(function(d,e){var k=gk(e);c.j=new Dq(c.G(),k.bd(),b.o);d?(O(c.logger,c+": readServer updated"),c.i=d):(O(c.logger,c+": readServer request fail "+e),c.j=null,c.i=null);a.call(c,200)},e)})};function Or(a,b,c){Lr.call(this,a,b,c)}A(Or,Lr);h=Or.prototype;h.logger=L("ydn.db.sync.GcsJson");h.Hb=function(){var a=Or.m.Hb.call(this);a.key="name";return a};h.xa=function(){if(!this.g)if(t(q.gapi))this.g=new yr(gapi.client);else throw new xd("gapi not loaded");return Or.m.xa.call(this)};h.Aa=function(a,b){return new Nr(this,a,b)};
h.lc=function(){P(this.logger,"starting prefetch");var a=new B;tm(this.storage.g,this.V,null,null,1,0,!0,!1).A(function(b){var c={bucket:this.i};(b=b[0])&&(c.marker=b);var d=this;if(!q.gapi||q.gapi.client)throw Error("gapi lib not loaded");gapi.client.load("storage","v1beta2",function(){var b=gapi.client.storage.objects.list({bucket:d.i});this.ec&&(c.prefix=this.ec);b.execute(function(b,c){if(b&&!b.error){var e=b.items||[];0<e.length?Hq(d,null,e).fa(function(){a.callback(!0)}):a.callback(!1)}else e=
d+": "+c,N(d.logger,e),a.F(Error(e))})})},function(b){a.F(b)},this);return a};function Pr(a,b,c){Lr.call(this,a,b,c);this.D="full"}A(Pr,Lr);h=Pr.prototype;h.logger=L("ydn.db.sync.GcsMeta");h.Hb=function(){var a=Pr.m.Hb.call(this);a.key="name";return a};h.xa=function(){!this.g&&gapi&&(this.g=new yr(gapi.client));return Pr.m.xa.call(this)};h.Aa=function(a,b){return new Nr(this,a,b)};
h.lc=function(){P(this.logger,"starting prefetch");var a=new B;if(!q.gapi||!q.gapi.client)throw Error("gapi lib not loaded");var b=this;gapi.client.load("storage","v1beta2",function(){function c(e){e&&(d.pageToken=e);gapi.client.storage.objects.list(d).execute(function(e,g){if(e&&!e.error){var k=e.items||[];if(e.nextPageToken)O(b.logger,"receiving "+k.length+" meta records, continuing next"),Hq(b,k),c(e.nextPageToken);else if(0<k.length)Hq(b,k).fa(function(){O(b.logger,"receiving "+k.length+" meta records, prefetching dane.");
a.callback(!0)});else{var l=!!d.pageToken;O(b.logger,"prefetching done");a.callback(l)}}else l=b+": "+g,N(b.logger,l),a.F(Error(l))})}var d={bucket:b.i};this.ec&&(d.prefix=this.ec);c()});return a};h.ne=function(a,b){if(0==a.length)b([]);else{var c=this.K(),d=xb(a,function(a){return new Al(c,a)});Qq(this,d).A(function(d){for(var f=[],g=0;g<a.length;g++)f[g]=new yq(a[g],d[g],this.o,c);b(f)},function(a){N(this.logger,this+" error loading meta data "+a);b([])},this)}};function Qr(a,b,c){Mq.call(this,a,b,c)}A(Qr,Mq);Qr.prototype.zf=function(a){return this.h+this.j+this.V+this.aa+a};Qr.prototype.logger=L("ydn.db.sync.Json");
Qr.prototype.Gf=function(a){function b(a,b){var c=new Xi(e);d.xa().request(c).execute(function(c){if(200==c.status){var e=(c.response instanceof Object?c.response:wi(c.responseText)).items;c=xb(e,function(a){return a.id});for(var e=xb(e,function(a){return a.updated}),k=[],p=[],r=[],s=0,w=0;s<=a.length&&w<c.length;){var y=zq(a[s]),G=c[w];if(s==a.length)p.push(G),w++;else{var D=zk(y,G);0==D?((G=Aq(a[s]))&&e[w]&&G!=e[w]&&(new Date(e[w])>G?r.push(y):N(d.logger,'record "'+y+'" in database is more recent than server '+
G+" vs "+e[w])),s++,w++):1==D?(k.push(y),s++):(p.push(G),w++)}}Rq(d,function(){},b,p,r,k)}else N(d.logger,"Invalid response status "+c.status)})}var c=new oe,d=this,e=this.h+this.j+this.V;a.w(function(a){pe(c,a);this.ne(a,function(c){b(c,a)})},this)};function Rr(a,b,c){Mq.call(this,a,b,c)}A(Rr,Vq);function Sr(a,b,c){Eq.call(this,a,b,c)}A(Sr,Xq);Sr.prototype.logger=L("ydn.db.sync.entry.S3Meta");function Tr(a,b,c){Hr.call(this,a,b,c);this.ec=c.Options.prefix;if("Key"!=b.keyPath)throw new F('s3-meta store "'+b.getName()+'" must use inline key with keyPath "Key"');this.D="meta"}A(Tr,Hr);h=Tr.prototype;h.logger=L("ydn.db.sync.S3Meta");h.Hb=function(){var a=Tr.m.Hb.call(this);a.key="Key";a.modified="LastModified";a.etag="ETag";return a};h.Aa=function(a,b){return new Sr(this,a,b)};
h.lc=function(){function a(f){f&&(e.marker=f);c.listObjects(e).send(function(c,f){if(c){var l=d+": "+xi(c);N(d.logger,l);b.F(c instanceof Error?c:Error(l))}else{var m=f.Contents||[];f.IsTruncated?(O(d.logger,"receiving "+m.length+" meta records, continuing next"),Hq(d,m),a(m[m.length-1].Key+"\uffff")):0<m.length?Hq(d,m).fa(function(){O(d.logger,"receiving "+m.length+" meta records, prefetching dane.");b.callback(!0)}):(l=!!e.marker,O(d.logger,"prefetching done"),b.callback(l))}})}P(this.logger,"starting prefetch");
var b=new B,c=Br(this.xa()),d=this,e={};this.ec&&(e.prefix=this.ec);a();return b};h.ne=function(){throw new xd("loading meta data should not be necessary");};function Ur(a,b,c){Eq.call(this,a,b,c)}A(Ur,tr);function Vr(a,b,c){ur.call(this,a,b,c);a=c.Options;this.domain=a.domain;this.M=a.siteName;if(a=Vk(b,"sites$parent"))Lm(a,function(a){for(var b=a.link||[],c=0;c<b.length;c++)if("http://schemas.google.com/sites/2008#parent"==b[c].rel)return b[c].href;return a.id.$t.replace(/\w+$/,"0")}),ne(this.logger,"index sites$parent in "+b.getName()+" has set a generator.");if(a=Vk(b,"alternate"))Lm(a,function(a){a=a.link||[];for(var b=0;b<a.length;b++)if("alternate"==a[b].rel)return a[b].href}),ne(this.logger,
"index alternate in "+b.getName()+" has set a generator.")}A(Vr,ur);h=Vr.prototype;h.Aa=function(a,b){return new Ur(this,a,b)};h.Ib=function(){var a=Vr.m.Ib.call(this);return a=a.concat(["domain","siteName"])};h.Rb=function(){return"https://sites.google.com/feeds/content/"+this.domain+"/"+this.M+"/"};h.qh=function(a){return"GET"!=a};
function Wr(a,b,c,d){var e={alt:"json",kind:a.kind};"sites$parent"==c?(c=d.match(/\w+$/)[0],e.parent=c):"alternate"==c&&(c=d.replace(/https:\/\/sites.google.com\/a\/[^\/]+\/[^\/]+/,""),e.path=c);var f={},g=a.Rb();ml(b,function(c,l,m){pe(b,c);if(l=c[0])l=Nc(l,"updated","$t"),l=(new Date(1+ +new Date(l))).toISOString(),e["updated-min"]=l;l=new Xi(g,"GET",e,f);a.xa().request(l).execute(function(b,e){if(200==e.Q()){if(!b){var f=dk(e);v(f)&&(b=JSON.parse(f))}var g=(f=(b.feed||b).entry)?u(f)?f:[f]:[];0<
g.length?Hq(a,g).fa(function(){m(g)}):m(c)}else 302==e.Q()?m(c):(f=a+": Invalid response status "+e.Q()+" for querying pageName: "+d,N(a.logger,f),m(Error(f),!0))})},a)}h.bf=function(a,b,c){if(Tq(this))ml(a,function(d,e,f){pe(a,d);Uq(this,function(a){!0===a?rm(this.storage.g,this.V,b,R.only(c),!1,0).A(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(a){f(a,!0)},this)},this);else return"alternate"==b||"alternate"==b?Wr(this,a,b,c):Vr.m.bf.call(this,a,b,c)};Sl.prototype.g=null;
rn.prototype.mg=function(a,b){var c=b.format;if("gdata-sites"==c)a.g=new Vr(this,a,b);else if("gdata"==c)a.g=new ur(this,a,b);else if("gdata-json"==c)a.g=new xr(this,a,b);else if("odata"==c)a.g=new Rr(this,a,b);else if("s3"==c)a.g=new Hr(this,a,b);else if("s3-meta"==c)a.g=new Tr(this,a,b);else if("gcs"==c)a.g=new Lr(this,a,b);else if("gcs-json"==c)a.g=new Or(this,a,b);else if("gcs-meta"==c)a.g=new Pr(this,a,b);else if("atom"==c)a.g=new Vq(this,a,b);else if("json"==c)a.g=new Qr(this,a,b);else if("rest"==
c)a.g=new Mq(this,a,b);else throw new vd("Sync format: "+c);Um(a,function(b,c){var f=b.Yd();if(!(this instanceof Ql)||this.ab)if(!window.navigator||!t(window.navigator.onLine)||window.navigator.onLine)if("add"==f)f=c[1],a.g.add(b,f);else if("count"==f)c[1]||c[2]||a.g.count(b);else if("put"==f){var f=c[1],g=c[2];a.g.put(b,f,g)}else if("rm:iter"==f)g=c[1],a.g.remove(b,g);else if("values:iter:index"==f){var f=c[1],g=c[2],k=c[3],l=c[4],m=c[5];!k&&!m&&g&&null!=g.lower&&null!=g.upper&&0==zk(g.lower,g.upper)&&
a.g.bf(b,f,g.lower)}else if("keys"==f)g=c[1],l=c[2],k=c[3],m=c[4],a.g.keys(b,null,g,l,k,m,!1);else if("keys:iter:index"==f)f=c[1],g=c[2],l=c[3],k=c[4],m=c[5],a.g.keys(b,f,g,l,k,m,c[6]);else if("values"==f)g=c[1],l=c[2],k=c[3],m=c[4],g||m?g&&g.lower&&v(g.lower)&&g.lower==g.upper||!g&&m&&1==l&&k&&Jr(a.g,b):a.g.values(b,l,k);else if(""!=f)if("get"==f)g=c[1],a.g.get(b,g);else if("values:array"==f)Sq(a.g,b,c[1]);else throw Error(f);})};var Xr="Accounts Calls Campaigns Contacts Documents Meetings Emails EmailTemplates Employees Leads Notes Opportunities Tasks Teams TeamSets Users".split(" "),Yr="Accounts Contacts EmailTemplates Leads Notes Tasks Meetings Calls Opportunities Emails".split(" "),Zr=["Accounts","Contacts","Leads"],$r=["Accounts","Contacts","Leads"],as=["Contacts","Leads"],bs=["Meetings","Calls","Tasks","Opportunities"];function cs(a){a=Xr.indexOf(a);return Xr[a]}
function ds(a,b,c){return"https://"+a+"/index.php?module="+b+"&action=DetailView&record="+c};function es(a){this.h=a||[]}es.prototype.g=function(a){return-1==this.h.indexOf(a)?a:null};function fs(){}
fs.prototype.g=function(a){var b={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},c={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};a=a.toLowerCase();var d,e,f=a;if(3>a.length)return a;var g,k;a=a.substr(0,1);"y"==a&&(f=a.toUpperCase()+f.substr(1));g=/^(.+?)(ss|i)es$/;e=/^(.+?)([^s])s$/;
g.test(f)?f=f.replace(g,"$1$2"):e.test(f)&&(f=f.replace(e,"$1$2"));g=/^(.+?)eed$/;e=/^(.+?)(ed|ing)$/;g.test(f)?(e=g.exec(f),g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(e[1])&&(g=/.$/,f=f.replace(g,""))):e.test(f)&&(e=e.exec(f),d=e[1],e=/^([^aeiou][^aeiouy]*)?[aeiouy]/,e.test(d)&&(f=d,e=/(at|bl|iz)$/,k=/([^aeiouylsz])\1$/,d=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,e.test(f)?f+="e":k.test(f)?(g=/.$/,f=f.replace(g,"")):d.test(f)&&(f+="e")));g=/^(.+?)y$/;g.test(f)&&(e=g.exec(f),
d=e[1],g=/^([^aeiou][^aeiouy]*)?[aeiouy]/,g.test(d)&&(f=d+"i"));g=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;g.test(f)&&(e=g.exec(f),d=e[1],e=e[2],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(d)&&(f=d+b[e]));g=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;g.test(f)&&(e=g.exec(f),d=e[1],e=e[2],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(d)&&(f=d+c[e]));g=
/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;e=/^(.+?)(s|t)(ion)$/;g.test(f)?(e=g.exec(f),d=e[1],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(d)&&(f=d)):e.test(f)&&(e=e.exec(f),d=e[1]+e[2],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(d)&&(f=d));g=/^(.+?)e$/;g.test(f)&&(e=g.exec(f),d=e[1],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,
e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,k=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,g.test(d)||e.test(d)&&!k.test(d))&&(f=d);g=/ll$/;e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;g.test(f)&&e.test(f)&&(g=/.$/,f=f.replace(g,""));"y"==a&&(f=a.toLowerCase()+f.substr(1));return f};function gs(a){this.h=a}
gs.prototype.g=function(a){a=a.toLowerCase();a=a.replace(/([^c])\1/g,"$1");a=function(a){return a.match(/^(kn|gn|pn|ae|wr)/)?a.substr(1,a.length-1):a}(a);a=a.replace(/mb$/,"m");a=a.replace(/ck/g,"k");a=function(a){a=a.replace(/([^s]|^)(c)(h)/g,"$1x$3").trim();a=a.replace(/cia/g,"xia");a=a.replace(/c(i|e|y)/g,"s$1");return a=a.replace(/c/g,"k")}(a);a=function(a){a=a.replace(/d(ge|gy|gi)/g,"j$1");return a=a.replace(/d/g,"t")}(a);a=function(a){a=a.replace(/gh(^$|[^aeiou])/g,"h$1");return a=a.replace(/g(n|ned)$/g,
"$1")}(a);a=function(a){a=a.replace(/([^g]|^)(g)(i|e|y)/g,"$1j$3");a=a.replace(/gg/g,"g");return a=a.replace(/g/g,"k")}(a);a=a.replace(/([aeiou])h([^aeiou])/g,"$1$2");a=a.replace(/ph/g,"f");a=a.replace(/q/g,"k");a=a.replace(/s(h|io|ia)/g,"x$1");a=function(a){a=a.replace(/^x/,"s");return a=a.replace(/x/g,"ks")}(a);a=function(a){a=a.replace(/t(ia|io)/g,"x$1");return a=a.replace(/th/,"0")}(a);a=a.replace(/tch/g,"ch");a=a.replace(/v/g,"f");a=a.replace(/^wh/,"w");a=a.replace(/w([^aeiou]|$)/g,"$1");a=a.replace(/y([^aeiou]|$)/g,
"$1");a=a.replace(/z/,"s");a=a.charAt(0)+a.substr(1,a.length).replace(/[aeiou]/g,"");a.length>=this.h&&(a=a.substring(0,this.h));return a=a.toUpperCase()};var hs=new gs(32),is=new fs,js=new es("a a's able about above according accordingly across actually after afterwards again against ain't all allow allows almost alone along already also although always am among amongst an and another any anybody anyhow anyone anything anyway anyways anywhere apart appear appreciate appropriate are aren't around as aside ask asking associated at available away awfully b be became because become becomes becoming been before beforehand behind being believe below beside besides best better between beyond both brief but by c c'mon c's came can can't cannot cant cause causes certain certainly changes clearly co com come comes concerning consequently consider considering contain containing contains corresponding could couldn't course currently d definitely described despite did didn't different do does doesn't doing don't done down downwards during e each edu eg eight either else elsewhere enough entirely especially et etc even ever every everybody everyone everything everywhere ex exactly example except f far few fifth first five followed following follows for former formerly forth four from further furthermore g get gets getting given gives go goes going gone got gotten greetings h had hadn't happens hardly has hasn't have haven't having he he's hello help hence her here here's hereafter hereby herein hereupon hers herself hi him himself his hither hopefully how howbeit however i i'd i'll i'm i've ie if ignored immediate in inasmuch inc indeed indicate indicated indicates inner insofar instead into inward is isn't it it'd it'll it's its itself j just k keep keeps kept know knows known l last lately later latter latterly least less lest let let's like liked likely little look looking looks ltd m mainly many may maybe me mean meanwhile merely might more moreover most mostly much must my myself n name namely nd near nearly necessary need needs neither never nevertheless new next nine no nobody non none noone nor normally not nothing novel now nowhere o obviously of off often oh ok okay old on once one ones only onto or other others otherwise ought our ours ourselves out outside over overall own p particular particularly per perhaps placed please plus possible presumably probably provides q que quite qv r rather rd re really reasonably regarding regardless regards relatively respectively right s said same saw say saying says second secondly see seeing seem seemed seeming seems seen self selves sensible sent serious seriously seven several shall she should shouldn't since six so some somebody somehow someone something sometime sometimes somewhat somewhere soon sorry specified specify specifying still sub such sup sure t t's take taken tell tends th than thank thanks thanx that that's thats the their theirs them themselves then thence there there's thereafter thereby therefore therein theres thereupon these they they'd they'll they're they've think third this thorough thoroughly those though three through throughout thru thus to together too took toward towards tried tries truly try trying twice two u un under unfortunately unless unlikely until unto up upon us use used useful uses using usually uucp v value various very via viz vs w want wants was wasn't way we we'd we'll we're we've welcome well went were weren't what what's whatever when whence whenever where where's whereafter whereas whereby wherein whereupon wherever whether which while whither who who's whoever whole whom whose why will willing wish with within without won't wonder would wouldn't x y yes yet you you'd you'll you're you've your yours yourself yourselves z zero".split(" "));function ks(a){this.data=a;this.g=0}ks.prototype.next=function(a){for(var b=this.g,c=this.data[b],c=1,d=0;0<=b&&b<this.data.length;){c=this.data[b];if(c instanceof Array)if(a<c[0])c=-1;else if(a>c[1])c=1;else return this.g=b,!0;else{if(c==a)return this.g=b,!0;c=a<c?-1:1}if(0==d)d=c;else if(d!=c)break;b+=c;if(b>this.data.length||0>b)break}return!1};
function ls(a,b){for(var c=0,d=0,e=a.length,f=0;f<e;++f){a:{var d=a.charCodeAt(f),g=new ks(categ_letters_numbers_data);if(ha(d))d=g.next(d);else{for(var k=0,l=d.length;k<l;++k)if(!1===g.next(d[k])){d=!1;break a}d=!0}}d||((d=f-c)&&b(c,d),c=f+1)}(d=e-c)&&b(c,d)};function ms(a,b){this.j=b;this.value=a}ms.prototype.U=function(){return this.value};ms.prototype.Jb=function(){return 1};var ns=Si||Pi;ms.prototype.G=function(){return this.value};ms.prototype.toString=function(){return"Entry:"+this.value};function os(a,b,c,d,e,f){ms.call(this,d,e);this.V=a;this.h=b;this.i=c;this.oe=f||[]}A(os,ms);h=os.prototype;h.td=function(){return{k:this.j,v:this.value.toLowerCase(),id:this.G(),loc:this.oe}};h.G=function(){var a=[this.V,this.i,this.h,this.value];return ns?a:Ek(a)};h.K=function(){return this.V};h.ja=function(){return this.i};h.toString=function(){return["IndexEntry",this.V,this.i,this.value].join(":")};function ps(a,b,c,d,e){ms.call(this,b,c);this.l=d;this.g=e;this.type=a;this.qg=1}A(ps,ms);ps.prototype.Jb=function(){return this.g*this.type*this.qg};ps.prototype.G=function(){return this.value+"|"+this.l};function qs(a,b){os.call(this,b.K(),b.h,b.ja(),b.U(),b.j,[]);this.o=a;this.g=[b]}A(qs,os);h=qs.prototype;h.count=function(){return this.g.length};h.entry=function(a){return this.g[a]};h.If=function(a){a=a.g[0];for(var b=0;b<this.g.length;b++)if(this.g[b].h==a.h&&this.g[b].value==a.value)return;this.g.push(a)};h.Jb=function(){for(var a=0,b=0;b<this.g.length;b++)var c=this.g[b],d=Xm(this.o,c.K(),c.h),c=c.Jb(),a=a+c*d.h;return a};function Pb(a,b){var c=a.Jb(),d=b.Jb();return c<=d?1:-1}
h.td=function(){for(var a={value:this.value,primaryKey:this.i,storeName:this.V,score:this.Jb(),tokens:[]},b=0;b<this.g.length;b++)a.tokens[b]=this.g[b].td();return a};h.toString=function(){return["RankEntry",this.V,this.i,this.value].join(":")+"["+this.g.length+"]"};function rs(a){var b=[],c;a=a.split(/\s+/);for(var d=0;d<a.length;d++){c=a[d];for(var e=c.length-1,f=Array(e),g=0;g<e;g++)f[g]=c.substring(g,g+2);c=f;b.push.apply(b,c)}return b};function km(a,b,c,d,e,f,g){os.call(this,b,c,d,e,f,g);this.query=a}A(km,os);km.prototype.Jb=function(){var a,b=this.value;a=rs(this.query.value.toLowerCase().replace(/^\s+|\s+$/g,""));var b=rs(b.toLowerCase().replace(/^\s+|\s+$/g,"")),c=0,d=a.length+b.length,e,f,g,k;for(e=0;e<a.length;e++)for(g=a[e],f=0;f<b.length;f++)if(k=b[f],g==k){c++;delete b[f];break}a=2*c/d;b=Math.log(this.oe.length+1);c=this.query.Jb();return b*a*c};km.prototype.td=function(){return{keyPath:this.h,value:this.value,loc:this.oe.slice()}};
km.prototype.toString=function(){return["ResultEntry",this.V,this.i,this.value].join(":")};function ss(a,b,c){this.g=a;this.h=b;this.j=[];this.limit=c||1E3;this.i=0}function jm(a,b){for(var c,d,e=a.g.getName(),f=0;f<a.h.length;f++){var g=a.h[f],k=g.type;.4==k||.6==k?(d="v",c=g.U().toLowerCase(),c=tk(c)):(d="v",c=g.U().toLowerCase(),c=R.only(c));b(e,d,c,g);a.i++;.6==k&&(d="k",c=g.j,c=R.only(c),b(e,d,c,g),a.i++)}}function im(a){for(var b=[a.g.getName()],c=0;c<a.g.count();c++){var d=a.g.index(c).K();-1==b.indexOf(d)&&b.push(d)}return b}
function lm(a){for(var b=[],c=[],d=0;d<a.j.length;d++){var e=a.j[d];if(0==e.query.type)-1==Bb(c,function(a){return a.ja()==e.ja()&&a.K()==e.K()})&&c.push(e);else{var f=new qs(a.g,e),g=Bb(b,function(a){return a.ja()==f.ja()&&a.K()==f.K()});if(0<=g){var k=b[g];sb.splice.call(b,g,1);k.If(f);f=k}Ob(b,f)}}for(a=0;a<c.length;a++)for(g=c[a],d=b.length-1;0<=d;--d)if(k=b[d],g.ja()==k.ja()&&g.K()==k.K()){b.splice(a,1);break}return b.map(function(a){return a.td()})};function ts(a){this.g=a;if("en"==a.lang){a=a.h||["stop","stemmer","metaphone"];for(var b=[],c=0;c<a.length;c++)if("metaphone"==a[c])b.push(hs);else if("stemmer"==a[c])b.push(is);else if("stop"==a[c])b.push(js);else throw Error('Invalid normalizer "'+a[c]+'" for English lang');a=b}else a=[];this.h=a}function us(a,b){for(var c=0;c<a.h.length;c++){var d=a.h[c].g(b);if(d)b=d;else return null}return b}ts.prototype.parse=function(a){var b=[];ls(a,function(c,d){b.push(a.substr(c,d))});return b};
ts.prototype.query=function(a,b,c){a=vs(this,b);return 0==a.length?null:new ss(this.g,a,c||10)};
function vs(a,b){var c=[],d=[];ls(b,function(a,e){c.push(b.substr(a,e));d.push(a)});for(var e=[],f=0;f<c.length;f++)e[f]=us(a,c[f]);for(var g=[],k=0,f=0;f<c.length;f++){var l=c[f],m=e[f],n="*"==b.charAt(d[f]+l.length),p=n?d[f]+l.length+1:d[f]+l.length,p='"'==b.charAt(d[f]-1)&&'"'==b.charAt(p),r="-"==b.charAt(p?d[f]-2:d[f]-1),s=.8;n?s=.4:p?s=1:r?s=0:null!=m&&(s=.6);l=new ps(s,l,m,d[f],1/(f+2));g.push(l);k+=l.Jb()}for(f=0;f<g.length;++f)g[f].qg=1/k;return g}
function ws(a,b,c,d){var e=[],f=[];ls(b,function(a,c){e.push(b.substr(a,c));f.push(a)});for(var g=[],k=0;k<e.length;k++)g[k]=us(a,e[k]);a=c.K();c=c.g;for(var l=[],k=0;k<e.length;k++){var m=e[k],n=g[k];if(null!=n){var p=Ab(l,function(a){return a.U()==m});p||(p=new os(a,c,d,m,n),l.push(p));p.oe.push(f[k])}}return l}function xs(a,b,c,d){for(var e=[],f=0;f<a.g.count();f++){var g=a.g.index(f);if(g.K()==b){var k=Bk(d,g.g);v(k)&&(e=e.concat(ws(a,k,g,c)))}}return e};rn.prototype.lg=function(a,b){var c=this;b.g=new ts(b);Um(a,function(d,e){function f(e){var f=a.getName();Cl(e)&&ml(d,function(a,g,k){if(g)k(a,g);else{pe(d,a);var l=rk(R.bound([f,e],[f,e,"\uffff"])),y=b.getName();qm(c.g,y,l).fa(function(){k(a,g)})}})}function g(b){var e=a.getName();ml(d,function(a,f,g){f?g(a,f):(pe(d,a),b&&(b=rk(R.bound([e,b.lower],[e,b.upper,"\uffff"]))),qm(c.g,e,b).fa(function(){g(a,f)}))})}function k(e,f){var g=a.getName();ml(d,function(a,k,l){pe(d,a);if(k)l(a,k);else{var y=b.getName();
u(a)||(a=[a]);for(var G=0;G<a.length;G++){var D=a[G];if(Cl(D)){if(f){var I=rk(R.bound([g,D],[g,D,"\uffff"]));qm(c.g,y,I)}D=xs(b.g,g,D,e[G]).map(function(a){return a.td()});D=om(c.g,y,D);G==a.length-1&&D.fa(function(){l(a,k)})}}}})}var l=d.Yd();"put"==l?k([e[1]],!0):"put:array"==l?k(e[1],!0):"add"==l?k([e[1]],!1):"add:array"==l?k(e[1],!1):"rm:iter"==l||"clear"==l?g(e[1]):"rm"==l&&f(e[1])})};
rn.prototype.search=function(a,b,c,d){var e=an(this.h,a);if(!e)throw new F('full text index catalog "'+a+'" not found.');a=e.g.query(a,b,c,d);return a?this.g.search(a):(J(this.logger,'query "'+b+'" contains only noise and search is ignored'),ol("search",null))};function ys(a){this.name=a;this.info=null;this.h={};this.g=null}
var zs={Accounts:{GeneratorIndex:{ydn$emails:["email","email1","email_addresses_non_primary"],ydn$phones:["phone_office","phone_alternate","phone_fax"]}},Calls:{FullTextIndex:{name:["name","description"],content:["name","description"]},indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"assigned_user_id, date_start",keyPath:["assigned_user_id","date_start"]}]},Contacts:{FullTextIndex:{name:["name","first_name","last_name","full_name"]},GeneratorIndex:{ydn$emails:["email",
"email1","email2"],ydn$phones:["phone_home","phone_mobile","phone_work","phone_other","phone_fax"]}},Documents:{FullTextIndex:{name:["name","document_name","filename"],content:["description"]},indexes:[{name:"parent",keyPath:["doc_type","doc_id"]}]},Emails:{FullTextIndex:{name:["name"],content:["content","description"]},GeneratorIndex:{ydn$emails:["bcc_addrs","cc_addrs","from_addr","to_addrs","reply_to_addr"]},indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"message_id"}]},
Leads:{FullTextIndex:{name:["name","first_name","last_name","full_name"]},GeneratorIndex:{ydn$emails:["email","email1","email2"],ydn$phones:["phone_home","phone_mobile","phone_work","phone_other","phone_fax"]}},Meetings:{FullTextIndex:{name:["name"],content:["description"]},indexes:[{name:"date_start"},{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"assigned_user_id, date_start",keyPath:["assigned_user_id","date_start"]}]},Notes:{FullTextIndex:{name:["name"],content:["description"]},
indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]}]},Opportunities:{FullTextIndex:{name:["name"],content:["description"]},indexes:{name:"assigned_user_id, date_closed",keyPath:["assigned_user_id","date_closed"]}},Tasks:{FullTextIndex:{name:["name"],content:["description"]},indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"assigned_user_id, date_due",keyPath:["assigned_user_id","date_due"]}]}};
function As(a,b){return"ydn$emails"==b?{name:b,multiEntry:!0,generator:function(b){var d=[],e;for(e in b)if(0<=a.indexOf(e))if(v(b[e]))if(/addrs$/.test(e))for(var f=b[e].split(","),g=0;g<f.length;g++){var k=xo(f[g]);k&&d.push(k)}else(k=xo(b[e]))&&d.push(k);else if(fa(b[e])&&b[e][0]&&b[e][0].email_address)for(f=b[e],g=0;g<f.length;g++)f[g]&&v(f[g].email_address)&&(k=xo(f[g].email_address))&&d.push(k);return d}}:"ydn$phones"==b?{name:b,multiEntry:!0,generator:function(b){var d=[],e;for(e in b)if(0<=
a.indexOf(e)){var f=wo(b[e]);f&&d.push(f)}return d}}:null}function Bs(a,b){if(a.g)for(var c=0;c<a.g.stores.length;c++)if(a.g.stores[c].name==b)return a.g.stores[c];var c=a.h[b]||zs[b]||{},d={name:b,keyPath:c.keyPath||"id",indexes:[{name:"name"},{name:"date_modified"}]},e=["ydn$emails","ydn$phones","ydn$names"];c.indexes&&(d.indexes=d.indexes.concat(c.indexes));for(var f=c.GeneratorIndex||{},c=0;c<e.length;c++){var g=e[c],k=f[g];!k||u(k)&&0==k.length||d.indexes.push(As(k,g))}return d}
function Cs(a){if(a.g)return a.g;for(var b={fullTextCatalogs:[],stores:[{name:"history",indexes:[{keyPath:"type"},{keyPath:"timestamp"}]},{name:"Meta"}]},c=0;c<Yr.length;c++){var d=Yr[c];b.stores.push(Bs(a,d));var e=a.h[d]||zs[d]||{};if(e.FullTextIndex)for(var f in e.FullTextIndex){var g=e.FullTextIndex[f];if(0<g.length){for(var k={name:"ft-"+d+"-"+f,lang:"en",sources:[]},l=0;l<g.length;l++)k.sources.push({storeName:d,keyPath:g[l]});b.fullTextCatalogs.push(k)}}}a.g=b;Object.freeze(a.g);return a.g}
;function Ds(a,b,c){this.domain=a;this.module=b;this.g=c||null}function Es(a){return ds(a.domain,a.module,a.G())}h=Ds.prototype;h.getData=function(){return this.g};function Fs(a,b){if(b){a.g||(a.g={});for(var c in b)a.g[c]=b[c]}}h.G=function(){return this.g.id};function Gs(a){return a.g?+Hs(a.g.date_modified):NaN}function Is(a){return"assigned_user_id, "+Js(a)}function Js(a){return"Tasks"==a?"date_due":"Opportunities"==a?"date_closed":"date_start"}
function Ks(a){if(!a.g)return"";var b=a.g.full_name||a.g.name;return b?b:a.g.first_name||a.g.last_name?(b=(a.g.first_name||"").trim(),a=(a.g.last_name||"").trim(),b+" "+a):a.g.id}h.value=function(a){return this.g?this.g[a]:null};h.toJSON=function(){return{domain:this.domain,module:this.module,obj:this.g}};h.toString=function(){return"Record:"+this.module+":"+(this.g?this.g.id:void 0)};function Ls(a,b,c){var d=0;if(!b)return d;b.gd$city&&a[c+"_address_city"]!=b.gd$city.$t&&(a[c+"_address_city"]=b.gd$city.$t,d++);b.gd$country&&a[c+"_address_country"]!=b.gd$country.$t&&(a[c+"_address_country"]=b.gd$country.$t,d++);b.gd$postcode&&a[c+"_address_postalcode"]!=b.gd$postcode.$t&&(a[c+"_address_postalcode"]=b.gd$postcode.$t,d++);b.gd$region&&a[c+"_address_state"]!=b.gd$region.$t&&(a[c+"_address_state"]=b.gd$region.$t,d++);b.gd$street&&a[c+"_address_street"]!=b.gd$street.$t&&(a[c+"_address_street"]=
b.gd$street.$t,d++);b.gd$housename&&a[c+"_address_street_2"]!=b.gd$neighborhood.$t&&(a[c+"_address_street_2"]=b.gd$neighborhood.$t,d++);b.gd$neighborhood&&a[c+"_address_street_3"]!=b.gd$city.$t&&(a[c+"_address_street_3"]=b.gd$city.$t,d++);return d}
function Ms(a,b,c){function d(d,g){!a[c+g]||b[d]&&b[d].$t==a[c+g]||(e++,b[d]={$t:a[c+g]})}var e=0;if(!a)return 0;b||(b={});d("gd$city","_address_city");d("gd$country","_address_country");d("gd$postcode","_address_postalcode");d("gd$region","_address_state");d("gd$street","_address_street");d("gd$neighborhood","_address_street_2");d("gd$city","_address_street_3");return e}
function Ns(a,b){var c=0;!a.title||b.name&&b.name==a.title.$t||(b.name=a.title.$t,c++);for(var d=0;a.gd$email&&d<a.gd$email.length;d++){var e=a.gd$email[d];"http://schemas.google.com/g/2005#work"==e.rel?b.email1!=e.address&&(c++,b.email1=e.address):"http://schemas.google.com/g/2005#home"==e.rel?b.email2!=e.address&&(c++,b.email2=e.address):"http://schemas.google.com/g/2005#other"==e.rel&&b.email!=e.address&&(c++,b.email=e.address)}a.gd$name?(a.gd$name.gd$namePrefix&&b.salutation!=a.gd$name.gd$namePrefix.$t&&
(c++,b.salutation=a.gd$name.gd$namePrefix.$t),a.gd$name.gd$givenName&&b.first_name!=a.gd$name.gd$givenName.$t&&(b.first_name=a.gd$name.gd$givenName.$t,c++),a.gd$name.gd$familyName&&b.last_name!=a.gd$name.gd$familyName.$t&&(b.last_name=a.gd$name.gd$familyName.$t,c++),a.gd$name.gd$fullName&&b.full_name!=a.gd$name.gd$fullName.$t&&(b.full_name=a.gd$name.gd$fullName.$t,c++)):b.full_name=a.title.$t;a.gd$organization&&a.gd$organization[0]&&(d=a.gd$organization[0],d.gd$orgTitle&&d.gd$orgTitle.$t!=b.title&&
(b.title=d.gd$orgTitle.$t,c++),d.gd$orgDepartment&&d.gd$orgDepartment.$t!=b.department&&(b.department=d.gd$orgDepartment.$t,c++),d.gd$orgJobDescription&&d.gd$orgJobDescription.$t!=b.description&&(b.description=d.gd$orgJobDescription.$t,c++));if(a.gd$im)for(d=0;d<a.gd$im.length;d++)"Twitter"==a.gd$im[d].label&&b.twitter!=a.gd$im[d].address?(b.twitter=a.gd$im[d].address,c++):"Facebook"==a.gd$im[d].label&&b.facebook!=a.gd$im[d].address?(b.facebook=a.gd$im[d].address,c++):"Google Plus"==a.gd$im[d].label&&
b.googleplus!=a.gd$im[d].address?(b.googleplus=a.gd$im[d].address,c++):"Linkedin"==a.gd$im[d].label&&b.linkedin!=a.gd$im[d].address&&(b.linkedin=a.gd$im[d].address,c++);a.gContact$birthday&&b.birthdate!=a.gContact$birthday.when&&(b.birthdate=a.gContact$birthday.when,c++);for(d=0;a.gd$phoneNumber&&d<a.gd$phoneNumber.length;d++)if(e=a.gd$phoneNumber[d],e.$t)if("http://schemas.google.com/g/2005#mobile"==e.rel)b.phone_mobile!=e.$t&&(b.phone_mobile=e.$t,c++);else if("http://schemas.google.com/g/2005#work"==
e.rel)b.phone_work!=e.$t&&(b.phone_work=e.$t,c++);else if("http://schemas.google.com/g/2005#home"==e.rel)b.phone_home!=e.$t&&(b.phone_home=e.$t,c++);else if("http://schemas.google.com/g/2005#fax"==e.rel||"http://schemas.google.com/g/2005#home_fax"==e.rel||"http://schemas.google.com/g/2005#work_fax"==e.rel)b.phone_fax!=e.$t&&(b.phone_fax=e.$t,c++);else if(b.phone_other=e.$t)b.phone_other=e.$t,c++;if(a.gd$structuredPostalAddress){for(var f=e=-1,d=0;d<a.gd$structuredPostalAddress.length;d++){var g=a.gd$structuredPostalAddress[d];
"http://schemas.google.com/g/2005#work"==g.rel||g.primary?e=d:f=d}-1==e&&(f=-1);c+=Ls(b,a.gd$structuredPostalAddress[e],"primary");c+=Ls(b,a.gd$structuredPostalAddress[f],"alt")}return c}
function Os(a,b){function c(a,c){if(g[a]){b.gd$phoneNumber||(b.gd$phoneNumber=[]);var d;a:{for(d=0;b.gd$phoneNumber&&d<b.gd$phoneNumber.length;d++)if(b.gd$phoneNumber[d].rel==c){d=b.gd$phoneNumber[d];break a}d=null}d?d.$t!=g[a]&&(d.$t=g[a],k++):(b.gd$phoneNumber.push({rel:c,$t:g[a]}),k++)}}function d(a){b.gd$im||(b.gd$im=[]);for(var c=0;c<b.gd$im.length;c++)if(b.gd$im[c].label==a)return b.gd$im[c];return null}function e(){b.gd$name||(b.gd$name={},k++)}function f(a,c){if(g[a]){b.gd$email?fa(b.gd$email)||
(b.gd$email=[b.gd$email]):b.gd$email=[];var d;a:{d=g[a];for(var e=0;b.gd$email&&e<b.gd$email.length;e++)if(!(0<=l.indexOf(e))&&b.gd$email[e].address==d){d=e;break a}d=-1}0<=d?(e=b.gd$email[d],e.rel!=c&&(k++,e.rel=c),l.push(d)):(b.gd$email.push({rel:c,address:g[a]}),l.push(b.gd$email.length-1),k++)}}var g=a.getData(),k=0;!g.name||b.title&&b.title.$t==g.name||(b.title={$t:g.name},k++);var l=[];f("email1","http://schemas.google.com/g/2005#work");f("email2","http://schemas.google.com/g/2005#home");f("email",
"http://schemas.google.com/g/2005#other");g.salutation&&(e(),b.gd$name.gd$namePrefix&&b.gd$name.gd$namePrefix.$t==g.salutation||(b.gd$name.gd$namePrefix={$t:g.salutation},k++));g.first_name&&(e(),b.gd$name.gd$givenName&&b.gd$name.gd$givenName.$t==g.first_name||(b.gd$name.gd$givenName={$t:g.first_name},k++));g.last_name&&(e(),b.gd$name.gd$familyName&&b.gd$name.gd$familyName.$t==g.last_name||(b.gd$name.gd$familyName={$t:g.last_name},k++));g.full_name&&(e(),b.gd$name.gd$fullName&&b.gd$name.gd$fullName.$t==
g.full_name||(b.gd$name.gd$fullName={$t:g.full_name},k++));if(g.twitter){var m=d("Twitter");m?m.address!=g.twitter&&(m.address=g.twitter,k++):(b.gd$im.push({label:"Twitter",address:g.twitter}),k++)}g.facebook&&((m=d("Facebook"),m)?m.address!=g.facebook&&(m.address=g.facebook,k++):(b.gd$im.push({label:"Facebook",address:g.facebook}),k++));g.googleplus&&((m=d("Google Plus"),m)?m.address!=g.googleplus&&(m.address=g.googleplus,k++):(b.gd$im.push({label:"Google Plus",address:g.googleplus}),k++));g.linkedin&&
((m=d("Linkedin"),m)?m.address!=g.linkedin&&(m.address=g.linkedin,k++):(b.gd$im.push({label:"Linkedin",address:g.linkedin}),k++));!g.birthdate||b.gContact$birthday&&b.gContact$birthday.when==g.birthdate||(b.gContact$birthday={when:g.birthdate},k++);c("phone_mobile","http://schemas.google.com/g/2005#mobile");c("phone_work","http://schemas.google.com/g/2005#work");c("phone_home","http://schemas.google.com/g/2005#home");c("phone_fax","http://schemas.google.com/g/2005#work_fax");c("phone_other","http://schemas.google.com/g/2005#other");
for(var n=-1,m=-1,p=0;b.gd$structuredPostalAddress&&p<b.gd$structuredPostalAddress.length;p++)-1==n&&"true"==b.gd$structuredPostalAddress[p].primary||"http://schemas.google.com/g/2005#work"==b.gd$structuredPostalAddress[p].rel?n=p:-1==m&&(m=p);-1==n&&0<=m&&(n=m,b.gd$structuredPostalAddress[n].primary="true",m=-1);0<=n?k+=Ms(g,b.gd$structuredPostalAddress[n],"primary"):(n={primary:"true",rel:"http://schemas.google.com/g/2005#work"},p=Ms(g,n,"primary"),0<p&&(b.gd$structuredPostalAddress||(b.gd$structuredPostalAddress=
[]),b.gd$structuredPostalAddress.push(n),k+=p));0<=m?k+=Ms(g,b.gd$structuredPostalAddress[m],"alt"):(n={},p=Ms(g,n,"alt"),0<p&&(b.gd$structuredPostalAddress||(b.gd$structuredPostalAddress=[]),b.gd$structuredPostalAddress.push(n),k+=p));return k};function Ps(a){if(u(a))return a.map(function(a){return Ps(a)});if(x(a)){var b={},c;for(c in a.name_value_list)b[c]=a.name_value_list[c].value;return b}throw Error("Invalid name_value_entries");}function Hs(a){return new Date(a+" GMT")}function Qs(a){return a.toISOString().replace("T"," ").replace(/\..+/,"")};function Rs(a,b,c,d,e){pd.call(this);c=wa(c,"http")?new Be(c):Ce(De(new Be,c),"https");He(c,"");Ge(c,null);this.h=c.Ub;this.M=b;this.o=c.toString().replace(/\/$/,"");this.l=d;this.D=e;this.g=null;this.j=a;this.Y=new ys(this.h);this.db=new fp("su-"+this.h,Cs(this.Y),{isSerial:!0,policy:"single",mechanisms:["indexeddb"]});this.i=null;this.p=this.u=NaN;this.N=!1;this.history=new qq(this.db)}A(Rs,pp);h=Rs.prototype;
h.request=function(a,b,c,d,e,f){function g(){m.execute(function(g,k){this.u=z();var l=g;if(v(l))try{g=JSON.parse(l)}catch(m){}f||!g||11!=g.number&&10!=g.number?d.call(e,g,k):Ss(this).A(function(){this.request(a,b,c,d,e,!0)},function(){d.call(e,null,new bk(0,null,{},"Login fail"))},this)},this)}for(var k="{",l=0;l<b.length;l++)k+=(0==l?"":",")+'"'+b[l]+'":'+JSON.stringify(c[l]);k+="}";l=new Ie;l.add("method",a);l.add("input_type","json");l.add("response_type","json");l.add("rest_data",k);var m=this.j.request(new Xi(this.o+
"/service/v4/rest.php","POST",{},{"Content-Type":"application/x-www-form-urlencoded"},l.toString())),k=z()-this.u;0<k&&100>k?(this.u=100+this.u,ge(this.logger,"request will call after "+k+" ms."),Vf(g,k,this)):g.call(this)};
function Ts(a,b,c){var d=c.module_name,e=["session"];a=[a.g?a.g.id:null];var f=[!1];d&&(e.push("module_name"),a.push(d),f.push(!1));if("get_entry_list"==b)b=c.query||"",e.push("query"),a.push(b),f.push(""==b),e.push("order_by"),b=c.order_by||"",a.push(b),f.push(""==b),b=c.offset||0,e.push("offset"),a.push(b),f.push(0==b),b=c.select_fields||[],e.push("select_fields"),a.push(b),f.push(0==b.length),b=c.link_name_to_fields_array||[],e.push("link_name_to_fields_array"),a.push(b),f.push(0==b.length),b=
c.max_results||25,e.push("max_results"),a.push(b),f.push(null!=c.max_results),b=c.deleted||0,e.push("deleted"),a.push(b),f.push(0==b),c=!!c.favorites,e.push("favorites"),a.push(c),f.push(!1==c);else if("get_available_modules"==b)c=c.filter||"",e.push("filter"),a.push(c),f.push(0==c.length);else if("get_module_fields"==b)c=c.fields||[],e.push("fields"),a.push(c),f.push(0==c.length);else if("get_entries"==b)b=c.ids||[],e.push("ids"),a.push(b),f.push(!1),b=c.select_fields||[],e.push("select_fields"),
a.push(b),f.push(0==b.length),b=c.link_name_to_fields_array||[],e.push("link_name_to_fields_array"),a.push(b),f.push(0==b.length);else for(var g in c)"module_name"!=g&&(e.push(g),a.push(c[g]),f.push(!1));for(c=f.length-1;0<=c;c--)if(f[c])e.pop(),a.pop();else break;return{keys:e,values:a}}
function Us(a,b){var c=b.entry_list;if(u(c)&&0<c.length){var d=c.map(function(a){return'"'+a.id+'"'});return Vs(a,"get_entry_list",{module_name:"EmailText",max_results:b.length,query:"email_id IN ("+d.join(",")+")"}).w(function(a){a=a.entry_list;c.length!=a.length&&H(this.logger,"number of entries retrived for EmailText exptected to have "+c.length+" but found only "+a.length);for(var d=0;d<a.length;d++){var g=a[d];if(a[d]){var k=Nc(g,"name_value_list","email_id","value"),l=Bb(c,function(a){return a.id==
k});if(0<=l)for(var m in g.name_value_list)c[l].name_value_list[m]=g.name_value_list[m];else fe(this.logger,"key "+k+" not found in EmailText")}}return b},a)}}
function Ws(a,b){var c=b.module_name;a.p=z();var d=Vs(a,"get_entry_list",b);"Emails"==c&&(d=d.w(function(a){return Us(this,a)},a));return d.w(function(a){var d=a.result_count,g=a.offset||0,k=a.entry_list,l=parseInt(a.next_offset,10);if(t(d)&&u(k)){if(0<k.length){var m=Ps(k);return this.db.put(c,m).A(function(){var a=this.M,e=this.h,r=m;if(a.h)for(var r=u(r)?r:[r],s=0;s<r.length;s++)r[s]&&Xs(a,new Ds(e,c,r[s]));return d>=k.length&&l>g?(b.offset=l,Ws(this,b)):l},function(a){H(this.logger,"Fail to store into the database for module "+
c+": "+a)},this)}return l}throw Error("Invalid REST respond on entry list query on "+c+": "+JSON.stringify(a));},a)}function Ys(a,b){if(!b){for(var c=[],d=0;d<Yr.length;d++)c[d]=Ys(a,Yr[d]);c.push(Ys(a,"Users"));return wn(c)}var e={module_name:b},f="module/"+b;return a.db.get("Meta",f).w(function(a){return a?a:Vs(this,"get_module_fields",e).w(function(a){a&&a.module_name&&a.module_fields?this.db.put("Meta",a,f):H(this.logger,"Invalid module for "+b+" "+xi(a));return a},this)},a)}
function Zs(a,b){var c=new cl(b,"date_modified",null,!0),d="EmailTemplates"!=b;return a.db.keys(c,1).w(function(a){var c={};a[0]&&d&&(c.query=b.toLowerCase()+".date_modified>'"+a[0]+"'");c.module_name=b;c.order_by="date_modified";a=Ws(this,c);a.A(function(a){this.logger.info(this+" module "+b+" synced, "+a+" records updated.")},function(a){var c=".";a&&(c=" with "+a.name+": "+a.message);H(this.logger,this+" module "+b+" failed"+c)},this);return a},a)}
function Vs(a,b,c,d){var e=d||0,f=new B;if(!a.g||!a.g.user_id)return 2>e?(ge(a.logger,"Request require login, tried "+e),Ss(a).w(function(){e++;Vb(Vs(a,b,c,e),f)})):(J(a.logger,"Cannot do request, not login. Give up after "+e+" retry"),f.F()),f;d=Ts(a,b,c);a.request(b,d.keys,d.values,function(d,k){aj(k)&&x(d)?11==d.number&&/invalid/i.test(d.name)?(this.g=null,Vb(Vs(a,b,c,e),f)):f.callback(d):f.F(k.Q()+" "+k.Qa())},a);return f}
h.query=function(a,b){if(!u(a)||0==a.length)return bc("invalid query");for(var c=[],d=0;d<a.length;d++){var e=a[d],f=e.limit||5,g=e.offset||0,k=!!e.reverse;if(!x(e))return bc("invalid query at "+d+"");var l=e.store;if(-1==Yr.indexOf(l))return bc("invalid store name at "+d+": "+l);var m=e.index||"id",n=null;null!=e.key?(n=e.key,"ydn$phones"==m?n=wo(n):"ydn$emails"==m&&(n=n.toLowerCase()),n=e.prefix?tk(n):R.only(n)):null!=e.keyRange&&(n=uk(e.keyRange));"id"==m?b?c.push(this.db.keys(l,n,f,g,k)):c.push(this.db.values(l,
n,f,g,k)):fn(this.db,l,m)?b?c.push(this.db.keys(l,m,n,f,g,k)):c.push(this.db.values(l,m,n,f,g,k)):c.push(ac([]))}return(new vn(c)).A(function(c){for(var d=0;d<c.length;d++)if(c[d][0]){if(a[d].result=c[d][1],!b)for(var e=0;e<a[d].result.length;e++)a[d].result[e]._module=a[d].store}else H(this.logger,"query "+d+" failed."),a[d].result=[];return a},function(b){H(this.logger,"list failed "+b);return a},this)};
h.values=function(a,b){if(u(a)||!x(a))return bc("invalid query");var c=a.limit||5,d=a.offset||0,e=!!a.reverse,f=a.store;if(-1==Yr.indexOf(f))return bc("invalid store name : "+f);var g=a.index||"id";if(!v(g)||0==g.length)return bc("index name missing in "+f);var k=null;null!=a.key?(k=a.key,"ydn$phones"==g&&v(k)?k=wo(k):"ydn$emails"==g&&v(k)&&(k=k.toLowerCase()),k=a.prefix?tk(k):R.only(k)):null!=a.keyRange&&(k=uk(a.keyRange));return"id"==g?b?this.db.keys(f,k,c,d,e):this.db.values(f,k,c,d,e):fn(this.db,
f,g)?b?this.db.keys(f,g,k,c,d,e):this.db.values(f,g,k,c,d,e):bc("invalid index name: "+g+" for "+f)};
h.search=function(a){if(!u(a)||0==a.length)return bc("invalid query");for(var b=[],c=Cs(this.Y),d=0;d<a.length;d++){var e=a[d];if(!x(e))return bc("invalid query at "+d+"");var f=e.q;if(!v(f)||0==f.length)return bc("query term missing "+d+"");var g="ft-"+e.store+"-"+(e.index||"name");0<=Bb(c.fullTextCatalogs,function(a){return a.name==g})?(f=this.db.search(g,e.q),e.fetchFull&&(f=f.w(function(a){if(0<a.length){for(var b=[],c=0;c<a.length;c++)b.push(new Al(a[c].storeName,a[c].primaryKey));return this.db.values(b).w(function(b){for(var c=
0;c<b.length;c++)a.record=b[c];return a})}},this)),b.push(f)):b.push(ac([]))}return(new vn(b)).A(function(b){for(var c=0;c<b.length;c++)b[c][0]?a[c].fullTextResult=b[c][1]:(H(this.logger,"query "+c+" failed."),a[c].fullTextResult=[]);return a},function(b){H(this.logger,"list failed "+b);return a},this)};
function $s(a,b,c,d){var e={module_name:b},f="get_entry";d?(e.query=d+" = '"+c+"'",e.order_by="id",f="get_entry_list"):e.id=c;return Vs(a,f,e).w(function(a){if(a&&a.entry_list&&x(a.entry_list[0]))return Ps(a.entry_list[0]);J(this.logger,"record "+b+":"+c+" not found.");return null},a)}
function at(a){if(a.isLogin()){var b="login_data/"+a.g.user_id;return a.db.get("Meta",b).w(function(a){var d=$s(this,"Users",this.g.user_id).w(function(d){a&&a.date_modified==d.date_modified||this.db.put("Meta",d,b)},this);return a?a:d},a)}return bc("Not login")}
function bt(a,b,c,d){if(!v(c)||0==c.length)return bc("record id required.");if(0<=Yr.indexOf(b)){var e;d?(e=R.only(c),e=a.db.values(b,d,e).w(function(a){return a[0]},a)):e=a.db.get(b,c);return e.w(function(a){if(!a)return $s(this,b,c,d)},a)}return 0<=Xr.indexOf(b)?$s(a,b,c,d):bc("module: "+b+" not registerred")}
function ct(a){if(a.i&&a.i.isLogin)return ac(a.i);var b=new B;a.db.get("Meta","info/server").fa(function(a){a&&a.version?(this.i=a,b.callback(a)):this.request("get_server_info",[],[],function(a,c){if(0==c.Q())this.i=null,b.F("service "+(this.o+"/service/v4/rest.php")+" not responding");else if(aj(c)){var f=dk(c);if((!a||!a.version)&&v(f))try{a=JSON.parse(f)}catch(g){a=dk(c)}if(a&&a.version){var f=a,k={},l;for(l in f)k[l]=f[l];this.i=k;b.callback({info:f,about:dt(this)});this.db.put("Meta",f,"info/server")}else this.i=
null,b.F("invalid respond "+dk(c))}else this.i=null,b.F("request fail "+c.Q()+" "+c.Qa())},this)},a);return b}function et(a){var b=new B;a.request("get_available_modules",["filter"],["all"],function(a){b.callback(a)},a);return b}function dt(a){var b=a.j,b=b instanceof rp&&/proxy/.test(b.i);return{baseUrl:a.o,domain:a.h,userName:a.l,isLogin:a.isLogin(),hostPermission:!b}}
function ft(a){return(new vn([ct(a),et(a)])).w(function(a){return{serverInfo:a[0][1],availableModules:a[1][1],about:dt(this)}},a)}function gt(a,b,c){var d=[],e;for(e in c)d.push({name:e,value:c[e]});var f={module_name:b,name_value_list:d};return Vs(a,"set_entry",f).w(function(a){if(a&&a.id){var c={id:a.id};a=a.entry_list||{};for(var d in a)c[d]=a[d].value;for(var e in c)"date_modified"!=e&&(f[e]=c[e]);this.db.put(b,f);Zs(this,b);return c}throw Error("creating "+b+" entry fail");},a)}
function ht(a,b,c){if(c){var d=it(b,jt,a.h,void 0,c.id),e=d.module,f=new Ds(a.h,e,c);J(a.logger,"synchronizing "+b+" to "+f);if(Gs(f)==d.h){var g=new oq("update-gdata-record");pq(g,c);b=b.getData();x(b)&&bn(b);Ns(b,c)&&gt(a,e,c).A(function(a){x(a)?g.g=bn(a):g.g=a;this.history.add(g)},function(a){H(this.logger,"Fail to put record "+c.id+" to server "+a.message)},a)}}}
function kt(a,b){for(var c=lt(b),d=0;d<c.length;d++)0<=Yr.indexOf(c[d].module)&&a.db.get(c[d].module,c[d].g).w(function(a){ht(this,b,a)},a)}function mt(a,b,c){var d={};Ns(c,d);return gt(a,b,d)}h.isLogin=function(){return!!this.g&&!!this.g.user_id};
h.update=function(){if(this.j&&this.j instanceof rp)this.logger.info(this+" updating skipped since no direct connection is not available.");else{var a;if(this.N)fe(this.logger,"Modules are already updating now at "+a+" / "+Yr.length);else{this.N=!0;this.p=z();a=0;var b=this,c=function(){var d=Yr[a];d?(J(b.logger,"Syncing module "+d),a++,Zs(b,d).fa(function(){b.p=z();q.setTimeout(function(){c()},500)})):(fe(b.logger,"Updating module done"),b.N=!1)};c();q.setTimeout(function(){2E3<b.p-z()&&c()},2E3)}}};
function Ss(a){if(!window.navigator.onLine){var b=new B;chrome.storage.local.get("last-login",function(c){(c=c["last-login"])&&Vb(a.db.get("Meta","login_data/"+c).w(function(a){this.g=a},a),b)});return b}if(!a.l)return bc("username required.");if(!a.D)return bc("password required.");b=new B;a.request("login",["user_auth","application_name","name_value_list"],[{user_name:a.l,password:a.D},"Yathit CRM",{language:"",notifyonsave:"false"}],function(a,d){if(a&&a.id){this.g=Ps(a);this.g.id=a.id;var e={};
e["last-login"]=this.g.user_id;chrome.storage.local.set(e);this.dispatchEvent(new E(nt,this));b.callback(a)}else a&&a.description?b.F(a.description+" ("+a.name+")"):(e=d.Q()+" "+d.Qa()+" "+dk(d),b.F("Login fail: "+e.substr(0,200)))},a,!0);return b}
function ot(a){var b=new B;if(a.g&&a.g.user_id){var c="login_data/"+a.g.user_id;chrome.storage.local.remove("last-login");a.db.remove("Meta",c)}a.request("logout",[],[],function(a,c){this.g=null;aj(c)?(H(this.logger,"Logout request fail with "+c.Q()+" "+c.Qa()),b.callback(!0)):b.F(c.Q()+" "+c.Qa())},a,!0);return b}
function pt(a){function b(){var a=new B;g.request(new Xi(f.toString())).execute(function(b,c){/sugarcrm/i.test(dk(c))?a.F("Look like SugarCRM web site, but REST V4 API is not available."):200==c.Q()?a.F("Not a SugarCRM web site"):a.F("Invalid respond, "+c.Q())});return a}function c(a){var b=new B;e(a+"/service/v4/rest.php",function(c,e){if(200==e.Q()){if(!c||!c.version){var f=dk(e);if(v(f))try{c=JSON.parse(f)}catch(g){b.F(d(a,e));return}else c=f}c&&c.version&&(c.baseUrl=a,b.callback(c))}else b.F(d(a,
e))});return b}function d(a,b){var c="GET "+a+" "+b.Q()+" "+b.Qa()+" "+dk(b);return{name:"HttpRequestError: "+b.Q()+" GET "+a,message:c}}function e(a,b){var c=new Ie;c.add("method","get_server_info");c.add("input_type","json");c.add("response_type","json");c.add("rest_data","{}");g.request(new Xi(a,"POST",{},{"Content-Type":"application/x-www-form-urlencoded"},c.toString())).execute(b)}a=a.trim();wa(a,"http")||(a="https://"+a);var f=new Be(a);He(f,"");Ge(f,null);var g=Vi("proxy"),k=f.clone();a=f.yc;
/rest.php$/.test(a)||/index.php$/.test(a)&&Fe(k,a.replace("/index.php",""));var l=k.toString();xa(l,"/")&&(l=l.substring(0,l.length-1));return c(l).A(function(a){a.isLogin=!1;a.userName=null;a.domain=k.Ub;a.baseUrl=l;return a},function(a){if(200==a.errorCode||za(k.yc))return b();Fe(k,"");l=k.toString();return c(l)})}h.toString=function(){return"SugarClient:"+this.h};
function qt(a,b){var c=b&&v(b.assigned_user_id)?b.assigned_user_id:null;if(!v(c)||0==c.length)return bc("assigned_user_id required");var d=z()-604800,d=Qs(new Date(d)),c=R.bound([c,d],[c,"\uffff"]),c=[new el("Meetings",Is("Meetings"),c),new el("Calls",Is("Calls"),c),new el("Tasks",Is("Tasks"),c),new el("Opportunities",Is("Opportunities"),c)],e=[];return tn(a.db,function(a,b){for(var c=[],d=0;d<b.length;d++)b[d]&&(e.push(b[d]),c[d]=!0);return c},c).w(function(){return e})}
function rt(a,b){var c=[],d=null,e=b||{},f=e.limit||10;(e=e.since)&&e instanceof Date&&(d=Qs(e),d=R.upperBound(d));for(e=0;e<Yr.length;e++)c[e]=new el(Yr[e],"date_modified",d,!0,!0);var g=[];return tn(a.db,function(a,b){for(var c=[],d=-1,e=null,r=0;r<b.length;r++)b[r]&&(e?e<b[r].date_modified&&(e=b[r].date_modified,d=r,c=[],c[r]=!0):(e=b[r].date_modified,d=r,c[r]=!0));0<=d&&(b[d]._module=Yr[d],g.push(b[d]));return g.length>=f?[]:c},c).w(function(){return g})}
function st(a,b,c){"about"==b?a=ac(dt(a)):"activity-stream"==b?a=rt(a,c):"activity-upcoming"==b?a=qt(a,c):"details"==b?a=ft(a):"get"==b?a=bt(a,c.module,c.id,c.index):"fetch-module"==b?a=Zs(a,c):"info-module"==b?(x(c)&&v(c.module)&&(c=c.module),a=Ys(a,c)):"keys"==b?a=a.values(c,!0):"list-module"==b?a=et(a):"login-user"==b?a=at(a):"put-record"==b||"new-record"==b?(b=c.module)&&-1!=Xr.indexOf(b)?(c=c.record,a=x(c)?gt(a,b,c):bc("record object required")):a=bc("invalid module name: "+b):"search"==b?a=
u(c)?a.search(c):bc("query must be an array"):"query"==b?a=a.query(c):"server-info"==b?a=ct(a):"rest"==b?x(c)?(b=c.method,c=c.params,a=v(b)&&0!=b.length?x(c)?Vs(a,b,c):bc("REST parameter must be an object"):bc("method must be valid string")):a=bc("REST parameter must be an object"):a="values"==b?a.values(c):bc("invalid req "+b);return a};function tt(a){Error.captureStackTrace?Error.captureStackTrace(this,tt):this.stack=Error().stack||"";a&&(this.message=String(a))}A(tt,Error);tt.prototype.name="ydn.gdata.error.InvalidAtomFormatError";function ut(a){Error.captureStackTrace?Error.captureStackTrace(this,ut):this.stack=Error().stack||"";a&&(this.message=String(a))}A(ut,Error);ut.prototype.name="ydn.gdata.error.IncompatibleError";var vt="atom app gd xhtml batch openSearch".split(" ");function wt(a){if(!t(this.type))throw new Ii("Abstract class cannot be instantiated.");if(v(a))a={id:{$t:a}};else if(!t(a.id)||!v(a.id.$t))throw new Di("Invalid GDataFeed");this.id=a.id.$t;this.data=a;t(this.data.entry)?u(this.data.entry)||(this.data.entry=[this.data.entry]):this.data.entry=[];this.j={};this.o={};a=u(this.data.entry)?this.data.entry.length:0;for(var b=0;b<a;b++){var c=this.data.entry[b],c=c.id?c.id.$t:c.Jh?c.Jh.$t:"";if(0==c.length)throw new tt("entry "+b);if(0==c.match(/\w+$/)[0].length)throw new tt("entry "+
b+" of "+c);var d=c.match(/\w+$/)[0];this.j[c]=this.data.entry[b];this.o[d]=this.data.entry[b]}this.i=!0;this.D=[];this.u=new li(function(){this.dispatchEvent(xt)},300,this);this.oh=null;this.h=NaN;this.p=void 0}A(wt,si);var xt="i";h=wt.prototype;h.cg=function(){return this.kind};h.logger=L("ydn.gdata.Feed");
h.gb=function(a){var b=new B;ge(this.logger,this+" receiving a task, ready: "+this.i);var c=this;this.i?(this.i=!1,b.fa(function(){O(c.logger,c+" finish the task.");c.i=!0;var a=c.D.shift();a&&a.call(this)}),a.call(this,b)):this.D.push(pa(oa(a,this),b));return b};h.oh=null;function yt(a){var b;if(!(b=a.oh))if(a=a.Je(),t(a)){b=a;for(var c=0;c<Vj.length;c++){var d=(0,Vj[c])(a);if(d){b=d;break}}O(Tj,"Resolving "+a+" to "+b);b=Uj[b]||null}else b=Uj["default"];return b}h.Bf=function(){this.dispatchEvent("e")};
h.Cg=function(){return vt};h.Mh=function(a){a.g()||H(this.logger,"Batch submission failed. "+a.responseText)};
h.vg=function(a,b){var c=this.Cg(),d=void 0;t(c)||(c=vt);for(var e="",f=0;f<c.length;f++)var g=c[f],e=0==f?e+(' xmlns="'+Zq[g]+'" '):e+(" xmlns:"+g+'="'+Zq[g]+'" ');d=t(d)?"<id>"+d+"</id>":"";d=Bi("<feed"+e+">"+d+"</feed>");for(f=c=0;e=this.Jc(f);f++)if(pr(e))nr(e,"");else if(qr(e.getData())){var g="delete"==or(e.getData()),k=!(!e.data.id||!e.data.id.$t);nr(e,null);var l=kr(new fr(null,"entry",e.data),d.documentElement),m=l.getElementsByTagNameNS(ar("batch"),"operation");m[0]?m=m[0]:m=l.appendChild(d.createElementNS(ar("batch"),
"operation"));l=d.createAttribute("type");l.nodeValue=g?"delete":k?"update":"insert";m.setAttributeNode(l);nr(e,"committed");c++;a&&a.message({id:this.bg(),code:"operation: "+l.nodeValue+" "+e})}if(0==c)return fe(this.logger,this+" Nothing to commit."),0;fe(this.logger,this+" committing "+c+" entries.");d=Ci(d);b?((e=this.logger)&&e.info("Commit ignored for dry run.",void 0),window.console.log(d)):(e=oa(this.Mh,this),this.N&&this.N.stop(),f=yt(this),g=this.af(),f.send(g,e,{method:"POST",body:d,headers:{"Content-Type":"application/atom+xml"},
params:{}}));return c};h.Ie=function(a){return new lr(a)};h.Jc=function(a){return 0<=a&&a<this.data.entry.length?this.Ie(this.data.entry[a]):null};h.ag=function(a){return(a=this.j[a])?this.Ie(a):null};
h.save=function(a){if(this.store){var b=this;this.l||(this.l=new li(function(){this.gb(function(a){var d=b.toJSON(),e=b.data.entry,f,g,k;b.store.M(function(a){a.put("ydn.gdata.feed",d).Vc(function(a){throw a;}).w(function(){f=!0});a.put("ydn.gdata.entry",e).Vc(function(a){throw a;}).w(function(a){k=a.length;g=!0})},["ydn.gdata.feed","ydn.gdata.entry"],"readwrite").A(function(){f&&g?ge(this.logger,b+": saved "+k+" entries."):ge(this.logger,b+": saved failed"+e.length+" entries.");a.callback(!0)},function(a){throw a;
},this)})},1E3,this));a?ni(this.l):mi(this.l)}};
function zt(a,b,c){c=c||new B;var d=yt(a);if(!d)return H(a.logger,a+": No transport available."),c.F(Error("No transport available.")),c;d.send(b,function(b){if(200==b.status){a.h=z();b=b.X?Wf(b.X.responseText):void 0;if(!b.feed)throw new tt("feed missing.");var d=b.feed;if(!t(d))throw b=yi(d),new tt(b.substr(0,50));if(d.id.$t!=a.G())throw new ut(d.id.$t+" is not "+a.G());var g=b=0,k=u(d.entry)?d.entry:d.entry?[d.entry]:[];b=k.length;0==b&&O(a.logger,a+": fetch return no result.");for(var l=0;l<b;l++){for(var m=
a,n=k[l],p=n instanceof lr?n:m.Ie(n),r=p,s=0;s<r.Ec.length;s++)null!=r.data[r.Ec[s]]&&!u(r.data[r.Ec[s]])&&(r.data[r.Ec[s]]=[r.data[r.Ec[s]]]);nr(r,null);r=r.getData();r.batch$status&&(r.batch$status=void 0);r.batch$operation&&(r.batch$operation=void 0);var r=p.G(),w=m.ag(r);(s=!!w)?w.update(p):(w=mr(p),m.data.entry.push(n),m.j[r]=p.getData(),m.o[w]=p.getData());!s&&g++}fe(a.logger,a+" "+b+" ("+g+" new) entries received");a.Bf();(d=rq(d,"next"))?(a.save(),mi(a.u),a.p=d.$t,zt(a,d.href,c)):(0<b&&(a.save(),
mi(a.u)),c.callback(!0))}else H(a.logger,"Fetching "+b.uri+" failed: "+b.status),c.F(!1)});return c}h.toString=function(){return this.type+":"+this.id};function At(a,b){a.wh&&b.g.set("v",a.wh);b.g.set("alt","json");b.g.set("showdeleted",!0)}
function Bt(a,b){var c="lu",d=!1;if("lf"==c){if(a.h){var d=!0,e=new Date(a.h),e=e.toISOString();b.g.set("updated-min",e)}}else if("lu"==c){for(var e=0,f=-1,g,k=0;g=a.Jc(k);k++)g=g.data.updated.$t,e<g&&(e=g,f=k);if(e=a.Jc(f))e=new Date(e.data.updated.$t),e=new Date(1+ +e),e=e.toISOString(),b.g.set("updated-min",e)}else"lo"==c?(b.g.set("orderby","lastmodified"),a.h&&b.g.set("max-results","1")):c="no";ge(a.logger,a+" updating "+(d?"continue":"begin")+" by "+c)}h.oj=Wq.prototype.Be;h.G=Wq.prototype.G;
h.qj=Wq.prototype.ej;h.pj=Wq.prototype.dj;h.Je=function(){return this.qj()||""};h.bg=function(){return this.id};h.af=function(){return this.pj()};function Ct(a){return a.gb(function(a){var c=new Be(this.Je());At(this,c);Bt(this,c);this.S(qi,!1);zt(this,c.toString()).fa(function(c){ti(this);c?a.callback(!0):a.F(void 0)},this)})}h.update=function(a){return a||!0!==("undefined"==typeof this.g?null:(this.g&qi)==qi)?Ct(this):(ge(this.logger,this+" already loaded."),ac(!1))};
h.count=function(a){if(a){a=0;for(var b,c=0;b=this.Jc(c);c++)pr(b)||"deleted"==or(b.getData())||a++;return a}return this.data.entry.length};h.toJSON=function(){return{id:this.id,key:this.bg(),last_fetch_next_uri:this.p,last_fetch:this.h}};function Dt(a){var b,c=a.match(/^\D*0*(\d{1,2}\D)?\D*0*(.+)/);c?(b=c[1].replace(/\D/g,""),a=c[2].replace(/\D/g,"")):a=a.replace(/\D/g,"");return{Bb:b,pb:a}}function Et(a,b){var c=Dt(a),d=Dt(b);if(t(c.Bb)&&t(d.Bb)&&0!=c.Bb.length&&0!=d.Bb.length&&c.Bb!==d.Bb)return 0;if(t(c.ob)&&0!=c.ob.length){if(t(d.ob)&&0!=d.ob.length){if(c.ob.length>=d.ob.length){for(var e=0;e<d.ob.length;e++)if(c.ob[e]!=d.ob[e])return 0;return 1}for(e=0;e<c.ob.length;e++)if(c.ob[e]!=d.ob[e])return 0}return-1}return 1}
function Ft(a,b){if(!a||!b||0==a.length||0==b.length)return 0;a=a.trim();b=b.trim();var c=Dt(a),d=Dt(b);return c.Bb&&c.pb&&c.Bb==d.Bb&&c.pb==d.pb?6<=c.pb.length?1:4<=c.pb.length?.8:.4:c.pb&&4<=c.pb.length&&c.pb==d.pb?8<=c.pb.length?.8:4<=c.pb.length?.6:.4:0};function Gt(a){lr.call(this,a);a=(a=this.id.match(/https?:\/\/www.google.com\/m8\/feeds\/(group|contact|batch)s?\/([^\/]+)\/?(\w+)\/?(\w*)?/))?{Fj:"m8",kind:a[1],user_id:a[2]?a[2].replace("%40","@"):"",projection:a[3],id:a[4]}:null;window.console.assert(!!a,"Invalid m8 entry: "+this.id);this.user_id=a.user_id;window.console.assert(a.kind==this.kind,"Invalid kind: "+a.kind+" vs "+this.kind)}A(Gt,lr);Gt.prototype.logger=L("ydn.gdata.m8.Entry");Gt.prototype.g="3.0";Gt.prototype.type="m8";
Gt.prototype.toString=function(){var a=this.id?mr(this):void 0;return"m8.Entry."+this.kind+":"+a};function Ht(a){if(!t(this.kind))throw new Ii("Abstract class cannot be instantiated.");wt.call(this,a);this.user_id=this.G()}A(Ht,wt);h=Ht.prototype;h.cg=function(){return this.kind};h.wh="3.0";h.type="m8";h.toString=function(){return"Feed:"+this.kind+":"+this.user_id};h.Je=function(){return"https://www.google.com/m8/feeds/"+this.cg()+"s/"+this.user_id.replace("@","%40")+"/full?v=3.0"};
h.af=function(){var a=Ht.m.af.call(this);return a?a:"https://www.google.com/m8/feeds/"+this.cg()+"s/"+this.user_id.replace("@","%40")+"/full/batch?v=3.0"};var It=vt.concat(["gContact"]);Ht.prototype.Cg=function(){return It};function Jt(a,b,c,d,e,f){this.scheme=a;this.domain=b;this.module=c;this.g=d;this.i=ha(e)?e:NaN;this.h=ha(f)?f:NaN}var jt="sugarcrm";function Kt(a){if(!x(a)||!v(a.value))return null;var b=Lt(a.value);if(!b)return null;var c=NaN,d=NaN;if(v(a.label)){a=a.label;var e=a.indexOf("#"),f=a.indexOf("-");0<e&&0<f&&f>e&&(c=parseInt(a.substring(e,f),10),d=parseInt(a.substring(f),10))}return new Jt(b[1],b[2],b[3],b[4],c,d)}function Lt(a){return a?a.match(/(\w+):\/\/([^\/]+)\/([^\/]+)\/(.*)/):null}
Jt.prototype.U=function(){return this.scheme+"://"+this.domain+"/"+this.module+"/"+this.g};function Mt(a){Gt.call(this,a)}A(Mt,Gt);h=Mt.prototype;h.kind="contact";h.logger=L("ydn.gdata.m8.ContactEntry");h.$f=function(){return"contact"};function Nt(a){a=a.getData();return Nc(a,"gd$name","gd$fullName","$t")||""}h.getName=function(a){var b=a?"":this.vd();if(a||0==b.length)a=this.getData().gd$name,x(a)&&(b=a.gd$fullName.$t||"",0==b.length&&(b=(a.gd$givenName.$t||"")+" "+(a.gd$familyName.$t||"")));return Ba(b)};
function Ot(a){var b=a.data.gd$email;a=[];for(var b=u(b)?b:b?[b]:[],c=0;c<b.length;c++)a.push(b[c].address);return a}function Pt(a){a=a.data.gd$phoneNumber;a=u(a)?a:x(a)?[a]:[];for(var b=[],c=0;c<a.length;c++)a[c].$t&&!za(a[c].$t)&&b.push(a[c].$t);return b}h.cf=function(){var a=Mt.m.cf.call(this);if(a.ydn$emails||a.ydn$xp||a.ydn$externalIds)a==this.data&&(a=bn(this.data)),delete a.ydn$emails,delete a.ydn$xp,delete a.ydn$externalIds;return a};h.Ec="link category gd$email gd$im gd$organization gd$phoneNumber gd$structuredPostalAddress gd$formattedAddress".split(" ");
function Qt(a,b){function c(a){var b=Ab(e,function(b){return b.address===a.address});b?b.rel=t(a.rel)?a.rel:b.rel:d(a)}function d(a){a=bn(a);f&&delete a.primary;t(void 0)&&(a.rel=void 0);e.push(a)}for(var e=[bn(a.data.gd$email[0])],f=!!a.data.gd$email[0].primary,g=1;g<a.data.gd$email.length;g++)c(a.data.gd$email[g]);for(g=0;g<b.length;g++)c(b[g]);g=Km(e,a.data.gd$email);g||(a.data.gd$email=e);return!g}
function Rt(a,b){function c(a){var b=xb(e,function(b){return Ft(b.$t,a.$t)}),c=Ti(b);if(.4<c.value){var b=e[c.index],f=t(a.rel)?a.rel:b.rel;1==c.value?(b.rel=f,b.$t=a.$t):t(a.rel)&&t(b.rel)&&b.rel!==a.rel?d(a,f):(b.rel=f,c=Et(b,a),-1==c?b.$t=a.$t:0==c&&(b.$t=a.$t))}else d(a)}function d(a,b){a=bn(a);f&&delete a.primary;t(b)&&(a.rel=b);e.push(a)}for(var e=[bn(a.data.gd$phoneNumber[0])],f=!!a.data.gd$phoneNumber[0].primary,g=1;g<a.data.gd$phoneNumber.length;g++)c(a.data.gd$phoneNumber[g]);for(g=0;g<
b.length;g++)c(b[g]);g=Km(e,a.data.gd$phoneNumber);g||(a.data.gd$phoneNumber=e);return!g}h.Jf=function(a,b){if("gd$phoneNumber"==a){if(null!=this.data.gd$phoneNumber)return Rt(this,b);this.data.gd$phoneNumber=bn(b);return!0}if("gd$email"==a){if(null!=this.data.gd$email)return Qt(this,b);this.data.gd$email=bn(b);return!0}return Mt.m.Jf.call(this,a,b)};
function it(a,b,c,d,e){a=a.getData();a=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var f=0;f<a.length;f++){var g=Kt(a[f]);if(g&&!(b&&b!=g.scheme||c&&c!=g.domain||e&&e!=g.g||d&&d!=g.module))return g}return null}function lt(a){a=a.getData();a=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var b=[],c=0;c<a.length;c++){var d=Kt(a[c]);d&&b.push(d)}return b};function St(a){Ht.call(this,a)}A(St,Ht);h=St.prototype;h.logger=L("ydn.gdata.m8.ContactFeed");h.kind="contact";h.Bf=function(){St.m.Bf.call(this)};h.ag=function(a){return St.m.ag.call(this,a)};h.Ie=function(a){return new Mt(a)};h.Jc=function(a){return St.m.Jc.call(this,a)};h.Je=function(){return"https://www.google.com/m8/feeds/contacts/"+this.G()+"/full"};h.bg=function(){return"http://www.google.com/m8/feeds/contacts/"+this.G().replace("@","%40")};function Tt(a){function b(a){wa(a,"atom:")&&(a=a.substring(5,a.length));return a.replace("#text","$t").replace(/:/g,"$")}v(a)&&(a=Bi(a));var c={};if(1==a.nodeType){if(0<a.attributes.length)for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c[b(e.nodeName)]=e.nodeValue}}else 3==a.nodeType&&(c=a.nodeValue);if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++){var e=a.childNodes.item(d),f=b(e.nodeName);if("undefined"==typeof c[f])"content"==f?(c[f]={$t:Ci(e)},e.namespaceURI&&(c[f].xmlns=
e.namespaceURI)):c[f]=Tt(e);else{if("undefined"==typeof c[f].length){var g=c[f];c[f]=[];c[f].push(g)}c[f].push(Tt(e))}}return c};function Ut(a,b){this.id=b.replace("@","%40");this.client=this.g=null;this.i=new oi(function(){fe(this.logger,"updating gdata "+this);Vt(this).A(function(a){this.logger.info(this+" synced, "+a+" new entries updated.")},function(){H(this.logger,this+" update failed.")},this)},6E4,this);this.j=a;this.h=null}h=Ut.prototype;h.logger=L("ydn.ds.gdata.GData");h.update=function(){var a=this.i;a.ea?a.qd=!0:pi(a)};h.O=function(){return this.j};
function Wt(a){var b=new B;a.execute(function(a,d){a?b.callback(a):b.F(d)});return b}
function Xt(a,b){var c=(a.client?a.client:Vi("gse")).request(b);return Wt(c).A(function(a){a=a.feed;if(!a.entry)return 0;for(var b=(new St(a)).oj("next"),c=a.entry.length,g=!!this.h,k=0;g&&k<c;k++){var l=a.entry[k];l.gContact$externalId&&this.h(l)}return this.O().put(this.K(),a.entry).w(function(){return b?Xt(this,new Xi(b.href)).w(function(a){return c+a},this):c},this)},function(a){H(this.logger,"fetching fail "+(a?a.Q()+" "+a.Qa():""))},a)}h.getParams=function(){return{alt:"json"}};
h.get=function(a){return v(a)&&0!=a.length?this.O().get(this.K(),a):bc("invalid key")};h.put=function(a){return this.O().put(this.K(),a)};h.vh=function(a){return new lr(a)};function Yt(a,b){var c=a.vh(b);nr(c,"modified");return c.vg().w(function(a){a=Tt(a);var b=a.entry;if(!b||!b.id)throw Error("Invalid respond on saving gdata "+xi(a));delete b.updated;this.O().put(this.K(),b);return b},a)}
function Vt(a){if(!a.O().getName())return bc(Error("database not ready"));if(!a.g){var b=new cl(a.K(),"updated.$t",null,!0);a.g=a.O().keys(b,1).w(function(a){var b=this.getParams();b.orderby="lastmodified";a[0]?(b.sortorder="descending",a=(new Date(1+ +new Date(a[0]))).toISOString(),b["updated-min"]=a):b.sortorder="ascending";return Xt(this,new Xi(Zt(this)+"/full","GET",b)).fa(function(){this.g=null},this)},a)}return a.g}h.toString=function(){return"GData:contact:"+this.id.replace("%40","@")};function $t(a,b){Ut.call(this,a,b)}A($t,Ut);$t.prototype.K=function(){return"contact"};$t.prototype.getParams=function(){var a=$t.m.getParams.call(this);a.v="3.0";return a};function Zt(a){return"https://www.google.com/m8/feeds/contacts/"+a.id}$t.prototype.vh=function(a){var b=!!a.id;b||(a.id={$t:Zt(this)+"/base/0"});var c=new Mt(a);b||delete a.id;return c};function au(a,b){return v(b)?0==b.length?ac([]):a.O().values(a.K(),"ydn$emails",R.only(b),100,0,!1,!0):bc("invalid key for email "+b)}
function bu(a,b){var c=b.U();if(!v(c)||0==c.length)return bc("invalid key for external id "+c);c=R.only(c);return a.O().values(a.K(),"ydn$externalIds",c).w(function(){},a)}
function cu(a,b,c){return a.O().get(a.K(),b).w(function(a){if(a){if(!c||!c.label||!c.value)return bc("invalid external_id_data");var e=c.label,f=c.value;a.gContact$externalId=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var g=!1,k=0;k<a.gContact$externalId.length;k++)if(a.gContact$externalId[k].value==f){a.gContact$externalId[k].label=e;g=!0;break}g||a.gContact$externalId.push({label:e,value:f});return Yt(this,a)}throw Error("gdata entry "+b+
" not found");},a)};function du(a){a=a||location.hash;"#"==a.charAt(0)&&(a=a.substr(1));return/^contact(\/\[w\W]+)?\/[a-f\d]{2,18}$/.test(a)?"cd":/^contacts(\/\[w\W]+)?/.test(a)?"ct":/compose=new$/.test(a)?"cp":/^(label\/)?[\w\+]+$/.test(a)?"in":/^(label\/)?[\w\+]+\/[a-f\d]{10,18}$/.test(a)?"em":"un"};function eu(a){this.g=a;this.i=0;this.j=[];this.l=[0,0,0,0];this.h=new Kinetic.Layer;a=this.g/2;var b=a/3;this.o=[a,a,b,this.g-b];this.p=[a,b,this.g-b,this.g-b]}eu.prototype.clear=function(){this.h=new Kinetic.Layer};var fu=Math.pow(2,2),gu=Math.pow(2,3),hu=Math.pow(2,4),iu=Math.pow(2,5);eu.prototype.S=function(a,b){this.i=b?this.i|a:this.i&~a};
function ju(a){a.clear();for(var b=[["#C2C2C2","#6B6B6B","#525252","#3D3D3D"],["#FAFAFA","#D8D8D8","#D8D8D8","#C2C2C2"],["#FCCA03","#DD1812","#0140CA","#16A61E"]],c=["m252,324c0,-59.647 48.354,-108 108,-108c26.90799,0 51.51501,9.843 70.42401,26.121c1.03198,-8.564 1.57599,-17.27901 1.57599,-26.121c0,-119.126 -96.43701,-215.722 -215.49899,-215.994c40.89099,0.137 73.99899,33.321 73.99899,74.244c0,41.007 -33.24301,74.25 -74.25,74.25c-41.008,0 -74.25,-33.243 -74.25,-74.25c0,-40.979 33.19701,-74.203 74.16701,-74.248c-0.05602,0 -0.11201,-0.002 -0.16701,-0.002c-119.294,0 -216,96.707 -216,216c0,8.843 0.544,17.55701 1.577,26.121c18.908,-16.278 43.515,-26.121 70.423,-26.121c59.646,0 108,48.353 108,108c0,37.93399 -19.561,71.29401 -49.14301,90.56c26.127,11.21701 54.90701,17.44 85.14301,17.44s59.01599,-6.22299 85.14301,-17.44c-29.582,-19.26599 -49.14301,-52.62601 -49.14301,-90.56z",
"m142,74.25c0,41.007 33.242,74.25 74.25,74.25c41.00699,0 74.25,-33.243 74.25,-74.25c0,-40.923 -33.108,-74.107 -73.99899,-74.244c-0.112,0 -0.22301,-0.004 -0.334,-0.004c-40.97,0.045 -74.16701,33.269 -74.16701,74.248z","m180,324c0,-59.647 -48.354,-108 -108,-108c-26.908,0 -51.515,9.843 -70.424,26.121c9.366,77.69 59.967,142.67798 129.28099,172.43799c29.582,-19.26498 49.14301,-52.625 49.14301,-90.55899z","m430.42401,242.121c-18.909,-16.278 -43.51602,-26.121 -70.42401,-26.121c-59.646,0 -108,48.353 -108,108c0,37.93399 19.561,71.29401 49.142,90.56c69.315,-29.76199 119.91602,-94.74899 129.28201,-172.439z"],
d=b[0].slice(),e=[fu,gu,hu,iu],f=0;f<e.length;f++){var g=e[f];(a.i&g)==g&&(d[f]=b[2][f])}b=new Kinetic.Group({scaleX:a.g/435,scaleY:a.g/435});e=new Kinetic.Group;for(f=0;f<c.length;f++)a.j[f]=new Kinetic.Path({data:c[f],fill:d[f]}),0<a.l[f]&&(g=a.g/19*8,g=new Kinetic.Text({x:a.o[f]-g/4,y:a.p[f]-g/2,text:String(a.l[f]),fontSize:g,fontFamily:"sans-serif",fill:"white"}),e.add(g)),b.add(a.j[f]);a.h.add(b);a.h.add(e);return a.h};function ku(a){this.g=document.createElement("div");this.h=a||19;this.i=new eu(this.h);this.j=new li(function(){this.render()},100,this);chrome.runtime.onSuspend&&chrome.runtime.onSuspend.addListener(function(){chrome.browserAction.setTitle({title:"suspended"});this.S(gu,!1);this.S(hu,!1);this.S(iu,!1);this.S(fu,!1);this.render()}.bind(this))}ku.prototype.n=function(){return this.g};ku.prototype.S=function(a,b){this.i.S(a,b);ni(this.j)};
ku.prototype.render=function(){this.g.parentElement||document.body.appendChild(this.g);(new Kinetic.Stage({container:this.g,width:this.h,height:this.h})).add(ju(this.i));if(chrome.browserAction){var a=this.g.querySelector("canvas").getContext("2d");chrome.browserAction.setIcon({imageData:{19:a.getImageData(0,0,19,19),38:a.getImageData(0,0,38,38)}})}};function lu(){this.g={};this.h=null;$i||($i=new Zi);var a=this.D=$i,b=chrome.extension.getURL("option-page.html");a.p=b;this.I=new gp;this.i=this.p=this.l=this.u=null;this.L=new dh(new hh,"XMLHttpRequest"+location.host);this.j=new ku;this.o={};this.Ha=new Of(this);chrome.permissions.onAdded.addListener(this.xi.bind(this))}h=lu.prototype;h.logger=L("ydn.crm.app.App");
h.xi=function(a){for(var b=(a=a.origins)?a.length:0,c=0;c<b;c++){var d=a[c].match(/https:\/\/([^\/]+)/);if(d){var d=d[1],e=this.g[d];if(e){fe(this.logger,"host permission granted to "+e);if(e.j instanceof rp){var f=Vi("default");this.g[d]=new Rs(f,e.M,e.o,e.l,e.D);this.g[d].update()}mu(this,{req:"host-permission",data:{grant:d}})}}}};
h.init=function(){J(this.logger,"init "+this);this.j.S(fu,!0);kq();chrome.runtime.onInstalled.addListener(function(a){Sj({event:"onInstalled",details:a,version:"0.10.11","install-id":hq})});setTimeout(function(){Xp()},6E4*(.5+Math.random()))};
function nu(a,b){return Ss(b).w(function(){var a=b.h,d=b.isLogin()?b.l+"@":" (not login) ";this.logger.info("connected to sugarcrm client: "+d+a);b.isLogin()&&(b.update(),ou(this));a=dt(b);Sj({event:"sugar-login",details:a});this.Ha.listen(b,nt,this.Lg);return a},a)}h.Lg=function(a){dt(a.target);this.j.S(gu,!0)};
function pu(a,b){var c=b.baseUrl,d=b.domain||c;if(!d)return bc("domain or url required.");d=d.trim();wa(d,"http")&&(d=Oe(new Be(d)));/\//.test(d)&&(d=Oe(new Be("https://"+d)));if(c&&(c=c.trim(),!wa(c,"http"))){var c=c.replace(/:?\/\//,""),e=new Be("https://"+c);e.yc||Fe(e,"/");c=e.toString()}var f=a.g[d],g="sugar-client-"+d,k=a.L.get(g)||{};Rj.log({event:"sugar-init",details:{domain:d}});if(f)return f.isLogin()?ac(dt(f)):nu(a,f);var l=b.userName||k.userName;c||(c=k.base_url);c||(c="https://"+d+"/");
if(!l)return J(a.logger,"username not found in "+JSON.stringify(b)),bc("username required");var m=b.password;m?b.hashed||(m=CryptoJS.MD5(m).toString()):m=k.password;if(!m)return J(a.logger,"password not found in "+JSON.stringify(b)),bc("password required.");k.userName=l;k.password=m;k.base_url=c;var e={origins:[c+"/"]},n=new B;chrome.permissions.contains(e,function(b){b||H(a.logger,"host permission required for "+c);b=b?Vi("default"):Vi("proxy");f=new Rs(b,a,c,l,m);a.g[d]=f;b=nu(a,f);b.w(function(){a.L.set(g,
k);var b=Object.keys(a.g);mp(a.I,b);mu(a,{req:"list-sugarcrm-domains",data:b})},a);Vb(b,n)});return n}function qu(a,b,c,d){return 0<=Xr.indexOf(b)?a.h.get(c).w(function(a){if(a){var f=cs(b);return mt(d,f,a).w(function(a){if(a&&a.id)return a;throw Error("Set Entry to "+f+" failed");},this)}throw Error("contact entry "+c+" not found");},a):bc(new Di("invalid module name "+b))}
function ru(a,b){var c=new Ds(b.domain,b.module,b.obj),d={};Os(c,d);c=new Jt(jt,c.domain,c.module,c.G(),NaN,Gs(c));d.gContact$externalId=[{label:c.module+"#"+c.i+"-"+c.h,value:c.U()}];return Yt(a.h,d)}function Xs(a,b){var c=new Jt(jt,b.domain,b.module,b.G());bu(a.h,c).w(function(a){for(var c=0;c<a.length;c++){var f=a[c];0<Os(b,f)&&this.h.put(f)}},a)}function ou(a){var b=!1,c;for(c in a.g)if(a.g[c].isLogin()){b=!0;break}a.j.S(fu,!0);a.j.S(iu,a.isLogin());a.j.S(gu,b)}
function su(a,b){if(!b)return bc("domain required");a.L.remove("sugar-client-"+b);Rj.log({event:"sugar-rm",details:{domain:b}});return lp(a.I).w(function(a){a=a||[];var d=a.indexOf(b),e=this.g[b];this.Ha.ka(e,nt,this.Lg);e.ca();delete this.g[b];0<=d&&(a.splice(d,1),mp(this.I,a),mu(this,{req:"list-sugarcrm-domains",data:a}));return e.isLogin()?ot(e).w(function(){this.logger.info("SugarCRM "+b+" removed.");ou(this);return!0},this):!1},a)}
h.Ii=function(a){for(var b=u(a.gContact$externalId)?a.gContact$externalId:[a.gContact$externalId],c=0;c<b.length;c++)if(b[c]&&b[c].value&&b[c].label){var d=Lt(b[c].value);d&&"sugarcrm"==d[1]&&(d=d[2],this.g[d]&&kt(this.g[d],new Mt(a)))}};function tu(a){a.h=new $t(a.I.g,a.i.email);var b=Vi("gse");a.h.client=b;a.h.h=a.Ii.bind(a);a.h.update()}
function uu(a,b){var c=new B,d=b.email||"";if(a.i&&a.i.email==d)return J(a.logger,"already running for "+d),c.callback(a.i),c;a.i=b;a.i.updated=z();d?(a.logger.info(d+" login to YDN server"),jq(a),hp(a.I,b.Id.$t),tu(a),lp(a.I).w(function(a){a=a||[];for(var b=0;b<a.length;b++)a[b]&&pu(this,{domain:a[b]})},a),c.callback(a.i),a.isLogin()?(a.j.S(iu,!0),chrome.browserAction.setTitle({title:"Yathit 0.10.11 Ready"})):(a.j.S(iu,!1),chrome.browserAction.setTitle({title:"Login required."}))):(a.logger.info("Not login to YDN server"),
c.callback(a.i),a.j.S(iu,!1),chrome.browserAction.setTitle({title:"Login required."}));return c}function vu(a){var b=new B;mq().request(new Xi("/token","DELETE")).execute(function(a,d){aj(d)?(this.l=this.u=null,b.callback(null)):b.F("error "+d.Qa())},a);return b}
function wu(a,b){var c=x(b)?b:{last_login:"1"},d=mq(),c=new Xi("/audit","GET",c),e=new B;d.request(c).execute(function(a,b){if(aj(b)){if(a.LastLoginRecord){var c=a.LastLoginRecord;if(c.timestamp){var d;d=c.timestamp-z();d=Math.abs(d);if(6E4>d)d="0 minutes";else{var m=Math.floor(d/864E5);d%=864E5;var n=Math.floor(d/36E5),p=Math.floor(d%36E5/6E4),r=Ze(m),s=Ze(n),w=Ze(p);d=m*(n+p)?" ":"";var y=n*p?" ":"",m=Nf("{COUNT, plural, =0 {}=1 {{TEXT} day}other {{TEXT} days}}",m,r),n=Nf("{COUNT, plural, =0 {}=1 {{TEXT} hour}other {{TEXT} hours}}",
n,s),p=Nf("{COUNT, plural, =0 {}=1 {{TEXT} minute}other {{TEXT} minutes}}",p,w);d=m+(d+(n+(y+p)))}c.ago=d}}e.callback(a)}else e.F(b)},a);return e}
function pk(a,b){if(a.l)return a.l;if(a.u&&a.u.expires>z())return ac(a.u);if(!a.isLogin())return bc(Error("Not login"));a.l=new B;var c={url:b||chrome.extension.getURL("option-page.html")},c=new Xi("/token","GET",c);mq().request(c).execute(function(a,b){if(aj(b)){var c=a.Tokens[0];c.has_token?(c.expires=1E3*c.expires_in+z(),this.u=c,this.l.callback(c)):this.l.F(c)}else this.u=null,this.l.F(b);this.l=null},a);return a.l}
function xu(a){function b(a){return Bb(c,function(b){return b.email==a})}for(var c=[],d=0;d<a.length;d++){var e=a[d].user.raw;0<=b(e.name)||c.push({email:e.name,region:a[d].region,Gj:new Date(a[d].timestamp)})}return c}h.Nh=function(a){var b=new Xi("/admin");kq().request(b).execute(function(b){if(a)a(b);else{b=b.LoginRecords;var d=xu(b);window.console.table(d);window.console.info(b.length+" records since "+(new Date(b[b.length-1].timestamp)).toLocaleDateString())}},this)};
function mu(a,b){delete b.id;for(var c in a.o)a.o[c].port.postMessage(b)}h.isLogin=function(){return!!this.i&&this.i.is_login};function yu(a,b){if(a.p)return a.p;a.p=bj(a.D,b).w(function(a){return uu(this,a).A(function(){var a={event:"login","install-id":hq};if(this.isLogin()){var b=this;a.user=this.i.email;a.status="ok";setTimeout(function(){b.p=null},9E5)}else a.status="fail",this.p=null;Sj(a)},function(a){this.logger.info("Attempting to login YDN server fail: "+xi(a))},this)},a);return a.p}
function zu(a){a.p=null;a.i=null;a.j.S(iu,!1)}h.toString=function(){return"SugarApp:0.10.11"};function Au(){lu.call(this);Bu(this)}A(Au,lu);Au.prototype.logger=L("ydn.crm.app.EventPage");
function Cu(a,b,c){var d=c.req;c.done=!0;var e=null!=c.data?c.data:{};J(a.logger,"service req: "+d+":"+c.id);if("app-setting"==d)c.data=q.localStorage.getItem("app-setting"),b.postMessage(c);else if("echo"==d)J(a.logger,"resp: "+d+":"+c.id),b.postMessage(c);else if("export-record"==d)ru(a,e).A(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="failed to create a new entry";b.postMessage(this)},c);else if("feed-log"==d){var f=
e.offset||0,e=e.limit||100;yp.g.values("db-logger",null,e||100,f||0,!0).fa(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c)}else if("feed-log-info"==d)f=e.offset||0,e=e.limit||100,Ap(e,f).fa(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("gdata-fetch"==d)e=c.data,"contact"==e?a.h?Vt(a.h).A(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):(c.error="gdata not ready",
b.postMessage(c)):(c.error="invalid kind "+e,b.postMessage(c));else if("gdata-list-contact-by-email"==d)au(a.h,c.data).w(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("gdata-token"==d)pk(a,c.data).fa(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("gdata-token-revoke"==d)vu(a).A(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){J(a.logger,"resp: "+
this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("list-sugarcrm"==d){e=[];for(f in a.g)e.push(dt(a.g[f]));J(a.logger,"resp: "+c.req+":"+c.id);c.data=e;b.postMessage(c)}else"log"==d?(Sj(c.data),b.postMessage(c)):"login-info"==d?q.navigator.onLine?yu(a,c.data).A(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="InvalidLoginError:"+(a&&a instanceof Error?a:"");b.postMessage(this)},c):(c.data=a.i,b.postMessage(c)):
"logged-in"==d?(yu(a,null).w(function(b){mu(a,{req:d,info:b})}),b.postMessage(c)):"logged-out"==d?(zu(a),mu(a,{req:d}),b.postMessage(c)):"new-entry"==d?x(c.data)?Yt(a.h,c.data).A(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="failed to create a new entry";b.postMessage(this)},c):(c.error="Invalid gdata entry data",b.postMessage(c)):"new-sugarcrm"==d?pu(a,c.data).A(function(){J(a.logger,"resp: "+this.req+":"+this.id);this.data=
!0;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):"remove-sugar"==d?su(a,c.data).fa(function(a){this.data=a;b.postMessage(this)},c):"server-audit-log"==d?wu(a,e).A(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):"sugar-server-info"==d?(e=c.data,e=/https?:/.test(e)?new Be(e):De(new Be,e),(e=a.g[e.Ub])?ct(e).w(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c):pt(c.data).A(function(c){J(a.logger,
"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){J(a.logger,"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},c)):"user-setting"==d?op().w(function(a){this.data=a;b.postMessage(this)},c):H(a.logger,"Main channel unknown req: "+d)}
function Du(a,b,c,d){var e=d.req;d.done=!0;J(a.logger,"sugar service req: "+c+":"+e+":"+d.id);if(a.isLogin())if("echo"==e)b.postMessage(d);else if("import-gdata"==e){var f=d.data,g=f?f["gdata-id"]:"";g?qu(a,f.module,g,c).A(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},d):(H(a.logger,"resp error: "+e+":"+d.id),d.error="gdata id required",b.postMessage(d))}else"link"==e?(c=a.h,(e=d.data["gdata-id"])?cu(c,e,d.data["external-id"]).A(function(a){this.data=a;
b.postMessage(this)},function(c){H(a.logger,"error linking gdata "+this.req+":"+this.id);this.error=c.name+": "+c.message;b.postMessage(this)},d):(d.error="gdata-id not required",b.postMessage(d))):"login"==e?pu(a,d.data).A(function(c){this.data=c;b.postMessage(this);ou(a)},function(a){this.error=a;b.postMessage(this)},d):"sync-entry"==e?(e=d.data,a.h.get(e).A(function(c){c?new Mt(c):(c="GData entry "+this.data+" not found.",J(a.logger,c),this.error=c,b.postMessage(this))},function(c){J(a.logger,
"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},d)):st(c,e,d.data).A(function(c){J(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){J(a.logger,"resp error: "+this.req+":"+this.id+" "+(c&&c instanceof Error?c.name+" "+c.message:c));this.error=c;b.postMessage(this)},d);else d.error="Not login",b.postMessage(d)}
function Eu(a){var b=!1,c;for(c in a.o)if("gmail"==a.o[c].group){b=!0;break}var d=!1;for(c in a.g)if(a.g[c].isLogin()){d=!0;break}chrome.browserAction.setTitle({title:"Yathit 0.10.11"});a.j.S(fu,!0);a.j.S(iu,a.isLogin());a.j.S(gu,d);a.j.S(hu,b)}Au.prototype.N=function(){var a=Object.keys(this.g)[0];return{du:this.Nh.bind(this),sugars:this.g,s0:a?this.g[a]:null,gdata:this.h,ports:this.o,so:nq,user_info:this.i}};
function Bu(a){var b="";chrome.runtime.onMessage.addListener(function(c,d,e){var f=d.url;f&&/https?:\/\/mail.google.com/.test(f)?(d=c?c.req:null,"inject"==d&&b!=c.id?(b=c.id,chrome.storage.local.get("ydn-crm-src",function(b){var c=b["ydn-crm-src"];fe(a.logger,"injecting "+c+" to "+f);chrome.tabs.executeScript(null,{file:c},function(){chrome.tabs.executeScript(null,{code:"app = runInjApp();"},function(){fe(a.logger,c+" injected")})})}),e(c)):"attach"==d&&(c=c.parent,fe(a.logger,"attaching crm-ex/sidebar.html to "+
c+" in "+f),chrome.tabs.executeScript(null,{code:'var parent = document.getElementById("'+c+'");var f = document.createElement("iframe"); f.src = "crm-ex/sidebar.html"; parent.appendChild(f);'},function(){fe(a.logger,"crm-ex/sidebar.html attached");e("crm-ex/sidebar.html")}))):fe(a.logger,"invalid sender "+f)});chrome.runtime.onConnect.addListener(function(b){var d=b.sender.url,e=b.name.substr(0,b.name.lastIndexOf("-"));Cb(we,e)?(fe(a.logger,"Channel "+b.name+" connected for "+d),a.o[b.name]={name:b.name,
group:e,port:b},Eu(a),b.onMessage.addListener(function(d){if(d&&x(d)){if("close"==d.req)a.logger.info("closing "+b.name),delete a.o[b.name],b.disconnect(),Eu(a);else if(!d.id){H(a.logger,"Unknown group in pipe info "+b.name);return}if("sugarcrm"==d.group){var e=d.name,k=a.g[e];k?Du(a,b,k,d):H(a.logger,"SugarCRM instance "+e+" not found.")}else"gmail"!=d.group&&"dev"!=d.group&&"hostper"!=d.group&&"popup"!=d.group&&"options"!=d.group&&Cu(a,b,d)}else H(a.logger,"invalid message package: "+d)}),b.onDisconnect.addListener(function(){fe(a.logger,
"disconnected "+b.name);delete a.o[b.name];Eu(a)})):H(a.logger,"channel "+b.name+" ignored from "+d)});fe(a.logger,"event page start listening incoming connection")};qa("loadApp",function(a){chrome.storage.local.get("ydn-crm-track",function(b){var c=b["ydn-crm-track"];b="jsc/ydn.crm-0.10.11.js";navigator.onLine&&"Edge"==c?b="https://ydn-src-1.storage.googleapis.com/jsc/ydn.crm-edge.js":"Beta"==c?b="jsc/ydn.crm-0.10.11.js":"RC"==c&&(b="jsc/ydn.crm-0.10.11.js");c=document.createElement("script");c.onload=a;c.type="text/javascript";var d={};d["ydn-crm-src"]=b;chrome.storage.local.set(d);c.src=b;document.getElementsByTagName("head")[0].appendChild(c)})});function Fu(a){E.call(this,"navigate");this.h=a}A(Fu,E);function Gu(a){pd.call(this);this.g=a||window;cd(this.g,"popstate",this.qe,!1,this);cd(this.g,"hashchange",this.qe,!1,this)}A(Gu,pd);h=Gu.prototype;h.gf=!1;h.Wi="/";h.setEnabled=function(a){a!=this.gf&&(this.gf=a)&&this.dispatchEvent(new Fu(this.getToken()))};h.getToken=function(){var a=this.g.location.href,b=a.indexOf("#");return 0>b?"":a.substring(b+1)};h.H=function(){kd(this.g,"popstate",this.qe,!1,this);kd(this.g,"hashchange",this.qe,!1,this)};h.qe=function(){this.gf&&this.dispatchEvent(new Fu(this.getToken()))};function Hu(){}da(Hu);Hu.prototype.g=0;function Iu(a){return":"+(a.g++).toString(36)};function X(a){pd.call(this);this.g=a||oh();this.Na=Ju;this.u=null;this.Z=!1;this.C=null;this.Wb=void 0;this.o=this.j=this.l=this.sa=null;this.Le=!1}A(X,pd);X.prototype.Bh=Hu.T();var Ju=null;
function Ku(a,b){switch(a){case 1:return b?"disable":"enable";case 2:return b?"highlight":"unhighlight";case 4:return b?"activate":"deactivate";case 8:return b?"select":"unselect";case 16:return b?"check":"uncheck";case 32:return b?"focus":"blur";case 64:return b?"open":"close"}throw Error("Invalid component state");}h=X.prototype;h.G=function(){return this.u||(this.u=Iu(this.Bh))};function Lu(a,b){if(a.l&&a.l.o){var c=a.l.o,d=a.u;d in c&&delete c[d];Oc(a.l.o,b,a)}a.u=b}h.n=function(){return this.C};
function Y(a){a.Wb||(a.Wb=new Of(a));return a.Wb}function Mu(a,b){if(a==b)throw Error("Unable to set parent component");if(b&&a.l&&a.u&&Nu(a.l,a.u)&&a.l!=b)throw Error("Unable to set parent component");a.l=b;X.m.Sf.call(a,b)}h.getParent=function(){return this.l};h.Sf=function(a){if(this.l&&this.l!=a)throw Error("Method not supported");X.m.Sf.call(this,a)};h.P=function(){this.C=this.g.createElement("div")};h.render=function(a){Ou(this,a)};
function Ou(a,b,c){if(a.Z)throw Error("Component already rendered");a.C||a.P();b?b.insertBefore(a.C,c||null):a.g.g.body.appendChild(a.C);a.l&&!a.l.Z||a.J()}function Pu(a,b){if(a.Z)throw Error("Component already rendered");if(b&&a.be(b)){a.Le=!0;var c=qh(b);a.g&&a.g.g==c||(a.g=oh(b));a.lb(b);a.J()}else throw Error("Invalid element to decorate");}h.be=function(){return!0};h.lb=function(a){this.C=a};h.J=function(){this.Z=!0;Qu(this,function(a){!a.Z&&a.n()&&a.J()})};
h.pa=function(){Qu(this,function(a){a.Z&&a.pa()});this.Wb&&this.Wb.removeAll();this.Z=!1};h.H=function(){this.Z&&this.pa();this.Wb&&(this.Wb.ca(),delete this.Wb);Qu(this,function(a){a.ca()});!this.Le&&this.C&&Gh(this.C);this.l=this.sa=this.C=this.o=this.j=null;X.m.H.call(this)};h.t=function(){return this.sa};h.na=function(a){this.sa=a};h.W=function(a,b){this.zd(a,Ru(this),b)};
h.zd=function(a,b,c){if(a.Z&&(c||!this.Z))throw Error("Component already rendered");if(0>b||b>Ru(this))throw Error("Child component index out of bounds");this.o&&this.j||(this.o={},this.j=[]);if(a.getParent()==this){var d=a.G();this.o[d]=a;Eb(this.j,a)}else Oc(this.o,a.G(),a);Mu(a,this);Ib(this.j,b,0,a);a.Z&&this.Z&&a.getParent()==this?(c=this.R(),c.insertBefore(a.n(),c.childNodes[b]||null)):c?(this.C||this.P(),b=Z(this,b+1),Ou(a,this.R(),b?b.C:null)):this.Z&&!a.Z&&a.C&&a.C.parentNode&&1==a.C.parentNode.nodeType&&
a.J()};h.R=function(){return this.C};function Su(a){null==a.Na&&(a.Na=Aj(a.Z?a.C:a.g.g.body));return a.Na}function Ru(a){return a.j?a.j.length:0}function Nu(a,b){return a.o&&b?Pc(a.o,b)||null:null}function Z(a,b){return a.j?a.j[b]||null:null}function Qu(a,b,c){a.j&&vb(a.j,b,c)}function Tu(a,b){return a.j&&b?tb(a.j,b):-1}
h.removeChild=function(a,b){if(a){var c=v(a)?a:a.G();a=Nu(this,c);if(c&&a){var d=this.o;c in d&&delete d[c];Eb(this.j,a);b&&(a.pa(),a.C&&Gh(a.C));Mu(a,null)}}if(!a)throw Error("Child is not in parent component");return a};function Uu(a,b,c,d,e){if(!(C||oc&&vc("525")))return!0;if(jc&&e)return Vu(a);if(e&&!d)return!1;ha(b)&&(b=Wu(b));if(!c&&(17==b||18==b||jc&&91==b))return!1;if(oc&&d&&c)switch(a){case 220:case 219:case 221:case 192:case 186:case 189:case 187:case 188:case 190:case 191:case 192:case 222:return!1}if(C&&d&&b==a)return!1;switch(a){case 13:return!(C&&C&&9<=xc);case 27:return!oc}return Vu(a)}
function Vu(a){if(48<=a&&57>=a||96<=a&&106>=a||65<=a&&90>=a||oc&&0==a)return!0;switch(a){case 32:case 63:case 107:case 109:case 110:case 111:case 186:case 59:case 189:case 187:case 61:case 188:case 190:case 191:case 192:case 222:case 219:case 220:case 221:return!0;default:return!1}}function Wu(a){if(nc)a=Xu(a);else if(jc&&oc)a:switch(a){case 93:a=91;break a}return a}
function Xu(a){switch(a){case 61:return 187;case 59:return 186;case 173:return 189;case 224:return 91;case 0:return 224;default:return a}};function Yu(a,b){pd.call(this);a&&Zu(this,a,b)}A(Yu,pd);h=Yu.prototype;h.C=null;h.je=null;h.Cf=null;h.ke=null;h.fb=-1;h.ac=-1;h.Ne=!1;
var $u={3:13,12:144,63232:38,63233:40,63234:37,63235:39,63236:112,63237:113,63238:114,63239:115,63240:116,63241:117,63242:118,63243:119,63244:120,63245:121,63246:122,63247:123,63248:44,63272:46,63273:36,63275:35,63276:33,63277:34,63289:144,63302:45},av={Up:38,Down:40,Left:37,Right:39,Enter:13,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"U+007F":46,Home:36,End:35,PageUp:33,PageDown:34,Insert:45},bv=C||oc&&vc("525"),cv=jc&&nc;h=Yu.prototype;
h.qi=function(a){oc&&(17==this.fb&&!a.ctrlKey||18==this.fb&&!a.altKey||jc&&91==this.fb&&!a.metaKey)&&(this.ac=this.fb=-1);-1==this.fb&&(a.ctrlKey&&17!=a.g?this.fb=17:a.altKey&&18!=a.g?this.fb=18:a.metaKey&&91!=a.g&&(this.fb=91));bv&&!Uu(a.g,this.fb,a.shiftKey,a.ctrlKey,a.altKey)?this.handleEvent(a):(this.ac=Wu(a.g),cv&&(this.Ne=a.altKey))};h.ri=function(a){this.ac=this.fb=-1;this.Ne=a.altKey};
h.handleEvent=function(a){var b=a.h,c,d,e=b.altKey;C&&"keypress"==a.type?c=this.ac:oc&&"keypress"==a.type?c=this.ac:mc?c=this.ac:(c=b.keyCode||this.ac,d=b.charCode||0,cv&&(e=this.Ne),jc&&63==d&&224==c&&(c=191));d=c=Wu(c);var f=b.keyIdentifier;c?63232<=c&&c in $u?d=$u[c]:25==c&&a.shiftKey&&(d=9):f&&f in av&&(d=av[f]);this.fb=d;a=new dv(d,0,0,b);a.altKey=e;this.dispatchEvent(a)};h.n=function(){return this.C};
function Zu(a,b,c){a.ke&&ev(a);a.C=b;a.je=cd(a.C,"keypress",a,c);a.Cf=cd(a.C,"keydown",a.qi,c,a);a.ke=cd(a.C,"keyup",a.ri,c,a)}function ev(a){a.je&&(ld(a.je),ld(a.Cf),ld(a.ke),a.je=null,a.Cf=null,a.ke=null);a.C=null;a.fb=-1;a.ac=-1}h.H=function(){Yu.m.H.call(this);ev(this)};function dv(a,b,c,d){Cc.call(this,d);this.type="key";this.g=a}A(dv,Cc);var fv;function gv(a,b){b?a.setAttribute("role",b):a.removeAttribute("role")}function hv(a,b,c){fa(c)&&(c=c.join(" "));var d="aria-"+b;""===c||void 0==c?(fv||(fv={atomic:!1,autocomplete:"none",dropeffect:"none",haspopup:!1,live:"off",multiline:!1,multiselectable:!1,orientation:"vertical",readonly:!1,relevant:"additions text",required:!1,sort:"none",busy:!1,disabled:!1,hidden:!1,invalid:"false"}),c=fv,b in c?a.setAttribute(d,c[b]):a.removeAttribute(d)):a.setAttribute(d,c)}
function iv(a,b){var c=a.getAttribute("aria-"+b);return null==c||void 0==c?"":String(c)};function jv(a){if(a.classList)return a.classList;a=a.className;return v(a)&&a.match(/\S+/g)||[]}function kv(a,b){return a.classList?a.classList.contains(b):Cb(jv(a),b)}function lv(a,b){a.classList?a.classList.add(b):kv(a,b)||(a.className+=0<a.className.length?" "+b:b)}function mv(a,b){if(a.classList)vb(b,function(b){lv(a,b)});else{var c={};vb(jv(a),function(a){c[a]=!0});vb(b,function(a){c[a]=!0});a.className="";for(var d in c)a.className+=0<a.className.length?" "+d:d}}
function nv(a,b){a.classList?a.classList.remove(b):kv(a,b)&&(a.className=wb(jv(a),function(a){return a!=b}).join(" "))}function ov(a,b){a.classList?vb(b,function(b){nv(a,b)}):a.className=wb(jv(a),function(a){return!Cb(b,a)}).join(" ")};function pv(){}var qv;da(pv);var rv={button:"pressed",checkbox:"checked",menuitem:"selected",menuitemcheckbox:"checked",menuitemradio:"checked",radio:"checked",tab:"selected",treeitem:"selected"};h=pv.prototype;h.sc=function(){};h.Ea=function(a){var b=a.g.s("div",sv(this,a).join(" "),a.qa());tv(this,a,b);return b};h.ta=function(a){return a};function uv(a,b,c){if(a=a.n?a.n():a){var d=[b];C&&!vc("7")&&(d=vv(jv(a),b),d.push(b));(c?mv:ov)(a,d)}}h.ce=function(){return!0};
h.ra=function(a,b){b.id&&Lu(a,b.id);var c=this.ta(b);c&&c.firstChild?wv(a,c.firstChild.nextSibling?Gb(c.childNodes):c.firstChild):a.Mb=null;var d=0,e=this.B(),f=this.B(),g=!1,k=!1,c=!1,l=Gb(jv(b));vb(l,function(a){g||a!=e?k||a!=f?d|=this.ef(a):k=!0:(g=!0,f==e&&(k=!0))},this);a.Zb=d;g||(l.push(e),f==e&&(k=!0));k||l.push(f);var m=a.Xe;m&&l.push.apply(l,m);if(C&&!vc("7")){var n=vv(l);0<n.length&&(l.push.apply(l,n),c=!0)}if(!g||!k||m||c)b.className=l.join(" ");tv(this,a,b);return b};
h.de=function(a){Su(a)&&this.rf(a.n(),!0);a.isEnabled()&&this.Lc(a,a.Fa)};function xv(a,b,c){if(a=c||a.sc())c=b.getAttribute("role")||null,a!=c&&gv(b,a)}function tv(a,b,c){b.Fa||hv(c,"hidden",!b.Fa);b.isEnabled()||a.sb(c,1,!b.isEnabled());yv(b,8)&&a.sb(c,8,zv(b,8));yv(b,16)&&a.sb(c,16,zv(b,16));yv(b,64)&&a.sb(c,64,zv(b,64))}h.ee=function(a,b){Hj(a,!b,!C&&!mc)};h.rf=function(a,b){uv(a,this.B()+"-rtl",b)};h.qf=function(a){var b;return yv(a,32)&&(b=Av(a))?Oh(b)&&Ph(b):!1};
h.Lc=function(a,b){var c;if(yv(a,32)&&(c=Av(a))){if(!b&&zv(a,32)){try{c.blur()}catch(d){}zv(a,32)&&a.fe(null)}(Oh(c)&&Ph(c))!=b&&Nh(c,b)}};h.S=function(a,b,c){var d=a.n();if(d){var e=this.$c(b);e&&uv(a,e,c);this.sb(d,b,c)}};h.sb=function(a,b,c){qv||(qv={1:"disabled",8:"selected",16:"checked",64:"expanded"});b=qv[b];var d=a.getAttribute("role")||null;d&&(d=rv[d]||b,b="checked"==b||"selected"==b?d:b);b&&hv(a,b,c)};
h.Xb=function(a,b){var c=this.ta(a);if(c&&(Eh(c),b))if(v(b))Kh(c,b);else{var d=function(a){if(a){var b=qh(c);c.appendChild(v(a)?b.createTextNode(a):a)}};u(b)?vb(b,d):!fa(b)||"nodeType"in b?d(b):vb(Gb(b),d)}};h.Kg=function(a){return a.n()};h.B=function(){return"goog-control"};function sv(a,b){var c=a.B(),d=[c],e=a.B();e!=c&&d.push(e);c=b.Zb;for(e=[];c;){var f=c&-c;e.push(a.$c(f));c&=~f}d.push.apply(d,e);(c=b.Xe)&&d.push.apply(d,c);C&&!vc("7")&&d.push.apply(d,vv(d));return d}
function vv(a,b){var c=[];b&&(a=a.concat([b]));vb([],function(d){!zb(d,pa(Cb,a))||b&&!Cb(d,b)||c.push(d.join("_"))});return c}h.$c=function(a){this.g||Bv(this);return this.g[a]};h.ef=function(a){this.i||(this.g||Bv(this),this.i=Qc(this.g));a=parseInt(this.i[a],10);return isNaN(a)?0:a};function Bv(a){var b=a.B();Qa(b.replace(/\xa0|\s/g," ")," ");a.g={1:b+"-disabled",2:b+"-hover",4:b+"-active",8:b+"-selected",16:b+"-checked",32:b+"-focused",64:b+"-open"}};function Cv(a,b){if(!ia(a))throw Error("Invalid component class "+a);if(!ia(b))throw Error("Invalid renderer class "+b);var c=ja(a);Dv[c]=b}function Ev(a,b){if(!a)throw Error("Invalid class name "+a);if(!ia(b))throw Error("Invalid decorator function "+b);Fv[a]=b}var Dv={},Fv={};function Gv(a,b,c){X.call(this,c);if(!b){b=this.constructor;for(var d;b;){d=ja(b);if(d=Dv[d])break;b=b.m?b.m.constructor:null}b=d?ia(d.T)?d.T():new d:null}this.i=b;this.Mb=t(a)?a:null}A(Gv,X);h=Gv.prototype;h.Mb=null;h.Zb=0;h.rd=39;h.hc=255;h.Cc=0;h.Fa=!0;h.Xe=null;h.vf=!0;h.Cd=!1;h.sf=null;function Hv(a,b){a.Z&&b!=a.vf&&Iv(a,b);a.vf=b}function Av(a){return a.i.Kg(a)}h.P=function(){var a=this.i.Ea(this);this.C=a;xv(this.i,a,this.fd());this.Cd||this.i.ee(a,!1);this.Fa||(Q(a,!1),a&&hv(a,"hidden",!0))};
h.fd=function(){return this.sf};h.R=function(){return this.i.ta(this.n())};h.be=function(a){return this.i.ce(a)};h.lb=function(a){this.C=a=this.i.ra(this,a);xv(this.i,a,this.fd());this.Cd||this.i.ee(a,!1);this.Fa="none"!=a.style.display};h.J=function(){Gv.m.J.call(this);this.i.de(this);if(this.rd&-2&&(this.vf&&Iv(this,!0),yv(this,32))){var a=Av(this);if(a){var b=this.p||(this.p=new Yu);Zu(b,a);Y(this).listen(b,"key",this.Ya).listen(a,"focus",this.Vh).listen(a,"blur",this.fe)}}};
function Iv(a,b){var c=Y(a),d=a.n();b?(c.listen(d,"mouseover",a.ld).listen(d,"mousedown",a.hd).listen(d,"mouseup",a.uc).listen(d,"mouseout",a.wf),a.kd!=ca&&c.listen(d,"contextmenu",a.kd),C&&c.listen(d,"dblclick",a.Mg)):(c.ka(d,"mouseover",a.ld).ka(d,"mousedown",a.hd).ka(d,"mouseup",a.uc).ka(d,"mouseout",a.wf),a.kd!=ca&&c.ka(d,"contextmenu",a.kd),C&&c.ka(d,"dblclick",a.Mg))}h.pa=function(){Gv.m.pa.call(this);this.p&&ev(this.p);this.Fa&&this.isEnabled()&&this.i.Lc(this,!1)};
h.H=function(){Gv.m.H.call(this);this.p&&(this.p.ca(),delete this.p);delete this.i;this.Xe=this.Mb=null};h.qa=function(){return this.Mb};function wv(a,b){a.Mb=b}h.Gb=function(){var a=this.qa();if(!a)return"";a=v(a)?a:u(a)?xb(a,Sh).join(""):Qh(a);return Aa(a)};h.Yb=function(a,b){if(b||this.Fa!=a&&this.dispatchEvent(a?"show":"hide")){var c=this.n();c&&(Q(c,a),c&&hv(c,"hidden",!a));this.isEnabled()&&this.i.Lc(this,a);this.Fa=a;return!0}return!1};h.isEnabled=function(){return!zv(this,1)};
h.setEnabled=function(a){var b=this.getParent();b&&"function"==typeof b.isEnabled&&!b.isEnabled()||!Jv(this,1,!a)||(a||(Kv(this,!1),this.Ia(!1)),this.Fa&&this.i.Lc(this,a),this.S(1,!a))};h.Ia=function(a){Jv(this,2,a)&&this.S(2,a)};function Kv(a,b){Jv(a,4,b)&&a.S(4,b)}h.Rc=function(a){Jv(this,8,a)&&this.S(8,a)};h.oa=function(a){Jv(this,64,a)&&this.S(64,a)};function zv(a,b){return!!(a.Zb&b)}h.S=function(a,b){yv(this,a)&&b!=zv(this,a)&&(this.i.S(this,a,b),this.Zb=b?this.Zb|a:this.Zb&~a)};
function yv(a,b){return!!(a.rd&b)}h.va=function(a,b){if(this.Z&&zv(this,a)&&!b)throw Error("Component already rendered");!b&&zv(this,a)&&this.S(a,!1);this.rd=b?this.rd|a:this.rd&~a};function Lv(a,b){return!!(a.hc&b)&&yv(a,b)}function Jv(a,b,c){return yv(a,b)&&zv(a,b)!=c&&(!(a.Cc&b)||a.dispatchEvent(Ku(b,c)))&&!a.I}h.ld=function(a){!Mv(a,this.n())&&this.dispatchEvent("enter")&&this.isEnabled()&&Lv(this,2)&&this.Ia(!0)};
h.wf=function(a){!Mv(a,this.n())&&this.dispatchEvent("leave")&&(Lv(this,4)&&Kv(this,!1),Lv(this,2)&&this.Ia(!1))};h.kd=ca;function Mv(a,b){return!!a.o&&Jh(b,a.o)}h.hd=function(a){this.isEnabled()&&(Lv(this,2)&&this.Ia(!0),Ec(a)&&(Lv(this,4)&&Kv(this,!0),this.i.qf(this)&&Av(this).focus()));!this.Cd&&Ec(a)&&a.preventDefault()};h.uc=function(a){this.isEnabled()&&(Lv(this,2)&&this.Ia(!0),zv(this,4)&&this.yb(a)&&Lv(this,4)&&Kv(this,!1))};h.Mg=function(a){this.isEnabled()&&this.yb(a)};
h.yb=function(a){if(Lv(this,16)){var b=!zv(this,16);Jv(this,16,b)&&this.S(16,b)}Lv(this,8)&&this.Rc(!0);Lv(this,64)&&this.oa(!zv(this,64));b=new E("action",this);a&&(b.altKey=a.altKey,b.ctrlKey=a.ctrlKey,b.metaKey=a.metaKey,b.shiftKey=a.shiftKey,b.u=a.u);return this.dispatchEvent(b)};h.Vh=function(){Lv(this,32)&&Jv(this,32,!0)&&this.S(32,!0)};h.fe=function(){Lv(this,4)&&Kv(this,!1);Lv(this,32)&&Jv(this,32,!1)&&this.S(32,!1)};
h.Ya=function(a){return this.Fa&&this.isEnabled()&&this.Mc(a)?(a.preventDefault(),a.j(),!0):!1};h.Mc=function(a){return 13==a.g&&this.yb(a)};Cv(Gv,pv);Ev("goog-control",function(){return new Gv(null)});function Nv(){}A(Nv,pv);da(Nv);h=Nv.prototype;h.B=function(){return"goog-tab"};h.sc=function(){return"tab"};h.Ea=function(a){var b=Nv.m.Ea.call(this,a);(a=a.Lb())&&this.Ja(b,a);return b};h.ra=function(a,b){b=Nv.m.ra.call(this,a,b);var c=this.Lb(b);c&&a.we(c);zv(a,8)&&(c=a.getParent())&&ia(c.Bc)&&(a.S(8,!1),c.Bc(a));return b};h.Lb=function(a){return a.title||""};h.Ja=function(a,b){a&&(a.title=b||"")};function Ov(a,b,c){Gv.call(this,a,b||Nv.T(),c);this.va(8,!0);this.Cc|=9}A(Ov,Gv);Ov.prototype.Lb=function(){return this.h};Ov.prototype.Ja=function(a){this.i.Ja(this.n(),a);this.we(a)};Ov.prototype.we=function(a){this.h=a};Ev("goog-tab",function(){return new Ov(null)});function Pv(a){this.g=a}da(Pv);function Qv(a,b){a&&(a.tabIndex=b?0:-1)}h=Pv.prototype;h.mf=function(a){return"DIV"==a.tagName};function Rv(a,b,c){c.id&&Lu(b,c.id);var d=a.B(),e=!1,f=jv(c);f&&vb(f,function(a){a==d?e=!0:a&&this.Tf(b,a,d)},a);e||lv(c,d);Sv(a,b,c);return c}h.Tf=function(a,b,c){b==c+"-disabled"?a.setEnabled(!1):b==c+"-horizontal"?Tv(a,Uv):b==c+"-vertical"&&Tv(a,Vv)};
function Sv(a,b,c){if(c)for(var d=c.firstChild,e;d&&d.parentNode==c;){e=d.nextSibling;if(1==d.nodeType){var f=a.ad(d);f&&(f.C=d,b.isEnabled()||f.setEnabled(!1),b.W(f),Pu(f,d))}else d.nodeValue&&""!=Ba(d.nodeValue)||c.removeChild(d);d=e}}h.ad=function(a){a:{var b;a=jv(a);for(var c=0,d=a.length;c<d;c++)if(b=a[c],b=b in Fv?Fv[b]():null){a=b;break a}a=null}return a};h.of=function(a){a=a.n();Hj(a,!0,nc);C&&(a.hideFocus=!0);var b=this.g;b&&gv(a,b)};h.B=function(){return"goog-container"};
h.nf=function(a){var b=this.B(),c=[b,a.cc==Uv?b+"-horizontal":b+"-vertical"];a.isEnabled()||c.push(b+"-disabled");return c};h.Dg=function(){return Vv};function Wv(a,b,c){X.call(this,c);this.vb=b||Pv.T();this.cc=a||this.vb.Dg()}A(Wv,X);var Uv="horizontal",Vv="vertical";h=Wv.prototype;h.Df=null;h.pc=null;h.vb=null;h.cc=null;h.za=!0;h.oc=!0;h.Hc=!0;h.Za=-1;h.ua=null;h.nb=!1;h.Cb=null;function Xv(a){return a.Df||a.n()}h.P=function(){this.C=this.g.s("div",this.vb.nf(this).join(" "))};h.R=function(){return this.n()};h.be=function(a){return this.vb.mf(a)};h.lb=function(a){this.C=Rv(this.vb,this,a);"none"==a.style.display&&(this.za=!1)};
h.J=function(){Wv.m.J.call(this);Qu(this,function(a){a.Z&&Yv(this,a)},this);var a=this.n();this.vb.of(this);this.qc(this.za,!0);Y(this).listen(this,"enter",this.uf).listen(this,"highlight",this.Sh).listen(this,"unhighlight",this.Uh).listen(this,"open",this.yi).listen(this,"close",this.bi).listen(a,"mousedown",this.Th).listen(qh(a),"mouseup",this.hi).listen(a,["mousedown","mouseup","mouseover","mouseout","contextmenu"],this.$h);this.Hc&&Zv(this,!0)};
function Zv(a,b){var c=Y(a),d=Xv(a);b?c.listen(d,"focus",a.ed).listen(d,"blur",a.Jg).listen(a.pc||(a.pc=new Yu(Xv(a))),"key",a.Ya):c.ka(d,"focus",a.ed).ka(d,"blur",a.Jg).ka(a.pc||(a.pc=new Yu(Xv(a))),"key",a.Ya)}h.pa=function(){this.Qb(-1);this.ua&&this.ua.oa(!1);this.nb=!1;Wv.m.pa.call(this)};h.H=function(){Wv.m.H.call(this);this.pc&&(this.pc.ca(),this.pc=null);this.vb=this.ua=this.Cb=this.Df=null};h.uf=function(){return!0};
h.Sh=function(a){var b=Tu(this,a.target);if(-1<b&&b!=this.Za){var c=$v(this);c&&c.Ia(!1);this.Za=b;c=$v(this);this.nb&&Kv(c,!0);this.ua&&c!=this.ua&&(yv(c,64)?c.oa(!0):this.ua.oa(!1))}b=this.n();null!=a.target.n()&&hv(b,"activedescendant",a.target.n().id)};h.Uh=function(a){a.target==$v(this)&&(this.Za=-1);this.n().removeAttribute("aria-activedescendant")};h.yi=function(a){(a=a.target)&&a!=this.ua&&a.getParent()==this&&(this.ua&&this.ua.oa(!1),this.ua=a)};
h.bi=function(a){a.target==this.ua&&(this.ua=null)};h.Th=function(a){this.oc&&(this.nb=!0);var b=Xv(this);b&&Oh(b)&&Ph(b)?b.focus():a.preventDefault()};h.hi=function(){this.nb=!1};h.$h=function(a){var b;a:{b=a.target;if(this.Cb)for(var c=this.n();b&&b!==c;){var d=b.id;if(d in this.Cb){b=this.Cb[d];break a}b=b.parentNode}b=null}if(b)switch(a.type){case "mousedown":b.hd(a);break;case "mouseup":b.uc(a);break;case "mouseover":b.ld(a);break;case "mouseout":b.wf(a);break;case "contextmenu":b.kd(a)}};
h.ed=function(){};h.Jg=function(){this.Qb(-1);this.nb=!1;this.ua&&this.ua.oa(!1)};h.Ya=function(a){return this.isEnabled()&&this.za&&(0!=Ru(this)||this.Df)&&this.pf(a)?(a.preventDefault(),a.j(),!0):!1};
h.pf=function(a){var b=$v(this);if(b&&"function"==typeof b.Ya&&b.Ya(a)||this.ua&&this.ua!=b&&"function"==typeof this.ua.Ya&&this.ua.Ya(a))return!0;if(a.shiftKey||a.ctrlKey||a.metaKey||a.altKey)return!1;switch(a.g){case 27:if(this.Hc)Xv(this).blur();else return!1;break;case 36:aw(this);break;case 35:bw(this);break;case 38:if(this.cc==Vv)cw(this);else return!1;break;case 37:if(this.cc==Uv)Su(this)?dw(this):cw(this);else return!1;break;case 40:if(this.cc==Vv)dw(this);else return!1;break;case 39:if(this.cc==
Uv)Su(this)?cw(this):dw(this);else return!1;break;default:return!1}return!0};function Yv(a,b){var c=b.n(),c=c.id||(c.id=b.G());a.Cb||(a.Cb={});a.Cb[c]=b}h.W=function(a,b){Wv.m.W.call(this,a,b)};h.zd=function(a,b,c){a.Cc|=2;a.Cc|=64;a.va(32,!1);Hv(a,!1);Wv.m.zd.call(this,a,b,c);a.Z&&this.Z&&Yv(this,a);b<=this.Za&&this.Za++};
h.removeChild=function(a,b){if(a=v(a)?Nu(this,a):a){var c=Tu(this,a);-1!=c&&(c==this.Za?(a.Ia(!1),this.Za=-1):c<this.Za&&this.Za--);var d=a.n();d&&d.id&&this.Cb&&(c=this.Cb,d=d.id,d in c&&delete c[d])}a=Wv.m.removeChild.call(this,a,b);Hv(a,!0);return a};function Tv(a,b){if(a.n())throw Error("Component already rendered");a.cc=b}
h.qc=function(a,b){if(b||this.za!=a&&this.dispatchEvent(a?"show":"hide")){this.za=a;var c=this.n();c&&(Q(c,a),this.Hc&&Qv(Xv(this),this.oc&&this.za),b||this.dispatchEvent(this.za?"aftershow":"afterhide"));return!0}return!1};h.isEnabled=function(){return this.oc};
h.setEnabled=function(a){this.oc!=a&&this.dispatchEvent(a?"enable":"disable")&&(a?(this.oc=!0,Qu(this,function(a){a.rh?delete a.rh:a.setEnabled(!0)})):(Qu(this,function(a){a.isEnabled()?a.setEnabled(!1):a.rh=!0}),this.nb=this.oc=!1),this.Hc&&Qv(Xv(this),a&&this.za))};function ew(a,b){b!=a.Hc&&a.Z&&Zv(a,b);a.Hc=b;a.oc&&a.za&&Qv(Xv(a),b)}h.Qb=function(a){(a=Z(this,a))?a.Ia(!0):-1<this.Za&&$v(this).Ia(!1)};h.Ia=function(a){this.Qb(Tu(this,a))};function $v(a){return Z(a,a.Za)}
function aw(a){fw(a,function(a,c){return(a+1)%c},Ru(a)-1)}function bw(a){fw(a,function(a,c){a--;return 0>a?c-1:a},0)}function dw(a){fw(a,function(a,c){return(a+1)%c},a.Za)}function cw(a){fw(a,function(a,c){a--;return 0>a?c-1:a},a.Za)}function fw(a,b,c){c=0>c?Tu(a,a.ua):c;var d=Ru(a);c=b.call(a,c,d);for(var e=0;e<=d;){var f=Z(a,c);if(f&&a.rg(f)){a.Rf(c);break}e++;c=b.call(a,c,d)}}h.rg=function(a){return a.Fa&&a.isEnabled()&&yv(a,2)};h.Rf=function(a){this.Qb(a)};function gw(){this.g="tablist"}A(gw,Pv);da(gw);gw.prototype.B=function(){return"goog-tab-bar"};gw.prototype.Tf=function(a,b,c){this.i||(this.h||hw(this),this.i=Qc(this.h));var d=this.i[b];d?(Tv(a,d==iw||d==jw?Vv:Uv),a.i=d):gw.m.Tf.call(this,a,b,c)};gw.prototype.nf=function(a){var b=gw.m.nf.call(this,a);this.h||hw(this);b.push(this.h[a.i]);return b};function hw(a){var b=a.B();a.h=Tc(kw,b+"-top",lw,b+"-bottom",iw,b+"-start",jw,b+"-end")};function mw(a,b,c){a=a||kw;Tv(this,a==iw||a==jw?Vv:Uv);this.i=a;Wv.call(this,this.cc,b||gw.T(),c);nw(this)}A(mw,Wv);var kw="top",lw="bottom",iw="start",jw="end";h=mw.prototype;h.ib=null;h.J=function(){mw.m.J.call(this);nw(this)};h.H=function(){mw.m.H.call(this);this.ib=null};h.removeChild=function(a,b){ow(this,a);return mw.m.removeChild.call(this,a,b)};h.Rf=function(a){mw.m.Rf.call(this,a);this.Bc(Z(this,a))};h.Bc=function(a){a?a.Rc(!0):this.ib&&this.ib.Rc(!1)};
function ow(a,b){if(b&&b==a.ib){for(var c=Tu(a,b),d=c-1;b=Z(a,d);d--)if(b.Fa&&b.isEnabled()){a.Bc(b);return}for(c+=1;b=Z(a,c);c++)if(b.Fa&&b.isEnabled()){a.Bc(b);return}a.Bc(null)}}h.Di=function(a){this.ib&&this.ib!=a.target&&this.ib.Rc(!1);this.ib=a.target};h.Gi=function(a){a.target==this.ib&&(this.ib=null)};h.Bi=function(a){ow(this,a.target)};h.Ci=function(a){ow(this,a.target)};h.ed=function(){$v(this)||this.Ia(this.ib||Z(this,0))};
function nw(a){Y(a).listen(a,"select",a.Di).listen(a,"unselect",a.Gi).listen(a,"disable",a.Bi).listen(a,"hide",a.Ci)}Ev("goog-tab-bar",function(){return new mw});function pw(){return'<div id="sticky-hud-base"><div class="hud-button"><div class="logo-box"></div><div class="arrow-box"></div></div><div class="hud-popup"><div class="popup-container"><div class="popup-content"></div><div class="popup-footer"><div><span class="right"><a href="https://yathit.uservoice.com/" target="yathit.uservoice.com">Feedback</a> |&nbsp;<a href="https://sites.google.com/a/yathit.com/ydn-crm-wiki/" target="help">Help</a></span></div><div class="status-bar"><span class="status-bar-message"></span></div></div></div></div>'}
pw.g="templ.ydn.crm.inj.hub";function qw(a,b,c,d,e,f,g,k,l){var m,n;if(m=c.offsetParent){var p="HTML"==m.tagName||"BODY"==m.tagName;p&&"static"==tj(m)||(n=zj(m),p||(p=(p=Aj(m))&&nc?-m.scrollLeft:!p||C&&vc("8")||"visible"==sj(m,"overflowX")?m.scrollLeft:m.scrollWidth-m.clientWidth-m.scrollLeft,n=mh(n,new lh(p,m.scrollTop))))}m=n||new lh;n=Ej(a);if(p=yj(a)){var r=new qj(p.left,p.top,p.right-p.left,p.bottom-p.top),p=Math.max(n.left,r.left),s=Math.min(n.left+n.width,r.left+r.width);if(p<=s){var w=Math.max(n.top,r.top),r=Math.min(n.top+
n.height,r.top+r.height);w<=r&&(n.left=p,n.top=w,n.width=s-p,n.height=r-w)}}p=oh(a);w=oh(c);if(p.g!=w.g){var s=p.g.body,w=yh(w.g),r=new lh(0,0),y=xh(qh(s)),G=s;do{var D;if(y==w)D=zj(G);else{var I=G;D=void 0;if(I.getBoundingClientRect)D=wj(I),D=new lh(D.left,D.top);else{D=Xh(oh(I));var S=zj(I);D=new lh(S.x-D.x,S.y-D.y)}if(nc&&!vc(12)){b:{var S=I,ua=Sa();if(void 0===S.style[ua]&&(ua=(oc?"Webkit":nc?"Moz":C?"ms":mc?"O":null)+Ta(ua),void 0!==S.style[ua])){S=(oc?"-webkit":nc?"-moz":C?"-ms":mc?"-o":null)+
"-transform";break b}S="transform"}I=(I=sj(I,S)||sj(I,"transform"))?(I=I.match(Nj))?new lh(parseFloat(I[1]),parseFloat(I[2])):new lh(0,0):new lh(0,0);D=new lh(D.x+I.x,D.y+I.y)}}r.x+=D.x;r.y+=D.y}while(y&&y!=w&&(G=y.frameElement)&&(y=y.parent));s=mh(r,zj(s));C&&!Wh(p)&&(s=mh(s,Xh(p)));n.left+=s.x;n.top+=s.y}a=rw(a,b);b=new lh(a&2?n.left+n.width:n.left,a&1?n.top+n.height:n.top);b=mh(b,m);e&&(b.x+=(a&2?-1:1)*e.x,b.y+=(a&1?-1:1)*e.y);var K;if(g)if(l)K=l;else if(K=yj(c))K.top-=m.y,K.right-=m.x,K.bottom-=
m.y,K.left-=m.x;a:{l=b.clone();e=0;a=rw(c,d);d=Cj(c);k=k?k.clone():d.clone();if(f||0!=a)a&2?l.x-=k.width+(f?f.right:0):f&&(l.x+=f.left),a&1?l.y-=k.height+(f?f.bottom:0):f&&(l.y+=f.top);if(g&&(K?(f=l,e=0,65==(g&65)&&(f.x<K.left||f.x>=K.right)&&(g&=-2),132==(g&132)&&(f.y<K.top||f.y>=K.bottom)&&(g&=-5),f.x<K.left&&g&1&&(f.x=K.left,e|=1),f.x<K.left&&f.x+k.width>K.right&&g&16&&(k.width=Math.max(k.width-(f.x+k.width-K.right),0),e|=4),f.x+k.width>K.right&&g&1&&(f.x=Math.max(K.right-k.width,K.left),e|=1),
g&2&&(e=e|(f.x<K.left?16:0)|(f.x+k.width>K.right?32:0)),f.y<K.top&&g&4&&(f.y=K.top,e|=2),f.y<=K.top&&f.y+k.height<K.bottom&&g&32&&(k.height=Math.max(k.height-(K.top-f.y),0),f.y=K.top,e|=8),f.y>=K.top&&f.y+k.height>K.bottom&&g&32&&(k.height=Math.max(k.height-(f.y+k.height-K.bottom),0),e|=8),f.y+k.height>K.bottom&&g&4&&(f.y=Math.max(K.bottom-k.height,K.top),e|=2),g&8&&(e=e|(f.y<K.top?64:0)|(f.y+k.height>K.bottom?128:0)),g=e):g=256,e=g,e&496)){c=e;break a}uj(c,l);d==k||d&&k&&d.width==k.width&&d.height==
k.height||(f=Wh(oh(qh(c))),!C||f&&vc("8")?(c=c.style,nc?c.MozBoxSizing="border-box":oc?c.WebkitBoxSizing="border-box":c.boxSizing="border-box",c.width=Math.max(k.width,0)+"px",c.height=Math.max(k.height,0)+"px"):(g=c.style,f?(C?(f=Jj(c,"paddingLeft"),d=Jj(c,"paddingRight"),l=Jj(c,"paddingTop"),K=Jj(c,"paddingBottom"),f=new pj(l,d,K,f)):(f=rj(c,"paddingLeft"),d=rj(c,"paddingRight"),l=rj(c,"paddingTop"),K=rj(c,"paddingBottom"),f=new pj(parseFloat(l),parseFloat(d),parseFloat(K),parseFloat(f))),c=Mj(c),
g.pixelWidth=k.width-c.left-f.left-f.right-c.right,g.pixelHeight=k.height-c.top-f.top-f.bottom-c.bottom):(g.pixelWidth=k.width,g.pixelHeight=k.height)));c=e}return c}function rw(a,b){return(b&4&&Aj(a)?b^2:b)&-5};function sw(){}sw.prototype.g=function(){};function tw(a,b,c){this.h=a;this.i=b;this.p=c}A(tw,sw);tw.prototype.g=function(a,b,c){qw(this.h,this.i,a,b,void 0,c,this.p)};function uw(a,b,c,d){tw.call(this,a,b);this.j=c?5:0;this.l=d||void 0}A(uw,tw);uw.prototype.o=function(){return this.j};uw.prototype.g=function(a,b,c,d){var e=qw(this.h,this.i,a,b,null,c,10,d,this.l);if(e&496){var f=vw(e,this.i);b=vw(e,b);e=qw(this.h,f,a,b,null,c,10,d,this.l);e&496&&(f=vw(e,f),b=vw(e,b),qw(this.h,f,a,b,null,c,this.j,d,this.l))}};function vw(a,b){a&48&&(b^=2);a&192&&(b^=1);return b};function ww(a,b){pd.call(this);this.g=new Of(this);var c=a||null;xw(this);this.C=c;b&&(this.Oc=b)}A(ww,pd);h=ww.prototype;h.C=null;h.pg=!0;h.og=null;h.Ta=!1;h.Ef=-1;h.Qg=!1;h.Oc="toggle_display";h.n=function(){return this.C};function xw(a){if(a.Ta)throw Error("Can not change this state of the popup while showing.");}
function yw(a,b){a.i&&a.i.stop();a.h&&a.h.stop();if(b){if(!a.Ta&&a.dispatchEvent("beforeshow")){if(!a.C)throw Error("Caller must call setElement before trying to show the popup");a.Nc();var c=qh(a.C);a.Qg&&a.g.listen(c,"keydown",a.Oi,!0);if(a.pg)if(a.g.listen(c,"mousedown",a.Yg,!0),C){var d;try{d=c.activeElement}catch(e){}for(;d&&"IFRAME"==d.nodeName;){try{var f=d.contentDocument||d.contentWindow.document}catch(g){break}c=f;d=c.activeElement}a.g.listen(c,"mousedown",a.Yg,!0);a.g.listen(c,"deactivate",
a.Xg)}else a.g.listen(c,"blur",a.Xg);"toggle_display"==a.Oc?(a.C.style.visibility="visible",Q(a.C,!0)):"move_offscreen"==a.Oc&&a.Nc();a.Ta=!0;a.Ef=z();a.i?(jd(a.i,"end",a.eh,!1,a),a.i.play()):a.eh()}}else zw(a)}h.Nc=ca;function zw(a,b){if(!a.Ta||!a.dispatchEvent({type:"beforehide",target:b}))return!1;a.g&&a.g.removeAll();a.Ta=!1;z();a.h?(jd(a.h,"end",pa(a.yg,b),!1,a),a.h.play()):a.yg(b);return!0}
h.yg=function(a){"toggle_display"==this.Oc?this.Ji():"move_offscreen"==this.Oc&&(this.C.style.top="-10000px");this.dispatchEvent({type:"hide",target:a})};h.Ji=function(){this.C.style.visibility="hidden";Q(this.C,!1)};h.eh=function(){this.dispatchEvent("show")};h.Yg=function(a){a=a.target;Jh(this.C,a)||Aw(this,a)||150>z()-this.Ef||zw(this,a)};h.Oi=function(a){27==a.g&&zw(this,a.target)&&(a.preventDefault(),a.j())};
h.Xg=function(a){var b=qh(this.C);if("undefined"!=typeof document.activeElement){if(a=b.activeElement,!a||Jh(this.C,a)||"BODY"==a.tagName)return}else if(a.target!=b)return;150>z()-this.Ef||zw(this)};function Aw(a,b){return yb(a.og||[],function(a){return b===a||Jh(a,b)})}h.H=function(){ww.m.H.call(this);this.g.ca();fc(this.i);fc(this.h);delete this.C;delete this.g;delete this.og};function Bw(a,b){this.o=4;this.j=b||void 0;ww.call(this,a)}A(Bw,ww);function Cw(a){a.o=2;a.Ta&&a.Nc()}function Dw(a,b){a.j=b||void 0;a.Ta&&a.Nc()}function Ew(a,b){null==b||b instanceof pj?a.l=b:a.l=new pj(b,void 0,void 0,void 0);a.Ta&&a.Nc()}Bw.prototype.Nc=function(){if(this.j){var a=!this.Ta&&"move_offscreen"!=this.Oc,b=this.n();a&&(b.style.visibility="hidden",Q(b,!0));this.j.g(b,this.o,this.l);a&&Q(b,!1)}};function Fw(a,b,c){this.g=a;this.h=b;this.i=c||null}Fw.prototype.toString=function(){return"ContactModel:"+this.g};function Gw(a,b){this.parent=a;this.g=b}Gw.prototype.i=function(){return Hw(this.parent.module).module_fields[this.g]};Gw.prototype.h=function(){return this.parent.module.value(this.g)};Gw.prototype.Xd=function(){return this.h()};function Iw(a){a=a.i();return v(a.label)?a.label.replace(/:$/,""):a.label}function Jw(a){return(a=a.i())?a.type||"varchar":"varchar"}function Kw(a){return(a=a.i())?!!a.calculated:!1}var Lw={rj:"add",tj:"edit",yj:"optout",zj:"primary",Aj:"remove"};Gw.prototype.j=function(){return[]};
Gw.prototype.toString=function(){return this.parent+";Field:"+this.g};Gw.prototype.l=function(a){if(Kw(this)||a==this.h())return null;var b={};b[this.g]=a;return b};function Mw(a,b){Gw.call(this,a,b)}A(Mw,Gw);Mw.prototype.h=function(){var a;a:{var b=this.parent;a=this.g;var c=b.module.value("email");if(u(c)){for(b=0;b<c.length;b++){var d=c[b];if(d.email_address_id==a){a=d.email_address;break a}}a=null}else a=b.module.value(a)}return a};Mw.prototype.i=function(){return Hw(this.parent.module).module_fields[this.g]||Hw(this.parent.module).module_fields.email};
Mw.prototype.l=function(a){if(!a)return null;var b=this.parent;if(Nw(b)){for(var b=Ow(b),c=0;c<b.length;c++){var d=b[c];if(b[c].email_address_id==this.g){if(d.email_address==a)break;b[c].email_address=a;b[c].email_address_caps=a.toUpperCase();return{email:b}}}return null}if(b.module.value(this.g)==a)return null;b={};b[this.g]=a;return b};
function Pw(a){var b=a.parent;if(Nw(b)){for(var c=Ow(b),b=0;b<c.length;b++)if(c[b].email_address_id==a.g)return a=bn(c),a.splice(b,1),{email:a};return null}return b.module.value(a.g)?(b={},b[a.g]=void 0,b):null}
Mw.prototype.j=function(){var a;a:{var b=this.parent;a=this.g;var c=b.module.value("email");if(u(c)){for(b=0;b<c.length;b++){var d=c[b];if(d.email_address_id==a){a="1"==d.opt_out;break a}}a=null}else a="email"==a?"1"==b.module.value("email_opt_out"):null}return[{name:"remove",label:"Remove"},{name:"optout",label:"Opt out",type:"bool",value:a}]};function Qw(a,b){this.module=a;this.g=b||""}Qw.prototype.o=function(){var a=Hw(this.module),b=[],c;for(c in a.module_fields){var d=a.module_fields[c];this.g&&d.group==this.g?b.push(c):this.g||d.group||b.push(c)}return b};function Rw(a,b){var c=a.module.value(b);return v(c)?c:""}Qw.prototype.h=function(){var a=this.g.replace("_"," ");return a=a.charAt(0).toUpperCase()+a.substr(1)};Qw.prototype.l=function(){return null};Qw.prototype.j=function(){return null};function Sw(a,b){Qw.call(this,a,b)}A(Sw,Qw);Sw.prototype.h=function(){return"Name"};function Tw(a,b){return a.module.value(a.g+"_"+b)}Sw.prototype.l=function(){var a=Tw(this,"country"),b=Tw(this,"city"),c=Tw(this,"state"),d=Tw(this,"postalcode"),e="";a&&(e+=a);c?e=d?c+" "+d+", "+e:e+(" "+c):d&&(e+=" "+d);e||(e=Tw(this,"street")||"");e||(e=Tw(this,"street_2")||"");b&&(e=b+" "+e);return e};Sw.prototype.j=function(){return{label:"Edit",name:"edit",type:"text"}};function Uw(a,b){Qw.call(this,a,b);this.Oa=[]}A(Uw,Qw);Uw.prototype.i=function(a){var b=this.Oa.indexOf(a);if(0<=b)return this.Oa[b];a=new Gw(this,a);this.Oa.push(a);return a};function Vw(a){Uw.call(this,a,"email")}A(Vw,Uw);Vw.prototype.o=function(){var a=this.module.value("email");if(u(a))return a.map(function(a){return a.email_address_id});var a=Hw(this.module),b=[],c;for(c in a.module_fields)"email"==a.module_fields[c].group&&b.push(c);return b};Vw.prototype.i=function(a){var b=this.Oa.indexOf(a);if(0<=b)return this.Oa[b];a=new Mw(this,a);this.Oa.push(a);return a};function Nw(a){a=a.module.value("email");return u(a)}
function Ow(a){var b=a.module.value("email");if(u(b))return b;var b=Hw(a.module),c=[],d;for(d in b.module_fields)"email"==b.module_fields[d].group&&c.push({email_address_id:d,email_address:a.module.value(d),primary_address:0==c.length?"1":"0"});return c};function Ww(a){Qw.call(this,a,"name")}A(Ww,Qw);Ww.prototype.h=function(){return"Name"};Ww.prototype.l=function(){var a="",b=this.module.value("full_name");b?a+=b:(a+=this.module.value("first_name"),(b=this.module.value("last_name"))&&(a+=" "+b));(b=this.module.value("salutation"))&&(a=b+" "+a);return a};Ww.prototype.j=function(){return{label:"Edit",name:"edit",type:"text"}};function Xw(a,b){Gw.call(this,a,b)}A(Xw,Gw);Xw.prototype.j=function(){return[{name:"remove",label:"Remove"}]};function Yw(a){Uw.call(this,a,"phone")}A(Yw,Uw);Yw.prototype.i=function(a){var b=this.Oa.indexOf(a);if(0<=b)return this.Oa[b];a=new Xw(this,a);this.Oa.push(a);return a};function Zw(a,b){pd.call(this);this.parent=a;this.g=b;this.i={}}A(Zw,pd);h=Zw.prototype;h.logger=L("ydn.crm.sugar.model.Record");h.G=function(){return this.g.G()};h.value=function(a){return this.g.value(a)};h.$=function(){return this.g.module};function Hw(a){return a.parent.l[a.$()]}h.save=function(a){return $w(this.parent,new Ds($(this.parent),this.$(),a)).w(function(a){var c=this,d=!ax(this);Fs(this.g,a);setTimeout(function(){d?c.dispatchEvent(new bx(0,c)):c.dispatchEvent(new cx(0,c))},10)},this)};
function dx(a,b){if(!b||0==Object.keys(b))return ac(!1);var c=bn(a.g.getData()),d;for(d in b)c[d]=b[d];return $w(a.parent,new Ds($(a.parent),a.$(),c)).w(function(a){var b=this;Fs(this.g,a);setTimeout(function(){b.dispatchEvent(new cx(0,b))},10)},a)}h.H=function(){Zw.m.H.call(this);this.i=null};function ex(a){return a.g&&a.g.g?Es(a.g):null}
h.zb=function(a){a=a?a.g?a:null:null;var b=!1,c=!1,d=!1;a?a!==this.g&&(b=!0,(c=this.g.module!=a.module)||(d=ax(this)?this.g.G()!=a.G():!0),this.g=a):!a&&ax(this)&&(d=b=!0,this.g.g=null);var e=this.g.module;c?this.dispatchEvent(new fx(e,a,this)):d?this.dispatchEvent(new bx(0,this)):b&&this.dispatchEvent(new cx(0,this))};function ax(a){return!!a.g.g}h.toString=function(){return"ydn.crm.sugar.model.Record:"+this.g};function gx(a,b){E.call(this,a,b)}A(gx,E);function hx(a,b,c,d){E.call(this,"context-gdata-change",d);this.domain=a;this.h=c}A(hx,gx);function ix(a,b){for(var c=0;c<a.h.length;c++)if(it(a.h[c],jt,a.domain,b))return a.h.splice(c,1)[0];return null}function bx(a,b){E.call(this,"record-change",b)}A(bx,gx);function fx(a,b,c){E.call(this,"module-change",c);this.module=a;this.update=b}A(fx,gx);function cx(a,b){E.call(this,"record-update",b)}A(cx,gx);function jx(a,b,c,d){E.call(this,a,d)}A(jx,gx);
function kx(a,b,c){E.call(this,"gdata-change",c)}A(kx,jx);function lx(a,b,c){E.call(this,"gdata-updated",c)}A(lx,jx);function mx(a,b){pd.call(this);this.g=a;for(var c={},d=0;d<b.length;d++)c[b[d].module_name]=b[d];this.l=c;this.info={};this.o=null;this.Ha=new Of(this);this.j=new Ds($(this),"Users");nx(this);c=ue();this.Ha.listen(c,["login","host-permission"],this.ui)}A(mx,pd);var nt="login";h=mx.prototype;h.ui=function(a){"login"==a.type?(a=a.getData())&&a.domain==$(this)&&ox(this,a):"host-permission"==a.type&&this.g&&(a=a.getData(),a.grant&&a.grant==$(this)&&(this.g.hostPermission=!0,this.dispatchEvent(new E("hag"))))};
function ox(a,b){if(b){var c=a.g.isLogin,d=!!b&&b.isLogin;a.g=b;!c&&d?a.dispatchEvent(new E(nt,a)):c&&!d&&a.dispatchEvent(new E("logout",a))}}h.isLogin=function(){return!!this.g.isLogin};function nx(a){a.g&&a.g.userName&&a.send("login-user").w(function(a){a&&a.id&&(this.j.g=a)},a)}function px(a){return a.send("about").w(function(a){ox(this,a)},a)}function qx(a){return xe("sugarcrm",$(a))}function $(a){return a.g.domain}function rx(a){return a.g.baseUrl?a.g.baseUrl:"https://"+a.g.domain}
function sx(a,b,c){var d={};d.domain=$(a);d.baseUrl=a.g.baseUrl||null;d.Kj=b;d.password=c;return a.send("login",d).w(function(a){ox(this,a)},a)}h.send=function(a,b){return xe("sugarcrm",$(this)).send(a,b)};function tx(a,b,c,d,e,f){b={store:b};c&&(b.index=c);d&&(d instanceof R?b.range=d.toJSON():b.key=d);b.prefix=!!e;f&&(b.limit=void 0);return qx(a).send("query",[b])}function ux(a,b,c){c={store:b,index:"name",q:c,fetchFull:!1};"Notes"==b&&(c.index="content");return qx(a).send("search",[c])}
function vx(a,b,c,d){var e=document.createElement("div");e.innerHTML=b.yf;var f=b.Ag,f=f&&f instanceof Date&&!isNaN(f.getTime())?Qs(b.Ag):"",g=a.g?a.g.userName||"":"",k;k=a.j.value("name")||a.g.userName||null;return a.send("new-record",{module:"Emails",record:{assigned_user_id:g,assigned_user_name:k,type:"archived",date_sent:f,description:e.textContent,description_html:b.yf,name:b.Zi,from_addr:b.Ph,to_addrs:b.aj,parent_id:d||"",parent_type:c||"",mailbox_id:b.Li||"",message_id:b.Kf||"",status:"read"}})}
function $w(a,b){var c={module:b.module,record:b.getData()};return a.send("put-record",c)}h.H=function(){mx.m.H.call(this);this.o=this.info=null;this.Ha.ca();this.Ha=null};h.toString=function(){return"ydn.crm.sugar.model.Sugar:"+$(this)};function wx(a){X.call(this,a)}A(wx,X);wx.prototype.P=function(){wx.m.P.call(this);var a=this.n(),b=this.g;lv(a,"sugarcrm-link-panel");b=b.createElement("a");b.textContent="Setup SugarCRM";b.href=chrome.extension.getURL("setup.html")+"#modal";b.className="setup-link maia-button";b.setAttribute("data-window-height","600");b.setAttribute("data-window-width","800");a.appendChild(b);Q(a,!1)};wx.prototype.na=function(a){wx.m.na.call(this,a);a=u(a)&&0<a.length;Q(this.n(),!a)};
wx.prototype.J=function(){wx.m.J.call(this);var a=Y(this),b=this.n().querySelector("a.setup-link");a.listen(b,"click",np,!0)};function xx(a,b,c){pd.call(this);this.target=a;this.j=b||a;this.i=c||new qj(NaN,NaN,NaN,NaN);this.h=qh(a);this.g=new Of(this);a=pa(fc,this.g);this.bb||(this.bb=[]);this.bb.push(t(void 0)?oa(a,void 0):a);cd(this.j,["touchstart","mousedown"],this.jh,!1,this)}A(xx,pd);var yx=C||nc&&vc("1.9.3");h=xx.prototype;h.clientX=0;h.clientY=0;h.kh=0;h.lh=0;h.Fc=0;h.Gc=0;h.ff=!0;h.mc=!1;h.setEnabled=function(a){this.ff=a};
h.H=function(){xx.m.H.call(this);kd(this.j,["touchstart","mousedown"],this.jh,!1,this);this.g.removeAll();yx&&this.h.releaseCapture();this.j=this.target=null};
h.jh=function(a){var b="mousedown"==a.type;if(!this.ff||this.mc||b&&!Ec(a))this.dispatchEvent("earlycancel");else if(zx(a),this.dispatchEvent(new Ax("start",this,a.clientX,a.clientY))){this.mc=!0;a.preventDefault();var b=this.h,c=b.documentElement,d=!yx;this.g.listen(b,["touchmove","mousemove"],this.wi,d);this.g.listen(b,["touchend","mouseup"],this.Rd,d);yx?(c.setCapture(!1),this.g.listen(c,"losecapture",this.Rd)):this.g.listen(xh(b),"blur",this.Rd);this.o&&this.g.listen(this.o,"scroll",this.Si,d);
this.clientX=this.kh=a.clientX;this.clientY=this.lh=a.clientY;this.Fc=this.target.offsetLeft;this.Gc=this.target.offsetTop;this.l=Xh(oh(this.h));z()}};h.Rd=function(a){this.g.removeAll();yx&&this.h.releaseCapture();if(this.mc){zx(a);this.mc=!1;var b=Bx(this,this.Fc),c=Cx(this,this.Gc);this.dispatchEvent(new Ax("end",this,a.clientX,a.clientY,0,b,c))}else this.dispatchEvent("earlycancel")};
function zx(a){var b=a.type;"touchstart"==b||"touchmove"==b?a.init(a.h.targetTouches[0],a.i):"touchend"!=b&&"touchcancel"!=b||a.init(a.h.changedTouches[0],a.i)}
h.wi=function(a){if(this.ff){zx(a);var b=1*(a.clientX-this.clientX),c=a.clientY-this.clientY;this.clientX=a.clientX;this.clientY=a.clientY;if(!this.mc){var d=this.kh-this.clientX,e=this.lh-this.clientY;if(0<d*d+e*e)if(this.dispatchEvent(new Ax("start",this,a.clientX,a.clientY)))this.mc=!0;else{this.I||this.Rd(a);return}}c=Dx(this,b,c);b=c.x;c=c.y;this.mc&&this.dispatchEvent(new Ax("beforedrag",this,a.clientX,a.clientY,0,b,c))&&(Ex(this,a,b,c),a.preventDefault())}};
function Dx(a,b,c){var d=Xh(oh(a.h));b+=d.x-a.l.x;c+=d.y-a.l.y;a.l=d;a.Fc+=b;a.Gc+=c;b=Bx(a,a.Fc);a=Cx(a,a.Gc);return new lh(b,a)}h.Si=function(a){var b=Dx(this,0,0);a.clientX=this.clientX;a.clientY=this.clientY;Ex(this,a,b.x,b.y)};function Ex(a,b,c,d){a.target.style.left=c+"px";a.target.style.top=d+"px";a.dispatchEvent(new Ax("drag",a,b.clientX,b.clientY,0,c,d))}
function Bx(a,b){var c=a.i,d=isNaN(c.left)?null:c.left,c=isNaN(c.width)?0:c.width;return Math.min(null!=d?d+c:Infinity,Math.max(null!=d?d:-Infinity,b))}function Cx(a,b){var c=a.i,d=isNaN(c.top)?null:c.top,c=isNaN(c.height)?0:c.height;return Math.min(null!=d?d+c:Infinity,Math.max(null!=d?d:-Infinity,b))}function Ax(a,b,c,d,e,f,g){E.call(this,a);this.clientX=c;this.clientY=d;this.left=t(f)?f:b.Fc;this.top=t(g)?g:b.Gc}A(Ax,E);function Fx(a){pd.call(this);this.C=a;a=C?"focusout":"blur";this.g=cd(this.C,C?"focusin":"focus",this,!C);this.h=cd(this.C,a,this,!C)}A(Fx,pd);Fx.prototype.handleEvent=function(a){var b=new Cc(a.h);b.type="focusin"==a.type||"focus"==a.type?"focusin":"focusout";this.dispatchEvent(b)};Fx.prototype.H=function(){Fx.m.H.call(this);ld(this.g);ld(this.h);delete this.C};function Gx(a,b){X.call(this,b);this.Sb=!!a;this.ba=null}A(Gx,X);h=Gx.prototype;h.Ze=null;h.tc=!1;h.Wa=null;h.Ba=null;h.rb=null;h.Pe=!1;h.B=function(){return"goog-modalpopup"};h.Vd=function(){return this.Wa};h.P=function(){Gx.m.P.call(this);var a=this.n(),b=Ba(this.B()).split(" ");mv(a,b);Nh(a,!0);Q(a,!1);Hx(this);Ix(this)};
function Hx(a){if(a.Sb&&!a.Ba){var b;b=a.g.s("iframe",{frameborder:0,style:"border:0;vertical-align:bottom;",src:'javascript:""'});a.Ba=b;a.Ba.className=a.B()+"-bg";Q(a.Ba,!1);Fj(a.Ba,0)}a.Wa||(a.Wa=a.g.s("div",a.B()+"-bg"),Q(a.Wa,!1))}function Ix(a){a.rb||(a.rb=a.g.createElement("span"),Q(a.rb,!1),Nh(a.rb,!0),a.rb.style.position="absolute")}h.gh=function(){this.Pe=!1};h.be=function(a){return!!a&&"DIV"==a.tagName};
h.lb=function(a){Gx.m.lb.call(this,a);a=Ba(this.B()).split(" ");mv(this.n(),a);Hx(this);Ix(this);Q(this.n(),!1)};h.J=function(){this.Ba&&Fh(this.Ba,this.n());Fh(this.Wa,this.n());Gx.m.J.call(this);var a=this.n();a.parentNode&&a.parentNode.insertBefore(this.rb,a.nextSibling);this.Ze=new Fx(this.g.g);Y(this).listen(this.Ze,"focusin",this.onFocus);Jx(this,!1)};h.pa=function(){this.tc&&this.eb(!1);fc(this.Ze);Gx.m.pa.call(this);Gh(this.Ba);Gh(this.Wa);Gh(this.rb)};
h.eb=function(a){if(a!=this.tc)if(this.N&&this.N.stop(),this.aa&&this.aa.stop(),this.D&&this.D.stop(),this.Y&&this.Y.stop(),this.Z&&Jx(this,a),a){if(this.dispatchEvent("beforeshow")){try{this.ba=this.g.g.activeElement}catch(b){}this.Qf();var c=xh(this.g.g)||window;if("fixed"==tj(this.n()))var d=a=0;else d=Xh(this.g),a=d.x,d=d.y;var e;e=this.n();e=Cj(e);c=vh(c);a=Math.max(a+c.width/2-e.width/2,0);d=Math.max(d+c.height/2-e.height/2,0);uj(this.n(),a,d);uj(this.rb,a,d);Y(this).listen(yh(this.g.g),"resize",
this.Qf);Kx(this,!0);this.Bg();this.tc=!0;this.N&&this.aa?(jd(this.N,"end",this.re,!1,this),this.aa.play(),this.N.play()):this.re()}}else if(this.dispatchEvent("beforehide")){Y(this).ka(yh(this.g.g),"resize",this.Qf);this.tc=!1;this.D&&this.Y?(jd(this.D,"end",this.pe,!1,this),this.Y.play(),this.D.play()):this.pe();try{d=this.g.g.body,c=this.g.g.activeElement||d,this.ba&&c==d&&this.ba!=d&&this.ba.focus()}catch(f){}this.ba=null}};
function Jx(a,b){if(b){a.p||(a.p=[]);for(var c=a.g,c=c.getChildren(c.g.body),d=0;d<c.length;d++){var e=c[d];e==a.C||iv(e,"hidden")||(hv(e,"hidden",!0),a.p.push(e))}}else if(a.p){for(d=0;d<a.p.length;d++)a.p[d].removeAttribute("aria-hidden");a.p=null}}function Kx(a,b){a.Ba&&Q(a.Ba,b);a.Wa&&Q(a.Wa,b);Q(a.n(),b);Q(a.rb,b)}h.re=function(){this.dispatchEvent("show")};h.pe=function(){Kx(this,!1);this.dispatchEvent("hide")};
h.Qf=function(){this.Ba&&Q(this.Ba,!1);this.Wa&&Q(this.Wa,!1);var a=this.g.g,b=vh(xh(a)||window),c=Math.max(b.width,Math.max(a.body.scrollWidth,a.documentElement.scrollWidth)),a=Math.max(b.height,Math.max(a.body.scrollHeight,a.documentElement.scrollHeight));this.Ba&&(Q(this.Ba,!0),Bj(this.Ba,c,a));this.Wa&&(Q(this.Wa,!0),Bj(this.Wa,c,a))};h.onFocus=function(a){this.Pe?this.gh():a.target==this.rb&&Vf(this.Bg,0,this)};h.Bg=function(){try{C&&this.g.g.body.focus(),this.n().focus()}catch(a){}};
h.H=function(){fc(this.N);this.N=null;fc(this.D);this.D=null;fc(this.aa);this.aa=null;fc(this.Y);this.Y=null;Gx.m.H.call(this)};function Lx(a,b,c){Gx.call(this,b,c);this.i=a||"modal-dialog";this.h=Mx()}A(Lx,Gx);h=Lx.prototype;h.Sd=!0;h.md=!0;h.Mf=!0;h.Fd=.5;h.Wf="";h.$b=null;h.Vb=null;h.Pd=!1;h.Ua=null;h.Ma=null;h.ye=null;h.Ga=null;h.Xa=null;h.ya=null;h.B=function(){return this.i};h.setTitle=function(a){this.Wf=a;this.Ma&&Kh(this.Ma,a)};h.qa=function(){return null!=this.$b?$h(this.$b):""};h.R=function(){this.n()||this.render();return this.Xa};h.Vd=function(){this.n()||this.render();return Lx.m.Vd.call(this)};
function Nx(a,b){a.Fd=b;if(a.n()){var c=a.Vd();c&&Fj(c,a.Fd)}}function Ox(a){!0!=a.Mf&&Px(a,!0)}function Px(a,b){a.Mf=b;if(a.Z){var c=a.g,d=a.Vd(),e=a.Ba;b?(e&&c.Af(e,a.n()),c.Af(d,a.n())):(c.Hg(e),c.Hg(d))}a.tc&&Jx(a,b)}function Qx(a,b){var c=Ba(a.i+"-title-draggable").split(" ");a.n()&&(b?mv(a.Ua,c):ov(a.Ua,c));if(b&&!a.Vb){var d;d=new xx(a.n(),a.Ua);a.Vb=d;mv(a.Ua,c);cd(a.Vb,"start",a.Yi,!1,a)}else!b&&a.Vb&&(a.Vb.ca(),a.Vb=null)}
h.P=function(){Lx.m.P.call(this);var a=this.n(),b=this.g;this.Ua=b.s("div",this.i+"-title",this.Ma=b.s("span",{className:this.i+"-title-text",id:this.G()},this.Wf),this.Ga=b.s("span",this.i+"-title-close"));Dh(a,this.Ua,this.Xa=b.s("div",this.i+"-content"),this.ya=b.s("div",this.i+"-buttons"));gv(this.Ma,"heading");gv(this.Ga,"button");Nh(this.Ga,!0);hv(this.Ga,"label",Rx);this.ye=this.Ma.id;gv(a,"dialog");hv(a,"labelledby",this.ye||"");this.$b&&(this.Xa.innerHTML=$h(this.$b));Q(this.Ga,this.md);
this.h&&(a=this.h,a.C=this.ya,a.render());Q(this.ya,!!this.h);Nx(this,this.Fd)};
h.lb=function(a){Lx.m.lb.call(this,a);a=this.n();var b=this.i+"-content";this.Xa=sh(document,null,b,a)[0];this.Xa||(this.Xa=this.g.s("div",b),this.$b&&(this.Xa.innerHTML=$h(this.$b)),a.appendChild(this.Xa));var b=this.i+"-title",c=this.i+"-title-text",d=this.i+"-title-close";(this.Ua=sh(document,null,b,a)[0])?(this.Ma=sh(document,null,c,this.Ua)[0],this.Ga=sh(document,null,d,this.Ua)[0]):(this.Ua=this.g.s("div",b),a.insertBefore(this.Ua,this.Xa));this.Ma?(this.Wf=Qh(this.Ma),this.Ma.id||(this.Ma.id=
this.G())):(this.Ma=zh("span",{className:c,id:this.G()}),this.Ua.appendChild(this.Ma));this.ye=this.Ma.id;hv(a,"labelledby",this.ye||"");this.Ga||(this.Ga=this.g.s("span",d),this.Ua.appendChild(this.Ga));Q(this.Ga,this.md);b=this.i+"-buttons";if(this.ya=sh(document,null,b,a)[0]){if(a=this.h=new Sx(this.g),(b=this.ya)&&1==b.nodeType){a.C=b;for(var b=a.C.getElementsByTagName("button"),c=0,e,f;d=b[c];c++)if(e=d.name||d.id,f=Qh(d)||d.value,e){var g=0==c;a.set(e,f,g,d.name==Tx);g&&lv(d,"goog-buttonset-default")}}}else this.ya=
this.g.s("div",b),a.appendChild(this.ya),this.h&&(a=this.h,a.C=this.ya,a.render()),Q(this.ya,!!this.h);Nx(this,this.Fd)};h.J=function(){Lx.m.J.call(this);Y(this).listen(this.n(),"keydown",this.$g).listen(this.n(),"keypress",this.$g);Y(this).listen(this.ya,"click",this.Mi);Qx(this,!0);Y(this).listen(this.Ga,"click",this.Vi);var a=this.n();gv(a,"dialog");""!==this.Ma.id&&hv(a,"labelledby",this.Ma.id);this.Mf||Px(this,!1)};h.pa=function(){this.tc&&this.eb(!1);Qx(this,!1);Lx.m.pa.call(this)};
h.eb=function(a){a!=this.tc&&(this.Z||this.render(),Lx.m.eb.call(this,a))};h.re=function(){Lx.m.re.call(this);this.dispatchEvent(Ux)};h.pe=function(){Lx.m.pe.call(this);this.dispatchEvent(Vx);this.Pd&&this.ca()};
h.Yi=function(){var a=this.g.g,b=vh(xh(a)||window),c=Math.max(a.body.scrollWidth,b.width),a=Math.max(a.body.scrollHeight,b.height),d;d=this.n();d=Cj(d);"fixed"==tj(this.n())?(b=new qj(0,0,Math.max(0,b.width-d.width),Math.max(0,b.height-d.height)),this.Vb.i=b||new qj(NaN,NaN,NaN,NaN)):this.Vb.i=new qj(0,0,c-d.width,a-d.height)||new qj(NaN,NaN,NaN,NaN)};h.Vi=function(){Wx(this)};function Wx(a){if(a.md){var b=a.h,c=b&&b.Qe;c?(b=b.get(c),a.dispatchEvent(new Xx(c,b))&&a.eb(!1)):a.eb(!1)}}
function Yx(a,b){a.md=b;a.Ga&&Q(a.Ga,a.md)}h.H=function(){this.ya=this.Ga=null;Lx.m.H.call(this)};function Zx(a,b){a.h=b;if(a.ya){if(a.h){var c=a.h;c.C=a.ya;c.render()}else a.ya.innerHTML=$h(bi);Q(a.ya,!!a.h)}}h.Mi=function(a){a:{for(a=a.target;null!=a&&a!=this.ya;){if("BUTTON"==a.tagName)break a;a=a.parentNode}a=null}if(a&&!a.disabled){a=a.name;var b=this.h.get(a);this.dispatchEvent(new Xx(a,b))&&this.eb(!1)}};
h.$g=function(a){var b=!1,c=!1,d=this.h,e=a.target;if("keydown"==a.type)if(this.Sd&&27==a.g){var f=d&&d.Qe,e="SELECT"==e.tagName&&!e.disabled;f&&!e?(c=!0,b=d.get(f),b=this.dispatchEvent(new Xx(f,b))):e||(b=!0)}else{if(9==a.g&&a.shiftKey&&e==this.n()){this.Pe=!0;try{this.rb.focus()}catch(g){}Vf(this.gh,0,this)}}else if(13==a.g){if("BUTTON"==e.tagName&&!e.disabled)f=e.name;else if(e==this.Ga)Wx(this);else if(d){var k=d.Ve,l;if(l=k)a:{l=d.C.getElementsByTagName("BUTTON");for(var m=0,n;n=l[m];m++)if(n.name==
k||n.id==k){l=n;break a}l=null}e=("TEXTAREA"==e.tagName||"SELECT"==e.tagName||"A"==e.tagName)&&!e.disabled;!l||l.disabled||e||(f=k)}f&&d&&(c=!0,b=this.dispatchEvent(new Xx(f,String(d.get(f)))))}else e==this.Ga&&32==a.g&&Wx(this);if(b||c)a.j(),a.preventDefault();b&&this.eb(!1)};function Xx(a,b){this.type=$x;this.key=a;this.caption=b}A(Xx,E);var $x="dialogselect",Vx="afterhide",Ux="aftershow";function Sx(a){a||oh();Gd.call(this)}A(Sx,Gd);h=Sx.prototype;h.Ve=null;h.C=null;h.Qe=null;
h.set=function(a,b,c,d){Gd.prototype.set.call(this,a,b);c&&(this.Ve=a);d&&(this.Qe=a);return this};function ay(a,b,c,d){return a.set(b.key,b.caption,c,d)}h.render=function(){if(this.C){this.C.innerHTML=$h(bi);var a=oh(this.C);this.forEach(function(b,c){var d=a.s("button",{name:c},b);c==this.Ve&&(d.className="goog-buttonset-default");this.C.appendChild(d)},this)}};h.n=function(){return this.C};
var Tx="cancel",Rx="Close",by={key:"ok",caption:"OK"},cy={key:Tx,caption:"Cancel"},dy={key:"yes",caption:"Yes"},ey={key:"no",caption:"No"},fy={key:"save",caption:"Save"},gy={key:"continue",caption:"Continue"};function Mx(){return ay(ay(new Sx,by,!0),cy,!1,!0)}"undefined"!=typeof document&&(ay(new Sx,by,!0,!0),Mx(),ay(ay(new Sx,dy,!0),ey,!1,!0),ay(ay(ay(new Sx,dy),ey,!0),cy,!1,!0),ay(ay(ay(new Sx,gy),fy),cy,!0,!0));function hy(a,b,c,d){Lx.call(this);this.M=d;Zx(this,c);this.setTitle(a);this.$b=a=ai(b,null);this.Xa&&(this.Xa.innerHTML=$h(a));this.Sd=!0;Yx(this,!1);Ox(this);this.Pd=!0;a=Y(this);a.listen(this,$x,this.Uc);a.listen(this,$x,this.gc)}A(hy,Lx);hy.prototype.Uc=function(a){this.M&&(this.M.callback(a.key),this.M=null)};hy.prototype.gc=function(){this.M&&(this.M.callback(Tx),this.M=null)};
function iy(){var a=new B,b=ay(new Sx,by,!0,!0);(new hy("Yathit CRM Setting","User setting cannot change because you are not login Yathit server.",b,a)).eb(!0);return a};function jy(){this.h=this.g=null;iq()}var ky;h=jy.prototype;h.logger=L("ydn.crm.ui.UserSetting");h.isLogin=function(){return!!this.g&&this.g.is_login};h.ij=function(){return this.g};function ly(){ky||(ky=new jy);return ky}h.gb=function(){if(!this.h){var a=xe().send("user-setting").w(function(){},this),b=xe().send("login-info").A(function(a){a||H(this.logger,"login fail");this.g=a},function(){this.g=null;H(this.logger,"login fail")},this);this.h=wn([a,b])}return this.h};h.Qh=function(){return this.g.email};
h.Ce=function(a){var b=xe("sugarcrm",a);return Wb(this.gb()).w(function(){return b.send("info-module").w(function(a){if(u(a))for(var b=0;b<a.length;b++)my(a[b]);else my(a);return a},this)},this)};
function my(a){var b="",c="",d;for(d in a.module_fields){var e=a.module_fields[d];0<="created_by created_by_name date_entered date_modified deleted modified_user_id modified_by_name id".split(" ").indexOf(d)&&(e.calculated=!0);if(0<=["salutation","name","last_name","first_name","full_name"].indexOf(d))e.group="name";else if(/^email\d?$/.test(d))e.group="email";else if(/^phone?/.test(d))e.group="phone";else if(!e.group&&wa(d,b)){e.group=c;continue}b=d;c=e.group}for(d in a.link_fields)b=a.link_fields[d],
"contact"!=d||b.module||(b.module="Contacts")}function ny(a){Lx.call(this);this.M=a;Zx(this,Mx());this.setTitle("Yathit CRM Setting");this.Sd=!0;Yx(this,!1);Ox(this);this.Pd=!0;a=this.R();a.classList.add("ydn-crm");a.innerHTML=ei(ki());a=Y(this);a.listen(this,$x,this.Uc);a.listen(this,$x,this.gc)}A(ny,Lx);
ny.prototype.Uc=function(){if(this.M){var a=this.R().querySelector("form.basic-setting"),b={};b["cp-po"]=oy(a,"context-panel-position");b["lg-cc"]=!!oy(a,"log-on-console");this.M.callback(b);this.M=null}};ny.prototype.gc=function(){this.M&&(this.M.callback(null),this.M=null)};
jy.prototype.show=function(){if(!this.isLogin())return iy();var a=new B,b=new ny(a),c,d=["lg-cc","cp-po"];chrome.storage.sync.get(d,function(a){c=a;var d=b.R().querySelector("form.basic-setting"),g=d.querySelector("input[name=log-on-console]");a=!!a["lg-cc"];var k=g.type;if(t(k))switch(k.toLowerCase()){case "checkbox":case "radio":g.checked=a?"checked":null;break;case "select-one":g.selectedIndex=-1;if(v(a))for(var l=0;k=g.options[l];l++)if(k.value==a){k.selected=!0;break}break;case "select-multiple":v(a)&&
(a=[a]);for(l=0;k=g.options[l];l++)if(k.selected=!1,a)for(var m,n=0;m=a[n];n++)k.value==m&&(k.selected=!0);break;default:g.value=null!=a?a:""}d=d.querySelectorAll("input[name=context-panel-position]");g=dq["cp-po"]||fq;for(a=0;a<d.length;a++)if(g==d[a].value){d[a].setAttribute("checked","1");break}b.eb(!0)}.bind(this));return a.w(function(a){if(a){for(var b={},g=0;g<d.length;g++){var k=d[g];a[k]!=c[k]&&(b[k]=a[k])}(g=0<Object.keys(b).length)&&chrome.storage.sync.set(b);window.console.log(c,a,g);return g}})};function py(a,b){var c;c=a.replace("@","%40");c="http://www.google.com/m8/feeds/contacts/"+c+"/base/"+ ++qy;b.id={$t:c};Gt.call(this,b)}A(py,Mt);var qy=0;function ry(a,b){Zw.call(this,a,new Ds($(a),b));this.h=null;this.module_name=b;this.Ha=new Of(this);this.Ha.listen(a,["gdata-change","gdata-updated","context-gdata-change"],this.Xi)}A(ry,Zw);h=ry.prototype;h.logger=L("ydn.crm.sugar.model.GDataRecord");h.H=function(){ry.m.H.call(this);this.Ha.ca();this.Ha=null};
h.Xi=function(a){if(a instanceof hx){if(this.zb(null),this.h=ix(a,this.$())){var b=it(this.h,jt,$(this.parent),this.$()).g;sy(this,b)}}else"gdata-change"!=a.type||ax(this)||((b=ty(this.getParent()))?(b=[{store:this.$(),index:"ydn$emails",key:b}],qx(this.parent).send("query",b).w(function(b){(b=b[0])&&b.result[0]?this.zb(new Ds($(this.parent),this.$(),b.result[0])):this.dispatchEvent(a)},this)):this.dispatchEvent(a))};h.getParent=function(){return this.parent};
function uy(a){return vy(a.getParent())}h.$=function(){return this.module_name};h.zb=function(a){if(a&&a.module!=this.module_name)throw Error("Module name must be "+this.module_name+" but found "+a.module);ry.m.zb.call(this,a)};function sy(a,b){var c=uy(a);c&&Ot(c);b&&(c=[{store:a.$(),index:"id",key:b}],qx(a.parent).send("query",c).A(function(a){(a=a[0])&&a.result[0]?this.zb(new Ds($(this.parent),this.$(),a.result[0])):H(this.logger,"record id "+b+" not in "+this.$())},function(a){throw a;},a))}
function wy(a){return(a=uy(a))?Ot(a)[0]:null}function xy(a){return a.h&&ax(a)?!!it(a.h,jt,$(a.parent),a.$(),a.G()):!1}function yy(a){var b=uy(a),b={module:a.$(),kind:b.$f(),"gdata-id":b.G()};J(a.logger,"sending import-gdata "+JSON.stringify(b));return qx(a.parent).send("import-gdata",b).w(function(a){a=new Ds($(this.parent),this.$(),a);J(this.logger,a+" created.");this.zb(a)},a)}
function zy(a){var b=Ay(a.getParent());new oe;var c=Nt(b),d={email1:Ot(b)[0],full_name:c};c&&0<c.length&&(c=c.split(/\s/),c[0]&&(d.first_name=c[0]),c[1]&&(d.last_name=c[c.length-1]));b=Pt(b);b[0]&&(d.phone_work=b[0]);d={module:a.$(),record:d};J(a.logger,"sending put-record "+JSON.stringify(d));return qx(a.parent).send("put-record",d).w(function(a){a=new Ds($(this.parent),this.$(),a);J(this.logger,a+" created.");this.zb(a)},a)}
function By(a){return ax(a)?Cy(a.getParent(),a.g):bc("no Record to export.")}function Dy(a){return ax(a)?Ey(a.getParent(),a.g):bc("no Record to link.")}h.save=function(){if(!ax(this))return bc("no Record to save.");var a=qx(this.parent).send("put-record",this.g);a.w(function(a){this.g.g=a},this);return a};h.toString=function(){var a="";this.g&&(a+=":"+this.g);var b=uy(this);b&&(a+=":"+b);return"RecordModel:"+this.$()+a};function Fy(a,b,c){mx.call(this,a,b);this.h=this.i=null;this.p=c}A(Fy,mx);function vy(a){return a.h}function Ay(a){return a.i}function ty(a){return a.i?Ot(a.i)[0]||null:null}
function Gy(a,b){for(var c=[],d=0;d<b.length;d++){for(var e=d,f=a.i,g=b[d],k=0,l=Ot(f),m=Ot(g),n=0;n<l.length;n++)for(var p=l[n],r=0;r<m.length;r++){var s=m[r];p&&p==s&&(k+=1)}l=0;p=f.data.gd$name;r=g.data.gd$name;if(p&&r)for(s=["gd$familyName","gd$givenName","gd$additionalName","gd$fullName"],m=[.06,.06,.06,.12],n=0;4>n;n++){var w=p[s[n]],y=r[s[n]];w&&y==w&&(l+=m[n])}n=0;m=f.vd();p=g.vd();m&&m==p&&(n+=.2);r=0;f=Pt(f);g=Pt(g);p=f.length;for(m=[];p--;){r=f[p];s=g.length;for(m[p]=0;s--;)w=g[s],r.$t&&
w.$t&&(w=.7*Ft(r,w),m[p]=Math.max(m[p],w));r=Ti(m).value}c[e]=k+l+n+r}e=[];for(d=0;d<b.length;d++)k=Kb(e,Nb,c[d]),0>k?(Ib(e,-(k+1),0,c[d]),l=b.splice(d,1),Ib(b,-(k+1),0,l[0])):Ib(e,k,0,c[d])}
function Ey(a,b){b.G();var c=b.module,d=a.h;if(!d)return bc("Not contact data to link.");var e=it(d,jt,$(a),c);if(e)return bc("Contact "+mr(d)+" already link to "+e.g+" with the module "+c);c=new Jt(jt,$(a),c,b.G(),+new Date(d.data.updated.$t),Gs(b));d={kind:d.$f(),"gdata-id":d.G(),"external-id":{label:c.module+"#"+c.i+"-"+c.h,value:c.U()}};return qx(a).send("link",d).w(function(){this.h=null;this.dispatchEvent(new kx(0,0,this))},a)}
function Cy(a,b){return xe().send("export-record",b.toJSON()).w(function(a){this.h=new Mt(a);this.dispatchEvent(new lx(0,0,this))},a)}Fy.prototype.update=function(a,b,c){this.isLogin()?Hy(this,a,b,c):px(this).fa(function(){Hy(this,a,b,c)},this)};
function Hy(a,b,c,d){a.i=null;a.h=null;if(b){var e={gd$email:[{address:b}]};c&&(e.gd$name={gd$fullName:{$t:c}});d&&(e.gd$phoneNumber=[{$t:d}]);a.i=new py(a.p,e);xe().send("gdata-list-contact-by-email",b).A(function(a){a=a.map(function(a){return new Mt(a)});Gy(this,a);a=new hx($(this),0,a,this);this.dispatchEvent(a);this.h=a.h[0]||null;this.dispatchEvent(new kx(0,0,this))},function(a){throw a;},a)}else a.dispatchEvent(new hx($(a),0,[],a)),a.dispatchEvent(new kx(0,0,a))};function Iy(a,b){X.call(this);this.na(a);this.parent=b||null;this.h=new Jy}A(Iy,X);h=Iy.prototype;h.logger=L("ydn.crm.ui.GmailCmd");h.B=function(){return"gmail-cmd-panel"};h.P=function(){Iy.m.P.call(this);var a=this.n(),b=this.g;a.classList.add(this.B());b=b.s("a",{"class":"archive"},".");Ky(this.h,b);a.appendChild(b)};function Ly(a,b){My(a.h,"View",ds($(a.t()),"Emails",b.id));var c=a.h.n();c.setAttribute("target","gmail");c.setAttribute("title","View archived email in SugarCRM")}
function Ny(a){My(a.h,"Archive","#archive");a.h.n().setAttribute("title","Archive this email message to SugarCRM")}function Oy(a){My(a.h,".");setTimeout(function(){My(a.h,"..");var b=Py(a.n());b.Kf?(My(a.h,"..."),a.t().send("query",[{store:"Emails",index:"message_id",key:b.Kf}]).A(function(b){(b=b[0]&&b[0].result?b[0].result[0]:null)?Ly(a,b):Ny(a)},function(b){Ny(a);throw b;})):1<b.yf.length?Ny(a):Qy(a.h,"gmail message cannot be parsed")},100)}
h.J=function(){Iy.m.J.call(this);Y(this).listen(this.h,"click",this.Yh);Oy(this)};
function Py(a){var b="",c="",d="",e="",f="",g=Th(a,"TR");if(b=g.children[0].querySelector("span[email]"))b=b.getAttribute("email");else return H(aq,"cannot sniff sender email"),null;if(a=g.children[1].querySelector("span[alt]"))a=a.getAttribute("alt"),a=new Date(a.replace(" at",""));else return H(aq,"cannot sniff date sent"),null;var k=g.nextElementSibling;if(!k||"TR"!=k.tagName)return H(aq,"to email address TR expect after title TR"),null;for(var l=k.querySelectorAll("span[email]"),k=0;k<l.length;k++)c&&
(c+=", "),c+=l[k].getAttribute("email");for(var g=Th(g,"TABLE"),m=g.parentElement.nextElementSibling,k=0;m&&10>k;k++)if(l=m.querySelector("div[style]")){d=l.parentElement.className.split(/\s/);k=d.map(function(a){return a.length});k=k.indexOf(Math.max.apply(Math,k));10<d[k].length&&(e=d[k].substring(1),"m"!=d[k].charAt(0)&&J(aq,"not start with m? "+d[k]));d=l.innerHTML;break}else m=m.nextElementSibling;g=Th(g.parentElement,"TABLE");for(k=0;g&&10>k&&"presentation"!=g.getAttribute("role");k++)g=Th(g,
"TABLE");"presentation"==g.getAttribute("role")?(g=g.querySelector("h2"))?f=g.textContent:H(aq,"email subject cannot be sniff"):H(aq,"expect a presentation role TABLE");g=ly().g.email;return{Ph:b,aj:c,Ag:a,yf:d,Li:g,Kf:e,Zi:f}}
h.Yh=function(a){if(xa(a.target.href,"#archive")){a.preventDefault();My(this.h,"archiving...");var b=a=void 0,c=this.parent?Z(this.parent,1).h():[];c[0]&&(a=c[0].module,b=c[0].id);(c=Py(this.n()))?vx(this.t(),c,a,b).A(function(a){Ly(this,a)},function(a){Qy(this.h,a)},this):Qy(this.h,"Cannot gather email message")}};function Ry(a){this.h=a;this.g=[]}Ry.prototype.logger=L("ydn.crm.ui.GmailCmdInjector");function Sy(a){var b=document.body;(new MutationObserver(a.i.bind(a))).observe(b,{childList:!1,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:["data-tooltip"]})}
Ry.prototype.i=function(a){for(var b=0;b<a.length;b++){var c=a[b].target;if("Reply"==c.getAttribute("data-tooltip")){var d;a:{for(d=0;d<this.g.length;d++)if(!document.body.contains(this.g[d].n())){this.g[d].Z&&this.g[d].pa();d=this.g[d];break a}d=new Iy(this.h);this.g.push(d)}var e=document.createElement("span");c.parentElement.insertBefore(e,c);d.render(e)}}};function Ty(){}A(Ty,pv);da(Ty);Ty.prototype.B=function(){return"goog-menuheader"};function Uy(a,b,c){Gv.call(this,a,c||Ty.T(),b);this.va(1,!1);this.va(2,!1);this.va(4,!1);this.va(32,!1);this.Zb=1}A(Uy,Gv);Ev("goog-menuheader",function(){return new Uy(null)});function Vy(){this.h=[]}A(Vy,pv);da(Vy);function Wy(a,b){var c=a.h[b];if(!c){switch(b){case 0:c=a.B()+"-highlight";break;case 1:c=a.B()+"-checkbox";break;case 2:c=a.B()+"-content"}a.h[b]=c}return c}h=Vy.prototype;h.sc=function(){return"menuitem"};h.Ea=function(a){var b=a.g.s("div",sv(this,a).join(" "),Xy(this,a.qa(),a.g));Yy(this,a,b,yv(a,8)||yv(a,16));return b};h.ta=function(a){return a&&a.firstChild};
h.ra=function(a,b){var c=Hh(b),d=Wy(this,2);c&&kv(c,d)||b.appendChild(Xy(this,b.childNodes,a.g));kv(b,"goog-option")&&(a.va(16,!0),a&&b&&Yy(this,a,b,!0));return Vy.m.ra.call(this,a,b)};h.Xb=function(a,b){var c=this.ta(a),d=Zy(this,a)?c.firstChild:null;Vy.m.Xb.call(this,a,b);d&&!Zy(this,a)&&c.insertBefore(d,c.firstChild||null)};function Xy(a,b,c){a=Wy(a,2);return c.s("div",a,b)}function Zy(a,b){var c=a.ta(b);if(c){var c=c.firstChild,d=Wy(a,1);return!!c&&Ih(c)&&kv(c,d)}return!1}
function Yy(a,b,c,d){xv(a,c,b.fd());tv(a,b,c);d!=Zy(a,c)&&(d?lv(c,"goog-option"):nv(c,"goog-option"),c=a.ta(c),d?(a=Wy(a,1),c.insertBefore(b.g.s("div",a),c.firstChild||null)):c.removeChild(c.firstChild))}h.$c=function(a){switch(a){case 2:return Wy(this,0);case 16:case 8:return"goog-option-selected";default:return Vy.m.$c.call(this,a)}};h.ef=function(a){var b=Wy(this,0);switch(a){case "goog-option-selected":return 16;case b:return 2;default:return Vy.m.ef.call(this,a)}};h.B=function(){return"goog-menuitem"};function $y(a,b,c,d){Gv.call(this,a,d||Vy.T(),c);this.na(b)}A($y,Gv);h=$y.prototype;h.U=function(){var a=this.t();return null!=a?a:this.Gb()};h.va=function(a,b){$y.m.va.call(this,a,b);switch(a){case 8:zv(this,16)&&!b&&Jv(this,16,!1)&&this.S(16,!1);var c=this.n();c&&this&&c&&Yy(this.i,this,c,b);break;case 16:(c=this.n())&&this&&c&&Yy(this.i,this,c,b)}};
h.Gb=function(){var a=this.qa();return u(a)?(a=xb(a,function(a){return Ih(a)&&(kv(a,"goog-menuitem-accel")||kv(a,"goog-menuitem-mnemonic-separator"))?"":Sh(a)}).join(""),Aa(a)):$y.m.Gb.call(this)};h.uc=function(a){var b=this.getParent();if(b){var c=b.h;b.h=null;if(b=c&&ha(a.clientX))b=new lh(a.clientX,a.clientY),b=c==b?!0:c&&b?c.x==b.x&&c.y==b.y:!1;if(b)return}$y.m.uc.call(this,a)};h.Mc=function(a){return a.g==this.Lf&&this.yb(a)?!0:$y.m.Mc.call(this,a)};h.Rh=function(){return this.Lf};
Ev("goog-menuitem",function(){return new $y(null)});$y.prototype.fd=function(){return yv(this,16)?"menuitemcheckbox":yv(this,8)?"menuitemradio":$y.m.fd.call(this)};function az(){}A(az,pv);da(az);az.prototype.Ea=function(a){return a.g.s("div",this.B())};az.prototype.ra=function(a,b){b.id&&Lu(a,b.id);if("HR"==b.tagName){var c=b;b=this.Ea(a);Fh(b,c);Gh(c)}else lv(b,this.B());return b};az.prototype.Xb=function(){};az.prototype.B=function(){return"goog-menuseparator"};function bz(a,b){Gv.call(this,null,a||az.T(),b);this.va(1,!1);this.va(2,!1);this.va(4,!1);this.va(32,!1);this.Zb=1}A(bz,Gv);bz.prototype.J=function(){bz.m.J.call(this);var a=this.n();gv(a,"separator")};Ev("goog-menuseparator",function(){return new bz});function cz(a){this.g=a||"menu"}A(cz,Pv);da(cz);h=cz.prototype;h.mf=function(a){return"UL"==a.tagName||cz.m.mf.call(this,a)};h.ad=function(a){return"HR"==a.tagName?new bz:cz.m.ad.call(this,a)};h.Db=function(a,b){return Jh(a.n(),b)};h.B=function(){return"goog-menu"};h.of=function(a){cz.m.of.call(this,a);a=a.n();hv(a,"haspopup","true")};function ez(a){bz.call(this,az.T(),a)}A(ez,bz);Ev("goog-menuseparator",function(){return new bz});function fz(a,b){Wv.call(this,Vv,b||cz.T(),a);ew(this,!1)}A(fz,Wv);h=fz.prototype;h.Bd=!0;h.B=function(){return this.vb.B()};h.Db=function(a){if(this.vb.Db(this,a))return!0;for(var b=0,c=Ru(this);b<c;b++){var d=Z(this,b);if("function"==typeof d.Db&&d.Db(a))return!0}return!1};h.Kc=function(){var a=[];Qu(this,function(b){a.push(b)});return a};h.qc=function(a,b,c){(b=fz.m.qc.call(this,a,b))&&a&&this.Z&&this.Bd&&Xv(this).focus();a&&c&&ha(c.clientX)?this.h=new lh(c.clientX,c.clientY):this.h=null;return b};
h.uf=function(a){this.Bd&&Xv(this).focus();return fz.m.uf.call(this,a)};h.rg=function(a){return a.isEnabled()&&a.Fa&&yv(a,2)};h.lb=function(a){for(var b=this.vb,c=sh(this.g.g,"div",b.B()+"-content",a),d=c.length,e=0;e<d;e++)Sv(b,this,c[e]);fz.m.lb.call(this,a)};h.pf=function(a){var b=fz.m.pf.call(this,a);b||Qu(this,function(c){!b&&c.Rh&&c.Lf==a.g&&(this.isEnabled()&&this.Ia(c),b=c.Ya(a))},this);return b};
h.Qb=function(a){fz.m.Qb.call(this,a);if(a=Z(this,a)){var b=a.n();a=this.n();var c=zj(b),d=zj(a),e=Mj(a),f=c.x-d.x-e.left,c=c.y-d.y-e.top,d=a.clientHeight-b.offsetHeight,e=a.scrollLeft,g=a.scrollTop,e=e+Math.min(f,Math.max(f-(a.clientWidth-b.offsetWidth),0)),g=g+Math.min(c,Math.max(c-d,0)),b=new lh(e,g);a.scrollLeft=b.x;a.scrollTop=b.y}};function gz(a,b,c,d){uw.call(this,a,b,c||d);if(c||d)this.j=65|(d?32:132)}A(gz,uw);function hz(){}A(hz,pv);da(hz);h=hz.prototype;h.sc=function(){return"button"};h.sb=function(a,b,c){switch(b){case 8:case 16:hv(a,"pressed",c);break;default:case 64:case 1:hz.m.sb.call(this,a,b,c)}};h.Ea=function(a){var b=hz.m.Ea.call(this,a);this.Ja(b,a.Lb());var c=a.U();c&&this.lf(b,c);yv(a,16)&&this.sb(b,16,zv(a,16));return b};h.ra=function(a,b){b=hz.m.ra.call(this,a,b);var c=this.U(b);a.aa=c;a.we(this.Lb(b));yv(a,16)&&this.sb(b,16,zv(a,16));return b};h.U=ca;h.lf=ca;h.Lb=function(a){return a.title};
h.Ja=function(a,b){a&&(b?a.title=b:a.removeAttribute("title"))};h.B=function(){return"goog-button"};function iz(){}A(iz,hz);da(iz);h=iz.prototype;h.sc=function(){};h.Ea=function(a){Hv(a,!1);a.hc&=-256;a.va(32,!1);return a.g.s("button",{"class":sv(this,a).join(" "),disabled:!a.isEnabled(),title:a.Lb()||"",value:a.U()||""},a.Gb()||"")};h.ce=function(a){return"BUTTON"==a.tagName||"INPUT"==a.tagName&&("button"==a.type||"submit"==a.type||"reset"==a.type)};h.ra=function(a,b){Hv(a,!1);a.hc&=-256;a.va(32,!1);if(b.disabled){var c=this.$c(1);lv(b,c)}return iz.m.ra.call(this,a,b)};
h.de=function(a){Y(a).listen(a.n(),"click",a.yb)};h.ee=ca;h.rf=ca;h.qf=function(a){return a.isEnabled()};h.Lc=ca;h.S=function(a,b,c){iz.m.S.call(this,a,b,c);(a=a.n())&&1==b&&(a.disabled=c)};h.U=function(a){return a.value};h.lf=function(a,b){a&&(a.value=b)};h.sb=ca;function jz(a,b,c){Gv.call(this,a,b||iz.T(),c)}A(jz,Gv);h=jz.prototype;h.U=function(){return this.aa};h.Ig=function(a){this.aa=a;this.i.lf(this.n(),a)};h.Lb=function(){return this.Y};h.Ja=function(a){this.Y=a;this.i.Ja(this.n(),a)};h.we=function(a){this.Y=a};h.H=function(){jz.m.H.call(this);delete this.aa;delete this.Y};h.J=function(){jz.m.J.call(this);if(yv(this,32)){var a=Av(this);a&&Y(this).listen(a,"keyup",this.Mc)}};
h.Mc=function(a){return 13==a.g&&"key"==a.type||32==a.g&&"keyup"==a.type?this.yb(a):32==a.g};Ev("goog-button",function(){return new jz(null)});function kz(){}A(kz,hz);da(kz);h=kz.prototype;h.Ea=function(a){var b=sv(this,a),b=a.g.s("div",{"class":"goog-inline-block "+b.join(" ")},this.Nd(a.qa(),a.g));this.Ja(b,a.Lb());tv(this,a,b);return b};h.sc=function(){return"button"};h.ta=function(a){return a&&a.firstChild.firstChild};h.Nd=function(a,b){return b.s("div","goog-inline-block "+(this.B()+"-outer-box"),b.s("div","goog-inline-block "+(this.B()+"-inner-box"),a))};h.ce=function(a){return"DIV"==a.tagName};
h.ra=function(a,b){lz(b,!0);lz(b,!1);var c;a:{c=a.g.Eg(b);var d=this.B()+"-outer-box";if(c&&kv(c,d)&&(c=a.g.Eg(c),d=this.B()+"-inner-box",c&&kv(c,d))){c=!0;break a}c=!1}c||b.appendChild(this.Nd(b.childNodes,a.g));mv(b,["goog-inline-block",this.B()]);return kz.m.ra.call(this,a,b)};h.B=function(){return"goog-custom-button"};
function lz(a,b){if(a)for(var c=b?a.firstChild:a.lastChild,d;c&&c.parentNode==a;){d=b?c.nextSibling:c.previousSibling;if(3==c.nodeType){var e=c.nodeValue;if(""==Ba(e))a.removeChild(c);else{c.nodeValue=b?e.replace(/^[\s\xa0]+/,""):e.replace(/[\s\xa0]+$/,"");break}}else break;c=d}};function mz(){}A(mz,kz);da(mz);mz.prototype.ta=function(a){return mz.m.ta.call(this,a&&a.firstChild)};mz.prototype.ra=function(a,b){var c=sh(document,"*","goog-menu",b)[0];if(c){Q(c,!1);qh(c).body.appendChild(c);var d=new fz;Pu(d,c);a.jd(d)}return mz.m.ra.call(this,a,b)};mz.prototype.Nd=function(a,b){return mz.m.Nd.call(this,[b.s("div","goog-inline-block "+(this.B()+"-caption"),a),b.s("div","goog-inline-block "+(this.B()+"-dropdown"),"\u00a0")],b)};mz.prototype.B=function(){return"goog-menu-button"};function nz(a,b,c,d,e){jz.call(this,a,c||mz.T(),d);this.va(64,!0);this.D=new gz(null,5);b&&this.jd(b);this.ea=new Sf(500);!Qi&&!Ri||vc("533.17.9")||(this.ie=!0);this.Uc=e||cz.T()}A(nz,jz);h=nz.prototype;h.ie=!1;h.J=function(){nz.m.J.call(this);oz(this,!0);this.h&&pz(this,this.h,!0);hv(this.C,"haspopup",!!this.h)};h.pa=function(){nz.m.pa.call(this);oz(this,!1);if(this.h){this.oa(!1);this.h.pa();pz(this,this.h,!1);var a=this.h.n();a&&Gh(a)}};
h.H=function(){nz.m.H.call(this);this.h&&(this.h.ca(),delete this.h);delete this.Dh;this.ea.ca()};h.hd=function(a){nz.m.hd.call(this,a);zv(this,4)&&(this.oa(!zv(this,64),a),this.h&&(this.h.nb=zv(this,64)))};h.uc=function(a){nz.m.uc.call(this,a);this.h&&!zv(this,4)&&(this.h.nb=!1)};h.yb=function(){Kv(this,!1);return!0};h.gi=function(a){this.h&&this.h.za&&!this.Db(a.target)&&this.oa(!1)};h.Db=function(a){return a&&Jh(this.n(),a)||this.h&&this.h.Db(a)||!1};
h.Mc=function(a){if(32==a.g){if(a.preventDefault(),"keyup"!=a.type)return!0}else if("key"!=a.type)return!1;if(this.h&&this.h.za){var b=this.h.Ya(a);return 27==a.g?(this.oa(!1),!0):b}return 40==a.g||38==a.g||32==a.g||13==a.g?(this.oa(!0,a),!0):!1};h.tf=function(){this.oa(!1)};h.ti=function(){zv(this,4)||this.oa(!1)};h.fe=function(a){this.ie||this.oa(!1);nz.m.fe.call(this,a)};
h.jd=function(a){var b=this.h;if(a!=b&&(b&&(this.oa(!1),this.Z&&pz(this,b,!1),delete this.h),this.Z&&hv(this.C,"haspopup",!!a),a)){this.h=a;Mu(a,this);a.qc(!1);var c=this.ie;(a.Bd=c)&&ew(a,!0);this.Z&&pz(this,a,!0)}return b};h.Yb=function(a,b){var c=nz.m.Yb.call(this,a,b);c&&!this.Fa&&this.oa(!1);return c};h.setEnabled=function(a){nz.m.setEnabled.call(this,a);this.isEnabled()||this.oa(!1)};
h.oa=function(a,b){nz.m.oa.call(this,a);if(this.h&&zv(this,64)==a){if(a)this.h.Z||this.h.render(),this.gc=yj(this.n()),this.Sb=Ej(this.n()),qz(this),this.h.Qb(!b||40!=b.g&&38!=b.g?-1:0);else{Kv(this,!1);this.h.nb=!1;var c=this.n();c&&(hv(c,"activedescendant",""),hv(c,"owns",""));null!=this.N&&(this.N=void 0,(c=this.h.n())&&Bj(c,"",""))}this.h.qc(a,!1,b);if(!this.I){var c=Y(this),d=a?c.listen:c.ka;d.call(c,this.g.g,"mousedown",this.gi,!0);this.ie&&d.call(c,this.h,"blur",this.ti);d.call(c,this.ea,Uf,
this.Ti);a?Tf(this.ea):this.ea.stop()}}};function qz(a){if(a.h.Z){var b=a.Dh||a.n(),c=a.D;a.D.h=b;b=a.h.n();a.h.za||(b.style.visibility="hidden",Q(b,!0));!a.N&&a.D.o&&a.D.j&32&&(a.N=Cj(b));c.g(b,c.i^1,null,a.N);a.h.za||(Q(b,!1),b.style.visibility="visible")}}
h.Ti=function(){var a=Ej(this.n()),b=yj(this.n()),c=this.Sb;(c=!(c==a||c&&a&&c.left==a.left&&c.width==a.width&&c.top==a.top&&c.height==a.height))||(c=this.gc,c=!(c==b||c&&b&&c.top==b.top&&c.right==b.right&&c.bottom==b.bottom&&c.left==b.left));c&&(this.Sb=a,this.gc=b,qz(this))};function pz(a,b,c){var d=Y(a);c=c?d.listen:d.ka;c.call(d,b,"action",a.tf);c.call(d,b,"highlight",a.Wh);c.call(d,b,"unhighlight",a.Xh)}function oz(a,b){var c=Y(a);(b?c.listen:c.ka).call(c,a.n(),"keydown",a.pi)}
h.Wh=function(a){var b=this.n();if(a=a.target.n()){var c=iv(a,"activedescendant");a=qh(a).getElementById(c)||a;a.id||(c=Hu.T(),a.id=Iu(c));c="";a&&(c=a.id);hv(b,"activedescendant",c);hv(b,"owns",a.id)}};h.pi=function(a){yv(this,32)&&Av(this)&&this.h&&this.h.za&&a.j()};h.Xh=function(){if(!$v(this.h)){var a=this.n();hv(a,"activedescendant","");hv(a,"owns","")}};Ev("goog-menu-button",function(){return new nz(null)});function rz(){this.h=[]}A(rz,Vy);da(rz);rz.prototype.Ea=function(a){var b=rz.m.Ea.call(this,a);lv(b,"goog-submenu");sz(this,a,b);return b};rz.prototype.ra=function(a,b){b=rz.m.ra.call(this,a,b);lv(b,"goog-submenu");sz(this,a,b);var c=sh(document,"div","goog-menu",b);if(c.length){var d=new fz(a.g),c=c[0];Q(c,!1);a.g.g.body.appendChild(c);Pu(d,c);tz(a,d)}return b};rz.prototype.Xb=function(a,b){var c=this.ta(a),d=c&&c.lastChild;rz.m.Xb.call(this,a,b);d&&c.lastChild!=d&&kv(d,"goog-submenu-arrow")&&c.appendChild(d)};
rz.prototype.de=function(a){rz.m.de.call(this,a);var b=a.R(),c=sh(a.g.g,"span","goog-submenu-arrow",b)[0];uz(a,c);c!=b.lastChild&&b.appendChild(c);a=a.n();hv(a,"haspopup","true")};function sz(a,b,c){var d=b.g.s("span");d.className="goog-submenu-arrow";uz(b,d);a.ta(c).appendChild(d)}function uz(a,b){Su(a)?(lv(b,"goog-submenu-arrow-rtl"),Kh(b,"\u25c4")):(nv(b,"goog-submenu-arrow-rtl"),Kh(b,"\u25ba"))};function vz(a,b,c,d){$y.call(this,a,b,c,d||rz.T())}A(vz,$y);h=vz.prototype;h.Zc=null;h.Vf=null;h.Hf=!1;h.wa=null;h.Td=!1;h.J=function(){vz.m.J.call(this);Y(this).listen(this.getParent(),"hide",this.ah);this.wa&&wz(this,this.wa,!0)};h.pa=function(){Y(this).ka(this.getParent(),"hide",this.ah);this.wa&&(wz(this,this.wa,!1),this.Td||(this.wa.pa(),Gh(this.wa.n())));vz.m.pa.call(this)};h.H=function(){this.wa&&!this.Td&&this.wa.ca();this.wa=null;vz.m.H.call(this)};
h.Ia=function(a,b){vz.m.Ia.call(this,a);b&&(xz(this).nb=!0);a||(this.Zc&&q.clearTimeout(this.Zc),this.Zc=Vf(this.Eb,218,this))};h.Uf=function(){var a=this.getParent();a&&$v(a)==this&&(yz(this,!0),zz(this))};h.Eb=function(){var a=this.wa;a&&a.getParent()==this&&(yz(this,!1),Qu(a,function(a){"function"==typeof a.Eb&&a.Eb()}))};function Az(a){a.Zc&&q.clearTimeout(a.Zc);a.Vf&&q.clearTimeout(a.Vf)}h.Yb=function(a,b){var c=vz.m.Yb.call(this,a,b);c&&!this.Fa&&this.Eb();return c};
function zz(a){Qu(a.getParent(),function(a){a!=this&&"function"==typeof a.Eb&&(a.Eb(),Az(a))},a)}h.Ya=function(a){var b=a.g,c=Su(this)?37:39,d=Su(this)?39:37;if(!this.Hf){if(!this.isEnabled()||b!=c&&b!=this.Lf)return!1;this.Uf();aw(xz(this));Az(this)}else if(!xz(this).Ya(a))if(b==d)this.Eb();else return!1;a.preventDefault();return!0};h.Ni=function(){this.wa.getParent()==this&&(Az(this),this.L.Ia(this),zz(this))};h.ah=function(a){a.target==this.L&&(this.Eb(),Az(this))};
h.ld=function(a){this.isEnabled()&&(Az(this),this.Vf=Vf(this.Uf,218,this));vz.m.ld.call(this,a)};h.yb=function(a){Az(this);if(yv(this,8))return vz.m.yb.call(this,a);this.Uf();return!0};
function yz(a,b){a.dispatchEvent(Ku(64,b));var c=xz(a);if(b!=a.Hf){var d=a.n();b?lv(d,"goog-submenu-open"):nv(d,"goog-submenu-open")}if(b!=c.za&&(b&&(c.Z||c.render(),c.Qb(-1)),c.qc(b),b)){var c=new uw(a.n(),6,!1),d=xz(a),e=d.n();d.za||(e.style.visibility="hidden",Q(e,!0));c.g(e,4);d.za||(Q(e,!1),e.style.visibility="visible")}a.Hf=b}function wz(a,b,c){var d=Y(a);(c?d.listen:d.ka).call(d,b,"enter",a.Ni)}h.Kc=function(){return xz(this).Kc()};
function xz(a){a.wa?a.Td&&a.wa.getParent()!=a&&Mu(a.wa,a):tz(a,new fz(a.g));a.wa.n()||a.wa.P();return a.wa}function tz(a,b){var c=a.wa;b!=c&&(c&&(a.Eb(),a.Z&&wz(a,c,!1)),a.wa=b,a.Td=!1,b&&(Mu(b,a),b.qc(!1,!0),b.Bd=!1,ew(b,!1),a.Z&&wz(a,b,!0)))}h.Db=function(a){return xz(this).Db(a)};Ev("goog-submenu",function(){return new vz(null)});function Bz(a){this.h=a;this.g=null}Bz.prototype.logger=L("ydn.crm.ui.gmail.Template");Bz.prototype.t=function(){return this.h};function Cz(a){if("FORM"!=a.tagName)return window.console.warn("FORM element require"),null;for(a=a.nextElementSibling;a&&"TABLE"!=a.tagName;)a=a.nextElementSibling;return a}function Dz(a){a=Th(a,"table");a=Th(a.parentElement,"table");return Th(a.parentElement,"table").querySelector("form")}
function Ez(a,b){if(!a)return null;var c=b||aq,d=Dz(a);if(!d)return H(c,"Gmail header FORM not found"),null;d=d.querySelector("textarea[name=to]");if(!d)return H(c,"To textarea not found."),null;d=d.parentElement.querySelector("span[email]");return d?d?d.getAttribute("email"):null:(H(c,"email span not found in TO element"),null)}
Bz.prototype.i=function(a){if(a.target instanceof $y){var b=a.target.t();window.console.log(b);a=this.t();if(b){var c=Ez(this.g,this.logger);window.console.log(c);var d=!1;c||(c=ty(a),d=!!c,window.console.log("Using target email "+c));c?Fz(this,b.id,c).A(function(a){window.console.log(a);var f=Dz(this.g),g=f.querySelector('input[name="subjectbox"]'),k=Cz(f).querySelector('div[aria-label="Message Body"]');d&&(f.querySelector('textarea[name="to"]').value=c);g.value=b.name;f=document.createElement("span");
f.innerHTML=a;k.appendChild(f)},function(a){throw a;},this):window.alert("A valid recipient email address is required in To input field.")}else window.open(rx(a)+"/index.php?module=EmailTemplates&action=EditView&return_module=EmailTemplates&return_action=DetailView",$(a))}};
function Gz(a,b){var c=new ph(b.ownerDocument);if(a.g)a.g.parentElement!=b&&(a.g.parentElement&&a.g.parentElement.removeChild(a.g),c=c.s("span"),c.className="ydn-crm crm-template inj",c.appendChild(a.g),b.insertBefore(c,b.firstElementChild),window.console.log("new template menu re-attached",b));else{a.g=b;var d=new fz(c),e=new nz("$t",d,null,c);e.Ja("Insert SugarCRM template");Hz(a,function(a){window.console.log(a);for(var b=[],c=0;c<a.length;c++)-1==b.indexOf(a[c].type)&&b.push(a[c].type);for(c=
0;c<b.length;c++)if(b[c]){for(var e=new vz(b[c],null,d.g),m=0;m<a.length;m++)if(a[m].type==b[c]){var n=new $y(a[m].name,a[m]);xz(e).W(n,!0)}d.W(e,!0)}for(m=0;m<a.length;m++)a[m].type||(n=new $y(a[m].name,a[m]),d.W(n,!0));d.W(new ez,!0);d.W(new $y("New template...",null),!0)},a);c=c.s("span");c.className="ydn-crm crm-template inj";b.insertBefore(c,b.firstElementChild);e.render(c);cd(d,"action",a.i,!0,a);window.console.log("new template menu renderred",b)}}
function Iz(a){return 0<=a.indexOf("$contact_name")||0<=a.indexOf("$contact_account_name")}function Hz(a,b,c){tx(a.t(),"EmailTemplates",void 0,void 0,void 0,200).A(function(a){a=a[0];for(var e=[],f=0;f<a.result.length;f++){var g=a.result[f];e.push({id:g.id,name:g.name,type:g.type||"",Ej:Iz(g.body_html)})}b.call(c,e)},function(a){throw a;},a)}
function Fz(a,b,c){var d=a.t();if(v(c))return d.send("query",[{store:"Contacts",index:"ydn$emails",key:c,limit:1},{store:"Leads",index:"ydn$emails",key:c,limit:1}]).w(function(a){var c=null;a[0].result[0]?c=new Ds($(d),"Contacts",a[0].result[0]):a[1].result[0]&&(c=new Ds($(d),"Leads",a[1].result[0]));a=c?new Zw(d,c):null;return Fz(this,b,a)},a);if(!v(b)||16>b.length)throw Error("valid template id required, but "+b+" found.");return d.send("get",{module:"EmailTemplates",id:b}).w(function(a){a=a.body_html;
if(v(a)){var d=this.t().j;if(d&&d.g){var g;g=this.t().l.Users;for(var k in g.module_fields)g=d.value(k),v(g)&&(a=a.replace(new RegExp("\\$user_"+k,"g"),g))}else H(this.logger,"Login user info not available");window.console.log(a);if(c&&ax(c))for(k in d=Hw(c),d.module_fields)g=c.value(k),v(g)&&(a=a.replace(new RegExp("\\$contact_"+k,"g"),g),a=a.replace(new RegExp("{::future::Contacts::"+k+"::}","g"),g));return a}throw Error("Template record: "+b+" does not have body_html");},a)};var fq="in",Jz=null;function Kz(){if(!Jz){var a=chrome.extension.getURL("image/all-icons.svg"),b=new XMLHttpRequest;b.open("GET",a,!1);b.onload=function(){Jz=b.responseXML;b=null};b.send()}return Jz}function Lz(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=Kz().documentElement.getElementById(a);d&&(c.setAttribute("viewBox",d.getAttribute("viewBox")),c.innerHTML=d.innerHTML);c.classList.add(b||"icons");c.style.pointerEvents="none";return c};function Mz(){this.i=0}var Nz=new Mz;Mz.prototype.render=function(){};Mz.prototype.h=function(){return++this.i};Mz.prototype.ga=function(){return this.i};function Oz(){this.i=0;this.g=document.createElement("div");var a=document.createElement("div");a.className="statusbar";this.g.className="message";a.appendChild(this.g)}A(Oz,Mz);Oz.prototype.render=function(a){var b=this.n();b.parentElement!=a&&(b.parentElement&&b.parentElement.removeChild(b),a.appendChild(b))};Oz.prototype.n=function(){return this.g.parentElement};
Oz.prototype.h=function(a,b){var c=Oz.m.h.call(this,a,b);this.g.textContent=a;this.g.setAttribute("title",this.g.textContent);b?this.g.classList.add("error"):this.g.classList.remove("error");return c};function Pz(a,b){E.call(this,"field-change",b);this.h=a}A(Pz,E);function Qz(a,b){E.call(this,"action",b);this.h=a}A(Qz,E);function Rz(a){var b=a.type;if(!t(b))return null;switch(b.toLowerCase()){case "checkbox":case "radio":return a.checked?a.value:null;case "select-one":return b=a.selectedIndex,0<=b?a.options[b].value:null;case "select-multiple":for(var b=[],c,d=0;c=a.options[d];d++)c.selected&&b.push(c.value);return b.length?b:null;default:return t(a.value)?a.value:null}}function oy(a,b){var c=a.elements[b];if(c){if(c.type)return Rz(c);for(var d=0;d<c.length;d++){var e=Rz(c[d]);if(e)return e}}return null};function Sz(){}da(Sz);Sz.prototype.B=function(){return"field"};function Tz(a,b){var c="ydnf-"+(a+"-"+b.name);if(b.options){if(!document.getElementById(c)){var d=document.createElement("datalist");d.id=c;for(var e in b.options)if(e){var f=document.createElement("option");f.setAttribute("value",e);d.appendChild(f)}document.body.appendChild(d)}return c}return null}Sz.prototype.g=function(a){var b=a.t(),c=a.g.s("div");c.classList.add(this.B());c.setAttribute("name",b.g);return a.C=c};
Sz.prototype.refresh=function(a,b){Q(a,!!b);if(b){var c=b.h();a.textContent=c;var d=Iw(b);d?a.setAttribute("title",d):a.removeAttribute("title");(v(c)?za(c):null==c)?a.classList.add("empty"):a.classList.remove("empty")}};Sz.prototype.h=function(a){return a.R().textContent};
function Uz(a,b){for(var c=oh(a),d=[],e=0;e<b.length;e++){var f=b[e],g=[c.s("div",{"class":"goog-menuitem-content"},f.label)];if("bool"==f.type){var k=c.s("div",{"class":"goog-menuitem-checkbox",role:"menuitem"});g.unshift(k)}g=c.s("div",{"class":"goog-menuitem",role:"bool"==f.type?"goog-menuitem-checkbox":"menuitem"},g);g.setAttribute("name",f.name);f.value&&g.classList.add("goog-option-selected");d.push(g)}e=Lz("more-vert");c=c.s("div",{"class":"flyout-menu goog-menu goog-menu-vertical",role:"menu"},
d);a.appendChild(e);a.appendChild(c)};function Vz(){}A(Vz,Sz);da(Vz);Vz.prototype.g=function(a){var b=Vz.m.g.call(this,a),c=a.t();a=a.g;var d=Iw(c),c=Kw(c),e=Iu(Hu.T()),f=a.s("input",{type:"checkbox",id:e});a=a.s("label",{"for":e},d);c&&f.setAttribute("disabled","true");f.classList.add("value");b.appendChild(f);b.appendChild(a);return b};
Vz.prototype.refresh=function(a,b){Q(a,!!b);if(b){var c=b.h(),d=v(c)?!za(c):null!=c,e=a.querySelector(".value");"bool"!=Jw(b)||ga(c)||(c="1"==c||"on"==c||"true"==c?!0:!1);e.value=c;d?a.classList.remove("empty"):a.classList.add("empty")}};Vz.prototype.h=function(a){a=a.R().querySelector(".value");return"LABEL"==a.tagName||"SPAN"==a.tagName||"DIV"==a.tagName?a.textContent:"checkbox"==a.type?a.checked:a.value};function Wz(){}A(Wz,Sz);da(Wz);Wz.prototype.g=function(a){var b=Wz.m.g.call(this,a),c=a.t();a=a.g;var d=Iw(c),d=a.s("input",{type:"text","class":"value",title:d});b.appendChild(d);c=c.j();0<c.length&&(a=a.s("div",{"class":"hover-button more-menu"}),b.appendChild(a),Uz(a,c));return b};
Wz.prototype.refresh=function(a,b){Q(a,!!b);if(b){var c=b.h(),d=v(c)?!za(c):null!=c;a.querySelector(".value").value=d?c:"";if(c=a.querySelector(".more-menu")){c.innerHTML="";var e=b.j();Uz(c,e)}d?a.classList.remove("empty"):a.classList.add("empty")}};Wz.prototype.h=function(a){return a.R().querySelector(".value").value};function Xz(){}A(Xz,Wz);da(Xz);Xz.prototype.g=function(a){var b=Xz.m.g.call(this,a),c=b.querySelector(".value");c.classList.add("enum");(a=Yz(a))&&c.setAttribute("list",a);return b};function Zz(){}A(Zz,Sz);da(Zz);Zz.prototype.g=function(a){var b=Zz.m.g.call(this,a),c=a.g;a=Iw(a.t());c=c.s("TEXTAREA");c.classList.add("value");b.appendChild(c);c.setAttribute("title",a);return b};Zz.prototype.refresh=function(a,b){Q(a,!!b);if(b){var c=b.h(),d=v(c)?!za(c):null!=c;a.querySelector(".value").value=d?c:"";d?a.classList.remove("empty"):a.classList.add("empty")}};
Zz.prototype.h=function(a){a=a.R().querySelector(".value");return"LABEL"==a.tagName||"SPAN"==a.tagName||"DIV"==a.tagName?a.textContent:"checkbox"==a.type?a.checked:a.value};function $z(a,b,c){X.call(this,c);b||(b=Jw(a),b="bool"==b?Vz.T():"text"==b?Zz.T():"enum"==b?Xz.T():Wz.T());this.h=b;this.na(a)}A($z,X);h=$z.prototype;h.P=function(){this.h.g(this)};h.J=function(){var a=this.n().querySelector("input");a&&Y(this).listen(a,"blur",this.ni);(a=this.n().getElementsByClassName("more-menu")[0])&&Y(this).listen(a,"click",this.Qi)};
h.Qi=function(a){var b=a.target,c=b.getAttribute("name");console.log(a,c);if(c){a=new Qz(c,this);this.dispatchEvent(a);var d=Th(b,null,"more-menu");Q(d,!1);setTimeout(function(){Q(d,!0)},1E3);a.p||("remove"==a.h?(b=this.zg(),this.dispatchEvent(new Pz(b,this))):"edit"==a.h&&aA(this))}};function bA(a){var b=a.t();a=Yz(a);return{Oa:[{label:Iw(b),name:b.g,value:b.h(),type:Jw(b),me:a}]}}function Yz(a){a=a.t();return Tz(a.parent.module.$(),a.i())}
function cA(a){var b=new Lx;Zx(b,Mx());b.setTitle("Edit name");b.Sd=!0;Yx(b,!0);Ox(b);b.Pd=!0;b.R().classList.add("ydn-crm");var c='<div class="field-edit-dialog"><table><tbody>';a=a.Oa;for(var d=a.length,e=0;e<d;e++)var f=a[e],c=c+('<tr class="field" name="'+gi(f.name)+'"><td class="name">'+gi(f.label)+'</td><td><input class="value" type="'+gi(f.type)+'"'+(f.me?'list="'+gi(f.me)+'"':"")+'value="'+gi(f.value)+'" /></td></tr>');c=ai(c+"</tbody></table></div>",null);b.$b=c;b.Xa&&(b.Xa.innerHTML=$h(c));
return b}function aA(a){var b=cA(bA(a));Y(a).listen(b,$x,a.sh,!1);Qf(Y(a),b,function(){Y(this).ka(b,$x,this.sh,!1)});b.eb(!0)}h.sh=function(a){if("ok"==a.key){a=a.target.R().querySelectorAll(".field");for(var b={},c=this.t(),d=0;d<a.length;d++){var e=a[d].getAttribute("name"),f=a[d].querySelector(".value").value;c.h()!=f&&(b[e]=f)}this.dispatchEvent(new Pz(b,this))}};h.ni=function(){var a=this.h.h(this);(a=this.t().l(a))&&this.dispatchEvent(new Pz(a,this))};
h.zg=function(){var a={};a[this.t().g]="";return a};h.refresh=function(){this.h.refresh(this.n(),this.t())};h.U=function(){return this.t().h()};function dA(a,b){X.call(this,b);this.na(a)}A(dA,X);dA.prototype.B=function(){return"record-body"};dA.prototype.P=function(){dA.m.P.call(this);var a=this.n();a.classList.add(this.B());a.classList.add("view")};dA.prototype.refresh=function(){for(var a=0;a<Ru(this);a++)Z(this,a).refresh()};function eA(a,b){X.call(this,b);this.na(a)}A(eA,X);eA.prototype.R=function(){return rh("content",this.n())};eA.prototype.B=function(){return"record-group"};
eA.prototype.P=function(){var a=this.g,b=a.s("div",this.B()),c=a.s("div","header"),a=a.s("div","content");b.appendChild(c);b.appendChild(a);this.C=b;c=this.t();b.setAttribute("name",c.g);var a=c.module,d=a.parent.o||null,a=x(d)?Nc(d,["modules",a.$()]):null;(a=x(a)?Nc(a,["groups",c.g]):null)?c=a.normallyHide:(c=c.g,c=/address/i.test(c)?!1:0<=["email","name","phone"].indexOf(c)?!1:!0);c&&b.classList.add("normally-hide")};eA.prototype.refresh=function(){};function fA(){}da(fA);fA.prototype.g=function(a){var b=a.t(),c=a.g,d=c.s("div","field"),e=b.h(),e=c.s("input",{type:"text","class":"value",title:e});d.appendChild(e);b=b.j();u(b)?(c=c.s("div",{"class":"hover-button more-menu"}),d.appendChild(c),Uz(c,b)):x(b)&&(e=b.name==Lw?"delete-field":"detail-field",c=c.s("div",{"class":"hover-button "+e,title:b.label}),e=Lz("delete-field"==e?"delete":"more-horiz"),c.appendChild(e),c.setAttribute("name",b.name),d.appendChild(c));a.R().appendChild(d)};
fA.prototype.refresh=function(a){var b=a.t();a=a.R();Q(a,!!b);if(b){a=a.querySelector(".value");var c=b.l();"INPUT"==a.tagName?a.value=c:a.textContent=c;(b=b.h())?a.setAttribute("title",b):a.removeAttribute("title");(v(c)?za(c):null==c)?a.classList.add("empty"):a.classList.remove("empty")}};function gA(a,b,c){this.h=b||fA.T();eA.call(this,a,c)}A(gA,eA);h=gA.prototype;h.P=function(){gA.m.P.call(this);this.h.g(this)};h.J=function(){gA.m.J.call(this);var a=this.n().getElementsByClassName("hover-button")[0];a&&Y(this).listen(a,"click",this.Pi)};h.Pi=function(a){var b=a.target.getAttribute("name");console.log(a,b);b&&(a=new Qz(b,this),this.dispatchEvent(a),a.p||hA(this,a))};
function hA(a,b){if("edit"==b.h){var c=cA(a.Yf());Y(a).listen(c,$x,a.th,!1);Qf(Y(a),c,function(){Y(this).ka(c,$x,this.th,!1)});c.eb(!0)}}h.th=function(a){if("ok"==a.key){a=a.target.R().querySelectorAll(".field");for(var b={},c=this.t(),d=0;d<a.length;d++){var e=a[d].getAttribute("name"),f=a[d].querySelector(".value").value;Rw(c,e)!=f&&(b[e]=f)}this.dispatchEvent(new Pz(b,this))}};h.refresh=function(){this.h.refresh(this)};h.Yf=function(){return{Oa:[]}};function iA(a,b){gA.call(this,a,null,b)}A(iA,gA);iA.prototype.Yf=function(){var a=this.t(),b=[],c=Hw(a.module),d=a.g,e;for(e in c.module_fields){var f=c.module_fields[e];f.group==d&&b.push({name:e,label:f.label,type:f.type,value:Rw(a,e),me:Tz(a.module.$(),f)})}return{Oa:b}};function jA(a,b){var c=Wz.T();$z.call(this,a,c,b)}A(jA,$z);jA.prototype.zg=function(){return Pw(this.t())};function kA(a,b){var c=Wz.T();$z.call(this,a,c,b)}A(kA,$z);function lA(){}da(lA);lA.prototype.B=function(){return"record-group"};function mA(a,b,c){b||lA.T();eA.call(this,a,c)}A(mA,eA);mA.prototype.P=function(){mA.m.P.call(this);this.n();for(var a=this.t(),b=this.g,c=a.o(),d=0;d<c.length;d++){var e=a.i(c[d]),f;e instanceof Mw?f=new jA(e,b):e instanceof Xw?f=new kA(e,b):f=new $z(e,null,b);this.W(f,!0)}};mA.prototype.J=function(){mA.m.J.call(this);Y(this).listen(this,"action",this.h)};mA.prototype.h=function(){};mA.prototype.refresh=function(){for(var a=0;a<Ru(this);a++)Z(this,a).refresh()};function nA(a,b){var c=lA.T();mA.call(this,a,c,b)}A(nA,mA);function oA(){}A(oA,lA);da(oA);oA.prototype.B=function(){return"list"};function pA(a,b){var c=oA.T();mA.call(this,a,c,b)}A(pA,mA);pA.prototype.R=function(){return rh("content",this.n())};pA.prototype.refresh=function(){for(var a=0;a<Ru(this);a++)Z(this,a).refresh()};function qA(){}A(qA,fA);da(qA);qA.prototype.g=function(a){qA.m.g.call(this,a);var b=a.t(),c=ex(b.module)||"",d=a.R().querySelector(".field");a=a.g.s("a",{"class":"lunch icon-box",title:"Lunch in SugarCRM",target:$(b.module.parent),href:c});b=Lz("launch","icons-small");b.classList.add("fill");a.appendChild(b);d.insertBefore(a,d.firstElementChild)};
qA.prototype.refresh=function(a){qA.m.refresh.call(this,a);var b=ex(a.t().module);a=a.R().querySelector(".lunch");b?(a.href=b,a.style.display=""):a.style.display="none"};function rA(a,b){var c=qA.T();gA.call(this,a,c,b)}A(rA,gA);rA.prototype.Yf=function(){var a=this.t(),b=Tz(a.module.$(),Hw(a.module).module_fields.salutation);return{Oa:[{name:"salutation",label:"Salutation",type:"enum",value:Rw(a,"salutation"),me:b},{name:"first_name",label:"First name",type:"text",value:Rw(a,"first_name")},{name:"last_name",label:"Last name",type:"text",value:Rw(a,"last_name")}]}};function sA(a,b){pA.call(this,a,b)}A(sA,pA);function tA(a,b){dA.call(this,a,b)}A(tA,dA);
tA.prototype.P=function(){tA.m.P.call(this);this.n();var a=this.g,b=this.t(),c=[],d=Hw(b),e;for(e in d.module_fields){var f=d.module_fields[e].group;-1==c.indexOf(f)&&c.push(f)}d=lA.T();for(e=0;e<c.length;e++){var f=c[e],g;g=b;var k=f;g.i[k]||("name"==k?g.i[k]=new Ww(g):0<=["address","alt_address","primary_address"].indexOf(k)?g.i[k]=new Sw(g,k):g.i[k]="email"==k?new Vw(g):"phone"==k?new Yw(g):new Uw(g,k));g=g.i[k];if(g instanceof Vw)f=new nA(g,a);else if(g instanceof Sw)f=new iA(g,a);else if(g instanceof
Yw)f=new sA(g,a);else if(g instanceof Ww)f=new rA(g,a);else if(g instanceof Uw)f=new mA(g,d,a);else throw Error("Invalid group: "+f);this.W(f,!0)}};function uA(){}da(uA);function vA(a){a=a.n().querySelector(".record-footer div.message");a.textContent="";a.classList.remove("error")};function wA(){}da(wA);
wA.prototype.refresh=function(a){var b=a.t(),c=b.$(),d;d=a.n().querySelector(".record-header .title");a=a.n().querySelector(".record-header .link");ax(b)?(d.textContent=b.g.g?Ks(b.g):"",d.href=ex(b),d.target=$(b.parent),b instanceof ry?(a.textContent="",xy(b)?(a.classList.add("synced"),a.setAttribute("title","Gmail contact "+mr(b.h)+" is synced with SugarCRM "+c+" "+b.G())):(a.classList.remove("synced"),!b.h&&ax(b)&&vy(b.getParent())?(a.textContent="link",a.setAttribute("title","Link Gmail contact "+
mr(uy(b))+" with SugarCRM "+c+" "+b.G())):(a.textContent="export",a.setAttribute("title","Export SugarCRM "+c+" "+b.G()+" to Gmail My Contact"))),Q(a,!0)):Q(a,!1)):(d.textContent="",d.href="")};function xA(a){return a.querySelector(".record-header")};function yA(a,b){X.call(this,b);this.na(a)}A(yA,X);yA.prototype.B=function(){return"secondary"};yA.prototype.P=function(){yA.m.P.call(this);this.n().classList.add(this.B())};yA.prototype.J=function(){yA.m.J.call(this);var a=this.t();if(0<=Zr.indexOf(a.$())){var b=Y(this);b.listen(a,"module-change",this.h);b.listen(a,"record-change",this.h);this.h()}};
yA.prototype.h=function(){for(;this.j&&0!=this.j.length;){var a=Z(this,0);this.removeChild(a,!0);a.ca()}a=this.t();if(ax(a)){var b=a.parent,a=[{store:"Notes",index:"parent",reverse:!0,keyRange:tk([a.$(),a.G()])}];b.send("query",a).A(function(a){for(var d=0;d<a.length;d++){var e=a[d];e.result&&0<e.result.length&&(e=new Zw(this.t().parent,new Ds($(b),"Notes",e.result[0])),e=new zA(e,this.g),this.W(e,!0))}},function(a){throw a;},this)}};function zA(a,b){X.call(this,b);this.na(a);this.i=wA.T();this.h=new tA(this.t(),this.g);this.p=new yA(a,b);uA.T()}A(zA,X);h=zA.prototype;h.logger=L("ydn.crm.ui.sugar.record.Record");h.B=function(){return"record-panel"};h.R=function(){return this.n().querySelector(".content")};
h.P=function(){zA.m.P.call(this);var a=this.n(),b=this.g;a.className=this.B()+" "+this.t().$();var c=b.s("div","record-header"),d=b.s("div","content");a.appendChild(c);a.appendChild(d);Q(c,!1);var c=xA(this.n()),d=this.g,e=this.t().$(),f=d.s("div");c.appendChild(f);var g=d.s("a","title"),e=d.s("span","icon",e.substr(0,2)),k=d.s("a",{href:"#link","class":"link"});f.appendChild(e);f.appendChild(g);f.appendChild(k);g=d.s("div","toolbar");g.appendChild(d.s("a",{name:"Notes","class":"new-item",href:"#new-Notes"},
"Add Note"));g.appendChild(d.s("a",{name:"detail",href:"#detail"},"Detail"));c.appendChild(f);c.appendChild(g);this.W(this.h,!0);this.W(this.p,!0);b=b.s("div","record-footer");a.appendChild(b);b=this.g;a=this.n().querySelector(".record-footer");b=b.s("div","message");a.appendChild(b)};
h.J=function(){zA.m.J.call(this);var a=Y(this),b=this.t();a.listen(b,"click",this.Og,!1);this.n().querySelector(".record-footer");a.listen(b,"module-change",this.Og);a.listen(b,"gdata-change",this.Pg);a.listen(b,"record-change",this.Pg);a.listen(b,"record-update",this.zi);b=this.n().querySelector(".record-header");a.listen(b,"click",this.ji,!1);a.listen(this.R(),"click",this.di,!1);a.listen(this.R(),"blur",this.ci,!1);a.listen(this.n(),"dblclick",this.ei,!1);a.listen(this,["field-change"],this.oi);
AA(this)};h.oi=function(a){var b=this.t();"field-change"==a.type&&(Nz.h("saving...",void 0),dx(b,a.h).A(function(){Nz.h("saved",void 0)},function(a){Nz.h("error saving "+a.message,!0)},this))};h.di=function(a){if(a.target.classList.contains("value"))a:{var b=this.h;if(a=Th(a.target,null,"record-group"))for(var c=0;c<Ru(b);c++)if(Z(b,c).n()==a)break a}};h.ci=function(){};
h.ji=function(a){this.n().classList.add("activated");var b=a.target.getAttribute("name");if(a.target.classList.contains("new-item"))a.preventDefault(),a=cs(b),BA(this,a);else if(a.target.classList.contains("link")){a.preventDefault();var c=a.target;c.classList.contains("synced")?J(this.logger,"record in sync"):(a=this.t(),a instanceof ry&&(!a.h&&ax(a)&&vy(a.getParent())?(c.textContent="...",Dy(a).A(function(){c.textContent=""},function(a){c.textContent="error";throw a;},this)):(c.textContent="...",
By(a).A(function(){c.textContent=""},function(a){c.textContent="error";throw a;},this))))}else"detail"==b&&CA(this,a)};h.ei=function(){};function CA(a,b){b.preventDefault();var c=a.n(),d=a.h.n(),c=c.querySelector("a[name=detail]");"Detail"!=c.textContent?(c.textContent="Detail",d.classList.remove("detail")):(c.textContent="Less",d.classList.add("detail"))}function BA(a,b){var c=a.t().parent,c=new Zw(c,new Ds($(c),b)),c=new zA(c,a.g);a.p.W(c,!0)}
h.Og=function(){this.removeChild(this.h,!0);this.h.ca();this.h=new tA(this.t(),this.g);this.zd(this.h,0,!0);AA(this)};h.Pg=function(){AA(this)};h.zi=function(){this.refresh()};
function AA(a){var b=a.t(),c=a.n(),d=a.i,e=a.n().querySelector("a[name=detail]");e.textContent="Detail";Q(e,!0);for(var e=0<=$r.indexOf(a.t().$()),f=a.n().querySelectorAll(".new-item"),g=f.length-1;0<=g;g--)Q(f[g],e);e=a.t().$();f=xA(a.n());rh("icon",f).textContent=e.substring(0,2);d.refresh(a);vA(a);d=a.h.n();d.classList.add("view");d.classList.remove("edit");a.h.refresh();c.className=ax(b)?a.B()+" "+b.$():a.B()+" "+b.$()+" empty"}h.pa=function(){zA.m.pa.call(this)};
h.refresh=function(){ax(this.t())?this.n().classList.remove("empty"):this.n().classList.add("empty");this.i.refresh(this);vA(this);this.h.refresh()};h.toString=function(){return"ydn.crm.ui.sugar.record.Record:"+this.t()};function Jy(){pd.call(this);this.h=this.g=null}A(Jy,pd);Jy.prototype.H=function(){this.g&&(this.g.ca(),this.h=this.g=null)};function Ky(a,b){a.h=b;a.g=new Of(a);a.g.listen(b,"click",a.i,!0)}Jy.prototype.n=function(){return this.h};Jy.prototype.i=function(a){var b=this.n(),c=this.n();(c.classList.contains("error")?DA:c.href?"n":"v")==DA?(a.preventDefault(),b.textContent="Error reported, thanks.",b.removeAttribute("href"),b.removeAttribute("title"),b.classList.remove("error")):this.dispatchEvent(a)};
var DA="e";function My(a,b,c,d){a=a.n();a.classList.remove("error");c?a.href=c:a.removeAttribute("href");b?(a.textContent=b,Q(a,!0)):Q(a,!1);d?a.setAttribute("title",d):a.removeAttribute("title")}function Qy(a,b,c){a=a.n();a.classList.add("error");a.href="#error";a.textContent="error";b&&b instanceof Error&&(b=b.name+": "+b.message);a.setAttribute("title","Click to report error"+(b?" for "+b:""));c&&xe().send("log",c)};function EA(a,b){X.call(this,b);this.na(a);this.h=new Jy;this.i=new Jy}A(EA,X);h=EA.prototype;h.logger=L("ydn.crm.ui.GDataPanel");h.R=function(){return rh("gdata-content",this.n())};
h.P=function(){EA.m.P.call(this);var a=this.n(),b=this.t(),c=b.$(),d=this.g,e=d.s("div","record-root");a.appendChild(e);var a=d.s("div","gdata-header"),f=d.s("div","gdata-content");e.appendChild(a);e.appendChild(f);e.classList.add(c);d.s("span",{"class":"icon"},c.substr(0,2));c=d.s("a",{"class":"import",href:"#import"},"Add to "+c);c.style.zIndex=1E3;c=d.s("div",{"class":"import"},c);a.appendChild(c);b=new zA(b,d);this.W(b,!0)};
h.J=function(){EA.m.J.call(this);var a=this.n(),b=Y(this),c=this.t();Ky(this.h,sh(document,"A","import",a)[0]);b.listen(this.h,"click",this.mi,!1);b.listen(this.i,"click",this.si,!1);b.listen(c,["gdata-change"],this.Ng);b.listen(c,"record-change",this.Ng)};
h.Ng=function(){var a,b;b=this.t();var c=rh("gdata-header",this.n());if(ax(b))Q(c,!1);else{Q(c,!0);a=this.t();var d=uy(a),e=a.$(),f="Add to "+e;b="Add current contact "+wy(a)+" to SugarCRM "+e;ax(a)?(b=f="",d&&!xy(a)&&mr(d)):!(d=uy(a))||d instanceof py||(f="Import to "+e,b="Import existing gmail contact "+wy(a)+" to SugarCRM "+e);a=f;c.querySelector(".import").querySelector("a");a?(Q(c,!0),My(this.h,a,"#import",b)):Q(c,!1)}};
h.si=function(){var a=this.t();My(this.i,"Linking...");Dy(a).A(function(){My(this.i,"Done.");this.dispatchEvent(new E("record-change"))},function(a){a=a instanceof Error?a.name+" "+a.message:x(a)?xi(a):a;var c;c=this.n();c=Th(c,null,"sidebar");Qy(this.i,a,{"class":"RecordHeader",method:"handleLinkClick",context:"link",html:c?c.outerHTML:"",error:a})},this)};
h.mi=function(){var a=this.t();My(this.h,"Adding... to "+a.$());var b;uy(a)?(b=yy(a),b=b.w(function(){My(this.h,"Linking GData and SugarCRM...");return Dy(a)},this)):b=zy(a);b.A(function(){My(this.h,null);this.dispatchEvent(new E("change",this))},function(a){a=a instanceof Error?a.name+" "+a.message:x(a)?xi(a):a;var b;b=this.n();b=Th(b,null,"sidebar");Qy(this.h,a,{"class":"RecordHeader",method:"handleImportClick",context:"link",html:b?b.outerHTML:"",error:a})},this)};function FA(){}A(FA,az);da(FA);FA.prototype.Ea=function(a){return a.g.s("div",this.B()+" goog-inline-block","\u00a0")};FA.prototype.ra=function(a,b){b=FA.m.ra.call(this,a,b);lv(b,"goog-inline-block");return b};FA.prototype.B=function(){return"goog-toolbar-separator"};function GA(){this.g="toolbar"}A(GA,Pv);da(GA);GA.prototype.ad=function(a){return"HR"==a.tagName?new bz(FA.T()):GA.m.ad.call(this,a)};GA.prototype.B=function(){return"goog-toolbar"};GA.prototype.Dg=function(){return Uv};function HA(a,b,c){Wv.call(this,b,a||GA.T(),c)}A(HA,Wv);HA.prototype.ed=function(a){HA.m.ed.call(this,a);this.nb||aw(this)};function IA(a){pd.call(this);this.g=[];JA(this,a)}A(IA,pd);IA.prototype.h=null;function JA(a,b){b&&(vb(b,function(a){KA(a,!1)},a),Hb(a.g,b))}IA.prototype.Kc=function(){return Gb(this.g)};function LA(a){var b=a.h;return b?tb(a.g,b):-1}IA.prototype.clear=function(){Db(this.g);this.h=null};IA.prototype.H=function(){IA.m.H.call(this);delete this.g;this.h=null};function KA(a,b){a&&"function"==typeof a.Rc&&a.Rc(b)};function MA(a,b,c,d,e){nz.call(this,a,b,c,d,e||new cz("listbox"));this.M=this.qa();this.ba=null;this.sf="listbox"}A(MA,nz);h=MA.prototype;h.ha=null;h.J=function(){MA.m.J.call(this);NA(this);OA(this)};h.lb=function(a){MA.m.lb.call(this,a);(a=this.Gb())?(this.M=a,NA(this)):PA(this)||this.ha&&QA(this,this.ha.g[0]||null)};h.H=function(){MA.m.H.call(this);this.ha&&(this.ha.ca(),this.ha=null);this.M=null};h.tf=function(a){QA(this,a.target);MA.m.tf.call(this,a);a.j();this.dispatchEvent("action")};
h.Ai=function(){var a=PA(this);MA.m.Ig.call(this,a&&a.U());NA(this)};h.jd=function(a){var b=MA.m.jd.call(this,a);a!=b&&(this.ha&&this.ha.clear(),a&&(this.ha?Qu(a,function(a){RA(a);var b=this.ha,e=b.g.length;a&&(KA(a,!1),Ib(b.g,e,0,a))},this):SA(this,a)));return b};function QA(a,b){if(a.ha){var c=PA(a),d=a.ha;b!=d.h&&(KA(d.h,!1),d.h=b,KA(b,!0));d.dispatchEvent("select");b!=c&&a.dispatchEvent("change")}}
h.Ig=function(a){if(null!=a&&this.ha)for(var b=0,c;c=this.ha.g[b]||null;b++)if(c&&"function"==typeof c.U&&c.U()==a){QA(this,c);return}QA(this,null)};h.U=function(){var a=PA(this);return a?a.U():null};function PA(a){return a.ha?a.ha.h:null}function SA(a,b){a.ha=new IA;b&&Qu(b,function(a){RA(a);var b=this.ha,e=b.g.length;a&&(KA(a,!1),Ib(b.g,e,0,a))},a);OA(a)}function OA(a){a.ha&&Y(a).listen(a.ha,"select",a.Ai)}
function NA(a){var b=PA(a),c=b?b.Gb():a.M;a.i.Xb(a.n(),c);a.Mb=c;(c=a.i.ta(a.n()))&&a.g.Ki(c)&&(null==a.ba&&(a.ba=iv(c,"label")),b=(b=b?b.n():null)?iv(b,"label"):a.ba,hv(c,"label",b),TA(a))}function TA(a){var b=a.i;if(b&&(b=b.ta(a.n()))){var c=a.C;b.id||(b.id=Iu(Hu.T()));gv(b,"option");hv(c,"activedescendant",b.id);a.ha&&(hv(b,"setsize",a.ha.g.length),hv(b,"posinset",1+LA(a.ha)))}}function RA(a){a.sf=a instanceof $y?"option":"separator"}
h.oa=function(a,b){MA.m.oa.call(this,a,b);zv(this,64)?(this.h||this.jd(new fz(this.g,this.Uc)),(this.h||null).Qb(this.ha?LA(this.ha):-1)):TA(this)};Ev("goog-select",function(){return new MA(null)});function UA(){}A(UA,mz);da(UA);UA.prototype.B=function(){return"goog-toolbar-menu-button"};function VA(a,b,c,d){MA.call(this,a,b,c||UA.T(),d)}A(VA,MA);Ev("goog-toolbar-select",function(){return new VA(null)});function WA(){}A(WA,pv);da(WA);h=WA.prototype;h.sc=function(){};function XA(a,b,c,d){var e=d.s("div",a.B()+"-inner-box"),f=d.s("div",a.B()+"-clear","\u00d7");a=d.s("div",a.B()+"-outer-box",[e,f]);d.appendChild(b,a);d.appendChild(e,c)}h.ra=function(a,b){var c=a.g,d=b;b=c.s("div","goog-inline-block");c.Af(b,d);XA(this,b,d,c);WA.m.ra.call(this,a,b);a.Mb=d.value;return b};
h.Ea=function(a){var b=a.g,c=b.s("div","goog-inline-block "+sv(this,a).join(" "));a=b.s("input",{type:"text",value:a.qa()||"",disabled:!a.isEnabled()});XA(this,c,a,b);return c};h.ce=function(a){return"INPUT"==a.tagName&&(!a.type||"TEXT"==a.type.toUpperCase())};h.ta=function(a){if(a)a:{a=a.getElementsByTagName("input");for(var b=0;b<a.length;++b){var c=a[b];if(!c.type||"TEXT"==c.type.toUpperCase()){a=c;break a}}a=null}else a=null;return a};h.Kg=function(a){return this.ta(a.n())};h.rf=ca;h.qf=function(a){return a.isEnabled()};
h.Lc=ca;h.S=function(a,b,c){WA.m.S.call(this,a,b,c);1==b&&(a=this.ta(a.n()))&&(a.disabled=c)};h.sb=ca;h.Xb=function(a,b){var c=this.ta(a);c&&(c.value=b)};h.qa=function(a){return(a=this.ta(a))?a.value:null};h.B=function(){return"wgui-textinput"};function YA(a,b,c){Gv.call(this,a,b||WA.T(),c);Hv(this,!1);this.Cd=!0;(b=this.n())&&this.i.ee(b,!0);this.hc&=-256;this.va(32,!1);a||(this.Mb="")}A(YA,Gv);h=YA.prototype;h.J=function(){YA.m.J.call(this);var a=Av(this);if(a){var b=this.p||(this.p=new Yu);Zu(b,a);Y(this).listen(b,"key",this.Ya)}(a=rh(this.i.B()+"-clear",this.n()))&&Y(this).listen(a,"click",this.ai)};h.ai=function(a){a.preventDefault();this.i.Xb(this.n(),"");this.Mb="";this.dispatchEvent(new E("action",this))};
h.qa=function(){return this.n()?this.i.qa(this.n()):null};h.U=function(){return this.qa()};h.Gb=function(){return this.qa()||""};function ZA(a,b){this.result=b;Zw.call(this,a,new Ds($(a),b.storeName,b.record));this.g.g||$A(this)}A(ZA,Zw);function $A(a){a.parent.send("query",[{store:a.result.storeName,index:"id",key:a.result.primaryKey}]).w(function(a){a=a[0].result;if(a[0]){var c=cs(this.result.storeName);this.zb(new Ds($(this.parent),c,a[0]))}},a)}function aB(a,b){b&&(a.result=b,b.record?a.zb(new Ds($(a.parent),b.storeName,b.record)):b.storeName&&t(b.primaryKey)&&$A(a))}
ZA.prototype.clear=function(){this.Sa()||(this.zb(null),this.result=null)};ZA.prototype.toString=function(){return"ydn.crm.sugar.model.ResultRecord:"+this.g};ZA.prototype.Sa=function(){return!ax(this)&&!this.result};function bB(a,b){X.call(this,a);this.na(b);this.i=new X(a);this.h=null;this.p=[];this.D=0}A(bB,X);h=bB.prototype;h.B=function(){return"browse-panel"};
h.P=function(){bB.m.P.call(this);var a=this.g,b=this.n();b.classList.add(this.B());var c=a.s("div","header");b.appendChild(c);this.h=new HA(null,null,a);for(var d=new fz(a),e=0;e<Yr.length;e++)d.W(new $y(Yr[e]),!0);e=new VA("Module",d,null,a);this.h.W(e,!0);d=new YA("");this.h.W(d,!0);this.h.render(c);e.Yb(!1);a=a.s("div","content");b.appendChild(a);this.W(this.i,!0);b=d.n().querySelector("input");b.setAttribute("placeholder","Search ...");b.setAttribute("title","Search name, email, phone, id, title, description, etc.")};
h.J=function(){bB.m.J.call(this);var a=Z(this.h,1);Y(this).listen(a,"action",this.lj,!0)};function cB(a,b){if(b){for(var c=Ru(a.i),d=0;d<c;d++){var e=Z(a.i,d).t();if(e.Sa()){aB(e,b);return}}30<c?(e=Z(a.i,0).t(),aB(e,b)):(c=new ZA(a.t(),b),c=new zA(c,a.g),a.i.W(c,!0))}}function dB(a,b,c,d){tx(a.t(),b,c,d,!0).A(function(a){var b=a[0];b.result[0]&&(a=cs(b.store),b=b.result[0],cB(this,{storeName:a,primaryKey:b.id,record:b,value:d,tokens:[{keyPath:c}]}));eB(this)},function(a){eB(this);throw a;},a)}
function fB(a){var b=a+.1,c=["rgb(255, 255, 255) 0%"];99>a&&(c[1]="rgb(135, 224, 253) "+a.toFixed(1)+"%",c[2]="rgb(255, 255, 255) "+b.toFixed(1)+"%");c.push("rgb(255, 255, 255) 100%");return"linear-gradient(to right, "+c.join(", ")+")"}function gB(a,b){0==a.D&&(a.D=b);var c=100*(a.D-b)/a.D,d=Z(a.h,1).n();sh(document,"input",null,d)[0].style.background=fB(c)}
function eB(a){var b=a.p[0];if(b){b.La++;gB(a,4*(a.p.length-1)+(4-b.La));var c=a.t();0==b.La?dB(a,b.module,"id",b.$a):1==b.La?dB(a,b.module,"ydn$emails",b.$a):2==b.La?(c=b.$a.match(/\d/g),3>(c?c.length:0)?eB(a):dB(a,b.module,"ydn$phones",b.$a)):3==b.La?ux(c,b.module,b.$a).A(function(a){a=a[0].fullTextResult;for(var b=a.length||0,c=0;c<b;c++)cB(this,a[c]);eB(this)},function(a){throw a;},a):(a.p.shift(),0<a.p.length&&eB(a))}}
h.lj=function(){for(var a=Z(this.h,1).qa(),b=Ru(this.i)-1;0<=b;b--)Z(this.i,b).t().clear();this.D=0;if(a&&(a=a.trim(),2<=a.length)){b=(b=PA(Z(this.h,0)))?b.Gb():null;this.p.length=0;if(b)this.p[0]={module:b,$a:a,La:-1};else for(b=0;b<Yr.length;b++)this.p[b]={module:Yr[b],$a:a,La:-1};eB(this)}};h.R=function(){return rh("content",this.n())};var hB;function iB(a){var b=z(),c=Math.floor((b-a)/6E4),b=!1;0>c&&(b=!0,c*=-1);if(60>c)return hB(c,b,0);c=Math.floor(c/60);if(24>c)return hB(c,b,1);c=new Date(z());c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);c=Math.ceil((c.getTime()-a)/864E5);b&&(c*=-1);return 14>c?hB(c,b,2):""}
hB=function(a,b,c){var d=Ze(a);return b||0!=c?b&&0==c?1==a?"in "+(d+" minute"):"in "+(d+" minutes"):b||1!=c?b&&1==c?1==a?"in "+(d+" hour"):"in "+(d+" hours"):b||2!=c?b&&2==c?1==a?"in "+(d+" day"):"in "+(d+" days"):"":1==a?d+" day ago":d+" days ago":1==a?d+" hour ago":d+" hours ago":1==a?d+" minute ago":d+" minutes ago"};function jB(a,b){X.call(this,b);this.na(a)}A(jB,X);h=jB.prototype;h.B=function(){return"detail-panel"};h.P=function(){jB.m.P.call(this);var a=this.g,b=this.n();b.classList.add(this.B());b.appendChild(a.s("div","header"));b.appendChild(a.s("div","content"))};h.R=function(){return this.n().querySelector(".content")};h.J=function(){jB.m.J.call(this)};h.clear=function(){this.R().innerHTML="";this.n().querySelector(".header").innerHTML=""};
function kB(a,b){var c=a.t().j.G(),d=Qs(new Date),c=R.bound([c,d],[c,"\uffff"]);return{store:bs[b],index:Is(bs[b]),keyRange:c}}
function lB(a){a.n();a.t().send("activity-stream").A(function(a){var c=this.g,d=c.s("span");if(0<a.length)c=Hs(a[a.length-1].date_modified),c=iB(c.getTime())||c.toLocaleDateString(),d.textContent=a.length+" records updated since "+c;else{d.appendChild(Vh(c,"No activity? Have you "));var e=c.s("a",{href:chrome.extension.getURL("setup.html")},"setup");d.appendChild(e);d.appendChild(Vh(c,"?"))}mB(this,d);for(d=0;d<a.length;d++){var c=a[d],e=this.g,f=$(this.t()),g=c._module,k=new Ds(f,g,c),l=e.s("div",
"icon",c._module.substr(0,2)),m=e.s("span"),n=k.value("modified_user_id"),p=k.value("created_by");n?(f=e.s("a",{href:ds(f,"Users",n),target:"_blank"},k.value("modified_user_name")),m.appendChild(f),m.appendChild(Vh(e," "))):p&&(f=e.s("a",{href:ds(f,"Users",p),target:"_blank"},k.value("created_by_name")),m.appendChild(f),m.appendChild(Vh(e," ")));m.appendChild(Vh(e,c.date_modified==c.date_entered?"created ":"updated "));k=e.s("a",{href:Es(k),target:"_blank"},k.value("name"));m.appendChild(k);g=g.replace(/ies$/,
"y").replace(/s$/,"");m.appendChild(Vh(e," "+g+""));g=Hs(c.date_modified);g=iB(g.getTime())||"on "+g.toLocaleDateString();m.appendChild(Vh(e," "+g+"."));e=e.s("div",null,[l,m]);e.className="detail-item record-header "+c._module;this.R().appendChild(e)}},function(a){throw a;},a)}function mB(a,b){var c=a.n().querySelector(".header");c.innerHTML="";c.appendChild(b);var d=a.g.s("div","close");d.innerHTML="&#x25B2";d.setAttribute("title","Close");d.setAttribute("name","close");c.appendChild(d)}
function nB(a,b){var c=kB(a,b);a.t().send("values",c).A(function(a){var c=this.g.s("span"),f=bs[b];c.textContent=a.length+" upcoming "+f;mB(this,c);for(c=0;c<a.length;c++){var g=a[c],k=f,l=this.g,m=new Ds($(this.t()),k,g),n=l.s("span"),k="Calls"==k?"call":"Tasks"==k?"finish":"Meetings"==k?"meet":"Opportunities"==k?"close":"do",k=k.charAt(0).toUpperCase()+k.substr(1)+" ";n.appendChild(Vh(l,k));k=l.s("a",{href:Es(m),target:"_blank"},m.value("name"));n.appendChild(k);m=m.g?Hs(m.g[Js(m.module)]):new Date("NaN");
m=iB(m.getTime())||"on "+m.toLocaleDateString();n.appendChild(Vh(l," "+m+"."));l=l.s("div",null,[n]);l.className="detail-item record-header "+g._module;this.R().appendChild(l)}},function(a){throw a;},a)};function oB(a,b){X.call(this,b);this.na(a);this.h=new mw(kw,void 0,b);this.i=new jB(a,b)}A(oB,X);h=oB.prototype;h.B=function(){return"activity-panel"};h.P=function(){oB.m.P.call(this);var a=this.g,b=this.n();lv(b,this.B());this.W(this.h,!0);b=a.s("div");b=new Ov(b);b.Ja("Activity feed");this.h.W(b,!0);b.R().classList.add("activity-feed");for(b=0;b<bs.length;b++){var c=a.s("div",null,bs[b].substr(0,2)),c=new Ov(c);c.Ja(bs[b]);this.h.W(c,!0);c.R().classList.add(bs[b]);c.Yb(!1)}this.W(this.i,!0)};
h.J=function(){oB.m.J.call(this);var a=this.t(),b=Y(this);b.listen(a,nt,this.ph);b.listen(this.h,"select",this.Ei);b.listen(this.h,"unselect",this.Fi);b.listen(this.i.n(),"click",this.fi);Q(this.n(),!1);a.isLogin()&&this.ph()};h.fi=function(a){"close"==a.target.getAttribute("name")&&(a=this.h,a.Bc(Z(a,-1)))};h.Fi=function(){this.i.clear()};h.Ei=function(){var a;a=this.h;a=Tu(a,a.ib);0==a?lB(this.i):nB(this.i,a-1)};
h.ph=function(){var a=this;setTimeout(function(){pB(a)},2E3);setTimeout(function(){qB(a)},3E3)};function pB(a){a.t().send("activity-stream").A(function(a){if(0<a.length){var c=Hs(a[a.length-1].date_modified);Q(this.n(),!0);a=a.length;var d=Z(this.h,0),e=d.R().firstElementChild;0<a?(e.textContent=a,c=iB(c.getTime())||c.toLocaleDateString(),d.Ja(a+" records updated since "+c)):(e.textContent="Fe",d.Ja(""))}},function(a){throw a;},a)}
function qB(a,b){var c=b||0;if(!(c>=bs.length)){var d=kB(a.i,c);a.t().send("keys",d).A(function(a){qB(this,c+1);Q(this.n(),!0);var b=bs[c];a=a.length;var d=bs.indexOf(b),d=Z(this.h,d+1),k=d.R().firstElementChild;a?(k.textContent=a,d.Ja(a+" upcoming "+b),d.Yb(!0)):(k.textContent=b.substr(0,2),d.Ja(""),d.Yb(!1))},function(a){throw a;},a)}};function rB(a,b){X.call(this,b);this.na(a)}A(rB,X);h=rB.prototype;h.logger=L("ydn.crm.ui.sugar.Header");h.B=function(){return"sugar-header"};h.R=function(){return this.n().querySelector(".sugar-header-content")};
h.P=function(){rB.m.P.call(this);var a=this.n(),b=this.t(),c=this.g;lv(a,this.B());var d=c.s("a");d.textContent=$(b);d.href=rx(b);var e=Lz("sugarcrm"),e=c.s("div","icon-box",e),d=c.s("div",{"class":"main-title",title:"SugarCRM"},[e,d]);a.appendChild(d);d=[];e=chrome.extension.getURL("option-page.html")+"#credentials";e=chrome.extension.getURL("host-permission.html")+"?"+$(b);e=c.s("a",{className:"maia-button blue",href:e,target:"host-permission"},"Grant host permission");e.setAttribute("title","Your permission is required to connect your server from this extension. Without permission request to server will be slow.");
d.push(e);d=c.s("div",{"class":"host-permission"},d);a.appendChild(d);var e=c.s("input",{name:"username",type:"text"}),e=c.s("div",null,[e]),f=c.s("input",{name:"password",type:"password"}),f=c.s("div",null,[f]),g=c.s("div","message"),e=c.s("div","login-form",[e,f,g]),f=c.s("div","sugar-header-content");a.appendChild(e);a.appendChild(f);Q(d,!b.g.hostPermission);Q(e,!b.isLogin());Q(f,!!this.t().g.hostPermission);a=new bB(c,b);this.W(a,!0);b=new oB(b,c);this.W(b,!0)};
h.J=function(){rB.m.J.call(this);var a=this.n(),b=Y(this),c=this.n().querySelector(".host-permission"),a=a.querySelector(".login-form"),a=new Yu(a);b.listen(a,"key",this.kj);c=c.querySelector("a");b.listen(c,"click",np,!0);b.listen(this.t(),"hag",this.li);b.listen(this.t(),nt,this.vi)};h.vi=function(){var a=this.n().querySelector(".login-form");Q(a,!this.t().isLogin())};h.li=function(){var a=this.n().querySelector(".host-permission"),b=!!this.t().g.hostPermission;Q(a,!b);Q(this.R(),b)};
h.kj=function(a){if(13==a.g){var b=this.n().querySelector(".login-form"),c=this.t();a=b.querySelector("input[name=username]").value;var d=b.querySelector("input[name=password]").value,e=b.querySelector(".message");e.textContent="logging in...";sx(c,a,d).A(function(){c.isLogin()?(e.textContent="",Q(b,!1)):e.textContent="login failed"},function(a){e.textContent="Error: "+a},this)}};function sB(a,b){X.call(this,b);this.na(a);this.i=new Ry(a);Sy(this.i);this.h=as.map(function(c){c=new ry(a,c);return new EA(c,b)})}A(sB,X);h=sB.prototype;h.B=function(){return"sugar-panel"};h.R=function(){return this.n().querySelector(".sugar-panel-content")};
h.P=function(){sB.m.P.call(this);var a=this.g,b=this.n();lv(b,this.B());var c=a.s("div"),d=a.s("div","sugar-panel-content");b.appendChild(c);b.appendChild(d);Q(d,!1);(new rB(this.t(),a)).render(c);for(a=0;a<this.h.length;a++)this.W(this.h[a],!0)};h.J=function(){sB.m.J.call(this);Y(this).listen(this.t(),["gdata-change"],this.nj)};h.nj=function(){var a=!!ty(this.t());Q(this.R(),a)};h.logger=L("ydn.crm.ui.sugar.SugarPanel");function tB(a){X.call(this,a);this.i=ly();this.h=null}A(tB,X);h=tB.prototype;h.B=function(){return"sidebar"};h.P=function(){tB.m.P.call(this);this.n().classList.add(this.B());var a=new wx;this.W(a,!0)};h.J=function(){tB.m.J.call(this);Y(this).listen(ue(),"list-sugarcrm-domains",this.gj)};h.gj=function(a){"list-sugarcrm-domains"==a.type&&(a=a.getData().map(function(a){return{domain:a}}),uB(this,a))};h.logger=L("ydn.crm.ui.SidebarPanel");
function vB(a,b){var c=b.domain;return a.i.Ce(c).w(function(a){a=new Fy(b,a,this.i.g.email);!this.h&&a.isLogin()&&(J(this.logger,"compose template initialized."),this.h=new Bz(a));for(var e=0;e<Ru(this);e++){var f=Z(this,e);if(f instanceof sB&&$(f.t())==c){J(this.logger,"sugar panel already exist created");return}}a=new sB(a,this.g);J(this.logger,"sugar panel "+c+" created");this.W(a,!0)},a)}
function wB(a,b){for(var c=Ru(a),d=0;d<c;d++){var e=Z(a,d);e instanceof sB&&(e=e.t(),b?e.update(b.g,b.h,b.i):e.update(null,null,null))}}h.hj=function(a){0==Ru(this)?this.init().w(function(){wB(this,a)},this):wB(this,a)};function xB(a,b){for(var c=1;c<Ru(a);c++){var d=Z(a,c);if(d instanceof sB&&$(d.t())==b)return!0}return!1}
function uB(a,b){Z(a,0).na(b);for(var c=[],d=Ru(a)-1;0<d;d--){var e=Z(a,d);e instanceof sB&&!b.some(function(a){return a.domain==$(e.t())})&&(fe(a.logger,"disposing sugar panel "+$(e.t())),e.t().ca(),a.removeChild(e,!0))}for(d=0;d<b.length;d++)if(!xB(a,b[d].domain)){fe(a.logger,"adding sugar panel "+b[d].domain);var f=b[d];f.userName?c.push(vB(a,f)):(f=xe("sugarcrm",f.domain),c.push(f.send("about").w(function(a){return vB(this,a)},a)))}return wn(c)}
h.init=function(){return 1<Ru(this)?ac():xe().send("list-sugarcrm").w(function(a){return uB(this,a)},this)};function yB(){var a;a:{a=oh().createElement("DIV");var b=ei(pw());b.match(fi);a.innerHTML=b;if(1==a.childNodes.length&&(b=a.firstChild,1==b.nodeType)){a=b;break a}}this.g=a;this.h=new tB}yB.prototype.i=function(){this.g.classList.toggle("open");var a=this.g.querySelector(".hud-button").children[1];this.g.classList.contains("open")?(a.classList.remove("arrow-drop-left"),a.classList.add("arrow-drop-right")):(a.classList.add("arrow-drop-left"),a.classList.remove("arrow-drop-right"))};
yB.prototype.render=function(){document.body.appendChild(this.g);var a=this.g.querySelector(".hud-popup"),b=this.g.querySelector(".hud-button");cd(b,"click",this.i,!1,this);a=a.querySelector(".popup-content");this.h.render(a);this.g.querySelector(".logo-box").appendChild(Lz("ydn-logo"));this.g.querySelector(".arrow-box").appendChild(Lz("arrow-drop-right"))};yB.prototype.init=function(){this.h.init()};function zB(){Oz.call(this);var a=this.n(),b=document.createElement("div");b.className="setting right";b.setAttribute("title","Setting...");cd(b,"click",this.j,!1,this);a.appendChild(b)}A(zB,Oz);zB.prototype.render=function(a){var b=this.n().querySelector(".setting");b&&(b.onclick=null);zB.m.render.call(this,a)};zB.prototype.j=function(a){a.preventDefault();ly().show()};function AB(a){if(!a){a=document.createElement("div");a.id="root-panel";a.className="inj ydn-crm";document.body.appendChild(a);Q(a,!1);var b=document.createElement("div");b.className="container";a.appendChild(b);for(var c=0;3>c;c++){var d=document.createElement("div");b.appendChild(d)}b=document.createElement("div");c=document.createElement("a");c.textContent="Setup";c.href=chrome.extension.getURL("setup.html");c.className="setup-link";b.appendChild(c);a.firstElementChild.appendChild(b);Q(b,!1);Nz=
b=new zB;b.render(a.lastElementChild)}this.g=a;this.u=!1}AB.prototype.logger=L("ydn.crm.inj.AppRenderer");AB.prototype.n=function(){return this.g};AB.prototype.i=function(){this.u=!0};AB.prototype.j=function(){};function BB(a){AB.call(this,a);this.h=!1}A(BB,AB);BB.prototype.i=function(){};
BB.prototype.j=function(a){if(!a)this.h=!1,Q(this.g,!1);else if(!this.h){for(var b,c=a,d=0;4>d;d++)if(c&&c.parentElement&&(c=c.parentElement,c.nextElementSibling&&"DIV"==c.nextElementSibling.tagName)){var c=c.parentElement,d=c.lastElementChild,e=!!d.querySelector("a[href]");b=document.createElement("div");e&&c.parentElement.contains(d)?c.parentElement.insertBefore(b,d):c.appendChild(b);break}b||(H(this.logger,"usual root position is not available, locating on second best position"),c=a.ownerDocument,
b=c.createElement("td"),b.setAttribute("colspan","2"),c=c.createElement("tr"),c.className="widget-topraw",c.appendChild(b),(a.querySelector("tbody")||a).appendChild(c));a=this.g;a.parentElement&&a.parentElement.removeChild(a);b.appendChild(a);this.h=!0;Q(a,!0)}};function CB(a){AB.call(this,a);Q(this.g,!1);a=this.h=new Bw(this.g);xw(a);a.Qg=!1;a=this.h;xw(a);a.pg=!1;this.o=document.createElement("div");this.o.className="sticker";this.l=document.createElement("div");this.l.className="disp-button";this.l.onclick=this.I.bind(this);this.o.appendChild(this.l);this.p=!1}A(CB,AB);function DB(a,b){chrome.storage.sync.get("cp-bs",function(c){c&&ha(c["cp-bs"])?(c=Math.min(Math.max(c["cp-bs"],-4),4),b.call(a,c)):b.call(a,2)})}
function EB(a,b){0==b&&(b=1);var c=0<b?1:-1;1!=c||a.h.Ta?-1==c&&a.h.Ta&&yw(a.h,!1):yw(a.h,!0);for(var c=1==c?"&#10095;":"&#10094;",d=Math.abs(b),e="",f=0;f<d;f++)e+=c;a.l.innerHTML=e;c={};c["cp-bs"]=b;chrome.storage.sync.set(c)}function FB(a){a=a.l.textContent;return(10095==a.charCodeAt(0)?-1:1)*a.length}
CB.prototype.I=function(a){a.preventDefault();a=this.h.Ta;var b=FB(this),c=Math.abs(b);"em"==du()?a?EB(this,1):2>c?EB(this,-2):-2==b&&EB(this,-3):a?EB(this,3<=c?-2:-1):(yw(this.h,!0),EB(this,2<c?4:3))};CB.prototype.show=function(){var a=new pj(0,0,0,0);yw(this.h,!1);Cw(this.h);Ew(this.h,a);Dw(this.h,new uw(this.o,0));DB(this,function(a){EB(this,a)})};
CB.prototype.i=function(){CB.m.i.call(this);this.g.parentElement&&this.g.parentElement!=document.body&&(this.g.parentElement.removeChild(this.g),document.body.appendChild(this.g));this.o.parentElement||document.body.appendChild(this.o);Q(this.g,!1);this.g.className="sticky-right inj";Q(this.g,!0);this.show()};CB.prototype.j=function(a){a?this.p||(this.p=!0,a=FB(this),a=Math.abs(a),this.h.Ta&&2==a&&EB(this,-2)):(this.p=!1,a=FB(this),a=Math.abs(a),!this.h.Ta&&2<=a&&EB(this,2==a?2:3))};function GB(a){AB.call(this,a)}A(GB,AB);GB.prototype.i=function(){if(!this.u){GB.m.i.call(this);var a=this,b=window.setInterval(function(){if(document.querySelector('a[href="http://mail.google.com/mail/help/terms.html"]')||document.querySelector('a[href="http://mail.google.com/mail/help/program_policies.html"]'))window.clearTimeout(b),window.clearTimeout(c),HB(a)},500),c=window.setTimeout(function(){window.clearTimeout(b);HB(a)},15E3)}};
function HB(a){var b=document.createElement("div");b.id="btn-show-panel";b.title="Yathit - Gmail to SugarCRM";for(var c=document.querySelectorAll("div[role=tablist]"),d=null,e=c.length-1;0<=e;e--)for(var f=c[e].childElementCount-1;0<=f;f--){var g=c[e].children[f].getAttribute("tabid");if(0<=["chat","gadgets"].indexOf(g)){d=c[e];break}}a.g.parentElement&&a.g.parentElement.removeChild(a.g);d?(c=d.parentElement,d.appendChild(b),c.insertBefore(a.g,c.firstElementChild)):(H(a.logger,"tablist not found."),
c=document.createElement("div"),document.body.appendChild(c),c.className="tabbar tabbar-failback",c.appendChild(b),lv(a.g,"root-panel-failback"),document.body.appendChild(a.g));b.appendChild(document.createElement("div"));cd(b.parentElement,"click",a.h,!0,a)}
GB.prototype.h=function(a){a="btn-show-panel"==a.target.id||"btn-show-panel"==a.target.parentElement.id;var b="none"!=this.g.style.display;if(!(a&&b||!a&&!b))for(var b=this.g.parentElement,c=0,d=b.childElementCount-1;c<d;c++){var e=b.children[c];if("tablist"==e.getAttribute("role"))break;"root-panel"==e.id?Q(e,a):a&&Q(e,!1)}};function IB(a,b){X.call(this,b);this.na(a);this.i=new Ry(a);Sy(this.i);this.h=as.map(function(c){c=new ry(a,c);return new EA(c,b)})}A(IB,X);h=IB.prototype;h.B=function(){return"sugar-panel"};h.R=function(){return this.n().querySelector(".sugar-panel-content")};h.P=function(){IB.m.P.call(this);var a=this.g,b=this.n();lv(b,this.B());var c=a.s("div"),a=a.s("div","sugar-panel-content");b.appendChild(c);b.appendChild(a);Q(a,!1);for(b=0;b<this.h.length;b++)this.W(this.h[b],!0)};
h.J=function(){IB.m.J.call(this);Y(this).listen(this.t(),["gdata-change"],this.mj)};h.mj=function(){var a=!!ty(this.t());Q(this.R(),a)};h.logger=L("ydn.crm.ui.sugar.SimpleSugarPanel");function JB(a){X.call(this,a);this.i=ly();this.h=null}A(JB,X);h=JB.prototype;h.B=function(){return"sidebar"};h.P=function(){JB.m.P.call(this);this.n().classList.add(this.B());var a=new wx;this.W(a,!0)};h.J=function(){JB.m.J.call(this);Y(this).listen(ue(),"list-sugarcrm",this.fj)};h.fj=function(a){"list-sugarcrm"==a.type&&(a=a.getData().map(function(a){return{domain:a}}),KB(this,a))};h.logger=L("ydn.crm.ui.GmailContextPanel");
function LB(a,b){var c=b.domain;return a.i.Ce(c).w(function(a){a=new Fy(b,a,this.i.g.email);!this.h&&a.isLogin()&&(J(this.logger,"compose template initialized."),this.h=new Bz(a));for(var e=0;e<Ru(this);e++){var f=Z(this,e);if(f instanceof IB&&$(f.t())==c){J(this.logger,"sugar panel already exist created");return}}a=new IB(a,this.g);J(this.logger,"sugar panel "+c+" created");this.W(a,!0)},a)}
function MB(a,b){for(var c=Ru(a),d=0;d<c;d++){var e=Z(a,d);e instanceof IB&&(e=e.t(),b?e.update(b.g,b.h,b.i):e.update(null,null,null))}}function NB(a,b){0==Ru(a)?a.init().w(function(){MB(this,b)},a):MB(a,b)}function OB(a,b){for(var c=1;c<Ru(a);c++){var d=Z(a,c);if(d instanceof IB&&$(d.t())==b)return!0}return!1}
function KB(a,b){Z(a,0).na(b);for(var c=[],d=Ru(a)-1;0<d;d--){var e=Z(a,d);e instanceof IB&&!b.some(function(a){return a.domain==$(e.t())})&&(fe(a.logger,"disposing sugar panel "+$(e.t())),e.t().ca(),a.removeChild(e,!0))}for(d=0;d<b.length;d++)if(!OB(a,b[d].domain)){fe(a.logger,"adding sugar panel "+b[d].domain);var f=b[d];f.userName?c.push(LB(a,f)):(f=xe("sugarcrm",f.domain),c.push(f.send("about").w(function(a){return LB(this,a)},a)))}return wn(c)}
h.init=function(){return 1<Ru(this)?ac():xe().send("list-sugarcrm").w(function(a){return KB(this,a)},this)};function PB(){ve("gmail");this.g=new AB;this.o=this.g.n();this.j=new JB;this.j.render(this.g.g.firstElementChild.children[1]);this.i=new Sf(400);cd(this.i,Uf,this.Hi,!0,this);this.h=0;this.u="";var a=this.history=new Gu,b=Pe(new Be(document.location.href))+"/";a.Wi=b;cd(this.history,"navigate",this.ki,!1,this);this.L=null;this.p=ly();this.l=fq;this.I=new yB}h=PB.prototype;h.logger=L("ydn.crm.inj.App");
h.Hi=function(){this.h++;this.u!=location.href&&(H(this.logger,"url already changed"),this.i.stop());40<this.h&&(H(this.logger,"sniff give up after "+this.h),this.i.stop());var a;a=(a=document.querySelector('table[role="presentation"]'))?a.querySelector("tr").children[2].querySelector("table"):null;a&&this.g&&this.g.j(a);if(a=QB(a,5<this.h))this.i.stop(),NB(this.j,a)};
function QB(a,b){if(!a)return null;var c=a.querySelector("img[jid]");if(!c){if(b){var d=a.querySelector("span[title]");if(d&&(c=d.getAttribute("title").trim(),0<c.length&&(d=document.querySelector('span[name="'+c+'"][email]'))))return d=d.getAttribute("email"),new Fw(d,c)}return null}for(d=c.getAttribute("jid");c&&"TD"!=c.tagName;)c=c.parentElement;c=c.nextElementSibling.querySelector("span[title]").getAttribute("title");return new Fw(d,c)}
h.ki=function(a){if(a.h!=this.L)if(this.L=a.h,a=du(a.h),"cp"==a){a=this.j;if(a.h){a=a.h;var b=document.querySelector('form[enctype="multipart/form-data"]');if(b){var c="tag"+z();b.setAttribute("data-ydn-tag",c);window.console.log("form tag with "+c);(b=Cz(b))?(b=b.querySelector("tbody").lastElementChild.firstElementChild.firstElementChild.firstElementChild.lastElementChild.querySelector("table"))?b=b.querySelector("td:last-child"):(window.console.warn("Compose toolbar table not found"),b=null):(window.console.warn("Compose panel table not found"),
b=null);b?(Gz(a,b),a=!0):(H(a.logger,"compose toolbar not found."),a=!1)}else H(a.logger,"compose FORM element not found."),a=!1}else H(a.logger,"SugarCRM instance not ready."),a=!1;ge(this.logger,"inject compose "+(a?"ok":"fail"))}else"em"==a?(ge(this.logger,"updating sidebar"),this.h=0,this.u=location.href,this.g&&this.g.j(null),NB(this.j,null),Tf(this.i)):this.g&&this.g.j(null)};
h.init=function(){J(this.logger,"init "+this);this.I.render();setTimeout(function(){Xp()},6E4*(.5+Math.random()));this.p.gb().A(function(){ge(this.logger,"initiating UI");var a=this.p,b=this.g.g.firstElementChild.children[0];a&&a.isLogin()?Q(b,!1):Q(b,!0);this.p.isLogin()?(this.j.init(),this.I.init(),this.history.setEnabled(!0),this.l=dq["cp-po"]||fq,this.l==fq?this.g&&this.g instanceof BB||(this.g=new BB(this.o),this.g.i()):"wg"==this.l?this.g&&this.g instanceof GB||(this.g=new GB(this.o),this.g.i()):
this.g&&this.g instanceof CB||(this.g=new CB(this.o),this.g.i())):(H(this.logger,"user not login"),this.history.setEnabled(!1))},function(a){throw a;},this)};h.toString=function(){return"inj.Main:0.10.11"};qa("ydn.debug.log",Qj);qa("ydn.crm.version","0.10.11");qa("runInjApp",function(){iq();var a=new PB;window.setTimeout(function(){a.init()},500);return a});qa("runEventApp",function(){iq();var a=new Au;a.init();yu(a);return a});qa("ydn.crm.ui.StatusBar",Mz);qa("ydn.crm.ui.SimpleStatusBar",Oz);Mz.instance=Nz;Au.prototype.xp=Au.prototype.N;function RB(a,b){X.call(this,a);this.na(b);this.i=new X(a);this.h=null;this.p=[];this.D=0}A(RB,X);h=RB.prototype;h.B=function(){return"browse-panel"};h.P=function(){RB.m.P.call(this);var a=this.g,b=this.n(),c=a.s("div","header");b.appendChild(c);b.className=this.B();this.h=new HA(null,null,a);for(var d=new fz(a),e=0;e<Yr.length;e++)d.W(new $y(Yr[e]),!0);d=new VA("Module",d,null,a);this.h.W(d,!0);this.h.W(new YA(""),!0);this.h.render(c);a=a.s("div","content");b.appendChild(a);this.W(this.i,!0)};
h.J=function(){RB.m.J.call(this);var a=Z(this.h,1);Y(this).listen(a,"action",this.jj,!0)};function SB(a,b){if(b){for(var c=Ru(a.i),d=0;d<c;d++){var e=Z(a.i,d).t();if(e.Sa()){aB(e,b);return}}30<c?(e=Z(a.i,0).t(),aB(e,b)):(c=new ZA(a.t(),b),c=new zA(c,a.g),a.i.W(c,!0))}}function TB(a,b,c,d){tx(a.t(),b,c,d,!0).A(function(a){var b=a[0];b.result[0]&&(a=cs(b.store),b=b.result[0],SB(this,{storeName:a,primaryKey:b.id,record:b,value:d,tokens:[{keyPath:c}]}));UB(this)},function(a){UB(this);throw a;},a)}
function VB(a,b){0==a.D&&(a.D=b);var c=100*(a.D-b)/a.D,d=Z(a.h,1).n();sh(document,"input",null,d)[0].style.background=fB(c)}
function UB(a){var b=a.p[0];if(b){b.La++;VB(a,4*(a.p.length-1)+(4-b.La));var c=a.t();0==b.La?TB(a,b.module,"id",b.$a):1==b.La?TB(a,b.module,"ydn$emails",b.$a):2==b.La?(c=b.$a.match(/\d/g),3>(c?c.length:0)?UB(a):TB(a,b.module,"ydn$phones",b.$a)):3==b.La?ux(c,b.module,b.$a).A(function(a){a=a[0].fullTextResult;for(var b=a.length||0,c=0;c<b;c++)SB(this,a[c]);UB(this)},function(a){throw a;},a):(a.p.shift(),0<a.p.length&&UB(a))}}
h.jj=function(){for(var a=Z(this.h,1).qa(),b=Ru(this.i)-1;0<=b;b--)Z(this.i,b).t().clear();this.D=0;if(a&&(a=a.trim(),2<=a.length)){b=(b=PA(Z(this.h,0)))?b.Gb():null;this.p.length=0;if(b)this.p[0]={module:b,$a:a,La:-1};else for(b=0;b<Yr.length;b++)this.p[b]={module:Yr[b],$a:a,La:-1};UB(this)}};h.R=function(){return rh("content",this.n())};function WB(a,b,c){$y.call(this,a,b,c);this.va(8,!0)}A(WB,$y);WB.prototype.yb=function(){return this.dispatchEvent("action")};Ev("goog-option",function(){return new WB(null)});function XB(){}A(XB,kz);da(XB);XB.prototype.B=function(){return"goog-toolbar-button"};function YB(a,b,c){jz.call(this,a,b||XB.T(),c)}A(YB,jz);Ev("goog-toolbar-button",function(){return new YB(null)});function ZB(a,b,c,d){nz.call(this,a,b,c||UA.T(),d)}A(ZB,nz);Ev("goog-toolbar-menu-button",function(){return new ZB(null)});function $B(a,b){bz.call(this,a||FA.T(),b)}A($B,bz);Ev("goog-toolbar-separator",function(){return new $B});function aC(a,b,c){jz.call(this,a,b||kz.T(),c);this.va(16,!0)}A(aC,jz);Ev("goog-toggle-button",function(){return new aC(null)});function bC(a,b,c){aC.call(this,a,b||XB.T(),c)}A(bC,aC);Ev("goog-toolbar-toggle-button",function(){return new bC(null)});function cC(){return'<div class="goog-toolbar"><div title="Select base record type" class="goog-toolbar-select">Base record<div class="goog-menu" name="base-record"><div class="goog-option" name="gmail-contact">Gmail Contacts</div><div class="goog-option" name="Contacts">Contacts</div><div class="goog-option" name="Leads">Leads</div></div></div><div title="Sort order" class="goog-toolbar-select">Sort by<div class="goog-menu" name="sort-by"><div class="goog-option" name="modified">modified</div><div class="goog-option" name="id">id</div><div class="goog-option" name="name">name</div></div></div></div><div class="content"></div>'}
cC.g="templ.ydn.crm.sugar.syncPanel";function dC(){}A(dC,pv);da(dC);dC.prototype.B=function(){return"record"};dC.prototype.Ea=function(a){return dC.m.Ea.call(this,a)};function eC(a,b){Gv.call(this,null,null,a);this.na(b)}A(eC,Gv);Cv(eC,dC);function fC(a,b){X.call(this,a);this.na(b);this.i=new X(a);this.h=new X(a)}A(fC,X);fC.prototype.R=function(){return rh("content",this.n())};fC.prototype.P=function(){fC.m.P.call(this);var a=this.n();a.innerHTML=ei(cC());Pu(new HA,rh("goog-toolbar",a));this.W(this.i,!0);this.W(this.h,!0);Q(this.h.n(),!1)};fC.prototype.J=function(){fC.m.J.call(this);this.n()};fC.prototype.refresh=function(){};qa("ydn.crm.sugar.model.Sugar",mx);qa("ydn.crm.ui.SidebarPanel",tB);qa("ydn.crm.ui.sugar.SyncPanel",fC);qa("ydn.crm.ui.sugar.SearchPanel",bB);qa("ydn.crm.ui.sugar.BrowsePanel",RB);qa("ydn.crm.ui.UserSetting",jy);jy.getInstance=ly;jy.prototype.getModuleInfo=jy.prototype.Ce;jy.prototype.getUserInfo=jy.prototype.ij;jy.prototype.onReady=jy.prototype.gb;jy.prototype.show=jy.prototype.show;jy.prototype.getGmail=jy.prototype.Qh;
mx.list=function(){var a=ly();return xe().send("list-sugarcrm").w(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.isLogin&&c.push(a.Ce(e.domain).w(function(a){return new mx(this,a)},e))}return wn(c)})};tB.prototype.update=tB.prototype.hj;qa("ydn.msg.Pipe",re);qa("ydn.msg.initPipe",ve);qa("ydn.msg.getChannel",xe);re.prototype.listen=re.prototype.listen;re.prototype.getChannel=re.prototype.j;rd.prototype.send=rd.prototype.send;qa("goog.async.Deferred",B);B.prototype.addCallback=B.prototype.w;B.prototype.addErrback=B.prototype.Vc;B.prototype.addBoth=B.prototype.fa;B.prototype.addCallbacks=B.prototype.A;})();

            //# sourceMappingURL=https://ydn-src-1.storage.googleapis.com/jsc/ydn.crm-0.10.11.js.map
        