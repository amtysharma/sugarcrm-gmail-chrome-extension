(function(){var h,aa=aa||{},r=this;function ba(a){a=a.split(".");for(var b=r,c;c=a.shift();)if(null!=b[c])b=b[c];else return null;return b}function ca(){}function da(a){a.W=function(){return a.ag?a.ag:a.ag=new a}}
function ea(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function t(a){return void 0!==a}function u(a){return"array"==ea(a)}function fa(a){var b=ea(a);return"array"==b||"object"==b&&"number"==typeof a.length}function v(a){return"string"==typeof a}function ga(a){return"boolean"==typeof a}function ha(a){return"number"==typeof a}function ia(a){return"function"==ea(a)}function x(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function ja(a){return a[ka]||(a[ka]=++la)}
var ka="closure_uid_"+(1E9*Math.random()>>>0),la=0;function ma(a,b,c){return a.call.apply(a.bind,arguments)}function na(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function y(a,b,c){y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ma:na;return y.apply(null,arguments)}function oa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var A=Date.now||function(){return+new Date};
function pa(a,b){var c=a.split("."),d=r;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function B(a,b){function c(){}c.prototype=b.prototype;a.m=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.li=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};function qa(a){a.prototype.then=a.prototype.then;a.prototype.$goog_Thenable=!0}function ra(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}};function ta(a){if(Error.captureStackTrace)Error.captureStackTrace(this,ta);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}B(ta,Error);ta.prototype.name="CustomError";var ua;function va(a,b){return 0==a.lastIndexOf(b,0)}function wa(a){var b=a.length-8;return 0<=b&&a.indexOf("#archive",b)==b}function xa(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}function ya(a){return/^[\s\xa0]*$/.test(a)}function za(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")}function Aa(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}
function Ba(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")}function Ca(a){if(!Da.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Ea,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Fa,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Ga,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Ha,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ia,"&#39;"));return a}var Ea=/&/g,Fa=/</g,Ga=/>/g,Ha=/"/g,Ia=/'/g,Da=/[&<>"']/;function Ja(a){return Ba(a.replace(/  /g," &#160;"),void 0)}
function Ka(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a}var La={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"},Ma={"'":"\\'"};
function Na(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0),f=b,g=c+1,k;if(!(k=La[d])){if(!(31<e&&127>e))if(d in Ma)d=Ma[d];else if(d in La)d=Ma[d]=La[d];else{e=d;k=d.charCodeAt(0);if(31<k&&127>k)e=d;else{if(256>k){if(e="\\x",16>k||256<k)e+="0"}else e="\\u",4096>k&&(e+="0");e+=k.toString(16).toUpperCase()}d=Ma[d]=e}k=d}f[g]=k}b.push('"');return b.join("")}function Oa(a,b){return a<b?-1:a>b?1:0}
function Pa(){return"transform".replace(/\-([a-z])/g,function(a,b){return b.toUpperCase()})}function Qa(){var a=v(void 0)?"undefined".replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return"transform".replace(new RegExp("(^"+(a?"|["+a+"]+":"")+")([a-z])","g"),function(a,c,d){return c+d.toUpperCase()})};function Ra(a,b){b.unshift(a);ta.call(this,xa.apply(null,b));b.shift()}B(Ra,ta);Ra.prototype.name="AssertionError";function Sa(a,b){throw new Ra("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};function Ta(a){ia(r.setImmediate)?r.setImmediate(a):(Ua||(Ua=Va()),Ua(a))}var Ua;
function Va(){if(r.zf&&r.zf.resolve){var a=r.zf.resolve();return function(b){a.then(b)}}var b=r.MessageChannel;"undefined"===typeof b&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&(b=function(){var a=document.createElement("iframe");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d=b.location.protocol+"//"+b.location.host,a=y(function(a){if(a.origin==
d||a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof b){var c=new b,d={},e=d;c.port1.onmessage=function(){d=d.next;var a=d.Gf;d.Gf=null;a()};return function(a){e.next={Gf:a};e=e.next;c.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("script")?function(a){var b=document.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=
null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){r.setTimeout(a,0)}};function Wa(a){Ta(function(){throw a;})}function Xa(a,b){Ya||(Ta(Za),Ya=!0);$a.push(new ab(a,b))}var Ya=!1,$a=[];[].push(function(){Ya=!1;$a=[]});function Za(){for(;$a.length;){var a=$a;$a=[];for(var b=0;b<a.length;b++){var c=a[b];try{c.g.call(c.h)}catch(d){Wa(d)}}}Ya=!1}function ab(a,b){this.g=a;this.h=b};function bb(a,b){this.g=cb;this.o=void 0;this.h=this.i=null;this.j=this.l=!1;this.p=[];db(this,Error("created"));this.u=0;try{var c=this;a.call(b,function(a){eb(c,fb,a)},function(a){eb(c,gb,a)})}catch(d){eb(this,gb,d)}}var cb=0,fb=2,gb=3;bb.prototype.then=function(a,b,c){db(this,Error("then"));return hb(this,ia(a)?a:null,ia(b)?b:null,c)};qa(bb);function ib(a){a.g==cb&&Xa(function(){var a=new jb(void 0);kb(this,a)},a)}
function kb(a,b){if(a.g==cb)if(a.i){var c=a.i;if(c.h){for(var d=0,e=-1,f=0,g;g=c.h[f];f++)if(g=g.rd)if(d++,g==a&&(e=f),0<=e&&1<d)break;0<=e&&(c.g==cb&&1==d?kb(c,b):(d=c.h.splice(e,1)[0],lb(c,d,gb,b)))}}else eb(a,gb,b)}function mb(a,b){a.h&&a.h.length||a.g!=fb&&a.g!=gb||nb(a);a.h||(a.h=[]);a.h.push(b)}
function hb(a,b,c,d){var e={rd:null,fg:null,ig:null};e.rd=new bb(function(a,g){e.fg=b?function(c){try{var e=b.call(d,c);a(e)}catch(m){g(m)}}:a;e.ig=c?function(b){try{var e=c.call(d,b);!t(e)&&b instanceof jb?g(b):a(e)}catch(m){g(m)}}:g});e.rd.i=a;mb(a,e);return e.rd}bb.prototype.C=function(a){this.g=cb;eb(this,fb,a)};bb.prototype.G=function(a){this.g=cb;eb(this,gb,a)};
function eb(a,b,c){if(a.g==cb){if(a==c)b=gb,c=new TypeError("Promise cannot resolve to itself");else{if(ra(c)){a.g=1;c.then(a.C,a.G,a);return}if(x(c))try{var d=c.then;if(ia(d)){ob(a,c,d);return}}catch(e){b=gb,c=e}}a.o=c;a.g=b;nb(a);b!=gb||c instanceof jb||pb(a,c)}}function ob(a,b,c){function d(b){f||(f=!0,a.G(b))}function e(b){f||(f=!0,a.C(b))}a.g=1;var f=!1;try{c.call(b,e,d)}catch(g){d(g)}}function nb(a){a.l||(a.l=!0,Xa(a.O,a))}
bb.prototype.O=function(){for(;this.h&&this.h.length;){var a=this.h;this.h=[];for(var b=0;b<a.length;b++)this.u++,lb(this,a[b],this.g,this.o)}this.l=!1};function lb(a,b,c,d){if(c==fb)b.fg(d);else{for(;a&&a.j;a=a.i)a.j=!1;b.ig(d)}}function db(a,b){if(v(b.stack)){var c=b.stack.split("\n",4)[3],d=b.message,d=d+Array(11-d.length).join(" ");a.p.push(d+c)}}
function pb(a,b){a.j=!0;Xa(function(){if(a.j){if(b&&v(b.stack)&&a.p.length){for(var c=["Promise trace:"],d=a;d;d=d.i){for(var e=a.u;0<=e;e--)c.push(d.p[e]);c.push("Value: ["+(d.g==gb?"REJECTED":"FULFILLED")+"] <"+String(d.o)+">")}b.stack+="\n\n"+c.join("\n")}qb.call(null,b)}})}var qb=Wa;function jb(a){ta.call(this,a)}B(jb,ta);jb.prototype.name="cancel";var rb=Array.prototype,sb=rb.indexOf?function(a,b,c){return rb.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(v(a))return v(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},tb=rb.forEach?function(a,b,c){rb.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},ub=rb.filter?function(a,b,c){return rb.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=
0,g=v(a)?a.split(""):a,k=0;k<d;k++)if(k in g){var l=g[k];b.call(c,l,k,a)&&(e[f++]=l)}return e},vb=rb.map?function(a,b,c){return rb.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=v(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},wb=rb.some?function(a,b,c){return rb.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},xb=rb.every?function(a,b,c){return rb.every.call(a,b,c)}:function(a,
b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};function yb(a,b){var c=zb(a,b,void 0);return 0>c?null:v(a)?a.charAt(c):a[c]}function zb(a,b,c){for(var d=a.length,e=v(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Ab(a,b){return 0<=sb(a,b)}function Bb(a){if(!u(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Cb(a,b){var c=sb(a,b),d;(d=0<=c)&&rb.splice.call(a,c,1);return d}
function Db(a){return rb.concat.apply(rb,arguments)}function Eb(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function Fb(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(u(d)||(e=fa(d))&&Object.prototype.hasOwnProperty.call(d,"callee"))a.push.apply(a,d);else if(e)for(var f=a.length,g=d.length,k=0;k<g;k++)a[f+k]=d[k];else a.push(d)}}function Gb(a,b,c,d){rb.splice.apply(a,Hb(arguments,1))}
function Hb(a,b,c){return 2>=arguments.length?rb.slice.call(a,b):rb.slice.call(a,b,c)}function Ib(a,b,c){for(var d=0,e=a.length,f;d<e;){var g=d+e>>1,k;k=b(c,a[g]);0<k?d=g+1:(e=g,f=!k)}return f?d:~d}function Jb(a,b){if(!fa(a)||!fa(b)||a.length!=b.length)return!1;for(var c=a.length,d=Kb,e=0;e<c;e++)if(!d(a[e],b[e]))return!1;return!0}function Lb(a,b){return a>b?1:a<b?-1:0}function Kb(a,b){return a===b}function Mb(a,b){var c=Ib(a,Nb||Lb,b);0>c&&Gb(a,-(c+1),0,b)};/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
function C(a,b){this.u=[];this.kb=a;this.aa=b||null;this.l=this.h=!1;this.j=void 0;this.ca=this.la=this.C=!1;this.o=0;this.i=null;this.T=0;this.V=null;if(Error.captureStackTrace){var c={stack:""};Error.captureStackTrace(c,C);"string"==typeof c.stack&&(this.V=c.stack.replace(/^[^\n]*\n/,""))}}function Ob(a,b){if(a.h)a.j instanceof C&&Ob(a.j);else{if(a.i){var c=a.i;delete a.i;b?Ob(c,b):(c.T--,0>=c.T&&Ob(c))}a.kb?a.kb.call(a.aa,a):a.ca=!0;a.h||a.F(new Pb)}}h=C.prototype;
h.td=function(a,b){this.C=!1;Qb(this,a,b)};function Qb(a,b,c){a.h=!0;a.j=c;a.l=!b;a.se()}function Rb(a){if(a.h){if(!a.ca)throw new Sb;a.ca=!1}}h.D=function(a){Rb(this);Qb(this,!0,a)};h.F=function(a){Rb(this);Tb(this,a);Qb(this,!1,a)};function Tb(a,b){a.V&&x(b)&&b.stack&&/^[^\n]+(\n   [^\n]+)+/.test(b.stack)&&(b.stack=b.stack+"\nDEFERRED OPERATION:\n"+a.V)}h.B=function(a,b){return this.w(a,null,b)};h.Ic=function(a,b){return this.w(null,a,b)};h.ea=function(a,b){return this.w(a,a,b)};
h.w=function(a,b,c){this.u.push([a,b,c]);this.h&&this.se();return this};h.then=function(a,b,c){var d,e,f=new bb(function(a,b){d=a;e=b});this.w(d,function(a){a instanceof Pb?ib(f):e(a)});return f.then(a,b,c)};qa(C);function Ub(a,b){a.w(b.D,b.F,b)}function Vb(a){var b=new C;Ub(a,b);return b}function Wb(a){return wb(a.u,function(a){return ia(a[1])})}
C.prototype.se=function(){this.o&&this.h&&Wb(this)&&(Xb(this.o),this.o=0);this.i&&(this.i.T--,delete this.i);for(var a=this.j,b=!1,c=!1;this.u.length&&!this.C;){var d=this.u.shift(),e=d[0],f=d[1],d=d[2];if(e=this.l?f:e)try{var g=e.call(d||this.aa,a);t(g)&&(this.l=this.l&&(g==a||g instanceof Error),this.j=a=g);ra(a)&&(this.C=c=!0)}catch(k){a=k,this.l=!0,Tb(this,a),Wb(this)||(b=!0)}}this.j=a;c&&(c=y(this.td,this,!0),g=y(this.td,this,!1),a instanceof C?(a.w(c,g),a.la=!0):a.then(c,g));b&&(a=new Yb(a),
Zb[a.Dd]=a,this.o=a.Dd)};function $b(a){var b=new C;b.D(a);return b}function E(a){var b=new C;b.F(a);return b}function Sb(){ta.call(this)}B(Sb,ta);Sb.prototype.message="Deferred has already fired";Sb.prototype.name="AlreadyCalledError";function Pb(){ta.call(this)}B(Pb,ta);Pb.prototype.message="Deferred was canceled";Pb.prototype.name="CanceledError";function Yb(a){this.Dd=r.setTimeout(y(this.h,this),0);this.g=a}Yb.prototype.h=function(){delete Zb[this.Dd];throw this.g;};var Zb={};
function Xb(a){var b=Zb[a];b&&(r.clearTimeout(b.Dd),delete Zb[a])};function ac(){0!=bc&&(cc[ja(this)]=this)}var bc=0,cc={};ac.prototype.O=!1;ac.prototype.ma=function(){if(!this.O&&(this.O=!0,this.J(),0!=bc)){var a=ja(this);delete cc[a]}};ac.prototype.J=function(){if(this.kb)for(;this.kb.length;)this.kb.shift()()};var dc;a:{var ec=r.navigator;if(ec){var fc=ec.userAgent;if(fc){dc=fc;break a}}dc=""};var gc;function hc(){return r.navigator||null}var ic=-1!=dc.indexOf("Opera")||-1!=dc.indexOf("OPR"),G=-1!=dc.indexOf("Trident")||-1!=dc.indexOf("MSIE"),jc=-1!=dc.indexOf("Gecko")&&-1==dc.toLowerCase().indexOf("webkit")&&!(-1!=dc.indexOf("Trident")||-1!=dc.indexOf("MSIE")),kc=-1!=dc.toLowerCase().indexOf("webkit"),lc=hc();gc=-1!=(lc&&lc.platform||"").indexOf("Mac");var mc=!!hc()&&-1!=(hc().appVersion||"").indexOf("X11");function nc(){var a=r.document;return a?a.documentMode:void 0}
var oc=function(){var a="",b;if(ic&&r.opera)return a=r.opera.version,ia(a)?a():a;jc?b=/rv\:([^\);]+)(\)|;)/:G?b=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:kc&&(b=/WebKit\/(\S+)/);b&&(a=(a=b.exec(dc))?a[1]:"");return G&&(b=nc(),b>parseFloat(a))?String(b):a}(),pc={};
function qc(a){var b;if(!(b=pc[a])){b=0;for(var c=Aa(String(oc)).split("."),d=Aa(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",k=d[f]||"",l=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var n=l.exec(g)||["","",""],p=m.exec(k)||["","",""];if(0==n[0].length&&0==p[0].length)break;b=Oa(0==n[1].length?0:parseInt(n[1],10),0==p[1].length?0:parseInt(p[1],10))||Oa(0==n[2].length,0==p[2].length)||Oa(n[2],p[2])}while(0==b)}b=pc[a]=0<=b}return b}
var rc=r.document,sc=rc&&G?nc()||("CSS1Compat"==rc.compatMode?parseInt(oc,10):5):void 0;var tc=!G||G&&9<=sc,uc=!G||G&&9<=sc,vc=G&&!qc("9");!kc||qc("528");jc&&qc("1.9b")||G&&qc("8")||ic&&qc("9.5")||kc&&qc("528");jc&&!qc("8")||G&&qc("9");function H(a,b){this.type=a;this.i=this.target=b;this.j=!1;this.kg=!0}H.prototype.ma=function(){};H.prototype.l=function(){this.j=!0};H.prototype.preventDefault=function(){this.kg=!1};function wc(a){wc[" "](a);return a}wc[" "]=ca;function xc(a,b){H.call(this,a?a.type:"");this.o=this.i=this.target=null;this.g=this.clientY=this.clientX=0;this.p=this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.h=null;a&&this.init(a,b)}B(xc,H);var yc=[1,4,2];
xc.prototype.init=function(a,b){var c=this.type=a.type;this.target=a.target||a.srcElement;this.i=b;var d=a.relatedTarget;if(d){if(jc){var e;a:{try{wc(d.nodeName);e=!0;break a}catch(f){}e=!1}e||(d=null)}}else"mouseover"==c?d=a.fromElement:"mouseout"==c&&(d=a.toElement);this.o=d;this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.g=a.keyCode||0;this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.p=gc?a.metaKey:
a.ctrlKey;this.h=a;a.defaultPrevented&&this.preventDefault()};function zc(a){return tc?0==a.h.button:"click"==a.type?!0:!!(a.h.button&yc[0])}xc.prototype.l=function(){xc.m.l.call(this);this.h.stopPropagation?this.h.stopPropagation():this.h.cancelBubble=!0};xc.prototype.preventDefault=function(){xc.m.preventDefault.call(this);var a=this.h;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,vc)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Ac="closure_listenable_"+(1E6*Math.random()|0);function Bc(a){try{return!(!a||!a[Ac])}catch(b){return!1}}var Cc=0;function Dc(a,b,c,d,e){this.kc=a;this.proxy=null;this.src=b;this.type=c;this.h=!!d;this.i=e;this.key=++Cc;this.g=this.qd=!1}function Ec(a){a.g=!0;a.kc=null;a.proxy=null;a.src=null;a.i=null};function Fc(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function Gc(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Hc(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Ic(a,b){for(var c=fa(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],t(a));c++);return a}function Jc(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');a[b]=c}function Kc(a,b){return b in a?a[b]:void 0}function Lc(a){var b={},c;for(c in a)b[a[c]]=c;return b}var Mc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Oc(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Mc.length;f++)c=Mc[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Pc(a){var b=arguments.length;if(1==b&&u(arguments[0]))return Pc.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c}
function Qc(a){var b=arguments.length;if(1==b&&u(arguments[0]))return Qc.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};function Rc(a){this.src=a;this.g={};this.h=0}Rc.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.g[f];a||(a=this.g[f]=[],this.h++);var g=Sc(a,b,d,e);-1<g?(b=a[g],c||(b.qd=!1)):(b=new Dc(b,this.src,f,!!d,e),b.qd=c,a.push(b));return b};Rc.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.g))return!1;var e=this.g[a];b=Sc(e,b,c,d);return-1<b?(Ec(e[b]),rb.splice.call(e,b,1),0==e.length&&(delete this.g[a],this.h--),!0):!1};
function Tc(a,b){var c=b.type;if(!(c in a.g))return!1;var d=Cb(a.g[c],b);d&&(Ec(b),0==a.g[c].length&&(delete a.g[c],a.h--));return d}Rc.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.g)if(!a||c==a){for(var d=this.g[c],e=0;e<d.length;e++)++b,Ec(d[e]);delete this.g[c];this.h--}return b};function Uc(a,b,c,d,e){a=a.g[b.toString()];b=-1;a&&(b=Sc(a,c,d,e));return-1<b?a[b]:null}
function Sc(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.g&&f.kc==b&&f.h==!!c&&f.i==d)return e}return-1};var Vc="closure_lm_"+(1E6*Math.random()|0),Wc={},Xc=0;function Yc(a,b,c,d,e){if(u(b)){for(var f=0;f<b.length;f++)Yc(a,b[f],c,d,e);return null}c=Zc(c);return Bc(a)?a.listen(b,c,d,e):$c(a,b,c,!1,d,e)}function $c(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,k=ad(a);k||(a[Vc]=k=new Rc(a));c=k.add(b,c,d,e,f);if(c.proxy)return c;d=bd();c.proxy=d;d.src=a;d.kc=c;a.addEventListener?a.addEventListener(b.toString(),d,g):a.attachEvent(cd(b.toString()),d);Xc++;return c}
function bd(){var a=dd,b=uc?function(c){return a.call(b.src,b.kc,c)}:function(c){c=a.call(b.src,b.kc,c);if(!c)return c};return b}function ed(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)ed(a,b[f],c,d,e);else c=Zc(c),Bc(a)?a.yb.add(String(b),c,!0,d,e):$c(a,b,c,!0,d,e)}function fd(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)fd(a,b[f],c,d,e);else c=Zc(c),Bc(a)?a.ua(b,c,d,e):a&&(a=ad(a))&&(b=Uc(a,b,c,!!d,e))&&gd(b)}
function gd(a){if(ha(a)||!a||a.g)return!1;var b=a.src;if(Bc(b))return Tc(b.yb,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.h):b.detachEvent&&b.detachEvent(cd(c),d);Xc--;(c=ad(b))?(Tc(c,a),0==c.h&&(c.src=null,b[Vc]=null)):Ec(a);return!0}function cd(a){return a in Wc?Wc[a]:Wc[a]="on"+a}function hd(a,b,c,d){var e=1;if(a=ad(a))if(b=a.g[b.toString()])for(b=Eb(b),a=0;a<b.length;a++){var f=b[a];f&&f.h==c&&!f.g&&(e&=!1!==id(f,d))}return Boolean(e)}
function id(a,b){var c=a.kc,d=a.i||a.src;a.qd&&gd(a);return c.call(d,b)}
function dd(a,b){if(a.g)return!0;if(!uc){var c=b||ba("window.event"),d=new xc(c,this),e=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(g){f=!0}if(f||void 0==c.returnValue)c.returnValue=!0}c=[];for(f=d.i;f;f=f.parentNode)c.push(f);for(var f=a.type,k=c.length-1;!d.j&&0<=k;k--)d.i=c[k],e&=hd(c[k],f,!0,d);for(k=0;!d.j&&k<c.length;k++)d.i=c[k],e&=hd(c[k],f,!1,d)}return e}return id(a,new xc(b,this))}
function ad(a){a=a[Vc];return a instanceof Rc?a:null}var jd="__closure_events_fn_"+(1E9*Math.random()>>>0);function Zc(a){return ia(a)?a:a[jd]||(a[jd]=function(b){return a.handleEvent(b)})};function kd(){ac.call(this);this.yb=new Rc(this);this.Va=this}B(kd,ac);kd.prototype[Ac]=!0;h=kd.prototype;h.Dc=null;h.gf=function(a){this.Dc=a};h.addEventListener=function(a,b,c,d){Yc(this,a,b,c,d)};h.removeEventListener=function(a,b,c,d){fd(this,a,b,c,d)};
h.dispatchEvent=function(a){var b,c=this.Dc;if(c)for(b=[];c;c=c.Dc)b.push(c);var c=this.Va,d=a.type||a;if(v(a))a=new H(a,c);else if(a instanceof H)a.target=a.target||c;else{var e=a;a=new H(d,c);Oc(a,e)}var e=!0,f;if(b)for(var g=b.length-1;!a.j&&0<=g;g--)f=a.i=b[g],e=ld(f,d,!0,a)&&e;a.j||(f=a.i=c,e=ld(f,d,!0,a)&&e,a.j||(e=ld(f,d,!1,a)&&e));if(b)for(g=0;!a.j&&g<b.length;g++)f=a.i=b[g],e=ld(f,d,!1,a)&&e;return e};h.J=function(){kd.m.J.call(this);this.yb&&this.yb.removeAll(void 0);this.Dc=null};
h.listen=function(a,b,c,d){return this.yb.add(String(a),b,!1,c,d)};h.ua=function(a,b,c,d){return this.yb.remove(String(a),b,c,d)};function ld(a,b,c,d){b=a.yb.g[String(b)];if(!b)return!0;b=Eb(b);for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.g&&g.h==c){var k=g.kc,l=g.i||g.src;g.qd&&Tc(a.yb,g);e=!1!==k.call(l,d)&&e}}return e&&!1!=d.kg};function md(a,b,c){this.g=a;this.h=b;this.i=c}md.prototype.send=function(a,b){var c=new nd(a),d=this.i;c.o=this.h;c.p=d;b&&(c.h=b);var d=c.j,e=this.g,f=c.toJSON();od(e).postMessage(f);e.g.push(c);50<e.g.length&&(e.g.length-=1);return d};function pd(a){H.call(this,a.req||"event");this.h=a}B(pd,H);pd.prototype.getMessage=function(){return this.h};function J(a){ta.call(this,a);this.name="ydn.error.ArgumentException"}B(J,ta);function qd(a){ta.call(this,a);this.name="ydn.error.NotSupportedException"}B(qd,ta);function sd(a){ta.call(this,a);this.name="ydn.error.NotImplementedException"}B(sd,ta);function td(a){ta.call(this,a);this.name="ydn.error.InvalidOperationException"}B(td,ta);
function ud(a){Error.captureStackTrace?Error.captureStackTrace(this,ud):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}B(ud,Error);ud.prototype.name="ydn.error.InternalError";function vd(a,b){C.call(this,a,b);this.p=[]}B(vd,C);function wd(a,b){for(var c=0;c<a.p.length;c++)a.p[c][0].call(a.p[c][1],b)}vd.prototype.D=function(a){this.p.length=0;vd.m.D.call(this,a)};vd.prototype.F=function(a){this.p.length=0;vd.m.F.call(this,a)};function nd(a){this.id="i"+this.count();this.req=a;this.i=!0;this.g=this.h=null;this.j=new vd;this.l=NaN}nd.prototype.H=function(){return this.id};var xd=0;nd.prototype.count=function(){xd++;return xd};
nd.prototype.listen=function(a){if(a&&a.id==this.id){this.h=a.data;var b=a.error;b&&(b instanceof Error?this.g=b:x(b)?(this.g=Error(b.message),this.g.name=b.name,this.g.source=b,this.g.result=this.h):(this.g=Error(b),this.g.name="UnknownError"));a.done?(this.i=!1,this.g?this.j.F(this.g):this.j.D(this.h),window.clearTimeout(this.l)):wd(this.j,a.data);return!0}return!1};nd.prototype.toString=function(){return"Message:"+this.id+(this.i?"*":"")};
nd.prototype.toJSON=function(){var a=this;this.l=window.setTimeout(function(){if(a.i){var b=Error("message timeout");b.name="TimeOutError";a.listen({id:a.id,req:a.req,error:b})}},1E4);return{id:this.id,req:this.req,group:this.o,name:this.p,data:this.h}};function yd(a){kd.call(this);var b=v(a)?null:a;this.name=v(a)?a:a.name;this.g=[];this.o=b;this.h=null;this.i={}}B(yd,kd);yd.prototype.J=function(){if(this.h){var a=this;this.h.disconnect(function(){a.h=null;a.g.length=0})}else this.g.length=0};
yd.prototype.l=function(a){if(a)if(a.id)for(var b=this.g.length-1;0<=b;b--){if(this.g[b].H()==a.id&&this.g[b].listen(a)){this.g[b].i?25<b&&(a=this.g.splice(b,1),this.g.unshift(a[0])):this.g.splice(b,1);break}}else"info"==a.req?(a.data=this.o,this.h.postMessage(a)):"html-body-inner"==a.req?(window.console.log("html",a),a.req="",a.done=!0,a.data=document&&document.body?document.body.innerHTML:"",this.h.postMessage(a)):this.dispatchEvent(new pd(a))};yd.prototype.toString=function(){return"Pipe:"+this.name};
yd.prototype.j=function(a,b){var c=a||zd,d=c+(b?"-"+b:"");this.i[d]||(this.i[d]=new md(this,c,b||""));return this.i[d]};function od(a){if(!a.h){a.h=chrome.runtime.connect({name:a.name});var b=y(a.l,a);a.h.onMessage.addListener(b);a.h.onDisconnect.addListener(function(){a.h.onMessage.removeListener(b);a.h=null;a.g.length=0})}return a.h}var Ad=null;function Bd(){if(!Ad){var a=zd+"-"+A();Ad=new yd(a)}return Ad}function Cd(a){var b=a;v(a)&&(b={group:a,name:a+"-"+A()});return Ad=new yd(b)}
var zd="default",Dd="dev gmail hostper popup options setup".split(" ");function Ed(a,b){return Bd().j(a,b)};function Fd(a){if("function"==typeof a.Ca)return a.Ca();if(v(a))return a.split("");if(fa(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Gc(a)}
function Gd(a,b){if("function"==typeof a.forEach)a.forEach(b,void 0);else if(fa(a)||v(a))tb(a,b,void 0);else{var c;if("function"==typeof a.La)c=a.La();else if("function"!=typeof a.Ca)if(fa(a)||v(a)){c=[];for(var d=a.length,e=0;e<d;e++)c.push(e)}else c=Hc(a);else c=void 0;for(var d=Fd(a),e=d.length,f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}};var Hd="StopIteration"in r?r.StopIteration:Error("StopIteration");function Id(){}Id.prototype.next=function(){throw Hd;};Id.prototype.Lb=function(){return this};function Jd(a){if(a instanceof Id)return a;if("function"==typeof a.Lb)return a.Lb(!1);if(fa(a)){var b=0,c=new Id;c.next=function(){for(;;){if(b>=a.length)throw Hd;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");}
function Kd(a,b){if(fa(a))try{tb(a,b,void 0)}catch(c){if(c!==Hd)throw c;}else{a=Jd(a);try{for(;;)b.call(void 0,a.next(),void 0,a)}catch(d){if(d!==Hd)throw d;}}}function Ld(a){if(fa(a))return Eb(a);a=Jd(a);var b=[];Kd(a,function(a){b.push(a)});return b};function Md(a,b){this.h={};this.g=[];this.j=this.i=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof Md?(c=a.La(),d=a.Ca()):(c=Hc(a),d=Gc(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}h=Md.prototype;h.fa=function(){return this.i};h.Ca=function(){Nd(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a};h.La=function(){Nd(this);return this.g.concat()};
h.Pa=function(){return 0==this.i};h.clear=function(){this.h={};this.j=this.i=this.g.length=0};h.remove=function(a){return Od(this.h,a)?(delete this.h[a],this.i--,this.j++,this.g.length>2*this.i&&Nd(this),!0):!1};function Nd(a){if(a.i!=a.g.length){for(var b=0,c=0;b<a.g.length;){var d=a.g[b];Od(a.h,d)&&(a.g[c++]=d);b++}a.g.length=c}if(a.i!=a.g.length){for(var e={},c=b=0;b<a.g.length;)d=a.g[b],Od(e,d)||(a.g[c++]=d,e[d]=1),b++;a.g.length=c}}h.get=function(a,b){return Od(this.h,a)?this.h[a]:b};
h.set=function(a,b){Od(this.h,a)||(this.i++,this.g.push(a),this.j++);this.h[a]=b};h.forEach=function(a,b){for(var c=this.La(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};h.ha=function(){return new Md(this)};h.Lb=function(a){Nd(this);var b=0,c=this.g,d=this.h,e=this.j,f=this,g=new Id;g.next=function(){for(;;){if(e!=f.j)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw Hd;var g=c[b++];return a?g:d[g]}};return g};
function Od(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var Pd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function Qd(a){if(Rd){Rd=!1;var b=r.location;if(b){var c=b.href;if(c&&(c=(c=Qd(c)[3]||null)&&decodeURIComponent(c))&&c!=b.hostname)throw Rd=!0,Error();}}return a.match(Pd)}var Rd=kc;function Sd(a,b){var c;if(a instanceof Sd)this.ec=t(b)?b:a.ec,Td(this,a.nc),this.ae=a.ae,Ud(this,a.Mb),Vd(this,a.Cd),Wd(this,a.Ec),Xd(this,a.g.ha()),Yd(this,a.te);else if(a&&(c=Qd(String(a)))){this.ec=!!b;Td(this,c[1]||"",!0);var d=c[2]||"";this.ae=d?decodeURIComponent(d):"";Ud(this,c[3]||"",!0);Vd(this,c[4]);Wd(this,c[5]||"",!0);Xd(this,c[6]||"",!0);Yd(this,c[7]||"",!0)}else this.ec=!!b,this.g=new Zd(null,0,this.ec)}h=Sd.prototype;h.nc="";h.ae="";h.Mb="";h.Cd=null;h.Ec="";h.te="";h.ec=!1;
h.toString=function(){var a=[],b=this.nc;b&&a.push($d(b,ae),":");if(b=this.Mb){a.push("//");var c=this.ae;c&&a.push($d(c,ae),"@");a.push(encodeURIComponent(String(b)));b=this.Cd;null!=b&&a.push(":",String(b))}if(b=this.Ec)this.Mb&&"/"!=b.charAt(0)&&a.push("/"),a.push($d(b,"/"==b.charAt(0)?be:ce));(b=this.g.toString())&&a.push("?",b);(b=this.te)&&a.push("#",$d(b,de));return a.join("")};h.ha=function(){return new Sd(this)};
function Td(a,b,c){a.nc=c?b?decodeURIComponent(b):"":b;a.nc&&(a.nc=a.nc.replace(/:$/,""));return a}function ee(a){return a.Mb}function Ud(a,b,c){a.Mb=c?b?decodeURIComponent(b):"":b;return a}function Vd(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Cd=b}else a.Cd=null}function fe(a){return a.Ec}function Wd(a,b,c){a.Ec=c?b?decodeURIComponent(b):"":b}function Xd(a,b,c){b instanceof Zd?(a.g=b,ge(a.g,a.ec)):(c||(b=$d(b,he)),a.g=new Zd(b,0,a.ec))}
function Yd(a,b,c){a.te=c?b?decodeURIComponent(b):"":b}function $d(a,b){return v(a)?encodeURI(a).replace(b,ie):null}function ie(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var ae=/[#\/\?@]/g,ce=/[\#\?:]/g,be=/[\#\?]/g,he=/[\#\?@]/g,de=/#/g;function Zd(a,b,c){this.g=a||null;this.h=!!c}
function je(a){if(!a.ka&&(a.ka=new Md,a.Na=0,a.g))for(var b=a.g.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=null,f=null;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c];e=decodeURIComponent(e.replace(/\+/g," "));e=ke(a,e);a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}h=Zd.prototype;h.ka=null;h.Na=null;h.fa=function(){je(this);return this.Na};h.add=function(a,b){je(this);this.g=null;a=ke(this,a);var c=this.ka.get(a);c||this.ka.set(a,c=[]);c.push(b);this.Na++;return this};
h.remove=function(a){je(this);a=ke(this,a);return Od(this.ka.h,a)?(this.g=null,this.Na-=this.ka.get(a).length,this.ka.remove(a)):!1};h.clear=function(){this.ka=this.g=null;this.Na=0};h.Pa=function(){je(this);return 0==this.Na};function le(a,b){je(a);b=ke(a,b);return Od(a.ka.h,b)}h.La=function(){je(this);for(var a=this.ka.Ca(),b=this.ka.La(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};
h.Ca=function(a){je(this);var b=[];if(v(a))le(this,a)&&(b=Db(b,this.ka.get(ke(this,a))));else{a=this.ka.Ca();for(var c=0;c<a.length;c++)b=Db(b,a[c])}return b};h.set=function(a,b){je(this);this.g=null;a=ke(this,a);le(this,a)&&(this.Na-=this.ka.get(a).length);this.ka.set(a,[b]);this.Na++;return this};h.get=function(a,b){var c=a?this.Ca(a):[];return 0<c.length?String(c[0]):b};
h.toString=function(){if(this.g)return this.g;if(!this.ka)return"";for(var a=[],b=this.ka.La(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.Ca(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f])));a.push(g)}return this.g=a.join("&")};h.ha=function(){var a=new Zd;a.g=this.g;this.ka&&(a.ka=this.ka.ha(),a.Na=this.Na);return a};function ke(a,b){var c=String(b);a.h&&(c=c.toLowerCase());return c}
function ge(a,b){b&&!a.h&&(je(a),a.g=null,a.ka.forEach(function(a,b){var e=b.toLowerCase();b!=e&&(this.remove(b),this.remove(e),0<a.length&&(this.g=null,this.ka.set(ke(this,e),Eb(a)),this.Na+=a.length))},a));a.h=b};var me;
me={l:["BC","AD"],j:["Before Christ","Anno Domini"],C:"JFMAMJJASOND".split(""),la:"JFMAMJJASOND".split(""),u:"January February March April May June July August September October November December".split(" "),ca:"January February March April May June July August September October November December".split(" "),T:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),kb:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),fi:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Xb:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
aa:"Sun Mon Tue Wed Thu Fri Sat".split(" "),Va:"Sun Mon Tue Wed Thu Fri Sat".split(" "),G:"SMTWTFS".split(""),wa:"SMTWTFS".split(""),V:["Q1","Q2","Q3","Q4"],O:["1st quarter","2nd quarter","3rd quarter","4th quarter"],g:["AM","PM"],h:["EEEE, MMMM d, y","MMMM d, y","MMM d, y","M/d/yy"],ei:["h:mm:ss a zzzz","h:mm:ss a z","h:mm:ss a","h:mm a"],i:["{1} 'at' {0}","{1} 'at' {0}","{1}, {0}","{1}, {0}"],o:6,gi:[5,6],p:5};function ne(a){a=String(a);if(void 0===me.Fg)return a;for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);b.push(48<=d&&57>=d?String.fromCharCode(me.Fg+d-48):a.charAt(c))}return b.join("")};var oe={xg:{1E3:{other:"0K"},1E4:{other:"00K"},1E5:{other:"000K"},1E6:{other:"0M"},1E7:{other:"00M"},1E8:{other:"000M"},1E9:{other:"0B"},1E10:{other:"00B"},1E11:{other:"000B"},1E12:{other:"0T"},1E13:{other:"00T"},1E14:{other:"000T"}},wg:{1E3:{other:"0 thousand"},1E4:{other:"00 thousand"},1E5:{other:"000 thousand"},1E6:{other:"0 million"},1E7:{other:"00 million"},1E8:{other:"000 million"},1E9:{other:"0 billion"},1E10:{other:"00 billion"},1E11:{other:"000 billion"},1E12:{other:"0 trillion"},1E13:{other:"00 trillion"},
1E14:{other:"000 trillion"}}},pe=oe,pe=oe;var qe={uf:".",wf:",",xf:"%",ke:"0",Dg:"+",Ag:"-",vf:"E",yf:"\u2030",je:"\u221e",Bg:"NaN",tf:"#,##0.###",Eg:"#E0",Cg:"#,##0%",yg:"\u00a4#,##0.00",zg:"USD"},re=qe,re=qe;var se={AED:[2,"dh","\u062f.\u0625.","DH"],ALL:[0,"Lek","Lek"],AUD:[2,"$","AU$"],BDT:[2,"\u09f3","Tk"],BGN:[2,"lev","lev"],BRL:[2,"R$","R$"],CAD:[2,"$","C$"],CDF:[2,"FrCD","CDF"],CHF:[2,"CHF","CHF"],CLP:[0,"$","CL$"],CNY:[2,"\u00a5","RMB\u00a5"],COP:[0,"$","COL$"],CRC:[0,"\u20a1","CR\u20a1"],CZK:[50,"K\u010d","K\u010d"],DKK:[18,"kr","kr"],DOP:[2,"$","RD$"],EGP:[2,"\u00a3","LE"],ETB:[2,"Birr","Birr"],EUR:[2,"\u20ac","\u20ac"],GBP:[2,"\u00a3","GB\u00a3"],HKD:[2,"$","HK$"],HRK:[2,"kn","kn"],HUF:[0,"Ft",
"Ft"],IDR:[0,"Rp","Rp"],ILS:[2,"\u20aa","IL\u20aa"],INR:[2,"\u20b9","Rs"],IRR:[0,"Rial","IRR"],ISK:[0,"kr","kr"],JMD:[2,"$","JA$"],JPY:[0,"\u00a5","JP\u00a5"],KRW:[0,"\u20a9","KR\u20a9"],LKR:[2,"Rs","SLRs"],LTL:[2,"Lt","Lt"],LVL:[2,"Ls","Ls"],MNT:[0,"\u20ae","MN\u20ae"],MXN:[2,"$","Mex$"],MYR:[2,"RM","RM"],NOK:[50,"kr","NOkr"],PAB:[2,"B/.","B/."],PEN:[2,"S/.","S/."],PHP:[2,"\u20b1","Php"],PKR:[0,"Rs","PKRs."],PLN:[50,"z\u0142","z\u0142"],RON:[2,"RON","RON"],RSD:[0,"din","RSD"],RUB:[50,"\u0440\u0443\u0431.",
"\u0440\u0443\u0431."],SAR:[2,"Rial","Rial"],SEK:[2,"kr","kr"],SGD:[2,"$","S$"],THB:[2,"\u0e3f","THB"],TRY:[2,"TL","YTL"],TWD:[2,"NT$","NT$"],TZS:[0,"TSh","TSh"],UAH:[2,"\u20b4","UAH"],USD:[2,"$","US$"],UYU:[2,"$","$U"],VND:[0,"\u20ab","VN\u20ab"],YER:[0,"Rial","Rial"],ZAR:[2,"R","ZAR"]};function ve(a,b,c){this.u=b||re.zg;this.kb=c||we;this.O=40;this.g=1;this.ca=0;this.j=3;this.T=this.h=0;this.wa=!1;this.G=this.l="";this.i="-";this.o="";this.C=1;this.aa=3;this.V=this.la=!1;this.p=xe;if("number"==typeof a)switch(a){case 1:ye(this,re.tf);break;case 2:ye(this,re.Eg);break;case 3:ye(this,re.Cg);break;case 4:a=re.yg;b=["0"];c=se[this.u][0]&7;if(0<c){b.push(".");for(var d=0;d<c;d++)b.push("0")}a=a.replace(/0.00/g,b.join(""));ye(this,a);break;case 5:ze(this,1);break;case 6:ze(this,2);break;
default:throw Error("Unsupported pattern type.");}else ye(this,a)}var we=0,xe=0;
function ye(a,b){b.replace(/ /g,"\u00a0");var c=[0];a.l=Ae(a,b,c);for(var d=c[0],e=-1,f=0,g=0,k=0,l=-1,m=b.length,n=!0;c[0]<m&&n;c[0]++)switch(b.charAt(c[0])){case "#":0<g?k++:f++;0<=l&&0>e&&l++;break;case "0":if(0<k)throw Error('Unexpected "0" in pattern "'+b+'"');g++;0<=l&&0>e&&l++;break;case ",":l=0;break;case ".":if(0<=e)throw Error('Multiple decimal separators in pattern "'+b+'"');e=f+g+k;break;case "E":if(a.V)throw Error('Multiple exponential symbols in pattern "'+b+'"');a.V=!0;a.T=0;c[0]+1<
m&&"+"==b.charAt(c[0]+1)&&(c[0]++,a.wa=!0);for(;c[0]+1<m&&"0"==b.charAt(c[0]+1);)c[0]++,a.T++;if(1>f+g||1>a.T)throw Error('Malformed exponential pattern "'+b+'"');n=!1;break;default:c[0]--,n=!1}0==g&&0<f&&0<=e&&(g=e,0==g&&g++,k=f-g,f=g-1,g=1);if(0>e&&0<k||0<=e&&(e<f||e>f+g)||0==l)throw Error('Malformed pattern "'+b+'"');k=f+g+k;a.j=0<=e?k-e:0;0<=e&&(a.h=f+g-e,0>a.h&&(a.h=0));a.g=(0<=e?e:k)-f;a.V&&(a.O=f+a.g,0==a.j&&0==a.g&&(a.g=1));a.aa=Math.max(0,l);a.la=0==e||e==k;d=c[0]-d;a.G=Ae(a,b,c);c[0]<b.length&&
b.charAt(c[0])==Be?(c[0]++,a.i=Ae(a,b,c),c[0]+=d,a.o=Ae(a,b,c)):(a.i=a.l+a.i,a.o+=a.G)}function ze(a,b){a.p=b;ye(a,re.tf);a.h=0;a.j=2;if(0<a.h)throw Error("Can't combine significant digits and minimum fraction digits");a.ca=2}
ve.prototype.parse=function(a,b){var c=b||[0];if(this.p!=xe)throw Error("Parsing of compact numbers is unimplemented");var d=NaN;a=a.replace(/ /g,"\u00a0");var e=a.indexOf(this.l,c[0])==c[0],f=a.indexOf(this.i,c[0])==c[0];e&&f&&(this.l.length>this.i.length?f=!1:this.l.length<this.i.length&&(e=!1));e?c[0]+=this.l.length:f&&(c[0]+=this.i.length);if(a.indexOf(re.je,c[0])==c[0])c[0]+=re.je.length,d=Infinity;else{var d=a,g=!1,k=!1,l=!1,m=1,n=re.uf,p=re.wf,q=re.vf;if(this.p!=xe)throw Error("Parsing of compact style numbers is not implemented");
for(var s="";c[0]<d.length;c[0]++){var w=d.charAt(c[0]),z=Ce(w);if(0<=z&&9>=z)s+=z,l=!0;else if(w==n.charAt(0)){if(g||k)break;s+=".";g=!0}else if(w==p.charAt(0)&&("\u00a0"!=p.charAt(0)||c[0]+1<d.length&&0<=Ce(d.charAt(c[0]+1)))){if(g||k)break}else if(w==q.charAt(0)){if(k)break;s+="E";k=!0}else if("+"==w||"-"==w)s+=w;else if(w==re.xf.charAt(0)){if(1!=m)break;m=100;if(l){c[0]++;break}}else if(w==re.yf.charAt(0)){if(1!=m)break;m=1E3;if(l){c[0]++;break}}else break}d=parseFloat(s)/m}if(e){if(a.indexOf(this.G,
c[0])!=c[0])return NaN;c[0]+=this.G.length}else if(f){if(a.indexOf(this.o,c[0])!=c[0])return NaN;c[0]+=this.o.length}return f?-d:d};function De(a,b){var c=Math.pow(10,a.j),d=0>=a.ca?Math.round(b*c):Math.floor(Ee(b*c,a.ca,a.j)),e;isFinite(d)?(e=Math.floor(d/c),c=Math.floor(d-e*c)):(e=b,c=0);return{bg:e,Kg:c}}
function Fe(a,b,c,d){if(a.h>a.j)throw Error("Min value must be less than max value");b=De(a,b);var e=Math.pow(10,a.j),f=b.bg,g=b.Kg,k=0<a.h||0<g||!1;b=a.h;k&&(b=a.h);for(var l="",m=f;1E20<m;)l="0"+l,m=Math.round(m/10);var l=m+l,n=re.uf,p=re.wf,m=re.ke.charCodeAt(0),q=l.length;if(0<f||0<c){for(f=q;f<c;f++)d.push(String.fromCharCode(m));for(f=0;f<q;f++)d.push(String.fromCharCode(m+1*l.charAt(f))),1<q-f&&0<a.aa&&1==(q-f)%a.aa&&d.push(p)}else k||d.push(String.fromCharCode(m));(a.la||k)&&d.push(n);a=""+
(g+e);for(c=a.length;"0"==a.charAt(c-1)&&c>b+1;)c--;for(f=1;f<c;f++)d.push(String.fromCharCode(m+1*a.charAt(f)))}function Ge(a,b,c){c.push(re.vf);0>b?(b=-b,c.push(re.Ag)):a.wa&&c.push(re.Dg);b=""+b;for(var d=re.ke,e=b.length;e<a.T;e++)c.push(d);c.push(b)}function Ce(a){a=a.charCodeAt(0);if(48<=a&&58>a)return a-48;var b=re.ke.charCodeAt(0);return b<=a&&a<b+10?a-b:-1}var Be=";";
function Ae(a,b,c){for(var d="",e=!1,f=b.length;c[0]<f;c[0]++){var g=b.charAt(c[0]);if("'"==g)c[0]+1<f&&"'"==b.charAt(c[0]+1)?(c[0]++,d+="'"):e=!e;else if(e)d+=g;else switch(g){case "#":case "0":case ",":case ".":case Be:return d;case "\u00a4":if(c[0]+1<f&&"\u00a4"==b.charAt(c[0]+1))c[0]++,d+=a.u;else switch(a.kb){case we:d+=se[a.u][1];break;case 2:var g=a.u,k=se[g],d=d+(g==k[1]?g:g+" "+k[1]);break;case 1:d+=se[a.u][2]}break;case "%":if(1!=a.C)throw Error("Too many percent/permill");a.C=100;d+=re.xf;
break;case "\u2030":if(1!=a.C)throw Error("Too many percent/permill");a.C=1E3;d+=re.yf;break;default:d+=g}}return d}var He={prefix:"",mg:"",qe:0};function Ie(a,b){var c=1==a.p?pe.xg:pe.wg;if(3>b)return He;b=Math.min(14,b);c=c[Math.pow(10,b)];if(!c)return He;c=c.other;return c&&"0"!=c?(c=/([^0]*)(0+)(.*)/.exec(c))?{prefix:c[1],mg:c[3],qe:b-(c[2].length-1)}:He:He}function Je(a){for(var b=0;1<=(a/=10);)b++;return b}
function Ee(a,b,c){if(!a)return a;b=b-Je(a)-1;if(b<-c)return c=Math.pow(10,c),Math.round(a/c)*c;c=Math.pow(10,b);return Math.round(a*c)/c};function Ke(a){return 1==a%10&&11!=a%100?"one":2==a%10&&12!=a%100?"two":3==a%10&&13!=a%100?"few":"other"}var Le=Ke,Le=Ke;function Me(a,b){var c=a|0,d;if(void 0===b){d=a+"";var e=d.indexOf(".");d=Math.min(-1==e?0:d.length-e-1,3)}else d=b;return 1==c&&0==d?"one":"other"}var Ne=Me,Ne=Me;function Oe(a){this.g=[];this.j=[];this.i=new ve(1);a&&(a=Pe(this,a),this.j=Qe(this,a))}var Re=RegExp("'([{}#].*?)'","g"),Se=RegExp("''","g");
function Te(a,b,c,d,e){for(var f=0;f<b.length;f++)switch(b[f].type){case 4:e.push(b[f].value);break;case 3:var g=b[f].value,k=a,l=e,m=c[g];t(m)?(k.g.push(m),l.push(k.h(k.g))):l.push("Undefined parameter - "+g);break;case 2:g=b[f].value;k=e;l=g.od;t(c[l])?(l=g[c[l]],t(l)||(l=g.other),Te(a,l,c,d,k)):k.push("Undefined parameter - "+l);break;case 0:g=b[f].value;Ue(a,g,c,Ne,d,e);break;case 1:g=b[f].value;Ue(a,g,c,Le,d,e);break;default:Sa("Unrecognized block type.")}}
function Ue(a,b,c,d,e,f){var g=b.od,k=b.Df,l=+c[g];if(isNaN(l))f.push("Undefined or invalid parameter - "+g);else if(k=l-k,g=b[c[g]],t(g)||(d=a.i.Va?d(k,a.i.Va()):d(k),g=b[d],t(g)||(g=b.other)),b=[],Te(a,g,c,e,b),c=b.join(""),e)f.push(c);else{a=a.i;if(isNaN(k))a=re.Bg;else{e=[];g=d=k;a.p==xe?b=He:(d=Math.abs(d),g=Math.abs(g),b=Ie(a,1>=d?0:Je(d)).qe,De(a,g/Math.pow(10,b)),d=De(a,d/Math.pow(10,b)),b=Ie(a,b+Je(d.bg)));k/=Math.pow(10,b.qe);e.push(b.prefix);d=0>k||0==k&&0>1/k;e.push(d?a.i:a.l);if(isFinite(k))if(k=
k*(d?-1:1)*a.C,a.V)if(0==k)Fe(a,k,a.g,e),Ge(a,0,e);else{g=Math.log(k)/Math.log(10);g=Math.floor(g+2E-15);k/=Math.pow(10,g);l=a.g;if(1<a.O&&a.O>a.g){for(;0!=g%a.O;)k*=10,g--;l=1}else 1>a.g?(g++,k/=10):(g-=a.g-1,k*=Math.pow(10,a.g-1));Fe(a,k,l,e);Ge(a,g,e)}else Fe(a,k,a.g,e);else e.push(re.je);e.push(d?a.o:a.G);e.push(b.mg);a=e.join("")}f.push(c.replace(/#/g,a))}}
function Pe(a,b){var c=a.g,d=y(a.h,a);b=b.replace(Se,function(){c.push("'");return d(c)});return b=b.replace(Re,function(a,b){c.push(b);return d(c)})}function Ve(a){var b=0,c=[],d=[],e=/[{}]/g;e.lastIndex=0;for(var f;f=e.exec(a);){var g=f.index;"}"==f[0]?(c.pop(),0==c.length&&(f={type:1},f.value=a.substring(b,g),d.push(f),b=g+1)):(0==c.length&&(b=a.substring(b,g),""!=b&&d.push({type:0,value:b}),b=g+1),c.push("{"))}b=a.substring(b);""!=b&&d.push({type:0,value:b});return d}
var We=/^\s*(\w+)\s*,\s*plural\s*,(?:\s*offset:(\d+))?/,Xe=/^\s*(\w+)\s*,\s*selectordinal\s*,/,Ye=/^\s*(\w+)\s*,\s*select\s*,/;
function Qe(a,b){for(var c=[],d=Ve(b),e=0;e<d.length;e++){var f={};if(0==d[e].type)f.type=4,f.value=d[e].value;else if(1==d[e].type){var g=d[e].value;switch(We.test(g)?0:Xe.test(g)?1:Ye.test(g)?2:/^\s*\w+\s*/.test(g)?3:5){case 2:f.type=2;f.value=Ze(a,d[e].value);break;case 0:f.type=0;f.value=$e(a,d[e].value);break;case 1:f.type=1;f.value=af(a,d[e].value);break;case 3:f.type=3;f.value=d[e].value;break;default:Sa("Unknown block type.")}}else Sa("Unknown part of the pattern.");c.push(f)}return c}
function Ze(a,b){var c="";b=b.replace(Ye,function(a,b){c=b;return""});var d={};d.od=c;for(var e=Ve(b),f=0;f<e.length;){var g=e[f].value;f++;if(1==e[f].type)var k=Qe(a,e[f].value);else Sa("Expected block type.");d[g.replace(/\s/g,"")]=k;f++}return d}
function $e(a,b){var c="",d=0;b=b.replace(We,function(a,b,e){c=b;e&&(d=parseInt(e,10));return""});var e={};e.od=c;e.Df=d;for(var f=Ve(b),g=0;g<f.length;){var k=f[g].value;g++;if(1==f[g].type)var l=Qe(a,f[g].value);else Sa("Expected block type.");e[k.replace(/\s*(?:=)?(\w+)\s*/,"$1")]=l;g++}return e}
function af(a,b){var c="";b=b.replace(Xe,function(a,b){c=b;return""});var d={};d.od=c;d.Df=0;for(var e=Ve(b),f=0;f<e.length;){var g=e[f].value;f++;if(1==e[f].type)var k=Qe(a,e[f].value);else Sa("Expected block type.");d[g.replace(/\s*(?:=)?(\w+)\s*/,"$1")]=k;f++}return d}Oe.prototype.h=function(a){return"\ufddf_"+(a.length-1).toString(10)+"_"};function bf(a,b,c){a=new Oe(a);b={COUNT:b,TEXT:c};if(0==a.j.length)a="";else{c=[];Te(a,a.j,b,!1,c);for(b=c.join("");0<a.g.length;)b=b.replace(a.h(a.g),a.g.pop());a=b}return a};function cf(a){this.g=new Md;if(a){a=Fd(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])}}function df(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+ja(a):b.substr(0,1)+a}h=cf.prototype;h.fa=function(){return this.g.fa()};h.add=function(a){this.g.set(df(a),a)};h.removeAll=function(a){a=Fd(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};h.remove=function(a){return this.g.remove(df(a))};h.clear=function(){this.g.clear()};h.Pa=function(){return this.g.Pa()};
h.contains=function(a){a=df(a);return Od(this.g.h,a)};h.Ca=function(){return this.g.Ca()};h.ha=function(){return new cf(this)};h.Lb=function(){return this.g.Lb(!1)};function ef(a){var b;b||(b=ff(a||arguments.callee.caller,[]));return b}
function ff(a,b){var c=[];if(Ab(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(gf(a)+"(");for(var d=a.arguments,e=0;d&&e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=gf(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(ff(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?
c.push("[...long stack...]"):c.push("[end]");return c.join("")}function gf(a){if(hf[a])return hf[a];a=String(a);if(!hf[a]){var b=/function ([^\(]+)/.exec(a);hf[a]=b?b[1]:"[Anonymous]"}return hf[a]}var hf={};function jf(a,b,c,d,e){this.o="number"==typeof e?e:kf++;this.l=d||A();this.j=a;this.p=b;this.h=c;delete this.i;delete this.g}jf.prototype.o=0;jf.prototype.i=null;jf.prototype.g=null;var kf=0;jf.prototype.getMessage=function(){return this.p};function lf(a){this.l=a;this.g=this.j=this.h=this.i=null}function mf(a,b){this.name=a;this.value=b}mf.prototype.toString=function(){return this.name};var nf=new mf("SHOUT",1200),of=new mf("SEVERE",1E3),pf=new mf("WARNING",900),qf=new mf("INFO",800),rf=new mf("CONFIG",700),sf=new mf("FINE",500),tf=new mf("FINER",400),uf=new mf("FINEST",300),vf=[new mf("OFF",Infinity),nf,of,pf,qf,rf,sf,tf,uf,new mf("ALL",0)],wf=null;h=lf.prototype;h.getName=function(){return this.l};
function xf(a,b){a.g||(a.g=[]);a.g.push(b)}h.getParent=function(){return this.i};h.getChildren=function(){this.j||(this.j={});return this.j};function yf(a){if(a.h)return a.h;if(a.i)return yf(a.i);Sa("Root logger has no level set.");return null}
h.log=function(a,b,c){if(a.value>=yf(this).value)for(ia(b)&&(b=b()),a=this.Pf(a,b,c,lf.prototype.log),b="log:"+a.getMessage(),r.console&&(r.console.timeStamp?r.console.timeStamp(b):r.console.markTimeline&&r.console.markTimeline(b)),r.msWriteProfilerMark&&r.msWriteProfilerMark(b),b=this;b;){c=b;var d=a;if(c.g)for(var e=0,f=void 0;f=c.g[e];e++)f(d);b=b.getParent()}};
h.Pf=function(a,b,c,d){a=new jf(a,String(b),this.l);if(c){a.i=c;var e;d=d||lf.prototype.Pf;try{var f;var g=ba("window.location.href");if(v(c))f={message:c,name:"Unknown error",lineNumber:"Not available",fileName:g,stack:"Not available"};else{var k,l;b=!1;try{k=c.lineNumber||c.ri||"Not available"}catch(m){k="Not available",b=!0}try{l=c.fileName||c.filename||c.sourceURL||r.$googDebugFname||g}catch(n){l="Not available",b=!0}f=!b&&c.lineNumber&&c.fileName&&c.stack&&c.message&&c.name?c:{message:c.message||
"Not available",name:c.name||"UnknownError",lineNumber:k,fileName:l,stack:c.stack||"Not available"}}e="Message: "+Ca(f.message)+'\nUrl: <a href="view-source:'+f.fileName+'" target="_new">'+f.fileName+"</a>\nLine: "+f.lineNumber+"\n\nBrowser stack:\n"+Ca(f.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+Ca(ef(d)+"-> ")}catch(p){e="Exception trying to expose exception! You win, we lose. "+p}a.g=e}return a};function M(a,b){a.log(pf,b,void 0)}h.info=function(a,b){this.log(qf,a,b)};
function zf(a,b,c){a.log(sf,b,c)}function N(a,b){a.log(tf,b,void 0)}function P(a,b){a.log(uf,b,void 0)}var Af={},Bf=null;function Cf(){Bf||(Bf=new lf(""),Af[""]=Bf,Bf.h=rf)}function Df(){Cf();return Bf}function Q(a){Cf();var b;if(!(b=Af[a])){b=new lf(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=Q(a.substr(0,c));c.getChildren()[d]=b;b.i=c;Af[a]=b}return b};function Ef(a,b){a&&zf(a,b,void 0)};function Ff(a){ac.call(this);this.g=a;this.h={}}B(Ff,ac);var Gf=[];h=Ff.prototype;h.listen=function(a,b,c,d){u(b)||(b&&(Gf[0]=b.toString()),b=Gf);for(var e=0;e<b.length;e++){var f=Yc(a,b[e],c||this.handleEvent,d||!1,this.g||this);if(!f)break;this.h[f.key]=f}return this};
h.ua=function(a,b,c,d,e){if(u(b))for(var f=0;f<b.length;f++)this.ua(a,b[f],c,d,e);else c=c||this.handleEvent,e=e||this.g||this,c=Zc(c),d=!!d,b=Bc(a)?Uc(a.yb,String(b),c,d,e):a?(a=ad(a))?Uc(a,b,c,d,e):null:null,b&&(gd(b),delete this.h[b.key]);return this};h.removeAll=function(){Fc(this.h,gd);this.h={}};h.J=function(){Ff.m.J.call(this);this.removeAll()};h.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};function Hf(a,b){kd.call(this);this.h=a||1;this.g=b||r;this.i=y(this.Ph,this);this.j=A()}B(Hf,kd);h=Hf.prototype;h.Tc=!1;h.da=null;h.setInterval=function(a){this.h=a;this.da&&this.Tc?(this.stop(),If(this)):this.da&&this.stop()};h.Ph=function(){if(this.Tc){var a=A()-this.j;0<a&&a<0.8*this.h?this.da=this.g.setTimeout(this.i,this.h-a):(this.da&&(this.g.clearTimeout(this.da),this.da=null),this.dispatchEvent(Jf),this.Tc&&(this.da=this.g.setTimeout(this.i,this.h),this.j=A()))}};
function If(a){a.Tc=!0;a.da||(a.da=a.g.setTimeout(a.i,a.h),a.j=A())}h.stop=function(){this.Tc=!1;this.da&&(this.g.clearTimeout(this.da),this.da=null)};h.J=function(){Hf.m.J.call(this);this.stop();delete this.g};var Jf="tick";function Kf(a,b,c){if(ia(a))c&&(a=y(a,c));else if(a&&"function"==typeof a.handleEvent)a=y(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<b?-1:r.setTimeout(a,b||0)};var Lf=r.JSON.parse,Mf=r.JSON.stringify;function Nf(){}
function Of(a,b,c){switch(typeof b){case "string":Pf(b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case "boolean":c.push(b);break;case "undefined":c.push("null");break;case "object":if(null==b){c.push("null");break}if(u(b)){var d=b.length;c.push("[");for(var e="",f=0;f<d;f++)c.push(e),Of(a,b[f],c),e=",";c.push("]");break}c.push("{");d="";for(e in b)Object.prototype.hasOwnProperty.call(b,e)&&(f=b[e],"function"!=typeof f&&(c.push(d),Pf(e,c),c.push(":"),Of(a,f,c),d=","));c.push("}");
break;case "function":break;default:throw Error("Unknown type: "+typeof b);}}var Qf={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},Rf=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Pf(a,b){b.push('"',a.replace(Rf,function(a){if(a in Qf)return Qf[a];var b=a.charCodeAt(0),e="\\u";16>b?e+="000":256>b?e+="00":4096>b&&(e+="0");return Qf[a]=e+b.toString(16)}),'"')};function Sf(){}Sf.prototype.g=null;function Tf(a){var b;(b=a.g)||(b={},Uf(a)&&(b[0]=!0,b[1]=!0),b=a.g=b);return b};var Vf;function Wf(){}B(Wf,Sf);function Xf(a){return(a=Uf(a))?new ActiveXObject(a):new XMLHttpRequest}function Uf(a){if(!a.h&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.h=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return a.h}Vf=new Wf;function Yf(a){kd.call(this);this.headers=new Md;this.aa=a||null;this.h=!1;this.V=this.U=null;this.wa=this.u="";this.o=0;this.p="";this.i=this.la=this.C=this.ca=!1;this.l=0;this.G=null;this.j=Zf;this.T=this.Xb=!1}B(Yf,kd);var Zf="";Yf.prototype.g=Q("goog.net.XhrIo");var $f=/^https?$/i,ag=["POST","PUT"];h=Yf.prototype;h.Qf=function(){return this.j};
h.send=function(a,b,c,d){if(this.U)throw Error("[goog.net.XhrIo] Object is active with another request="+this.u+"; newUri="+a);b=b?b.toUpperCase():"GET";this.u=a;this.p="";this.o=0;this.wa=b;this.ca=!1;this.h=!0;this.U=this.aa?Xf(this.aa):Xf(Vf);this.V=this.aa?Tf(this.aa):Tf(Vf);this.U.onreadystatechange=y(this.hg,this);try{Ef(this.g,bg(this,"Opening Xhr")),this.la=!0,this.U.open(b,String(a),!0),this.la=!1}catch(e){Ef(this.g,bg(this,"Error opening Xhr: "+e.message));cg(this,e);return}a=c||"";var f=
this.headers.ha();d&&Gd(d,function(a,b){f.set(b,a)});d=yb(f.La(),dg);c=r.FormData&&a instanceof r.FormData;!Ab(ag,b)||d||c||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");f.forEach(function(a,b){this.U.setRequestHeader(b,a)},this);this.j&&(this.U.responseType=this.j);"withCredentials"in this.U&&(this.U.withCredentials=this.Xb);try{eg(this),0<this.l&&(this.T=fg(this.U),Ef(this.g,bg(this,"Will abort after "+this.l+"ms if incomplete, xhr2 "+this.T)),this.T?(this.U.timeout=this.l,
this.U.ontimeout=y(this.ng,this)):this.G=Kf(this.ng,this.l,this)),Ef(this.g,bg(this,"Sending request")),this.C=!0,this.U.send(a),this.C=!1}catch(g){Ef(this.g,bg(this,"Send error: "+g.message)),cg(this,g)}};function fg(a){return G&&qc(9)&&ha(a.timeout)&&t(a.ontimeout)}function dg(a){return"content-type"==a.toLowerCase()}h.ng=function(){"undefined"!=typeof aa&&this.U&&(this.p="Timed out after "+this.l+"ms, aborting",this.o=8,Ef(this.g,bg(this,this.p)),this.dispatchEvent("timeout"),this.abort(8))};
function cg(a,b){a.h=!1;a.U&&(a.i=!0,a.U.abort(),a.i=!1);a.p=b;a.o=5;gg(a);hg(a)}function gg(a){a.ca||(a.ca=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}h.abort=function(a){this.U&&this.h&&(Ef(this.g,bg(this,"Aborting")),this.h=!1,this.i=!0,this.U.abort(),this.i=!1,this.o=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),hg(this))};h.J=function(){this.U&&(this.h&&(this.h=!1,this.i=!0,this.U.abort(),this.i=!1),hg(this,!0));Yf.m.J.call(this)};
h.hg=function(){this.O||(this.la||this.C||this.i?ig(this):this.Jh())};h.Jh=function(){ig(this)};function ig(a){if(a.h&&"undefined"!=typeof aa)if(a.V[1]&&4==jg(a)&&2==a.N())Ef(a.g,bg(a,"Local request error detected and ignored"));else if(a.C&&4==jg(a))Kf(a.hg,0,a);else if(a.dispatchEvent("readystatechange"),4==jg(a)){Ef(a.g,bg(a,"Request complete"));a.h=!1;try{a.Ga()?(a.dispatchEvent("complete"),a.dispatchEvent("success")):(a.o=6,a.p=a.Ma()+" ["+a.N()+"]",gg(a))}finally{hg(a)}}}
function hg(a,b){if(a.U){eg(a);var c=a.U,d=a.V[0]?ca:null;a.U=null;a.V=null;b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){(c=a.g)&&c.log(of,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function eg(a){a.U&&a.T&&(a.U.ontimeout=null);ha(a.G)&&(r.clearTimeout(a.G),a.G=null)}
h.Ga=function(){var a=this.N(),b;a:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:b=!0;break a;default:b=!1}if(!b){if(a=0===a)a=Qd(String(this.u))[1]||null,!a&&self.location&&(a=self.location.protocol,a=a.substr(0,a.length-1)),a=!$f.test(a?a.toLowerCase():"");b=a}return b};function jg(a){return a.U?a.U.readyState:0}h.N=function(){try{return 2<jg(this)?this.U.status:-1}catch(a){return-1}};
h.Ma=function(){try{return 2<jg(this)?this.U.statusText:""}catch(a){return Ef(this.g,"Can not get status: "+a.message),""}};
function kg(a){try{if(!a.U)return null;if("response"in a.U)return a.U.response;switch(a.j){case Zf:case "text":return a.U.responseText;case "arraybuffer":if("mozResponseArrayBuffer"in a.U)return a.U.mozResponseArrayBuffer}var b=a.g;b&&b.log(of,"Response type "+a.j+" is not supported on this browser",void 0);return null}catch(c){return Ef(a.g,"Can not get response: "+c.message),null}}function bg(a,b){return b+" ["+a.wa+" "+a.u+" "+a.N()+"]"};function lg(){this.i=this.h=0;this.g=[]}function mg(a){if(a.h!=a.i){var b=a.g[a.h];delete a.g[a.h];a.h++;return b}}h=lg.prototype;h.fa=function(){return this.i-this.h};h.Pa=function(){return 0==this.i-this.h};h.clear=function(){this.i=this.h=this.g.length=0};h.contains=function(a){return Ab(this.g,a)};h.remove=function(a){a=sb(this.g,a);if(0>a)return!1;a==this.h?mg(this):(rb.splice.call(this.g,a,1),this.i--);return!0};h.Ca=function(){return this.g.slice(this.h,this.i)};function ng(a,b){ac.call(this);this.o=a||0;this.i=b||10;if(this.o>this.i)throw Error(og);this.g=new lg;this.h=new cf;this.l=null;this.ld()}B(ng,ac);var og="[goog.structs.Pool] Min can not be greater than max";h=ng.prototype;h.Ed=function(){var a=A();if(!(null!=this.l&&0>a-this.l)){for(var b;0<this.g.fa()&&(b=mg(this.g),!this.cf(b));)this.ld();!b&&this.fa()<this.i&&(b=this.Ce());b&&(this.l=a,this.h.add(b));return b}};
h.Jc=function(a){this.h.remove(a);if(this.cf(a)&&this.fa()<this.i){var b=this.g;b.g[b.i++]=a}else pg(a)};h.ld=function(){for(var a=this.g;this.fa()<this.o;){var b=this.Ce();a.g[a.i++]=b}for(;this.fa()>this.i&&0<this.g.fa();)pg(mg(a))};h.Ce=function(){return{}};function pg(a){if("function"==typeof a.ma)a.ma();else for(var b in a)a[b]=null}h.cf=function(a){return"function"==typeof a.Hg?a.Hg():!0};h.contains=function(a){return this.g.contains(a)||this.h.contains(a)};
h.fa=function(){return this.g.fa()+this.h.fa()};h.Pa=function(){return this.g.Pa()&&this.h.Pa()};h.J=function(){ng.m.J.call(this);if(0<this.h.fa())throw Error("[goog.structs.Pool] Objects not released");delete this.h;for(var a=this.g;!a.Pa();)pg(mg(a));delete this.g};function qg(a,b){this.g=a;this.h=b}qg.prototype.P=function(){return this.h};qg.prototype.ha=function(){return new qg(this.g,this.h)};function rg(a){this.g=[];if(a)a:{var b,c;if(a instanceof rg){if(b=a.La(),c=a.Ca(),0>=a.fa()){a=this.g;for(var d=0;d<b.length;d++)a.push(new qg(b[d],c[d]));break a}}else b=Hc(a),c=Gc(a);for(d=0;d<b.length;d++)sg(this,b[d],c[d])}}function sg(a,b,c){var d=a.g;d.push(new qg(b,c));b=d.length-1;a=a.g;for(c=a[b];0<b;)if(d=b-1>>1,a[d].g>c.g)a[b]=a[d],b=d;else break;a[b]=c}h=rg.prototype;
h.remove=function(){var a=this.g,b=a.length,c=a[0];if(!(0>=b)){if(1==b)Bb(a);else{a[0]=a.pop();for(var a=0,b=this.g,d=b.length,e=b[a];a<d>>1;){var f=2*a+1,g=2*a+2,f=g<d&&b[g].g<b[f].g?g:f;if(b[f].g>e.g)break;b[a]=b[f];a=f}b[a]=e}return c.P()}};h.Ca=function(){for(var a=this.g,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].P());return b};h.La=function(){for(var a=this.g,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].g);return b};h.ha=function(){return new rg(this)};h.fa=function(){return this.g.length};
h.Pa=function(){return 0==this.g.length};h.clear=function(){Bb(this.g)};function tg(){rg.call(this)}B(tg,rg);function ug(a,b){this.j=new tg;ng.call(this,a,b)}B(ug,ng);h=ug.prototype;h.Ed=function(a,b){if(!a)return ug.m.Ed.call(this);sg(this.j,t(b)?b:100,a);this.Re()};h.Re=function(){for(var a=this.j;0<a.fa();){var b=this.Ed();if(b)a.remove().apply(this,[b]);else break}};h.Jc=function(a){ug.m.Jc.call(this,a);this.Re()};h.ld=function(){ug.m.ld.call(this);this.Re()};h.J=function(){ug.m.J.call(this);r.clearTimeout(void 0);this.j.clear();this.j=null};function vg(a,b,c){ug.call(this,b,c);this.p=a}B(vg,ug);vg.prototype.Ce=function(){var a=new Yf,b=this.p;b&&b.forEach(function(b,d){a.headers.set(d,b)});return a};vg.prototype.cf=function(a){return!a.O&&!a.U};function wg(a,b,c,d,e){kd.call(this);this.j=t(a)?a:1;this.l=t(e)?Math.max(0,e):0;this.h=new vg(b,c,d);this.g=new Md;this.i=new Ff(this)}B(wg,kd);var xg="ready complete success error abort timeout".split(" ");h=wg.prototype;h.send=function(a,b,c,d,e,f,g,k,l){if(this.g.get(a))throw Error("[goog.net.XhrManager] ID in use");b=new yg(b,y(this.eh,this,a),c,d,e,g,t(k)?k:this.j,l);this.g.set(a,b);a=y(this.Vg,this,a);this.h.Ed(a,f);return b};
h.abort=function(a,b){var c=this.g.get(a);if(c){var d=c.be;c.Af=!0;b&&(d&&(this.i.ua(d,xg,c.mf),ed(d,"ready",function(){var a=this.h;a.h.remove(d)&&a.Jc(d)},!1,this)),this.g.remove(a));d&&d.abort()}};h.Vg=function(a,b){var c=this.g.get(a);c&&!c.be?(this.i.listen(b,xg,c.mf),b.l=Math.max(0,this.l),b.j=c.Qf(),c.be=b,this.dispatchEvent(new zg("ready",this,a,b)),Ag(this,a,b),c.Af&&b.abort()):(c=this.h,c.h.remove(b)&&c.Jc(b))};
h.eh=function(a,b){var c=b.target;switch(b.type){case "ready":Ag(this,a,c);break;case "complete":a:{var d=this.g.get(a);if(7==c.o||c.Ga()||d.pd>d.Ae)if(this.dispatchEvent(new zg("complete",this,a,c)),d&&(d.Kf=!0,d.Jf)){c=d.Jf.call(c,b);break a}c=null}return c;case "success":this.dispatchEvent(new zg("success",this,a,c));break;case "timeout":case "error":d=this.g.get(a);d.pd>d.Ae&&this.dispatchEvent(new zg("error",this,a,c));break;case "abort":this.dispatchEvent(new zg("abort",this,a,c))}return null};
function Ag(a,b,c){var d=a.g.get(b);!d||d.Kf||d.pd>d.Ae?(d&&(a.i.ua(c,xg,d.mf),a.g.remove(b)),a=a.h,a.h.remove(c)&&a.Jc(c)):(d.pd++,c.send(d.Rh,d.Bd(),d.ra(),d.Rc()))}h.J=function(){wg.m.J.call(this);this.h.ma();this.h=null;this.i.ma();this.i=null;this.g.clear();this.g=null};function zg(a,b,c,d){H.call(this,a,b);this.id=c;this.be=d}B(zg,H);
function yg(a,b,c,d,e,f,g,k){this.Rh=a;this.i=c||"GET";this.g=d;this.h=e||null;this.Ae=t(g)?g:1;this.pd=0;this.Af=this.Kf=!1;this.mf=b;this.Jf=f;this.j=k||Zf;this.be=null}yg.prototype.Bd=function(){return this.i};yg.prototype.ra=function(){return this.g};yg.prototype.Rc=function(){return this.h};yg.prototype.Qf=function(){return this.j};function Bg(a){for(var b=[],c=0,d=0;d<a.length;d++){for(var e=a.charCodeAt(d);255<e;)b[c++]=e&255,e>>=8;b[c++]=e}return b};function Cg(){this.i=[];this.h=this.g=0};function Dg(){this.h=-1};function Eg(){this.h=-1;this.h=64;this.g=[];this.o=[];this.p=[];this.j=[];this.j[0]=128;for(var a=1;a<this.h;++a)this.j[a]=0;this.l=this.i=0;this.g[0]=1732584193;this.g[1]=4023233417;this.g[2]=2562383102;this.g[3]=271733878;this.g[4]=3285377520;this.l=this.i=0}B(Eg,Dg);
function Fg(a,b,c){c||(c=0);var d=a.p;if(v(b))for(var e=0;16>e;e++)d[e]=b.charCodeAt(c)<<24|b.charCodeAt(c+1)<<16|b.charCodeAt(c+2)<<8|b.charCodeAt(c+3),c+=4;else for(e=0;16>e;e++)d[e]=b[c]<<24|b[c+1]<<16|b[c+2]<<8|b[c+3],c+=4;for(e=16;80>e;e++){var f=d[e-3]^d[e-8]^d[e-14]^d[e-16];d[e]=(f<<1|f>>>31)&4294967295}b=a.g[0];c=a.g[1];for(var g=a.g[2],k=a.g[3],l=a.g[4],m,e=0;80>e;e++)40>e?20>e?(f=k^c&(g^k),m=1518500249):(f=c^g^k,m=1859775393):60>e?(f=c&g|k&(c|g),m=2400959708):(f=c^g^k,m=3395469782),f=(b<<
5|b>>>27)+f+l+m+d[e]&4294967295,l=k,k=g,g=(c<<30|c>>>2)&4294967295,c=b,b=f;a.g[0]=a.g[0]+b&4294967295;a.g[1]=a.g[1]+c&4294967295;a.g[2]=a.g[2]+g&4294967295;a.g[3]=a.g[3]+k&4294967295;a.g[4]=a.g[4]+l&4294967295}
Eg.prototype.update=function(a,b){t(b)||(b=a.length);for(var c=b-this.h,d=0,e=this.o,f=this.i;d<b;){if(0==f)for(;d<=c;)Fg(this,a,d),d+=this.h;if(v(a))for(;d<b;){if(e[f]=a.charCodeAt(d),++f,++d,f==this.h){Fg(this,e);f=0;break}}else for(;d<b;)if(e[f]=a[d],++f,++d,f==this.h){Fg(this,e);f=0;break}}this.i=f;this.l+=b};
function Gg(a){var b=[],c=8*a.l;56>a.i?a.update(a.j,56-a.i):a.update(a.j,a.h-(a.i-56));for(var d=a.h-1;56<=d;d--)a.o[d]=c&255,c/=256;Fg(a,a.o);for(d=c=0;5>d;d++)for(var e=24;0<=e;e-=8)b[c]=a.g[d]>>e&255,++c;return b};var Hg=null,Ig=null;function Jg(a){this.g=a}Jg.prototype.set=function(a,b){t(b)?this.g.set(a,Mf(b)):this.g.remove(a)};Jg.prototype.get=function(a){var b;try{b=this.g.get(a)}catch(c){return}if(null!==b)try{return Lf(b)}catch(d){throw"Storage: Invalid value was encountered";}};Jg.prototype.remove=function(a){this.g.remove(a)};function Kg(){};function Lg(a){this.g=a}B(Lg,Jg);function Mg(a){this.data=a}function Ng(a){return!t(a)||a instanceof Mg?a:new Mg(a)}function Og(a){a=a.data;if(!t(a))throw"Storage: Invalid value was encountered";return a}Lg.prototype.set=function(a,b){Lg.m.set.call(this,a,Ng(b))};Lg.prototype.Sc=function(a){a=Lg.m.get.call(this,a);if(!t(a)||a instanceof Object)return a;throw"Storage: Invalid value was encountered";};Lg.prototype.get=function(a){return(a=this.Sc(a))?Og(a):void 0};function Pg(a){this.g=a}B(Pg,Lg);Pg.prototype.set=function(a,b,c){if(b=Ng(b)){if(c){if(c<A()){Pg.prototype.remove.call(this,a);return}b.expiration=c}b.creation=A()}Pg.m.set.call(this,a,b)};Pg.prototype.Sc=function(a,b){var c=Pg.m.Sc.call(this,a);if(c){var d;if(d=!b){d=c.creation;var e=c.expiration;d=!!e&&e<A()||!!d&&d>A()}if(d)Pg.prototype.remove.call(this,a);else return c}};function Qg(a){this.g=a}B(Qg,Pg);function Rg(){}B(Rg,Kg);Rg.prototype.fa=function(){var a=0;Kd(this.Lb(!0),function(){a++});return a};Rg.prototype.clear=function(){var a=Ld(this.Lb(!0)),b=this;tb(a,function(a){b.remove(a)})};function Sg(a,b){this.g=a;this.Be=Bg(b);this.Hf=new Nf}B(Sg,Qg);h=Sg.prototype;h.Be=null;h.Hf=null;
function Tg(a,b){var c=new Eg;c.update(Bg(b));c.update(a.Be);c=Gg(c);if(!fa(c))throw Error("encodeByteArray takes an array as a parameter");if(!Hg){Hg={};Ig={};for(var d=0;65>d;d++)Hg[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d),Ig[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(d)}for(var d=Ig,e=[],f=0;f<c.length;f+=3){var g=c[f],k=f+1<c.length,l=k?c[f+1]:0,m=f+2<c.length,n=m?c[f+2]:0,p=g>>2,g=(g&3)<<4|l>>4,l=(l&15)<<2|n>>6,n=n&63;
m||(n=64,k||(l=64));e.push(d[p],d[g],d[l],d[n])}return e.join("")}
function Ug(a,b,c,d){if(!(0<b.length))throw Error("Non-empty salt must be provided");var e=new Eg;e.update(Bg(c));e.update(b);e.update(a.Be);a=new Cg;var e=Gg(e),f;f||(f=e.length);b=a.i;for(c=0;256>c;++c)b[c]=c;var g=0;for(c=0;256>c;++c){var g=g+b[c]+e[c%f]&255,k=b[c];b[c]=b[g];b[g]=k}a.g=0;a.h=0;f=a.g;e=a.h;b=a.i;for(c=0;1536>c;++c)f=f+1&255,e=e+b[f]&255,g=b[f],b[f]=b[e],b[e]=g;a.g=f;a.h=e;d=Bg(d);var l;l||(l=d.length);f=a.g;e=a.h;b=a.i;for(c=0;c<l;++c)f=f+1&255,e=e+b[f]&255,g=b[f],b[f]=b[e],b[e]=
g,d[c]^=b[b[f]+b[e]&255];a.g=f;a.h=e;return String.fromCharCode.apply(null,d)}h.set=function(a,b,c){if(t(b)){for(var d=[],e=0;8>e;++e)d[e]=Math.floor(256*Math.random());e=[];Of(this.Hf,b,e);b=new Mg(Ug(this,d,a,e.join("")));b.salt=d;Sg.m.set.call(this,Tg(this,a),b,c)}else Sg.prototype.remove.call(this,a)};
h.Sc=function(a,b){var c=Sg.m.Sc.call(this,Tg(this,a),b);if(c){var d=Og(c),e=c.salt;if(!v(d)||!u(e)||!e.length)throw"Storage: Invalid value was encountered";d=Ug(this,e,a,d);try{c.data=Lf(d)}catch(f){throw"Storage: The value could not be decrypted";}return c}};h.remove=function(a){Sg.m.remove.call(this,Tg(this,a))};function Vg(a){this.g=a}B(Vg,Rg);h=Vg.prototype;h.set=function(a,b){try{this.g.setItem(a,b)}catch(c){if(0==this.g.length)throw"Storage mechanism: Storage disabled";throw"Storage mechanism: Quota exceeded";}};h.get=function(a){a=this.g.getItem(a);if(!v(a)&&null!==a)throw"Storage mechanism: Invalid value was encountered";return a};h.remove=function(a){this.g.removeItem(a)};h.fa=function(){return this.g.length};
h.Lb=function(a){var b=0,c=this.g,d=new Id;d.next=function(){if(b>=c.length)throw Hd;var d=c.key(b++);if(a)return d;d=c.getItem(d);if(!v(d))throw"Storage mechanism: Invalid value was encountered";return d};return d};h.clear=function(){this.g.clear()};h.key=function(a){return this.g.key(a)};function Wg(){var a=null;try{a=window.localStorage||null}catch(b){}this.g=a}B(Wg,Vg);var Xg=!G||G&&9<=sc,Yg=!jc&&!G||G&&G&&9<=sc||jc&&qc("1.9.1"),Zg=G&&!qc("9");function $g(a){a=a.className;return v(a)&&a.match(/\S+/g)||[]}function ah(a,b){for(var c=$g(a),d=Hb(arguments,1),e=c.length+d.length,f=c,g=0;g<d.length;g++)Ab(f,d[g])||f.push(d[g]);a.className=c.join(" ");return c.length==e};function bh(a,b){this.x=t(a)?a:0;this.y=t(b)?b:0}h=bh.prototype;h.ha=function(){return new bh(this.x,this.y)};h.toString=function(){return"("+this.x+", "+this.y+")"};function ch(a,b){return new bh(a.x-b.x,a.y-b.y)}h.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};h.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};h.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function dh(a,b){this.width=a;this.height=b}h=dh.prototype;h.ha=function(){return new dh(this.width,this.height)};h.toString=function(){return"("+this.width+" x "+this.height+")"};h.Pa=function(){return!(this.width*this.height)};h.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};h.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
h.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function eh(a){return a?new fh(gh(a)):ua||(ua=new fh)}function hh(a,b){var c=b||document,d=null;c.querySelectorAll&&c.querySelector?d=c.querySelector("."+a):d=ih(document,"*",a,b)[0];return d||null}
function ih(a,b,c,d){a=d||a;b=b&&"*"!=b?b.toUpperCase():"";if(a.querySelectorAll&&a.querySelector&&(b||c))return a.querySelectorAll(b+(c?"."+c:""));if(c&&a.getElementsByClassName){a=a.getElementsByClassName(c);if(b){d={};for(var e=0,f=0,g;g=a[f];f++)b==g.nodeName&&(d[e++]=g);d.length=e;return d}return a}a=a.getElementsByTagName(b||"*");if(c){d={};for(f=e=0;g=a[f];f++)b=g.className,"function"==typeof b.split&&Ab(b.split(/\s+/),c)&&(d[e++]=g);d.length=e;return d}return a}
function jh(a,b){Fc(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in kh?a.setAttribute(kh[d],b):va(d,"aria-")||va(d,"data-")?a.setAttribute(d,b):a[d]=b})}var kh={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function lh(a){return kc||"CSS1Compat"!=a.compatMode?a.body||a.documentElement:a.documentElement}function mh(a){return a.parentWindow||a.defaultView}function nh(a,b,c){function d(c){c&&b.appendChild(v(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!fa(f)||x(f)&&0<f.nodeType?d(f):tb(oh(f)?Eb(f):f,d)}}function ph(a){for(var b;b=a.firstChild;)a.removeChild(b)}function qh(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)}function rh(a){a&&a.parentNode&&a.parentNode.removeChild(a)}
function sh(a){if(void 0!=a.firstElementChild)a=a.firstElementChild;else for(a=a.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return a}function th(a){return x(a)&&1==a.nodeType}function uh(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function gh(a){return 9==a.nodeType?a:a.ownerDocument||a.document}
function vh(a,b){if("textContent"in a)a.textContent=b;else if(3==a.nodeType)a.data=b;else if(a.firstChild&&3==a.firstChild.nodeType){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else ph(a),a.appendChild(gh(a).createTextNode(String(b)))}var wh={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},xh={IMG:" ",BR:"\n"};function yh(a){a=a.getAttributeNode("tabindex");return null!=a&&a.specified}function zh(a){a=a.tabIndex;return ha(a)&&0<=a&&32768>a}
function Ah(a){var b=[];Bh(a,b,!1);return b.join("")}function Bh(a,b,c){if(!(a.nodeName in wh))if(3==a.nodeType)c?b.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):b.push(a.nodeValue);else if(a.nodeName in xh)b.push(xh[a.nodeName]);else for(a=a.firstChild;a;)Bh(a,b,c),a=a.nextSibling}function oh(a){if(a&&"number"==typeof a.length){if(x(a))return"function"==typeof a.item||"string"==typeof a.item;if(ia(a))return"function"==typeof a.item}return!1}
function Ch(a,b,c){if(!b&&!c)return null;var d=b?b.toUpperCase():null;return Dh(a,function(a){var b;if(b=!d||a.nodeName==d)(b=!c)||(b=Ab($g(a),c));return b})}function Dh(a,b){for(var c=0;a;){if(b(a))return a;a=a.parentNode;c++}return null}function fh(a){this.g=a||r.document||document}h=fh.prototype;h.n=function(a){return v(a)?this.g.getElementById(a):a};
h.s=function(a,b,c){var d=this.g,e=arguments,f=e[0],g=e[1];if(!Xg&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',Ca(g.name),'"');if(g.type){f.push(' type="',Ca(g.type),'"');var k={};Oc(k,g);delete k.type;g=k}f.push(">");f=f.join("")}f=d.createElement(f);g&&(v(g)?f.className=g:u(g)?ah.apply(null,[f].concat(g)):jh(f,g));2<e.length&&nh(d,f,e);return f};h.createElement=function(a){return this.g.createElement(a)};function Eh(a,b){return a.g.createTextNode(String(b))}
function Fh(a){return"CSS1Compat"==a.g.compatMode}function Gh(a){var b=a.g;a=lh(b);b=mh(b);return G&&qc("10")&&b.pageYOffset!=a.scrollTop?new bh(a.scrollLeft,a.scrollTop):new bh(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)}h.appendChild=function(a,b){a.appendChild(b)};h.Dh=qh;h.getChildren=function(a){return Yg&&void 0!=a.children?a.children:ub(a.childNodes,function(a){return 1==a.nodeType})};h.Of=sh;h.Eh=th;h.contains=uh;G&&qc(8);Qc("area base br col command embed hr img input keygen link meta param source track wbr".split(" "));Qc("action","cite","data","formaction","href","manifest","poster","src");Qc("link","script","style");Ca("".qi?"".oi:"");function Hh(a,b,c){ac.call(this);this.i=a;this.o=b||0;this.g=c;this.l=y(this.j,this)}B(Hh,ac);Hh.prototype.h=0;Hh.prototype.J=function(){Hh.m.J.call(this);this.stop();delete this.i;delete this.g};function Ih(a){a.stop();a.h=Kf(a.l,t(void 0)?void 0:a.o)}Hh.prototype.stop=function(){0!=this.h&&r.clearTimeout(this.h);this.h=0};function Jh(a){a.stop();a.j()}Hh.prototype.j=function(){this.h=0;this.i&&this.i.call(this.g)};function Kh(a,b,c){ac.call(this);this.j=a;this.i=b;this.g=c;this.h=y(this.Lh,this)}B(Kh,ac);h=Kh.prototype;h.ad=!1;h.da=null;h.stop=function(){this.da&&(r.clearTimeout(this.da),this.da=null,this.ad=!1)};h.J=function(){Kh.m.J.call(this);this.stop()};h.Lh=function(){this.da=null;this.ad&&(this.ad=!1,Lh(this))};function Lh(a){a.da=Kf(a.h,a.i);a.j.call(a.g)};Q("ydn");var Mh=Math.pow(2,3),Nh=Math.pow(2,6);function Oh(){kd.call(this);this.key=this.g=void 0}B(Oh,kd);Oh.prototype.S=function(a,b){if("boolean"!=typeof b)throw Error("Invalid value");if("number"!=typeof a||0>a)throw Error("Invalid state");"undefined"==typeof this.g&&(this.g=0);this.g=b?this.g|a:this.g&~a};function Ph(a){a.S(Mh,!0);Kf(function(){this.dispatchEvent(Qh)},0,a)}var Qh="a";function Rh(a,b,c){H.call(this,a,b);this.url=c}B(Rh,H);Q("ydn");function Sh(a){return!v(a)||ya(a)?{}:JSON.parse(a)}function Th(a){var b;try{b=Uh(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""}function Uh(a){return JSON.stringify(a,void 0,void 0)};function Vh(a,b){if(b&&!a)throw Error("Can't create document with namespace and no root tag");if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(b||"",a||"",null);if("undefined"!=typeof ActiveXObject){var c=Wh();if(c)return a&&c.appendChild(c.createNode(1,a,b||"")),c}throw Error("Your browser does not support creating new documents");}
function Xh(a){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(a,"application/xml");if("undefined"!=typeof ActiveXObject){var b=Wh();b.loadXML(a);return b}throw Error("Your browser does not support loading xml documents");}function Yh(a){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(a);if(a=a.xml)return a;throw Error("Your browser does not support serializing XML documents");}
function Wh(){var a=new ActiveXObject("MSXML2.DOMDocument");if(a){a.resolveExternals=!1;a.validateOnParse=!1;try{a.setProperty("ProhibitDTD",!0),a.setProperty("MaxXMLSize",2048),a.setProperty("MaxElementDepth",256)}catch(b){}}return a};function Zh(a){Error.captureStackTrace?Error.captureStackTrace(this,Zh):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"}B(Zh,Error);function $h(a){Error.captureStackTrace?Error.captureStackTrace(this,$h):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotSupportedException"}B(Zh,Error);$h.prototype.name="ydn.error.NotSupportedException";
function ai(a){Error.captureStackTrace?Error.captureStackTrace(this,ai):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"}B(ai,Error);function bi(a){Error.captureStackTrace?Error.captureStackTrace(this,bi):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}B(bi,Error);bi.prototype.name="ydn.InternalError";
function ci(a){Error.captureStackTrace?Error.captureStackTrace(this,ci):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"}B(ci,Error);ci.prototype.name="ydn.error.ConstraintError";function di(a){Error.captureStackTrace?Error.captureStackTrace(this,di):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"}B(Zh,Error);
function ei(a){Error.captureStackTrace?Error.captureStackTrace(this,ei):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"}B(ei,Error);var fi,gi,hi,ii;ii=hi=gi=fi=!1;var ji=dc;ji&&(-1!=ji.indexOf("Firefox")?fi=!0:-1!=ji.indexOf("Camino")||(-1!=ji.indexOf("iPhone")||-1!=ji.indexOf("iPod")?gi=!0:-1!=ji.indexOf("iPad")?hi=!0:-1!=ji.indexOf("Chrome")&&(ii=!0)));var ki=fi,li=gi,mi=hi,ni=ii;function oi(a){if(!u(a))throw new Zh("Array required.");if(t(void 0))return a=vb(a,function(a){return a[void 0]}),oi(a);for(var b=Number.NaN,c=-1,d=0;d<a.length;d++)!isNaN(a[d])&&(isNaN(b)||a[d]>b)&&(b=a[d],c=d);return{value:b,index:c}};function pi(){Oh.call(this);this.h=null;Yc(this,"user-login",this.jg,!1,this);Yc(this,"user-logout",this.jg,!1,this);this.p=window.top.location.href.replace(/[?#]\S+/,"")}B(pi,Oh);h=pi.prototype;h.logger=Q("ydn.api.AbstractUser");h.jg=function(){this.display?(this.display.i(this.email||""),this.isLogin()?this.l&&this.display.h(this.l):this.j&&this.display.g(this.j),P(this.logger,"Refreshed.")):P(this.logger,"No UI refreshed.")};
h.toJSON=function(){return{nickname:this.o,email:this.email,is_login:this.h,login_url:this.j,logout_url:this.l,user_id:this.user_id}};h.isLogin=function(){return!0===this.h};h.toString=function(){return"User:"+(!0===this.h?this.email:!1===this.h?"logout":"?")};h.Zc=0;
h.Ig=function(){if(this.isLogin())this.i.stop();else if(1<this.Zc)M(this.logger,"Cannot login to the API server, tried "+this.Zc+" times."),this.i.stop(),this.Zc=0;else{this.Zc++;zf(this.logger,"Sending login request.");var a=qi(ri),b=window.top.location.href.replace(/[?#]\S+/,"");a.request(new si("/rpc_login","GET",{url:b})).execute(y(this.u,this))}};
h.refresh=function(a){!a&&this.isLogin()?P(this.logger,"Already login"):(this.i||(this.i=new Kh(this.Ig,5E3,this)),this.Zc=0,a=this.i,a.da?a.ad=!0:Lh(a))};function ti(a,b,c){Rh.call(this,a,b,c)}B(ti,Rh);function ui(){pi.call(this)}B(ui,pi);ui.prototype.logger=Q("ydn.api.User");
ui.prototype.load=function(a){zf(this.logger,"getting user info");if(a.logout_url)return this.o=a.nickname,this.email=a.email,this.user_id=a.user_id,this.h=a.is_login,this.l=a.logout_url,this.j=a.login_url,zf(this.logger,a.email+" login"),this.l=a.logout_url,this.user_id=a.Id?a.Id.$t:void 0,this.h=!0,this.j=void 0,this.S(Nh,!0),Ph(this),!0;a.login_url&&(zf(this.logger,"NO user"),this.j=a.login_url,this.h=!1,this.email=this.user_id=this.l=this.o=void 0,this.S(Nh,!0),Ph(this));return!1};
ui.prototype.u=function(a,b){P(this.logger,"Receiving "+(b.Ga()?"":"fail")+" login info from server.");if(b.Ga()){var c=a.User;if(c){var d;d=this.load(c)?new ti("user-login",this,this.l):new ti("user-logout",this,this.j);Kf(function(){this.dispatchEvent(d)},0,this)}}else M(this.logger,"Server return error with: "+b.Ma());this.i&&this.i.stop()};
function vi(a,b){var c=new C,d=qi(ri);if(!d)return E("login server not available.");var e={pm:a.p,state:Math.random().toString().substr(2,6)};if(b)for(var f in b)e[f]=b[f];d.request(new si("/rpc_login","GET",e)).execute(function(a,b){a?c.D(a.User):c.F(b)},a);return c};function wi(){this.g=A()}var xi=new wi;wi.prototype.set=function(a){this.g=a};wi.prototype.get=function(){return this.g};function yi(a){this.j=a||"";this.l=xi}yi.prototype.g=!0;yi.prototype.h=!1;function zi(a){a=new Date(a.l);return Ai(a.getFullYear()-2E3)+Ai(a.getMonth()+1)+Ai(a.getDate())+" "+Ai(a.getHours())+":"+Ai(a.getMinutes())+":"+Ai(a.getSeconds())+"."+Ai(Math.floor(a.getMilliseconds()/10))}function Ai(a){return 10>a?"0"+a:String(a)}function Bi(a,b){var c=(a.l-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d}function Ci(a){yi.call(this,a)}B(Ci,yi);Ci.prototype.h=!0;
Ci.prototype.i=function(a){var b;switch(a.j.value){case nf.value:b="dbg-sh";break;case of.value:b="dbg-sev";break;case pf.value:b="dbg-w";break;case qf.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.j," ");this.g&&c.push("[",zi(a),"] ");c.push("[",Ja(Bi(a,this.l.get())),"s] ");c.push("[",Ca(a.h),"] ");c.push('<span class="',b,'">',Ba(Ja(Ca(a.getMessage()))));this.h&&a.i&&c.push("<br>",Ba(Ja(a.g||"")));c.push("</span>");c.push("<br>");return c.join("")};
function Di(a){yi.call(this,a)}B(Di,yi);Di.prototype.i=function(a){var b=[];b.push(this.j," ");this.g&&b.push("[",zi(a),"] ");b.push("[",Bi(a,this.l.get()),"s] ");b.push("[",a.h,"] ");b.push(a.getMessage());this.h&&a.i&&b.push("\n",a.g);b.push("\n");return b.join("")};function Ei(){this.j=y(this.o,this);this.g=new Di;this.g.g=!1;this.h=this.g.h=!1;this.i="";this.l={}}function Fi(a){var b=Gi;if(a!=b.h){var c=Df();a?xf(c,b.j):(c=c.g)&&Cb(c,b.j);b.h=a}}Ei.prototype.o=function(a){if(!this.l[a.h]){var b=this.g.i(a),c=Hi;if(c)switch(a.j){case nf:Ii(c,"info",b);break;case of:Ii(c,"error",b);break;case pf:Ii(c,"warn",b);break;default:Ii(c,"debug",b)}else window.opera?window.opera.postError(b):this.i+=b}};var Hi=window.console;
function Ii(a,b,c){if(a[b])a[b](c);else a.log(c)};function Ji(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d}h=Ji.prototype;h.ha=function(){return new Ji(this.top,this.right,this.bottom,this.left)};h.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"};h.contains=function(a){return this&&a?a instanceof Ji?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom:!1};
h.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};h.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};h.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};function Ki(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}h=Ki.prototype;h.ha=function(){return new Ki(this.left,this.top,this.width,this.height)};h.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"};h.contains=function(a){return a instanceof Ki?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};
h.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};h.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};h.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function Li(a,b){var c=gh(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))?c[b]||c.getPropertyValue(b)||"":""}function Mi(a,b){return Li(a,b)||(a.currentStyle?a.currentStyle[b]:null)||a.style&&a.style[b]}
function Ni(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}G&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function Oi(a){if(G&&!(G&&8<=sc))return a.offsetParent;var b=gh(a),c=Mi(a,"position"),d="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=Mi(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null}
function Pi(a){for(var b=new Ji(0,Infinity,Infinity,0),c=eh(a),d=c.g.body,e=c.g.documentElement,f=lh(c.g);a=Oi(a);)if(!(G&&0==a.clientWidth||kc&&0==a.clientHeight&&a==d)&&a!=d&&a!=e&&"visible"!=Mi(a,"overflow")){var g=Qi(a),k;k=a;if(jc&&!qc("1.9")){var l=parseFloat(Li(k,"borderLeftWidth"));if(Ri(k))var m=k.offsetWidth-k.clientWidth-l-parseFloat(Li(k,"borderRightWidth")),l=l+m;k=new bh(l,parseFloat(Li(k,"borderTopWidth")))}else k=new bh(k.clientLeft,k.clientTop);g.x+=k.x;g.y+=k.y;b.top=Math.max(b.top,
g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}d=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,d);b.top=Math.max(b.top,f);c=(mh(c.g)||window).document;c="CSS1Compat"==c.compatMode?c.documentElement:c.body;c=new dh(c.clientWidth,c.clientHeight);b.right=Math.min(b.right,d+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null}
function Qi(a){var b,c=gh(a),d=Mi(a,"position"),e=jc&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==d&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new bh(0,0),g;b=c?gh(c):document;g=!G||G&&9<=sc||Fh(eh(b))?b.documentElement:b.body;if(a==g)return f;if(a.getBoundingClientRect)b=Ni(a),a=Gh(eh(c)),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!e)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=
b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);if(kc&&"fixed"==Mi(b,"position")){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(ic||kc&&"absolute"==d)f.y-=c.body.offsetTop;for(b=a;(b=Oi(b))&&b!=c.body&&b!=g;)f.x-=b.scrollLeft,ic&&"TR"==b.tagName||(f.y-=b.scrollTop)}return f}function Si(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a}
function Ti(a){var b=Ui;if("none"!=Mi(a,"display"))return b(a);var c=a.style,d=c.display,e=c.visibility,f=c.position;c.visibility="hidden";c.position="absolute";c.display="inline";a=b(a);c.display=d;c.position=f;c.visibility=e;return a}function Ui(a){var b=a.offsetWidth,c=a.offsetHeight,d=kc&&!b&&!c;return t(b)&&!d||!a.getBoundingClientRect?new dh(b,c):(a=Ni(a),new dh(a.right-a.left,a.bottom-a.top))}function Vi(a){var b=Qi(a);a=Ti(a);return new Ki(b.x,b.y,a.width,a.height)}
function R(a,b){a.style.display=b?"":"none"}function Ri(a){return"rtl"==Mi(a,"direction")}var Wi=jc?"MozUserSelect":kc?"WebkitUserSelect":null;function Xi(a,b,c){c=c?null:a.getElementsByTagName("*");if(Wi){if(b=b?"none":"",a.style[Wi]=b,c){a=0;for(var d;d=c[a];a++)d.style[Wi]=b}}else if(G||ic)if(b=b?"on":"",a.setAttribute("unselectable",b),c)for(a=0;d=c[a];a++)d.setAttribute("unselectable",b)}
function Yi(a,b){if(/^\d+px?$/.test(b))return parseInt(b,10);var c=a.style.left,d=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var e=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=d;return e}function Zi(a,b){var c=a.currentStyle?a.currentStyle[b]:null;return c?Yi(a,c):0}var $i={thin:2,medium:4,thick:6};
function aj(a,b){if("none"==(a.currentStyle?a.currentStyle[b+"Style"]:null))return 0;var c=a.currentStyle?a.currentStyle[b+"Width"]:null;return c in $i?$i[c]:Yi(a,c)}function bj(a){if(G&&!(G&&9<=sc)){var b=aj(a,"borderLeft"),c=aj(a,"borderRight"),d=aj(a,"borderTop");a=aj(a,"borderBottom");return new Ji(d,c,a,b)}b=Li(a,"borderLeftWidth");c=Li(a,"borderRightWidth");d=Li(a,"borderTopWidth");a=Li(a,"borderBottomWidth");return new Ji(parseFloat(d),parseFloat(c),parseFloat(a),parseFloat(b))}var ej=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;function fj(a){this.l=y(this.o,this);this.h=new Ci;this.i=this.h.g=!1;this.g=a;this.j=this.g.ownerDocument||this.g.document;a=eh(this.g);var b=null,c=a.g;if(G&&c.createStyleSheet)a=b=c.createStyleSheet(),G&&t(a.cssText)?a.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":
a.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}";else{c=ih(a.g,"head",void 0,void 0)[0];c||(b=ih(a.g,"body",void 0,void 0)[0],c=a.s("head"),b.parentNode.insertBefore(c,b));var d=b=a.s("style");G&&t(d.cssText)?d.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":
d.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}";a.appendChild(c,b)}this.g.className+=" logdiv"}
fj.prototype.o=function(a){var b=100>=this.g.scrollHeight-this.g.scrollTop-this.g.clientHeight,c=this.j.createElement("div");c.className="logmsg";c.innerHTML=this.h.i(a);this.g.appendChild(c);b&&(this.g.scrollTop=this.g.scrollHeight)};fj.prototype.clear=function(){this.g.innerHTML=""};var Gi=null,gj=null;Q("ydn.debug");function hj(a,b,c){if(ha(b))b=new mf("log",b);else if(v(b)){b=b.toUpperCase();if(!wf){wf={};for(var d=0,e;e=vf[d];d++)wf[e.value]=e,wf[e.name]=e}b=wf[b]||null}else b=sf;Q(a||"ydn").h=b;t(c)?gj||(a=gj=new fj(c),!0!=a.i&&(c=Df(),xf(c,a.l),a.i=!0),Df().h=pf):Gi||gj||(Gi=new Ei,Fi(!0),Df().h=pf)}var ij=null;function jj(a){ij&&setTimeout(function(){ij.log(a)},10)};var ri="login",kj=Q("ydn.http"),lj={},mj=[];var nj,oj={},pj=[];function qj(a,b){oj[b||"default"]=a}function qi(a){if(!t(a))return oj["default"];for(var b=a,c=0;c<pj.length;c++){var d=(0,pj[c])(a);if(d){b=d;break}}return oj[b]||null}function rj(){nj||(nj=new wg);return nj}function sj(a,b,c,d){v(a)?this.Fc=a:(this.Fc=null,this.status=a,this.body=b,this.headers=c||{},this.g=d)}function tj(a){if(a.Fc){var b=Sh(a.Fc);b.gapiRequest&&(b=b.gapiRequest.data);a.status=b.status;a.g=b.statusText;a.headers=b.headers;a.body=b.body;a.Fc=null}}
sj.prototype.N=function(){tj(this);return this.status};sj.prototype.Ga=function(){tj(this);return 200<=this.status&&400>this.status};sj.prototype.Ma=function(){tj(this);return this.g||""};function uj(a){tj(a);return a.body}function vj(a,b){tj(a);return a.headers[b]}sj.prototype.Rc=function(){tj(this);return this.headers};
function wj(a){var b;tj(a);"application/json"==vj(a,"content-type")?b=!0:(b=a.body,b=v(b)&&!ya(b)?/^[\],:{}\s]*$/.test(b.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")):!1);return b&&v(a.body)?JSON.parse(a.body):a.body}function xj(a){return a instanceof sj?a:v(a)?new sj(a):new sj(a.status,a.body,a.headers,a.statusText)}
function si(a,b,c,d,e){this.path=a;this.method=b?b.toUpperCase():"GET";this.params=c||{};this.headers=d||{};this.body=e}var yj=null;function zj(a,b,c,d){this.l=t(b)?b:rj();this.j="sr"+Aj++;this.o=c||0;this.p=!!d;this.g=a}var Aj=0;zj.prototype.H=function(){return this.j};
zj.prototype.execute=function(a,b){var c=this.g,d=new Sd(c.path),e;for(e in c.params)d.g.set(e,c.params[e]);this.l.send(this.j,d.toString(),c.method,c.body,c.headers,void 0,function(d){d=d.target;for(var e=(d.U&&4==jg(d)?d.U.getAllResponseHeaders():"").split("\n"),k={},l=0;l<e.length;l++){var m=e[l].indexOf(":");0<m&&(k[e[l].substr(0,m).toLowerCase()]=e[l].substr(m+1).trim())}e=l=kg(d);if(k["content-type"]&&/json/.test(k["content-type"]))if(x(l))e=l;else if(v(l))try{e=Sh(l)}catch(n){e=l}k=new sj(d.N(),
l,k,d.Ma());yj&&!k.Ga()&&yj.log({"class":"ydn.gdata.Entry",method:"commit",context:"HTTP request",HttpRequestData:{path:c.path,uri:String(d.u),method:c.method,params:c.params,headers:c.headers,body:c.body},HttpRespondData:{status:k.N(),statusText:k.Ma(),body:uj(k),headers:k.Rc()}});a&&(a.call(b,e,k),a=null)},this.o,void 0,this.p);this.l=null};zj.prototype.toString=function(){return"HTTPRequest:"+this.j};function Bj(a,b,c){this.h=a;this.i=b;this.g=null;this.Sh=t(c)?c:!0}Bj.prototype.request=function(a){return new Cj(a,this)};function Cj(a,b){zj.call(this,a,b.i);this.parent=b}B(Cj,zj);var Dj=new sj(0,null,null,"No access token");
Cj.prototype.execute=function(a,b){function c(){this.Sh?d.g.headers.Authorization="Bearer "+d.parent.g.access_token:d.g.params.access_token=d.parent.g.access_token}var d=this;d.parent.g&&d.parent.g.expires>A()?(c(),Cj.m.execute.call(this,function(e,f){401==f.N()?Ej(d.parent.h).w(function(e){d.parent.g=e;c();Cj.m.execute.call(d,a,b)},function(){d.parent.g=null;a.call(b,null,Dj)},d):a.call(b,e,f)},this)):Ej(this.parent.h).w(function(e){d.parent.g=e;c();Cj.m.execute.call(this,a,b)},function(){d.parent.g=
null;a.call(b,null,Dj)},this)};function S(a,b,c,d){this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d;ia(Object.freeze)&&Object.freeze(this)}S.prototype.lower=void 0;S.prototype.upper=void 0;S.prototype.toJSON=function(){return Fj(this)};function Gj(a){return Hj(a)}S.only=function(a){return new S(a,a,!1,!1)};S.bound=function(a,b,c,d){return new S(a,b,c,d)};S.upperBound=function(a,b){return new S(void 0,a,void 0,!!b)};S.lowerBound=function(a,b){return new S(a,void 0,!!b,void 0)};
function Ij(a){var b;if(u(a))b=Eb(a),b.push("\uffff");else if(v(a))b=a+"\uffff";else if(ha(a))b=a+2.220460492503131E-16,a-=2.220460492503131E-16;else return S.only(a);return S.bound(a,b,!1,!0)}function Fj(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}}function Jj(a){if(null==a)return null;if(a instanceof S)return a;if(x(a))return new S(a.lower,a.upper,a.lowerOpen,a.upperOpen);throw new J("Invalid key range: "+a+" of type "+typeof a);}
function Hj(a){return null!=a?null!=a.upper&&null!=a.lower?Kj.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):null!=a.upper?Kj.upperBound(a.upper,a.upperOpen):null!=a.lower?Kj.lowerBound(a.lower,a.lowerOpen):null:null}function Lj(a){if(a instanceof S)return"";if(null!=a){if(x(a)){for(var b in a)if(a.hasOwnProperty(b)&&!Ab(["lower","upper","lowerOpen","upperOpen"],b))return'invalid attribute "'+b+'" in key range object';return""}return"key range must be an object"}return""}
S.prototype.me=function(a){var b=this.lower,c=this.upper,d=this.lowerOpen,e=this.upperOpen;null!=a.lower&&(null==this.lower||a.lower>=this.lower)&&(b=a.lower,d=a.lowerOpen||this.lowerOpen);null!=a.upper&&(null==this.upper||a.upper<=this.upper)&&(c=a.upper,e=a.upperOpen||this.upperOpen);return S.bound(b,c,d,e)};function Mj(a){if(!a)return"";var b=a.lowerOpen?"(":"[";null!=a.lower&&(b+=a.lower+", ");null!=a.upper&&(b+=a.upper);return b+=a.upperOpen?")":"]"}
function Nj(a,b,c,d,e){if(c)if(c.lowerOpen||c.upperOpen||null==c.lower||null==c.upper||0!==Oj(c.lower,c.upper)){if(null!=c.lower){var f=c.lowerOpen?" > ":" >= ";d.push(a+f+"?");e.push(Pj(c.lower,b))}null!=c.upper&&(f=c.upperOpen?" < ":" <= ",d.push(a+f+"?"),e.push(Pj(c.upper,b)))}else d.push(a+" = ?"),e.push(Pj(c.lower,b))}var Kj=r.IDBKeyRange||r.webkitIDBKeyRange||S;function Qj(a,b){var c,d;2==arguments.length&&v(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=fa(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],t(a));c++);return a}function Rj(a,b,c){if(a)if(-1==b.indexOf("."))a[b]=c;else{b=b.split(".");for(var d=b.pop(),e;e=b.shift();)x(a[e])||(a[e]={}),a=a[e];a[d]=c}}var Sj={};
function Tj(a){a=[a];for(var b=new Uj,c=0,d,e;void 0!==(e=a.pop());){0===c%4&&12<c+4&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=4,0<e.length){a.push(Sj);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=1,b.write(c),Vj(b,e);else if(e instanceof Date)c+=2,b.write(c),Vj(b,e.valueOf());else if("string"===d){c+=3;b.write(c);c=b;for(d=0;d<e.length;d++){var f=e.charCodeAt(d);126>=f?c.write(f+1):16510>=f?(f-=127,c.write(128|f>>8,f&255)):c.write(192|f>>10,f>>
2|255,(f|3)<<6)}c.write(0)}else if(e===Sj)b.write(0);else return"";c=0}return b.trim().toString()}function Wj(a){for(var b=[],c=b,d=[],e,f,g=new Xj(a);null!=g.read();)if(0===g.current)c=d.pop();else{if(null===g.current)break;do{e=g.current/4|0;a=g.current%4;for(var k=0;k<e;k++)f=[],c.push(f),d.push(c),c=f;if(0===a&&12<g.current+4)g.read();else break}while(1);1===a?c.push(Yj(g)):2===a?c.push(new Date(Yj(g))):3===a?c.push(Zj(g)):0===a&&(c=d.pop())}return b[0]}
function Vj(a,b){var c,d,e;c=b;var f=e=d=0;if(0!==c)if(isFinite(c)){0>c&&(d=1,c=-c);f=0;if(2.2250738585072014E-308<=c){for(e=c;1>e;)f--,e*=2;for(;2<=e;)f++,e/=2;e=f+1023}f=e?Math.floor(4503599627370496*(c/Math.pow(2,f)-1)):Math.floor(c/4.9E-324)}else e=2047,isNaN(c)?f=0x8000000000000:-Infinity===c&&(d=1);c=d;d=e;e=f;c&&(e=0xfffffffffffff-e,d=2047-d);a.write((c?0:128)|d>>4);a.write((d&15)<<4|0|e/281474976710656);e%=281474976710656;c=0|e/4294967296;a.write(c>>8,c&255);e%=4294967296;c=0|e/65536;a.write(c>>
8,c&255);c=e%65536;a.write(c>>8,c&255)}function Yj(a){var b=a.read()|0,c=b>>7?!1:!0,d=c?-1:1,e=(b&127)<<4,b=a.read()|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(a.read()|0):a.read()|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d}
function Zj(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=a.read();if(0===f||null==f)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")}function Xj(a){this.current=null;this.g=a;this.h=this.g.length-1;this.index=-1}
Xj.prototype.read=function(){return this.current=this.index<this.h?parseInt(this.g[++this.index]+this.g[++this.index],16):null};function Uj(){this.g=[];this.h=void 0}Uj.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.h=arguments[b].toString(16),this.g.push(2===this.h.length?this.h:this.h="0"+this.h)};Uj.prototype.trim=function(){for(var a=this.g.length;"00"===this.g[--a];);this.g.length=++a;return this};Uj.prototype.toString=function(){return this.g.length?this.g.join(""):""};
function ak(a,b){var c=Tj(a),d=Tj(b);return c>d?1:c==d?0:-1};function bk(a,b,c,d,e){if(!(b instanceof S))if(v(b)&&t(c)){var f,g,k,l;if("starts"==b||"^"==b)b=Ij(c);else{if("<"==b||"<="==b)f=c,k="<"==b;else if(">"==b||">="==b)g=c,l=">"==b;else if("="==b||"=="==b)f=g=c;else throw new J("invalid op: "+b);if("<"==d||"<="==d)f=e,k="<"==d;else if(">"==d||">="==d)g=e,l=">"==d;else if(t(d))throw new J("invalid op2: "+d);b=S.bound(g,f,l,k)}}else b=Jj(b);this.g=b;this.h=a}bk.prototype.h="";bk.prototype.Qc=function(){return this.h};
bk.prototype.me=function(a){if(this.h!=a.h)return null;a=null!=this.g&&null!=a.g?this.g.me(a.g):this.g||a.g;return new bk(this.h,a)};var ck={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},dk=r.IDBRequest&&"LOADING"in r.IDBRequest?r.IDBTransaction:r.webkitIDBRequest&&"LOADING"in r.webkitIDBRequest&&1===r.webkitIDBTransaction.READ_WRITE?r.webkitIDBTransaction:ck,ek=dk.READ_ONLY,fk=dk.READ_WRITE,gk=dk.VERSION_CHANGE,hk=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.moz_indexedDB||r.msIndexedDB;function ik(a,b,c,d){ac.call(this);this.h=c;this.R=c.getName();this.eb=void 0;this.j=!1;this.ba=null;this.o=a;this.Xb=b;this.wa=0;this.ca=this.T=!1;this.V=d||4;this.u=this.i=this.g=void 0;this.C=function(){throw new ud;};this.aa=function(){throw new ud;};this.Va=function(){}}B(ik,ac);h=ik.prototype;
h.init=function(a,b,c,d,e){if(t(b)){a=this.h;var f,g=b;u(b)?(f=jk(a,b),g=b.join(", ")):f=kk(a,b);if(!f)throw new J('require index "'+g+'" not found in store "'+a.getName()+'"');this.eb=f.getName()}this.j=v(this.eb);this.ba=c||null;this.wa=0;this.ca=this.T=!1;this.reverse="prev"==d||"prevunique"==d;this.unique="nextunique"==d||"prevunique"==d;this.sb=d;this.Yc=e;this.u=this.i=this.g=void 0};h.sb="";h.ba=null;h.unique=!1;h.reverse=!1;h.Yc=!0;h.logger=Q("ydn.db.core.req.AbstractCursor");
function lk(a,b){a.aa(b);mk(a);a.T=!0}h.ob=function(a,b,c){null==a&&(N(this.logger,this+" finished."),this.T=!0);this.g=a;this.i=b;this.u=c;this.wa++;this.T?(P(this.logger,this+" DONE."),this.C(),mk(this)):(P(this.logger,this+" new cursor position {"+(this.j?this.g+", "+this.i:this.g)+"}"),this.C(this.g))};h.J=function(){this.o=null};h.toString=function(){return"Cursor:"+this.R+(t(this.eb)?":"+this.eb:"")+"["+(this.o?"":"~")+this.Xb+"]"};
function mk(a){null!=a.i?a.i=nk(a.i):a.i=void 0;null!=a.g?a.g=nk(a.g):a.g=void 0;a.Va(a.ca,a.g,a.i)}h.open=function(a,b,c,d){this.o=a;this.Xb=b;this.T=this.ca=!1;this.g=c;this.i=d;this.openCursor(this.g,this.i)};function ok(a){a.ca=!0;P(a.logger,a+": exit");mk(a)}h.fa=function(){return this.wa};h.ia=function(){return this.j?this.i:this.g};h.P=function(){return this.Yc?this.ia():this.u};h.Lc=function(){};h.Zb=function(){};
h.restart=function(a,b){P(this.logger,this+" restarting");this.ca=this.T=!1;this.openCursor(b,a)};function pk(){};function qk(a,b,c,d,e,f,g){if(!v(a))throw new TypeError("store name must be a string, but "+a+" found.");this.i=a;this.h=b;this.o=g;this.p=!!this.h;if(t(d)&&!ga(d))throw new J("reverse value must be a boolean, but "+typeof d+" found");if(t(e)&&!ga(e))throw new J("unique value must be a boolean, but "+typeof e+" found");if(t(f)&&!ga(f))throw new J("key_only value must be a boolean, but "+typeof f+" found");this.g=t(f)?f:!!v(this.h);a="next";d&&e?a="prevunique":d?a="prev":e&&(a="nextunique");this.l=
a;if(d=Lj(c))throw new J("Invalid key range: "+d);this.j=Hj(c);this.u=rk;this.O=NaN}B(qk,pk);qk.prototype.g=!0;function sk(a,b,c,d,e){if(!v(b))throw new J("index name must be string");qk.call(this,a,b,c,d,e,!0)}B(sk,qk);function tk(a,b,c){if(3<arguments.length)throw new J("too many argument");qk.call(this,a,void 0,b,c,void 0,!1)}B(tk,qk);function uk(a,b,c,d,e){if(!v(b))throw new J("index name must be string");qk.call(this,a,b,c,d,e,!1)}B(uk,qk);var rk="init";h=qk.prototype;h.logger=Q("ydn.db.Iterator");
h.I=function(){return this.i};h.ha=function(){var a=new qk(this.i,this.h,this.j,vk(this),wk(this),this.g,this.o);a.O=this.O;return a};h.unique=function(a){return new qk(this.i,this.h,this.j,vk(this),a,this.g,this.o)};h.toJSON=function(){return{store:this.i,index:this.h,keyRange:this.j?Fj(this.j):null,direction:this.l}};
h.toString=function(){var a=t(this.o)?":"+this.o.join(","):t(this.h)?":"+this.h:"",a=a+Mj(this.j);this.u!=rk&&(a+=this.u+"{"+this.G,this.p&&(a+=", "+this.C),a+="}");var b=this.p?"Index":"",b=b+(this.g?"Key":"Value");return b+"Iterator:"+this.i+a};h.reverse=function(){return new qk(this.i,this.h,this.j,!vk(this),wk(this),this.g,this.o)};function vk(a){return"prev"===a.l||"prevunique"===a.l}function wk(a){return"nextunique"===a.l||"prevunique"===a.l}
h.load=function(a){a=a[0];a.init(this.i,this.o||this.h,this.j,this.l,this.g);this.u="busy";var b=this;a.Va=function(a,d,e){b.G=d;b.C=e;b.u=a?"rest":"done"};a.openCursor(this.G,this.C);return a};h.ia=function(){return this.C};h.stores=function(){return[this.i]};function xk(a,b,c){vd.call(this,b,c);this.O=a;this.p=[];this.G=[];this.Va=[];this.g=null;this.rb="";this.wa=0}B(xk,vd);h=xk.prototype;h.rb="";h.logger=Q("ydn.db.Request");function yk(a,b,c){a.g=b;a.rb=c;N(a.logger,a+" BEGIN");if(b){for(c=0;c<a.G.length;c++)a.G[c][0].call(a.G[c][1],b);a.G.length=0}N(a.logger,a+" END")}function zk(a){var b=new xk(a.O);a.wa++;yk(b,a.g,a.rb+"C"+a.wa);return b}h.Bd=function(){return this.O};
h.abort=function(){if(this.g)if(N(this.logger,this+" aborting"),ia(this.g.abort))this.g.abort();else if(ia(this.g.executeSql))this.g.executeSql("ABORT",[],function(){},function(){return!0});else throw new qd;else throw new Ak("No active transaction");};function T(a,b,c){var d=a.Va.shift();c=!!c;d?d[0].call(d[1],b,c,function(b,c){T(a,b,c)}):c?a.F(b):a.D(b)}function Bk(a,b,c){a.Va.push([b,c])}function U(a,b,c){a.g?b.call(c,a.g):a.G.push([b,c])}
h.D=function(a){N(this.logger,this+" SUCCESS");xk.m.D.call(this,a);this.g=null;this.rb=this.rb};h.F=function(a){N(this.logger,this+" ERROR");xk.m.F.call(this,a);this.g=null;this.rb=this.rb};function V(a){var b="";a.rb&&(b=a.g?"*":"",b="["+a.rb+b+"]");return a.O+b}function Ck(a,b){var c=new xk(a);T(c,b);return c}h.toString=function(){return"Request:"+V(this)};
h.se=function(){this.o&&this.h&&Wb(this)&&(Xb(this.o),this.o=0);this.i&&(this.i.T--,delete this.i);for(var a=this.j,b=!1;this.u.length&&!this.C;){var c=this.u.shift(),d=c[0],e=c[1],c=c[2];if(d=this.l?e:d)d=d.call(c||this.aa,a),t(d)&&(this.l=this.l&&(d==a||d instanceof Error),this.j=a=d),ra(a)&&(this.C=b=!0)}this.j=a;b&&(b=y(this.td,this,!0),d=y(this.td,this,!1),a instanceof C?(a.w(b,d),a.la=!0):a.then(b,d))};
h.toJSON=function(){var a=(this.rb||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.O?this.O.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};var Oj=hk&&hk.cmp?y(hk.cmp,hk):ak,Dk=[];function Ek(a){Error.captureStackTrace?Error.captureStackTrace(this,Ek):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ConstraintError"}B(Ek,Error);Ek.prototype.name="ConstraintError";Ek.prototype.toString=function(){return this.name+": "+this.message};function Fk(a){Error.captureStackTrace?Error.captureStackTrace(this,Fk):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"}B(Fk,Error);
Fk.prototype.toString=function(){return this.name+": "+this.message};function Gk(a){Error.captureStackTrace?Error.captureStackTrace(this,Gk):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.VersionError"}B(Gk,Error);Gk.prototype.name="ydn.db.VersionError";Gk.prototype.toString=function(){return this.name+": "+this.message};function Hk(a){Error.captureStackTrace?Error.captureStackTrace(this,Hk):this.stack=Error().stack||"";a&&(this.message=String(a))}B(Hk,Error);
Hk.prototype.name="ydn.db.InternalError";function Ak(a){Error.captureStackTrace?Error.captureStackTrace(this,Ak):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"}B(Ak,Error);function Ik(a){Error.captureStackTrace?Error.captureStackTrace(this,Ik):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"}B(Ik,Error);
function Jk(a){Error.captureStackTrace?Error.captureStackTrace(this,Jk):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"}B(Jk,Error);Jk.prototype.name="NotFoundError";Jk.prototype.toString=function(){return this.name+": "+this.message};function Kk(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Kk):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"}B(Kk,Error);
Kk.prototype.toString=function(){return this.name+": "+this.message};function Lk(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Lk):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"}B(Lk,Error);Lk.prototype.toString=function(){return this.name+": "+this.message};function Mk(a){Error.captureStackTrace?Error.captureStackTrace(this,Mk):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.SqlParseError"}
B(Mk,Error);function Nk(a){Error.captureStackTrace?Error.captureStackTrace(this,Nk):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"}B(Nk,Error);function Ok(a,b,c){var d;if(x(a))d=a.store,b=a.id,null!=a.parent&&(c=new Ok(a.parent));else if(t(b))d=a;else if(d=a.lastIndexOf("^|"),b=a,0<d&&(b=a.substr(d),c=new Ok(a.substring(0,d))),b=b.split("^:"),d=b[0],b=b[1],!t(b))throw Error("Invalid key value: "+a);this.R=d;this.id=b;this.parent=c||null}h=Ok.prototype;h.toJSON=function(){var a={store:this.R,id:this.id};this.parent&&(a.parent=this.parent.toJSON());return a};
h.valueOf=function(){return(this.parent?this.parent.valueOf()+"^|":"")+this.R+"^:"+this.id};h.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};h.I=function(){return this.R};h.H=function(){return this.id};function Pk(a){return u(a.id)?a.id.join("^|"):a.id instanceof Date?+a.id:a.id}h.getParent=function(){return this.parent};function Qk(a){return ha(a)||v(a)||u(a)&&xb(a,Qk)||a instanceof Date}
function nk(a){if(fa(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};function Rk(a,b){this.g=b}Rk.prototype.logger=Q("ydn.db.crud.req.RequestExecuto");Rk.prototype.toString=function(){return"RequestExecutor"};function Sk(a,b,c,d,e,f){this.la=a;this.wa=b;this.g=this.i=0;this.aa=d;this.V=e;this.l=c||Tk;this.O=f||0;this.u=!1;this.C=0}h=Sk.prototype;h.logger=Q("ydn.db.tr.Thread");h.Ih=function(a){if("complete"==a||"abort"==a)this.u?(P(this.logger,"tx "+this.i+" committed"),this.u=!1):(P(this.logger,"Generator done "+this.u),T(null,this.i,"complete"!=a))};
h.Kc=function(){if(t(this.G))if(this.G)P(this.logger,"Receive to commit tx "+this.i+" on yield "+this.C),this.u=!0;else throw new td("Coroutine transaction thread has been ended");else throw new td("Transaction thread not running in a generator");};
function Uk(a,b){a.u?(P(a.logger,"waiting tx to be committed for yielding "+a.C),setTimeout(function(){a.Vb(function(){P(a.logger,"sending result to yield "+a.C);a.G.next(b)},a.aa,a.V,y(a.Ih,a))},4)):(P(a.logger,"sending result to yield "+a.C),a.G.next(b));a.C++}h.request=function(a){a=new xk(a);this.G&&a.w(function(a){Uk(this,a)},function(a){var c=a;a instanceof Error||(c=Error(),c.error=a);Uk(this,c)},this);return a};h.type=function(){return Vk(this.la)};h.K=function(){return this.la};
h.Qa=function(){return"B"+this.wa+"T"+this.i};var Tk="single";function Wk(a){if(a)if(ia(a.abort))a.abort();else if(ia(a.executeSql))a.executeSql("ABORT",[],null,function(){return!0});else throw new qd;else throw new Ak("No active transaction");};function Xk(a){this.i=a;this.g=null;this.h=0}Xk.prototype.logger=Q("ydn.db.tr.Mutex");Xk.prototype.hb=null;function Yk(a){return!!a.g&&!a.j}Xk.prototype.Za=null;Xk.prototype.toString=function(){return"Mutex:"+("B"+this.i+"T"+this.h)+(this.g?"*":"")};function Zk(a,b,c,d,e,f){Sk.call(this,a,b,c,d,e,f);this.j=[];this.o=[];this.p=null;this.h=new Xk(b);this.T=f||0;this.ca=!1}B(Zk,Sk);h=Zk.prototype;h.logger=Q("ydn.db.tr.Serial");
function $k(a,b,c){if("multi"==a.l)a:if(a=a.h,!a.hb||!a.mode||c!=a.mode&&(a.mode!=fk||c!=ek)||b.length>a.hb.length)b=!1;else{for(c=0;c<b.length;c++)if(-1==a.hb.indexOf(b[c])){b=!1;break a}b=!0}else if("repeat"==a.l)a:if(a=a.h,a.hb&&a.mode&&c==a.mode&&a.hb.length==b.length){for(c=0;c<b.length;c++)if(-1==a.hb.indexOf(b[c])){b=!1;break a}b=!0}else b=!1;else b="all"==a.l?!0:!1;return b}
function al(a){var b=0<a.j.length?a.j[0].hb:null,c=0<a.j.length?a.j[0].mode:null;return null!=b&&null!=c?$k(a,b,c):!1}function bl(a,b,c,d,e){P(a.logger,"push tx queue["+a.j.length+"]");a.j.push({zd:b,hb:c,mode:d,Za:e})}h.abort=function(){N(this.logger,this+": aborting");Wk(this.p)};
h.Vb=function(a,b,c,d){var e=v(b)?[b]:b;if(fa(e)){if(0==e.length)throw new J("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!v(e[f]))throw new J("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.kb&&!Ab(this.kb,e[f]))throw new J('store name "'+f+e[f]+'" in scope of '+this);}}else throw new J("store names must be an array");var g=t(c)?c:ek,k=this;if(this.h.g||!cl(this.K())&&this.ca)bl(this,a,b,g,d);else{var l=this.Qa();d&&this.o.push(d);
if(this.T&&this.i>=this.T)throw new td("Exceed maximum number of transactions of "+this.T);this.ca=!0;dl(this.K(),function(c){var d=k.h;d.g=c;d.j=!1;d.hb=b;d.mode=g;d.h++;d.Za=null;l=k.Qa();zf(k.logger,l+" BEGIN "+Uh(b)+" "+g);a(k);for(a=null;al(k);)c=k.j.shift(),c.Za&&k.o.push(c.Za),P(k.logger,"pop tx queue"+(k.j.length+1)+" reusing T"+k.i),c.zd()},e,g,function(a,b){zf(k.logger,l+" "+a);var c=k.h;c.g?(c.g=null,c.hb=null,c.mode=null,ia(c.Za)&&c.Za(a,b),c.Za=null):M(c.logger,c+" has no TX to be unlocked for "+
a);for(c=0;c<k.o.length;c++)(0,k.o[c])(a,b);k.o.length=0;(c=k.j.shift())&&k.Vb(c.zd,c.hb,c.mode,c.Za);k.g=0})}};h.Qa=function(){var a=this.h;return"B"+a.i+"T"+a.h};h.request=function(a,b,c,d){var e=Zk.m.request.call(this,a,b,c,d);a=c||ek;var f=this;Yk(this.h)&&$k(this,b,a)?(b=this.h.g,this.g++,yk(e,b,this.Qa()+"R"+this.g),d&&this.o.push(d)):f.Vb(function(){var a=f.h.g;f.g++;yk(e,a,f.Qa()+"R"+f.g)},b,a,d);return e};
h.Wb=function(a,b,c,d,e){d=d||ek;var f=this,g;if(Yk(f.h)&&$k(this,c,d)){var k=f.h.g;f.g++;g=f.Qa()+"R"+f.g;N(f.logger,g+" BEGIN");b(k,g,function(b,c){f.p=k;c?(N(f.logger,g+" ERROR"),a.F(b)):(N(f.logger,g+" SUCCESS"),a.D(b));f.p=null});N(f.logger,g+" END");b=null}else f.Vb(function(){var c=f.h.g;f.g++;g=f.Qa()+"R"+f.g;N(f.logger,g+" BEGIN");b(c,g,function(b,d){f.p=c;d?(N(f.logger,g+" ERROR"),a.F(b)):(N(f.logger,g+" SUCCESS"),a.D(b));f.p=null});N(f.logger,g+" END");b=null},c,d,e)};h.getName=function(){return this.K().getName()};
h.toString=function(){return"Serial:"+this.Qa()+(this.p?"*":"")};function el(a,b){Zk.call(this,a,b)}B(el,Zk);el.prototype.logger=Q("ydn.db.tr.AtomicSerial");el.prototype.request=function(a,b,c){var d,e,f,g=el.m.request.call(this,a,b,c,function(a,b){g.g=null;if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new Nk;T(g,c,!0)}});Bk(g,function(a,b,c){f=b;e=a;d=c});return g};
el.prototype.Wb=function(a,b,c,d,e){var f,g,k=new C;k.w(function(a){g=!1;f=a},function(a){g=!0;f=a});el.m.Wb.call(this,k,b,c,d,function(b,c){if("complete"!=b)a.F(c);else if(!0===g)a.F(f);else if(!1===g)a.D(f);else{var d=new Nk;a.F(d)}e&&(e(b,c),e=void 0)})};el.prototype.toString=function(){return"Atomic"+el.m.toString.call(this)};function fl(a,b,c,d){this.j=a;this.h=b;this.g=c;this.Ua=d;this.i=null}h=fl.prototype;h.logger=Q("ydn.db.tr.DbOperator");h.abort=function(){this.g.abort()};function W(a){a.i||(a.i=a.j.C());return a.i}h.K=function(){return this.j};h.Kc=function(){this.g.Kc()};
function gl(a,b){var c=a.K(),d=b instanceof hl?b:il(b),e=b.name,f=X(c.h,e);if(0==jl(d,f).length)$b(!1);else if(f=f?"update":"add",c.h instanceof kl)ll(c.h,d),c.i?(c.i.close(),c.i=null,ml(c)):$b(!1);else throw new ci("Cannot "+f+" store: "+e+". Not auto schema generation mode.");}h.toString=function(){return"TxStorage:"+this.K().getName()};function nl(a,b,c,d){fl.call(this,a,b,c,d)}B(nl,fl);h=nl.prototype;h.logger=Q("ydn.db.crud.DbOperator");
h.count=function(a,b,c,d){var e,f,g,k;if(null!=a)if(u(a)){if(t(c)||t(b))throw new J("too many arguments.");f=a;for(var l=0;l<f.length;l++)if(!ol(this.h,f[l]))throw new J('store name "'+f[l]+'" at '+l+" not found.");N(this.logger,"countStores: "+Uh(f));e=this.g.request("count",f);U(e,function(){W(this).ud(e,f)},this)}else if(v(a)){l=X(this.h,a);if(!l)throw new J('store name "'+a+'" not found.');if(t(d)&&!ga(d))throw new J('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(v(b))if(g=
b,x(c)){var m=Lj(c);if(m)throw new J("invalid key range: "+Th(c)+" "+m);k=Hj(c)}else{if(null!=c)throw new J("invalid key range: "+Th(c)+" of type "+typeof c);k=null}else if(x(b)||null==b)if(x(b)){if(m=Lj(b))throw new J("invalid key range: "+Th(b)+" "+m);k=Hj(b)}else{if(null!=b)throw new J("key range must be  an object but found "+Th(b)+" of type "+typeof b);k=null}else throw new J('invalid second argument for count "'+Th(c)+'" of type '+typeof b);N(this.logger,"countKeyRange: "+a+" "+(g?g:"")+Uh(k));
e=this.g.request("count",f);pl(l,e,arguments);U(e,function(){W(this).Mc(e,f[0],k,g,!!d)},this)}else throw new J("Invalid store name or store names.");else M(this.logger,"count method requires store name(s)"),l=ql(this.h),e=this.g.request("count",l),Bk(e,function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),U(e,function(){W(this).ud(e,f)},this);return e};
h.get=function(a,b){var c=this,d;if(a instanceof Ok){var e=a,f=e.I(),g=X(this.h,f);if(!g){if(this.h.bb()){if(cl(this.K()))return Ck("get",void 0);d=new xk("get");this.K().Rb(function(){c.get(a,b).w(function(a){d.D(a)},function(a){d.F(a)})});return d}throw new J("Store: "+f+" not found.");}var k=e.H();N(this.logger,"getByKey: "+f+":"+k);d=this.g.request("get:key",[f]);pl(g,d,arguments,void 0,this);U(d,function(){W(this).Ad(d,f,k)},this)}else if(v(a)&&t(b)){var l=a,g=X(this.h,l);if(!g){if(this.h.bb()){if(cl(this.K()))return Ck("get",
void 0);d=new xk("get");this.K().Rb(function(){c.get(a,b).w(function(a){d.D(a)},function(a){d.F(a)})});return d}throw new J('Store name "'+l+'" not found.');}var m=b;N(this.logger,"getById: "+l+":"+m);d=this.g.request("get",[l]);pl(g,d,arguments,void 0,this);U(d,function(){W(this).Ad(d,l,m)},this)}else throw new J("get require valid input arguments.");return d};
h.keys=function(a,b,c,d,e,f,g){var k,l,m=null,n=!1,p=!1,q=a,s=X(this.h,q);if(!v(q))throw new J("store name must be a string, but "+q+" of type "+typeof q+" is not.");if(!this.h.bb()){if(!s)throw new J('store name "'+q+'" not found.');if(v(b)&&!kk(s,b))throw new J('index "'+b+'" not found in store "'+q+'".');}if(this.h.bb()&&!s)return Ck("keys",[]);var w;if(v(b)){var z=b,F=Lj(c);if(F)throw new J("invalid key range: "+c+" "+F);m=Hj(c);if(ha(d))k=d;else{if(t(d))throw new J("limit must be a number");
k=100}if(ha(e))l=e;else{if(t(e))throw new J("offset must be a number");l=0}if(t(f))if(ga(f))n=f;else throw new J("reverse must be a boolean");if(t(g))if(ga(g))p=g;else throw new J("unique must be a boolean");N(this.logger,"keysByIndexKeyRange: "+q);w=this.g.request("keys:iter:index",[q]);pl(s,w,arguments);U(w,function(){W(this).list(w,2,q,z,m,k,l,n,p)},this)}else{if(x(b)){if(F=Lj(b))throw new J("invalid key range: "+Th(b)+" "+F);m=Hj(b)}else{if(null!=b)throw new J("invalid key range: "+Th(b)+" of type "+
typeof b);m=null}if(ha(c))k=c;else{if(t(c))throw new J("limit must be a number");k=100}if(ha(d))l=d;else{if(t(d))throw new J("offset must be a number");l=0}if(t(e))if(ga(e))n=e;else throw new J("reverse must be a boolean");N(this.logger,"keysByKeyRange: "+q);w=this.g.request("keys",[q]);pl(s,w,arguments);U(w,function(){W(this).list(w,2,q,null,m,k,l,n,!1)},this)}return w};
h.values=function(a,b,c,d,e,f,g){var k=this,l,m,n,p=!1,q=!1;if(v(a)){var s=a,w=X(this.h,s);if(!w){if(this.h.bb()){if(cl(this.K()))return Ck("values",[]);l=new xk("values");this.K().Rb(function(){k.values(a,b,c,d,e,f).w(function(a){l.D(a)},function(a){l.F(a)})});return l}throw new Jk(s);}if(u(b)){if(t(c)||t(d))throw new J("too many input arguments");var z=b;N(this.logger,"listByIds: "+s+" "+z.length+" ids");l=this.g.request("values:array",[s]);pl(w,l,arguments,void 0,this);U(l,function(){W(this).Xe(l,
s,z)},this)}else if(v(b)){var F=b;if(!rl(w,F))throw new J('index "'+F+'" not found in store "'+s+'"');var D=Lj(c);if(D)throw new J("invalid key range: "+c+" "+D);var I=Hj(c);if(t(d))if(ha(d))m=d;else throw new J("limit must be a number.");else m=100;if(t(e))if(ha(e))n=e;else throw new J("offset must be a number.");else n=0;if(ga(f))p=f;else if(t(f))throw new J("reverse must be a boolean, but "+f);if(t(g))if(ga(g))q=g;else throw new J("unique must be a boolean");N(this.logger,"listByIndexKeyRange: "+
s+":"+F);l=this.g.request("values:iter:index",[s]);pl(w,l,arguments);U(l,function(){W(this).list(l,4,s,F,I,m,n,p,q)},this)}else{I=null;if(x(b)){if(D=Lj(b))throw new J("invalid key range: "+b+" "+D);I=Hj(b)}else if(null!=b)throw new J('expect key range object, but found "'+Th(b)+'" of type '+typeof b);if(t(c))if(ha(c))m=c;else throw new J("limit must be a number, but "+c+" is "+typeof c);else m=100;if(t(d))if(ha(d))n=d;else throw new J("offset must be a number, but "+d+" is "+typeof d);else n=0;if(t(e))if(ga(e))p=
e;else throw new J("reverse must be a boolean, but "+e+" is "+typeof e);N(this.logger,(I?"listByKeyRange: ":"listByStore: ")+s);l=this.g.request("values",[s]);pl(w,l,arguments);U(l,function(){W(this).list(l,4,s,null,I,m,n,p,!1)},this)}}else if(u(a))if(a[0]instanceof Ok){for(var w=[],O=a,D=0;D<O.length;D++){var sa=O[D].I();if(!ol(this.h,sa)){if(this.h.bb())return w=[],w[O.length-1]=void 0,Ck("get",w);throw new J("Store: "+sa+" not found.");}Ab(w,sa)||w.push(sa)}N(this.logger,"listByKeys: "+Uh(w)+" "+
O.length+" keys");l=this.g.request("values:keys",w);U(l,function(){W(this).Rd(l,O)},this)}else throw new J("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found.");else throw new J("first argument "+a+" is invalid.");return l};
h.list=function(a,b,c,d,e,f,g,k,l){var m=X(this.h,b);if(!m){if(this.h.bb())return Ck("get",[]);throw new Jk(b);}var n;if(c&&!rl(m,c))throw new J('index "'+c+'" not found in store "'+b+'"');if(m=Lj(d))throw new J("invalid key range: "+d+" "+m);var p=Hj(d),q=100;if(ha(e))q=e;else if(null!=e)throw new J('limit must be a number but "'+e+'" of type '+typeof e+" found.");var s=0;if(ha(f))s=f;else if(null!=f)throw new J('offset must be a number but "'+f+'" of type '+typeof f+" found.");var w=!1;if(ga(g))w=
g;else if(null!=g)throw new J('reverse must be a boolean but "'+g+'" of type '+typeof g+" found.");var z=!1;if(ga(k))z=k;else if(null!=k)throw new J('unique must be a boolean but "'+k+'" of type '+typeof k+" found.");if(s&&l&&t(l[0]))throw new J("offset must not given when initial cursor position is defined");N(this.logger,a+": "+b+":"+c);n=this.g.request("values:iter:index",[b]);U(n,function(){W(this).list(n,a,b,c||null,p,q,s,w,z,l)},this);return n};
h.add=function(a,b,c){var d=v(a)?a:x(a)?a.name:void 0;if(!v(d))throw new J("store name "+d+" must be a string, but "+typeof d);var e=X(this.h,d);if(!e){if(!this.h.bb())throw new J('store name "'+d+'" not found.');e=il(x(a)?a:{name:d});N(this.logger,"Adding object store: "+d);gl(this,e)}else if(this.h.bb()&&x(a)&&(a=il(a),a=jl(e,a)))throw new qd(a);var f;if(!e)throw new J('store name "'+d+'" not found.');if(v(e.keyPath)&&t(c))throw new J("key must not be provided while the store uses in-line key.");
if(!e.keyPath&&!e.h&&!t(c))throw new J("out-of-line key must be provided.");if(u(b)){N(this.logger,"addObjects: "+d+" "+b.length+" objects");for(a=0;a<b.length;a++)sl(e,b[a]);f=this.g.request("add:array",[d],fk);U(f,function(){W(this).mb(f,!1,!1,d,b,c)},this);e.ac&&f.B(function(a){a=new tl(ul,this.K(),e.getName(),a,b);this.K().Xa(a)},this)}else if(x(b))a="store: "+d+" key: "+vl(e,b,c),N(this.logger,"addObject: "+a),sl(e,b),f=this.g.request("add",[d],fk),U(f,function(){W(this).mb(f,!1,!0,d,[b],[c])},
this),e.ac&&f.B(function(a){a=new wl(ul,this.K(),e.getName(),a,b);this.K().Xa(a)},this);else throw new J("record must be an object or array list of objects, but "+b+" of type "+typeof b+" found.");return f};
function xl(a,b){var c=v(b)?b:x(b)?b.name:void 0;if(!v(c))throw new J("store name must be a string");var d=X(a.h,c);if(!d){if(!a.h.bb())throw new Jk(c);d=il(x(b)?b:{name:c});N(a.logger,"Adding object store: "+c);gl(a,d)}else if(a.h.bb()&&x(b)){var e=il(b);if(e=jl(d,e))throw new qd(e);}if(!d)throw new Jk(c);return d}h.load=function(a,b,c){var d=c||",",e=xl(this,a).getName();a=this.g.request("load",[e]);var f=this;this.g.Wb(a,function(a,c,l){W(f).df(a,c,l,e,b,d)},[e],fk);return a};
h.search=function(a){var b=yl(a);P(this.logger,"query "+a);var c=this.g.request("search",b,ek);U(c,function(){var b=W(this);zl(a,function(e,f,g,k){var l=zk(c);b.list(l,4,e,f,Hj(g),100,0,!1,!1);l.ea(function(b){var d=null;b instanceof Array||(d=b,b=[]);for(var e=0;e<b.length;e++){var f;f=b[e];var g=f.id,g=v(g)?Wj(g):g,k=g[3];(f=1==this.type&&k!=this.value?null:new Al(this,g[0],g[2],g[1],k,f.k,f.loc))&&a.j.push(f)}a.i--;b=0==a.i?!1:a.h[a.h.length-1].l===this.l?!0:null;!0===b?wd(c,a):!1===b&&c.D(Bl(a));
if(d)throw d;},k)})},this);return c};
h.put=function(a,b,c){var d,e=this;if(a instanceof Ok){var f=a,g=f.I(),k=X(this.h,g);if(!k)throw new J('store "'+g+'" not found.');if(k.keyPath){var l=vl(k,b);if(null!=l){if(0!=Oj(l,f.H()))throw new J("Inline key must be "+f+" but "+l+" found.");}else Cl(k,b,f.H());return this.put(g,b)}return this.put(g,b,f.H())}if(u(a)){if(t(c))throw new J("too many arguments");var m=a;if(!t(b))throw new J("record values required");for(var n=b,f=[],g=0,k=m.length;g<k;g++){l=m[g].I();-1==sb(f,l)&&f.push(l);var p=
X(this.h,l);if(!p)throw new J('store "'+l+'" not found.');p.keyPath&&Cl(p,n[g],m[g].H())}N(this.logger,"putByKeys: to "+Uh(f)+" "+n.length+" objects");for(g=0;g<n.length;g++)sl(p,n[g]);d=this.g.request("put:keys",f,fk);pl(p,d,arguments);U(d,function(){W(e).Wd(d,n,m)},this)}else if(v(a)||x(a)){var p=xl(this,a),q=p.getName();if(p.keyPath&&t(c))throw new J("key must not be provided while the store uses in-line key.");if(!p.keyPath&&!p.h&&!t(c))throw new J("out-of-line key must be provided.");if(u(b)){var s=
b,w=c;N(this.logger,"putObjects: "+q+" "+s.length+" objects");for(g=0;g<s.length;g++)sl(p,s[g]);d=this.g.request("put:array",[q],fk);pl(p,d,arguments);U(d,function(){W(this).mb(d,!0,!1,q,s,w)},this);p.ac&&d.B(function(a){a=new tl(Dl,this.K(),q,a,s);this.K().Xa(a)},this)}else if(x(b)){var z=b,F=c;N(this.logger,"putObject: "+q+" "+F);if(t(r.Blob)&&z instanceof Blob&&p.qc&&!p.keyPath&&0==p.indexes.length&&kc)d=new xk("put"),f=new FileReader,f.onload=function(a){var b=a.target.result,c=e.g.request("put",
[q],fk);pl(p,c,[q,z,F]);U(c,function(){W(e).mb(c,!0,!0,q,[b],[F])},this);c.w(function(a){d.D(a)},function(a){d.F(a)})},f.onerror=function(a){d.F(a)},f.onabort=function(a){d.F(a)},f.readAsDataURL(z);else{sl(p,z);d=this.g.request("put",[q],fk);var D=[q,z,F];pl(p,d,D);U(d,function(){var a=t(F)?[D[2]]:void 0;W(e).mb(d,!0,!0,q,[D[1]],a)},this)}p.ac&&d.B(function(a){a=new wl(Dl,this.K(),q,a,z);this.K().Xa(a)},this)}else throw new J("put record value must be Object or array of Objects");}else throw new J("the first argument of put must be store name, store schema or array of keys.");
return d};
function El(a,b,c,d){var e=a.Ua,f,g;if(v(b)){var k=X(a.h,b);if(k){if(!k.keyPath&&!k.h&&null==d)throw new J('key required for store "'+b+'"');}else throw new Jk(b);for(var l=0;l<c.length;l++)sl(k,c[l]);f=[b]}else{g=b;f=[];for(var l=0,m=g.length;l<m;l++){var n=g[l].I(),k=X(a.h,n);-1==sb(f,n)&&f.push(n);if(!k)throw new Jk(n);sl(k,c[l])}}var p;v(b)?(k=X(a.h,b),p=e.request("put:array",f,fk),U(p,function(){W(this).mb(p,!0,!1,b,c,d)},a)):(p=e.request("put:keys",f,fk),U(p,function(){W(this).Wd(p,c,g)},a));
return p}function Fl(a,b){for(var c=[],d=0,e=b.length;d<e;d++){var f=b[d].I();-1==sb(c,f)&&c.push(f);if(!ol(a.h,f))throw new Jk(f);}var g=a.Ua.request("rm:keys",c,fk);U(g,function(){W(this).Yd(g,b)},a);return g}function Gl(a,b,c){var d=a.Ua.request("rm:iter",[b],fk);U(d,function(){W(this).$c(d,b,c||null)},a);return d}
function Hl(a,b,c,d,e,f,g){f=f||100;var k,l=g||0;if(g=X(a.h,b)){if(c&&!rl(g,c))throw new Jk('index "'+c+'" in store "'+b+'"');}else throw new Jk(b);var m=Hj(d);v(c)?(k=a.Ua.request("values:iter:index",[b]),U(k,function(){W(this).list(k,4,b,c,m,f,l,e,!1)},a)):(k=a.Ua.request("values",[b]),U(k,function(){W(this).list(k,4,b,null,m,f,l,e,!1)},a));return k}
function Il(a,b){var c=[],d=b.length;if(0==d)return Ck("keys",[]);for(var e=0;e<d;e++){var f=b[e].I();-1==sb(c,f)&&c.push(f);if(!ol(a.h,f))throw new Jk(f);}var g=a.Ua.request("keys",c);U(g,function(){W(a).Rd(g,b)},a);return g}
function Jl(a,b,c,d,e,f,g,k){var l;e=e||100;var m=X(a.h,b);if(m){if(c&&!rl(m,c))throw new Jk('index "'+c+'" in store "'+b+'"');}else throw new Jk(b);v(c)?(l=a.Ua.request("keys:iter:index",[b]),U(l,function(){W(this).list(l,2,b,c,d,e,f,g,k)},a)):(l=a.Ua.request("keys",[b]),U(l,function(){W(this).list(l,2,b,null,d,e,f,g,k)},a));return l}
h.clear=function(a,b,c){if(t(c))throw new J("too many input arguments");var d;if(v(a)){c=X(this.h,a);if(!c)throw new J('store name "'+a+'" not found.');if(x(b)){var e=Hj(b);if(null===e)throw new J("clear method requires a valid non-null KeyRange object.");N(this.logger,"clearByKeyRange: "+a+":"+Uh(e));d=this.g.request("clear",[a],fk);pl(c,d,[a,e]);U(d,function(){W(this).ne(d,a,e)},this)}else{if(t(b))throw new J("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+
typeof b);N(this.logger,"clearByStore: "+a);d=this.g.request("clear",[a],fk);U(d,function(){W(this).sd(d,[a])},this)}}else if(!t(a)||u(a)&&v(a[0])){var f=a||ql(this.h);N(this.logger,"clearByStores: "+Uh(f));d=this.g.request("clear",f,fk);U(d,function(){W(this).sd(d,f)},this)}else throw new J('first argument "'+a+'" is invalid.');return d};
h.remove=function(a,b,c){var d;if(v(a)){var e=X(this.h,a);if(!e)throw new J('store name "'+a+'" not found.');if(t(c))if(v(b)){var f=kk(e,b);if(!f)throw new J("index: "+b+" not found in "+a);if(x(c)||null===c){var g=Hj(c);N(this.logger,"removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.g.request("rm:iter:index",[a],fk);U(d,function(){W(this).ef(d,a,f.getName(),g)},this)}else throw new J("key range "+c+' is invalid type "'+typeof c+'".');}else throw new J('index name "'+b+'" must be a string, but '+
typeof b+" found.");else if(v(b)||ha(b)||fa(b)||b instanceof Date){N(this.logger,"removeById: "+a+":"+b);d=this.g.request("rm",[a],fk);var k=[a,b];pl(e,d,k);U(d,function(){W(this).Xd(d,a,k[1])},this);e.ac&&d.B(function(b){b=new wl(Kl,this.K(),a,b,void 0);this.K().Xa(b)},this)}else if(x(b))g=Hj(b),N(this.logger,"removeByKeyRange: "+a+":"+Uh(g)),d=this.g.request("rm:iter",[a],fk),pl(e,d,[a,g]),U(d,function(){W(this).$c(d,a,g)},this),e.ac&&d.B(function(b){b=new tl(Kl,this.K(),a,b,void 0);this.K().Xa(b)},
this);else throw new J('Invalid key or key range "'+b+'" of type '+typeof b);}else if(a instanceof Ok){var l=a.I(),e=X(this.h,l);d=this.g.request("rm",[l],fk);var m=[l,a.H()];pl(e,d,m);U(d,function(){W(this).Xd(d,l,m[1])},this)}else if(u(a)){b=[];c=0;for(e=a.length;c<e;c++){if(!(a[c]instanceof Ok))throw new J("key list element at "+c+" of "+e+' must be yn.db.Key, but "'+Th(a[c])+'" ('+ea(a[c])+") is not ydn.db.Key.");var n=a[c].I();-1==sb(b,n)&&b.push(n)}if(1>b.length)throw new J('at least one valid key required in key list "'+
Th(a)+'"');d=this.g.request("rm:keys",b,fk);U(d,function(){W(this).Yd(d,a)},this)}else throw new J('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+Th(a)+'" ('+ea(a)+") found.");return d};h.toString=function(){return"DbOperator:"+this.K().getName()};function Ll(a,b,c,d){fl.call(this,a,b,c,d)}B(Ll,nl);h=Ll.prototype;h.logger=Q("ydn.db.core.DbOperator");h.get=function(a,b){if(a instanceof qk){var c=a.I(),d=X(this.h,c);if(!d)throw new J('store "'+c+'" not found.');var e=a.h;if(t(e)&&!rl(d,e))throw new J('index "'+e+'" not found in store "'+c+'".');N(this.logger,"getByIterator:"+a);var f=this.g.request("get:iter",[c]);U(f,function(){Ml(this,5,f,a,1)},this);return f}return Ll.m.get.call(this,a,b)};
h.keys=function(a,b,c,d,e,f,g){if(a instanceof qk){var k=100;if(ha(b)){if(k=b,1>k)throw new J("limit must be a positive value, but "+b);}else if(t(b))throw new J("limit must be a number,  but "+b);if(t(c))throw new J("offset must not be specified");N(this.logger,"keysByIterator:"+a);var l=this.g.request("keys:iter",[a.I()]);U(l,function(){a.p?Ml(this,1,l,a,k):Ml(this,2,l,a,k)},this);return l}return Ll.m.keys.call(this,a,b,c,d,e,f,g)};
h.count=function(a,b,c,d){if(a instanceof qk){if(t(b)||t(c))throw new J("too many arguments.");N(this.logger,"countIterator:"+a);var e=this.g.request("count",[a.I()]);U(e,function(){Ml(this,6,e,a)},this);return e}return Ll.m.count.call(this,a,b,c,d)};
h.values=function(a,b,c,d,e,f){if(a instanceof qk){var g;if(ha(b)){if(g=b,1>g)throw new J("limit must be a positive value, but "+g);}else if(t(b))throw new J("limit must be a number, but "+b);if(t(c))throw new J("offset must not be specified");N(this.logger,"listByIterator:"+a);var k=this.g.request("values:iter",[a.I()]);U(k,function(){a.g?Ml(this,2,k,a,g):Ml(this,4,k,a,g)},this);return k}return Ll.m.values.call(this,a,b,c,d,e,f)};
function Nl(a,b,c){if(!u(c))throw new J("iterators argument must be an array, but "+c+" of type "+typeof c+" found");for(var d=0;d<c.length;d++)if(!(c[d]instanceof qk))throw new J("Iterator at "+d+" must be cursor range iterator.");for(var e=[],d=0;d<c.length;d++)for(var f=c[d].stores(),g=0;g<f.length;g++)Ab(e,f[g])||e.push(f[g]);N(a.logger,a+": scan for "+c.length+" iterators on "+e);d=a.g.request("scan",e);a.g.Wb(d,function(d,e,f){function g(b){for(var c=0;c<I.length;c++)ok(I[c]);Bb(I);N(a.logger,
q+" error");f(b,!0)}function p(d,e){if(s)throw new bi;O++;var g=O===w,k=z[d],l=c[k],n=I[k],k=n.ia(),n=n.P();F[d]=e;D[d]=l.p?l.g?k:n:l.g?e:n;if(g){var p;p=b(F,D);g=[];l=[];k=[];n=[];if(u(p))for(var L=0;L<p.length;L++)!0===p[L]?k[L]=1:!1===p[L]?n[L]=!0:l[L]=p[L];else if(null===p)g=[];else if(t(p))if(x(p)){g=["advance","continue","continuePrimary","restart"];for(L in p)if(!Ab(g,L))throw new td('Unknown attribute "'+L+'" in cursor advancement object');g=p.continuePrimary||[];l=p["continue"]||[];k=p.advance||
[];n=p.restart||[]}else throw new td("scan callback output");else for(g=[],L=0;L<c.length;L++)t(z[L])&&(k[L]=1);for(L=O=p=0;L<c.length;L++)null!=g[L]||t(l[L])||null!=n[L]||null!=k[L]||O++;for(L=0;L<c.length;L++)if(null!=g[L]||t(l[L])||null!=n[L]||null!=k[L]){var dj=z[L];if(!t(dj))throw new di(L+" is not an iterator.");var dj=c[dj],ue=I[L];if(null==F[L]){var Gm=L+"/"+c.length;if(null!=k[L])throw new ei(ue+" "+Gm+" must not advance "+k[L]+" steps");if(t(l[L]))throw new ei(ue+" "+Gm+" must not continue to key "+
l[L]);if(null!=g[L])throw new ei(ue+" "+Gm+" must not continue to primary key "+g[L]);}F[L]=void 0;D[L]=void 0;if(null!=n[L])ue.restart();else if(t(l[L]))ue.Zb(l[L]);else if(null!=g[L])ue.Lc(g[L]);else if(null!=k[L])ue.advance(1);else throw new bi(dj+": has no action");p++}if(0==p){for(L=0;L<I.length;L++)ok(I[L]);s=!0;Bb(I);N(a.logger,"success "+q);f(void 0)}}}var q=e+" "+a+" scanning";P(a.logger,q);var s=!1,w,z=[],F=[],D=[],I=[],O=0;(function(){for(var b=0,f=0;f<c.length;f++){var m=c[f],q=[W(a).h(d,
e,m.I())],m=m.load(q);m.aa=g;m.C=oa(p,b);I[f]=m;z[b]=f;b++}w=c.length})()},e,ek);return d}
h.open=function(a,b,c,d){if(!(b instanceof qk))throw new J("Second argument must be cursor range iterator.");for(var e=b.stores(),f=0;f<e.length;f++)if(!X(this.h,e[f]))throw new J('Store "'+e[f]+'" not found.');c=c||ek;var g=this,k=this.g.request("open",b.stores(),c);N(this.logger,"open:"+c+" "+b);U(k,function(c){var e=V(k);N(g.logger,e+" iterating "+b);for(var f=b.stores(),p=[],q=0;q<f.length;q++)p[q]=W(g).h(c,e,f[q]);var s=b.load(p);s.aa=function(a){T(k,a,!0)};s.C=function(b){null!=b?(b=a.call(d,
s),!0===b?s.restart():x(b)?!0===b.restart?s.restart(b["continue"],b.continuePrimary):null!=b["continue"]?s.Zb(b["continue"]):null!=b.continuePrimary?s.Lc(b.continuePrimary):(ok(s),T(k,void 0)):null===b?(ok(s),T(k,void 0)):null!=b?s.Zb(b):s.advance(1)):(ok(s),T(k,void 0))}},this);return k};
h.map=function(a,b){for(var c=this,d=a.stores(),e,f=0;e=d[f];f++)if(!e)throw new J('Store "'+e+'" not found.');e=this.g.request("map",d);P(this.logger,"map:"+a);this.g.Wb(e,function(d,e,f){P(c.logger,e+" iterating "+a);for(var m=a.stores(),n=[],p=0;p<m.length;p++)n[p]=W(c).h(d,e,m[p]);var q=a.load(n);q.aa=function(a){f(a,!1)};q.C=function(c){if(null!=c){var d;a.p?a.g?d=c:d=q.ia():a.g?d=c:d=q.P();b(d);q.advance(1)}else f(void 0),b=null}},d,ek);return e};
function Ml(a,b,c,d,e){var f=[],g=c.g,k=V(c),l=k+" "+b+"ByIterator "+d;0<e&&(l+=" limit "+e);N(a.logger,l);for(var m=W(a),n=[],p=d.stores(),q=0;q<p.length;q++)n[q]=m.h(g,k,p[q]);var s=d.load(n);s.aa=function(a){ok(s);T(c,a,!0)};var w=0,z=!1;s.C=function(d){z||(P(a.logger,l+" starting"),z=!0);null!=d?(s.ia(),w++,1==b?f.push(d):2==b?f.push(s.ia()):3==b?f.push([d,s.ia()]):6!=b&&f.push(s.P()),5==b?(ok(s),T(c,f[0])):6==b||!t(e)||w<e?s.Zb():(N(a.logger,"success:"+l+" yields "+f.length+" records"),ok(s),
T(c,f))):(N(a.logger,"success:"+l+" yields "+f.length+" records"),ok(s),T(c,5==b?f[0]:6==b?w:f))}};var ul="created",Kl="deleted",Dl="updated";function Ol(a,b){H.call(this,a,b)}B(Ol,H);Ol.prototype.I=function(){return this.R};function Pl(a,b,c){H.call(this,a,b);this.version=c}B(Pl,Ol);Pl.prototype.name="ReadyEvent";Pl.prototype.version=NaN;function Ql(a,b,c){H.call(this,c||"error",a);this.error=b}B(Ql,Ol);Ql.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};Ql.prototype.name="ErrorEvent";Ql.prototype.error=null;function Rl(a,b){Ql.call(this,a,b,"fail")}B(Rl,Ql);
Rl.prototype.name="FailEvent";function wl(a,b,c,d,e){H.call(this,a,b);this.R=c;this.key=d;this.value=e}B(wl,Ol);wl.prototype.name="RecordEvent";wl.prototype.P=function(){return this.value};function tl(a,b,c,d,e){H.call(this,a,b);this.R=c;this.keys=d;this.values=e}B(tl,Ol);tl.prototype.name="StoreEvent";tl.prototype.La=function(){return this.keys};tl.prototype.Ca=function(){return this.values};function Sl(a,b,c,d,e,f){t(e)||(e=u(a)?a.join(", "):a);if(null!=a&&!v(a)&&!fa(a))throw new J("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);u(a)&&Object.freeze&&Object.freeze(a);!t(a)&&t(e)&&(a=e);this.keyPath=a;this.o=fa(this.keyPath);this.h=e;this.type=Tl(b);if(t(b)){if(!t(this.type))throw new J("type invalid in index: "+this.h);if(u(this.keyPath))throw new J('composite key for store "'+this.h+'" must not specified type');}this.unique=!!c;this.multiEntry=!!d;this.p=
v(this.type)?this.type:Ul;this.j=v(e)?e:u(a)?this.keyPath.join(","):a;this.i=Na(this.j);this.g=this.o?null:this.keyPath.split(".");this.l=f||null}function Vl(a,b){if(null!=b){if(fa(a.keyPath)){for(var c=[],d=0,e=a.keyPath.length;d<e;d++){var f=Qj(b,a.keyPath[d]);c[d]=f}return c}return Qj(b,a.keyPath)}}function Wl(a,b,c){for(var d=0;d<a.g.length;d++)d==a.g.length-1?b[a.g[d]]=c:x(b[a.g[d]])||(b[a.g[d]]={})}var Ul="TEXT";
function Pj(a,b){if("DATE"==b){if(a instanceof Date)return+a}else return null!=b?a:Tj(a)}function Xl(a,b){return"DATE"==b?new Date(a):t(b)?a:Wj(a)}var Yl=["BLOB","DATE","INTEGER","NUMERIC",Ul];function Tl(a){if(v(a))return a=sb(Yl,a),Yl[a]}h=Sl.prototype;h.getName=function(){return this.h};h.toJSON=function(){return{name:this.h,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};
h.ha=function(){var a=u(this.keyPath)?Eb(this.keyPath):this.keyPath;return new Sl(a,this.type,this.unique,this.multiEntry,this.h,this.l)};function Zl(a,b){return null!=a||null!=b?null!=a?null!=b?fa(a)&&fa(b)?Jb(a,b)?null:"expect: "+a+", but: "+b:$l(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null}
h.hint=function(a){if(!a)return this;var b=u(this.keyPath)?Eb(this.keyPath):this.keyPath,c=this.type;t(a.type)||"TEXT"!=c||(c=void 0);return new Sl(b,c,this.unique,this.multiEntry,a.h)};function am(a,b){a.l=b}h.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.g&&1<this.g.length&&(a+="Compound");return a+"Index:"+this.h};function hl(a,b,c,d,e,f,g,k){this.i=a;if(!v(this.i))throw new J("store name must be a string");this.keyPath=t(b)?b:null;this.u=fa(this.keyPath);if(null!==this.keyPath&&!v(this.keyPath)&&!this.u)throw new J("keyPath must be a string or array");this.h=c;var l;if(null!=d){l=Tl(d);if(!t(l))throw new J('type "'+d+'" for primary key in store "'+this.i+'" is invalid.');if(this.u)throw new J('composite key for store "'+this.i+'" must not specified type');}this.type=null!=l?l:this.h?"INTEGER":void 0;this.o=
v(this.keyPath)?this.keyPath.split("."):[];this.indexes=e||[];this.ac=!!f;this.qc=!!g;this.G=v(this.type)?this.type:Ul;this.l=u(this.keyPath)?this.keyPath.join(","):v(this.keyPath)?this.keyPath:"_ROWID_";this.j=Na(this.l);if(this.C=!!k){if(this.keyPath)throw new J('encrypted store "'+this.i+'" must not use inline key');if(this.h)throw new J('encrypted store "'+this.i+'" must not use key generator');}this.p=[]}h=hl.prototype;h.ac=!1;h.qc=!1;
h.toJSON=function(){for(var a=[],b=0;b<this.indexes.length;b++)a.push(this.indexes[b].toJSON());return{name:this.i,keyPath:this.keyPath,autoIncrement:this.h,type:this.type,indexes:a}};
function il(a){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==sb(b,c))throw new J('Unknown attribute "'+c+'"');b=[];c=a.indexes||[];if(u(c))for(var d=0;d<c.length;d++){var e;e=c[d];var f="name unique type keyPath multiEntry generator".split(" "),g=void 0;for(g in e)if(e.hasOwnProperty(g)&&-1==sb(f,g))throw new J("Unknown field: "+g+" in "+Uh(e));e=new Sl(e.keyPath,e.type,e.unique,e.multiEntry,e.name,e.generator);
t(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new hl(a.name,a.keyPath,a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)}function bm(a,b,c,d,e,f,g){a=cm(a,b,c,d,e,f,g);b="";0!=c&&(b+="SELECT "+a.select);b+=" FROM "+a.uc;a.ga&&(b+=" WHERE "+a.ga);a.group&&(b+=" GROUP BY "+a.group);a.Sb&&(b+=" ORDER BY "+a.Sb);return b}
function cm(a,b,c,d,e,f,g){var k={select:"",uc:"",ga:"",group:"",Sb:""},l=a.l,m=a.j,n=null;d!==l&&v(d)&&(n=kk(a,d));var p=!!n,q=d||l,s=Na(q),w=p?n.type:a.type,z=p&&n.multiEntry;k.uc=dm(a);6===c?k.select="COUNT("+m+")":3===c||1===c||2===c?(k.select=m,null!=d&&d!=l&&(k.select+=", "+s)):k.select="*";d=g?"DISTINCT ":"";l=[];z?(z=Na("ydn.db.me:"+a.getName()+":"+n.getName()),k.select=6===c?"COUNT("+d+z+"."+s+")":3===c||1===c||2===c?"DISTINCT "+dm(a)+"."+m+", "+z+"."+s+" AS "+q:"DISTINCT "+dm(a)+".*, "+
z+"."+s+" AS "+q,k.uc=z+" INNER JOIN "+dm(a)+" USING ("+m+")",null!=e&&(Nj(z+"."+s,w,e,l,b),0<l.length&&(k.ga=k.ga?k.ga+(" AND "+l.join(" AND ")):l.join(" AND ")))):null!=e&&(Nj(s,w,e,l,b),0<l.length&&(k.ga=k.ga?k.ga+(" AND "+l.join(" AND ")):l.join(" AND ")));p&&!n.unique&&g&&(k.group=s);a=f?"DESC":"ASC";k.Sb=s+" "+a;p&&(k.Sb+=", "+m+" "+a);return k}
function em(a,b,c,d,e,f,g,k,l){var m,n,p,q;null!=e?(m=e.lower,n=e.upper,p=e.lowerOpen,q=e.upperOpen,f?null!=n?(e=Oj(k,n),-1==e?(n=k,q=l):0==e&&(q=l||q)):(n=k,q=l):null!=m?(e=Oj(k,m),1==e?(m=k,p=l):0==e&&(p=l||p)):(m=k,p=l)):f?(n=k,q=l):(m=k,p=l);e=new S(m,n,!!p,!!q);d=d?kk(a,d):null;b=cm(a,c,b,d?d.j:a.l,e,f,g);b="SELECT "+b.select+" FROM "+b.uc+(b.ga?" WHERE "+b.ga:"")+(b.group?" GROUP BY "+b.group:"")+" ORDER BY "+b.Sb;d&&(b+=", "+a.j+(f?"DESC":"ASC"));return b}
function fm(a,b,c,d,e,f,g,k,l,m){var n=kk(a,d),p=n.j;d=n.i;var q=a.j,s=l?" <":" >",s=g?s+" ":s+"= ";g=Pj(f,n.type);k=Pj(k,a.type);n="";e?(a=cm(a,c,b,p,e,l,m),a.ga+=" AND ",n=d+s+"?",c.push(g)):(e=l?S.upperBound(f,!0):S.lowerBound(f,!0),a=cm(a,c,b,p,e,l,m),n=a.ga,a.ga="");a.ga+="("+n+" OR ("+d+" = ? AND "+q+s+"?))";c.push(g);c.push(k);return"SELECT "+a.select+" FROM "+a.uc+" WHERE "+a.ga+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.Sb}h.ha=function(){return il(this.toJSON())};
h.index=function(a){return this.indexes[a]||null};function kk(a,b){return yb(a.indexes,function(a){return a.getName()==b})}function jk(a,b){for(var c=0;c<a.indexes.length;c++)if(!Zl(a.indexes[c].keyPath,b))return a.indexes[c];return null}function rl(a,b){return b===a.keyPath?!0:wb(a.indexes,function(a){return a.getName()==b})}function dm(a){return Na(a.i)}
function gm(a,b){if(!b)return a;var c=a.h,d=u(a.keyPath)?Eb(a.keyPath):a.keyPath,e=a.type,f=vb(a.indexes,function(a){return a.ha()});t(b.type)||"TEXT"!=e||(e=void 0);u(b.keyPath)&&v(d)&&d==b.keyPath.join(",")&&(d=Eb(b.keyPath));for(var g=0,k=b.indexes.length;g<k;g++)if(b.indexes[g].o)for(var l=b.indexes[g].getName(),m=f.length-1;0<=m;m--)if(0<=l.indexOf(f[m].getName())){f[m]=b.indexes[g].ha();break}for(g=0;g<f.length;g++)(k=kk(b,f[g].getName()))&&(f[g]=f[g].hint(k));return new hl(b.i,d,c,e,f)}
h.getName=function(){return this.i};function hm(a){return!!a.keyPath}function vl(a,b,c){if(b){if(!a.keyPath&&null!=c)return c;if(a.u){c=[];for(var d=0;d<a.keyPath.length;d++)c.push(Qj(b,a.keyPath[d]));return c}if(a.keyPath)return Ic(b,a.o)}}function Cl(a,b,c){for(var d=0;d<a.o.length;d++){var e=a.o[d];if(d==a.o.length-1){b[e]=c;break}t(b[e])||(b[e]={});b=b[e]}}
function im(a,b,c){var d=[],e=[];c=t(c)?c:vl(a,b);t(c)&&(e.push(a.j),d.push(Pj(c,a.type)));for(var f=0;f<a.indexes.length;f++){var g=a.indexes[f];if(!g.multiEntry&&g.getName()!==a.keyPath&&"_default_"!=g.getName()){var k=Vl(g,b);null!=k&&(d.push(Pj(k,g.type)),e.push(g.i))}}a.qc?a.qc&&!a.keyPath&&0==a.indexes.length&&(v(b)&&-1==b.indexOf(";base64,")?d.push(b):d.push(Uh(b)),e.push("_default_")):(d.push(Uh(b)),e.push("_default_"));a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{If:e,lg:a,values:d,key:c}}
function jl(a,b){if(!b)return"missing store: "+a.i;if(a.i!=b.i)return"store name, expect: "+a.i+", but: "+b.i;var c=Zl(a.keyPath,b.keyPath);if(c)return"keyPath, "+c;if(t(a.h)&&t(b.h)&&a.h!=b.h)return"autoIncrement, expect:  "+a.h+", but: "+b.h;if(a.indexes.length!=b.indexes.length)return"indexes length, expect:  "+a.indexes.length+", but: "+b.indexes.length;if(t(a.type)&&t(b.type)&&(fa(a.type)?!Jb(a.type,b.type):a.type!=b.type))return"data type, expect:  "+a.type+", but: "+b.type;for(c=0;c<a.indexes.length;c++){var d=
kk(b,a.indexes[c].getName()),e;e=a.indexes[c];if(d)if(e.h!=d.h)e="name, expect: "+e.h+", but: "+d.h;else{var f=Zl(e.keyPath,d.keyPath);e=f?"keyPath, "+f:null!=e.unique&&null!=d.unique&&e.unique!=d.unique?"unique, expect: "+e.unique+", but: "+d.unique:null!=e.multiEntry&&null!=d.multiEntry&&e.multiEntry!=d.multiEntry?"multiEntry, expect: "+e.multiEntry+", but: "+d.multiEntry:t(e.type)&&t(d.type)&&(fa(e.type)?!Jb(e.type,d.type):e.type!=d.type)?"data type, expect: "+e.type+", but: "+d.type:""}else e=
"no index for "+e.h;if(0<e.length)return'index "'+a.indexes[c].getName()+'" '+e}return""}function sl(a,b){if(b)for(var c=0;c<a.indexes.length;c++){var d=a.indexes[c],e=b;if(d.l){var f=d.l(e),g=typeof f;if("string"==g||"number"==g||f instanceof Date||u(f)){for(g=0;g<d.g.length-1;g++)x(e[d.g[g]])||(e[d.g[g]]={});e[d.g[d.g.length-1]]=f}}}}function jm(a,b){a.p.push(b)}function pl(a,b,c,d,e){for(var f=0;f<a.p.length;f++)d!==f&&a.p[f].call(e,b,c)}
h.toString=function(){return"Store:"+this.i+"["+this.indexes.length+"index]"};function km(a,b,c){if(!a||ya(a))throw new J("store_name must be provided for primary full text index");if(!b||ya(b))throw new J("index_name must be provided for primary full text index");this.R=a;this.g=b;this.h=c||1}km.prototype.I=function(){return this.R};function lm(a,b,c,d){this.name=a;this.indexes=b;this.lang=c||"";if(-1==["","en","fr"].indexOf(this.lang))throw new J('Unsupported lang "'+c+" for full text search index "+a);this.h=d||null;this.g=null}lm.prototype.getName=function(){return this.name};lm.prototype.count=function(){return this.indexes.length};lm.prototype.index=function(a){return this.indexes[a]};function mm(a,b,c){return yb(a.indexes,function(a){return a.I()==b&&a.g==c})}
function nm(a){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==sb(b,c))throw new J("Unknown field: "+c+" in "+Uh(a));if(!u(a.sources))throw new J("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==sb(b,c))throw new J("Unknown field: "+c+" in "+Th(a));return new km(a.storeName,a.keyPath,a.weight)});return new lm(a.name,
b,a.lang)};function om(a,b){var c,d,e=b;if(x(a)){d=a;c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==sb(c,f))throw new J("Unknown field: "+f+" in schema.");c=d.version;var e=[],g=d.stores||[];if(!u(g))throw new J("stores must be array");for(f=0;f<g.length;f++){var k=il(g[f]);if(-1!=zb(e,function(a){return a.name==k.getName()}))throw new J('duplicate store name "'+k.getName()+'".');e.push(k)}}else v(a)?c=0==a.length?void 0:parseFloat(a):ha(a)&&(c=a);if(t(c)){if(!ha(c)||0>
c)throw new J("Invalid version: "+c+" ("+a+")");isNaN(c)&&(c=void 0)}if(t(b)&&(!u(b)||0<b.length&&!(b[0]instanceof hl)))throw new J("stores");this.version=c;this.Bc=!t(this.version);this.stores=e||[];c=[];if(d&&d.fullTextCatalogs)for(f=0;f<d.fullTextCatalogs.length;f++)e=nm(d.fullTextCatalogs[f]),c[f]=e,X(this,e.getName())||(g=[new Sl("k",Ul),new Sl("v",Ul)],e=new hl(e.getName(),"id",!1,void 0,g),this.stores.push(e));this.g=c}h=om.prototype;
h.toJSON=function(){var a=vb(this.stores,function(a){return a.toJSON()}),b={};b.stores=a;t(this.version)&&(b.version=this.version);return b};h.Bc=!1;h.bb=function(){return!1};function ql(a){return vb(a.stores,function(a){return a.getName()})}h.store=function(a){return this.stores[a]||null};h.count=function(){return this.stores.length};function X(a,b){return yb(a.stores,function(a){return a.getName()==b})}function ol(a,b){return wb(a.stores,function(a){return a.getName()==b})}
function pm(a,b,c,d){if(!b||a.stores.length!=b.stores.length)return"Number of store: "+a.stores.length+" vs "+b.stores.length;for(var e=0;e<a.stores.length;e++){var f=X(b,a.stores[e].getName());if(f){c&&(f=gm(f,a.stores[e]));if(d)for(var g=f,k=a.stores[e],l=0;l<k.indexes.length;l++){var m=k.indexes[l];rl(g,m.getName())||"BLOB"!=m.type||(m=new Sl(m.keyPath,m.type,m.unique,m.multiEntry,m.getName()),g.indexes.push(m))}f=jl(a.stores[e],f);if(0<f.length)return'store: "'+a.stores[e].getName()+'" '+f}else return'missing object store "'+
a.stores[e].getName()+'"'}return""}function qm(a,b){return yb(a.g,function(a){return a.getName()==b})};function kl(a,b){om.call(this,a,b)}B(kl,om);kl.prototype.bb=function(){return!0};function ll(a,b){a.stores.push(b)};function rm(a){return Sh(Uh(a))}function $l(a,b){var c;c=c||{};if(null!=a&&null!=b){if(fa(a)&&fa(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(-1==yb(b,function(b){return $l(b,a[d])}))return!1;return!0}if(fa(a))return 1==a.length&&$l(a[0],b);if(fa(b))return 1==b.length&&$l(b[0],a);if(x(a)&&x(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=$l(a[e],b[e]);if(!f)return!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=$l(a[e],b[e]),!f))return!1;return!0}return a===b}return!1}
function sm(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return a[b]};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function tm(a,b,c){c=c||{};var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==sb(d,e))throw new J('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!u(c.mechanisms))throw new J("mechanisms attribute must be an array but "+ea(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!Ab(um,c.mechanisms[e]))throw new J('Invalid mechanism "'+c.mechanisms[e]+'"');}this.O=c.mechanisms||um;this.G=c.size;this.T=
t(c.connectionTimeout)?c.connectionTimeout:3E4;this.i=null;this.j=[];this.Nd=!1;var f;if(b instanceof om)f=b;else if(x(b))for(c.autoSchema||!t(b.stores)?f=new kl(b):f=new om(b),c=b.stores?b.stores.length:0,e=0;e<c;e++)d=X(f,b.stores[e].name),b.stores[e].Sync&&this.Cf(d,b.stores[e].Sync);else f=new kl;this.h=f;for(e=0;e<this.h.count();e++)if(this.h.store(e).C)throw Error("encryption option must be defined");if(t(a)){if(this.i)throw new td("Already connected with "+this.u);this.u=a;ml(this)}this.p=
null;this.o=new C}tm.prototype.logger=Q("ydn.db.con.Storage");function vm(a,b,c){return(a=X(a.h,b))?rl(a,c):!1}function wm(a){var b;if(t(b)){var c=function(a){b(a.toJSON());b=void 0};a.i?a.i.jb(c):dl(a,function(b){a.i.jb(c,b)},null,ek)}return a.h?a.h.toJSON():null}tm.prototype.getName=function(){return this.u};var um="indexeddb websql localstorage sessionstorage userdata memory".split(" ");h=tm.prototype;h.pe=function(){return null};
function ml(a){function b(b,e){b?(P(a.logger,a+": ready."),a.cg=NaN,d.hd=function(b){a.Xa(new Ql(a,b))},d.fe=function(b){a.Xa(new Rl(a,b));a.i=null},d.Vd=function(b){a.Xa(b)},setTimeout(function(){xm(a,e);ym(a)},10),c.D(e)):(M(a.logger,a+": database connection fail "+e.name),setTimeout(function(){xm(a,new Rl(a,e));if(a.j){a.logger.info("Purging "+a.j.length+" transactions request.");for(var b;b=a.j.shift();)b.Za&&b.Za("error",e)}},10),c.F(e))}for(var c=new C,d=null,e=a.O,f=0;f<e.length;f++){var g=
e[f].toLowerCase();if(d=a.pe(g)){d=a.pe(g);break}}null===d?(e=new ci("No storage mechanism found."),b(!1,new Rl(a,e))):(a.init(),d.connect(a.u,a.h).w(function(){this.i=d;b(!0,new Pl("ready",this,parseFloat(d.de())))},function(a){M(this.logger,this+": opening fail");b(!1,a)},a))}function Vk(a){if(a.i)return a.i.Hc()}h.Rb=function(a,b){this.o.ea(a,b)};function xm(a,b){setTimeout(function(){b instanceof Ql?a.o.F(b.error):a.o.D();a.Xa(b)},4)}function cl(a){return!!a.i&&a.i.ee()}h.init=function(){};
h.close=function(){this.i&&(this.i.close(),this.i=null,P(this.logger,this+" closed"))};h.cg=NaN;function ym(a){var b=a.j.shift();b&&(P(a.logger,"pop tx queue["+(a.j.length+1)+"]"),dl(a,b.zd,b.scopes,b.mode,b.Za));a.cg=A()}function zm(a,b,c,d,e){P(a.logger,"push tx queue["+a.j.length+"]");a.j.push({zd:b,scopes:c,mode:d,Za:e});100<a.j.length&&0==a.j.length%100&&M(a.logger,"Transaction queue stack size is "+a.j.length+". It is too large, possibility due to incorrect usage.")}h.Nd=!1;
function dl(a,b,c,d,e){var f=c;if(v(c))f=[c];else if(null!=c)if(fa(c)){if(0==c.length)throw new J("number of store names must more than 0");for(var g=0;g<c.length;g++)if(!v(c[g]))throw new J("store name at "+g+" must be string but found "+typeof c[g]);}else throw new J("store names must be an array");else f=null;if(a.i&&a.i.ee()&&!a.Nd){var k=t(d)?d:ek;k==gk&&(a.Nd=!0);a.i.xd(function(a){b(a);b=null},f,k,function(b,c){ia(e)&&(e(b,c),e=void 0);k==gk&&(a.Nd=!1);ym(a)})}else zm(a,b,f,d,e)}
h.Cf=function(a){M(this.logger,"Synchronization option for "+a.getName()+" ignored.")};h.Bf=function(a){M(this.logger,"Full text indexer option for "+a.getName()+" ignored.")};h.Xa=function(){};h.toString=function(){return"Storage:"+this.i};function Am(a,b,c,d){this.j=a;this.l=b;this.g=Eb(c);this.h=d;this.i=[]}Am.prototype.j=null;Am.prototype.onCompleted=function(a,b){for(var c=0;c<this.i.length;c++)this.i[c](a,b);this.i.length=0;this.i=this.g=this.j=null};function Bm(a,b,c){if(a.j)c&&a.i.push(c),b(a.j);else throw new ud("tx committed on ParallelTxExecutor");}Am.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.l+" mode:"+this.h+" scopes:"+Uh(this.g)};function Cm(a,b,c,d,e,f){Sk.call(this,a,b,c,d,e,f);this.j=this.h=null}B(Cm,Sk);h=Cm.prototype;h.logger=Q("ydn.db.tr.Parallel");h.abort=function(){N(this.logger,this+": aborting");Wk(this.j)};
h.tg=function(a,b){var c;if("multi"==this.l)a:if(c=this.h,!c.g||!c.h||b!=c.h&&(c.h!=fk||b!=ek)||a.length>c.g.length)c=!1;else{for(var d=0;d<a.length;d++)if(-1==c.g.indexOf(a[d])){c=!1;break a}c=!0}else if("repeat"==this.l)a:if(c=this.h,c.g&&c.h&&b==c.h&&c.g.length==a.length){for(d=0;d<a.length;d++)if(-1==c.g.indexOf(a[d])){c=!1;break a}c=!0}else c=!1;else c="all"==this.l?!0:!1;return c};
h.Vb=function(a,b,c,d){function e(c){l.i++;m=new Am(c,l.i,b,k);g=l.Qa();zf(l.logger,g+" BEGIN "+Uh(b)+" "+k);l.h=m;Bm(l.h,a,d)}function f(a,b){zf(l.logger,g+" "+a);if(m)m.onCompleted(a,b);l.g=0}var g;this.aa&&(b=this.aa);this.V&&(c=this.V);var k=t(c)?c:ek,l=this,m;if(this.h&&this.h.j&&this.tg(b,k))Bm(this.h,a,d);else{if(this.O&&this.i>=this.O)throw new td("Exceed maximum number of transactions of "+this.O);dl(this.K(),e,b,k,f)}};
h.request=function(a,b,c,d){var e=Cm.m.request.call(this,a,b,c,d),f=this;this.Vb(function(a){f.g++;yk(e,a,f.Qa()+"R"+f.g)},b,c||ek,d);return e};h.Wb=function(a,b,c,d,e){var f=this,g;this.Vb(function(c){f.g++;g=f.Qa()+"R"+f.g;N(f.logger,g+" BEGIN");b(c,g,function(b,d){f.j=c;g=f.Qa()+"R"+f.g;d?(N(f.logger,g+" ERROR"),a.F(b)):(N(f.logger,g+" SUCCESS"),a.D(b));f.j=null});b=null;N(f.logger,g+" END")},c,d,e)};h.toString=function(){return"Parallel:"+this.l+":"+this.Qa()+(this.j?"*":"")};function Dm(a,b){Cm.call(this,a,b,Tk)}B(Dm,Cm);h=Dm.prototype;h.logger=Q("ydn.db.tr.AtomicParallel");h.tg=function(){return!1};h.request=function(a,b,c){var d,e,f,g=this,k=Dm.m.request.call(this,a,b,c,function(a,b){k.g=null;N(g.logger,"transaction "+a);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new Nk;T(k,c,!0)}});Bk(k,function(a,b,c){f=b;e=a;d=c});return k};
h.Wb=function(a,b,c,d,e){var f,g,k=new C;k.w(function(a){g=!1;f=a},function(a){g=!0;f=a});Dm.m.Wb.call(this,k,b,c,d,function(b,c){if("complete"!=b)a.F(c);else if(!0===g)a.F(f);else if(!1===g)a.D(f);else{var d=new Nk;a.F(d)}e&&(e(b,c),e=void 0)})};h.toString=function(){return"Atomic"+Dm.m.toString.call(this)};function Em(a,b,c){tm.call(this,a,b,c);this.l=0;a=!0;b=Tk;c&&(t(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=Fm(this,b,a);this.Ua=Fm(this,"atomic",!1);this.g=this.Cc(c,this.Ua)}B(Em,tm);Em.prototype.l=0;Em.prototype.Cc=function(a,b){return new fl(this,this.h,a,b)};
function Fm(a,b,c,d,e,f){if(c){if("multi"==b||"repeat"==b||"all"==b||b==Tk)return new Zk(a,a.l++,b,d,e,f);if("atomic"==b)return new el(a,a.l++);throw new J('Invalid requestType "'+b+'"');}if("multi"==b||"repeat"==b||"all"==b||b==Tk)return new Cm(a,a.l++,b,d,e,f);if("atomic"==b)return new Dm(a,a.l++);throw new J('Invalid requestType "'+b+'"');}
Em.prototype.V=function(a,b,c){if(3<arguments.length)throw new J("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.l++;var d=b||ql(this.h),e=ek;if(c)if("readwrite"==c)e=fk;else if("readonly"!=c)throw new J('Invalid transaction mode "'+c+'"');var f=Fm(this,"all",!1,d,e,1),g=this.Cc(f,this.Ua),k=new xk("run"),l=this;f.Vb(function(b){P(l.logger,"executing run in transaction on "+f);yk(k,b,f.Qa()+"R0");a(g)},d,e,function(a){k.g=null;T(k,f.i,
"complete"!==a)});return k};function Hm(a,b,c){Em.call(this,a,b,c);a=this.h;for(b=0;b<a.g.length;b++){c=a.g[b];var d=X(a,c.getName());if(d){if(!rl(d,"k"))throw new J('full text index store "'+d.getName()+'" must have "keyword" index');if(!rl(d,"v"))throw new J('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.keyPath)throw new J('full text index store "'+d.getName()+'" must use "id" as key path.');}else throw new J('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=
c.index(d),f=X(a,e.I());if(f)this.Bf(f,c);else throw new J('full text source store "'+e.I()+'" does not exist for full text index "'+c.getName()+'"');}}}B(Hm,Em);h=Hm.prototype;h.init=function(){Hm.m.init.call(this)};h.Cc=function(a,b){return new nl(this,this.h,a,b)};h.add=function(a,b,c){return this.g.add(a,b,c)};h.count=function(a,b,c,d){return this.g.count(a,b,c,d)};h.get=function(a,b){return this.g.get(a,b)};h.keys=function(a,b,c,d,e,f,g){return this.g.keys(a,b,c,d,e,f,g)};
h.values=function(a,b,c,d,e,f){return this.g.values(a,b,c,d,e,f)};h.list=function(a,b,c,d,e,f,g,k,l){return this.g.list(a,b,c,d,e,f,g,k,l)};h.load=function(a,b,c){return this.g.load(a,b,c)};h.put=function(a,b,c){return this.g.put(a,b,c)};h.clear=function(a,b,c){return this.g.clear(a,b,c)};h.remove=function(a,b,c){return this.g.remove(a,b,c)};h.toString=function(){var a="Storage:"+this.getName();cl(this)&&(a+=" ["+Vk(this)+"]");return a};function Im(a,b,c){Hm.call(this,a,b,c)}B(Im,Hm);Im.prototype.Cc=function(a,b){return new Ll(this,this.h,a,b)};Im.prototype.open=function(a,b,c,d){return this.g.open(a,b,c,d)};function Jm(a,b,c){return Nl(a.g,b,c)}Im.prototype.map=function(a,b){return this.g.map(a,b)};function Km(a,b,c,d){ik.call(this,a,b,c,d);this.l=null}B(Km,ik);h=Km.prototype;h.logger=Q("ydn.db.core.req.IDBCursor");h.wd=function(a){(a=a.target.result)?this.ob(a.key,a.primaryKey,a.value):this.ob()};
h.openCursor=function(a,b){function c(a,b,c){p.l=n;p.l.onsuccess=y(p.wd,p);p.ob(a,p.j?b:void 0,c);n=null}var d=this+" opening ";null!=a&&(d+="{"+a,d=null!=b?d+(";"+b+"}"):d+"}");P(this.logger,d);var e=this.ba,d=this.o.objectStore(this.R),f=v(this.eb)?d.index(this.eb):null;if(t(a))var g=f?!t(b):!0,k=e?e.lower:void 0,l=e?e.upper:void 0,m=e?!!e.lowerOpen:!1,e=e?!!e.upperOpen:!1,e=Gj(this.reverse?new S(k,a,m,g):new S(a,l,g,e));var n;this.Yc?f?n=null!=this.sb?f.openKeyCursor(e,this.sb):null!=e?f.openKeyCursor(e):
f.openKeyCursor():n=null!=this.sb?d.openCursor(e,this.sb):null!=e?d.openCursor(e):d.openCursor():f?n=null!=this.sb?f.openCursor(e,this.sb):null!=e?f.openCursor(e):f.openCursor():n=null!=this.sb?d.openCursor(e,this.sb):null!=e?d.openCursor(e):d.openCursor();var p=this;n.onerror=function(a){var b=n.error;a.preventDefault();lk(p,b)};null!=a?n.onsuccess=function(d){if(d=d.target.result){var e=hk.cmp(d.key,a),f=p.reverse?-1:1;if(e==f)c(d.key,d.primaryKey,d.value);else if(e==-f)d["continue"](a);else if(null!=
b)if(hk.cmp(d.primaryKey,b)==f)c(d.key,d.primaryKey,d.value);else d["continue"]();else d["continue"]()}else c()}:(p.l=n,p.l.onsuccess=y(p.wd,p))};h.Md=function(){return!!this.l};h.update=function(a){var b=this.l.result;if(b){var c=new C;a=b.update(a);a.onsuccess=function(a){c.D(a.target.result)};a.onerror=function(a){a.preventDefault();c.F(a)};return c}throw new Ik("cursor gone");};
h.clear=function(){var a=this.l.result;if(a){var b=new C,a=a["delete"]();a.onsuccess=function(){b.D(1)};a.onerror=function(a){a.preventDefault();b.F(a)};return b}throw new Ik("cursor gone");};h.advance=function(a){var b=this.l.result;if(1==a)b["continue"]();else b.advance(a)};
h.Lc=function(a){var b=this.l.result,c=hk.cmp(a,b.primaryKey);if(c!=(this.reverse?-1:1))throw new ud('continuing primary key "'+a+'" must '+(this.reverse?"lower":"higher")+' than current primary key "'+b.primaryKey+'"');var d=this;this.l.onsuccess=function(e){if(b=e.target.result)if(c=hk.cmp(b.primaryKey,a),0==c||1==c&&!d.reverse||-1==c&&d.reverse)d.l.onsuccess=y(d.wd,d),d.ob(b.key,d.j?b.primaryKey:void 0,b.value);else b["continue"]();else d.l.onsuccess=y(d.wd,d),d.ob()};b["continue"]()};
h.Zb=function(a){var b=this.l.result;if(null!=a)b["continue"](a);else b["continue"]()};h.J=function(){Km.m.J.call(this);this.l=null};h.toString=function(){return"IDB"+Km.m.toString.call(this)};function Lm(a,b,c,d,e,f){C.call(this,e,f);this.p=a;this.g=[];this.G=!!b;this.Xb=!!c;this.Va=!!d;for(b=this.wa=0;b<a.length;b++)a[b].w(y(this.O,this,b,!0),y(this.O,this,b,!1));0!=a.length||this.G||this.D(this.g)}B(Lm,C);Lm.prototype.O=function(a,b,c){this.wa++;this.g[a]=[b,c];this.h||(this.G&&b?this.D([a,c]):this.Xb&&!b?this.F(c):this.wa==this.p.length&&this.D(this.g));this.Va&&!b&&(c=null);return c};Lm.prototype.F=function(a){Lm.m.F.call(this,a);for(a=0;a<this.p.length;a++)Ob(this.p[a])};
function Mm(a){return(new Lm(a,!1,!0)).B(function(a){for(var c=[],d=0;d<a.length;d++)c[d]=a[d][1];return c})};function Nm(a,b){this.g=b}B(Nm,Rk);h=Nm.prototype;h.logger=Q("ydn.db.crud.req.IndexedDb");h.ud=function(a,b){function c(e){var f=a.g.objectStore(b[e]).count();f.onsuccess=function(f){d[e]=f.target.result;e++;e==b.length?T(a,d):c(e)};f.onerror=function(b){b.preventDefault();T(a,f.error,!0)}}var d=[];0==b.length?T(a,[]):c(0)};
h.mb=function(a,b,c,d,e,f){function g(s){if(null==e[s])if(P(n.logger,"empty object at "+s+" of "+e.length),l++,l==e.length)T(a,k,m);else{var z=s+10;z<e.length&&g(z)}var F,z=e[s];F=null!=f?b?q.put(z,f[s]):q.add(z,f[s]):b?q.put(z):q.add(z);F.onsuccess=function(b){l++;k[s]=b.target.result;l==e.length?T(a,c?k[0]:k,m):(b=s+10,b<e.length&&g(b))};F.onerror=function(b){l++;var f=F.error;P(n.logger,V(a)+p+' request to "'+d+'" cause '+f.name+' for object "'+Th(e[s])+'" at index '+s+" of "+e.length+" objects.");
k[s]=f;m=!0;b.preventDefault();l==e.length?T(a,c?k[0]:k,m):(b=s+10,b<e.length&&g(b))}}var k=[],l=0,m=!1,n=this,p=b?"put":"add",q=a.g.objectStore(d);P(this.logger,V(a)+" "+p+" "+e.length+' objects to store "'+d+'"');if(0<e.length)for(var s=0;10>s&&s<e.length;s++)g(s);else T(a,[])};
h.Wd=function(a,b,c){function d(l){var n=c[l],p=n.I(),q=a.g.objectStore(p),s;s=null===q.keyPath?q.put(b[l],n.H()):q.put(b[l]);s.onsuccess=function(c){f++;e[l]=c.target.result;f==b.length?T(a,e,g):(c=l+10,c<b.length&&d(c))};s.onerror=function(c){f++;M(k.logger,"request result "+c.name+' error when put keys to "'+p+'" for object "'+Th(b[l])+'" at index '+l+" of "+b.length+" objects.");e[l]=s.error;g=!0;c.preventDefault();f==b.length?T(a,e,g):(c=l+10,c<b.length&&d(c))}}var e=[],f=0,g=!1,k=this;P(this.logger,
V(a)+" putByKeys: of "+b.length+" objects");if(0<b.length)for(var l=0;10>l&&l<b.length;l++)d(l);else T(a,e,g)};
h.df=function(a,b,c,d,e,f){function g(){var a={},b=e.indexOf("\n",n),d=!1,s;-1==b?(d=!0,s=e.substring(n)):(s=e.substring(n,b),n=b+1);for(var b=s.split(f),I=0;I<p.length;I++){var O=b[I];q[I]&&(q[I]==Ul?O=Ka(O,'"'):"INTEGER"==q[I]?O=parseInt(O,10):"NUMERIC"==q[I]&&(O=parseFloat(O)));a[p[I]]=O}var sa=l.put(a);sa.onsuccess=function(a){m.push(a.target.result);d?c(m):g()};sa.onerror=function(a){"DataError"==a.name&&(a=new Fk(k+": "+s.substring(0,70)));a.preventDefault();c(sa.error,!0)}}var k=X(this.g,d),
l=a.objectStore(d),m=[],n=e.indexOf("\n"),p=e.substr(0,n).split(f),q=[];for(a=0;a<p.length;a++){var s=kk(k,p[a]);s?q[a]=s.type:p[a]==k.keyPath&&(q[a]=k.type)}n++;P(this.logger,b+" Loading data  of "+p.length+"-fields record to "+d);g()};
h.Xd=function(a,b,c){var d=a.g.objectStore(b);P(this.logger,V(a)+" clearById: "+b+" "+c);var e=d.openCursor(Kj.only(c));e.onsuccess=function(b){if(b=b.target.result){var c=b["delete"]();c.onsuccess=function(){T(a,1)};c.onerror=function(){T(a,c.error,!0)}}else T(a,0)};e.onerror=function(b){b.preventDefault();T(a,e.error,!0)}};
h.Yd=function(a,b){function c(k){k++;if(k>=b.length)0<g.length?T(a,g,!0):T(a,d);else{b[k].I()!=e&&(e=b[k].I(),f=a.g.objectStore(e));var l=f["delete"](b[k].H());l.onsuccess=function(){d++;c(k)};l.onerror=function(a){a.preventDefault();g[k]=l.error;c(k)}}}var d=0,e,f;P(this.logger,V(a)+" removeByKeys: "+b.length+" keys");var g=[];c(-1)};
h.$c=function(a,b,c){var d=a.g.objectStore(b),e=d.count(c);P(this.logger,V(a)+" clearByKeyRange: "+b+" "+c);e.onsuccess=function(b){var e=b.target.result,k=d["delete"](c);k.onsuccess=function(){T(a,e)};k.onerror=function(){T(a,k.error,!0)}};e.onerror=function(b){b.preventDefault();T(a,e.error,!0)}};h.ne=function(a,b,c){var d=a.g.objectStore(b);P(this.logger,V(a)+" "+b+" "+c);var e=d["delete"](c);e.onsuccess=function(){T(a,void 0)};e.onerror=function(b){b.preventDefault();T(a,e.error,!0)}};
h.ef=function(a,b,c,d){var e=a.g.objectStore(b).index(c);P(this.logger,V(a)+" clearByIndexKeyRange: "+b+":"+c+" "+d);var f=[],g=e.openCursor(d),k=0;g.onsuccess=function(b){var c=b.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){k++;c["continue"]()};d.onerror=function(a){f.push(d.error);a.preventDefault();c["continue"]()}}else 0<f.length?T(a,f,!0):T(a,k)};g.onerror=function(b){b.preventDefault();T(a,g.error,!0)}};
h.sd=function(a,b){var c=b.length,d=0;P(this.logger,V(a)+" clearByStores: "+b);for(var e=0;e<c;e++){var f=a.g.objectStore(b[e]).clear();f.onsuccess=function(){d++;d==c&&T(a,d)};f.onerror=function(b){d++;b.preventDefault();d==c&&T(a,f.error,!0)}}};
h.Ad=function(a,b,c){var d=this;P(this.logger,V(a)+b+":"+c);var e=a.g.objectStore(b),f=e.get(c);f.onsuccess=function(b){P(d.logger,V(a)+" record "+c+(null!=b.target.result?" ":" not ")+" exists.");var f=b.target.result;if(!e.keyPath&&0==e.indexNames.length&&kc&&v(f)&&0<=f.indexOf(";base64,")){'"'==f.charAt(0)&&'"'==f.charAt(f.length-1)&&(f=f.substr(1,f.length-2));f=f.split(";base64,");b=f[0].split(":")[1];for(var f=window.atob(f[1]),l=f.length,m=new Uint8Array(l),n=0;n<l;++n)m[n]=f.charCodeAt(n);
T(a,new Blob([m.buffer],{type:b}))}else T(a,b.target.result)};f.onerror=function(b){b.preventDefault();T(a,f.error,!0)}};
h.Xe=function(a,b,c){function d(b){if(null==c[b])if(f++,e[b]=void 0,f==k)T(a,e);else{var m=b+10;m<k&&d(m)}var n;n=g.get(c[b]);n.onsuccess=function(c){f++;e[b]=c.target.result;f==k?T(a,e):(c=b+10,c<k&&d(c))};n.onerror=function(b){f++;b.preventDefault();T(a,n.error,!0)}}var e=[];e.length=c.length;var f=0,g=a.g.objectStore(b),k=c.length;P(this.logger,V(a)+" "+b+":"+k+" ids");if(0<k)for(b=0;10>b&&b<k;b++)d(b);else T(a,[])};
h.Rd=function(a,b){function c(f){var k=b[f],l=a.g.objectStore(k.I()).get(k.H());l.onsuccess=function(k){e++;d[f]=k.target.result;e==b.length?T(a,d):(k=f+10,k<b.length&&c(k))};l.onerror=function(b){e++;b.preventDefault();T(a,l.error,!0)}}var d=[];d.length=b.length;var e=0;P(this.logger,V(a)+" "+b.length+" ids");if(0<b.length)for(var f=0;10>f&&f<b.length;f++)c(f);else T(a,[])};
h.Mc=function(a,b,c,d,e){if(d&&e)throw new td("unique count not available in IndexedDB");e=a.g.objectStore(b);b=V(a)+" "+b+(d?":"+d:"")+(c?":"+Uh(c):"");P(this.logger,b);var f;null!=d?(d=e.index(d),f=null!=c?d.count(c):d.count()):f=null!=c?e.count(c):e.count();f.onsuccess=function(b){T(a,b.target.result)};f.onerror=function(b){b.preventDefault();T(a,f.error,!0)}};
h.list=function(a,b,c,d,e,f,g,k,l,m){var n=[],p=a.g.objectStore(c),q=k?l?"prevunique":"prev":l?"nextunique":"next";c=V(a)+" "+b+" "+c+(d?":"+d:"")+(e?Uh(e):"");k&&(c+=" reverse");l&&(c+=" unique");if(m&&t(m[0])){l=d?!t(m[1]):!0;var s=m[0],w=e?e.lower:void 0,z=e?e.upper:void 0,F=e?!!e.lowerOpen:!1;e=e?!!e.upperOpen:!1;e=Gj(k?new S(w,s,F,l):new S(s,z,l,e));c+=" starting from "+Uh(m[0]);t(m[1])&&(c+=", "+Uh(m[1]))}P(this.logger,c);var D;D=1==b||2==b||3==b?d?p.index(d).openKeyCursor(e,q):p.openCursor(e,
q):d?p.index(d).openCursor(e,q):p.openCursor(e,q);var I=!1;D.onsuccess=function(c){if(c=c.target.result){if(!I){if(0<g){I=!0;c.advance(g);return}if(m&&d&&t(m[0]))if(t(m[1])){var e=hk.cmp(c.key,m[0]),l=k?-1:1;if(0==e){e=hk.cmp(c.primaryKey,m[1]);if(0==e){I=!0;c["continue"]();return}if(e==l)I=!0;else{c["continue"]();return}}else I=!0}else I=!0;else I=!0}1==b?n.push(c.key):2==b?n.push(c.primaryKey):3==b?(l={},d&&(l[d]=c.key),p.keyPath?l[p.keyPath]=c.primaryKey:l._ROWID_=c.primaryKey,n.push(l)):4==b?
n.push(c.value):n.push([c.key,c.primaryKey,c.value]);if(n.length<f)c["continue"]();else m&&(m[0]=nk(c.key),m[1]=nk(c.primaryKey)),T(a,n)}else m&&(m[0]=void 0,m[1]=void 0),T(a,n)};D.onerror=function(b){b.preventDefault();T(a,D.error,!0)}};function Om(a,b){this.g=b}B(Om,Nm);Om.prototype.logger=Q("ydn.db.core.req.IndexedDb");Om.prototype.h=function(a,b,c,d){c=X(this.g,c);return new Km(a,b,c,d)};function Pm(){this.g=!1}Pm.prototype.g=!1;function Qm(a,b,c,d){ik.call(this,a,b,c,d);this.u=this.i=this.g=void 0;this.p=this.l=null;this.G=new Pm;this.$d=this.Yb=null}B(Qm,ik);h=Qm.prototype;h.logger=Q("ydn.db.core.req.SimpleCursor");h.Md=function(){return!!this.o};h.update=function(a){Rm(this.$d,this.ia(),a);return $b()};h.advance=function(a){function b(b){d++;if(!b||d>=a)return Sm(c,b)}var c=this,d=this.l?-1:0;this.reverse?Tm(this.Yb,b,this.l):Um(this.Yb,b,this.l)};
h.Zb=function(a){if(null!=a){var b=this,c=new Vm(a),d=function(c){b.l=c;if(!c)return Sm(b,c);var d=Oj(c.value.key,a);if(b.reverse){if(1!=d)return Sm(b,c)}else if(-1!=d)return Sm(b,c)};this.reverse?Tm(this.Yb,d,c):Um(this.Yb,d,c)}else this.advance(1)};function Wm(a){setTimeout(function(){a.G.g?(a.G.g=!1,a.ob(a.g,a.i,a.u),Wm(a)):(a.p(),a.p=null)},4)}
function Sm(a,b){if(a.l=b){var c=b.value;if(a.ba)if(a.reverse||null==a.ba.upper)a.reverse&&null!=a.ba.lower&&(d=Oj(c.key,a.ba.lower),-1==d||0==d&&a.ba.lowerOpen)&&(a.l=null);else{var d=Oj(c.key,a.ba.upper);if(1==d||0==d&&a.ba.upperOpen)a.l=null}if(a.l){if(a.unique&&null!=a.g&&null!=c.key&&0==Oj(a.g,c.key))return;a.g=c.key;a.i=a.j?c.ia():a.g;4==a.V&&(a.Yc?a.u=a.i:a.u=Xm(a.$d,a.i))}}a.l||(a.g=void 0,a.i=void 0,a.u=void 0);return a.G.g=!0}
h.openCursor=function(a,b){var c=null;if(this.ba)if(this.reverse){var d=this.j?"\uffff":void 0;null!=this.ba.upper&&(c=new Vm(this.ba.upper,d))}else null!=this.ba.lower&&(c=new Vm(this.ba.lower));null!=a&&(c=this.j?new Vm(a,b):new Vm(a));this.p=this.o.K(function(b){function d(b){var e=b.value,f=e.key;if(b&&null!=f)if(null!=a){if(0==Ym(c,e))return}else if(this.ba&&(!this.reverse&&this.ba.lowerOpen&&null!=this.ba.lower&&(e=Oj(f,this.ba.lower),0==e)||this.reverse&&this.ba.upperOpen&&null!=this.ba.upper&&
(e=Oj(f,this.ba.upper),0==e)))return;return Sm(this,b)}this.$d=Zm(b,this.R);this.Yb=$m(this.$d,this.eb);this.reverse?Tm(this.Yb,y(d,this),c):Um(this.Yb,y(d,this),c);Wm(this)},this)};h.clear=function(){throw new sd;};h.Lc=function(){throw new sd;};h.toString=function(){return"Simple"+Qm.m.toString.call(this)};function an(a,b,c){a=["ydn.db",a];t(b)&&(a.push(b),t(c)&&(a.push(c),t(void 0)&&a.push(Tj(void 0))));return a.join("^|")};function Vm(a,b){this.key=a;this.g=b}Vm.prototype.ia=function(){return this.g};Vm.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(null!=this.g?", "+this.g+")":")")};function Ym(a,b){var c=Oj(a.key,b.key);return 0===c?null!=a.g?null!=b.g?Oj(a.g,b.g):1:null!=b.g?-1:0:c};function bn(a){this.Wa=a||cn}function cn(a,b){return String(a)<String(b)?-1:String(a)>String(b)?1:0}h=bn.prototype;h.Da=null;h.Wa=null;h.Ib=null;h.Gb=null;
h.add=function(a){if(null==this.Da)return this.Gb=this.Ib=this.Da=new dn(a),!0;var b=null;en(this,function(c){var d=null;0<this.Wa(c.value,a)?(d=c.left,null==c.left&&(b=new dn(a,c),c.left=b,c==this.Ib&&(this.Ib=b))):0>this.Wa(c.value,a)&&(d=c.right,null==c.right&&(b=new dn(a,c),c.right=b,c==this.Gb&&(this.Gb=b)));return d});b&&(en(this,function(a){a.count++;return a.parent},b.parent),fn(this,b.parent));return!!b};
h.remove=function(a){var b=null;en(this,function(c){var d=null;0<this.Wa(c.value,a)?d=c.left:0>this.Wa(c.value,a)?d=c.right:(b=c.value,gn(this,c));return d});return b};h.clear=function(){this.Gb=this.Ib=this.Da=null};h.contains=function(a){var b=!1;en(this,function(c){var d=null;0<this.Wa(c.value,a)?d=c.left:0>this.Wa(c.value,a)?d=c.right:b=!0;return d});return b};h.fa=function(){return this.Da?this.Da.count:0};h.Ca=function(){var a=[];hn(this,function(b){a.push(b)});return a};
function hn(a,b){if(a.Da){var c,d=c=jn(a);for(c=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=c&&d.right!=c)d=d.left;else{if(d.right!=c&&b(d.value))break;var e=d,d=null!=d.right&&d.right!=c?d.right:d.parent;c=e}}}function en(a,b,c){for(c=c?c:a.Da;c&&null!=c;)c=b.call(a,c)}
function fn(a,b){en(a,function(a){var b=a.left?a.left.height:0,e=a.right?a.right.height:0;1<b-e?(a.left.right&&(!a.left.left||a.left.left.height<a.left.right.height)&&kn(this,a.left),ln(this,a)):1<e-b&&(a.right.left&&(!a.right.right||a.right.right.height<a.right.left.height)&&ln(this,a.right),kn(this,a));b=a.left?a.left.height:0;e=a.right?a.right.height:0;a.height=Math.max(b,e)+1;return a.parent},b)}
function kn(a,b){mn(b)?(b.parent.left=b.right,b.right.parent=b.parent):nn(b)?(b.parent.right=b.right,b.right.parent=b.parent):(a.Da=b.right,a.Da.parent=null);var c=b.right;b.right=b.right.left;null!=b.right&&(b.right.parent=b);c.left=b;b.parent=c;c.count=b.count;b.count-=(c.right?c.right.count:0)+1}
function ln(a,b){mn(b)?(b.parent.left=b.left,b.left.parent=b.parent):nn(b)?(b.parent.right=b.left,b.left.parent=b.parent):(a.Da=b.left,a.Da.parent=null);var c=b.left;b.left=b.left.right;null!=b.left&&(b.left.parent=b);c.right=b;b.parent=c;c.count=b.count;b.count-=(c.left?c.left.count:0)+1}
function gn(a,b){if(null!=b.left||null!=b.right){var c=null,d;if(null!=b.left){d=on(a,b.left);en(a,function(a){a.count--;return a.parent},d);if(d!=b.left){if(d.parent.right=d.left)d.left.parent=d.parent;d.left=b.left;d.left.parent=d;c=d.parent}d.parent=b.parent;d.right=b.right;d.right&&(d.right.parent=d);b==a.Gb&&(a.Gb=d)}else{d=jn(a,b.right);en(a,function(a){a.count--;return a.parent},d);if(d!=b.right){if(d.parent.left=d.right)d.right.parent=d.parent;d.right=b.right;d.right.parent=d;c=d.parent}d.parent=
b.parent;d.left=b.left;d.left&&(d.left.parent=d);b==a.Ib&&(a.Ib=d)}d.count=b.count;mn(b)?b.parent.left=d:nn(b)?b.parent.right=d:a.Da=d;fn(a,c?c:d)}else en(a,function(a){a.count--;return a.parent},b.parent),mn(b)?(b.parent.left=null,b==a.Ib&&(a.Ib=b.parent),fn(a,b.parent)):nn(b)?(b.parent.right=null,b==a.Gb&&(a.Gb=b.parent),fn(a,b.parent)):a.clear()}function jn(a,b){if(!b)return a.Ib;var c=b;en(a,function(a){var b=null;a.left&&(b=c=a.left);return b},b);return c}
function on(a,b){if(!b)return a.Gb;var c=b;en(a,function(a){var b=null;a.right&&(b=c=a.right);return b},b);return c}function dn(a,b){this.value=a;this.parent=b?b:null;this.count=1}dn.prototype.left=null;dn.prototype.right=null;dn.prototype.height=1;function nn(a){return!!a.parent&&a.parent.right==a}function mn(a){return!!a.parent&&a.parent.left==a};function pn(a){this.Wa=a||cn}B(pn,bn);function Um(a,b,c){if(a.Da){var d;if(c instanceof dn)d=c;else if(c){if(en(a,function(a){var b=null;0<this.Wa(a.value,c)?(b=a.left,d=a):0>this.Wa(a.value,c)?b=a.right:d=a;return b}),!d)return}else d=jn(a);a=d;for(var e=d.left?d.left:d;null!=a;)if(null!=a.left&&a.left!=e&&a.right!=e)a=a.left;else{if(a.right!=e&&b(a))return;var f=a;a=null!=a.right&&a.right!=e?a.right:a.parent;e=f}b(null)}}
function Tm(a,b,c){if(a.Da){var d;if(c instanceof dn)d=c;else if(c){if(en(a,y(function(a){var b=null;0<this.Wa(a.value,c)?b=a.left:(0>this.Wa(a.value,c)&&(b=a.right),d=a);return b},a)),!d)return}else d=on(a);a=d;for(var e=d.right?d.right:d;null!=a;)if(null!=a.right&&a.right!=e&&a.left!=e)a=a.right;else{if(a.left!=e&&b(a))return;var f=a;a=null!=a.left&&a.left!=e?a.left:a.parent;e=f}b(null)}};function qn(a,b,c){this.l=a;this.storage=b;this.h=c;this.g={};a=this.h.keyPath;this.i=u(a)?a.join(","):a||"_ROWID_";this.g[this.i]=null;this.j=an(this.l,this.h.getName(),this.i)+"^|"}
function $m(a,b){var c=b||a.i;if(!a.g[c]){a.g[c]=new pn(Ym);for(var d=a.storage.length,e=0;e<d;e++){var f=a.storage.key(e);if(null!==f&&va(f,a.j)){var g=Wj(f.substr(a.j.length));if(c==a.i)a.g[c].add(new Vm(g));else{var k=a.storage.getItem(f);if(null!==k)if(f=kk(a.h,c),k=Sh(k),k=Vl(f,k),f.multiEntry){if(u(k))for(f=0;f<k.length;f++)a.g[c].add(new Vm(k[f],g))}else a.g[c].add(new Vm(k,g))}}}}return a.g[c]}
function rn(a,b,c){for(var d in a.g){var e=a.g[d];if(e)if(d==a.i)e.remove(new Vm(b));else{var f=kk(a.h,d),f=Qj(c,f.keyPath);e.remove(new Vm(b,f))}}}function sn(a){for(var b in a.g){var c=a.g[b];c&&c.clear()}a.g={}}
function Rm(a,b,c,d){if(null==b&&(a.h.keyPath&&(b=vl(a.h,c)),a.h.h&&null==b)){b=a.j+Tj(void 0);var e=Sh(a.storage.getItem(b));e.key_count||(e.key_count=0);e.key_count++;a.storage.setItem(b,Uh(e));b=e.key_count}d&&(d=null!==a.storage.getItem(a.j+Tj(b)));if(d)return null;a.storage.setItem(a.j+Tj(b),Uh(c));d=b;for(var f in a.g)if(e=a.g[f])if(f==a.i)e.add(new Vm(d));else{var g=kk(a.h,f),g=Qj(c,g.keyPath);null!=g&&e.add(new Vm(d,g))}return b}
function tn(a,b){var c=a.j+Tj(b),d=a.storage.getItem(c);if(null===d)return 0;a.storage.removeItem(c);c=Sh(d);rn(a,b,c);return 1}h=qn.prototype;h.clear=function(){sn(this);un(this)};function Xm(a,b){var c=a.storage.getItem(a.j+Tj(b)),d=void 0;if(null!==c)for(var d=Sh(c),c=0,e=a.h.indexes.length;c<e;c++){var f=a.h.index(c);if("DATE"==f.type){var g=Vl(f,d);g&&Wl(f,d,new Date(g))}}return d}h.getName=function(){return this.h.getName()};
function vn(a,b,c){b=b||a.i;a=$m(a,b);var d=null,e=null,f=0,g=!1,k=!1;null!=c&&(null!=c.lower&&(d=new Vm(c.lower)),null!=c.upper&&(e=new Vm(c.upper)),g=c.lowerOpen,k=c.upperOpen);Um(a,function(a){if(null!=a&&(a=a.value,!g||null==d||0!=Oj(a.key,d.key))){if(null!=e&&(a=Oj(a.key,e.key),1===a||0===a&&k))return!0;f++}},d);return f}
function un(a,b){var c=$m(a,a.i),d=null,e=null,f=0,g=[],k=[],l=!1,m=!1;null!=b&&(null!=b.lower&&(d=new Vm(b.lower)),null!=b.upper&&(e=new Vm(b.upper)),l=b.lowerOpen,m=b.upperOpen);Um(c,function(b){if(null!=b&&(b=b.value,!l||null==d||0!=Ym(b,d))){if(null!=e){var c=Ym(b,e);if(1===c||0===c&&m)return!0}var c=a.j+Tj(b.key),q=a.storage.getItem(c);null!==q&&(a.storage.removeItem(c),f++,10>g.length&&(g.push(b.key),k.push(Sh(q))))}},d);if(10>g.length)for(c=0;c<g.length;c++)rn(a,g[c],k[c]);else sn(a);return f}
h.wc=function(a,b,c,d,e,f,g,k){function l(b){if(b&&(z++,!(z<f))){var c=b.value;if(d){if(D&&null!=w&&(b=p?Ym(c,w):Oj(c.key,w.key),0==b))return;if(null!=s&&(b=p?Ym(c,s):Oj(c.key,s.key),-1==b||0==b&&F))return k&&(k[0]=void 0,k[1]=void 0),!0}else{if(F&&null!=s&&(b=p?Ym(c,s):Oj(c.key,s.key),0==b))return;if(null!=w&&(b=p?Ym(c,w):Oj(c.key,w.key),1==b||0==b&&D))return k&&(k[0]=void 0,k[1]=void 0),!0}b=c.key;if(!g||!q||null==n||0!=Oj(n,b)){c=q?c.ia():b;if(2==a)m.push(c);else if(1==a)m.push(b);else if(3==a)m.push([b,
c]);else if(4==a){var l=Xm(O,c);m.push(l)}else m.push([b,c,Xm(O,c)]);k&&(k[0]=b,k[1]=c)}n=b;if(t(e)&&m.length>=e)return!0}}var m=[],n,p=!!k&&null!=k[0];b=b||this.i;var q=b!=this.i;b=$m(this,b);var s=null,w=null;t(f)||(f=0);var z=-1,F=!1,D=!1;null!=c&&(null!=c.lower&&(s=q&&d?new Vm(c.lower,"\uffff"):new Vm(c.lower)),null!=c.upper&&(w=q&&!d?new Vm(c.upper,"\uffff"):new Vm(c.upper)),F=!!c.lowerOpen,D=!!c.upperOpen);if(p){d?D=!0:F=!0;c=k[0];var I=t(k[1])?k[1]:"\uffff";d?w=q?new Vm(c,I):new Vm(c):s=q?
new Vm(c,I):new Vm(c)}var O=this;d?Tm(b,l,w):Um(b,l,s);return m};h.La=function(a,b,c,d,e){return this.wc(2,a,b,c,d,e)};h.toString=function(){return"ydn.db.con.simple.Store:"+this.l+":"+this.h.getName()};function wn(){this.clear()}h=wn.prototype;h.oe=function(){return this};h.setItem=function(a,b){t(this.g[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.g[a]=b};h.getItem=function(a){return t(this.g[a])?this.g[a]:null};h.removeItem=function(a){delete this.g[a];Cb(this.keys,a.toString());this.length=this.keys.length};h.length=0;h.key=function(a){a=this.keys[a];return t(a)?this.g[a]:null};h.clear=function(){this.g={};this.keys=[];this.length=0};function xn(a){this.o=a||new wn;this.l={}}function Zm(a,b){var c=X(a.g,b);if(c)a.l[b]||(a.l[b]=new qn(a.i,a.j,c));else throw new ud('store name "'+b+'" not found.');return a.l[b]}xn.prototype.jb=function(a){var b=this;setTimeout(function(){var c=an(b.i),c=b.j.getItem(c),c=new om(c);a(c)},10)};function yn(a,b){this.h=a;this.g=b}yn.prototype.K=function(a,b){var c=this.h;setTimeout(function(){a.call(b,c)},4);var d=this;return function(){d.g("complete",null);d.g=null;d.h=null}};function zn(a,b){this.g=b}B(zn,Rk);h=zn.prototype;h.logger=Q("ydn.db.crud.req.SimpleStore");h.Wd=function(a,b,c){this.mb(a,!0,!1,null,b,c)};
h.mb=function(a,b,c,d,e,f){P(this.logger,V(a)+" "+(b?"put":"add")+"Object"+(c?"":"s "+e.length+" objects"));var g=a.g.K(function(k){var l;if(c)l=Zm(k,d),k=f?f[0]:void 0,k=Rm(l,k,e[0],!b),null!=k?T(a,k):(l=Th(k),l=new Ek(l),T(a,l,!0));else{for(var m=d,n=[],p=!1,q=f||{},s=0;s<e.length;s++){var w;d?w=q[s]:(m=f[s],w=m.H(),m=m.I());l&&l.getName()==m||(l=Zm(k,m));w=Rm(l,w,e[s],!b);null!=w?n.push(w):(p=!0,n.push(new Ek))}T(a,n,p)}g();g=null},this)};h.df=function(){throw new sd("putData");};
h.Ad=function(a,b,c){var d=a.g.K(function(e){e=Xm(Zm(e,b),c);T(a,e);d();d=null},this)};function An(a,b,c,d){var e=b.g.K(function(a){for(var g=[],k=c,l,m=0;m<d.length;m++){var n=d[m];n instanceof Ok&&(k=n,n=k.H(),k=k.I());l&&l.getName()==k||(l=Zm(a,k));n=Xm(l,n);g[m]=n}T(b,g,!1);e();e=null},a)}h.Xe=function(a,b,c){An(this,a,b,c)};h.Rd=function(a,b){An(this,a,null,b)};
h.Xd=function(a,b,c){var d=V(a)+" removeById "+b+" "+c;P(this.logger,d);var e=this,f=a.g.K(function(g){g=tn(Zm(g,b),c);N(e.logger,"success "+d+(0==g?" [not found]":""));T(a,g);f();f=null},this)};h.Yd=function(a,b){P(this.logger,V(a)+" removeByKeys "+b.length+" keys");var c,d=0,e=a.g.K(function(f){for(var g=0;g<b.length;g++){var k=b[g].I(),l=b[g].H();c&&c.getName()==k||(c=Zm(f,k));d+=tn(c,l)}T(a,d);e();e=null},this)};h.ne=function(a,b,c){this.$c(a,b,c)};
h.$c=function(a,b,c){var d=V(a)+" removeByKeyRange "+(c?Uh(c):"");P(this.logger,d);var e=this,f=a.g.K(function(g){g=un(Zm(g,b),c);N(e.logger,d+" deleted "+g+" records.");T(a,g);f();f=null},this)};h.ef=function(a,b,c,d){var e=V(a)+" removeByIndexKeyRange "+(d?Uh(d):"");P(this.logger,e);var f=a.g.K(function(e){e=Zm(e,b);for(var k=e.La(c,d),l=k.length,m=0;m<l;m++)tn(e,k[m]);T(a,l);f();f=null},this)};
h.sd=function(a,b){var c=V(a)+" clearByStores";P(this.logger,c);var d=a.g.K(function(e){for(var f=0;f<b.length;f++)Zm(e,b[f]).clear();N(this.logger,"success "+c);T(a,b.length);d();d=null},this)};h.ud=function(a,b){var c=a.g.K(function(d){for(var e=[],f=0;f<b.length;f++){var g=Zm(d,b[f]);e.push(vn(g))}T(a,e);c();c=null},this)};
h.Mc=function(a,b,c,d){var e=V(a)+" count"+(null!=d?"Index":"")+(null!=c?"KeyRange":"Store");P(this.logger,e);var f=a.g.K(function(g){g=vn(Zm(g,b),d,c);N(this.logger,"success "+e);T(a,g);f();f=null},this)};h.list=function(a,b,c,d,e,f,g,k,l,m){var n=V(a)+" "+c+" "+(e?Th(e):"");P(this.logger,n);var p=a.g.K(function(q){q=Zm(q,c).wc(b,d,e,k,f,g,l,m);N(this.logger,n+" "+q.length+" records found.");T(a,q);p();p=null},this)};function Bn(a,b){this.g=b}B(Bn,zn);Bn.prototype.h=function(a,b,c,d){c=X(this.g,c);return new Qm(a,b,c,d)};function Cn(a,b,c,d){ik.call(this,a,b,c,d);this.la=null;this.l=this.p=void 0}B(Cn,ik);h=Cn.prototype;h.logger=Q("ydn.db.core.req.WebsqlCursor");h.ia=function(){return this.l};h.init=function(a,b,c,d,e){Cn.m.init.call(this,a,b,c,d,e);this.la=v(b)?kk(this.h,b):null};h.P=function(){return this.G};function Dn(a,b){a.p=void 0;a.l=void 0;a.G=void 0;if(t(b))if(x(b)){var c=Xl(b[a.h.l],a.h.type);a.l=c;if(a.j){var d=kk(a.h,a.eb);a.p=Xl(b[a.eb],d.type)}else a.p=c;a.G=a.Yc?c:En(b,a.h)}else a.G=b}
function Fn(a,b,c){kk(a.h,a.eb);var d=[],e=a.eb,f=a.ba,g=a.p;if(null!=f){var k=f.lower,l=f.upper,m=f.lowerOpen,n=f.upperOpen;a.reverse?l=null!=l&&-1==Oj(l,g)?l:g:k=null!=k&&1==Oj(k,g)?k:g;null!=k&&null!=l?f=S.bound(k,l,!!m,!!n):f=null!=k?Kj.lowerBound(k,!!m):Kj.upperBound(l,!!n)}else f=a.reverse?Kj.upperBound(g):Kj.lowerBound(g);e=cm(a.h,d,a.V,e,f,a.reverse,a.unique);c=a.reverse?Kj.upperBound(c,!1):Kj.lowerBound(c,!1);c=cm(a.h,d,a.V,a.h.l,c,a.reverse,a.unique);e.ga=e.ga?e.ga+(" AND "+c.ga):c.ga;c=
"SELECT "+e.select+" FROM "+e.uc+(e.ga?" WHERE "+e.ga:"")+(e.group?" GROUP BY "+e.group:"")+" ORDER BY "+e.Sb;c+=" LIMIT 1";P(a.logger,a+": continuePrimary:  SQL: "+c+" : "+Uh(d));a.o.executeSql(c,d,function(c,d){0<d.rows.length?Dn(a,d.rows.item(0)):Dn(a);b.call(a,a.p,a.l,a.G);b=null},function(c,d){M(a.logger,"get error: "+d.message);lk(a,d);Dn(a);b.call(a,a.l,a.p,a.G);b=null;return!1})}
function Gn(a,b,c,d,e,f){var g=!d;d=[];a.j&&null!=f&&null!=c?c=fm(a.h,a.V,d,a.la.getName(),a.ba,c,g,f,a.reverse,a.unique):null!=c?(f=a.la?a.la.getName():null,c=em(a.h,a.V,d,f,a.ba,a.reverse,a.unique,c,g)):(c=bm(a.h,d,a.V,a.j?a.la.j:a.h.l,a.ba,a.reverse,a.unique),a.j&&(c+=", "+a.h.j+" ASC"));c+=" LIMIT 1";0<e&&(c+=" OFFSET "+e);P(a.logger,a+": continue:  SQL: "+c+" : "+Uh(d));a.o.executeSql(c,d,function(c,d){0<d.rows.length?Dn(a,d.rows.item(0)):Dn(a);b.call(a,a.p,a.l,a.G);b=null},function(c,d){M(a.logger,
"get error: "+d.message);lk(a,d);Dn(a);b.call(a,a.l,a.p,a.G);b=null;return!1})}h.Md=function(){return!!this.o};h.update=function(a){if(!this.Md())throw new Ik;var b=new C,c=this.ia();a=im(this.h,a,c);var d="REPLACE INTO "+dm(this.h)+" ("+a.If.join(", ")+") VALUES ("+a.lg.join(", ")+")";P(this.logger,this+': update "'+d+'" : '+Uh(a.values));this.o.executeSql(d,a.values,function(){b.D(c)},function(a,c){b.F(c);return!1});return b};
h.advance=function(a){var b=this.p,c=this.l,d=!0;null==this.p||this.j&&null==this.l||(a-=1,d=!1);Gn(this,function(a,d,g){var k=null!=b&&null!=a&&0==Oj(b,a);if(this.j){var l=null!=d&&null!=c&&0==Oj(d,c);if(k&&l)throw new ud("current: "+b+";"+c+" next: "+a+";"+d);}else if(k)throw new ud("current: "+b+" next: "+a);this.ob(a,d,g)},this.p,d,a,this.l)};h.Zb=function(a){null!=a?Gn(this,this.ob,a,!0):this.advance(1)};h.openCursor=function(a,b){Gn(this,this.ob,a,!1,0,b)};
h.clear=function(){if(!this.Md())throw new Ik;var a=new C,b=this.h.l,b="DELETE FROM "+dm(this.h)+" WHERE "+b+" = ?",c=[this.ia()];P(this.logger,this+': clear "'+b+'" : '+Uh(c));this.o.executeSql(b,c,function(b,c){a.D(c.rowsAffected)},function(b,c){a.F(c);return!1});return a};h.Lc=function(a){var b=Oj(a,this.l);if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ei(this+" to continuePrimaryKey  from "+this.l+" to "+a+" on "+this.sb+" direction is wrong");Fn(this,this.ob,a)};
h.toString=function(){return"WebSql"+Cn.m.toString.call(this)};function Hn(a,b){this.g=b}B(Hn,Rk);h=Hn.prototype;h.logger=Q("ydn.db.crud.req.WebSql");
function En(a,b){if(b.qc&&!b.keyPath&&0==b.indexes.length&&a._default_){var c=a._default_;if(-1==c.indexOf(";base64,"))return Sh(c);'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substr(1,c.length-2));for(var d=c.split(";base64,"),c=d[0].split(":")[1],d=window.atob(d[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f.buffer],{type:c})}c=a._default_?Sh(a._default_):{};null!=b.keyPath&&(d=Xl(a[b.keyPath],b.type),null!=d&&Cl(b,c,d));for(d=0;d<b.indexes.length;d++)e=
b.index(d),f=e.j,"_default_"==f||e.o||e.multiEntry||"DATE"!=e.type&&!b.qc||(f=Xl(a[f],e.type),t(f)&&Wl(e,c,f));return c}h.df=function(){throw new sd("putData");};
h.mb=function(a,b,c,d,e,f){function g(b,d){if(null==e[b])if(P(m.logger,"empty object at "+b+" of "+e.length),p++,p==e.length)N(m.logger,q+" success "+q),T(a,n,s);else{var F=b+2;F<e.length&&g(F,d)}var D;D=t(f)?im(k,e[b],f[b]):im(k,e[b]);F=l+dm(k)+" ("+D.If.join(", ")+") VALUES ("+D.lg.join(", ")+");";P(m.logger,V(a)+" SQL: "+F+" PARAMS: "+D.values+" REQ: "+b+" of "+e.length);d.executeSql(F,D.values,function(f,q){function F(b,c){var e="ydn.db.me:"+k.getName()+":"+b.getName(),e=l+Na(e)+" ("+k.j+", "+
b.i+") VALUES (?, ?)",f=[Pj(K,k.type),Pj(c,b.type)];P(m.logger,V(a)+" multiEntry "+e+" "+f);d.executeSql(e,f,function(){},function(a,b){M(m.logger,"multiEntry index insert error: "+b.message);return!1})}p++;var K=t(D.key)?D.key:q.insertId;1>q.rowsAffected&&(s=!0,K=new Ek(K+" no-op"));for(var Nc=0,cj=k.indexes.length;Nc<cj;Nc++){var rd=k.index(Nc);if(rd.multiEntry)for(var te=Qj(e[b],rd.keyPath),Ow=(te?te.length:0)||0,L=0;L<Ow;L++)F(rd,te[L])}c?T(a,K):(n[b]=K,p==e.length?T(a,n,s):(Nc=b+2,Nc<e.length&&
g(Nc,f)))},function(d,f){p++;s=!0;6==f.code?f.name="ConstraintError":M(m.logger,"error: "+f.message+" "+q);if(c)T(a,f,!0);else if(n[b]=f,p==e.length)P(m.logger,"success "+q),T(a,n,s);else{var k=b+2;k<e.length&&g(k,d)}return!1})}b=!b;var k=X(this.g,d),l=b?"INSERT INTO ":"INSERT OR REPLACE INTO ";d=a.g;var m=this,n=[],p=0,q=V(a)+" inserting "+e.length+" objects.",s=!1;if(0<e.length)for(b=0;2>b&&b<e.length;b++)g(b,d);else N(this.logger,"success"),T(a,[])};
h.Wd=function(a,b,c){if(0==c.length)T(a,[]);else{for(var d=[],e=0,f=0,g=this,k=function(k,l){var m=[];P(g.logger,"put "+l.length+" objects to "+k);for(var n=hm(X(g.g,k)),p=n?void 0:[],q=0;q<l.length;q++)m.push(b[l[q]]),n||p.push(c[l[q]].H());n=zk(a);n.w(function(b){for(var c=0;c<l.length;c++)d[l[c]]=b[c];e++;e==f&&T(a,d)},function(){e++;e==f&&T(a,d,!0)});g.mb(n,!1,!1,k,m,p)},l="",m=[],n=[],p=0;p<c.length;p++){var q=c[p].I(),s=c[p].H();q!=l?(f++,0<m.length&&k(l,m),m=[p],n=[s],l=q):(m.push(p),n.push(s))}0<
m.length&&k(l,m)}};h.Ad=function(a,b,c){var d=a.g,e=X(this.g,b),f=this;b=e.j;c=[Pj(c,e.type)];b="SELECT * FROM "+dm(e)+" WHERE "+b+" = ?";var g=V(a)+" SQL: "+b+" PARAMS: "+c;P(this.logger,g);d.executeSql(b,c,function(b,c){if(0<c.rows.length){var d=c.rows.item(0);null!=d?(d=En(d,e),T(a,d)):(N(f.logger,"success no result: "+g),T(a,void 0))}else N(f.logger,"success no result: "+g),T(a,void 0)},function(b,c){M(f.logger,"error: "+g+" "+c.message);T(a,c,!0);return!1})};
h.Xe=function(a,b,c){function d(b,e){var p=l.j,q=[Pj(c[b],l.type)],s="SELECT * FROM "+dm(l)+" WHERE "+p+" = ?";P(f.logger,"SQL: "+s+" PARAMS: "+q);e.executeSql(s,q,function(e,f){k++;if(0<f.rows.length){var n=f.rows.item(0);null!=n&&(g[b]=En(n,l))}else g[b]=void 0;k==c.length?T(a,g):(n=b+10,n<c.length&&d(n,e))},function(e,l){k++;M(f.logger,"error: "+s+" "+l.message);if(k==c.length)T(a,g);else{var n=b+10;n<c.length&&d(n,e)}return!1})}var e=a.g,f=this,g=[],k=0,l=X(this.g,b);if(0<c.length)for(b=0;10>
b&&b<c.length;b++)d(b,e);else N(f.logger,"success"),T(a,[])};
h.Rd=function(a,b){function c(d,k){var n=b[d],p=X(e.g,n.I()),q=Pk(n),n=p.j,q=[Pj(q,p.type)],s="SELECT * FROM "+dm(p)+" WHERE "+n+" = ?";P(e.logger,"SQL: "+s+" PARAMS: "+q);k.executeSql(s,q,function(k,m){g++;if(0<m.rows.length){var n=m.rows.item(0);null!=n&&(f[d]=En(n,p))}else f[d]=void 0;g==b.length?(P(e.logger,"success "+s),T(a,f)):(n=d+10,n<b.length&&c(n,k))},function(b,c){T(a,c,!0);return!1})}var d=a.g,e=this,f=[],g=0;if(0<b.length)for(var k=0;10>k&&k<b.length;k++)c(k,d);else P(this.logger,"success"),
T(a,[])};
h.sd=function(a,b){function c(d,g){function k(a){a="ydn.db.me:"+l.getName()+":"+a.getName();a="DELETE FROM  "+Na(a);P(e.logger,"SQL: "+a);g.executeSql(a,[])}var l=X(e.g,b[d]),m="DELETE FROM  "+dm(l);P(e.logger,"SQL: "+m+" PARAMS: []");g.executeSql(m,[],function(g){d==b.length-1?(P(e.logger,"success "+m),T(a,b.length)):c(d+1,g)},function(b,c){T(a,c,!0);return!1});for(var n=0,p=l.indexes.length;n<p;n++){var q=l.index(n);q.multiEntry&&k(q)}}var d=a.g,e=this;0<b.length?c(0,d):(P(this.logger,"success"),
T(a,0))};
h.Yd=function(a,b){function c(k){if(k>=b.length)T(a,f,g);else{var l=X(e.g,b[k].I()),m=Pj(b[k].H(),l.type),n=" WHERE "+l.j+" = ?",p="DELETE FROM "+dm(l)+n,q=V(a)+" SQL: "+p+" PARAMS: "+[m];d.executeSql(p,[m],function(){f++;c(k)},function(a,b){M(e.logger,"error: "+q+b.message);g=!0;c(k);return!1});k++;for(var p=function(b){b="ydn.db.me:"+l.getName()+":"+b.getName();b="DELETE FROM  "+Na(b)+n;P(e.logger,V(a)+NaN+b);d.executeSql(b,[m])},s=0,w=l.indexes.length;s<w;s++){var z=l.index(s);z.multiEntry&&p(z)}}}
var d=a.g,e=this,f=0,g=!1;P(this.logger,V(a)+" removeByKeys: "+b.length+" keys");c(0)};
h.Xd=function(a,b,c){function d(b){b="ydn.db.me:"+f.getName()+":"+b.getName();b="DELETE FROM  "+Na(b)+l;P(k.logger,V(a)+NaN+b);e.executeSql(b,[g])}var e=a.g,f=X(this.g,b),g=Pj(c,f.type),k=this,l=" WHERE "+f.j+" = ?";b="DELETE FROM "+dm(f)+l;P(this.logger,V(a)+" SQL: "+b+" PARAMS: "+[g]);e.executeSql(b,[g],function(b,c){T(a,c.rowsAffected)},function(b,c){T(a,c,!0);return!1});b=0;for(c=f.indexes.length;b<c;b++){var m=f.index(b);m.multiEntry&&d(m)}};h.ne=function(a,b,c){In(this,a,b,void 0,c)};
h.$c=function(a,b,c){In(this,a,b,void 0,c)};h.ef=function(a,b,c,d){In(this,a,b,c,d)};
function In(a,b,c,d,e){function f(c){c="ydn.db.me:"+k.getName()+":"+c.getName();c="DELETE FROM  "+Na(c)+n;P(a.logger,V(b)+NaN+c);g.executeSql(c,m)}var g=b.g,k=X(a.g,c);c="DELETE FROM "+dm(k);var l=[],m=[],n="";null!=e&&(t(d)?(d=kk(k,d),Nj(d.i,d.type,e,m,l)):Nj(k.j,k.type,e,m,l),n=" WHERE "+m.join(" AND "));c+=n;var p=V(b)+" SQL: "+c+" PARAMS: "+l;P(a.logger,p);g.executeSql(c,l,function(c,d){P(a.logger,"success "+p);T(b,d.rowsAffected)},function(c,d){M(a.logger,"error: "+p+d.message);T(b,d,!0);return!1});
e=0;for(d=k.indexes.length;e<d;e++)c=k.index(e),c.multiEntry&&f(c)}h.ud=function(a,b){function c(g){var k="SELECT COUNT(*) FROM "+Na(b[g]);P(e.logger,"SQL: "+k+" PARAMS: []");d.executeSql(k,[],function(d,e){var k=e.rows.item(0);f[g]=parseInt(k["COUNT(*)"],10);g++;g==b.length?T(a,f):c(g)},function(b,c){T(a,c,!0);return!1})}var d=a.g,e=this,f=[];0==b.length?(P(this.logger,"success"),T(a,0)):c(0)};
h.Mc=function(a,b,c,d,e){var f=[];b=bm(X(this.g,b),f,6,d,c,!1,e);P(this.logger,V(a)+" SQL: "+b+" PARAMS: "+f);a.g.executeSql(b,f,function(b,c){var d=c.rows.item(0);T(a,sm(d))},function(b,c){T(a,c,!0);return!1})};
h.list=function(a,b,c,d,e,f,g,k,l,m){var n=this,p=[],q=X(this.g,c),s=q.l,w=q.type,z=w,F=null!=d&&d!==s?kk(q,d):null,D=d||s;F&&(z=F.type);c=[];if(m&&t(m[0])){var I=m[0];F&&t(m[1])?(d=m[1],e=fm(q,b,c,F.getName(),e,I,!0,d,k,l)):e=em(q,b,c,d,e,k,l,I,!0)}else e=bm(q,c,b,D,e,k,l);ha(f)&&(e+=" LIMIT "+f);ha(g)&&(e+=" OFFSET "+g);var O=a+" SQL: "+e+" ;params= "+Uh(c);P(this.logger,O);a.g.executeSql(e,c,function(c,d){for(var e=d.rows.length,f,g=0;g<e;g++)f=d.rows.item(g),2==b?p[g]=Xl(f[s],w):1==b?p[g]=Xl(f[D],
z):3==b?p[g]=[Xl(f[D],z),Xl(f[s],w)]:null!=f&&(p[g]=En(f,q));N(n.logger,"success "+a);m&&f&&(m[0]=Xl(f[D],z),m[1]=Xl(f[s],w));T(a,p)},function(b,c){M(n.logger,"error: "+O+c.message);T(a,c,!0);return!1})};function Jn(a,b){this.g=b}B(Jn,Hn);Jn.prototype.logger=Q("ydn.db.core.req.WebSql");Jn.prototype.h=function(a,b,c,d){c=X(this.g,c);return new Cn(a,b,c,d)};Im.prototype.C=function(){var a=Vk(this);if("indexeddb"==a)return new Om(0,this.h);if("websql"==a)return new Jn(0,this.h);if("memory"==a||"localstorage"==a||"userdata"==a||"sessionstorage"==a)return new Bn(0,this.h);throw new ud("No executor for "+a);};function Kn(a){return v(a)?a.replace(/\D/g,"").replace(/^0+/,""):null}function Ln(a){if(!v(a)||!/[\w\+]+@\w+\.\w+/.test(a))return null;a=a.replace(/.*</,"").replace(/>.*/,"");a=a.toLowerCase();a=a.replace(/\+\w*?@/,"@");for(var b=a.indexOf("@");0<=b;b--);return a};function Mn(a){if(!v(a))throw new Zh;this.ab=a;this.j=fk;this.g=[];Nn(this,a);this.fd=""}h=Mn.prototype;h.ab="";h.dg=NaN;h.eg=NaN;h.nf=!1;h.fd="";
function Nn(a,b){var c=b.split(/\sFROM\s/i);if(2==c.length){var d=c[1],c=c[0].match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i);if(3==c.length){a.l=c[1].toUpperCase();if("SELECT"==a.l)a.j=ek;else if("INSERT"==a.l)a.j=fk;else if("UPDATE"==a.l)a.j=fk;else if("DELETE"==a.l)a.j=fk;else return;var c=c[2].trim(),e=c.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);e?(a.i=e[0].toUpperCase(),c=c.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):a.i=void 0;"("==c.charAt(0)&&(")"==c.charAt(c.length-1)?c=c.substring(1,c.length-
1):new Mk("missing closing parentheses"));a.C=c;c=d.search(/(ORDER BY|LIMIT|OFFSET)/i);0<c?(a.h=d.substring(c),d=d.substring(0,c)):a.h="";c=d.search(/WHERE/i);0<c?(a.o=d.substring(c+6).trim(),d=d.substring(0,c)):a.o="";a.g=d.trim().split(",").map(function(a){a=Ka(a,'"');a=Ka(a,"'");return a.trim()})}}}
h.parse=function(a){if(a){for(var b=0;b<a.length;b++)this.ab=this.ab.replace("?",a[b]);Nn(this,this.ab)}this.p=On(this);if(!this.p)return this.fd;a=this.h.length;if(b=/OFFSET\s+(\d+)/i.exec(this.h))this.eg=parseInt(b[1],10),a=this.h.search(/OFFSET/i);if(b=/LIMIT\s+(\d+)/i.exec(this.h))this.dg=parseInt(b[1],10),b=this.h.search(/LIMIT/i),b<a&&(a=b);(a=/ORDER BY\s+(.+)/i.exec(this.h.substr(0,a)))?(a=a[1].trim(),(b=a.match(/(ASC|DESC)/i))?(this.nf="DESC"==b[0].toUpperCase(),a=a.replace(/\s+(ASC|DESC)/i,
"")):this.nf=!1,this.u=Ka(Ka(a,'"'),"'")):this.u=void 0;return""};function Pn(a){if("*"==a.C)return null;a=a.C.split(",");return a=a.map(function(a){return Ka(a.trim(),'"')})}h.toJSON=function(){return{sql:this.ab}};
function On(a){function b(a){return zb(c,function(b){return b.Qc()==a})}var c=[],d=/(.+?)(<=|>=|=|>|<)(.+)/i;if(0<a.o.length)for(var e=a.o.split("AND"),f=0;f<e.length;f++){var g=e[f],k=d.exec(g);if(k){var l=k[1].trim(),l=Ka(l,'"'),l=Ka(l,"'");if(0<l.length){var m=k[3].trim();va(m,'"')?m=Ka(m,'"'):va(m,"'")?m=Ka(m,"'"):m=parseFloat(m);k=new bk(l,k[2],m);l=b(l);if(0<=l){if(c[l]=c[l].me(k),!c[l])return a.fd='where clause "'+g+'" conflict',null}else c.push(k)}else return a.fd='Invalid clause "'+g+'"',
null}else return a.fd='Invalid clause "'+g+'"',null}return c}h.toString=function(){return"query:"+this.ab};function Qn(a,b){this.g=b;this.h=a}Qn.prototype.logger=Q("ydn.db.sql.req.nosql.Node");Qn.prototype.toJSON=function(){return{sql:this.g}};Qn.prototype.toString=function(){return"idb.Node:"};
Qn.prototype.execute=function(a,b){var c=Eb(this.g.g)[0],d=this.g.p,e=this.g.dg,e=isNaN(e)?100:e,f=this.g.eg,f=isNaN(f)?0:f,g=this.g.u,k=Pn(this.g),l=null,m=this.g.nf;if(0==d.length)l=null;else if(1==d.length)l=Hj(d[0].g);else throw new qd("too many conditions.");null===k||Bk(a,function(a,b,c){var d=a;b||(d=a.map(function(a){var b=k.length;if(1==b)return Qj(a,k[0]);for(var c={},d=0;d<b;d++)c[k[d]]=Qj(a,k[d]);return c}));c(d,b)});var d=0<d.length?d[0].Qc():void 0,n=V(a)+" executing on"+c;d&&(n+=":"+
d);n+=" "+Mj(l);N(this.logger,n);g&&g!=this.h.keyPath?b.list(a,4,c,g,l,e,f,m,!1):t(d)&&d!=this.h.keyPath?b.list(a,4,c,d,l,e,f,m,!1):b.list(a,4,c,null,l,e,f,m,!1)};function Rn(a,b){Qn.call(this,a,b)}B(Rn,Qn);
Rn.prototype.execute=function(a,b){var c,d=Eb(this.g.g)[0],e=this.g.p,f=null;if(0==e.length)f=null;else if(1==e.length)f=Hj(e[0].g);else throw new qd("too many conditions.");var g=this.g.i,e=0<e.length?e[0].Qc():void 0,k=V(a)+" executing "+g+" on "+d;e&&(k+=":"+e);k+=" "+Mj(f);N(this.logger,k);if("COUNT"==g)f?b.Mc(a,d,f,e,!1):b.Mc(a,d,null,void 0,!1);else{var l,k=Pn(this.g);if(!k||0==k.length)throw new ei("field name require for reduce operation: "+g);k=k[0];if("MIN"==g)l=Sn(k);else if("MAX"==g)l=
Tn(k);else if("AVG"==g)c=0,l=Un(k);else if("SUM"==g)c=0,l=Vn(k);else throw new $h(g);var m;t(e)?m=new uk(d,e,f):m=new tk(d,f);var d=b.h(a.g,V(a),d,4),n=m.load([d]);n.aa=function(b){T(a,b,!0)};var p=0;n.C=function(b){null!=b?(b=m.g?n.ia():n.P(),c=l(b,c,p),n.advance(1),p++):T(a,c)}}};function Un(a){return function(b,c,d){t(c)||(c=0);return(c*d+b[a])/(d+1)}}function Vn(a){return function(b,c){return c+b[a]}}function Sn(a){return function(b,c){var d=b[a];return t(c)?c<d?c:d:d}}
function Tn(a){return function(b,c){var d=b[a];return t(c)?c>d?c:d:d}};function Wn(a,b){this.g=b}B(Wn,Om);Wn.prototype.logger=Q("ydn.db.sql.req.IndexedDb");Wn.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new Mk(c);c=Eb(b.g);if(1==c.length){var d=X(this.g,c[0]);if(!d)throw new Jk(c[0]);var e=Pn(b);if(e)for(var f=0;f<e.length;f++)if(!rl(d,e[f]))throw new Jk('Index "'+e[f]+'" not found in '+c[0]);var g;b.i?g=new Rn(d,b):g=new Qn(d,b);g.execute(a,this)}else throw new $h(b.ab);};function Xn(a,b){this.h=b;this.i=a;this.g=Pn(b)}Xn.prototype.logger=Q("ydn.db.sql.req.websql.Node");Xn.prototype.toJSON=function(){return{sql:this.h.ab}};Xn.prototype.toString=function(){return"websql.Node:"};function Yn(a,b){if(a.g){if(1==a.g.length){if(x(b))return Ic(b,a.g[0]);return}for(var c={},d=0;d<a.g.length;d++)c[a.g[d]]=Ic(b,a.g[d]);return c}return En(b,a.i)}
Xn.prototype.execute=function(a,b,c){var d=this,e=[];b.executeSql(this.h.ab,c,function(b,c){for(var k=c.rows.length,l=0;l<k;l++){var m=c.rows.item(l);if(x(m))var n=Yn(d,m);e.push(n)}a(e)},function(b,c){M(d.logger,"Sqlite error: "+c.message);a(c,!0);return!0})};function Zn(a,b){Xn.call(this,a,b)}B(Zn,Xn);Zn.prototype.execute=function(a,b,c){var d=this;b.executeSql(this.h.ab,c,function(b,c){var d=c.rows.length;if(1==d)d=sm(c.rows.item(0)),a(d);else if(0==d)a(void 0);else throw new Hk;},function(b,c){M(d.logger,"Sqlite error: "+c.message);a(c,!0);return!0})};function $n(a,b){this.g=b}B($n,Jn);$n.prototype.logger=Q("ydn.db.sql.req.WebSql");$n.prototype.executeSql=function(a,b,c){var d=Eb(b.g);if(1==d.length){var e=X(this.g,d[0]);if(!e)throw new Jk(d[0]);var f=Pn(b);if(f)for(var g=0;g<f.length;g++)if(!rl(e,f[g]))throw new Jk('Index "'+f[g]+'" not found in '+d[0]);var k;b.i?k=new Zn(e,b):k=new Xn(e,b);k.execute(function(b,c){T(a,b,c)},a.g,c)}else throw new $h(b.ab);};function ao(a,b){this.g=b}B(ao,Bn);ao.prototype.logger=Q("ydn.db.sql.req.SimpleStore");ao.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new Mk(c);c=Eb(b.g);if(1==c.length){var d=X(this.g,c[0]);if(!d)throw new Jk(c[0]);var e=Pn(b);if(e)for(var f=0;f<e.length;f++)if(!rl(d,e[f]))throw new J('Index "'+e[f]+'" not found in '+c[0]);var g;b.i?g=new Rn(d,b):g=new Qn(d,b);g.execute(a,this)}else throw new qd(b.ab);};function bo(a,b,c,d){fl.call(this,a,b,c,d)}B(bo,Ll);bo.prototype.executeSql=function(a,b){for(var c=new Mn(a),d=Eb(c.g),e=0;e<d.length;e++){var f=X(this.h,d[e]);if(!f)throw new J("store: "+f+" not exists.");}N(this.logger,"executeSql: "+a+" params: "+b);var g=this.g.request("sql",Eb(c.g),c.j);U(g,function(){W(this).executeSql(g,c,b||[])},this);return g};function co(a,b,c){Hm.call(this,a,b,c)}B(co,Im);co.prototype.Cc=function(a,b){return new bo(this,this.h,a,b)};co.prototype.executeSql=function(a,b){return this.g.executeSql(a,b)};co.prototype.C=function(){var a=Vk(this);if("indexeddb"==a)return new Wn(0,this.h);if("websql"==a)return new $n(0,this.h);if("memory"==a||"localstorage"==a||"sessionstorage"==a)return new ao(0,this.h);throw new ud("No executor for "+a);};function eo(a,b){t(a)&&5242880<a&&M(this.logger,"storage size request ignored, use Quota Management API instead");this.ja=null;this.cd=b||NaN}h=eo.prototype;
h.connect=function(a,b){function c(a,c,d){N(e.logger,(d?"changing":"upgrading")+" version to "+a.version+" from "+g);for(d=0;d<b.stores.length;d++)fo(e,a,c,b.stores[d]);c=a.objectStoreNames;var f=c.length;for(d=0;d<f;d++)ol(b,c[d])||(a.deleteObjectStore(c[d]),N(e.logger,"store: "+c[d]+" deleted."))}function d(a,b){f.h?M(e.logger,"database already set."):t(b)?(M(e.logger,b?b.message:"Error received."),e.ja=null,f.F(b)):(e.ja=a,e.ja.onabort=function(a){P(e.logger,e+": abort");e.hd(a.target.error)},
e.ja.onerror=function(a){P(e.logger,e+": error");e.hd(a.target.error)},e.ja.onversionchange=function(a){P(e.logger,e+" closing connection for onversionchange to: "+a.version);if(e.ja&&(e.ja.onabort=null,e.ja.onblocked=null,e.ja.onerror=null,e.ja.onversionchange=null,e.Vd(a),!a.defaultPrevented)){e.ja.close();e.ja=null;var b=Error();b.name=a.type;e.fe(b)}},f.D(parseFloat(g)))}var e=this,f=new C,g=void 0,k=b.version;N(e.logger,"Opening database: "+a+" ver: "+(b.Bc?"auto":k));var l;l=t(k)?hk.open(a,
k):hk.open(a);l.onsuccess=function(f){var k=f.target.result;t(g)||(g=k.version);N(e.logger,"Database: "+k.name+", ver: "+k.version+" opened.");if(b.Bc)e.jb(function(f){if(b instanceof kl)for(var g=0;g<f.stores.length;g++)ol(b,f.stores[g].getName())||ll(b,f.stores[g].ha());f=pm(b,f,!1,!0);if(0<f.length){N(e.logger,"Schema change require for difference in "+f);var l=ha(k.version)?k.version+1:1;if("IDBOpenDBRequest"in r){k.close();var m=hk.open(a,l);m.onupgradeneeded=function(a){a=a.target.result;N(e.logger,
"re-open for version "+a.version);c(a,m.transaction,!1)};m.onsuccess=function(a){d(a.target.result)};m.onerror=function(){N(e.logger,e+": fail.");d(null)}}else{var p=k.setVersion(l+"");p.g=function(a){M(e.logger,"migrating from "+k.version+" to "+l+" failed.");d(null,a)};p.onsuccess=function(){p.transaction.oncomplete=D;c(k,p.transaction,!0)};var D=function(){var b=hk.open(a);b.onsuccess=function(a){a=a.target.result;N(e.logger,e+": OK.");d(a)};b.onerror=function(){N(e.logger,e+": fail.");d(null)}};
null!=p.transaction&&(p.transaction.oncomplete=D)}}else d(k)},void 0,k);else if(b.version>k.version){var l=k.setVersion(b.version);l.g=function(a){M(e.logger,"migrating from "+k.version+" to "+b.version+" failed.");d(null,a)};l.onsuccess=function(){c(k,l.transaction,!0)}}else b.version==k.version?N(e.logger,"database version "+k.version+" ready to go"):M(e.logger,"connected database version "+k.version+" is higher than requested version."),e.jb(function(a){a=pm(b,a,!1,!0);0<a.length?(N(e.logger,a),
d(null,new ci("different schema: "+a))):d(k)},void 0,k)};l.onupgradeneeded=function(a){a=a.target.result;g=NaN;N(e.logger,"upgrade needed for version "+a.version);c(a,l.transaction,!1)};l.onerror=function(c){e.logger.log(of,'open request to database "'+a+'" '+(t(b.version)?" with version "+b.version:"")+" cause error of "+l.error.name,void 0);d(null,c)};l.onblocked=function(c){e.logger.log(of,"database "+a+" "+b.version+" block, close other connections.",void 0);d(null,c)};ha(this.cd)&&!isNaN(this.cd)&&
setTimeout(function(){"done"!=l.readyState&&(e.logger.log(of,e+": database state is still "+l.readyState,void 0),d(null,new Nk("connection timeout after "+e.cd)))},this.cd);return f};h.cd=18E4;h.fe=function(){};h.hd=function(){};h.Vd=function(){};h.Hc=function(){return"indexeddb"};h.ee=function(){return!!this.ja};h.logger=Q("ydn.db.con.IndexedDb");h.ja=null;h.de=function(){return this.ja?parseFloat(this.ja.version):void 0};
h.jb=function(a,b,c){c=c||this.ja;if(t(b)){if(null===b){if(0==c.objectStoreNames.length){a(new om(c.version));return}throw new bi;}c=b.db}else{b=[];for(var d=c.objectStoreNames.length-1;0<=d;d--)b[d]=c.objectStoreNames[d];if(0==b.length){a(new om(c.version));return}b=c.transaction(b,ek)}for(var e=c.objectStoreNames,f=[],g=e.length,d=0;d<g;d++){for(var k=b.objectStore(e[d]),l=[],m=0,n=k.indexNames.length;m<n;m++){var p=k.index(k.indexNames[m]);l[m]=new Sl(p.keyPath,void 0,p.unique,p.multiEntry,p.name)}f[d]=
new hl(k.name,k.keyPath,k.autoIncrement,void 0,l)}b=new om(c.version,f);a(b)};
function fo(a,b,c,d){function e(){var a={autoIncrement:!!d.h};null!=d.keyPath&&(a.keyPath=d.keyPath);return b.createObjectStore(d.getName(),a)}P(a.logger,"Creating Object Store for "+d.getName()+" keyPath: "+d.keyPath);if(b.objectStoreNames.contains(d.getName())){c=c.objectStore(d.getName());Zl(d.keyPath||"",c.keyPath||"")?(b.deleteObjectStore(d.getName()),M(a.logger,"store: "+d.getName()+" deleted due to keyPath change."),c=e()):ga(c.autoIncrement)&&ga(d.h)&&c.autoIncrement!=d.h&&(b.deleteObjectStore(d.getName()),
M(a.logger,"store: "+d.getName()+" deleted due to autoIncrement change."),c=e());for(var f=c.indexNames,g=0;g<d.indexes.length;g++){var k=d.index(g);!f.contains(k.getName())&&k.l&&(c.clear(),M(a.logger,"store: "+d.getName()+" cleared since generator index need re-indexing."))}for(var l=0,m=0,n=0,g=0;g<d.indexes.length;g++){var k=d.index(g),p=!1;if(f.contains(k.getName())){var q=c.index(k.getName()),s=null!=q.unique&&null!=k.unique&&q.unique!=k.unique,w=null!=q.multiEntry&&null!=k.multiEntry&&q.multiEntry!=
k.multiEntry,q=null!=q.keyPath&&null!=k.keyPath&&!!Zl(q.keyPath,k.keyPath);if(s||w||q)c.deleteIndex(k.getName()),p=!0,l--,n++}else"BLOB"!=k.type&&(p=!0);p&&(k.unique||k.multiEntry?(p={unique:k.unique,multiEntry:k.multiEntry},c.createIndex(k.getName(),k.keyPath,p)):c.createIndex(k.getName(),k.keyPath),l++)}for(g=0;g<f.length;g++)rl(d,f[g])||(c.deleteIndex(f[g]),m++);P(a.logger,"Updated store: "+c.name+", "+l+" index created, "+m+" index deleted, "+n+" modified.")}else{c=e();for(g=0;g<d.indexes.length;g++)k=
d.index(g),"BLOB"==k.type?a.logger.info("Index "+k+" of blob data type ignored."):(P(a.logger,"Creating index: "+k),k.unique||k.multiEntry?(p={unique:k.unique,multiEntry:k.multiEntry},c.createIndex(k.getName(),k.keyPath,p)):c.createIndex(k.getName(),k.keyPath));P(a.logger,"Created store: "+c)}}
h.xd=function(a,b,c,d){var e=this.ja;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(null):(b=e.transaction(b,c),b.oncomplete=function(a){d("complete",a)},b.onabort=function(a){d("abort",a)},a(b),a=null)};h.close=function(){P(this.logger,this+" closing connection");this.ja.close()};h.toString=function(){return"IndexedDB:"+(this.ja?this.ja.name+":"+this.ja.version:"")};
Dk.push(function(a,b){if(!hk||b&&"indexeddb"!=b)return null;var c=hk.deleteDatabase(a),d=new xk("IDBVersionChangeEvent ");c.onblocked=function(a){wd(d,a)};c.onerror=function(a){d.F(a)};c.onsuccess=function(a){d.D(a)};return d});function go(a){xn.call(this,a);this.h=NaN}B(go,xn);h=go.prototype;h.logger=Q("ydn.db.con.SimpleStorage");h.de=function(){return this.h};
h.connect=function(a,b){function c(a,b){setTimeout(function(){b?(N(d.logger,d+" opening fail"),e.F(b)):(N(d.logger,d+" version "+d.de()+" open"),e.D(a))},10)}var d=this,e=new C;this.j=this.o.oe(a);this.i=a;this.g=b;var f=an(this.i);this.h=NaN;var g=Sh(this.j.getItem(f));t(g.version)&&!ha(g.version)&&(g.version=NaN);if(g)if(g=new om(g),pm(this.g,g,!1,!1))if(!this.g.Bc&&!isNaN(g.version)&&this.g.version>g.version)c(NaN,new Gk("existing version "+g.version+" is larger than "+this.g.version));else{var k=
this.g.version;this.h=t(k)?k:g.version+1;for(k=0;k<this.g.count();k++)var l=this.g.store(k);if(this.g instanceof kl)for(k=0;k<g.count();k++)l=g.store(k),ll(this.g,l);k=this.g.toJSON();k.version=this.h||NaN;this.j.setItem(f,Uh(k));c(g.version||NaN)}else{for(k=0;k<this.g.count();k++)l=this.g.store(k);this.h=g.version||NaN;c(this.h)}else g=b.toJSON(),this.h=1,g.version=this.h,this.j.setItem(f,Uh(g)),c(NaN);return e};h.ee=function(){return!!this.i};h.fe=function(){};h.hd=function(){};h.Vd=function(){};
h.Hc=function(){return"memory"};h.close=function(){};h.xd=function(a,b,c,d){a(new yn(this,function(a,b){d(a,b)}))};h.toString=function(){return"SimpleStorage:"+this.Hc()+":"+(this.i+":"+this.h)};function ho(){go.call(this,this)}B(ho,go);ho.prototype.oe=function(){return window.localStorage};ho.prototype.Hc=function(){return"localstorage"};Dk.push(function(a,b){if(!b||"localstorage"==b){var c=new ho,d=new kl;c.connect(a,d);c.jb(function(a){for(var b=0;b<a.stores.length;b++)Zm(c,a.stores[b].getName()).clear()})}});function jo(){go.call(this,this)}B(jo,go);jo.prototype.oe=function(){return window.sessionStorage};jo.prototype.Hc=function(){return"sessionstorage"};
Dk.push(function(a,b){if(!b||"sessionstorage"==b){var c=new jo,d=new kl;c.connect(a,d);c.jb(function(a){for(var b=0;b<a.stores.length;b++)Zm(c,a.stores[b].getName()).clear()})}});function ko(a){this.g=t(a)?a:4194304}h=ko.prototype;
h.connect=function(a,b){function c(b,c){var f=b.version?parseInt(b.version,10):0,g=c.Bc?isNaN(f)?1:f+1:c.version;zf(e.logger,a+": changing version from "+b.version+" to "+g);var k=!1,l=0;b.changeVersion(b.version,g+"",function(a){e.jb(function(b){k=!0;for(var d=0;d<c.count();d++){var f=X(b,c.store(d).getName()),f=f?gm(f,c.store(d)):null;lo(e,a,c.store(d),function(a){a&&l++},f)}for(d=0;d<b.count();d++)f=b.store(d),ol(c,f.getName())||(c instanceof kl?ll(c,f):(f="DROP TABLE "+dm(f),N(e.logger,f),a.executeSql(f,
[],function(){},function(a,b){throw b;})))},a,b)},function(c){e.logger.log(of,"SQLError "+c+" "+c.code+"("+c.message+") while changing version from "+b.version+" to "+g+" on "+a,void 0);throw c;},function(){if(k){var f=".";l!=c.stores.length&&(f=" but unexpected stores exists.");P(e.logger,a+":"+b.version+" ready"+f);d(b)}else M(e.logger,a+": changing version voided.")})}function d(a,b){t(b)?(e.Ja=null,g.F(b)):(e.Ja=a,g.D(parseFloat(f)))}var e=this,f=NaN,g=new C,k=null;try{k=r.openDatabase(a,"",a,
this.g)}catch(l){if("SECURITY_ERR"==l.name)M(this.logger,"SECURITY_ERR for opening "+a),k=null,this.of=new Lk(l);else throw l;}if(k){var f=k.version,m="database "+a+(0==k.version.length?"":" version "+k.version);null!=b.version&&b.version==k.version?(zf(e.logger,"Existing "+m+" opened as requested."),d(k)):this.jb(function(a){(a=pm(b,a,!0,!1))?(0==k.version.length?zf(e.logger,"New "+m+" created."):b.Bc?zf(e.logger,"Existing "+m+" opened and schema change for "+a):zf(e.logger,"Existing "+m+" opened and  schema change to version "+
b.version+" for "+a),c(k,b)):(zf(e.logger,"Existing "+m+" with same schema opened."),d(k))},null,k)}else d(null,this.of);return g};h.Hc=function(){return"websql"};h.of=null;h.Ja=null;h.logger=Q("ydn.db.con.WebSql");h.fe=function(){};h.hd=function(){};
function mo(a){var b=a.G,c="CREATE TABLE IF NOT EXISTS "+dm(a)+" (",d=a.j,c=c+(d+" "+b+" PRIMARY KEY ");a.h&&(c+=" AUTOINCREMENT ");if(!a.qc||!a.keyPath&&0==a.indexes.length)c+=" ,_default_ BLOB";for(var e=[],f=[d],g=0,k=a.indexes.length;g<k;g++){var l=a.index(g),m="";if(l.multiEntry){var m="ydn.db.me:"+a.getName()+":"+l.getName(),n=l.unique?" UNIQUE ":"",l="CREATE TABLE IF NOT EXISTS "+Na(m)+" ("+d+" "+b+", "+l.i+" "+l.p+n+")";e.push(l)}else l.unique&&(m=" UNIQUE "),n=l.keyPath,"BLOB"!=l.type&&v(n)&&
(n="CREATE "+m+" INDEX IF NOT EXISTS "+Na(a.getName()+"-"+l.getName())+" ON "+dm(a)+" ("+l.i+")",e.push(n)),n=l.i,-1==f.indexOf(n)&&(c+=", "+n+" "+l.p+m,f.push(n))}e.unshift(c+")");return e}h.de=function(){return this.Ja?parseFloat(this.Ja.version):void 0};
h.jb=function(a,b,c){function d(a,b){throw b;}function e(b,c){if(c&&c.rows){for(var d=0;d<c.rows.length;d++){var e=c.rows.item(d);if("__WebKitDatabaseInfoTable__"!=e.name&&"sqlite_sequence"!=e.name&&"table"==e.type){var q=Kc(e,"sql");P(f.logger,"Parsing table schema from SQL: "+q);for(var s=q.substr(q.indexOf("("),q.lastIndexOf(")")).match(/(?:"[^"]*"|[^,])+/g),w=void 0,z,q=[],F=!1,D=!1,I=0;I<s.length;I++){var O=s[I].match(/\w+|"[^"]+"/g),sa=vb(O,function(a){return a.toUpperCase()}),K=Ka(O[0],'"'),
O=Tl(sa[1]);if(-1!=sa.indexOf("PRIMARY")&&-1!=sa.indexOf("KEY")){z=O;if(v(K)&&!ya(K)&&"_ROWID_"!=K){var Nc=K.split(","),w=K;1<Nc.length&&(w=Nc,z=void 0)}-1!=sa.indexOf("AUTOINCREMENT")&&(F=!0)}else if("_ROWID_"!=K)if("_default_"==K)D=!0;else{var cj="UNIQUE"==sa[2];va(K,e.tbl_name+"-")&&(K=K.substr(e.tbl_name.length+1));sa=new Sl(K,O,cj);q.push(sa)}}if(va(e.name,"ydn.db.me:")){var rd=e.name.split(":");if(3<=rd.length){var te=rd[1],w=new Sl(rd[2],O,cj,!0),s=zb(q,function(a){return a.getName()==rd[2]});
0<=s?q[s]=w:q.push(w);s=zb(k,function(a){return a.getName()===te});0<=s?(I=k[s],k[s]=new hl(I.getName(),I.keyPath,F,z,q,void 0,!D)):k.push(new hl(te,void 0,!1,void 0,[w]));P(f.logger,'multi entry index "'+w.getName()+'" found in '+te+(-1==s?"*":""))}else M(f.logger,'Invalid multiEntry store name "'+e.name+'"')}else I=zb(k,function(a){return a.getName()===e.name}),0<=I?(s=k[I].index(0),q.push(s),k[I]=new hl(e.name,w,F,z,q,void 0,!D)):(q=new hl(e.name,w,F,z,q,void 0,!D),k.push(q))}}d=new om(g,k);a(d)}}
var f=this,g=(c=c||this.Ja)&&c.version?parseFloat(c.version):void 0,g=isNaN(g)?void 0:g,k=[];b?b.executeSql("SELECT * FROM sqlite_master",[],e,d):c.readTransaction(function(b){f.jb(a,b,c)},function(a){f.logger.log(of,"opening tx: "+a.message,void 0);throw a;},e)};
function lo(a,b,c,d,e){function f(a){b.executeSql(a,[],function(){g++;g==k.length&&(d(!0),d=null)},function(b,e){g++;g==k.length&&(d(!1),d=null);var f="SQLError creating table: "+c.getName()+" "+e.message+' for executing "'+a;throw new Kk(e,f);})}var g=0,k=mo(c),l="Create";if(e){e=jl(c,e);if(0==e.length){P(a.logger,"same table "+c.getName()+" exists.");d(!0);d=null;return}l="Modify";M(a.logger,"table: "+c.getName()+" has changed by "+e+" ALTER TABLE cannot run in WebSql, dropping old table.");k.unshift("DROP TABLE IF EXISTS "+
Na(c.getName()))}P(a.logger,l+" table: "+c.getName()+": "+k.join(";"));for(a=0;a<k.length;a++)f(k[a])}h.ee=function(){return!!this.Ja};h.close=function(){this.Ja=null};
h.xd=function(a,b,c,d){function e(a){P(k.logger,k+": Tx "+c+" request cause error.");d("abort",a)}function f(){d("complete",{type:"complete"})}function g(b){a(b)}var k=this;null===this.Ja&&(a(null),d("abort",this.of));c==ek?this.Ja.readTransaction(g,e,f):c==gk?this.Ja.changeVersion(this.Ja.version,this.Ja.version+1+"",g,e,f):this.Ja.transaction(g,e,f)};
Dk.push(function(a,b){if(ia(r.openDatabase)&&(!b||"websql"==b)){var c=new ko,d=new kl;N(c.logger,"deleting websql database: "+a);var d=c.connect(a,d),e=function(){c.logger.info("all tables in "+a+" deleted.")};d.B(function(){c.xd(function(b){b.executeSql('SELECT * FROM sqlite_master WHERE type = "table"',[],function(d,e){if(e&&e.rows){for(var l=e.rows.length,m=0,n=0;n<l;n++){var p=e.rows.item(n);"__WebKitDatabaseInfoTable__"!=p.name&&"sqlite_sequence"!=p.name&&(m++,P(c.logger,"deleting table: "+p.name),
b.executeSql("DROP TABLE "+p.name))}N(c.logger,m+' tables deleted from "'+a+'"')}},function(a,b){throw b;})},[],fk,e)});d.Ic(function(){M(c.logger,"Connecting "+a+" failed.")})}});ko.prototype.Vd=function(){};ko.prototype.toString=function(){return"WebSql:"+(this.Ja?":"+this.Ja.version:"")};Em.prototype.pe=function(a){return"indexeddb"==a&&hk?new eo(this.G,this.T):"websql"==a&&ia(r.openDatabase)?new ko(this.G):"localstorage"==a&&window.localStorage?new ho:"sessionstorage"==a&&window.sessionStorage?new jo:"memory"==a?new go:null};function no(a,b){ac.call(this);this.j=b;this.h=[];if(a>this.j)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var c=0;c<a;c++)this.h.push(this.g())}B(no,ac);no.prototype.g=function(){return{}};no.prototype.i=function(a){if(x(a))if(ia(a.ma))a.ma();else for(var b in a)delete a[b]};no.prototype.J=function(){no.m.J.call(this);for(var a=this.h;a.length;)this.i(a.pop());delete this.h};function oo(){this.g=[];this.i=new Md;this.j=new Md;this.o=1;this.l=new no(0,4E3);this.l.g=function(){return new po};this.p=new no(0,50);this.p.g=function(){return new qo};var a=this;this.h=new no(0,2E3);this.h.g=function(){return String(a.o++)};this.h.i=function(){}}Q("goog.debug.Trace");function qo(){this.time=this.count=0}qo.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");return a.join("")};function po(){}
function ro(a,b,c){var d=[];-1==b?d.push("    "):d.push(so(a.h-b));d.push(" ",to(a.h-0));0==a.g?d.push(" Start        "):1==a.g?(d.push(" Done "),d.push(so(a.l-a.startTime)," ms ")):d.push(" Comment      ");d.push(c,a);0<a.j&&d.push("[VarAlloc ",a.j,"] ");return d.join("")}po.prototype.toString=function(){return null==this.type?this.i:"["+this.type+"] "+this.i};
oo.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.g.length;d++){var e=this.g[d];1==e.g&&c.pop();a.push(" ",ro(e,b,c.join("")));b=e.h;a.push("\n");0==e.g&&c.push("|  ")}if(0!=this.i.fa()){var f=A();a.push(" Unstopped timers:\n");Kd(this.i,function(b){a.push("  ",b," (",f-b.startTime," ms, started at ",to(b.startTime),")\n")})}b=this.j.La();for(d=0;d<b.length;d++)c=this.j.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",0,"\n","Total comments created ",
0,"\n","Overhead start: ",0," ms\n","Overhead end: ",0," ms\n","Overhead comment: ",0," ms\n");return a.join("")};function so(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a}function to(a){a=Math.round(a);return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+a%1E3).substring(1,4)}new oo;/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function uo(a){a.p||(a.p=new kd);return a.p}Em.prototype.addEventListener=function(a,b,c,d){if("ready"==a)ed(uo(this),a,b,c,d);else{var e="created error fail ready deleted updated versionchange".split(" "),f=function(a){if(!Ab(e,a))throw new J('Invalid event type "'+a+'"');};if(fa(a))for(var g=0;g<a.length;g++)f(a[g]);else f(a);Yc(uo(this),a,b,c,d)}};Em.prototype.removeEventListener=function(a,b,c,d){fd(uo(this),a,b,c,d)};Em.prototype.Xa=function(a){uo(this).dispatchEvent(a)};function vo(a,b,c){Hm.call(this,a,b,c)}B(vo,co);Q("ydn.gdata.base");function wo(a){this.i=a||null;this.g=this.h=null;a&&xo(this,a)}wo.prototype.logger=Q("ydn.crm.UserSetting");
var yo={stores:[{name:"general"},{name:"sugar"}]},zo={stores:[{name:"contact",keyPath:"id.$t",type:"TEXT",indexes:[{name:"updated.$t",type:"TEXT"},{name:"ydn$emails",multiEntry:!0,generator:function(a){var b=[];a=u(a.gd$email)?a.gd$email:x(a.gd$email)?[a.gd$email]:[];for(var c=0;c<a.length;c++){var d=Ln(a[c].address);d&&b.push(d)}return b}},{name:"ydn$externalIds",multiEntry:!0,generator:function(a){return(u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:
[]).map(function(a){return a.value})}}]}]};function xo(a,b){if(!a.i||a.i!=b){r.sessionStorage.setItem("last-user-id",b);var c="setting-"+b,d="gdata-"+b;a.h&&a.h.getName()!=c&&(a.h.close(),a.h=null);a.g&&a.g.getName()!=d&&(a.g.close(),a.g=null);a.h||(a.h=new vo(c,yo));a.g||(a.g=new vo(d,zo))}}function Ao(a){return a.i?a.i+"-sd":r.sessionStorage.getItem("last-user-id")+"-sd"}function Bo(a){var b=Ao(a),c=new C;chrome.storage.local.get(b,function(a){c.D(a[b])});return c}
function Co(a,b){var c=Ao(a),d=new C,e={};e[c]=b;chrome.storage.local.set(e,function(){d.D(!0)})};function Do(a){a.preventDefault();window.open(a.target.href,void 0,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=200, height=100, top="+(screen.height/2-50)+", left="+(screen.width/2-100))}function Eo(){var a=new C;chrome.storage.sync.get("user-setting",function(b){a.D(b["user-setting"])});return a};function Fo(){}Fo.prototype.logger=Q("ydn.crm.Client");function Go(a,b,c){this.h=a;this.i=b;this.g=c}Go.prototype.request=function(a){return this.h(a)?this.i.request(a):this.g.request(a)};function Ho(a,b){this.client=a;this.i=b;this.g=NaN;this.j=[];this.h=!1}Ho.prototype.request=function(a){return new Io(a,this)};function Io(a,b){a.path=b.i+a.path;this.req=b.client.request(a);this.parent=b;this.i=null;this.h=void 0}B(Io,zj);
Io.prototype.execute=function(a,b){if(this.parent.h)this.i=a,this.h=b,this.parent.j.push(this);else{this.parent.h=!0;var c=function(c,d){var g=vj(d,"retry-after");g?(this.parent.g=/[^0-9|\.]/.test(g)?(new Date(g)).getTime():1E3*parseFloat(g)+A(),r.console.info("Next retry "+this.parent.g+", now "+A())):this.parent.g=NaN;a&&a.call(b,c,d);this.parent.h=!1;if(g=this.parent.j.pop())g.execute(g.i,g.h),g.i=null,g.h=null},d=this.parent.g-A();0<d?(r.console.info("Proxy will call after "+d+" ms"),Kf(function(){this.parent.g=
NaN;this.req.execute(c,this)},d,this)):this.req.execute(c,this)}};function Jo(a,b,c,d,e){this.l=t(a)?a:rj();this.g=b;this.h=c;this.i=d||0;this.j=!!e}Jo.prototype.request=function(a){if(this.g){a.headers||(a.headers={});for(var b in this.g)a.headers[b]=this.g[b]}this.h&&(a.path=this.h+a.path);return new zj(a,this.l,this.i,this.j)};function Ko(a,b,c){this.i=t(a)?a:rj();this.g=b;this.h=c}Ko.prototype.request=function(a){if(this.g){a.headers||(a.headers={});for(var b in this.g)a.headers[b]=this.g[b]}this.h&&(a.path=this.h+a.path);return new zj(a,this.i)};function Lo(a){for(var b=wm(a),c=0;c<b.stores.length;c++);b=(b=Tk)||Tk;b=Fm(a,b,!1,void 0,void 0,void 0);this.g=a.Cc(b,a.Ua);this.j=!1;a.Rb(this.C,this);this.h=1E4;this.l=uf.value;this.i=0;this.u=y(this.G,this);this.p=!1;this.o={}}function Mo(a){if(a.h&&a.i>=a.h){var b=a.h/100;100<b&&(b=100);a.g.keys("db-logger",null,b).B(function(a){a=a.map(function(a){return new Ok("db-logger",a)});this.g.remove(a).B(function(){this.g.count("db-logger").B(function(a){this.i=a},this)},this)},a)}}
function No(){var a=Oo;a.h=1E4;Mo(a)}Lo.prototype.C=function(){this.h&&(this.j=!0,this.g.count("db-logger").B(function(a){this.i=a;Mo(this)},this))};function Po(a){var b=Oo;if(a!=b.p){var c=Df();a?xf(c,b.u):(c=c.g)&&Cb(c,b.u);b.p=a}}Lo.prototype.G=function(a){if(this.j){var b=a.h;va(b,"ydn.db.")||this.o[b]||!(b=a.j)||b.value<=this.l||(a={exception:a.g,level:b.value,logger:a.h,name:b.name,time:a.l,message:a.getMessage(),seq:a.o},this.g.put("db-logger",a),this.i++,Mo(this))}};
function Qo(a,b){var c=Oo,d=a||100,e=b||0,f=Ij(["INFO"]);return c.g.values("db-logger","name, time",f,d,e,!0)}var Oo=null;var Ro,So,To=Q("ydn.crm");function Uo(){Ro||(Ro=new wg(0));return Ro}var Vo=null;function Wo(a,b){b&&"local"!=b||(t(a["logging-captureConsole"])&&Fi(!!a["logging-captureConsole"]),t(a["logging-bugReport"])&&Po(!!a["logging-bugReport"]))}
function Xo(){var a;a="Yathit CRM Bridge ydn.crm.version 0.8.9 (dev)";hj("ydn.crm","fine");hj("ydn.crm.inj.App","finest");hj("ydn.ds","fine");r.console.log(a);r.console.log("API documentation: http://dev.yathit.com/\nFeedback and suggestion: https://yathit.uservoice.com/\nBug report: https://github.com/yathit/sugarcrm-gmail-chrome-extension");Vo=new vo("ydn.crm",{stores:[{name:"log",keyPath:"key"},{name:"db-logger",autoIncrement:!0,indexes:[{name:"level"},{name:"time"},{name:"name"},{name:"name, time",
keyPath:["name","time"]}]}]});Oo=new Lo(Vo);No();Oo.l=300;Oo.o["ydn.db.tr.DbOperator"]=!0;Po(!0);To.info("Starting ydn.crm.App:0.8.9");chrome.storage.local.get(["logging-captureConsole","logging-bugReport"],Wo);chrome.storage.onChanged.addListener(Wo);var b=A();yj=ij=new Yo(Vo,function(a){if(!a||a.HttpRequestData&&"https://mail.google.com/mail/feed/atom/bazinga"==a.HttpRequestData.path)return null;a.uptime=b;return a})}
function Zo(a){$o();ap();bp();a=new Bj(a,Ro,!1);qj(a,"gc");qj(new Go(function(a){return"GET"==a.method},a,new Ho(a,"https://yathit-app.appspot.com/proxy/")),"gse")}function $o(){var a=qi(ri);a||(So||(So=new Ko(Uo()),qj(So,"default")),a=new Jo(Uo(),void 0,"https://yathit-app.appspot.com",1,!0),qj(a,ri));return a}function ap(){var a=qi("proxy");a||(a=new Ho($o(),"/proxy/"),qj(a,"proxy"))}
function bp(){var a=qi("auth");a||(a=new Jo(Uo(),void 0,"https://yathit-app.appspot.com/a/cm",0,!0),qj(a,"auth"));return a};function cp(a,b){this.j=b||A();this.type=a;this.i=this.g=this.h=void 0}function dp(a,b){x(b)?a.h=rm(b):a.h=b}cp.prototype.toJSON=function(){return{type:this.type,timestamp:this.j,newValue:this.g,oldValue:this.h,meta:this.i}};function ep(a){this.g=a}ep.prototype.add=function(a){this.g.add("history",a.toJSON())};function fp(a,b){if(a.link){if(u(a.link)){for(var c=0;c<a.link.length;c++)if(a.link[c].rel==b)return a.link[c];return null}return a.link.rel==b?a.link:null}return null};function gp(a,b){this.entry=a;this.data=b;this.g=!1}gp.prototype.data=null;gp.prototype.preventDefault=function(){this.g=!0};function hp(a,b,c,d){H.call(this,a,b);this.status=c;this.entry=d}B(hp,H);hp.prototype.status=NaN;hp.prototype.N=function(){return this.status};hp.prototype.Db=function(){return this.entry.Db()};function ip(a,b,c){hp.call(this,"conflict",a,b,c.entry)}B(ip,hp);function jp(a,b){this.g=a;if(b)throw new qd("optional key paths");}var kp={hi:"key",bi:"date",ii:"modified",di:"expires",ci:"etag",ji:"updated",ki:"uri",NEXT:"next"};jp.prototype.P=function(a,b){return b&&this.g[a]?Qj(b,this.g[a]):void 0};function lp(a,b,c,d){a.g[b]&&Rj(c,a.g[b],d)};function mp(a,b,c,d){this.key=a;this.h=(this.h=d?b[d]:b)||{};this.g=c}function np(a){return null!=a.key?a.key:a.g.P("key",a.h)}mp.prototype.getDate=function(){return this.g.P("date",this.h)};function op(a){return a.g.P("updated",a.h)}function pp(a){return a.g.P("etag",a.h)}function qp(a){var b={},c=pp(a);c&&1<c.length?b["if-none-match"]=c:(a=op(a))&&(b["if-modified-since"]=a);return b}
mp.prototype.toJSON=function(){var a={};lp(this.g,"key",a,np(this));var b=this.getDate();b&&lp(this.g,"date",a,b);(b=this.g.P("expires",this.h))&&lp(this.g,"expires",a,b);(b=op(this))&&lp(this.g,"updated",a,b);(b=pp(this))&&lp(this.g,"etag",a,b);return a};function rp(a,b,c){b.expires&&lp(c,"expires",b,(new Date(b.expires)).getTime());b["last-updated"]&&lp(c,"updated",b,(new Date(b["last-updated"])).getTime());b.etag&&lp(c,"etag",b,(new Date(b.etag)).getTime());lp(c,"date",b,NaN);mp.call(this,a,b,c)}B(rp,mp);function sp(a,b,c){this.g=a;this.o=c||null;this.i=this.h=null;this.key=b}h=sp.prototype;h.logger=Q("ydn.db.sync.entry.Rest");h.Db=function(){if(this.i&&this.g.p&&this.j){var a=this.g.u;this.g.T||delete this.i[a]}return this.i||null};h.P=function(){return this.o};h.H=function(){return this.key};h.ge=function(){return this.g.Te(this.H())};function tp(a,b){var c=a.H();return new rp(c,b.Rc(),a.g.o)}
h.xe=function(a,b){if(a)return a;if(b.Ga())return wj(b);try{return wj(b)}catch(c){var d=uj(b);return x(d)?d:{body:d}}};h.save=function(a){var b=this.H();if(a&&!this.g.p)return A(),up(this.g,[this.j.toJSON()]);var c=this.i;if(a&&!c)return $b();a=void 0;null!=this.j&&(A(),a=[this.j.toJSON()]);return vp(this.g,[c],a,[b])};
h.mc=function(a,b){if(this.g.G&&x(this.h))a.call(b,304),a=null;else{var c=this;wp(this,function(d){if(d){var e=d.g.P("expires",d.h);if(e&&e>A()){P(this.logger,this+" not expired");a.call(b,304);a=null;return}}e=c.ge();d=c.lc(e,"GET",d);this.g.va().request(d).execute(function(d,e){c.j=tp(c,e);c.i=c.xe(d,e);a.call(b,e.N());a=null})},this)}};
h.lc=function(a,b,c,d){a=new si(a,b);if(c){var e;"POST"==a.method||"PUT"==a.method||"DELETE"==a.method?(e={},(b=op(c))&&(e["if-unmodified-since"]=b),(c=pp(c))&&1<c.length&&(e["if-match"]=c),c=e):c=qp(c);e=c;a.headers?Oc(a.headers,e):a.headers=e}a.body=x(d)?JSON.stringify(d):d;P(this.logger,this+" "+a.method+" "+a.path+" "+Th(e));return a};
function xp(a,b,c){wp(a,function(a){var e=this.P();a=this.lc(this.ge(),"PUT",a,e);this.g.va().request(a).execute(function(a,d){this.j=tp(this,d);this.i=a;b&&(b.call(c,d.N()),b=null)},this)},a)}function wp(a,b,c){a.l?b.call(c,a.l):yp(a.g,a.H(),function(d){a.l=d;b.call(c,d)})}
h.load=function(a,b){if(this.h&&this.l)a&&(a.call(b,this.h,this.l),a=void 0);else{var c=this.H();this.g.load(c,function(c,e){this.h=c;var f=this.g.u;this.h&&f&&this.h[f]&&(this.l=new mp(this.key,this.h,this.g.o,f),this.g.T||delete this.h[f]);this.h=c;this.l=e;a&&(a.call(b,c),a=void 0)},this)}};function zp(a,b){var c=a.ge(),d=a.g.va();wp(a,function(a){a=this.lc(c,"DELETE",a);d.request(a).execute(function(a,d){P(this.logger,"deleted "+c+" "+d.N());b.call(this,d.N())},this)},a)}
h.toString=function(){return"sync.entry{"+this.g.I()+":"+this.key+"}"};function Ap(a,b,c){this.storage=a;this.store=b;this.R=b.getName();a="format readRequestTimeout writeRequestTimeout transport Options fetchStrategies baseUri immutable keepMeta metaStoreName metaDataName prefetch prefetchRefractoryPeriod".split(" ");for(var d in c)if(-1==sb(a,d))throw new J('Unknown Sync attribute "'+d+'"  in Sync.');this.G=!!c.immutable;this.h=c.baseUri;this.Hb=c.metaStoreName||this.R;this.u=c.metaDataName;this.p=this.Hb==this.R;a=c.Options||{};if(!this.Hb)throw new J("metadata store name required.");
b=this.Bb();for(d in a)if(-1==sb(b,d))throw new J('Unknown Sync.Options attribute "'+d+'" in Sync.Options');this.ca=a.delimiter||"";this.j=a.prefix||"";this.T=!!c.keepMeta;this.O=c.prefetch||ha(c.prefetchRefractoryPeriod)?"full":null;this.aa=ha(c.prefetchRefractoryPeriod)?c.prefetchRefractoryPeriod:5E3;this.g=Bp(c.transport);this.o=new jp(this.Ab(),c.metaData);this.l=null;this.C=NaN}h=Ap.prototype;h.Ab=function(){var a={},b;for(b in kp)a[b]=b;return a};h.Bb=function(){return[]};h.I=function(){return this.R};
h.logger=Q("ydn.db.sync.Rest");h.Kb=function(){return this.h};h.va=function(){this.g||(this.g=new Ko);return this.g};h.toString=function(){return"sync:"+this.R};function up(a,b){return El(a.storage.g,a.Hb,b).Ic(function(a){throw a;})}function Cp(a,b,c){a.store.keyPath&&null==vl(a.store,b)&&null!=c&&Rj(b,a.store.keyPath,c)}
function vp(a,b,c,d){d=a.store.keyPath?void 0:d;if(c){if(a.p){for(g=0;g<b.length;g++)null!=c[g]&&Oc(b[g],c[g]);return El(a.storage.g,a.R,b,d)}if(b){for(var e=[],f=b.concat(c),g=0;g<b.length;g++){var k=a.store.keyPath?NaN:d[g];e.push(new Ok(a.R,k))}for(g=0;g<c.length;g++)e.push(new Ok(a.Hb,NaN));return El(a.storage.g,e,f)}return El(a.storage.g,a.Hb,c)}for(g=0;g<b.length;g++)k=d?d[g]:void 0,Cp(a,b[g],k);return El(a.storage.g,a.R,b,d)}
function Dp(a,b){var c=[new Ok(a.R,b)];a.p||c.push(new Ok(a.Hb,b));return Fl(a.storage.g,c)}h.Te=function(a){return this.Kb()+a};h.add=function(a,b,c){null!=c?Cp(this,b,c):this.store.keyPath&&(c=vl(this.store,b));var d=this.Aa(c,b),e=this;xp(d,function(a){201==a||200==a?(P(e.logger,d+" created"),d.save(!0)):M(e.logger,"Unexpected respond "+a+" for add "+d)})};
function yp(a,b,c){var d=new Ok(a.Hb,b);Ep(a,[d]).w(function(a){c.call(void 0,new mp(b,a[0],this.o,this.u))},function(a){M(this.logger,this+" error loading meta data "+a);c.call(void 0,null)},a)}h.Sd=function(a,b){var c=a.map(function(a){return new Ok(this.Hb,a)});Ep(this,c).w(function(c){for(var e=[],f=0;f<a.length;f++)e[f]=new mp(a[f],c[f],this.o,this.u);b(e)},function(a){M(this.logger,this+" error loading meta data "+a);b([])},this)};
h.load=function(a,b,c){var d=this.Hb,e=[new Ok(this.I(),a)];this.p||e.push(new Ok(d,a));Ep(this,e).w(function(d){var e=d[0];b.call(c,e,new mp(a,this.p?e:d[1],this.o,this.u))},function(a){M(this.logger,this+" error loading meta data "+a);b.call(c,null,null)},this)};function Ep(a,b){return Il(a.storage.g,b)}
h.get=function(a,b){this.C||this.bc();Bk(a,function(c,d,e){if(d)e(c,d);else{wd(a,c);var f=t(c);if(f&&this.G)e(c);else{var g=this.Aa(b,c);g.mc(function(a){if(304==a){if(e(c),!f)throw new ud(g+" not modified, but not exist in server");}else if(200==a)g.save().ea(function(){e(g.Db())});else if(404==a)Dp(g.g,g.H()).ea(function(){e(g.Db())});else throw e(g.Db()),new td("Invalid HTTP respond "+a+" for GET "+b);},this)}}},this)};
function Fp(a,b,c,d,e,f){var g=[],k=a.logger;N(a.logger,d.length+", "+e.length+", "+f.length+", "+g.length+" records to fetch, update, delete, save");var l=d.length+e.length+f.length+g.length;if(0==l)b(c);else{for(var m=!1,n=function(){l--;0==l&&(b(c,m),b=null)},g=0;g<d.length;g++){var p=a.Aa(d[g]);p.index=g;p.mc(function(a){200==a?(P(k,"A new "+this+" received from server"),this.save().w(function(){c[this.index]=this.Db();n()},function(){m=!0;n()},this)):304==a?this.save(!0).w(function(){P(k,this+
" expires date updated");n()},function(){m=!0;n()},this):(M(k,"Invalid status "+a+" for fetching "+this),n())},p)}for(g=0;g<e.length;g++)p=a.Aa(e[g]),p.index=g,p.load(function(){this.mc(function(a){200==a?(P(k,this+" updated from server"),this.save().w(function(){c[this.index]=this.Db();n()},function(){m=!0;n()},this)):(M(k,"Invalid status "+a+" for fetching "+this),n())})});for(g=0;g<f.length;g++)p=a.Aa(f[g]),p.index=g,Dp(p.g,p.H()).w(function(){c[this.index]=new gp(p,null);n()},function(){m=!0;
n()},p)}}function Gp(a,b,c){Bk(b,function(a,e,f){if(e)f(a,e);else if(xb(a,function(a){return t(a)})&&this.G)f(a);else{wd(b,a);var g=a.length;for(e=0;e<c.length;e++)if(this.G&&t(a[e]))g--,0==g&&f(a);else{var k=this.Aa(c[e],a[e]);k.index=e;k.mc(function(b){200==b?(a[this.index]=this.Db(),this.save()):404==b&&(a[this.index]=void 0);g--;0==g&&f(a)},k)}}},a)}h.Aa=function(a,b){return new sp(this,a,b)};h.count=function(a){return a};h.Ye=function(){throw new qd;};
h.values=function(a,b,c){Hp(this)?(P(this.logger,"prefetch queued"),Bk(a,function(d,e,f){wd(a,d);e?f(d,e):Ip(this,function(a){a?Hl(this.storage.g,this.R,null,null,!1,b,c).w(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(){M(this.logger,this+" prefetch fail");f(d)},this)},this)):this.Ye(a,b,c)};
h.keys=function(a,b,c,d,e,f,g){Bk(a,function(k,l,m){wd(a,k);l?m(k,l):Ip(this,function(a){a?Jl(this.storage.g,this.R,b,c,d,e,f,g).w(function(a){m(a)},function(a){m(a,!0)},this):m(k)},function(){M(this.logger,this+" prefetch fail");m(k)},this)},this)};h.ve=function(){};
h.put=function(a,b,c){c=t(c)?c:this.store.keyPath?vl(this.store,b):null;var d=this.Aa(c,b);U(a,function(){d.load()},this);Bk(a,function(c,f,g){wd(a,c);xp(d,function(c){409==c?d.mc(function(){var c=new gp(d,b);wd(a,c);c.g?g(null,f):g(void 0,f)}):200==c||201==c?(d.save(!0),g(b,f)):(M(this.logger,"Unexpected response for PUT: "+c),g(null,f))},this)},this)};
h.remove=function(a,b){var c=this,d=this.Aa(b);d.load(function(){Bk(a,function(e,f,g){zp(d,function(f){if(409==f){f=new gp(d,null);wd(a,f);var l=new ip(c.storage,409,f);c.storage.Xa(l)}else 200==f?P(c.logger,"Successfully deleted object "+b):(M(c.logger,"Unexpected response for DELETE: "+f+" "+b),wd(a,l));g(e)})})})};
h.bc=function(){P(this.logger,this+" starting prefetch");var a=new C;Hl(this.storage.g,this.R,"updated.$t",null,!0,1).w(function(b){var c={};if(b=b[0])b=Ic(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b;var d=this,c=new si(this.Kb(),"GET",c);d.va().request(c).execute(function(b,c){if(200==c.N()){if(!b){var g=uj(c);v(g)&&(b=JSON.parse(g))}g=(g=(b.feed||b).entry)?u(g)?g:[g]:[];0<g.length?vp(d,g).ea(function(){a.D(!0)}):a.D(!1)}else 302==c.N()?a.D():(g=d+": Invalid response status "+
c.N()+" on prefetching",M(d.logger,g),a.F(Error(g)))})},function(b){a.F(b)},this);return a};function Hp(a){return a.O?a.C?A()-a.C>a.aa:!0:!1}function Ip(a,b,c,d){Hp(a)?a.l?a.l.w(b,c,d):(a.l=a.bc(),a.C=A(),a.l.w(b,c,d),a.l.w(function(a){P(this.logger,"prefetch "+(a?"updated":"no update"));this.l=null},function(a){this.l=null;throw a;},a)):b.call(d,!1)};function Jp(a,b,c){Ap.call(this,a,b,c)}B(Jp,Ap);Jp.prototype.logger=Q("ydn.db.sync.Atom");Jp.prototype.Bb=function(){return Jp.m.Bb.call(this)};Jp.prototype.H=function(a){return a.key};function Kp(a){this.data=a}h=Kp.prototype;h.H=function(){return this.data.id.$t};h.ed=function(){return this.data.title?this.data.title.$t:void 0};h.ce=function(a){return fp(this.data,a)};h.Uh=function(){var a=this.ce("self");return a?a.href:void 0};h.Th=function(){var a=this.ce("http://schemas.google.com/g/2005#batch");return a?a.href:""};h.ra=function(){return this.data.content||null};function Lp(a,b,c){sp.call(this,a,b,c)}B(Lp,sp);Lp.prototype.logger=Q("ydn.db.sync.entry.S3");Lp.prototype.getName=function(){return this.g.j+this.key};Lp.prototype.lc=function(a,b,c,d){b=Lp.m.lc.call(this,a,b,c,d);if("PUT"==b.method||"POST"==b.method){c=fe(new Sd(a)).substr(1);if(1>c.length)throw new td("invalid url "+a);b.headers.Key=c;a=b.headers["Content-Type"]||"application/json";d instanceof File?a=d.type:v(d)&&(a=/<*DOCTYPE html/i.test(d)?"text/html":"text/plain");b.headers.ContentType=a}return b};function Mp(a){this.data=a}B(Mp,Kp);var Np={atom:"http://www.w3.org/2005/Atom",ydn:"http://www.yathit.com/2012/ydn",app:"http://www.w3.org/2007/app",openSearch:"http://a9.com/-/spec/opensearch/1.1/",gAcl:"http://schemas.google.com/acl/2007",sites:"http://schemas.google.com/sites/2008",gs:"http://schemas.google.com/spreadsheets/2006",dc:"http://purl.org/dc/terms",batch:"http://schemas.google.com/gdata/batch",gd:"http://schemas.google.com/g/2005",gContact:"http://schemas.google.com/contact/2008",thr:"http://purl.org/syndication/thread/1.0",
xhtml:"http://www.w3.org/1999/xhtml"};function Op(a,b){for(var c=a.indexOf(" "),d=0;d<b.length;d++){var e=b[d],e=(0==d?"xmlns":"xmlns:"+e)+'="'+Np[e]+'"';-1==a.indexOf(e)&&(a=a.substring(0,c+1)+e+" "+a.substr(c+1))}return a}Q("ydn.xml");function Pp(a){return Np[a]||Np.xhtml};function Qp(a,b,c){c=!!c;if(a.getName()!=b.getName())return!1;var d=Rp(a),e=Rp(b);if(!c&&d.length!=e.length||c&&e.length>d.length)return!1;for(d=0;d<e.length;d++)if(a.getAttribute(e[d])!=b.getAttribute(e[d]))return!1;d=Sp(a);e=Sp(b);if(!c&&d.length!=e.length||c&&e.length>d.length)return!1;if(0==d.length||0==d.length)return a.data.$t===b.data.$t;for(d=0;d<e.length;d++){var f=Tp(a,e[d]),g=Tp(b,e[d]);if(!c&&f.length!=g.length||c&&g.length>f.length)return!1;for(var k=0;k<g.length;k++)if(-1==zb(f,function(a){return Qp(a,
g[k],c)}))return!1}return!0};function Up(a,b,c){if(t(b))Vp(this,b),t(c)||(c=a[b]);else for(var d in a)if(a.hasOwnProperty(d)&&x(a[d])&&v(a[d].xmlns)){this.jd=[d].xmlns;Vp(this,d);c=a[d];break}this.data=c;this.parent=a}h=Up.prototype;h.jd="http://www.w3.org/2005/Atom";function Vp(a,b){var c=b.split(":");1<c.length&&(a.jd=Pp(c[0])||Up.prototype.jd,b=c[1]);a.tagName=b}
h.n=function(a,b){var c;c=a;var d=b,e=c;if(t(d))"atom"!=d&&(e=d+"$"+c);else{var f=c.split(":"),e=c.replace(/:/,"$");2==f.length&&(d=f[0],c=f[1])}d=t(d)?Pp(d):void 0;c=t(this.data[c])&&t(d)&&this.data[c].xmlns==d?c:e;return u(this.data[c])?new Up(this.data,c,this.data[c][0]):x(this.data[c])?new Up(this.data,c,this.data[c]):null};h.toString=function(){return"JsonElement:"+this.tagName};h.getName=function(){return this.tagName};
function Wp(a,b){for(var c in a.data)a.data.hasOwnProperty(c)&&x(a.data[c])&&delete a.data[c];a.data.$t=b}h.getAttribute=function(a){a=a.replace(/:/,"$");return this.data[a]};h.setAttribute=function(a,b){a=a.replace(/:/,"$");this.data[a]=b};h.removeAttribute=function(a){a=a.replace(/:/,"$");delete this.data[a]};function Rp(a){var b=[],c;for(c in a.data)a.data.hasOwnProperty(c)&&v(a.data[c])&&"$t"!=c&&b.push(c);return b}
function Tp(a,b){t(void 0)?b="undefined$"+b:t(b)&&(b=b.replace(/:/,"$"));var c=[];if(t(b)){var d=a.data[b];if(u(d))for(var e=0;e<d.length;e++)c.push(new Up(a.data,b,d[e]));else x(d)&&c.push(new Up(a.data,b,d))}else for(d in a.data)if(u(a.data[d]))for(e=0;e<a.data[d].length;e++)c.push(new Up(a.data,d,a.data[d][e]));else x(a.data[d])&&c.push(new Up(a.data,d,a.data[d]));return c}function Sp(a){var b=[],c;for(c in a.data)x(a.data[c])&&b.push(c.replace("$",":"));return b}
h.appendChild=function(a){var b=a.getName();this.data[b]?(u(this.data[b])||(this.data[b]=[this.data[b]]),this.data[b].push(rm(a.data))):this.data[b]=rm(a.data)};h.removeChild=function(a){if(a.parent!=this.data)throw Error("NOT_FOUND_ERR: JSON:DOM Exception 8: "+a+" not in "+this);var b=a.getName();u(this.data[b])?Cb(this.data[b],a.data):delete this.data[b]};
h.update=function(a,b,c,d,e){var f=!1;c=c||{};var g=t(b),k=!0===b||!g,l=!1===b,m=Rp(this),n=Rp(a);if(!g)for(var p=0;p<m.length;p++)t(e)&&!e[m[p].replace("$",":")]||Ab(n,m[p])||(this.removeAttribute(m[p]),f=!0);for(p=0;p<n.length;p++){var q=a.getAttribute(n[p]);if(!t(e)||e[n[p].replace("$",":")])Ab(m,n[p])?l||q==this.getAttribute(n[p])||(this.setAttribute(n[p],q),f=!0):(this.setAttribute(n[p],q),f=!0)}if(0==Xp(a)&&k&&(e=this.data.$t,l=a.data.$t,t(l)&&e!=l))return Wp(this,l),!0;if(!g)for(var s in this.data)d&&
!d[s.replace("$",":")]||!x(this.data[s])||x(a.data[s])||(delete this.data[s],f=!0);s=Sp(a);for(e=0;e<s.length;e++)if(l=s[e],!d||!0==d[l]){var w=Tp(a,l),m=Tp(this,l),z=l.replace(":","$");if(1==w.length)0==m.length?(this.data[z]=rm(w[0].data),f=!0):1==m.length?c[l]?k&&!Qp(m[0],w[0],!0)&&(u(this.data[z])||(this.data[z]=[this.data[z]]),this.data[z].push(rm(w[0].data)),f=!0):f=m[0].update(w[0],b)||f:g?(l=zb(m,function(a){return Qp(a,w[0],!0)}),-1==l&&k&&(this.data[z].push(rm(w[0].data)),f=!0)):(this.data[z]=
rm(w[0].data),f=!0);else if(!u(this.data[z]))if(k)this.data[z]=rm(a.data[z]),f=!0;else{if(g){var m=rm(a.data[z]),F=this,l=zb(m,function(a){return $l(F.data[z],a)});-1==l&&(m.push(this.data[z]),this.data[z]=m,f=!0)}}else if(k)for(m.length>w.length&&(this.data[z].splice(w.length,m.length-w.length),f=!0),p=0;p<w.length;p++)t(m[p])?$l(m[p].data,w[p].data)||(this.data[z][p]=rm(w[p].data),f=!0):(this.data[z][p]=rm(w[p].data),f=!0);else if(g)for(p=0;p<a.data[z].length;p++)l=zb(this.data[z],function(b){return $l(a.data[z][p],
b)}),-1==l&&(this.data[z].push(rm(a.data[z][p])),f=!0)}return f};h.Ze=function(a,b,c,d,e){t(b)||(b=!1);return this.update(a,b,c,d,e)};h.toJSON=function(){return{data:this.data,tagName:this.tagName}};
function Yp(a){function b(a,g){d(g,a);var k,l;for(l in a)if(a.hasOwnProperty(l)&&!v(a[l]))if(v(a[l].$t)&&"xhtml"==a[l].type){k=c(l);d(k,a[l]);var m=Xh(a[l].$t);e.importNode(m.documentElement,!0);k.appendChild(m.documentElement);g.appendChild(k)}else if(v(a[l].$t))k=c(l),k.textContent=a[l].$t,d(k,a[l]),g.appendChild(k);else if(u(a[l])&&a[l][0]&&v(a[l][0].$t))for(m=0;m<a[l].length;m++)k=c(l),k.textContent=a[l][m].$t,d(k,a[l][m]),g.appendChild(k);else if(u(a[l]))for(m=0;m<a[l].length;m++)k=c(l),g.appendChild(k),
b(a[l][m],k);else x(a[l])&&(k=c(l),g.appendChild(k),b(a[l],k))}function c(a){return e.createElement(a.replace("$",":"))}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&"$t"!=c&&v(b[c])&&a.setAttribute(c.replace("$",":"),b[c])}var e=Vh(a.getName(),a.jd);b(a.data,e.documentElement);return Yh(e.documentElement)}
function Xp(a){function b(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(u(a[c])?b+=a[c].length:x(a[c])&&b++);return b}var c;t(void 0)?c="undefined$"+c:t(c)&&(c=c.replace(/:/,"$"));return t(c)?u(a.data[c])?a.data[c].length:x(a.data[c])?b(a.data[c]):0:b(a.data)}h.ha=function(a){var b={};if(t(a))for(var c in this.data){var d=c.replace("$",":");v(this.data[c])?b[c]=this.data[c]:!0==a[d]&&(b[c]=rm(this.data[c]))}else b=rm(this.data);return new Up(null,this.tagName,b)};
function Zp(a,b){var c=b.ownerDocument.createElementNS(a.jd,a.getName()),d;for(d in a.data)if(a.data.hasOwnProperty(d)){var e=d.replace("$",":");if(v(a.data[d]))"$t"==d?c.textContent=a.data[d]:(e=c.ownerDocument.createAttribute(e),e.nodeValue=a.data[d],c.setAttributeNode(e));else if(u(a.data[d]))for(var f=0;f<a.data[d].length;f++){var g=new Up(a.data[d],e,a.data[d][f]);Zp(g,c)}else x(a.data[d])&&(g=new Up(a.data,e,a.data[d]),Zp(g,c))}return b.appendChild(c)};function $p(a){var b;if(t(a.id))b=a.id.$t;else if(t(a.batch$id))b=a.batch$id.$t;else if(t(a.g))b=a.g.$t;else throw new Zh("id or batch:id required.");this.id=b;this.h=void 0;this.data=a}B($p,Mp);h=$p.prototype;h.logger=Q("ydn.gdata.Entry");h.pf=function(){return this.kind};h.ed=Kp.prototype.ed;h.H=function(){return this.id};function aq(a){return a.id.match(/\w+$/)[0]}h.sc=["link","category"];h.$f=["id","batch$id","link","category"];h.ra=Kp.prototype.ra;
function bq(a,b){if(b)a.data.status=""==b?void 0:b;else{var c=a.data;c.status&&(c.status=b)}}function cq(a){return t(a.gd$deleted)?"gd:deleted":(a=a.status)?a:""}function dq(a){return"gd:deleted"==cq(a.data)}h.setTitle=function(){throw new ai;};
h.Kc=function(){if(!eq(this.data))throw Error("nothing to commit");var a=new C;fq(this,function(b,c){if(c.Ga())a.D(b);else{var d=uj(c);if(v(d)&&/html/.test(vj(c,"content-type")))try{var e=(new DOMParser).parseFromString(d,"text/html");e.body&&(d=e.body.innerHTML)}catch(f){}a.F(c.N()+" "+c.Ma()+" "+d)}},this);return a};
function fq(a,b,c){var d=qi("gse");if(eq(a.data)){var e={"Content-Type":"application/atom+xml"};a.g&&(e["GData-Version"]=a.g);var f={},g="POST",k,l,m;m="full";t(l)||(l="base"!=m);var n=a.kind||"contact";k=k?"/"+k:"";k=(l?"https":"http")+"://www.google.com/m8/feeds/"+n+"s/"+a.user_id.replace("@","%40")+"/"+m+k;k=k.replace("%40","@");if(l=(l=a.ce("edit"))?l.href:void 0)g="delete"==cq(a.data)?"DELETE":"PUT",k=l;try{var p=gq(a)}catch(q){jj({"class":"ydn.gdata.Entry",method:"ydn.gdata.Entry.commit","entry.data":a.data,
context:"toXmlString",error:{name:q.name,message:q.message,stack:q.stack}})}l=a.type;m=["atom","app","gd","batch","ydn"];if("sites"==l||"site"==l||"content"==l||"webpage"==l)m=m.concat("xhtml","sites");else if("m8"==l||"contact"==l)m=m.concat("gContact");p=Op(p,m);$p.g&&(a.h=[k,f,g,e,p]);d.request(new si(k,g,f,e,p)).execute(b,c)}else N(a.logger,a+" commit ignore since not modified."),b&&b.call(c,null,null)}function eq(a){if(null==a.id)return!0;a=cq(a);return"modified"===a||"delete"===a}h.we=function(){return this.data};
function gq(a){var b=new Up(null,"entry",a.we()),c=!1;b.xmlns||(b.xmlns="http://www.w3.org/2005/Atom",c=!0);var d=["atom"],e;for(e in a.data)if(a=e.match(/^(\w+)\$\w+/))a=a[1],a in Np&&(Ab(d,a)||d.push(a));e=Yp(b);c&&delete b.xmlns;return Op(e,d)}h.update=function(a){var b=["batch$status","batch$operation","status"],c;for(c in a.data)a.data.hasOwnProperty(c)&&x(a.data[c])&&!Ab(b,c)&&!Ab(this.$f,c)&&(this.data[c]=a.data[c])};h.$e=function(a,b){if($l(this.data[a],b))return!1;this.data[a]=rm(b);return!0};
h.Ze=function(a){if(a.data.updated.$t>=this.data.updated.$t&&dq(a)){if(dq(this)||"delete"==cq(this.data))return!1;bq(this,"delete");return!0}var b=!1,c;for(c in a.data)a.data.hasOwnProperty(c)&&x(a.data[c])&&!Ab(this.$f,c)&&this.$e(c,a.data[c])&&(b=!0);b&&(a=cq(this.data),"delete"==a?M(this.logger,this+" marked for deletion. Cannot mark modify flag."):"committed"==a?this.logger.log(of,this+" already committed. All changes must wait until updated from the server.",void 0):bq(this,"modified"));return b};function hq(a,b,c){sp.call(this,a,b,c)}B(hq,sp);hq.prototype.ge=function(){return this.key};hq.prototype.lc=function(a,b,c,d){a=hq.m.lc.call(this,a,b,c,d);this.g.qg(a.method)&&r.gapi&&r.gapi.auth&&(b=gapi.auth.getToken())&&b.access_token&&(a.headers.Authorization=b.token_type+" "+b.access_token);if("GET"==a.method)a.params.alt="json";else if("PUT"==a.method||"POST"==a.method)d=new $p(d),a.body=gq(d),a.headers["Content-Type"]="application/atom+xml";return a};
hq.prototype.xe=function(a,b){a=hq.m.xe.call(this,a,b);a.feed&&(a=a.feed);a.entry&&(a=a.entry);return a};function iq(a,b,c){Ap.call(this,a,b,c);a=c.Options;this.kind=a.kind;this.version=a.version;this.projection=a.projection;this.i=a.maxResults}B(iq,Jp);h=iq.prototype;h.projection=null;h.version=null;h.logger=Q("ydn.db.sync.GData");h.Aa=function(a,b){return new hq(this,a,b)};h.Ab=function(){var a=iq.m.Ab.call(this);a.key=["id","$t"];a.etag="gd$etag";a.updated=["updated","$t"];return a};h.Bb=function(){var a=iq.m.Bb.call(this);return a=a.concat(["version","projection","kind","maxResults"])};
h.Kb=function(){return"https://www.googleapis.com/"+this.kind+"/"};h.qg=function(){return!1};h.H=function(a){return a?a.id?a.id.$t:"":""};
function jq(a,b,c){var d=c||a.Kb();c&&P(a.logger,"continuing "+c);b=new si(d,"GET",b);var e=new C;a.va().request(b).execute(function(b,d){if(200==d.N()){if(!b){var k=uj(d);v(k)&&(b=JSON.parse(k))}var k=b.feed||b,l=k.entry,l=l?u(l)?l:[l]:[];0<l.length&&vp(a,l);for(var l=null,k=k.link,k=u(k)?k:[k],m=0;m<k.length;m++)"next"==k[m].rel&&(l=k[m].href);l?Ub(jq(a,{},l),e):(P(a.logger,"prefetch "+a.R+" done"),e.D(!!c))}else 302==d.N()?e.D():(k=a+": Invalid response status "+d.N()+" on prefetching",M(a.logger,
k),e.F(Error(k)))});return e}h.bc=function(){P(this.logger,"starting prefetch");var a=new C;Hl(this.storage.g,this.R,"updated.$t",null,!0,1).B(function(b){var c={alt:"json",kind:this.kind};this.i&&(c["max-results"]=this.i);(b=b[0])?(b=Ic(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b,P(this.logger,this.R+" fetching entries later then "+b)):P(this.logger,this.R+" fetching entries from beginning");Ub(jq(this,c),a)},this);return a};
h.count=function(a){var b=jk(this.store,"updated.$t");if(!b)return a;var c=zk(a);a.w(function(a){wd(c,a);Hl(this.storage.g,this.R,b.getName(),null,!1,1).w(function(b){var f={alt:"json"};if(b=u(b)?b[0]:b)b=Ic(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),f["updated-min"]=b;var g=this,f=new si(this.Kb(),"GET",f);this.va().request(f).execute(function(b,e){if(200==e.N()){if(!b){var f=uj(e);v(f)&&(b=JSON.parse(f))}f=Ic(b.feed,"openSearch$totalResults");c.D(a+parseFloat(f||0))}else M(g.logger,
g+":Unexpected respond status "+e.N())})},function(a){c.F(a)},this)},function(a){c.F(a)},this);return c};function kq(a,b,c){sp.call(this,a,b,c)}B(kq,hq);function lq(a,b,c){iq.call(this,a,b,c);this.h=this.h.substr(27);this.Ub=c.Options.prefix}B(lq,iq);lq.prototype.va=function(){this.g||(this.g=new mq(gapi.client));return this.g};lq.prototype.Aa=function(a,b){return new kq(this,a,b)};lq.prototype.Kb=function(){return this.h+this.Ub};
lq.prototype.bc=function(){P(this.logger,"starting prefetch");var a=new C;Hl(this.storage.g,this.R,"updated",null,!0,1).w(function(b){var c={alt:"json"};if(b=b[0])b=Ic(b,"updated"),b=(new Date(1+ +new Date(b))).toISOString(),c.updatedMin=b;var d=this,c=new si(this.Kb(),"GET",c);d.va().request(c).execute(function(b,c){if(b){var g=b.items||[];0<g.length?vp(d,g).ea(function(){a.D(!0)}):a.D(!1)}else 302==c.N()?a.D():(g=d+": Invalid response status "+c.N()+" on prefetching",M(d.logger,g),a.F(Error(g)))})},
function(b){a.F(b)},this);return a};function nq(a,b){if(!t(r.AWS))throw new td("AWS JS SDK not loaded");this.h=a;this.i=b;this.g=null}nq.prototype.request=function(a){return new oq(this,a)};function pq(a){var b={params:{Bucket:a.h,region:a.i}};if(!a.h)throw new J("bucket name required");a.g||(a.g=new AWS.S3(b));return a.g}function oq(a,b){this.parent=a;this.g=b}
function qq(a,b,c,d,e){var f=NaN,g="",k={};a=pq(a.parent)[b](c);a.on("complete",function(a){a.httpResponse&&(f=a.httpResponse.statusCode,v(f)&&(f=parseInt(f,10)),k=a.httpResponse.headers);a.error&&(g=a.error.message,f||(f=400))});a.send(function(a,b){var c=new sj(f,b,k,g);a?d.call(e,null,c):d.call(e,b,c)})}
oq.prototype.execute=function(a,b){var c=fe(new Sd(this.g.path)),c="/"==c.charAt(0)?c.substr(1):c,d=this.g.headers||{};c&&(d.Key=c);if(c)if("GET"==this.g.method)qq(this,"getObject",d,a,b);else if("PUT"==this.g.method)qq(this,"putObject",d,a,b);else throw new qd("HTTP method "+this.g.method);};function rq(a,b){this.g=a;this.prefix=sq(this,"Prefix")[0];this.h=b.type}rq.prototype.fa=function(){return this.g.documentElement.getElementsByTagName("Contents").length};rq.prototype.keys=function(){var a=sq(this,"Key");if(this.prefix){var b=this.prefix.length,a=a.map(function(a){return a.substr(b)});"INTEGER"==this.h?a=a.map(function(a){return parseInt(a,10)}):"NUMERIC"==this.h&&(a=a.map(function(a){return parseFloat(a)}))}return a};
function sq(a,b){for(var c=[],d=a.g.documentElement.getElementsByTagName(b),e=d.length,f=0;f<e;f++)c[f]=d[f].textContent;return c}function tq(a){return sq(a,"LastModified").map(function(a){return(new Date(Date.parse(a))).toGMTString()})}
function uq(a){var b=a.g.documentElement.getElementsByTagName("NextMarker");return 1==b.length?b[0].textContent:"true"==a.g.documentElement.getElementsByTagName("IsTruncated")[0].textContent&&(a=a.g.documentElement.firstElementChild.lastElementChild)&&"Contents"==a.tagName?a.getElementsByTagName("Key")[0]:null};function vq(a,b,c){Ap.call(this,a,b,c);this.i=c.Options.bucket;if(!v(this.i)||ya(this.i))throw new J("bucket name required.");this.h||(this.h="https://"+this.i+".s3.amazonaws.com/");if(!0===b.h)throw new J('S3 object store "'+b.getName()+'" must not set autoIncrement to true.');}B(vq,Ap);h=vq.prototype;h.logger=Q("ydn.db.sync.S3");h.Bb=function(){var a=vq.m.Bb.call(this);return a=a.concat(["bucket","maxKeys","prefix","delimiter"])};h.va=function(){this.g||(this.g=new nq(this.i));return this.g};
h.Te=function(a){return this.h+this.j+a};h.Aa=function(a,b){return new Lp(this,a,b)};
h.Ye=function(a,b){var c=this;Bk(a,function(d,e,f){wd(a,d);c.Sd(d,function(a){var e={},l=a[0]?np(a[0]):null;null!=l&&(e.marker=l);0<c.j.length&&(e.prefix=c.j);0<b&&(e["max-keys"]=b);P(c.logger,c+" querying for newer entries starting from "+l);e=new si(c.h,"GET",e);c.va().request(e).execute(function(b,e){if(200==e.N()){for(var k=uj(e),k=k instanceof Document?k:Xh(k),l=new rq(k,c.store),k=l.keys(),l=tq(l),s=[],w=[],z=[],F=0,D=0;F<=a.length&&D<k.length;){var I=a[F]?np(a[F]):null,O=k[D];if(F==a.length)w.push(O),
D++;else{var sa=I?Oj(I,O):-1;0==sa?((O=op(a[F]))&&l[D]&&O!=l[D]&&(l[D]>O?z.push(I):M(c.logger,'record "'+I+'" in database is more recent than server '+O+" vs "+l[D])),F++,D++):1==sa?(s.push(I),F++):(w.push(O),D++)}}Fp(c,f,d,w,z,s)}else M(c.logger,"Invalid response status "+e.N())})})},this)};
function wq(a,b){function c(f){null!=f&&(d.marker=f);P(a.logger,a+" querying for newer entries starting from "+f);e.request(new si(a.h,"GET",d)).execute(function(d,e){if(200==e.N()){var f=uj(e),f=f instanceof Document?f:Xh(f),f=new rq(f,a.store),m=uq(f),f=f.keys(),n=f.length;if(0==n)b([]),b=null;else for(var p=0,q=0;q<n;q++)a.Aa(f[q]).mc(function(){p++;p==n&&(m?c(m):b&&(b([this.Db()]),b=null))})}else M(a.logger,"Invalid response status "+e.N())})}var d={};0<a.j.length&&(d.prefix=a.j);var e=a.va();
c();a.V=!0}function xq(a,b){a.V||Bk(b,function(a,b,e){t(a[0])?e(a):wq(this,e)},a)};function yq(a,b,c){sp.call(this,a,b,c)}B(yq,Lp);yq.prototype.logger=Q("ydn.db.sync.entry.Gcs");function zq(a,b,c){vq.call(this,a,b,c);this.h="https://"+this.i+".storage.googleapis.com/"}B(zq,vq);zq.prototype.logger=Q("ydn.db.sync.Gcs");zq.prototype.va=function(){this.g||(this.g=new Ko);return this.g};zq.prototype.Aa=function(a,b){return new yq(this,a,b)};function mq(a,b){this.h=a;this.g=!!b}mq.prototype.request=function(a){var b={path:a.path,method:a.method,headers:a.headers,params:a.params,body:a.body};this.g&&(b.callback=function(a,e){c.D(a,e);b.callback=null});a=this.h.request(b);var c=new Aq(a);return c};function Aq(a){this.h=a||null}Aq.prototype.D=function(a,b){this.i&&(this.i(a,xj(b)),this.i=null);this.g={json:a,Fc:b}};
Aq.prototype.execute=function(a){this.h?(this.h.execute(function(b,c){a(b,xj(c))}),this.h=null):this.g?(a(this.g.json,xj(this.g.Fc)),this.g=null):this.i=a};function Bp(a){if(a){if(a instanceof Ko)return a;if(ia(a))return new mq({request:function(b){a(b)}},!0);if("request"in a)return new mq(a);throw new J(a+" is not a valid HTTP Client");}return null};function Bq(a,b,c){sp.call(this,a,b,c)}B(Bq,yq);Bq.prototype.logger=Q("ydn.db.sync.entry.GcsJson");Bq.prototype.mc=function(a){var b=this.g,c=this;wp(this,function(d){var e={method:"GET",path:"storage/v1beta2/b/"+b.i+"/o/"+encodeURIComponent(c.getName())};d&&(e.headers=qp(d));gapi.client.request(e).execute(function(d,e){var k=xj(e);c.j=new rp(c.H(),k.Rc(),b.o);d?(P(c.logger,c+": readServer updated"),c.i=d):(P(c.logger,c+": readServer request fail "+e),c.j=null,c.i=null);a.call(c,200)},e)})};function Cq(a,b,c){zq.call(this,a,b,c)}B(Cq,zq);h=Cq.prototype;h.logger=Q("ydn.db.sync.GcsJson");h.Ab=function(){var a=Cq.m.Ab.call(this);a.key="name";return a};h.va=function(){if(!this.g)if(t(r.gapi))this.g=new mq(gapi.client);else throw new td("gapi not loaded");return Cq.m.va.call(this)};h.Aa=function(a,b){return new Bq(this,a,b)};
h.bc=function(){N(this.logger,"starting prefetch");var a=new C;Jl(this.storage.g,this.R,null,null,1,0,!0,!1).w(function(b){var c={bucket:this.i};(b=b[0])&&(c.marker=b);var d=this;if(!r.Mg||r.Mg.client)throw Error("gapi lib not loaded");gapi.client.load("storage","v1beta2",function(){var b=gapi.client.storage.objects.list({bucket:d.i});this.Ub&&(c.prefix=this.Ub);b.execute(function(b,c){if(b&&!b.error){var e=b.items||[];0<e.length?vp(d,null,e).ea(function(){a.D(!0)}):a.D(!1)}else e=d+": "+c,M(d.logger,
e),a.F(Error(e))})})},function(b){a.F(b)},this);return a};function Dq(a,b,c){zq.call(this,a,b,c);this.O="full"}B(Dq,zq);h=Dq.prototype;h.logger=Q("ydn.db.sync.GcsMeta");h.Ab=function(){var a=Dq.m.Ab.call(this);a.key="name";return a};h.va=function(){!this.g&&gapi&&(this.g=new mq(gapi.client));return Dq.m.va.call(this)};h.Aa=function(a,b){return new Bq(this,a,b)};
h.bc=function(){N(this.logger,"starting prefetch");var a=new C;if(!r.gapi||!r.gapi.client)throw Error("gapi lib not loaded");var b=this;gapi.client.load("storage","v1beta2",function(){function c(e){e&&(d.pageToken=e);gapi.client.storage.objects.list(d).execute(function(e,g){if(e&&!e.error){var k=e.items||[];if(e.nextPageToken)P(b.logger,"receiving "+k.length+" meta records, continuing next"),vp(b,k),c(e.nextPageToken);else if(0<k.length)vp(b,k).ea(function(){P(b.logger,"receiving "+k.length+" meta records, prefetching dane.");
a.D(!0)});else{var l=!!d.pageToken;P(b.logger,"prefetching done");a.D(l)}}else l=b+": "+g,M(b.logger,l),a.F(Error(l))})}var d={bucket:b.i};this.Ub&&(d.prefix=this.Ub);c()});return a};h.Sd=function(a,b){if(0==a.length)b([]);else{var c=this.I(),d=vb(a,function(a){return new Ok(c,a)});Ep(this,d).w(function(d){for(var f=[],g=0;g<a.length;g++)f[g]=new mp(a[g],d[g],this.o,c);b(f)},function(a){M(this.logger,this+" error loading meta data "+a);b([])},this)}};function Eq(a,b,c){Ap.call(this,a,b,c)}B(Eq,Ap);Eq.prototype.Te=function(a){return this.h+this.j+this.R+this.ca+a};Eq.prototype.logger=Q("ydn.db.sync.Json");
Eq.prototype.Ye=function(a){function b(a,b){var c=new si(e);d.va().request(c).execute(function(c){if(200==c.status){var e=(c.response instanceof Object?c.response:Sh(c.responseText)).items;c=vb(e,function(a){return a.id});for(var e=vb(e,function(a){return a.updated}),k=[],p=[],q=[],s=0,w=0;s<=a.length&&w<c.length;){var z=np(a[s]),F=c[w];if(s==a.length)p.push(F),w++;else{var D=Oj(z,F);0==D?((F=op(a[s]))&&e[w]&&F!=e[w]&&(new Date(e[w])>F?q.push(z):M(d.logger,'record "'+z+'" in database is more recent than server '+
F+" vs "+e[w])),s++,w++):1==D?(k.push(z),s++):(p.push(F),w++)}}Fp(d,function(){},b,p,q,k)}else M(d.logger,"Invalid response status "+c.status)})}var c=new vd,d=this,e=this.h+this.j+this.R;a.B(function(a){wd(c,a);this.Sd(a,function(c){b(c,a)})},this)};function Fq(a,b,c){Ap.call(this,a,b,c)}B(Fq,Jp);function Gq(a,b,c){sp.call(this,a,b,c)}B(Gq,Lp);Gq.prototype.logger=Q("ydn.db.sync.entry.S3Meta");function Hq(a,b,c){vq.call(this,a,b,c);this.Ub=c.Options.prefix;if("Key"!=b.keyPath)throw new J('s3-meta store "'+b.getName()+'" must use inline key with keyPath "Key"');this.O="meta"}B(Hq,vq);h=Hq.prototype;h.logger=Q("ydn.db.sync.S3Meta");h.Ab=function(){var a=Hq.m.Ab.call(this);a.key="Key";a.modified="LastModified";a.etag="ETag";return a};h.Aa=function(a,b){return new Gq(this,a,b)};
h.bc=function(){function a(f){f&&(e.marker=f);c.listObjects(e).send(function(c,f){if(c){var l=d+": "+Th(c);M(d.logger,l);b.F(c instanceof Error?c:Error(l))}else{var m=f.Contents||[];f.IsTruncated?(P(d.logger,"receiving "+m.length+" meta records, continuing next"),vp(d,m),a(m[m.length-1].Key+"\uffff")):0<m.length?vp(d,m).ea(function(){P(d.logger,"receiving "+m.length+" meta records, prefetching dane.");b.D(!0)}):(l=!!e.marker,P(d.logger,"prefetching done"),b.D(l))}})}N(this.logger,"starting prefetch");
var b=new C,c=pq(this.va()),d=this,e={};this.Ub&&(e.prefix=this.Ub);a();return b};h.Sd=function(){throw new td("loading meta data should not be necessary");};function Iq(a,b,c){sp.call(this,a,b,c)}B(Iq,hq);function Jq(a,b,c){iq.call(this,a,b,c);a=c.Options;this.domain=a.domain;this.V=a.siteName;if(a=kk(b,"sites$parent"))am(a,function(a){for(var b=a.link||[],c=0;c<b.length;c++)if("http://schemas.google.com/sites/2008#parent"==b[c].rel)return b[c].href;return a.id.$t.replace(/\w+$/,"0")}),zf(this.logger,"index sites$parent in "+b.getName()+" has set a generator.");if(a=kk(b,"alternate"))am(a,function(a){a=a.link||[];for(var b=0;b<a.length;b++)if("alternate"==a[b].rel)return a[b].href}),zf(this.logger,
"index alternate in "+b.getName()+" has set a generator.")}B(Jq,iq);h=Jq.prototype;h.Aa=function(a,b){return new Iq(this,a,b)};h.Bb=function(){var a=Jq.m.Bb.call(this);return a=a.concat(["domain","siteName"])};h.Kb=function(){return"https://sites.google.com/feeds/content/"+this.domain+"/"+this.V+"/"};h.qg=function(a){return"GET"!=a};
function Kq(a,b,c,d){var e={alt:"json",kind:a.kind};"sites$parent"==c?(c=d.match(/\w+$/)[0],e.parent=c):"alternate"==c&&(c=d.replace(/https:\/\/sites.google.com\/a\/[^\/]+\/[^\/]+/,""),e.path=c);var f={},g=a.Kb();Bk(b,function(c,l,m){wd(b,c);if(l=c[0])l=Ic(l,"updated","$t"),l=(new Date(1+ +new Date(l))).toISOString(),e["updated-min"]=l;l=new si(g,"GET",e,f);a.va().request(l).execute(function(b,e){if(200==e.N()){if(!b){var f=uj(e);v(f)&&(b=JSON.parse(f))}var g=(f=(b.feed||b).entry)?u(f)?f:[f]:[];0<
g.length?vp(a,g).ea(function(){m(g)}):m(c)}else 302==e.N()?m(c):(f=a+": Invalid response status "+e.N()+" for querying pageName: "+d,M(a.logger,f),m(Error(f),!0))})},a)}h.ve=function(a,b,c){if(Hp(this))Bk(a,function(d,e,f){wd(a,d);Ip(this,function(a){!0===a?Hl(this.storage.g,this.R,b,S.only(c),!1,0).w(function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(a){f(a,!0)},this)},this);else return"alternate"==b||"alternate"==b?Kq(this,a,b,c):Jq.m.ve.call(this,a,b,c)};hl.prototype.g=null;
Hm.prototype.Cf=function(a,b){var c=b.format;if("gdata-sites"==c)a.g=new Jq(this,a,b);else if("gdata"==c)a.g=new iq(this,a,b);else if("gdata-json"==c)a.g=new lq(this,a,b);else if("odata"==c)a.g=new Fq(this,a,b);else if("s3"==c)a.g=new vq(this,a,b);else if("s3-meta"==c)a.g=new Hq(this,a,b);else if("gcs"==c)a.g=new zq(this,a,b);else if("gcs-json"==c)a.g=new Cq(this,a,b);else if("gcs-meta"==c)a.g=new Dq(this,a,b);else if("atom"==c)a.g=new Jp(this,a,b);else if("json"==c)a.g=new Eq(this,a,b);else if("rest"==
c)a.g=new Ap(this,a,b);else throw new qd("Sync format: "+c);jm(a,function(b,c){var f=b.Bd();if(!(this instanceof fl)||this.Ua)if(!window.navigator||!t(window.navigator.onLine)||window.navigator.onLine)if("add"==f)f=c[1],a.g.add(b,f);else if("count"==f)c[1]||c[2]||a.g.count(b);else if("put"==f){var f=c[1],g=c[2];a.g.put(b,f,g)}else if("rm:iter"==f)g=c[1],a.g.remove(b,g);else if("values:iter:index"==f){var f=c[1],g=c[2],k=c[3],l=c[4],m=c[5];!k&&!m&&g&&null!=g.lower&&null!=g.upper&&0==Oj(g.lower,g.upper)&&
a.g.ve(b,f,g.lower)}else if("keys"==f)g=c[1],l=c[2],k=c[3],m=c[4],a.g.keys(b,null,g,l,k,m,!1);else if("keys:iter:index"==f)f=c[1],g=c[2],l=c[3],k=c[4],m=c[5],a.g.keys(b,f,g,l,k,m,c[6]);else if("values"==f)g=c[1],l=c[2],k=c[3],m=c[4],g||m?g&&g.lower&&v(g.lower)&&g.lower==g.upper||!g&&m&&1==l&&k&&xq(a.g,b):a.g.values(b,l,k);else if(""!=f)if("get"==f)g=c[1],a.g.get(b,g);else if("values:array"==f)Gp(a.g,b,c[1]);else throw Error(f);})};var Lq="Accounts Calls Campaigns Contacts Documents Meetings Emails EmailTemplates Employees Leads Notes Opportunities Tasks Teams TeamSets Users".split(" "),Mq="Accounts Contacts EmailTemplates Leads Notes Tasks Meetings Calls Opportunities Emails".split(" "),Nq=["Accounts","Contacts","Leads"],Oq=["Accounts","Contacts","Leads"],Pq=["Contacts","Leads"],Qq=["Meetings","Calls","Tasks","Opportunities"];function Rq(a,b,c){return"https://"+a+"/index.php?module="+b+"&action=DetailView&record="+c};function Sq(a){this.h=a||[]}Sq.prototype.g=function(a){return-1==this.h.indexOf(a)?a:null};function Tq(){}
Tq.prototype.g=function(a){var b={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},c={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};a=a.toLowerCase();var d,e,f=a;if(3>a.length)return a;var g,k;a=a.substr(0,1);"y"==a&&(f=a.toUpperCase()+f.substr(1));g=/^(.+?)(ss|i)es$/;e=/^(.+?)([^s])s$/;
g.test(f)?f=f.replace(g,"$1$2"):e.test(f)&&(f=f.replace(e,"$1$2"));g=/^(.+?)eed$/;e=/^(.+?)(ed|ing)$/;g.test(f)?(e=g.exec(f),g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(e[1])&&(g=/.$/,f=f.replace(g,""))):e.test(f)&&(e=e.exec(f),d=e[1],e=/^([^aeiou][^aeiouy]*)?[aeiouy]/,e.test(d)&&(f=d,e=/(at|bl|iz)$/,k=/([^aeiouylsz])\1$/,d=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,e.test(f)?f+="e":k.test(f)?(g=/.$/,f=f.replace(g,"")):d.test(f)&&(f+="e")));g=/^(.+?)y$/;g.test(f)&&(e=g.exec(f),
d=e[1],g=/^([^aeiou][^aeiouy]*)?[aeiouy]/,g.test(d)&&(f=d+"i"));g=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;g.test(f)&&(e=g.exec(f),d=e[1],e=e[2],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(d)&&(f=d+b[e]));g=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;g.test(f)&&(e=g.exec(f),d=e[1],e=e[2],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(d)&&(f=d+c[e]));g=
/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;e=/^(.+?)(s|t)(ion)$/;g.test(f)?(e=g.exec(f),d=e[1],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g.test(d)&&(f=d)):e.test(f)&&(e=e.exec(f),d=e[1]+e[2],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(d)&&(f=d));g=/^(.+?)e$/;g.test(f)&&(e=g.exec(f),d=e[1],g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,
e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,k=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,g.test(d)||e.test(d)&&!k.test(d))&&(f=d);g=/ll$/;e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;g.test(f)&&e.test(f)&&(g=/.$/,f=f.replace(g,""));"y"==a&&(f=a.toLowerCase()+f.substr(1));return f};function Uq(a){this.h=a}
Uq.prototype.g=function(a){a=a.toLowerCase();a=a.replace(/([^c])\1/g,"$1");a=function(a){return a.match(/^(kn|gn|pn|ae|wr)/)?a.substr(1,a.length-1):a}(a);a=a.replace(/mb$/,"m");a=a.replace(/ck/g,"k");a=function(a){a=a.replace(/([^s]|^)(c)(h)/g,"$1x$3").trim();a=a.replace(/cia/g,"xia");a=a.replace(/c(i|e|y)/g,"s$1");return a=a.replace(/c/g,"k")}(a);a=function(a){a=a.replace(/d(ge|gy|gi)/g,"j$1");return a=a.replace(/d/g,"t")}(a);a=function(a){a=a.replace(/gh(^$|[^aeiou])/g,"h$1");return a=a.replace(/g(n|ned)$/g,
"$1")}(a);a=function(a){a=a.replace(/([^g]|^)(g)(i|e|y)/g,"$1j$3");a=a.replace(/gg/g,"g");return a=a.replace(/g/g,"k")}(a);a=a.replace(/([aeiou])h([^aeiou])/g,"$1$2");a=a.replace(/ph/g,"f");a=a.replace(/q/g,"k");a=a.replace(/s(h|io|ia)/g,"x$1");a=function(a){a=a.replace(/^x/,"s");return a=a.replace(/x/g,"ks")}(a);a=function(a){a=a.replace(/t(ia|io)/g,"x$1");return a=a.replace(/th/,"0")}(a);a=a.replace(/tch/g,"ch");a=a.replace(/v/g,"f");a=a.replace(/^wh/,"w");a=a.replace(/w([^aeiou]|$)/g,"$1");a=a.replace(/y([^aeiou]|$)/g,
"$1");a=a.replace(/z/,"s");a=a.charAt(0)+a.substr(1,a.length).replace(/[aeiou]/g,"");a.length>=this.h&&(a=a.substring(0,this.h));return a=a.toUpperCase()};var Vq=new Uq(32),Wq=new Tq,Xq=new Sq("a a's able about above according accordingly across actually after afterwards again against ain't all allow allows almost alone along already also although always am among amongst an and another any anybody anyhow anyone anything anyway anyways anywhere apart appear appreciate appropriate are aren't around as aside ask asking associated at available away awfully b be became because become becomes becoming been before beforehand behind being believe below beside besides best better between beyond both brief but by c c'mon c's came can can't cannot cant cause causes certain certainly changes clearly co com come comes concerning consequently consider considering contain containing contains corresponding could couldn't course currently d definitely described despite did didn't different do does doesn't doing don't done down downwards during e each edu eg eight either else elsewhere enough entirely especially et etc even ever every everybody everyone everything everywhere ex exactly example except f far few fifth first five followed following follows for former formerly forth four from further furthermore g get gets getting given gives go goes going gone got gotten greetings h had hadn't happens hardly has hasn't have haven't having he he's hello help hence her here here's hereafter hereby herein hereupon hers herself hi him himself his hither hopefully how howbeit however i i'd i'll i'm i've ie if ignored immediate in inasmuch inc indeed indicate indicated indicates inner insofar instead into inward is isn't it it'd it'll it's its itself j just k keep keeps kept know knows known l last lately later latter latterly least less lest let let's like liked likely little look looking looks ltd m mainly many may maybe me mean meanwhile merely might more moreover most mostly much must my myself n name namely nd near nearly necessary need needs neither never nevertheless new next nine no nobody non none noone nor normally not nothing novel now nowhere o obviously of off often oh ok okay old on once one ones only onto or other others otherwise ought our ours ourselves out outside over overall own p particular particularly per perhaps placed please plus possible presumably probably provides q que quite qv r rather rd re really reasonably regarding regardless regards relatively respectively right s said same saw say saying says second secondly see seeing seem seemed seeming seems seen self selves sensible sent serious seriously seven several shall she should shouldn't since six so some somebody somehow someone something sometime sometimes somewhat somewhere soon sorry specified specify specifying still sub such sup sure t t's take taken tell tends th than thank thanks thanx that that's thats the their theirs them themselves then thence there there's thereafter thereby therefore therein theres thereupon these they they'd they'll they're they've think third this thorough thoroughly those though three through throughout thru thus to together too took toward towards tried tries truly try trying twice two u un under unfortunately unless unlikely until unto up upon us use used useful uses using usually uucp v value various very via viz vs w want wants was wasn't way we we'd we'll we're we've welcome well went were weren't what what's whatever when whence whenever where where's whereafter whereas whereby wherein whereupon wherever whether which while whither who who's whoever whole whom whose why will willing wish with within without won't wonder would wouldn't x y yes yet you you'd you'll you're you've your yours yourself yourselves z zero".split(" "));function Yq(a){this.data=a;this.g=0}Yq.prototype.next=function(a){for(var b=this.g,c=this.data[b],c=1,d=0;0<=b&&b<this.data.length;){c=this.data[b];if(c instanceof Array)if(a<c[0])c=-1;else if(a>c[1])c=1;else return this.g=b,!0;else{if(c==a)return this.g=b,!0;c=a<c?-1:1}if(0==d)d=c;else if(d!=c)break;b+=c;if(b>this.data.length||0>b)break}return!1};
function Zq(a,b){for(var c=0,d=0,e=a.length,f=0;f<e;++f){a:{var d=a.charCodeAt(f),g=new Yq(categ_letters_numbers_data);if(ha(d))d=g.next(d);else{for(var k=0,l=d.length;k<l;++k)if(!1===g.next(d[k])){d=!1;break a}d=!0}}d||((d=f-c)&&b(c,d),c=f+1)}(d=e-c)&&b(c,d)};function $q(a,b){this.j=b;this.value=a}$q.prototype.P=function(){return this.value};$q.prototype.Cb=function(){return 1};var ar=ni||ki;$q.prototype.H=function(){return this.value};$q.prototype.toString=function(){return"Entry:"+this.value};function br(a,b,c,d,e,f){$q.call(this,d,e);this.R=a;this.h=b;this.i=c;this.Td=f||[]}B(br,$q);h=br.prototype;h.dd=function(){return{k:this.j,v:this.value.toLowerCase(),id:this.H(),loc:this.Td}};h.H=function(){var a=[this.R,this.i,this.h,this.value];return ar?a:Tj(a)};h.I=function(){return this.R};h.ia=function(){return this.i};h.toString=function(){return["IndexEntry",this.R,this.i,this.value].join(":")};function cr(a,b,c,d,e){$q.call(this,b,c);this.l=d;this.g=e;this.type=a;this.Ef=1}B(cr,$q);cr.prototype.Cb=function(){return this.g*this.type*this.Ef};cr.prototype.H=function(){return this.value+"|"+this.l};function dr(a,b){br.call(this,b.I(),b.h,b.ia(),b.P(),b.j,[]);this.o=a;this.g=[b]}B(dr,br);h=dr.prototype;h.count=function(){return this.g.length};h.entry=function(a){return this.g[a]};h.Ze=function(a){a=a.g[0];for(var b=0;b<this.g.length;b++)if(this.g[b].h==a.h&&this.g[b].value==a.value)return;this.g.push(a)};h.Cb=function(){for(var a=0,b=0;b<this.g.length;b++)var c=this.g[b],d=mm(this.o,c.I(),c.h),c=c.Cb(),a=a+c*d.h;return a};function Nb(a,b){var c=a.Cb(),d=b.Cb();return c<=d?1:-1}
h.dd=function(){for(var a={value:this.value,primaryKey:this.i,storeName:this.R,score:this.Cb(),tokens:[]},b=0;b<this.g.length;b++)a.tokens[b]=this.g[b].dd();return a};h.toString=function(){return["RankEntry",this.R,this.i,this.value].join(":")+"["+this.g.length+"]"};function er(a){var b=[],c;a=a.split(/\s+/);for(var d=0;d<a.length;d++){c=a[d];for(var e=c.length-1,f=Array(e),g=0;g<e;g++)f[g]=c.substring(g,g+2);c=f;b.push.apply(b,c)}return b};function Al(a,b,c,d,e,f,g){br.call(this,b,c,d,e,f,g);this.query=a}B(Al,br);Al.prototype.Cb=function(){var a,b=this.value;a=er(this.query.value.toLowerCase().replace(/^\s+|\s+$/g,""));var b=er(b.toLowerCase().replace(/^\s+|\s+$/g,"")),c=0,d=a.length+b.length,e,f,g,k;for(e=0;e<a.length;e++)for(g=a[e],f=0;f<b.length;f++)if(k=b[f],g==k){c++;delete b[f];break}a=2*c/d;b=Math.log(this.Td.length+1);c=this.query.Cb();return b*a*c};Al.prototype.dd=function(){return{keyPath:this.h,value:this.value,loc:this.Td.slice()}};
Al.prototype.toString=function(){return["ResultEntry",this.R,this.i,this.value].join(":")};function fr(a,b,c){this.g=a;this.h=b;this.j=[];this.limit=c||1E3;this.i=0}function zl(a,b){for(var c,d,e=a.g.getName(),f=0;f<a.h.length;f++){var g=a.h[f],k=g.type;0.4==k||0.6==k?(d="v",c=g.P().toLowerCase(),c=Ij(c)):(d="v",c=g.P().toLowerCase(),c=S.only(c));b(e,d,c,g);a.i++;0.6==k&&(d="k",c=g.j,c=S.only(c),b(e,d,c,g),a.i++)}}function yl(a){for(var b=[a.g.getName()],c=0;c<a.g.count();c++){var d=a.g.index(c).I();-1==b.indexOf(d)&&b.push(d)}return b}
function Bl(a){for(var b=[],c=[],d=0;d<a.j.length;d++){var e=a.j[d];if(0==e.query.type)-1==zb(c,function(a){return a.ia()==e.ia()&&a.I()==e.I()})&&c.push(e);else{var f=new dr(a.g,e),g=zb(b,function(a){return a.ia()==f.ia()&&a.I()==f.I()});if(0<=g){var k=b[g];rb.splice.call(b,g,1);k.Ze(f);f=k}Mb(b,f)}}for(a=0;a<c.length;a++)for(g=c[a],d=b.length-1;0<=d;--d)if(k=b[d],g.ia()==k.ia()&&g.I()==k.I()){b.splice(a,1);break}return b.map(function(a){return a.dd()})};function gr(a){this.g=a;if("en"==a.lang){a=a.h||["stop","stemmer","metaphone"];for(var b=[],c=0;c<a.length;c++)if("metaphone"==a[c])b.push(Vq);else if("stemmer"==a[c])b.push(Wq);else if("stop"==a[c])b.push(Xq);else throw Error('Invalid normalizer "'+a[c]+'" for English lang');a=b}else a=[];this.h=a}function hr(a,b){for(var c=0;c<a.h.length;c++){var d=a.h[c].g(b);if(d)b=d;else return null}return b}gr.prototype.parse=function(a){var b=[];Zq(a,function(c,d){b.push(a.substr(c,d))});return b};
gr.prototype.query=function(a,b,c){a=ir(this,b);return 0==a.length?null:new fr(this.g,a,c||10)};
function ir(a,b){var c=[],d=[];Zq(b,function(a,e){c.push(b.substr(a,e));d.push(a)});for(var e=[],f=0;f<c.length;f++)e[f]=hr(a,c[f]);for(var g=[],k=0,f=0;f<c.length;f++){var l=c[f],m=e[f],n="*"==b.charAt(d[f]+l.length),p=n?d[f]+l.length+1:d[f]+l.length,p='"'==b.charAt(d[f]-1)&&'"'==b.charAt(p),q="-"==b.charAt(p?d[f]-2:d[f]-1),s=0.8;n?s=0.4:p?s=1:q?s=0:null!=m&&(s=0.6);l=new cr(s,l,m,d[f],1/(f+2));g.push(l);k+=l.Cb()}for(f=0;f<g.length;++f)g[f].Ef=1/k;return g}
function jr(a,b,c,d){var e=[],f=[];Zq(b,function(a,c){e.push(b.substr(a,c));f.push(a)});for(var g=[],k=0;k<e.length;k++)g[k]=hr(a,e[k]);a=c.I();c=c.g;for(var l=[],k=0;k<e.length;k++){var m=e[k],n=g[k];if(null!=n){var p=yb(l,function(a){return a.P()==m});p||(p=new br(a,c,d,m,n),l.push(p));p.Td.push(f[k])}}return l}function kr(a,b,c,d){for(var e=[],f=0;f<a.g.count();f++){var g=a.g.index(f);if(g.I()==b){var k=Qj(d,g.g);v(k)&&(e=e.concat(jr(a,k,g,c)))}}return e};Hm.prototype.Bf=function(a,b){var c=this;b.g=new gr(b);jm(a,function(d,e){function f(e){var f=a.getName();Qk(e)&&Bk(d,function(a,g,k){if(g)k(a,g);else{wd(d,a);var l=Gj(S.bound([f,e],[f,e,"\uffff"])),z=b.getName();Gl(c.g,z,l).ea(function(){k(a,g)})}})}function g(b){var e=a.getName();Bk(d,function(a,f,g){f?g(a,f):(wd(d,a),b&&(b=Gj(S.bound([e,b.lower],[e,b.upper,"\uffff"]))),Gl(c.g,e,b).ea(function(){g(a,f)}))})}function k(e,f){var g=a.getName();Bk(d,function(a,k,l){wd(d,a);if(k)l(a,k);else{var z=b.getName();
u(a)||(a=[a]);for(var F=0;F<a.length;F++){var D=a[F];if(Qk(D)){if(f){var I=Gj(S.bound([g,D],[g,D,"\uffff"]));Gl(c.g,z,I)}D=kr(b.g,g,D,e[F]).map(function(a){return a.dd()});D=El(c.g,z,D);F==a.length-1&&D.ea(function(){l(a,k)})}}}})}var l=d.Bd();"put"==l?k([e[1]],!0):"put:array"==l?k(e[1],!0):"add"==l?k([e[1]],!1):"add:array"==l?k(e[1],!1):"rm:iter"==l||"clear"==l?g(e[1]):"rm"==l&&f(e[1])})};
Hm.prototype.search=function(a,b,c,d){var e=qm(this.h,a);if(!e)throw new J('full text index catalog "'+a+'" not found.');a=e.g.query(a,b,c,d);return a?this.g.search(a):(N(this.logger,'query "'+b+'" contains only noise and search is ignored'),Ck("search",null))};function lr(a){this.name=a;this.info=null;this.h={};this.g=null}
var mr={Accounts:{GeneratorIndex:{ydn$emails:["email","email1","email_addresses_non_primary"],ydn$phones:["phone_office","phone_alternate","phone_fax"]}},Calls:{FullTextIndex:{name:["name","description"],content:["name","description"]},indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"assigned_user_id, date_start",keyPath:["assigned_user_id","date_start"]}]},Contacts:{FullTextIndex:{name:["name","first_name","last_name","full_name"]},GeneratorIndex:{ydn$emails:["email",
"email1","email2"],ydn$phones:["phone_home","phone_mobile","phone_work","phone_other","phone_fax"]}},Documents:{FullTextIndex:{name:["name","document_name","filename"],content:["description"]},indexes:[{name:"parent",keyPath:["doc_type","doc_id"]}]},Emails:{FullTextIndex:{name:["name"],content:["content","description"]},GeneratorIndex:{ydn$emails:["bcc_addrs","cc_addrs","from_addr","to_addrs","reply_to_addr"]},indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"message_id"}]},
Leads:{FullTextIndex:{name:["name","first_name","last_name","full_name"]},GeneratorIndex:{ydn$emails:["email","email1","email2"],ydn$phones:["phone_home","phone_mobile","phone_work","phone_other","phone_fax"]}},Meetings:{FullTextIndex:{name:["name"],content:["description"]},indexes:[{name:"date_start"},{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"assigned_user_id, date_start",keyPath:["assigned_user_id","date_start"]}]},Notes:{FullTextIndex:{name:["name"],content:["description"]},
indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]}]},Opportunities:{FullTextIndex:{name:["name"],content:["description"]},indexes:{name:"assigned_user_id, date_closed",keyPath:["assigned_user_id","date_closed"]}},Tasks:{FullTextIndex:{name:["name"],content:["description"]},indexes:[{name:"parent",keyPath:["parent_type","parent_id","date_modified"]},{name:"assigned_user_id, date_due",keyPath:["assigned_user_id","date_due"]}]}};
function nr(a,b){return"ydn$emails"==b?{name:b,multiEntry:!0,generator:function(b){var d=[],e;for(e in b)if(0<=a.indexOf(e))if(v(b[e]))if(/addrs$/.test(e))for(var f=b[e].split(","),g=0;g<f.length;g++){var k=Ln(f[g]);k&&d.push(k)}else(k=Ln(b[e]))&&d.push(k);else if(fa(b[e])&&b[e][0]&&b[e][0].email_address)for(f=b[e],g=0;g<f.length;g++)f[g]&&v(f[g].email_address)&&(k=Ln(f[g].email_address))&&d.push(k);return d}}:"ydn$phones"==b?{name:b,multiEntry:!0,generator:function(b){var d=[],e;for(e in b)if(0<=
a.indexOf(e)){var f=Kn(b[e]);f&&d.push(f)}return d}}:null}function or(a,b){if(a.g)for(var c=0;c<a.g.stores.length;c++)if(a.g.stores[c].name==b)return a.g.stores[c];var c=a.h[b]||mr[b]||{},d={name:b,keyPath:c.keyPath||"id",indexes:[{name:"name"},{name:"date_modified"}]},e=["ydn$emails","ydn$phones","ydn$names"];c.indexes&&(d.indexes=d.indexes.concat(c.indexes));for(var f=c.GeneratorIndex||{},c=0;c<e.length;c++){var g=e[c],k=f[g];!k||u(k)&&0==k.length||d.indexes.push(nr(k,g))}return d}
function pr(a){if(a.g)return a.g;for(var b={fullTextCatalogs:[],stores:[{name:"history",indexes:[{keyPath:"type"},{keyPath:"timestamp"}]},{name:"Meta"}]},c=0;c<Mq.length;c++){var d=Mq[c];b.stores.push(or(a,d));var e=a.h[d]||mr[d]||{};if(e.FullTextIndex)for(var f in e.FullTextIndex){var g=e.FullTextIndex[f];if(0<g.length){for(var k={name:"ft-"+d+"-"+f,lang:"en",sources:[]},l=0;l<g.length;l++)k.sources.push({storeName:d,keyPath:g[l]});b.fullTextCatalogs.push(k)}}}a.g=b;Object.freeze(a.g);return a.g}
;function qr(a,b,c){this.domain=a;this.module=b;this.g=c||null}function rr(a){return Rq(a.domain,a.module,a.H())}function sr(a,b){if(b){a.g||(a.g={});for(var c in b)a.g[c]=b[c]}}qr.prototype.H=function(){return this.g.id};function tr(a){return a.g?+ur(a.g.date_modified):NaN}function vr(a){return"assigned_user_id, "+wr(a)}function wr(a){return"Tasks"==a?"date_due":"Opportunities"==a?"date_closed":"date_start"}
function xr(a){if(!a.g)return"";var b=a.g.full_name||a.g.name;return b?b:a.g.first_name||a.g.last_name?(b=(a.g.first_name||"").trim(),a=(a.g.last_name||"").trim(),b+" "+a):a.g.id}qr.prototype.value=function(a){return this.g?this.g[a]:null};qr.prototype.toJSON=function(){return{domain:this.domain,module:this.module,obj:this.g}};qr.prototype.toString=function(){return"Record:"+this.module+":"+(this.g?this.g.id:void 0)};function yr(a,b,c){var d=0;if(!b)return d;b.gd$city&&a[c+"_address_city"]!=b.gd$city.$t&&(a[c+"_address_city"]=b.gd$city.$t,d++);b.gd$country&&a[c+"_address_country"]!=b.gd$country.$t&&(a[c+"_address_country"]=b.gd$country.$t,d++);b.gd$postcode&&a[c+"_address_postalcode"]!=b.gd$postcode.$t&&(a[c+"_address_postalcode"]=b.gd$postcode.$t,d++);b.gd$region&&a[c+"_address_state"]!=b.gd$region.$t&&(a[c+"_address_state"]=b.gd$region.$t,d++);b.gd$street&&a[c+"_address_street"]!=b.gd$street.$t&&(a[c+"_address_street"]=
b.gd$street.$t,d++);b.gd$housename&&a[c+"_address_street_2"]!=b.gd$neighborhood.$t&&(a[c+"_address_street_2"]=b.gd$neighborhood.$t,d++);b.gd$neighborhood&&a[c+"_address_street_3"]!=b.gd$city.$t&&(a[c+"_address_street_3"]=b.gd$city.$t,d++);return d}
function zr(a,b,c){function d(d,g){!a[c+g]||b[d]&&b[d].$t==a[c+g]||(e++,b[d]={$t:a[c+g]})}var e=0;if(!a)return 0;b||(b={});d("gd$city","_address_city");d("gd$country","_address_country");d("gd$postcode","_address_postalcode");d("gd$region","_address_state");d("gd$street","_address_street");d("gd$neighborhood","_address_street_2");d("gd$city","_address_street_3");return e}
function Ar(a,b){var c=0;!a.title||b.name&&b.name==a.title.$t||(b.name=a.title.$t,c++);for(var d=0;a.gd$email&&d<a.gd$email.length;d++){var e=a.gd$email[d];"http://schemas.google.com/g/2005#work"==e.rel?b.email1!=e.address&&(c++,b.email1=e.address):"http://schemas.google.com/g/2005#home"==e.rel?b.email2!=e.address&&(c++,b.email2=e.address):"http://schemas.google.com/g/2005#other"==e.rel&&b.email!=e.address&&(c++,b.email=e.address)}a.gd$name?(a.gd$name.gd$namePrefix&&b.salutation!=a.gd$name.gd$namePrefix.$t&&
(c++,b.salutation=a.gd$name.gd$namePrefix.$t),a.gd$name.gd$givenName&&b.first_name!=a.gd$name.gd$givenName.$t&&(b.first_name=a.gd$name.gd$givenName.$t,c++),a.gd$name.gd$familyName&&b.last_name!=a.gd$name.gd$familyName.$t&&(b.last_name=a.gd$name.gd$familyName.$t,c++),a.gd$name.gd$fullName&&b.full_name!=a.gd$name.gd$fullName.$t&&(b.full_name=a.gd$name.gd$fullName.$t,c++)):b.full_name=a.title.$t;a.gd$organization&&a.gd$organization[0]&&(d=a.gd$organization[0],d.gd$orgTitle&&d.gd$orgTitle.$t!=b.title&&
(b.title=d.gd$orgTitle.$t,c++),d.gd$orgDepartment&&d.gd$orgDepartment.$t!=b.department&&(b.department=d.gd$orgDepartment.$t,c++),d.gd$orgJobDescription&&d.gd$orgJobDescription.$t!=b.description&&(b.description=d.gd$orgJobDescription.$t,c++));if(a.gd$im)for(d=0;d<a.gd$im.length;d++)"Twitter"==a.gd$im[d].label&&b.twitter!=a.gd$im[d].address?(b.twitter=a.gd$im[d].address,c++):"Facebook"==a.gd$im[d].label&&b.facebook!=a.gd$im[d].address?(b.facebook=a.gd$im[d].address,c++):"Google Plus"==a.gd$im[d].label&&
b.googleplus!=a.gd$im[d].address?(b.googleplus=a.gd$im[d].address,c++):"Linkedin"==a.gd$im[d].label&&b.linkedin!=a.gd$im[d].address&&(b.linkedin=a.gd$im[d].address,c++);a.gContact$birthday&&b.birthdate!=a.gContact$birthday.when&&(b.birthdate=a.gContact$birthday.when,c++);for(d=0;a.gd$phoneNumber&&d<a.gd$phoneNumber.length;d++)if(e=a.gd$phoneNumber[d],e.$t)if("http://schemas.google.com/g/2005#mobile"==e.rel)b.phone_mobile!=e.$t&&(b.phone_mobile=e.$t,c++);else if("http://schemas.google.com/g/2005#work"==
e.rel)b.phone_work!=e.$t&&(b.phone_work=e.$t,c++);else if("http://schemas.google.com/g/2005#home"==e.rel)b.phone_home!=e.$t&&(b.phone_home=e.$t,c++);else if("http://schemas.google.com/g/2005#fax"==e.rel||"http://schemas.google.com/g/2005#home_fax"==e.rel||"http://schemas.google.com/g/2005#work_fax"==e.rel)b.phone_fax!=e.$t&&(b.phone_fax=e.$t,c++);else if(b.phone_other=e.$t)b.phone_other=e.$t,c++;if(a.gd$structuredPostalAddress){for(var f=e=-1,d=0;d<a.gd$structuredPostalAddress.length;d++){var g=a.gd$structuredPostalAddress[d];
"http://schemas.google.com/g/2005#work"==g.rel||g.primary?e=d:f=d}-1==e&&(f=-1);c+=yr(b,a.gd$structuredPostalAddress[e],"primary");c+=yr(b,a.gd$structuredPostalAddress[f],"alt")}return c}
function Br(a,b){function c(a,c){if(g[a]){b.gd$phoneNumber||(b.gd$phoneNumber=[]);var d;a:{for(d=0;b.gd$phoneNumber&&d<b.gd$phoneNumber.length;d++)if(b.gd$phoneNumber[d].rel==c){d=b.gd$phoneNumber[d];break a}d=null}d?d.$t!=g[a]&&(d.$t=g[a],k++):(b.gd$phoneNumber.push({rel:c,$t:g[a]}),k++)}}function d(a){b.gd$im||(b.gd$im=[]);for(var c=0;c<b.gd$im.length;c++)if(b.gd$im[c].label==a)return b.gd$im[c];return null}function e(){b.gd$name||(b.gd$name={},k++)}function f(a,c){if(g[a]){b.gd$email?fa(b.gd$email)||
(b.gd$email=[b.gd$email]):b.gd$email=[];var d;a:{for(d=0;b.gd$email&&d<b.gd$email.length;d++)if(!(0<=l.indexOf(d))&&b.gd$email[d].address==g[a])break a;d=-1}if(0<=d){var e=b.gd$email[d];e.rel!=c&&(k++,e.rel=c);l.push(d)}else b.gd$email.push({rel:c,address:g[a]}),l.push(b.gd$email.length-1),k++}}var g=a.g,k=0;!g.name||b.title&&b.title.$t==g.name||(b.title={$t:g.name},k++);var l=[];f("email1","http://schemas.google.com/g/2005#work");f("email2","http://schemas.google.com/g/2005#home");f("email","http://schemas.google.com/g/2005#other");
g.salutation&&(e(),b.gd$name.gd$namePrefix&&b.gd$name.gd$namePrefix.$t==g.salutation||(b.gd$name.gd$namePrefix={$t:g.salutation},k++));g.first_name&&(e(),b.gd$name.gd$givenName&&b.gd$name.gd$givenName.$t==g.first_name||(b.gd$name.gd$givenName={$t:g.first_name},k++));g.last_name&&(e(),b.gd$name.gd$familyName&&b.gd$name.gd$familyName.$t==g.last_name||(b.gd$name.gd$familyName={$t:g.last_name},k++));g.full_name&&(e(),b.gd$name.gd$fullName&&b.gd$name.gd$fullName.$t==g.full_name||(b.gd$name.gd$fullName=
{$t:g.full_name},k++));if(g.twitter){var m=d("Twitter");m?m.address!=g.twitter&&(m.address=g.twitter,k++):(b.gd$im.push({label:"Twitter",address:g.twitter}),k++)}g.facebook&&((m=d("Facebook"),m)?m.address!=g.facebook&&(m.address=g.facebook,k++):(b.gd$im.push({label:"Facebook",address:g.facebook}),k++));g.googleplus&&((m=d("Google Plus"),m)?m.address!=g.googleplus&&(m.address=g.googleplus,k++):(b.gd$im.push({label:"Google Plus",address:g.googleplus}),k++));g.linkedin&&((m=d("Linkedin"),m)?m.address!=
g.linkedin&&(m.address=g.linkedin,k++):(b.gd$im.push({label:"Linkedin",address:g.linkedin}),k++));!g.birthdate||b.gContact$birthday&&b.gContact$birthday.when==g.birthdate||(b.gContact$birthday={when:g.birthdate},k++);c("phone_mobile","http://schemas.google.com/g/2005#mobile");c("phone_work","http://schemas.google.com/g/2005#work");c("phone_home","http://schemas.google.com/g/2005#home");c("phone_fax","http://schemas.google.com/g/2005#work_fax");c("phone_other","http://schemas.google.com/g/2005#other");
for(var n=-1,m=-1,p=0;b.gd$structuredPostalAddress&&p<b.gd$structuredPostalAddress.length;p++)-1==n&&"true"==b.gd$structuredPostalAddress[p].primary||"http://schemas.google.com/g/2005#work"==b.gd$structuredPostalAddress[p].rel?n=p:-1==m&&(m=p);-1==n&&0<=m&&(n=m,b.gd$structuredPostalAddress[n].primary="true",m=-1);0<=n?k+=zr(g,b.gd$structuredPostalAddress[n],"primary"):(n={primary:"true",rel:"http://schemas.google.com/g/2005#work"},p=zr(g,n,"primary"),0<p&&(b.gd$structuredPostalAddress||(b.gd$structuredPostalAddress=
[]),b.gd$structuredPostalAddress.push(n),k+=p));0<=m?k+=zr(g,b.gd$structuredPostalAddress[m],"alt"):(n={},p=zr(g,n,"alt"),0<p&&(b.gd$structuredPostalAddress||(b.gd$structuredPostalAddress=[]),b.gd$structuredPostalAddress.push(n),k+=p));return k};function Cr(a){if(u(a))return a.map(function(a){return Cr(a)});if(x(a)){var b={},c;for(c in a.name_value_list)b[c]=a.name_value_list[c].value;return b}throw Error("Invalid name_value_entries");}function ur(a){return new Date(a+" GMT")}function Dr(a){return a.toISOString().replace("T"," ").replace(/\..+/,"")};function Er(a,b,c,d,e){c=va(c,"http")?new Sd(c):Td(Ud(new Sd,c),"https");Yd(c,"");Xd(c,null);this.h=c.Mb;this.O=b;this.o=c.toString().replace(/\/$/,"");this.l=d;this.C=e;this.g=null;this.j=a;this.T=new lr(this.h);this.db=new vo("su-"+this.h,pr(this.T),{isSerial:!0,policy:"single",mechanisms:["indexeddb"]});this.i=null;this.p=this.u=NaN;this.G=!1;this.history=new ep(this.db)}B(Er,Fo);h=Er.prototype;
h.request=function(a,b,c,d,e,f){function g(){m.execute(function(g,k){this.u=A();var l=g;if(v(l))try{g=JSON.parse(l)}catch(m){}f||!g||11!=g.number&&10!=g.number?d.call(e,g,k):Fr(this).w(function(){this.request(a,b,c,d,e,!0)},function(){d.call(e,null,new sj(0,null,{},"Login fail"))},this)},this)}for(var k="{",l=0;l<b.length;l++)k+=(0==l?"":",")+'"'+b[l]+'":'+JSON.stringify(c[l]);k+="}";l=new Zd;l.add("method",a);l.add("input_type","json");l.add("response_type","json");l.add("rest_data",k);var m=this.j.request(new si(this.o+
"/service/v4/rest.php","POST",{},{"Content-Type":"application/x-www-form-urlencoded"},l.toString())),k=A()-this.u;0<k&&100>k?(this.u=100+this.u,P(this.logger,"request will call after "+k+" ms."),Kf(g,k,this)):g.call(this)};
function Gr(a,b,c){var d=c.module_name,e=["session"];a=[a.g?a.g.id:null];var f=[!1];d&&(e.push("module_name"),a.push(d),f.push(!1));if("get_entry_list"==b)b=c.query||"",e.push("query"),a.push(b),f.push(""==b),e.push("order_by"),b=c.order_by||"",a.push(b),f.push(""==b),b=c.offset||0,e.push("offset"),a.push(b),f.push(0==b),b=c.select_fields||[],e.push("select_fields"),a.push(b),f.push(0==b.length),b=c.link_name_to_fields_array||[],e.push("link_name_to_fields_array"),a.push(b),f.push(0==b.length),b=
c.max_results||25,e.push("max_results"),a.push(b),f.push(null!=c.max_results),b=c.deleted||0,e.push("deleted"),a.push(b),f.push(0==b),c=!!c.favorites,e.push("favorites"),a.push(c),f.push(!1==c);else if("get_available_modules"==b)c=c.filter||"",e.push("filter"),a.push(c),f.push(0==c.length);else if("get_module_fields"==b)c=c.fields||[],e.push("fields"),a.push(c),f.push(0==c.length);else if("get_entries"==b)b=c.ids||[],e.push("ids"),a.push(b),f.push(!1),b=c.select_fields||[],e.push("select_fields"),
a.push(b),f.push(0==b.length),b=c.link_name_to_fields_array||[],e.push("link_name_to_fields_array"),a.push(b),f.push(0==b.length);else for(var g in c)"module_name"!=g&&(e.push(g),a.push(c[g]),f.push(!1));for(c=f.length-1;0<=c;c--)if(f[c])e.pop(),a.pop();else break;return{keys:e,values:a}}
function Hr(a,b){var c=b.entry_list;if(u(c)&&0<c.length){var d=c.map(function(a){return'"'+a.id+'"'});return Ir(a,"get_entry_list",{module_name:"EmailText",max_results:b.length,query:"email_id IN ("+d.join(",")+")"}).B(function(a){a=a.entry_list;c.length!=a.length&&M(this.logger,"number of entries retrived for EmailText exptected to have "+c.length+" but found only "+a.length);for(var d=0;d<a.length;d++){var g=a[d];if(a[d]){var k=Ic(g,"name_value_list","email_id","value"),l=zb(c,function(a){return a.id==
k});if(0<=l)for(var m in g.name_value_list)c[l].name_value_list[m]=g.name_value_list[m];else zf(this.logger,"key "+k+" not found in EmailText")}}return b},a)}}
function Jr(a,b){var c=b.module_name;a.p=A();var d=Ir(a,"get_entry_list",b);"Emails"==c&&(d=d.B(function(a){return Hr(this,a)},a));return d.B(function(a){var d=a.result_count,g=a.offset||0,k=a.entry_list,l=parseInt(a.next_offset,10);if(t(d)&&u(k)){if(0<k.length){var m=Cr(k);return this.db.put(c,m).w(function(){var a=this.O,e=this.h,q=m;if(a.h)for(var q=u(q)?q:[q],s=0;s<q.length;s++)q[s]&&Kr(a,new qr(e,c,q[s]));return d>=k.length&&l>g?(b.offset=l,Jr(this,b)):l},function(a){M(this.logger,"Fail to store into the database for module "+
c+": "+a)},this)}return l}throw Error("Invalid REST respond on entry list query on "+c+": "+JSON.stringify(a));},a)}function Lr(a,b){if(!b){for(var c=[],d=0;d<Mq.length;d++)c[d]=Lr(a,Mq[d]);c.push(Lr(a,"Users"));return Mm(c)}var e={module_name:b},f="module/"+b;return a.db.get("Meta",f).B(function(a){return a?a:Ir(this,"get_module_fields",e).B(function(a){a&&a.module_name&&a.module_fields?this.db.put("Meta",a,f):M(this.logger,"Invalid module for "+b+" "+Th(a));return a},this)},a)}
function Mr(a,b){var c=new sk(b,"date_modified",null,!0),d="EmailTemplates"!=b;return a.db.keys(c,1).B(function(a){var c={};a[0]&&d&&(c.query=b.toLowerCase()+".date_modified>'"+a[0]+"'");c.module_name=b;c.order_by="date_modified";a=Jr(this,c);a.w(function(a){this.logger.info(this+" module "+b+" synced, "+a+" records updated.")},function(a){var c=".";a&&(c=" with "+a.name+": "+a.message);M(this.logger,this+" module "+b+" failed"+c)},this);return a},a)}
function Ir(a,b,c,d){var e=d||0,f=new C;if(!a.g||!a.g.user_id)return 2>e?(P(a.logger,"Request require login, tried "+e),Fr(a).B(function(){e++;Ub(Ir(a,b,c,e),f)})):(N(a.logger,"Cannot do request, not login. Give up after "+e+" retry"),f.F()),f;d=Gr(a,b,c);a.request(b,d.keys,d.values,function(d,k){k.Ga()&&x(d)?11==d.number&&/invalid/i.test(d.name)?(this.g=null,Ub(Ir(a,b,c,e),f)):f.D(d):f.F(k.N()+" "+k.Ma())},a);return f}
h.query=function(a,b){if(!u(a)||0==a.length)return E("invalid query");for(var c=[],d=0;d<a.length;d++){var e=a[d],f=e.limit||5,g=e.offset||0,k=!!e.reverse;if(!x(e))return E("invalid query at "+d+"");var l=e.store;if(-1==Mq.indexOf(l))return E("invalid store name at "+d+": "+l);var m=e.index||"id",n=null;null!=e.key?(n=e.key,"ydn$phones"==m?n=Kn(n):"ydn$emails"==m&&(n=n.toLowerCase()),n=e.prefix?Ij(n):S.only(n)):null!=e.keyRange&&(n=Jj(e.keyRange));"id"==m?b?c.push(this.db.keys(l,n,f,g,k)):c.push(this.db.values(l,
n,f,g,k)):vm(this.db,l,m)?b?c.push(this.db.keys(l,m,n,f,g,k)):c.push(this.db.values(l,m,n,f,g,k)):c.push($b([]))}return(new Lm(c)).w(function(c){for(var d=0;d<c.length;d++)if(c[d][0]){if(a[d].result=c[d][1],!b)for(var e=0;e<a[d].result.length;e++)a[d].result[e]._module=a[d].store}else M(this.logger,"query "+d+" failed."),a[d].result=[];return a},function(b){M(this.logger,"list failed "+b);return a},this)};
h.values=function(a,b){if(u(a)||!x(a))return E("invalid query");var c=a.limit||5,d=a.offset||0,e=!!a.reverse,f=a.store;if(-1==Mq.indexOf(f))return E("invalid store name : "+f);var g=a.index||"id";if(!v(g)||0==g.length)return E("index name missing in "+f);var k=null;null!=a.key?(k=a.key,"ydn$phones"==g&&v(k)?k=Kn(k):"ydn$emails"==g&&v(k)&&(k=k.toLowerCase()),k=a.prefix?Ij(k):S.only(k)):null!=a.keyRange&&(k=Jj(a.keyRange));return"id"==g?b?this.db.keys(f,k,c,d,e):this.db.values(f,k,c,d,e):vm(this.db,
f,g)?b?this.db.keys(f,g,k,c,d,e):this.db.values(f,g,k,c,d,e):E("invalid index name: "+g+" for "+f)};
h.search=function(a){if(!u(a)||0==a.length)return E("invalid query");for(var b=[],c=pr(this.T),d=0;d<a.length;d++){var e=a[d];if(!x(e))return E("invalid query at "+d+"");var f=e.q;if(!v(f)||0==f.length)return E("query term missing "+d+"");var g="ft-"+e.store+"-"+(e.index||"name");0<=zb(c.fullTextCatalogs,function(a){return a.name==g})?(f=this.db.search(g,e.q),e.fetchFull&&(f=f.B(function(a){if(0<a.length){for(var b=[],c=0;c<a.length;c++)b.push(new Ok(a[c].storeName,a[c].primaryKey));return this.db.values(b).B(function(b){for(var c=
0;c<b.length;c++)a.record=b[c];return a})}},this)),b.push(f)):b.push($b([]))}return(new Lm(b)).w(function(b){for(var c=0;c<b.length;c++)b[c][0]?a[c].fullTextResult=b[c][1]:(M(this.logger,"query "+c+" failed."),a[c].fullTextResult=[]);return a},function(b){M(this.logger,"list failed "+b);return a},this)};
function Nr(a,b,c,d){var e={module_name:b},f="get_entry";d?(e.query=d+" = '"+c+"'",e.order_by="id",f="get_entry_list"):e.id=c;return Ir(a,f,e).B(function(a){if(a&&a.entry_list&&x(a.entry_list[0]))return Cr(a.entry_list[0]);N(this.logger,"record "+b+":"+c+" not found.");return null},a)}
function Or(a){if(a.isLogin()){var b="login_data/"+a.g.user_id;return a.db.get("Meta",b).B(function(a){var d=Nr(this,"Users",this.g.user_id).B(function(d){a&&a.date_modified==d.date_modified||this.db.put("Meta",d,b)},this);return a?a:d},a)}return E("Not login")}
function Pr(a,b,c,d){if(!v(c)||0==c.length)return E("record id required.");if(0<=Mq.indexOf(b)){var e;d?(e=S.only(c),e=a.db.values(b,d,e).B(function(a){return a[0]},a)):e=a.db.get(b,c);return e.B(function(a){if(!a)return Nr(this,b,c,d)},a)}return 0<=Lq.indexOf(b)?Nr(a,b,c,d):E("module: "+b+" not registerred")}
function Qr(a){if(a.i&&a.i.isLogin)return $b(a.i);var b=new C;a.db.get("Meta","info/server").ea(function(a){a&&a.version?(this.i=a,b.D(a)):this.request("get_server_info",[],[],function(a,c){if(0==c.N())this.i=null,b.F("service "+(this.o+"/service/v4/rest.php")+" not responding");else if(c.Ga()){var f=uj(c);if((!a||!a.version)&&v(f))try{a=JSON.parse(f)}catch(g){a=uj(c)}if(a&&a.version){var f=a,k={},l;for(l in f)k[l]=f[l];this.i=k;b.D({info:f,about:Rr(this)});this.db.put("Meta",f,"info/server")}else this.i=
null,b.F("invalid respond "+uj(c))}else this.i=null,b.F("request fail "+c.N()+" "+c.Ma())},this)},a);return b}function Sr(a){var b=new C;a.request("get_available_modules",["filter"],["all"],function(a){b.D(a)},a);return b}function Rr(a){var b=a.j,b=b instanceof Ho&&/proxy/.test(b.i);return{baseUrl:a.o,domain:a.h,userName:a.l,isLogin:a.isLogin(),hostPermission:!b}}function Tr(a){return(new Lm([Qr(a),Sr(a)])).B(function(a){return{serverInfo:a[0][1],availableModules:a[1][1],about:Rr(this)}},a)}
function Ur(a,b,c){var d=[],e;for(e in c)d.push({name:e,value:c[e]});var f={module_name:b,name_value_list:d};return Ir(a,"set_entry",f).B(function(a){if(a&&a.id){var c={id:a.id};a=a.entry_list||{};for(var d in a)c[d]=a[d].value;for(var e in c)"date_modified"!=e&&(f[e]=c[e]);this.db.put(b,f);Mr(this,b);return c}throw Error("creating "+b+" entry fail");},a)}
function Vr(a,b,c){if(c){var d=Wr(b,Xr,a.h,void 0,c.id),e=d.module,f=new qr(a.h,e,c);N(a.logger,"synchronizing "+b+" to "+f);if(tr(f)==d.h){var g=new cp("update-gdata-record");dp(g,c);b=b.data;x(b)&&rm(b);Ar(b,c)&&Ur(a,e,c).w(function(a){x(a)?g.g=rm(a):g.g=a;this.history.add(g)},function(a){M(this.logger,"Fail to put record "+c.id+" to server "+a.message)},a)}}}
function Yr(a,b){for(var c=Zr(b),d=0;d<c.length;d++)0<=Mq.indexOf(c[d].module)&&a.db.get(c[d].module,c[d].g).B(function(a){Vr(this,b,a)},a)}function $r(a,b,c){var d={};Ar(c,d);return Ur(a,b,d)}h.isLogin=function(){return!!this.g&&!!this.g.user_id};
h.update=function(){if(this.j&&this.j instanceof Ho)this.logger.info(this+" updating skipped since no direct connection is not available.");else{var a;if(this.G)zf(this.logger,"Modules are already updating now at "+a+" / "+Mq.length);else{this.G=!0;this.p=A();a=0;var b=this,c=function(){var d=Mq[a];d?(N(b.logger,"Syncing module "+d),a++,Mr(b,d).ea(function(){b.p=A();r.setTimeout(function(){c()},500)})):(zf(b.logger,"Updating module done"),b.G=!1)};c();r.setTimeout(function(){2E3<b.p-A()&&c()},2E3)}}};
function Fr(a){if(!window.navigator.onLine){var b=new C;chrome.storage.local.get("last-login",function(c){(c=c["last-login"])&&Ub(a.db.get("Meta","login_data/"+c).B(function(a){this.g=a},a),b)});return b}if(!a.l)return E("username required.");if(!a.C)return E("password required.");b=new C;a.request("login",["user_auth","application_name","name_value_list"],[{user_name:a.l,password:a.C},"Yathit CRM",{language:"",notifyonsave:"false"}],function(a,d){if(a&&a.id){this.g=Cr(a);this.g.id=a.id;var e={};
e["last-login"]=this.g.user_id;chrome.storage.local.set(e);b.D(a)}else a&&a.description?b.F(a.description+" ("+a.name+")"):(e=d.N()+" "+d.Ma()+" "+uj(d),b.F("Login fail: "+e.substr(0,200)))},a,!0);return b}
function as(a){var b=new C;if(a.g&&a.g.user_id){var c="login_data/"+a.g.user_id;chrome.storage.local.remove("last-login");a.db.remove("Meta",c)}a.request("logout",[],[],function(a,c){this.g=null;c.Ga()?(M(this.logger,"Logout request fail with "+c.N()+" "+c.Ma()),b.D(!0)):b.F(c.N()+" "+c.Ma())},a,!0);return b}
function bs(a){function b(){f.request(new si(e.toString())).execute(function(a,b){/sugarcrm/i.test(uj(b))?d.F("Look like SugarCRM web site, but REST V4 API is not available."):200==b.N()?d.F("Not a SugarCRM web site"):d.F("Invalid respond, "+b.N())})}function c(a,b){var c=new Zd;c.add("method","get_server_info");c.add("input_type","json");c.add("response_type","json");c.add("rest_data","{}");f.request(new si(a,"POST",{},{"Content-Type":"application/x-www-form-urlencoded"},c.toString())).execute(b)}
var d=new C;a=a.trim();va(a,"http")||(a="https://"+a);var e=new Sd(a);Yd(e,"");Xd(e,null);var f=qi("proxy"),g=e.ha();a=e.Ec;/rest.php$/.test(a)||(/index.php$/.test(a)?Wd(g,a.replace("/index.php","")):Wd(g,""));var k=g.toString();(function(a,b){c(a+"/service/v4/rest.php",function(a,c){if(200==c.N()){if(!a||!a.version){var d=uj(c);if(v(d))try{a=JSON.parse(d)}catch(e){b(null,c);return}else a=d}a&&a.version&&b(a,c)}else b(0,c)})})(k,function(a,f){a?(a.isLogin=!1,a.userName=null,a.domain=g.Mb,a.baseUrl=
k,d.D(a)):0==a?"https"==e.nc?(Td(g,"http"),setTimeout(function(){c(g.toString(),function(a,c){c.Ga()?d.D(a):b()})},100)):d.F(f.N()+" "+f.Ma()+" "+uj(f)):b()});return d}h.toString=function(){return"SugarClient:"+this.h};
function cs(a,b){var c=b&&v(b.assigned_user_id)?b.assigned_user_id:null;if(!v(c)||0==c.length)return E("assigned_user_id required");var d=A()-604800,d=Dr(new Date(d)),c=S.bound([c,d],[c,"\uffff"]),c=[new uk("Meetings",vr("Meetings"),c),new uk("Calls",vr("Calls"),c),new uk("Tasks",vr("Tasks"),c),new uk("Opportunities",vr("Opportunities"),c)],e=[];return Jm(a.db,function(a,b){for(var c=[],d=0;d<b.length;d++)b[d]&&(e.push(b[d]),c[d]=!0);return c},c).B(function(){return e})}
function ds(a,b){var c=[],d=null,e=b||{},f=e.limit||10;(e=e.since)&&e instanceof Date&&(d=Dr(e),d=S.upperBound(d));for(e=0;e<Mq.length;e++)c[e]=new uk(Mq[e],"date_modified",d,!0,!0);var g=[];return Jm(a.db,function(a,b){for(var c=[],d=-1,e=null,q=0;q<b.length;q++)b[q]&&(e?e<b[q].date_modified&&(e=b[q].date_modified,d=q,c=[],c[q]=!0):(e=b[q].date_modified,d=q,c[q]=!0));0<=d&&(b[d]._module=Mq[d],g.push(b[d]));return g.length>=f?[]:c},c).B(function(){return g})}
function es(a,b,c){if("about"==b)return $b(Rr(a));if("activity-stream"==b)return ds(a,c);if("activity-upcoming"==b)return cs(a,c);if("details"==b)return Tr(a);if("get"==b)return Pr(a,c.module,c.id,c.index);if("fetch-module"==b)return Mr(a,c);if("info-module"==b)return x(c)&&v(c.module)&&(c=c.module),Lr(a,c);if("keys"==b)return a.values(c,!0);if("list-module"==b)return Sr(a);if("login-user"==b)return Or(a);if("put-record"==b||"new-record"==b){b=c.module;if(!b||-1==Lq.indexOf(b))return E("invalid module name: "+
b);c=c.record;return x(c)?Ur(a,b,c):E("record object required")}if("search"==b)return u(c)?a.search(c):E("query must be an array");if("query"==b)return a.query(c);if("server-info"==b)return Qr(a);if("rest"==b){if(!x(c))return E("REST parameter must be an object");b=c.method;c=c.params;return v(b)&&0!=b.length?x(c)?Ir(a,b,c):E("REST parameter must be an object"):E("method must be valid string")}return"values"==b?a.values(c):E("invalid req "+b)};function fs(a){Error.captureStackTrace?Error.captureStackTrace(this,fs):this.stack=Error().stack||"";a&&(this.message=String(a))}B(fs,Error);fs.prototype.name="ydn.gdata.error.InvalidAtomFormatError";function gs(a){Error.captureStackTrace?Error.captureStackTrace(this,gs):this.stack=Error().stack||"";a&&(this.message=String(a))}B(gs,Error);gs.prototype.name="ydn.gdata.error.IncompatibleError";var hs="atom app gd xhtml batch openSearch".split(" ");function is(a){if(!t(this.type))throw new di("Abstract class cannot be instantiated.");if(v(a))a={id:{$t:a}};else if(!t(a.id)||!v(a.id.$t))throw new Zh("Invalid GDataFeed");this.id=a.id.$t;this.data=a;t(this.data.entry)?u(this.data.entry)||(this.data.entry=[this.data.entry]):this.data.entry=[];this.j={};this.o={};a=u(this.data.entry)?this.data.entry.length:0;for(var b=0;b<a;b++){var c=this.data.entry[b],c=c.id?c.id.$t:c.Gg?c.Gg.$t:"";if(0==c.length)throw new fs("entry "+b);if(0==c.match(/\w+$/)[0].length)throw new fs("entry "+
b+" of "+c);var d=c.match(/\w+$/)[0];this.j[c]=this.data.entry[b];this.o[d]=this.data.entry[b]}this.i=!0;this.C=[];this.u=new Hh(function(){this.dispatchEvent(js)},300,this);this.og=null;this.h=NaN;this.p=void 0}B(is,Oh);var js="i";h=is.prototype;h.sf=function(){return this.kind};h.logger=Q("ydn.gdata.Feed");
h.Rb=function(a){var b=new C;P(this.logger,this+" receiving a task, ready: "+this.i);var c=this;this.i?(this.i=!1,b.ea(function(){P(c.logger,c+" finish the task.");c.i=!0;var a=c.C.shift();a&&a.call(this)}),a.call(this,b)):this.C.push(oa(y(a,this),b));return b};h.og=null;function ks(a){var b;if(!(b=a.og))if(a=a.ie(),t(a)){b=a;for(var c=0;c<mj.length;c++){var d=(0,mj[c])(a);if(d){b=d;break}}P(kj,"Resolving "+a+" to "+b);b=lj[b]||null}else b=lj["default"];return b}h.Ue=function(){this.dispatchEvent("e")};
h.Mf=function(){return hs};h.Jg=function(a){a.g()||M(this.logger,"Batch submission failed. "+a.responseText)};
h.Kc=function(a,b){var c=this.Mf(),d=void 0;t(c)||(c=hs);for(var e="",f=0;f<c.length;f++)var g=c[f],e=0==f?e+(' xmlns="'+Np[g]+'" '):e+(" xmlns:"+g+'="'+Np[g]+'" ');d=t(d)?"<id>"+d+"</id>":"";d=Xh("<feed"+e+">"+d+"</feed>");for(f=c=0;e=this.vc(f);f++)if(dq(e))bq(e,"");else if(eq(e.data)){var g="delete"==cq(e.data),k=!(!e.data.id||!e.data.id.$t);bq(e,null);var l=Zp(new Up(null,"entry",e.data),d.documentElement),m=l.getElementsByTagNameNS(Pp("batch"),"operation");m[0]?m=m[0]:m=l.appendChild(d.createElementNS(Pp("batch"),
"operation"));l=d.createAttribute("type");l.nodeValue=g?"delete":k?"update":"insert";m.setAttributeNode(l);bq(e,"committed");c++;a&&a.message({id:this.rf(),code:"operation: "+l.nodeValue+" "+e})}if(0==c)return zf(this.logger,this+" Nothing to commit."),0;zf(this.logger,this+" committing "+c+" entries.");d=Yh(d);b?(this.logger.info("Commit ignored for dry run."),window.console.log(d)):(e=y(this.Jg,this),this.G&&this.G.stop(),f=ks(this),g=this.ue(),f.send(g,e,{method:"POST",body:d,headers:{"Content-Type":"application/atom+xml"},
params:{}}));return c};h.he=function(a){return new $p(a)};h.vc=function(a){return 0<=a&&a<this.data.entry.length?this.he(this.data.entry[a]):null};h.qf=function(a){return(a=this.j[a])?this.he(a):null};
h.save=function(a){if(this.store){var b=this;this.l||(this.l=new Hh(function(){this.Rb(function(a){var d=b.toJSON(),e=b.data.entry,f,g,k;b.store.V(function(a){a.put("ydn.gdata.feed",d).Ic(function(a){throw a;}).B(function(){f=!0});a.put("ydn.gdata.entry",e).Ic(function(a){throw a;}).B(function(a){k=a.length;g=!0})},["ydn.gdata.feed","ydn.gdata.entry"],"readwrite").w(function(){f&&g?P(this.logger,b+": saved "+k+" entries."):P(this.logger,b+": saved failed"+e.length+" entries.");a.D(!0)},function(a){throw a;
},this)})},1E3,this));a?Jh(this.l):Ih(this.l)}};
function ls(a,b,c){c=c||new C;var d=ks(a);if(!d)return M(a.logger,a+": No transport available."),c.F(Error("No transport available.")),c;d.send(b,function(b){if(200==b.status){a.h=A();b=b.U?Lf(b.U.responseText):void 0;if(!b.feed)throw new fs("feed missing.");var d=b.feed;if(!t(d))throw b=Uh(d),new fs(b.substr(0,50));if(d.id.$t!=a.H())throw new gs(d.id.$t+" is not "+a.H());var g=b=0,k=u(d.entry)?d.entry:d.entry?[d.entry]:[];b=k.length;0==b&&P(a.logger,a+": fetch return no result.");for(var l=0;l<b;l++){for(var m=
a,n=k[l],p=n instanceof $p?n:m.he(n),q=p,s=0;s<q.sc.length;s++)null!=q.data[q.sc[s]]&&!u(q.data[q.sc[s]])&&(q.data[q.sc[s]]=[q.data[q.sc[s]]]);bq(q,null);q=q.data;q.batch$status&&(q.batch$status=void 0);q.batch$operation&&(q.batch$operation=void 0);var q=p.H(),w=m.qf(q);(s=!!w)?w.update(p):(w=aq(p),m.data.entry.push(n),m.j[q]=p.data,m.o[w]=p.data);!s&&g++}zf(a.logger,a+" "+b+" ("+g+" new) entries received");a.Ue();(d=fp(d,"next"))?(a.save(),Ih(a.u),a.p=d.$t,ls(a,d.href,c)):(0<b&&(a.save(),Ih(a.u)),
c.D(!0))}else M(a.logger,"Fetching "+b.uri+" failed: "+b.status),c.F(!1)});return c}h.toString=function(){return this.type+":"+this.id};function ms(a,b){a.vg&&b.g.set("v",a.vg);b.g.set("alt","json");b.g.set("showdeleted",!0)}
function ns(a,b){var c="lu",d=!1;if("lf"==c){if(a.h){var d=!0,e=new Date(a.h),e=e.toISOString();b.g.set("updated-min",e)}}else if("lu"==c){for(var e=0,f=-1,g,k=0;g=a.vc(k);k++)g=g.data.updated.$t,e<g&&(e=g,f=k);if(e=a.vc(f))e=new Date(e.data.updated.$t),e=new Date(1+ +e),e=e.toISOString(),b.g.set("updated-min",e)}else"lo"==c?(b.g.set("orderby","lastmodified"),a.h&&b.g.set("max-results","1")):c="no";P(a.logger,a+" updating "+(d?"continue":"begin")+" by "+c)}h.Zh=Kp.prototype.ce;h.H=Kp.prototype.H;
h.ai=Kp.prototype.Uh;h.$h=Kp.prototype.Th;h.ie=function(){return this.ai()||""};h.rf=function(){return this.id};h.ue=function(){return this.$h()};function os(a){return a.Rb(function(a){var c=new Sd(this.ie());ms(this,c);ns(this,c);this.S(Mh,!1);ls(this,c.toString()).ea(function(c){Ph(this);c?a.D(!0):a.F(void 0)},this)})}h.update=function(a){return a||!0!==("undefined"==typeof this.g?null:(this.g&Mh)==Mh)?os(this):(P(this.logger,this+" already loaded."),$b(!1))};
h.count=function(a){if(a){a=0;for(var b,c=0;b=this.vc(c);c++)dq(b)||"deleted"==cq(b.data)||a++;return a}return this.data.entry.length};h.toJSON=function(){return{id:this.id,key:this.rf(),last_fetch_next_uri:this.p,last_fetch:this.h}};function ps(a){var b,c=a.match(/^\D*0*(\d{1,2}\D)?\D*0*(.+)/);c?(b=c[1].replace(/\D/g,""),a=c[2].replace(/\D/g,"")):a=a.replace(/\D/g,"");return{ub:b,gb:a}}function qs(a,b){var c=ps(a),d=ps(b);if(t(c.ub)&&t(d.ub)&&0!=c.ub.length&&0!=d.ub.length&&c.ub!==d.ub)return 0;if(t(c.fb)&&0!=c.fb.length){if(t(d.fb)&&0!=d.fb.length){if(c.fb.length>=d.fb.length){for(var e=0;e<d.fb.length;e++)if(c.fb[e]!=d.fb[e])return 0;return 1}for(e=0;e<c.fb.length;e++)if(c.fb[e]!=d.fb[e])return 0}return-1}return 1}
function rs(a,b){if(!a||!b||0==a.length||0==b.length)return 0;a=a.trim();b=b.trim();var c=ps(a),d=ps(b);return c.ub&&c.gb&&c.ub==d.ub&&c.gb==d.gb?6<=c.gb.length?1:4<=c.gb.length?0.8:0.4:c.gb&&4<=c.gb.length&&c.gb==d.gb?8<=c.gb.length?0.8:4<=c.gb.length?0.6:0.4:0};function ss(a){$p.call(this,a);a=(a=this.id.match(/https?:\/\/www.google.com\/m8\/feeds\/(group|contact|batch)s?\/([^\/]+)\/?(\w+)\/?(\w*)?/))?{ni:"m8",kind:a[1],user_id:a[2]?a[2].replace("%40","@"):"",projection:a[3],id:a[4]}:null;window.console.assert(!!a,"Invalid m8 entry: "+this.id);this.user_id=a.user_id;window.console.assert(a.kind==this.kind,"Invalid kind: "+a.kind+" vs "+this.kind)}B(ss,$p);ss.prototype.logger=Q("ydn.gdata.m8.Entry");ss.prototype.g="3.0";ss.prototype.type="m8";
ss.prototype.toString=function(){var a=this.id?aq(this):void 0;return"m8.Entry."+this.kind+":"+a};function ts(a){if(!t(this.kind))throw new di("Abstract class cannot be instantiated.");is.call(this,a);this.user_id=this.H()}B(ts,is);h=ts.prototype;h.sf=function(){return this.kind};h.vg="3.0";h.type="m8";h.toString=function(){return"Feed:"+this.kind+":"+this.user_id};h.ie=function(){return"https://www.google.com/m8/feeds/"+this.sf()+"s/"+this.user_id.replace("@","%40")+"/full?v=3.0"};
h.ue=function(){var a=ts.m.ue.call(this);return a?a:"https://www.google.com/m8/feeds/"+this.sf()+"s/"+this.user_id.replace("@","%40")+"/full/batch?v=3.0"};var us=hs.concat(["gContact"]);ts.prototype.Mf=function(){return us};function vs(a,b,c,d,e,f){this.scheme=a;this.domain=b;this.module=c;this.g=d;this.i=ha(e)?e:NaN;this.h=ha(f)?f:NaN}var Xr="sugarcrm";function ws(a){if(!x(a)||!v(a.value))return null;var b=xs(a.value);if(!b)return null;var c=NaN,d=NaN;if(v(a.label)){a=a.label;var e=a.indexOf("#"),f=a.indexOf("-");0<e&&0<f&&f>e&&(c=parseInt(a.substring(e,f),10),d=parseInt(a.substring(f),10))}return new vs(b[1],b[2],b[3],b[4],c,d)}function xs(a){return a?a.match(/(\w+):\/\/([^\/]+)\/([^\/]+)\/(.*)/):null}
vs.prototype.P=function(){return this.scheme+"://"+this.domain+"/"+this.module+"/"+this.g};function ys(a){ss.call(this,a)}B(ys,ss);h=ys.prototype;h.kind="contact";h.logger=Q("ydn.gdata.m8.ContactEntry");h.pf=function(){return"contact"};h.getName=function(a){var b=a?"":this.ed();if(a||0==b.length)a=this.data.gd$name,x(a)&&(b=a.gd$fullName.$t||"",0==b.length&&(b=(a.gd$givenName.$t||"")+" "+(a.gd$familyName.$t||"")));return Aa(b)};function zs(a){var b=a.data.gd$email;a=[];for(var b=u(b)?b:b?[b]:[],c=0;c<b.length;c++)a.push(b[c].address);return a}
function As(a){a=a.data.gd$phoneNumber;a=u(a)?a:x(a)?[a]:[];for(var b=[],c=0;c<a.length;c++)a[c].$t&&!ya(a[c].$t)&&b.push(a[c].$t);return b}h.we=function(){var a=ys.m.we.call(this);if(a.ydn$emails||a.ydn$xp||a.ydn$externalIds)a==this.data&&(a=rm(this.data)),delete a.ydn$emails,delete a.ydn$xp,delete a.ydn$externalIds;return a};h.sc="link category gd$email gd$im gd$organization gd$phoneNumber gd$structuredPostalAddress gd$formattedAddress".split(" ");
function Bs(a,b){function c(a){var b=yb(e,function(b){return b.address===a.address});b?b.rel=t(a.rel)?a.rel:b.rel:d(a)}function d(a){a=rm(a);f&&delete a.primary;t(void 0)&&(a.rel=void 0);e.push(a)}for(var e=[rm(a.data.gd$email[0])],f=!!a.data.gd$email[0].primary,g=1;g<a.data.gd$email.length;g++)c(a.data.gd$email[g]);for(g=0;g<b.length;g++)c(b[g]);g=$l(e,a.data.gd$email);g||(a.data.gd$email=e);return!g}
function Cs(a,b){function c(a){var b=vb(e,function(b){return rs(b.$t,a.$t)}),c=oi(b);if(0.4<c.value){var b=e[c.index],f=t(a.rel)?a.rel:b.rel;1==c.value?(b.rel=f,b.$t=a.$t):t(a.rel)&&t(b.rel)&&b.rel!==a.rel?d(a,f):(b.rel=f,c=qs(b,a),-1==c?b.$t=a.$t:0==c&&(b.$t=a.$t))}else d(a)}function d(a,b){a=rm(a);f&&delete a.primary;t(b)&&(a.rel=b);e.push(a)}for(var e=[rm(a.data.gd$phoneNumber[0])],f=!!a.data.gd$phoneNumber[0].primary,g=1;g<a.data.gd$phoneNumber.length;g++)c(a.data.gd$phoneNumber[g]);for(g=0;g<
b.length;g++)c(b[g]);g=$l(e,a.data.gd$phoneNumber);g||(a.data.gd$phoneNumber=e);return!g}h.$e=function(a,b){if("gd$phoneNumber"==a){if(null!=this.data.gd$phoneNumber)return Cs(this,b);this.data.gd$phoneNumber=rm(b);return!0}if("gd$email"==a){if(null!=this.data.gd$email)return Bs(this,b);this.data.gd$email=rm(b);return!0}return ys.m.$e.call(this,a,b)};
function Wr(a,b,c,d,e){a=a.data;a=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var f=0;f<a.length;f++){var g=ws(a[f]);if(g&&!(b&&b!=g.scheme||c&&c!=g.domain||e&&e!=g.g||d&&d!=g.module))return g}return null}function Zr(a){a=a.data;a=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var b=[],c=0;c<a.length;c++){var d=ws(a[c]);d&&b.push(d)}return b};function Ds(a){ts.call(this,a)}B(Ds,ts);h=Ds.prototype;h.logger=Q("ydn.gdata.m8.ContactFeed");h.kind="contact";h.Ue=function(){Ds.m.Ue.call(this)};h.qf=function(a){return Ds.m.qf.call(this,a)};h.he=function(a){return new ys(a)};h.vc=function(a){return Ds.m.vc.call(this,a)};h.ie=function(){return"https://www.google.com/m8/feeds/contacts/"+this.H()+"/full"};h.rf=function(){return"http://www.google.com/m8/feeds/contacts/"+this.H().replace("@","%40")};function Es(a){function b(a){va(a,"atom:")&&(a=a.substring(5,a.length));return a.replace("#text","$t").replace(/:/g,"$")}v(a)&&(a=Xh(a));var c={};if(1==a.nodeType){if(0<a.attributes.length)for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c[b(e.nodeName)]=e.nodeValue}}else 3==a.nodeType&&(c=a.nodeValue);if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++){var e=a.childNodes.item(d),f=b(e.nodeName);if("undefined"==typeof c[f])"content"==f?(c[f]={$t:Yh(e)},e.namespaceURI&&(c[f].xmlns=
e.namespaceURI)):c[f]=Es(e);else{if("undefined"==typeof c[f].length){var g=c[f];c[f]=[];c[f].push(g)}c[f].push(Es(e))}}return c};function Fs(a,b){this.id=b.replace("@","%40");this.client=this.g=null;this.i=new Kh(function(){zf(this.logger,"updating gdata "+this);Gs(this).w(function(a){this.logger.info(this+" synced, "+a+" new entries updated.")},function(){M(this.logger,this+" update failed.")},this)},6E4,this);this.j=a;this.h=null}h=Fs.prototype;h.logger=Q("ydn.ds.gdata.GData");h.update=function(){var a=this.i;a.da?a.ad=!0:Lh(a)};h.K=function(){return this.j};
function Hs(a){var b=new C;a.execute(function(a,d){a?b.D(a):b.F(d)});return b}
function Is(a,b){var c=(a.client?a.client:qi("gse")).request(b);return Hs(c).w(function(a){a=a.feed;if(!a.entry)return 0;for(var b=(new Ds(a)).Zh("next"),c=a.entry.length,g=!!this.h,k=0;g&&k<c;k++){var l=a.entry[k];l.gContact$externalId&&this.h(l)}return this.K().put(this.I(),a.entry).B(function(){return b?Is(this,new si(b.href)).B(function(a){return c+a},this):c},this)},function(a){M(this.logger,"fetching fail "+(a?a.N()+" "+a.Ma():""))},a)}h.getParams=function(){return{alt:"json"}};
h.get=function(a){return v(a)&&0!=a.length?this.K().get(this.I(),a):E("invalid key")};h.put=function(a){return this.K().put(this.I(),a)};h.ug=function(a){return new $p(a)};function Js(a,b){var c=a.ug(b);bq(c,"modified");return c.Kc().B(function(a){a=Es(a);var b=a.entry;if(!b||!b.id)throw Error("Invalid respond on saving gdata "+Th(a));delete b.updated;this.K().put(this.I(),b);return b},a)}
function Gs(a){if(!a.K().getName())return E(Error("database not ready"));if(!a.g){var b=new sk(a.I(),"updated.$t",null,!0);a.g=a.K().keys(b,1).B(function(a){var b=this.getParams();b.orderby="lastmodified";a[0]?(b.sortorder="descending",a=(new Date(1+ +new Date(a[0]))).toISOString(),b["updated-min"]=a):b.sortorder="ascending";return Is(this,new si(Ks(this)+"/full","GET",b)).ea(function(){this.g=null},this)},a)}return a.g}h.toString=function(){return"GData:contact:"+this.id.replace("%40","@")};function Ls(a,b){Fs.call(this,a,b)}B(Ls,Fs);Ls.prototype.I=function(){return"contact"};Ls.prototype.getParams=function(){var a=Ls.m.getParams.call(this);a.v="3.0";return a};function Ks(a){return"https://www.google.com/m8/feeds/contacts/"+a.id}Ls.prototype.ug=function(a){var b=!!a.id;b||(a.id={$t:Ks(this)+"/base/0"});var c=new ys(a);b||delete a.id;return c};function Ms(a,b){return v(b)?0==b.length?$b([]):a.K().values(a.I(),"ydn$emails",S.only(b),100,0,!1,!0):E("invalid key for email "+b)}
function Ns(a,b){var c=b.P();if(!v(c)||0==c.length)return E("invalid key for external id "+c);c=S.only(c);return a.K().values(a.I(),"ydn$externalIds",c).B(function(){},a)}
function Os(a,b,c){return a.K().get(a.I(),b).B(function(a){if(a){if(!c||!c.label||!c.value)return E("invalid external_id_data");var e=c.label,f=c.value;a.gContact$externalId=u(a.gContact$externalId)?a.gContact$externalId:a.gContact$externalId?[a.gContact$externalId]:[];for(var g=!1,k=0;k<a.gContact$externalId.length;k++)if(a.gContact$externalId[k].value==f){a.gContact$externalId[k].label=e;g=!0;break}g||a.gContact$externalId.push({label:e,value:f});return Js(this,a)}throw Error("gdata entry "+b+" not found");
},a)};function Ps(a){this.g=a;this.i=0;this.j=[];this.l=[0,0,0,0];this.h=new Kinetic.Layer;a=this.g/2;var b=a/3;this.o=[a,a,b,this.g-b];this.p=[a,b,this.g-b,this.g-b]}Ps.prototype.clear=function(){this.h=new Kinetic.Layer};var Qs=Math.pow(2,2),Rs=Math.pow(2,3),Ss=Math.pow(2,4),Ts=Math.pow(2,5);Ps.prototype.S=function(a,b){this.i=b?this.i|a:this.i&~a};
function Us(a){a.clear();for(var b=[["#C2C2C2","#6B6B6B","#525252","#3D3D3D"],["#FAFAFA","#D8D8D8","#D8D8D8","#C2C2C2"],["#FCCA03","#DD1812","#0140CA","#16A61E"]],c=["m252,324c0,-59.647 48.354,-108 108,-108c26.90799,0 51.51501,9.843 70.42401,26.121c1.03198,-8.564 1.57599,-17.27901 1.57599,-26.121c0,-119.126 -96.43701,-215.722 -215.49899,-215.994c40.89099,0.137 73.99899,33.321 73.99899,74.244c0,41.007 -33.24301,74.25 -74.25,74.25c-41.008,0 -74.25,-33.243 -74.25,-74.25c0,-40.979 33.19701,-74.203 74.16701,-74.248c-0.05602,0 -0.11201,-0.002 -0.16701,-0.002c-119.294,0 -216,96.707 -216,216c0,8.843 0.544,17.55701 1.577,26.121c18.908,-16.278 43.515,-26.121 70.423,-26.121c59.646,0 108,48.353 108,108c0,37.93399 -19.561,71.29401 -49.14301,90.56c26.127,11.21701 54.90701,17.44 85.14301,17.44s59.01599,-6.22299 85.14301,-17.44c-29.582,-19.26599 -49.14301,-52.62601 -49.14301,-90.56z",
"m142,74.25c0,41.007 33.242,74.25 74.25,74.25c41.00699,0 74.25,-33.243 74.25,-74.25c0,-40.923 -33.108,-74.107 -73.99899,-74.244c-0.112,0 -0.22301,-0.004 -0.334,-0.004c-40.97,0.045 -74.16701,33.269 -74.16701,74.248z","m180,324c0,-59.647 -48.354,-108 -108,-108c-26.908,0 -51.515,9.843 -70.424,26.121c9.366,77.69 59.967,142.67798 129.28099,172.43799c29.582,-19.26498 49.14301,-52.625 49.14301,-90.55899z","m430.42401,242.121c-18.909,-16.278 -43.51602,-26.121 -70.42401,-26.121c-59.646,0 -108,48.353 -108,108c0,37.93399 19.561,71.29401 49.142,90.56c69.315,-29.76199 119.91602,-94.74899 129.28201,-172.439z"],
d=b[0].slice(),e=[Qs,Rs,Ss,Ts],f=0;f<e.length;f++){var g=e[f];(a.i&g)==g&&(d[f]=b[2][f])}b=new Kinetic.Group({scaleX:a.g/435,scaleY:a.g/435});e=new Kinetic.Group;for(f=0;f<c.length;f++)a.j[f]=new Kinetic.Path({data:c[f],fill:d[f]}),0<a.l[f]&&(g=a.g/19*8,g=new Kinetic.Text({x:a.o[f]-g/4,y:a.p[f]-g/2,text:String(a.l[f]),fontSize:g,fontFamily:"sans-serif",fill:"white"}),e.add(g)),b.add(a.j[f]);a.h.add(b);a.h.add(e);return a.h};function Vs(a){this.g=document.createElement("div");this.h=a||19;this.i=new Ps(this.h);this.j=new Hh(function(){this.render()},100,this);chrome.runtime.onSuspend&&chrome.runtime.onSuspend.addListener(function(){chrome.browserAction.setTitle({title:"suspended"});this.S(Rs,!1);this.S(Ss,!1);this.S(Ts,!1);this.S(Qs,!1);this.render()}.bind(this))}Vs.prototype.n=function(){return this.g};Vs.prototype.S=function(a,b){this.i.S(a,b);Jh(this.j)};
Vs.prototype.render=function(){this.g.parentElement||document.body.appendChild(this.g);(new Kinetic.Stage({container:this.g,width:this.h,height:this.h})).add(Us(this.i));if(chrome.browserAction){var a=this.g.querySelector("canvas"),b=a.getContext("2d");chrome.browserAction.setIcon({imageData:b.getImageData(0,0,a.width,a.height)})}};function Yo(a,b){this.g=a;this.filter=b||null;var c=this;setTimeout(function(){Ws(c)},6E5*Math.random())}
function Ws(a){var b=a.g.getName(),c={"Content-Type":"application/json"};a.g.values("log",null,20).B(function(a){if(0!=a.length){var e=a.map(function(a){return a.key});a=JSON.stringify(a);a=new si("https://mhardartway.s3.amazonaws.com/"+(b+"/"+e[0]),"PUT",null,c,a);var f=qi(),e=e.map(function(a){return new Ok("log",a)});f.request(a).execute(function(a,b){b.Ga()&&this.g.remove(e).B(function(a){a==e.length&&Ws(this)},this)},this)}},a)}Yo.prototype.log=function(){};function Xs(){this.V=null;this.g={};this.h=null;var a=this.O=new ui,b=chrome.extension.getURL("option-page.html");a.p=b;this.C=new wo;this.j=this.p=this.l=this.u=null;this.G=new Sg(new Wg,"XMLHttpRequest"+location.host);this.i=new Vs;this.o={};chrome.permissions.onAdded.addListener(this.qh.bind(this))}h=Xs.prototype;h.logger=Q("ydn.crm.app.App");
h.qh=function(a){for(var b=(a=a.origins)?a.length:0,c=0;c<b;c++){var d=a[c].match(/https:\/\/([^\/]+)/);if(d){var d=d[1],e=this.g[d];if(e){zf(this.logger,"host permission granted to "+e);if(e.j instanceof Ho){var f=qi("default");this.g[d]=new Er(f,e.O,e.o,e.l,e.C);this.g[d].update()}Ys(this,{req:"host-permission",data:{grant:d}})}}}};h.init=function(){N(this.logger,"init "+this);this.i.S(Qs,!0);$o()};
function Zs(a,b){return Fr(b).B(function(){var a=b.isLogin()?b.l+"@":" (not login) ";this.logger.info("connected to sugarcrm client: "+a+b.h);b.isLogin()&&(b.update(),$s(this));return Rr(b)},a)}
function at(a,b){var c=b.baseUrl,d=b.domain||c;if(!d)return E("domain or url required.");d=d.trim();va(d,"http")&&(d=ee(new Sd(d)));/\//.test(d)&&(d=ee(new Sd("https://"+d)));if(c&&(c=c.trim(),!va(c,"http"))){var c=c.replace(/:?\/\//,""),e=new Sd("https://"+c);e.Ec||Wd(e,"/");c=e.toString()}var f=a.g[d],g="sugar-client-"+d,k=a.G.get(g)||{};if(f)return f.isLogin()?$b(Rr(f)):Zs(a,f);var l=b.userName||k.userName;c||(c=k.base_url);c||(c="https://"+d+"/");if(!l)return N(a.logger,"username not found in "+
JSON.stringify(b)),E("username required");var m=b.password;m?b.hashed||(m=CryptoJS.MD5(m).toString()):m=k.password;if(!m)return N(a.logger,"password not found in "+JSON.stringify(b)),E("password required.");k.userName=l;k.password=m;k.base_url=c;var e={origins:[c+"/"]},n=new C;chrome.permissions.contains(e,function(b){b||M(a.logger,"host permission required for "+c);b=b?qi("default"):qi("proxy");f=new Er(b,a,c,l,m);a.g[d]=f;b=Zs(a,f);b.B(function(){a.G.set(g,k);var b=Object.keys(a.g);Co(a.C,b);Ys(a,
{req:"list-sugarcrm",data:b})},a);Ub(b,n)});return n}function bt(a,b,c,d){return 0<=Lq.indexOf(b)?a.h.get(c).B(function(a){if(a){var f=Lq[Lq.indexOf(b)];return $r(d,f,a).B(function(a){if(a&&a.id)return a;throw Error("Set Entry to "+f+" failed");},this)}throw Error("contact entry "+c+" not found");},a):E(new Zh("invalid module name "+b))}
function ct(a,b){var c=new qr(b.domain,b.module,b.obj),d={};Br(c,d);c=new vs(Xr,c.domain,c.module,c.H(),NaN,tr(c));d.gContact$externalId=[{label:c.module+"#"+c.i+"-"+c.h,value:c.P()}];return Js(a.h,d)}function Kr(a,b){var c=new vs(Xr,b.domain,b.module,b.H());Ns(a.h,c).B(function(a){for(var c=0;c<a.length;c++){var f=a[c];0<Br(b,f)&&this.h.put(f)}},a)}function $s(a){var b=!1,c;for(c in a.g)if(a.g[c].isLogin()){b=!0;break}a.i.S(Qs,!0);a.i.S(Ts,a.isLogin());a.i.S(Rs,b)}
function dt(a,b){if(!b)return E("domain required");a.G.remove("sugar-client-"+b);return Bo(a.C).B(function(a){a=a||[];var d=a.indexOf(b),e=this.g[b];delete this.g[b];0<=d&&(a.splice(d,1),Co(this.C,a),Ys(this,{req:"list-sugarcrm",data:a}));return e.isLogin()?as(e).B(function(){this.logger.info("SugarCRM "+b+" removed.");$s(this);return!0},this):!1},a)}
h.Ch=function(a){for(var b=u(a.gContact$externalId)?a.gContact$externalId:[a.gContact$externalId],c=0;c<b.length;c++)if(b[c]&&b[c].value&&b[c].label){var d=xs(b[c].value);d&&"sugarcrm"==d[1]&&(d=d[2],this.g[d]&&Yr(this.g[d],new ys(a)))}};function et(a){a.h=new Ls(a.C.g,a.j.email);var b=qi("gse");a.h.client=b;a.h.h=a.Ch.bind(a);a.h.update()}
function ft(a,b){var c=new C,d=b.email||"";if(a.j&&a.j.email==d)return N(a.logger,"already running for "+d),c.D(a.j),c;a.j=b;a.j.updated=A();d?(a.logger.info(d+" login to YDN server"),Zo(a),xo(a.C,b.Id.$t),et(a),Bo(a.C).B(function(a){a=a||[];for(var b=0;b<a.length;b++)a[b]&&at(this,{domain:a[b]})},a),c.D(a.j),a.isLogin()?(a.i.S(Ts,!0),chrome.browserAction.setTitle({title:"Yathit 0.8.9 Ready"})):(a.i.S(Ts,!1),chrome.browserAction.setTitle({title:"Login required."}))):(a.logger.info("Not login to YDN server"),
c.D(a.j),a.i.S(Ts,!1),chrome.browserAction.setTitle({title:"Login required."}));return c}function gt(a){var b=new C;bp().request(new si("/token","DELETE")).execute(function(a,d){d.Ga()?(this.l=this.u=null,b.D(null)):b.F("error "+d.Ma())},a);return b}
function ht(a,b){var c=x(b)?b:{last_login:"1"},d=bp(),c=new si("/audit","GET",c),e=new C;d.request(c).execute(function(a,b){if(b.Ga()){if(a.LastLoginRecord){var c=a.LastLoginRecord;if(c.timestamp){var d;d=c.timestamp-A();d=Math.abs(d);if(6E4>d)d="0 minutes";else{var m=Math.floor(d/864E5);d%=864E5;var n=Math.floor(d/36E5),p=Math.floor(d%36E5/6E4),q=ne(m),s=ne(n),w=ne(p);d=m*(n+p)?" ":"";var z=n*p?" ":"",m=bf("{COUNT, plural, =0 {}=1 {{TEXT} day}other {{TEXT} days}}",m,q),n=bf("{COUNT, plural, =0 {}=1 {{TEXT} hour}other {{TEXT} hours}}",
n,s),p=bf("{COUNT, plural, =0 {}=1 {{TEXT} minute}other {{TEXT} minutes}}",p,w);d=m+(d+(n+(z+p)))}c.ago=d}}e.D(a)}else e.F(b)},a);return e}
function Ej(a,b){if(a.l)return a.l;if(a.u&&a.u.expires>A())return $b(a.u);a.l=new C;var c={url:b||chrome.extension.getURL("option-page.html")},c=new si("/token","GET",c);bp().request(c).execute(function(a,b){if(b.Ga()){var c=a.Tokens[0];c.has_token?(c.expires=1E3*c.expires_in+A(),this.u=c,this.l.D(c)):this.l.F(c)}else this.u=null,this.l.F(b);this.l=null},a);return a.l}function Ys(a,b){delete b.id;for(var c in a.o)a.o[c].port.postMessage(b)}h.isLogin=function(){return!!this.j&&this.j.is_login};
function it(a,b){if(a.p)return a.p;a.p=vi(a.O,b).B(function(b){return ft(this,b).B(function(){a.isLogin()?setTimeout(function(){a.p=null},9E5):a.p=null},function(a){this.logger.info("Attamping to login YDN server fail: "+Th(a))})},a);return a.p}function jt(a){a.p=null;a.j=null;a.i.S(Ts,!1)}h.toString=function(){return"SugarApp:0.8.9"};function kt(){Xs.call(this);lt(this)}B(kt,Xs);kt.prototype.logger=Q("ydn.crm.app.EventPage");
function mt(a,b,c){var d=c.req;c.done=!0;var e=null!=c.data?c.data:{};N(a.logger,"service req: "+d+":"+c.id);if("app-setting"==d)c.data=r.localStorage.getItem("app-setting"),b.postMessage(c);else if("echo"==d)N(a.logger,"resp: "+d+":"+c.id),b.postMessage(c);else if("export-record"==d)ct(a,e).w(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="failed to create a new entry";b.postMessage(this)},c);else if("feed-log"==d){var f=
e.offset||0,e=e.limit||100;Oo.g.values("db-logger",null,e||100,f||0,!0).ea(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c)}else if("feed-log-info"==d)f=e.offset||0,e=e.limit||100,Qo(e,f).ea(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("gdata-fetch"==d)e=c.data,"contact"==e?a.h?Gs(a.h).w(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):(c.error="gdata not ready",
b.postMessage(c)):(c.error="invalid kind "+e,b.postMessage(c));else if("gdata-list-contact-by-email"==d)Ms(a.h,c.data).B(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("gdata-token"==d)Ej(a,c.data).ea(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("gdata-token-revoke"==d)gt(a).w(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){N(a.logger,"resp: "+
this.req+":"+this.id);this.data=c;b.postMessage(this)},c);else if("list-sugarcrm"==d){e=[];for(f in a.g)e.push(Rr(a.g[f]));N(a.logger,"resp: "+c.req+":"+c.id);c.data=e;b.postMessage(c)}else"log-bug"==d?(jj(c.data),b.postMessage(c)):"login-info"==d?it(a,c.data).w(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="InvalidLoginError:"+(a&&a instanceof Error?a:"");b.postMessage(this)},c):"logged-in"==d?(it(a,null).B(function(b){Ys(a,
{req:d,info:b})}),b.postMessage(c)):"logged-out"==d?(jt(a),Ys(a,{req:d}),b.postMessage(c)):"new-entry"==d?x(c.data)?Js(a.h,c.data).w(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(a){this.data=a;this.error="failed to create a new entry";b.postMessage(this)},c):(c.error="Invalid gdata entry data",b.postMessage(c)):"new-sugarcrm"==d?at(a,c.data).w(function(){N(a.logger,"resp: "+this.req+":"+this.id);this.data=!0;b.postMessage(this)},function(a){this.error=
a;b.postMessage(this)},c):"remove-sugar"==d?dt(a,c.data).ea(function(a){this.data=a;b.postMessage(this)},c):"server-audit-log"==d?ht(a,e).w(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},c):"sugar-server-info"==d?(e=c.data,e=/https?:/.test(e)?new Sd(e):Ud(new Sd,e),(e=a.g[e.Mb])?Qr(e).B(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},c):bs(c.data).w(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;
b.postMessage(this)},function(c){N(a.logger,"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},c)):"user-setting"==d?Eo().B(function(a){this.data=a;b.postMessage(this)},c):M(a.logger,"Main channel unknown req: "+d)}
function nt(a,b,c,d){var e=d.req;d.done=!0;N(a.logger,"sugar service req: "+c+":"+e+":"+d.id);if(a.isLogin())if("echo"==e)b.postMessage(d);else if("import-gdata"==e){var f=d.data,g=f?f["gdata-id"]:"";g?bt(a,f.module,g,c).w(function(a){this.data=a;b.postMessage(this)},function(a){this.error=a;b.postMessage(this)},d):(M(a.logger,"resp error: "+e+":"+d.id),d.error="gdata id required",b.postMessage(d))}else"link"==e?(c=a.h,(e=d.data["gdata-id"])?Os(c,e,d.data["external-id"]).w(function(a){this.data=a;
b.postMessage(this)},function(c){M(a.logger,"error linking gdata "+this.req+":"+this.id);this.error=c.name+": "+c.message;b.postMessage(this)},d):(d.error="gdata-id not required",b.postMessage(d))):"login"==e?at(a,d.data).w(function(c){this.data=c;b.postMessage(this);$s(a)},function(a){this.error=a;b.postMessage(this)},d):"sync-entry"==e?(e=d.data,a.h.get(e).w(function(c){c?new ys(c):(c="GData entry "+this.data+" not found.",N(a.logger,c),this.error=c,b.postMessage(this))},function(c){N(a.logger,
"resp error: "+this.req+":"+this.id+" "+c);this.error=c;b.postMessage(this)},d)):es(c,e,d.data).w(function(c){N(a.logger,"resp: "+this.req+":"+this.id);this.data=c;b.postMessage(this)},function(c){N(a.logger,"resp error: "+this.req+":"+this.id+" "+(c&&c instanceof Error?c.name+" "+c.message:c));this.error=c;b.postMessage(this)},d);else d.error="Not login",b.postMessage(d)}
function ot(a){var b=!1,c;for(c in a.o)if("gmail"==a.o[c].group){b=!0;break}var d=!1;for(c in a.g)if(a.g[c].isLogin()){d=!0;break}chrome.browserAction.setTitle({title:"Yathit 0.8.9"});a.i.S(Qs,!0);a.i.S(Ts,a.isLogin());a.i.S(Rs,d);a.i.S(Ss,b)}kt.prototype.T=function(){var a=Object.keys(this.g)[0];return{sugars:this.g,s0:a?this.g[a]:null,gdata:this.h,ports:this.o,user_info:this.j}};
function lt(a){var b="";chrome.runtime.onMessage.addListener(function(c,d,e){var f=d.url;f&&/https?:\/\/mail.google.com/.test(f)?(d=c?c.req:null,"inject"==d&&b!=c.id?(b=c.id,chrome.storage.local.get("ydn-crm-src",function(b){var c=b["ydn-crm-src"];zf(a.logger,"injecting "+c+" to "+f);chrome.tabs.executeScript(null,{file:c},function(){chrome.tabs.executeScript(null,{code:"app = runInjApp();"},function(){zf(a.logger,c+" injected")})})}),e(c)):"attach"==d&&(zf(a.logger,"attaching crm-ex/sidebar.html to "+
f),chrome.tabs.executeScript(null,{code:'var parent = document.getElementById("'+c.parent+'");var f = document.createElement("iframe"); f.src = "crm-ex/sidebar.html"; parent.appendChild(f);'},function(){zf(a.logger,"crm-ex/sidebar.html attached");e("crm-ex/sidebar.html")}))):zf(a.logger,"invalid sender "+f)});chrome.runtime.onConnect.addListener(function(b){var d=b.sender.url,e=b.name.substr(0,b.name.lastIndexOf("-"));Ab(Dd,e)?(zf(a.logger,"Channel "+b.name+" connected for "+d),a.o[b.name]={name:b.name,
group:e,port:b},ot(a),b.onMessage.addListener(function(d){if(d&&x(d)){if("close"==d.req)a.logger.info("closing "+b.name),delete a.o[b.name],b.disconnect(),ot(a);else if(!d.id){M(a.logger,"Unknown group in pipe info "+b.name);return}if("sugarcrm"==d.group){var e=d.name,k=a.g[e];k?nt(a,b,k,d):M(a.logger,"SugarCRM instance "+e+" not found.")}else"gmail"!=d.group&&"dev"!=d.group&&"hostper"!=d.group&&"popup"!=d.group&&"options"!=d.group&&mt(a,b,d)}else M(a.logger,"invalid message package: "+d)}),b.onDisconnect.addListener(function(){zf(a.logger,
"disconnected "+b.name);delete a.o[b.name];ot(a)})):M(a.logger,"channel "+b.name+" ignored from "+d)});zf(a.logger,"event page start listening incoming connection")};pa("loadApp",function(a){chrome.storage.local.get("ydn-crm-track",function(b){var c=b["ydn-crm-track"];b="jsc/ydn.crm-0.8.9.js";navigator.onLine&&"Edge"==c?b="https://ydn-src-1.storage.googleapis.com/jsc/ydn.crm-edge.js":"Beta"==c?b="jsc/ydn.crm-0.8.9.js":"RC"==c&&(b="jsc/ydn.crm-0.8.9.js");c=document.createElement("script");c.onload=a;c.type="text/javascript";var d={};d["ydn-crm-src"]=b;chrome.storage.local.set(d);c.src=b;document.getElementsByTagName("head")[0].appendChild(c)})});function pt(a){H.call(this,"navigate");this.h=a}B(pt,H);function qt(a){kd.call(this);this.g=a||window;Yc(this.g,"popstate",this.Ud,!1,this);Yc(this.g,"hashchange",this.Ud,!1,this)}B(qt,kd);h=qt.prototype;h.ze=!1;h.Mh="/";h.setEnabled=function(a){a!=this.ze&&(this.ze=a)&&this.dispatchEvent(new pt(this.getToken()))};h.getToken=function(){var a=this.g.location.href,b=a.indexOf("#");return 0>b?"":a.substring(b+1)};h.J=function(){fd(this.g,"popstate",this.Ud,!1,this);fd(this.g,"hashchange",this.Ud,!1,this)};h.Ud=function(){this.ze&&this.dispatchEvent(new pt(this.getToken()))};function rt(){}da(rt);rt.prototype.g=0;function Y(a){kd.call(this);this.g=a||eh();this.Fd=st}B(Y,kd);Y.prototype.aa=rt.W();var st=null;function tt(a,b){switch(a){case 1:return b?"disable":"enable";case 2:return b?"highlight":"unhighlight";case 4:return b?"activate":"deactivate";case 8:return b?"select":"unselect";case 16:return b?"check":"uncheck";case 32:return b?"focus":"blur";case 64:return b?"open":"close"}throw Error("Invalid component state");}h=Y.prototype;h.yc=null;h.$=!1;h.Z=null;h.Fd=null;h.Fe=null;h.Oa=null;h.Ea=null;h.cb=null;
h.rg=!1;h.H=function(){return this.yc||(this.yc="ydn:"+(this.aa.g++).toString(36))};function ut(a,b){if(a.Oa&&a.Oa.cb){var c=a.Oa.cb,d=a.yc;d in c&&delete c[d];Jc(a.Oa.cb,b,a)}a.yc=b}h.n=function(){return this.Z};function vt(a){a.cc||(a.cc=new Ff(a));return a.cc}function wt(a,b){if(a==b)throw Error("Unable to set parent component");if(b&&a.Oa&&a.yc&&xt(a.Oa,a.yc)&&a.Oa!=b)throw Error("Unable to set parent component");a.Oa=b;Y.m.gf.call(a,b)}h.getParent=function(){return this.Oa};
h.gf=function(a){if(this.Oa&&this.Oa!=a)throw Error("Method not supported");Y.m.gf.call(this,a)};h.Q=function(){this.Z=this.g.createElement("div")};h.render=function(a){yt(this,a)};function yt(a,b,c){if(a.$)throw Error("Component already rendered");a.Z||a.Q();b?b.insertBefore(a.Z,c||null):a.g.g.body.appendChild(a.Z);a.Oa&&!a.Oa.$||a.L()}
function zt(a,b){if(a.$)throw Error("Component already rendered");if(b&&a.Ee(b)){a.rg=!0;var c=gh(b);a.g&&a.g.g==c||(a.g=eh(b));a.$b(b);a.L()}else throw Error("Invalid element to decorate");}h.Ee=function(){return!0};h.$b=function(a){this.Z=a};h.L=function(){this.$=!0;At(this,function(a){!a.$&&a.n()&&a.L()})};h.Ba=function(){At(this,function(a){a.$&&a.Ba()});this.cc&&this.cc.removeAll();this.$=!1};
h.J=function(){this.$&&this.Ba();this.cc&&(this.cc.ma(),delete this.cc);At(this,function(a){a.ma()});!this.rg&&this.Z&&rh(this.Z);this.Oa=this.Fe=this.Z=this.cb=this.Ea=null;Y.m.J.call(this)};h.t=function(){return this.Fe};h.qa=function(a){this.Fe=a};h.M=function(a,b){this.kd(a,Bt(this),b)};
h.kd=function(a,b,c){if(a.$&&(c||!this.$))throw Error("Component already rendered");if(0>b||b>Bt(this))throw Error("Child component index out of bounds");this.cb&&this.Ea||(this.cb={},this.Ea=[]);if(a.getParent()==this){var d=a.H();this.cb[d]=a;Cb(this.Ea,a)}else Jc(this.cb,a.H(),a);wt(a,this);Gb(this.Ea,b,0,a);a.$&&this.$&&a.getParent()==this?(c=this.X(),c.insertBefore(a.n(),c.childNodes[b]||null)):c?(this.Z||this.Q(),b=Z(this,b+1),yt(a,this.X(),b?b.Z:null)):this.$&&!a.$&&a.Z&&a.Z.parentNode&&1==
a.Z.parentNode.nodeType&&a.L()};h.X=function(){return this.Z};function Ct(a){null==a.Fd&&(a.Fd=Ri(a.$?a.Z:a.g.g.body));return a.Fd}function Bt(a){return a.Ea?a.Ea.length:0}function xt(a,b){return a.cb&&b?Kc(a.cb,b)||null:null}function Z(a,b){return a.Ea?a.Ea[b]||null:null}function At(a,b,c){a.Ea&&tb(a.Ea,b,c)}function Dt(a,b){return a.Ea&&b?sb(a.Ea,b):-1}
h.removeChild=function(a,b){if(a){var c=v(a)?a:a.H();a=xt(this,c);if(c&&a){var d=this.cb;c in d&&delete d[c];Cb(this.Ea,a);b&&(a.Ba(),a.Z&&rh(a.Z));wt(a,null)}}if(!a)throw Error("Child is not in parent component");return a};function Et(a,b,c,d,e){if(!(G||kc&&qc("525")))return!0;if(gc&&e)return Ft(a);if(e&&!d)return!1;ha(b)&&(b=Gt(b));if(!c&&(17==b||18==b||gc&&91==b))return!1;if(kc&&d&&c)switch(a){case 220:case 219:case 221:case 192:case 186:case 189:case 187:case 188:case 190:case 191:case 192:case 222:return!1}if(G&&d&&b==a)return!1;switch(a){case 13:return!(G&&G&&9<=sc);case 27:return!kc}return Ft(a)}
function Ft(a){if(48<=a&&57>=a||96<=a&&106>=a||65<=a&&90>=a||kc&&0==a)return!0;switch(a){case 32:case 63:case 107:case 109:case 110:case 111:case 186:case 59:case 189:case 187:case 61:case 188:case 190:case 191:case 192:case 222:case 219:case 220:case 221:return!0;default:return!1}}function Gt(a){if(jc)a=Ht(a);else if(gc&&kc)a:switch(a){case 93:a=91;break a}return a}
function Ht(a){switch(a){case 61:return 187;case 59:return 186;case 173:return 189;case 224:return 91;case 0:return 224;default:return a}};function It(a,b){kd.call(this);a&&Jt(this,a,b)}B(It,kd);h=It.prototype;h.xc=null;h.Pd=null;h.Ve=null;h.Qd=null;h.Ya=-1;h.Qb=-1;h.le=!1;
var Kt={3:13,12:144,63232:38,63233:40,63234:37,63235:39,63236:112,63237:113,63238:114,63239:115,63240:116,63241:117,63242:118,63243:119,63244:120,63245:121,63246:122,63247:123,63248:44,63272:46,63273:36,63275:35,63276:33,63277:34,63289:144,63302:45},Lt={Up:38,Down:40,Left:37,Right:39,Enter:13,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"U+007F":46,Home:36,End:35,PageUp:33,PageDown:34,Insert:45},Mt=G||kc&&qc("525"),Nt=gc&&jc;h=It.prototype;
h.lh=function(a){kc&&(17==this.Ya&&!a.ctrlKey||18==this.Ya&&!a.altKey||gc&&91==this.Ya&&!a.metaKey)&&(this.Qb=this.Ya=-1);-1==this.Ya&&(a.ctrlKey&&17!=a.g?this.Ya=17:a.altKey&&18!=a.g?this.Ya=18:a.metaKey&&91!=a.g&&(this.Ya=91));Mt&&!Et(a.g,this.Ya,a.shiftKey,a.ctrlKey,a.altKey)?this.handleEvent(a):(this.Qb=Gt(a.g),Nt&&(this.le=a.altKey))};h.mh=function(a){this.Qb=this.Ya=-1;this.le=a.altKey};
h.handleEvent=function(a){var b=a.h,c,d,e=b.altKey;G&&"keypress"==a.type?c=this.Qb:kc&&"keypress"==a.type?c=this.Qb:ic?c=this.Qb:(c=b.keyCode||this.Qb,d=b.charCode||0,Nt&&(e=this.le),gc&&63==d&&224==c&&(c=191));d=c=Gt(c);var f=b.keyIdentifier;c?63232<=c&&c in Kt?d=Kt[c]:25==c&&a.shiftKey&&(d=9):f&&f in Lt&&(d=Lt[f]);this.Ya=d;a=new Ot(d,0,0,b);a.altKey=e;this.dispatchEvent(a)};h.n=function(){return this.xc};
function Jt(a,b,c){a.Qd&&Pt(a);a.xc=b;a.Pd=Yc(a.xc,"keypress",a,c);a.Ve=Yc(a.xc,"keydown",a.lh,c,a);a.Qd=Yc(a.xc,"keyup",a.mh,c,a)}function Pt(a){a.Pd&&(gd(a.Pd),gd(a.Ve),gd(a.Qd),a.Pd=null,a.Ve=null,a.Qd=null);a.xc=null;a.Ya=-1;a.Qb=-1}h.J=function(){It.m.J.call(this);Pt(this)};function Ot(a,b,c,d){xc.call(this,d);this.type="key";this.g=a}B(Ot,xc);var Qt;function Rt(a,b){b?a.setAttribute("role",b):a.removeAttribute("role")}function St(a,b,c){fa(c)&&(c=c.join(" "));var d="aria-"+b;""===c||void 0==c?(Qt||(Qt={atomic:!1,autocomplete:"none",dropeffect:"none",haspopup:!1,live:"off",multiline:!1,multiselectable:!1,orientation:"vertical",readonly:!1,relevant:"additions text",required:!1,sort:"none",busy:!1,disabled:!1,hidden:!1,invalid:"false"}),c=Qt,b in c?a.setAttribute(d,c[b]):a.removeAttribute(d)):a.setAttribute(d,c)}
function Tt(a){a=a.getAttribute("aria-label");return null==a||void 0==a?"":String(a)};function Ut(a){if(a.classList)return a.classList;a=a.className;return v(a)&&a.match(/\S+/g)||[]}function Vt(a,b){return a.classList?a.classList.contains(b):Ab(Ut(a),b)}function Wt(a,b){a.classList?a.classList.add(b):Vt(a,b)||(a.className+=0<a.className.length?" "+b:b)}function Xt(a,b){if(a.classList)tb(b,function(b){Wt(a,b)});else{var c={};tb(Ut(a),function(a){c[a]=!0});tb(b,function(a){c[a]=!0});a.className="";for(var d in c)a.className+=0<a.className.length?" "+d:d}}
function Yt(a,b){a.classList?a.classList.remove(b):Vt(a,b)&&(a.className=ub(Ut(a),function(a){return a!=b}).join(" "))}function Zt(a,b){a.classList?tb(b,function(b){Yt(a,b)}):a.className=ub(Ut(a),function(a){return!Ab(b,a)}).join(" ")};function $t(){}var au;da($t);var bu={button:"pressed",checkbox:"checked",menuitem:"selected",menuitemcheckbox:"checked",menuitemradio:"checked",radio:"checked",tab:"selected",treeitem:"selected"};h=$t.prototype;h.ic=function(){};h.xa=function(a){var b=a.g.s("div",cu(this,a).join(" "),a.ra());du(this,a,b);return b};h.ya=function(a){return a};function eu(a,b,c){if(a=a.n?a.n():a){var d=[b];G&&!qc("7")&&(d=fu(Ut(a),b),d.push(b));(c?Xt:Zt)(a,d)}}h.Gd=function(){return!0};
h.pa=function(a,b){b.id&&ut(a,b.id);var c=this.ya(b);c&&c.firstChild?gu(a,c.firstChild.nextSibling?Eb(c.childNodes):c.firstChild):a.Fb=null;var d=0,e=this.A(),f=this.A(),g=!1,k=!1,c=!1,l=Eb(Ut(b));tb(l,function(a){g||a!=e?k||a!=f?d|=this.ye(a):k=!0:(g=!0,f==e&&(k=!0))},this);a.Pb=d;g||(l.push(e),f==e&&(k=!0));k||l.push(f);var m=a.re;m&&l.push.apply(l,m);if(G&&!qc("7")){var n=fu(l);0<n.length&&(l.push.apply(l,n),c=!0)}if(!g||!k||m||c)b.className=l.join(" ");du(this,a,b);return b};
h.Hd=function(a){Ct(a)&&this.Me(a.n(),!0);a.isEnabled()&&this.zc(a,a.Fa)};function hu(a,b,c){if(a=c||a.ic())c=b.getAttribute("role")||null,a!=c&&Rt(b,a)}function du(a,b,c){b.Fa||St(c,"hidden",!b.Fa);b.isEnabled()||a.ib(c,1,!b.isEnabled());iu(b,8)&&a.ib(c,8,ju(b,8));iu(b,16)&&a.ib(c,16,ju(b,16));iu(b,64)&&a.ib(c,64,ju(b,64))}h.Jd=function(a,b){Xi(a,!b,!G&&!ic)};h.Me=function(a,b){eu(a,this.A()+"-rtl",b)};h.Le=function(a){var b;return iu(a,32)&&(b=ku(a))?yh(b)&&zh(b):!1};
h.zc=function(a,b){var c;if(iu(a,32)&&(c=ku(a))){if(!b&&ju(a,32)){try{c.blur()}catch(d){}ju(a,32)&&a.Ld(null)}(yh(c)&&zh(c))!=b&&(b?c.tabIndex=0:(c.tabIndex=-1,c.removeAttribute("tabIndex")))}};h.S=function(a,b,c){var d=a.n();if(d){var e=this.Oc(b);e&&eu(a,e,c);this.ib(d,b,c)}};h.ib=function(a,b,c){au||(au={1:"disabled",8:"selected",16:"checked",64:"expanded"});b=au[b];var d=a.getAttribute("role")||null;d&&(d=bu[d]||b,b="checked"==b||"selected"==b?d:b);b&&St(a,b,c)};
h.Nb=function(a,b){var c=this.ya(a);if(c&&(ph(c),b))if(v(b))vh(c,b);else{var d=function(a){if(a){var b=gh(c);c.appendChild(v(a)?b.createTextNode(a):a)}};u(b)?tb(b,d):!fa(b)||"nodeType"in b?d(b):tb(Eb(b),d)}};h.Tf=function(a){return a.n()};h.A=function(){return"goog-control"};function cu(a,b){var c=a.A(),d=[c],e=a.A();e!=c&&d.push(e);c=b.Pb;for(e=[];c;){var f=c&-c;e.push(a.Oc(f));c&=~f}d.push.apply(d,e);(c=b.re)&&d.push.apply(d,c);G&&!qc("7")&&d.push.apply(d,fu(d));return d}
function fu(a,b){var c=[];b&&(a=a.concat([b]));tb([],function(d){!xb(d,oa(Ab,a))||b&&!Ab(d,b)||c.push(d.join("_"))});return c}h.Oc=function(a){this.g||lu(this);return this.g[a]};h.ye=function(a){this.i||(this.g||lu(this),this.i=Lc(this.g));a=parseInt(this.i[a],10);return isNaN(a)?0:a};function lu(a){var b=a.A();b.replace(/\xa0|\s/g," ");a.g={1:b+"-disabled",2:b+"-hover",4:b+"-active",8:b+"-selected",16:b+"-checked",32:b+"-focused",64:b+"-open"}};function mu(a,b){if(!ia(a))throw Error("Invalid component class "+a);if(!ia(b))throw Error("Invalid renderer class "+b);var c=ja(a);nu[c]=b}function ou(a,b){if(!a)throw Error("Invalid class name "+a);if(!ia(b))throw Error("Invalid decorator function "+b);pu[a]=b}var nu={},pu={};function qu(a,b,c){Y.call(this,c);if(!b){b=this.constructor;for(var d;b;){d=ja(b);if(d=nu[d])break;b=b.m?b.m.constructor:null}b=d?ia(d.W)?d.W():new d:null}this.i=b;this.Fb=t(a)?a:null}B(qu,Y);h=qu.prototype;h.Fb=null;h.Pb=0;h.bd=39;h.tb=255;h.pc=0;h.Fa=!0;h.re=null;h.Pe=!0;h.nd=!1;h.Uf=null;function ru(a,b){a.$&&b!=a.Pe&&su(a,b);a.Pe=b}function ku(a){return a.i.Tf(a)}h.Q=function(){var a=this.i.xa(this);this.Z=a;hu(this.i,a,this.Kd());this.nd||this.i.Jd(a,!1);this.Fa||(R(a,!1),a&&St(a,"hidden",!0))};
h.Kd=function(){return this.Uf};h.X=function(){return this.i.ya(this.n())};h.Ee=function(a){return this.i.Gd(a)};h.$b=function(a){this.Z=a=this.i.pa(this,a);hu(this.i,a,this.Kd());this.nd||this.i.Jd(a,!1);this.Fa="none"!=a.style.display};h.L=function(){qu.m.L.call(this);this.i.Hd(this);if(this.bd&-2&&(this.Pe&&su(this,!0),iu(this,32))){var a=ku(this);if(a){var b=this.j||(this.j=new It);Jt(b,a);vt(this).listen(b,"key",this.Ra).listen(a,"focus",this.Rg).listen(a,"blur",this.Ld)}}};
function su(a,b){var c=vt(a),d=a.n();b?(c.listen(d,"mouseover",a.Xc).listen(d,"mousedown",a.Uc).listen(d,"mouseup",a.jc).listen(d,"mouseout",a.Qe),a.Wc!=ca&&c.listen(d,"contextmenu",a.Wc),G&&c.listen(d,"dblclick",a.Vf)):(c.ua(d,"mouseover",a.Xc).ua(d,"mousedown",a.Uc).ua(d,"mouseup",a.jc).ua(d,"mouseout",a.Qe),a.Wc!=ca&&c.ua(d,"contextmenu",a.Wc),G&&c.ua(d,"dblclick",a.Vf))}h.Ba=function(){qu.m.Ba.call(this);this.j&&Pt(this.j);this.Fa&&this.isEnabled()&&this.i.zc(this,!1)};
h.J=function(){qu.m.J.call(this);this.j&&(this.j.ma(),delete this.j);delete this.i;this.re=this.Fb=null};h.ra=function(){return this.Fb};function gu(a,b){a.Fb=b}h.zb=function(){var a=this.ra();if(!a)return"";if(!v(a))if(u(a))a=vb(a,Ah).join("");else{if(Zg&&"innerText"in a)a=a.innerText.replace(/(\r\n|\r|\n)/g,"\n");else{var b=[];Bh(a,b,!0);a=b.join("")}a=a.replace(/ \xAD /g," ").replace(/\xAD/g,"");a=a.replace(/\u200B/g,"");Zg||(a=a.replace(/ +/g," "));" "!=a&&(a=a.replace(/^\s*/,""))}return za(a)};
function tu(a){a.nd=!0;var b=a.n();b&&a.i.Jd(b,!0)}h.Ob=function(a,b){if(b||this.Fa!=a&&this.dispatchEvent(a?"show":"hide")){var c=this.n();c&&(R(c,a),c&&St(c,"hidden",!a));this.isEnabled()&&this.i.zc(this,a);this.Fa=a;return!0}return!1};h.isEnabled=function(){return!ju(this,1)};h.setEnabled=function(a){var b=this.getParent();b&&"function"==typeof b.isEnabled&&!b.isEnabled()||!uu(this,1,!a)||(a||(vu(this,!1),this.Ha(!1)),this.Fa&&this.i.zc(this,a),this.S(1,!a))};
h.Ha=function(a){uu(this,2,a)&&this.S(2,a)};function vu(a,b){uu(a,4,b)&&a.S(4,b)}h.Gc=function(a){uu(this,8,a)&&this.S(8,a)};h.oa=function(a){uu(this,64,a)&&this.S(64,a)};function ju(a,b){return!!(a.Pb&b)}h.S=function(a,b){iu(this,a)&&b!=ju(this,a)&&(this.i.S(this,a,b),this.Pb=b?this.Pb|a:this.Pb&~a)};function iu(a,b){return!!(a.bd&b)}function wu(a,b,c){if(a.$&&ju(a,b)&&!c)throw Error("Component already rendered");!c&&ju(a,b)&&a.S(b,!1);a.bd=c?a.bd|b:a.bd&~b}
function xu(a,b){return!!(a.tb&b)&&iu(a,b)}function uu(a,b,c){return iu(a,b)&&ju(a,b)!=c&&(!(a.pc&b)||a.dispatchEvent(tt(b,c)))&&!a.O}h.Xc=function(a){!yu(a,this.n())&&this.dispatchEvent("enter")&&this.isEnabled()&&xu(this,2)&&this.Ha(!0)};h.Qe=function(a){!yu(a,this.n())&&this.dispatchEvent("leave")&&(xu(this,4)&&vu(this,!1),xu(this,2)&&this.Ha(!1))};h.Wc=ca;function yu(a,b){return!!a.o&&uh(b,a.o)}
h.Uc=function(a){this.isEnabled()&&(xu(this,2)&&this.Ha(!0),!zc(a)||kc&&gc&&a.ctrlKey||(xu(this,4)&&vu(this,!0),this.i.Le(this)&&ku(this).focus()));this.nd||!zc(a)||kc&&gc&&a.ctrlKey||a.preventDefault()};h.jc=function(a){this.isEnabled()&&(xu(this,2)&&this.Ha(!0),ju(this,4)&&this.pb(a)&&xu(this,4)&&vu(this,!1))};h.Vf=function(a){this.isEnabled()&&this.pb(a)};
h.pb=function(a){if(xu(this,16)){var b=!ju(this,16);uu(this,16,b)&&this.S(16,b)}xu(this,8)&&this.Gc(!0);xu(this,64)&&this.oa(!ju(this,64));b=new H("action",this);a&&(b.altKey=a.altKey,b.ctrlKey=a.ctrlKey,b.metaKey=a.metaKey,b.shiftKey=a.shiftKey,b.p=a.p);return this.dispatchEvent(b)};h.Rg=function(){xu(this,32)&&uu(this,32,!0)&&this.S(32,!0)};h.Ld=function(){xu(this,4)&&vu(this,!1);xu(this,32)&&uu(this,32,!1)&&this.S(32,!1)};
h.Ra=function(a){return this.Fa&&this.isEnabled()&&this.Ac(a)?(a.preventDefault(),a.l(),!0):!1};h.Ac=function(a){return 13==a.g&&this.pb(a)};mu(qu,$t);ou("goog-control",function(){return new qu(null)});function zu(){}B(zu,$t);da(zu);h=zu.prototype;h.A=function(){return"goog-tab"};h.ic=function(){return"tab"};h.xa=function(a){var b=zu.m.xa.call(this,a);(a=a.Eb())&&this.Ia(b,a);return b};h.pa=function(a,b){b=zu.m.pa.call(this,a,b);var c=this.Eb(b);c&&a.Zd(c);ju(a,8)&&(c=a.getParent())&&ia(c.oc)&&(a.S(8,!1),c.oc(a));return b};h.Eb=function(a){return a.title||""};h.Ia=function(a,b){a&&(a.title=b||"")};function Au(a,b,c){qu.call(this,a,b||zu.W(),c);wu(this,8,!0);this.pc|=9}B(Au,qu);Au.prototype.Eb=function(){return this.h};Au.prototype.Ia=function(a){this.i.Ia(this.n(),a);this.Zd(a)};Au.prototype.Zd=function(a){this.h=a};ou("goog-tab",function(){return new Au(null)});function Bu(a){this.g=a}da(Bu);function Cu(a,b){a&&(a.tabIndex=b?0:-1)}h=Bu.prototype;h.Ge=function(a){return"DIV"==a.tagName};function Du(a,b,c){c.id&&ut(b,c.id);var d=a.A(),e=!1,f=Ut(c);f&&tb(f,function(a){a==d?e=!0:a&&this.hf(b,a,d)},a);e||Wt(c,d);Eu(a,b,c);return c}h.hf=function(a,b,c){b==c+"-disabled"?a.setEnabled(!1):b==c+"-horizontal"?Fu(a,Gu):b==c+"-vertical"&&Fu(a,Hu)};
function Eu(a,b,c){if(c)for(var d=c.firstChild,e;d&&d.parentNode==c;){e=d.nextSibling;if(1==d.nodeType){var f=a.Pc(d);f&&(f.Z=d,b.isEnabled()||f.setEnabled(!1),b.M(f),zt(f,d))}else d.nodeValue&&""!=Aa(d.nodeValue)||c.removeChild(d);d=e}}h.Pc=function(a){a:{var b;a=Ut(a);for(var c=0,d=a.length;c<d;c++)if(b=a[c],b=b in pu?pu[b]():null){a=b;break a}a=null}return a};h.Ie=function(a){a=a.n();Xi(a,!0,jc);G&&(a.hideFocus=!0);var b=this.g;b&&Rt(a,b)};h.A=function(){return"goog-container"};
h.He=function(a){var b=this.A(),c=[b,a.Tb==Gu?b+"-horizontal":b+"-vertical"];a.isEnabled()||c.push(b+"-disabled");return c};h.Nf=function(){return Hu};function Iu(a,b,c){Y.call(this,c);this.lb=b||Bu.W();this.Tb=a||this.lb.Nf()}B(Iu,Y);var Gu="horizontal",Hu="vertical";h=Iu.prototype;h.We=null;h.gc=null;h.lb=null;h.Tb=null;h.za=!0;h.fc=!0;h.tc=!0;h.Sa=-1;h.sa=null;h.nb=!1;h.vb=null;function Ju(a){return a.We||a.n()}h.Q=function(){this.Z=this.g.s("div",this.lb.He(this).join(" "))};h.X=function(){return this.n()};h.Ee=function(a){return this.lb.Ge(a)};h.$b=function(a){this.Z=Du(this.lb,this,a);"none"==a.style.display&&(this.za=!1)};
h.L=function(){Iu.m.L.call(this);At(this,function(a){a.$&&Ku(this,a)},this);var a=this.n();this.lb.Ie(this);this.hc(this.za,!0);vt(this).listen(this,"enter",this.Oe).listen(this,"highlight",this.Og).listen(this,"unhighlight",this.Qg).listen(this,"open",this.sh).listen(this,"close",this.Zg).listen(a,"mousedown",this.Pg).listen(gh(a),"mouseup",this.dh).listen(a,["mousedown","mouseup","mouseover","mouseout","contextmenu"],this.Xg);this.tc&&Lu(this,!0)};
function Lu(a,b){var c=vt(a),d=Ju(a);b?c.listen(d,"focus",a.Je).listen(d,"blur",a.Sf).listen(a.gc||(a.gc=new It(Ju(a))),"key",a.Ra):c.ua(d,"focus",a.Je).ua(d,"blur",a.Sf).ua(a.gc||(a.gc=new It(Ju(a))),"key",a.Ra)}h.Ba=function(){this.Jb(-1);this.sa&&this.sa.oa(!1);this.nb=!1;Iu.m.Ba.call(this)};h.J=function(){Iu.m.J.call(this);this.gc&&(this.gc.ma(),this.gc=null);this.lb=this.sa=this.vb=this.We=null};h.Oe=function(){return!0};
h.Og=function(a){var b=Dt(this,a.target);if(-1<b&&b!=this.Sa){var c=Mu(this);c&&c.Ha(!1);this.Sa=b;c=Mu(this);this.nb&&vu(c,!0);this.sa&&c!=this.sa&&(iu(c,64)?c.oa(!0):this.sa.oa(!1))}b=this.n();null!=a.target.n()&&St(b,"activedescendant",a.target.n().id)};h.Qg=function(a){a.target==Mu(this)&&(this.Sa=-1);this.n().removeAttribute("aria-activedescendant")};h.sh=function(a){(a=a.target)&&a!=this.sa&&a.getParent()==this&&(this.sa&&this.sa.oa(!1),this.sa=a)};
h.Zg=function(a){a.target==this.sa&&(this.sa=null)};h.Pg=function(a){this.fc&&(this.nb=!0);var b=Ju(this);b&&yh(b)&&zh(b)?b.focus():a.preventDefault()};h.dh=function(){this.nb=!1};h.Xg=function(a){var b;a:{b=a.target;if(this.vb)for(var c=this.n();b&&b!==c;){var d=b.id;if(d in this.vb){b=this.vb[d];break a}b=b.parentNode}b=null}if(b)switch(a.type){case "mousedown":b.Uc(a);break;case "mouseup":b.jc(a);break;case "mouseover":b.Xc(a);break;case "mouseout":b.Qe(a);break;case "contextmenu":b.Wc(a)}};
h.Je=function(){};h.Sf=function(){this.Jb(-1);this.nb=!1;this.sa&&this.sa.oa(!1)};h.Ra=function(a){return this.isEnabled()&&this.za&&(0!=Bt(this)||this.We)&&this.Ke(a)?(a.preventDefault(),a.l(),!0):!1};
h.Ke=function(a){var b=Mu(this);if(b&&"function"==typeof b.Ra&&b.Ra(a)||this.sa&&this.sa!=b&&"function"==typeof this.sa.Ra&&this.sa.Ra(a))return!0;if(a.shiftKey||a.ctrlKey||a.metaKey||a.altKey)return!1;switch(a.g){case 27:if(this.tc)Ju(this).blur();else return!1;break;case 36:Nu(this);break;case 35:Ou(this);break;case 38:if(this.Tb==Hu)Pu(this);else return!1;break;case 37:if(this.Tb==Gu)Ct(this)?Qu(this):Pu(this);else return!1;break;case 40:if(this.Tb==Hu)Qu(this);else return!1;break;case 39:if(this.Tb==
Gu)Ct(this)?Pu(this):Qu(this);else return!1;break;default:return!1}return!0};function Ku(a,b){var c=b.n(),c=c.id||(c.id=b.H());a.vb||(a.vb={});a.vb[c]=b}h.M=function(a,b){Iu.m.M.call(this,a,b)};h.kd=function(a,b,c){a.pc|=2;a.pc|=64;wu(a,32,!1);ru(a,!1);Iu.m.kd.call(this,a,b,c);a.$&&this.$&&Ku(this,a);b<=this.Sa&&this.Sa++};
h.removeChild=function(a,b){if(a=v(a)?xt(this,a):a){var c=Dt(this,a);-1!=c&&(c==this.Sa?(a.Ha(!1),this.Sa=-1):c<this.Sa&&this.Sa--);var d=a.n();d&&d.id&&this.vb&&(c=this.vb,d=d.id,d in c&&delete c[d])}a=Iu.m.removeChild.call(this,a,b);ru(a,!0);return a};function Fu(a,b){if(a.n())throw Error("Component already rendered");a.Tb=b}
h.hc=function(a,b){if(b||this.za!=a&&this.dispatchEvent(a?"show":"hide")){this.za=a;var c=this.n();c&&(R(c,a),this.tc&&Cu(Ju(this),this.fc&&this.za),b||this.dispatchEvent(this.za?"aftershow":"afterhide"));return!0}return!1};h.isEnabled=function(){return this.fc};
h.setEnabled=function(a){this.fc!=a&&this.dispatchEvent(a?"enable":"disable")&&(a?(this.fc=!0,At(this,function(a){a.sg?delete a.sg:a.setEnabled(!0)})):(At(this,function(a){a.isEnabled()?a.setEnabled(!1):a.sg=!0}),this.nb=this.fc=!1),this.tc&&Cu(Ju(this),a&&this.za))};function Ru(a,b){b!=a.tc&&a.$&&Lu(a,b);a.tc=b;a.fc&&a.za&&Cu(Ju(a),b)}h.Jb=function(a){(a=Z(this,a))?a.Ha(!0):-1<this.Sa&&Mu(this).Ha(!1)};h.Ha=function(a){this.Jb(Dt(this,a))};function Mu(a){return Z(a,a.Sa)}
function Nu(a){Su(a,function(a,c){return(a+1)%c},Bt(a)-1)}function Ou(a){Su(a,function(a,c){a--;return 0>a?c-1:a},0)}function Qu(a){Su(a,function(a,c){return(a+1)%c},a.Sa)}function Pu(a){Su(a,function(a,c){a--;return 0>a?c-1:a},a.Sa)}function Su(a,b,c){c=0>c?Dt(a,a.sa):c;var d=Bt(a);c=b.call(a,c,d);for(var e=0;e<=d;){var f=Z(a,c);if(f&&a.Ff(f)){a.ff(c);break}e++;c=b.call(a,c,d)}}h.Ff=function(a){return a.Fa&&a.isEnabled()&&iu(a,2)};h.ff=function(a){this.Jb(a)};function Tu(){this.g="tablist"}B(Tu,Bu);da(Tu);Tu.prototype.A=function(){return"goog-tab-bar"};Tu.prototype.hf=function(a,b,c){this.i||(this.h||Uu(this),this.i=Lc(this.h));var d=this.i[b];d?(Fu(a,d==Vu||d==Wu?Hu:Gu),a.i=d):Tu.m.hf.call(this,a,b,c)};Tu.prototype.He=function(a){var b=Tu.m.He.call(this,a);this.h||Uu(this);b.push(this.h[a.i]);return b};function Uu(a){var b=a.A();a.h=Pc(Xu,b+"-top",Yu,b+"-bottom",Vu,b+"-start",Wu,b+"-end")};function Zu(a,b,c){a=a||Xu;Fu(this,a==Vu||a==Wu?Hu:Gu);this.i=a;Iu.call(this,this.Tb,b||Tu.W(),c);$u(this)}B(Zu,Iu);var Xu="top",Yu="bottom",Vu="start",Wu="end";h=Zu.prototype;h.$a=null;h.L=function(){Zu.m.L.call(this);$u(this)};h.J=function(){Zu.m.J.call(this);this.$a=null};h.removeChild=function(a,b){av(this,a);return Zu.m.removeChild.call(this,a,b)};h.ff=function(a){Zu.m.ff.call(this,a);this.oc(Z(this,a))};h.oc=function(a){a?a.Gc(!0):this.$a&&this.$a.Gc(!1)};
function av(a,b){if(b&&b==a.$a){for(var c=Dt(a,b),d=c-1;b=Z(a,d);d--)if(b.Fa&&b.isEnabled()){a.oc(b);return}for(c+=1;b=Z(a,c);c++)if(b.Fa&&b.isEnabled()){a.oc(b);return}a.oc(null)}}h.xh=function(a){this.$a&&this.$a!=a.target&&this.$a.Gc(!1);this.$a=a.target};h.Ah=function(a){a.target==this.$a&&(this.$a=null)};h.vh=function(a){av(this,a.target)};h.wh=function(a){av(this,a.target)};h.Je=function(){Mu(this)||this.Ha(this.$a||Z(this,0))};
function $u(a){vt(a).listen(a,"select",a.xh).listen(a,"unselect",a.Ah).listen(a,"disable",a.vh).listen(a,"hide",a.wh)}ou("goog-tab-bar",function(){return new Zu});function bv(a,b){this.g=a;this.h=b};function cv(a,b){this.parent=a;this.g=b}function dv(a){return ev(a.parent.module).module_fields[a.g]}function fv(a){return a.parent.module.value(a.g)}cv.prototype.Qc=function(){return fv(this)};function gv(a){a=fv(a);return v(a)?!ya(a):null!=a}function hv(a){a=dv(a);return v(a.label)?a.label.replace(/:$/,""):a.label}function iv(a){return(a=dv(a))?a.type||"varchar":"varchar"}cv.prototype.toString=function(){return this.parent+";Field:"+this.g};function jv(a,b){this.module=a;this.g=b||"";this.h=[]}function kv(a){var b=ev(a.module),c=[],d;for(d in b.module_fields){var e=b.module_fields[d];a.g&&e.group==a.g?c.push(d):a.g||e.group||c.push(d)}return c}function lv(a,b){var c=ev(a.module),d;for(d in c.module_fields)if(d==b)return!0;return!1}function mv(a,b){var c=a.h.indexOf(b);if(0<=c)return a.h[c];c=new cv(a,b);a.h.push(c);return c}function nv(a,b){for(var c=0;c<a.h.length;c++)if(a.h[c].g==b)return a.h[c];return null}
function ov(a){a=a.g.replace("_"," ");return a=a.charAt(0).toUpperCase()+a.substr(1)};function pv(a,b){kd.call(this);this.parent=a;this.g=b;this.i={}}B(pv,kd);h=pv.prototype;h.logger=Q("ydn.crm.sugar.model.Record");h.H=function(){return this.g.H()};h.value=function(a){return this.g.value(a)};h.Y=function(){return this.g.module};function ev(a){return a.parent.o[a.Y()]}h.save=function(a){return qv(this.parent,new qr($(this.parent),this.Y(),a)).B(function(a){var c=this,d=!rv(this);sr(this.g,a);setTimeout(function(){d?c.dispatchEvent(new sv(0,c)):c.dispatchEvent(new tv(0,c))},10)},this)};
h.J=function(){pv.m.J.call(this);this.i=null};function uv(a){return a.g?rm(a.g.g):null}h.qb=function(a){a=a?a.g?a:null:null;var b=!1,c=!1,d=!1;a?a!==this.g&&(b=!0,(c=this.g.module!=a.module)||(d=rv(this)?this.g.H()!=a.H():!0),this.g=a):!a&&rv(this)&&(d=b=!0,this.g.g=null);var e=this.g.module;c?this.dispatchEvent(new vv(e,a,this)):d?this.dispatchEvent(new sv(0,this)):b&&this.dispatchEvent(new tv(0,this))};function rv(a){return!!a.g.g}function wv(a,b){a.i[b]||(a.i[b]=new jv(a,b));return a.i[b]}
h.toString=function(){return"ydn.crm.sugar.model.Record:"+this.g};function xv(a,b){var c;c=a.replace("@","%40");c="http://www.google.com/m8/feeds/contacts/"+c+"/base/"+ ++yv;b.id={$t:c};ss.call(this,b)}B(xv,ys);var yv=0;function zv(a,b){pv.call(this,a,new qr($(a),b));this.h=null;this.module_name=b;this.j=new Ff(this);this.j.listen(a,[Av,Bv,Cv],this.Nh)}B(zv,pv);h=zv.prototype;h.logger=Q("ydn.crm.sugar.model.GDataRecord");h.J=function(){zv.m.J.call(this);this.j.ma();this.j=null};
h.Nh=function(a){if(a instanceof Dv){if(this.qb(null),this.h=Ev(a,this.Y())){var b=Wr(this.h,Xr,$(this.parent),this.Y()).g;Fv(this,b)}}else a.type!=Av||rv(this)||((b=Gv(this.getParent()))?(b=[{store:this.Y(),index:"ydn$emails",key:b}],Hv(this.parent).send("query",b).B(function(b){(b=b[0])&&b.result[0]?this.qb(new qr($(this.parent),this.Y(),b.result[0])):this.dispatchEvent(a)},this)):this.dispatchEvent(a))};h.getParent=function(){return this.parent};function Iv(a){return Jv(a.getParent())}h.Y=function(){return this.module_name};
h.qb=function(a){if(a&&a.module!=this.module_name)throw Error("Module name must be "+this.module_name+" but found "+a.module);zv.m.qb.call(this,a)};function Fv(a,b){var c=Iv(a);c&&zs(c);b&&(c=[{store:a.Y(),index:"id",key:b}],Hv(a.parent).send("query",c).w(function(a){(a=a[0])&&a.result[0]?this.qb(new qr($(this.parent),this.Y(),a.result[0])):M(this.logger,"record id "+b+" not in "+this.Y())},function(a){throw a;},a))}function Kv(a){return(a=Iv(a))?zs(a)[0]:null}
function Lv(a){return a.h&&rv(a)?!!Wr(a.h,Xr,$(a.parent),a.Y(),a.H()):!1}function Mv(a){var b=Iv(a),b={module:a.Y(),kind:b.pf(),"gdata-id":b.H()};N(a.logger,"sending import-gdata "+JSON.stringify(b));return Hv(a.parent).send("import-gdata",b).B(function(a){a=new qr($(this.parent),this.Y(),a);N(this.logger,a+" created.");this.qb(a)},a)}
function Nv(a){var b=Ov(a.getParent());new vd;var c=Ic(b.data,"gd$name","gd$fullName","$t")||"",d={email1:zs(b)[0],full_name:c};c&&0<c.length&&(c=c.split(/\s/),c[0]&&(d.first_name=c[0]),c[1]&&(d.last_name=c[c.length-1]));b=As(b);b[0]&&(d.phone_work=b[0]);d={module:a.Y(),record:d};N(a.logger,"sending put-record "+JSON.stringify(d));return Hv(a.parent).send("put-record",d).B(function(a){a=new qr($(this.parent),this.Y(),a);N(this.logger,a+" created.");this.qb(a)},a)}
function Pv(a){return rv(a)?Qv(a.getParent(),a.g):E("no Record to export.")}function Rv(a){return rv(a)?Sv(a.getParent(),a.g):E("no Record to link.")}h.save=function(){if(!rv(this))return E("no Record to save.");var a=Hv(this.parent).send("put-record",this.g);a.B(function(a){this.g.g=a},this);return a};h.toString=function(){var a="";this.g&&(a+=":"+this.g);var b=Iv(this);b&&(a+=":"+b);return"RecordModel:"+this.Y()+a};var Cv="context-gdata-change",Av="gdata-change",Bv="gdata-updated";function Tv(a,b){H.call(this,a,b)}B(Tv,H);function Dv(a,b,c,d){H.call(this,Cv,d);this.domain=a;this.h=c}B(Dv,Tv);function Ev(a,b){for(var c=0;c<a.h.length;c++)if(Wr(a.h[c],Xr,a.domain,b))return a.h.splice(c,1)[0];return null}function sv(a,b){H.call(this,"record-change",b)}B(sv,Tv);function vv(a,b,c){H.call(this,"module-change",c);this.module=a;this.update=b}B(vv,Tv);function tv(a,b){H.call(this,"record-update",b)}B(tv,Tv);
function Uv(a,b,c,d){H.call(this,a,d)}B(Uv,Tv);function Vv(a,b,c){H.call(this,Av,c)}B(Vv,Uv);function Wv(a,b,c){H.call(this,Bv,c)}B(Wv,Uv);function Xv(a,b){kd.call(this);this.g=a;for(var c={},d=0;d<b.length;d++)c[b[d].module_name]=b[d];this.o=c;this.info={};this.p=null;this.l=new Ff(this);this.j=new qr($(this),"Users");Yv(this);c=Bd();this.l.listen(c,["login","host-permission"],this.ph)}B(Xv,kd);h=Xv.prototype;h.ph=function(a){"login"==a.type?this.dispatchEvent(new H("login")):"host-permission"==a.type&&this.g&&(a=a.h.data,a.grant&&a.grant==$(this)&&(this.g.hostPermission=!0,this.dispatchEvent(new H("hag"))))};
function Zv(a,b){if(b){var c=a.g.isLogin,d=!!b&&b.isLogin;a.g=b;!c&&d?a.dispatchEvent(new H("login",a)):c&&!d&&a.dispatchEvent(new H("logout",a))}}h.isLogin=function(){return!!this.g.isLogin};function Yv(a){a.g&&a.g.userName&&a.send("login-user").B(function(a){a&&a.id&&(this.j.g=a)},a)}function $v(a){return a.send("about").B(function(a){Zv(this,a)},a)}function Hv(a){return Ed("sugarcrm",$(a))}function $(a){return a.g.domain}function aw(a){return a.g.baseUrl?a.g.baseUrl:"https://"+a.g.domain}
function bw(a,b,c){var d={};d.domain=$(a);d.baseUrl=a.g.baseUrl||null;d.si=b;d.password=c;return a.send("login",d).B(function(a){Zv(this,a)},a)}h.send=function(a,b){return Ed("sugarcrm",$(this)).send(a,b)};function cw(a,b,c,d,e,f){b={store:b};c&&(b.index=c);d&&(d instanceof S?b.range=d.toJSON():b.key=d);b.prefix=!!e;f&&(b.limit=void 0);return Hv(a).send("query",[b])}function dw(a,b,c){c={store:b,index:"name",q:c,fetchFull:!1};"Notes"==b&&(c.index="content");return Hv(a).send("search",[c])}
function ew(a,b,c,d){var e=document.createElement("div");e.innerHTML=b.Se;var f=b.Lf,f=f&&f instanceof Date&&!isNaN(f.getTime())?Dr(b.Lf):"",g=a.g?a.g.userName||"":"",k;k=a.j.value("name")||a.g.userName||null;return a.send("new-record",{module:"Emails",record:{assigned_user_id:g,assigned_user_name:k,type:"archived",date_sent:f,description:e.textContent,description_html:b.Se,name:b.Oh,from_addr:b.Lg,to_addrs:b.Qh,parent_id:d||"",parent_type:c||"",mailbox_id:b.Fh||"",message_id:b.af||"",status:"read"}})}
function qv(a,b){return a.send("put-record",{module:b.module,record:b.g})}h.J=function(){Xv.m.J.call(this);this.p=this.info=null;this.l.ma();this.l=null};h.toString=function(){return"ydn.crm.sugar.model.Sugar:"+$(this)};function fw(a,b,c){Xv.call(this,a,b);this.h=this.i=null;this.u=c}B(fw,Xv);function Jv(a){return a.h}function Ov(a){return a.i}function Gv(a){return a.i?zs(a.i)[0]||null:null}
function gw(a,b){for(var c=[],d=0;d<b.length;d++){for(var e=c,f=d,g=a.i,k=b[d],l=0,m=zs(g),n=zs(k),p=0;p<m.length;p++)for(var q=m[p],s=0;s<n.length;s++){var w=n[s];q&&q==w&&(l+=1)}m=0;q=g.data.gd$name;s=k.data.gd$name;if(q&&s)for(w=["gd$familyName","gd$givenName","gd$additionalName","gd$fullName"],n=[0.06,0.06,0.06,0.12],p=0;4>p;p++){var z=q[w[p]],F=s[w[p]];z&&F==z&&(m+=n[p])}p=0;n=g.ed();q=k.ed();n&&n==q&&(p+=0.2);s=0;g=As(g);k=As(k);q=g.length;for(n=[];q--;){s=g[q];w=k.length;for(n[q]=0;w--;)z=
k[w],s.$t&&z.$t&&(z=0.7*rs(s,z),n[q]=Math.max(n[q],z));s=oi(n).value}e[f]=l+m+p+s}e=[];for(d=0;d<b.length;d++)f=Ib(e,Lb,c[d]),0>f?(Gb(e,-(f+1),0,c[d]),l=b.splice(d,1),Gb(b,-(f+1),0,l[0])):Gb(e,f,0,c[d])}
function Sv(a,b){b.H();var c=b.module,d=a.h;if(!d)return E("Not contact data to link.");var e=Wr(d,Xr,$(a),c);if(e)return E("Contact "+aq(d)+" already link to "+e.g+" with the module "+c);c=new vs(Xr,$(a),c,b.H(),+new Date(d.data.updated.$t),tr(b));d={kind:d.pf(),"gdata-id":d.H(),"external-id":{label:c.module+"#"+c.i+"-"+c.h,value:c.P()}};return Hv(a).send("link",d).B(function(){this.h=null;this.dispatchEvent(new Vv(0,0,this))},a)}
function Qv(a,b){return Ed().send("export-record",b.toJSON()).B(function(a){this.h=new ys(a);this.dispatchEvent(new Wv(0,0,this))},a)}fw.prototype.update=function(a,b,c){this.isLogin()&&this.g.hostPermission?hw(this,a,b,c):$v(this).ea(function(){hw(this,a,b,c)},this)};
function hw(a,b,c,d){a.i=null;a.h=null;if(b){var e={gd$email:[{address:b}]};c&&(e.gd$name={gd$fullName:{$t:c}});d&&(e.gd$phoneNumber=[{$t:d}]);a.i=new xv(a.u,e);Ed().send("gdata-list-contact-by-email",b).w(function(a){a=a.map(function(a){return new ys(a)});gw(this,a);a=new Dv($(this),0,a,this);this.dispatchEvent(a);this.h=a.h[0]||null;this.dispatchEvent(new Vv(0,0,this))},function(a){throw a;},a)}else a.dispatchEvent(new Dv($(a),0,[],a)),a.dispatchEvent(new Vv(0,0,a))};function iw(a,b){Y.call(this);this.qa(a);this.parent=b||null;this.h=new jw}B(iw,Y);h=iw.prototype;h.logger=Q("ydn.crm.ui.GmailCmd");h.A=function(){return"gmail-cmd-panel"};h.Q=function(){iw.m.Q.call(this);var a=this.n(),b=this.g;a.classList.add(this.A());b=b.s("a",{"class":"archive"},".");kw(this.h,b);a.appendChild(b)};function lw(a,b){mw(a.h,"View",Rq($(a.t()),"Emails",b.id));var c=a.h.n();c.setAttribute("target","gmail");c.setAttribute("title","View archived email in SugarCRM")}
function nw(a){mw(a.h,"Archive","#archive");a.h.n().setAttribute("title","Archive this email message to SugarCRM")}function ow(a){mw(a.h,".");setTimeout(function(){mw(a.h,"..");var b=pw(a.n());b.af?(mw(a.h,"..."),a.t().send("query",[{store:"Emails",index:"message_id",key:b.af}]).w(function(b){(b=b[0]&&b[0].result?b[0].result[0]:null)?lw(a,b):nw(a)},function(b){nw(a);throw b;})):1<b.Se.length?nw(a):qw(a.h,"gmail message cannot be parsed")},100)}
h.L=function(){iw.m.L.call(this);vt(this).listen(this.h,"click",this.Ug);ow(this)};
function pw(a){var b="",c="",d="",e="",f="",g=Ch(a,"TR");if(b=g.children[0].querySelector("span[email]"))b=b.getAttribute("email");else return M(To,"cannot sniff sender email"),null;if(a=g.children[1].querySelector("span[alt]"))a=a.getAttribute("alt"),a=new Date(a.replace(" at",""));else return M(To,"cannot sniff date sent"),null;var k=g.nextElementSibling;if(!k||"TR"!=k.tagName)return M(To,"to email address TR expect after title TR"),null;for(var l=k.querySelectorAll("span[email]"),k=0;k<l.length;k++)c&&
(c+=", "),c+=l[k].getAttribute("email");for(var g=Ch(g,"TABLE"),m=g.parentElement.nextElementSibling,k=0;m&&10>k;k++)if(l=m.querySelector("div[style]")){d=l.parentElement.className.split(/\s/);k=d.map(function(a){return a.length});k=k.indexOf(Math.max.apply(Math,k));10<d[k].length&&(e=d[k].substring(1),"m"!=d[k].charAt(0)&&N(To,"not start with m? "+d[k]));d=l.innerHTML;break}else m=m.nextElementSibling;g=Ch(g.parentElement,"TABLE");for(k=0;g&&10>k&&"presentation"!=g.getAttribute("role");k++)g=Ch(g,
"TABLE");"presentation"==g.getAttribute("role")?(g=g.querySelector("h2"))?f=g.textContent:M(To,"email subject cannot be sniff"):M(To,"expect a presentation role TABLE");g=rw().g.email;return{Lg:b,Qh:c,Lf:a,Se:d,Fh:g,af:e,Oh:f}}h.Ug=function(a){if(wa(a.target.href)){a.preventDefault();mw(this.h,"archiving...");var b=a=void 0,c=this.parent?Z(this.parent,1).h():[];c[0]&&(a=c[0].module,b=c[0].id);(c=pw(this.n()))?ew(this.t(),c,a,b).w(function(a){lw(this,a)},function(a){qw(this.h,a)},this):qw(this.h,"Cannot gather email message")}};function sw(a){this.h=a;this.g=[]}sw.prototype.logger=Q("ydn.crm.ui.GmailCmdInjector");function tw(a){var b=document.body;(new MutationObserver(a.i.bind(a))).observe(b,{childList:!1,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:["data-tooltip"]})}
sw.prototype.i=function(a){for(var b=0;b<a.length;b++){var c=a[b].target;if("Reply"==c.getAttribute("data-tooltip")){var d;a:{for(d=0;d<this.g.length;d++)if(!document.body.contains(this.g[d].n())){this.g[d].$&&this.g[d].Ba();d=this.g[d];break a}d=new iw(this.h);this.g.push(d)}var e=document.createElement("span");c.parentElement.insertBefore(e,c);d.render(e)}}};function uw(){}B(uw,$t);da(uw);uw.prototype.A=function(){return"goog-menuheader"};function vw(a,b,c){qu.call(this,a,c||uw.W(),b);wu(this,1,!1);wu(this,2,!1);wu(this,4,!1);wu(this,32,!1);this.Pb=1}B(vw,qu);ou("goog-menuheader",function(){return new vw(null)});function ww(){this.h=[]}B(ww,$t);da(ww);function xw(a,b){var c=a.h[b];if(!c){switch(b){case 0:c=a.A()+"-highlight";break;case 1:c=a.A()+"-checkbox";break;case 2:c=a.A()+"-content"}a.h[b]=c}return c}h=ww.prototype;h.ic=function(){return"menuitem"};h.xa=function(a){var b=a.g.s("div",cu(this,a).join(" "),yw(this,a.ra(),a.g));zw(this,a,b,iu(a,8)||iu(a,16));du(this,a,b);Aw(this,a,b);return b};h.ya=function(a){return a&&a.firstChild};
h.pa=function(a,b){var c=sh(b),d=xw(this,2);c&&Vt(c,d)||b.appendChild(yw(this,b.childNodes,a.g));Vt(b,"goog-option")&&(wu(a,16,!0),(c=a.n())&&Bw(a.i,a,c),Bw(this,a,b));return ww.m.pa.call(this,a,b)};h.Nb=function(a,b){var c=this.ya(a),d=Cw(this,a)?c.firstChild:null;ww.m.Nb.call(this,a,b);d&&!Cw(this,a)&&c.insertBefore(d,c.firstChild||null)};function yw(a,b,c){a=xw(a,2);return c.s("div",a,b)}function Bw(a,b,c){c&&(Rt(c,"menuitemcheckbox"),zw(a,b,c,!0))}
function Cw(a,b){var c=a.ya(b);if(c){var c=c.firstChild,d=xw(a,1);return!!c&&th(c)&&Vt(c,d)}return!1}function zw(a,b,c,d){d!=Cw(a,c)&&(d?Wt(c,"goog-option"):Yt(c,"goog-option"),c=a.ya(c),d?(a=xw(a,1),c.insertBefore(b.g.s("div",a),c.firstChild||null)):c.removeChild(c.firstChild))}h.Oc=function(a){switch(a){case 2:return xw(this,0);case 16:case 8:return"goog-option-selected";default:return ww.m.Oc.call(this,a)}};
h.ye=function(a){var b=xw(this,0);switch(a){case "goog-option-selected":return 16;case b:return 2;default:return ww.m.ye.call(this,a)}};h.A=function(){return"goog-menuitem"};function Aw(a,b,c){(iu(b,8)||iu(b,16))&&hu(a,c,iu(b,16)?"menuitemcheckbox":"menuitemradio")};function Dw(a,b,c,d){qu.call(this,a,d||ww.W(),c);this.qa(b)}B(Dw,qu);h=Dw.prototype;h.P=function(){var a=this.t();return null!=a?a:this.zb()};h.zb=function(){var a=this.ra();return u(a)?(a=vb(a,function(a){return th(a)&&(Vt(a,"goog-menuitem-accel")||Vt(a,"goog-menuitem-mnemonic-separator"))?"":Ah(a)}).join(""),za(a)):Dw.m.zb.call(this)};
h.jc=function(a){var b=this.getParent();if(b){var c=b.h;b.h=null;if(b=c&&ha(a.clientX))b=new bh(a.clientX,a.clientY),b=c==b?!0:c&&b?c.x==b.x&&c.y==b.y:!1;if(b)return}Dw.m.jc.call(this,a)};h.Ac=function(a){return a.g==this.bf&&this.pb(a)?!0:Dw.m.Ac.call(this,a)};h.Ng=function(){return this.bf};ou("goog-menuitem",function(){return new Dw(null)});Dw.prototype.Q=function(){Dw.m.Q.call(this);Aw(this.i,this,this.n())};
Dw.prototype.Kd=function(){return iu(this,16)?"menuitemcheckbox":iu(this,8)?"menuitemradio":Dw.m.Kd.call(this)};function Ew(){}B(Ew,$t);da(Ew);Ew.prototype.xa=function(a){return a.g.s("div",this.A())};Ew.prototype.pa=function(a,b){b.id&&ut(a,b.id);if("HR"==b.tagName){var c=b;b=this.xa(a);qh(b,c);rh(c)}else Wt(b,this.A());return b};Ew.prototype.Nb=function(){};Ew.prototype.A=function(){return"goog-menuseparator"};function Fw(a,b){qu.call(this,null,a||Ew.W(),b);wu(this,1,!1);wu(this,2,!1);wu(this,4,!1);wu(this,32,!1);this.Pb=1}B(Fw,qu);Fw.prototype.L=function(){Fw.m.L.call(this);var a=this.n();Rt(a,"separator")};ou("goog-menuseparator",function(){return new Fw});function Gw(a){this.g=a||"menu"}B(Gw,Bu);da(Gw);h=Gw.prototype;h.Ge=function(a){return"UL"==a.tagName||Gw.m.Ge.call(this,a)};h.Pc=function(a){return"HR"==a.tagName?new Fw:Gw.m.Pc.call(this,a)};h.wb=function(a,b){return uh(a.n(),b)};h.A=function(){return"goog-menu"};h.Ie=function(a){Gw.m.Ie.call(this,a);a=a.n();St(a,"haspopup","true")};function Hw(a){Fw.call(this,Ew.W(),a)}B(Hw,Fw);ou("goog-menuseparator",function(){return new Fw});function Iw(a,b){Iu.call(this,Hu,b||Gw.W(),a);Ru(this,!1)}B(Iw,Iu);h=Iw.prototype;h.md=!0;h.A=function(){return this.lb.A()};h.wb=function(a){if(this.lb.wb(this,a))return!0;for(var b=0,c=Bt(this);b<c;b++){var d=Z(this,b);if("function"==typeof d.wb&&d.wb(a))return!0}return!1};h.wc=function(){var a=[];At(this,function(b){a.push(b)});return a};h.hc=function(a,b,c){(b=Iw.m.hc.call(this,a,b))&&a&&this.$&&this.md&&Ju(this).focus();a&&c&&ha(c.clientX)?this.h=new bh(c.clientX,c.clientY):this.h=null;return b};
h.Oe=function(a){this.md&&Ju(this).focus();return Iw.m.Oe.call(this,a)};h.Ff=function(a){return a.isEnabled()&&a.Fa&&iu(a,2)};h.$b=function(a){for(var b=this.lb,c=ih(this.g.g,"div",b.A()+"-content",a),d=c.length,e=0;e<d;e++)Eu(b,this,c[e]);Iw.m.$b.call(this,a)};h.Ke=function(a){var b=Iw.m.Ke.call(this,a);b||At(this,function(c){!b&&c.Ng&&c.bf==a.g&&(this.isEnabled()&&this.Ha(c),b=c.Ra(a))},this);return b};
h.Jb=function(a){Iw.m.Jb.call(this,a);if(a=Z(this,a)){var b=a.n();a=this.n();var c=Qi(b),d=Qi(a),e=bj(a),f=c.x-d.x-e.left,c=c.y-d.y-e.top,d=a.clientHeight-b.offsetHeight,e=a.scrollLeft,g=a.scrollTop,e=e+Math.min(f,Math.max(f-(a.clientWidth-b.offsetWidth),0)),g=g+Math.min(c,Math.max(c-d,0)),b=new bh(e,g);a.scrollLeft=b.x;a.scrollTop=b.y}};function Jw(a,b,c,d,e,f,g,k,l){var m,n;if(m=c.offsetParent){var p="HTML"==m.tagName||"BODY"==m.tagName;p&&"static"==Mi(m,"position")||(n=Qi(m),p||(p=(p=Ri(m))&&jc?-m.scrollLeft:!p||G&&qc("8")||"visible"==Mi(m,"overflowX")?m.scrollLeft:m.scrollWidth-m.clientWidth-m.scrollLeft,n=ch(n,new bh(p,m.scrollTop))))}m=n||new bh;n=Vi(a);if(p=Pi(a)){var q=new Ki(p.left,p.top,p.right-p.left,p.bottom-p.top),p=Math.max(n.left,q.left),s=Math.min(n.left+n.width,q.left+q.width);if(p<=s){var w=Math.max(n.top,q.top),
q=Math.min(n.top+n.height,q.top+q.height);w<=q&&(n.left=p,n.top=w,n.width=s-p,n.height=q-w)}}p=eh(a);w=eh(c);if(p.g!=w.g){var s=p.g.body,w=mh(w.g),q=new bh(0,0),z;z=(z=gh(s))?mh(z):window;var F=s;do{var D;if(z==w)D=Qi(F);else{var I=F;D=void 0;if(I.getBoundingClientRect)D=Ni(I),D=new bh(D.left,D.top);else{D=Gh(eh(I));var O=Qi(I);D=new bh(O.x-D.x,O.y-D.y)}if(jc&&!qc(12)){b:{var O=I,sa=Pa();if(void 0===O.style[sa]&&(sa=(kc?"Webkit":jc?"Moz":G?"ms":ic?"O":null)+Qa(),void 0!==O.style[sa])){O=(kc?"-webkit":
jc?"-moz":G?"-ms":ic?"-o":null)+"-transform";break b}O="transform"}I=(I=Mi(I,O)||Mi(I,"transform"))?(I=I.match(ej))?new bh(parseFloat(I[1]),parseFloat(I[2])):new bh(0,0):new bh(0,0);D=new bh(D.x+I.x,D.y+I.y)}}q.x+=D.x;q.y+=D.y}while(z&&z!=w&&(F=z.frameElement)&&(z=z.parent));s=ch(q,Qi(s));G&&!Fh(p)&&(s=ch(s,Gh(p)));n.left+=s.x;n.top+=s.y}a=Kw(a,b);b=new bh(a&2?n.left+n.width:n.left,a&1?n.top+n.height:n.top);b=ch(b,m);e&&(b.x+=(a&2?-1:1)*e.x,b.y+=(a&1?-1:1)*e.y);var K;if(g)if(l)K=l;else if(K=Pi(c))K.top-=
m.y,K.right-=m.x,K.bottom-=m.y,K.left-=m.x;a:{l=b.ha();e=0;a=Kw(c,d);d=Ti(c);k=k?k.ha():d.ha();if(f||0!=a)a&2?l.x-=k.width+(f?f.right:0):f&&(l.x+=f.left),a&1?l.y-=k.height+(f?f.bottom:0):f&&(l.y+=f.top);if(g&&(K?(f=l,e=0,65==(g&65)&&(f.x<K.left||f.x>=K.right)&&(g&=-2),132==(g&132)&&(f.y<K.top||f.y>=K.bottom)&&(g&=-5),f.x<K.left&&g&1&&(f.x=K.left,e|=1),f.x<K.left&&f.x+k.width>K.right&&g&16&&(k.width=Math.max(k.width-(f.x+k.width-K.right),0),e|=4),f.x+k.width>K.right&&g&1&&(f.x=Math.max(K.right-k.width,
K.left),e|=1),g&2&&(e=e|(f.x<K.left?16:0)|(f.x+k.width>K.right?32:0)),f.y<K.top&&g&4&&(f.y=K.top,e|=2),f.y<=K.top&&f.y+k.height<K.bottom&&g&32&&(k.height=Math.max(k.height-(K.top-f.y),0),f.y=K.top,e|=8),f.y>=K.top&&f.y+k.height>K.bottom&&g&32&&(k.height=Math.max(k.height-(f.y+k.height-K.bottom),0),e|=8),f.y+k.height>K.bottom&&g&4&&(f.y=Math.max(K.bottom-k.height,K.top),e|=2),g&8&&(e=e|(f.y<K.top?64:0)|(f.y+k.height>K.bottom?128:0)),g=e):g=256,e=g,e&496)){c=e;break a}f=jc&&(gc||mc)&&qc("1.9");l instanceof
bh?(g=l.x,l=l.y):(g=l,l=void 0);c.style.left=Si(g,f);c.style.top=Si(l,f);d==k||d&&k&&d.width==k.width&&d.height==k.height||(f=Fh(eh(gh(c))),!G||f&&qc("8")?(c=c.style,jc?c.MozBoxSizing="border-box":kc?c.WebkitBoxSizing="border-box":c.boxSizing="border-box",c.width=Math.max(k.width,0)+"px",c.height=Math.max(k.height,0)+"px"):(g=c.style,f?(G?(f=Zi(c,"paddingLeft"),d=Zi(c,"paddingRight"),l=Zi(c,"paddingTop"),K=Zi(c,"paddingBottom"),f=new Ji(l,d,K,f)):(f=Li(c,"paddingLeft"),d=Li(c,"paddingRight"),l=Li(c,
"paddingTop"),K=Li(c,"paddingBottom"),f=new Ji(parseFloat(l),parseFloat(d),parseFloat(K),parseFloat(f))),c=bj(c),g.pixelWidth=k.width-c.left-f.left-f.right-c.right,g.pixelHeight=k.height-c.top-f.top-f.bottom-c.bottom):(g.pixelWidth=k.width,g.pixelHeight=k.height)));c=e}return c}function Kw(a,b){return(b&4&&Ri(a)?b^2:b)&-5};function Lw(){}Lw.prototype.i=function(){};function Mw(a,b,c){this.g=a;this.h=b;this.p=c}B(Mw,Lw);Mw.prototype.i=function(a,b,c){Jw(this.g,this.h,a,b,void 0,c,this.p)};function Nw(a,b,c,d){Mw.call(this,a,b);this.j=c?5:0;this.l=d||void 0}B(Nw,Mw);Nw.prototype.o=function(){return this.j};Nw.prototype.i=function(a,b,c,d){var e=Jw(this.g,this.h,a,b,null,c,10,d,this.l);if(e&496){var f=Pw(e,this.h);b=Pw(e,b);e=Jw(this.g,f,a,b,null,c,10,d,this.l);e&496&&(f=Pw(e,f),b=Pw(e,b),Jw(this.g,f,a,b,null,c,this.j,d,this.l))}};function Pw(a,b){a&48&&(b^=2);a&192&&(b^=1);return b};function Qw(a,b,c,d){Nw.call(this,a,b,c||d);if(c||d)this.j=65|(d?32:132)}B(Qw,Nw);function Rw(){}B(Rw,$t);da(Rw);h=Rw.prototype;h.ic=function(){return"button"};h.ib=function(a,b,c){switch(b){case 8:case 16:St(a,"pressed",c);break;default:case 64:case 1:Rw.m.ib.call(this,a,b,c)}};h.xa=function(a){var b=Rw.m.xa.call(this,a);this.Ia(b,a.Eb());var c=a.P();c&&this.De(b,c);iu(a,16)&&this.ib(b,16,ju(a,16));return b};h.pa=function(a,b){b=Rw.m.pa.call(this,a,b);var c=this.P(b);a.C=c;a.Zd(this.Eb(b));iu(a,16)&&this.ib(b,16,ju(a,16));return b};h.P=ca;h.De=ca;h.Eb=function(a){return a.title};
h.Ia=function(a,b){a&&b&&(a.title=b)};h.A=function(){return"goog-button"};function Sw(){}B(Sw,Rw);da(Sw);h=Sw.prototype;h.ic=function(){};h.xa=function(a){ru(a,!1);a.tb&=-256;wu(a,32,!1);return a.g.s("button",{"class":cu(this,a).join(" "),disabled:!a.isEnabled(),title:a.Eb()||"",value:a.P()||""},a.zb()||"")};h.Gd=function(a){return"BUTTON"==a.tagName||"INPUT"==a.tagName&&("button"==a.type||"submit"==a.type||"reset"==a.type)};h.pa=function(a,b){ru(a,!1);a.tb&=-256;wu(a,32,!1);if(b.disabled){var c=this.Oc(1);Wt(b,c)}return Sw.m.pa.call(this,a,b)};
h.Hd=function(a){vt(a).listen(a.n(),"click",a.pb)};h.Jd=ca;h.Me=ca;h.Le=function(a){return a.isEnabled()};h.zc=ca;h.S=function(a,b,c){Sw.m.S.call(this,a,b,c);(a=a.n())&&1==b&&(a.disabled=c)};h.P=function(a){return a.value};h.De=function(a,b){a&&(a.value=b)};h.ib=ca;function Tw(a,b,c){qu.call(this,a,b||Sw.W(),c)}B(Tw,qu);h=Tw.prototype;h.P=function(){return this.C};h.Rf=function(a){this.C=a;this.i.De(this.n(),a)};h.Eb=function(){return this.u};h.Ia=function(a){this.u=a;this.i.Ia(this.n(),a)};h.Zd=function(a){this.u=a};h.J=function(){Tw.m.J.call(this);delete this.C;delete this.u};h.L=function(){Tw.m.L.call(this);if(iu(this,32)){var a=ku(this);a&&vt(this).listen(a,"keyup",this.Ac)}};
h.Ac=function(a){return 13==a.g&&"key"==a.type||32==a.g&&"keyup"==a.type?this.pb(a):32==a.g};ou("goog-button",function(){return new Tw(null)});function Uw(){}B(Uw,Rw);da(Uw);h=Uw.prototype;h.xa=function(a){var b=cu(this,a),b=a.g.s("div",{"class":"goog-inline-block "+b.join(" ")},this.vd(a.ra(),a.g));this.Ia(b,a.Eb());du(this,a,b);return b};h.ic=function(){return"button"};h.ya=function(a){return a&&a.firstChild.firstChild};h.vd=function(a,b){return b.s("div","goog-inline-block "+(this.A()+"-outer-box"),b.s("div","goog-inline-block "+(this.A()+"-inner-box"),a))};h.Gd=function(a){return"DIV"==a.tagName};
h.pa=function(a,b){Vw(b,!0);Vw(b,!1);var c;a:{c=a.g.Of(b);var d=this.A()+"-outer-box";if(c&&Vt(c,d)&&(c=a.g.Of(c),d=this.A()+"-inner-box",c&&Vt(c,d))){c=!0;break a}c=!1}c||b.appendChild(this.vd(b.childNodes,a.g));Xt(b,["goog-inline-block",this.A()]);return Uw.m.pa.call(this,a,b)};h.A=function(){return"goog-custom-button"};
function Vw(a,b){if(a)for(var c=b?a.firstChild:a.lastChild,d;c&&c.parentNode==a;){d=b?c.nextSibling:c.previousSibling;if(3==c.nodeType){var e=c.nodeValue;if(""==Aa(e))a.removeChild(c);else{c.nodeValue=b?e.replace(/^[\s\xa0]+/,""):e.replace(/[\s\xa0]+$/,"");break}}else break;c=d}};function Ww(){}B(Ww,Uw);da(Ww);Ww.prototype.ya=function(a){return Ww.m.ya.call(this,a&&a.firstChild)};Ww.prototype.pa=function(a,b){var c=ih(document,"*","goog-menu",b)[0];if(c){R(c,!1);gh(c).body.appendChild(c);var d=new Iw;zt(d,c);a.Vc(d)}return Ww.m.pa.call(this,a,b)};Ww.prototype.vd=function(a,b){return Ww.m.vd.call(this,[b.s("div","goog-inline-block "+(this.A()+"-caption"),a),b.s("div","goog-inline-block "+(this.A()+"-dropdown"),"\u00a0")],b)};Ww.prototype.A=function(){return"goog-menu-button"};function Xw(a,b,c,d,e){Tw.call(this,a,c||Ww.W(),d);wu(this,64,!0);this.l=new Qw(null,5);b&&this.Vc(b);this.da=new Hf(500);!li&&!mi||qc("533.17.9")||(this.Od=!0);this.ca=e||Gw.W()}B(Xw,Tw);h=Xw.prototype;h.Od=!1;h.L=function(){Xw.m.L.call(this);Yw(this,!0);this.h&&Zw(this,this.h,!0);St(this.Z,"haspopup",!!this.h)};h.Ba=function(){Xw.m.Ba.call(this);Yw(this,!1);if(this.h){this.oa(!1);this.h.Ba();Zw(this,this.h,!1);var a=this.h.n();a&&rh(a)}};
h.J=function(){Xw.m.J.call(this);this.h&&(this.h.ma(),delete this.h);delete this.la;this.da.ma()};h.Uc=function(a){Xw.m.Uc.call(this,a);ju(this,4)&&(this.oa(!ju(this,64),a),this.h&&(this.h.nb=ju(this,64)))};h.jc=function(a){Xw.m.jc.call(this,a);this.h&&!ju(this,4)&&(this.h.nb=!1)};h.pb=function(){vu(this,!1);return!0};h.bh=function(a){this.h&&this.h.za&&!this.wb(a.target)&&this.oa(!1)};h.wb=function(a){return a&&uh(this.n(),a)||this.h&&this.h.wb(a)||!1};
h.Ac=function(a){if(32==a.g){if(a.preventDefault(),"keyup"!=a.type)return!0}else if("key"!=a.type)return!1;if(this.h&&this.h.za){var b=this.h.Ra(a);return 27==a.g?(this.oa(!1),!0):b}return 40==a.g||38==a.g||32==a.g||13==a.g?(this.oa(!0,a),!0):!1};h.Ne=function(){this.oa(!1)};h.oh=function(){ju(this,4)||this.oa(!1)};h.Ld=function(a){this.Od||this.oa(!1);Xw.m.Ld.call(this,a)};
h.Vc=function(a){var b=this.h;if(a!=b&&(b&&(this.oa(!1),this.$&&Zw(this,b,!1),delete this.h),this.$&&St(this.Z,"haspopup",!!a),a)){this.h=a;wt(a,this);a.hc(!1);var c=this.Od;(a.md=c)&&Ru(a,!0);this.$&&Zw(this,a,!0)}return b};h.Ob=function(a,b){var c=Xw.m.Ob.call(this,a,b);c&&!this.Fa&&this.oa(!1);return c};h.setEnabled=function(a){Xw.m.setEnabled.call(this,a);this.isEnabled()||this.oa(!1)};
h.oa=function(a,b){Xw.m.oa.call(this,a);if(this.h&&ju(this,64)==a){if(a)this.h.$||this.h.render(),this.V=Pi(this.n()),this.T=Vi(this.n()),$w(this),this.h.Jb(!b||40!=b.g&&38!=b.g?-1:0);else{vu(this,!1);this.h.nb=!1;var c=this.n();c&&(St(c,"activedescendant",""),St(c,"owns",""));if(null!=this.o&&(this.o=void 0,c=this.h.n())){var d="",e;d instanceof dh?(e=d.height,d=d.width):e="";c.style.width=Si(d,!0);c.style.height=Si(e,!0)}}this.h.hc(a,!1,b);this.O||(c=vt(this),d=a?c.listen:c.ua,d.call(c,this.g.g,
"mousedown",this.bh,!0),this.Od&&d.call(c,this.h,"blur",this.oh),d.call(c,this.da,Jf,this.Kh),a?If(this.da):this.da.stop())}};function $w(a){if(a.h.$){var b=a.la||a.n(),c=a.l;a.l.g=b;b=a.h.n();a.h.za||(b.style.visibility="hidden",R(b,!0));!a.o&&a.l.o&&a.l.j&32&&(a.o=Ti(b));c.i(b,c.h^1,null,a.o);a.h.za||(R(b,!1),b.style.visibility="visible")}}
h.Kh=function(){var a=Vi(this.n()),b=Pi(this.n()),c=this.T;(c=!(c==a||c&&a&&c.left==a.left&&c.width==a.width&&c.top==a.top&&c.height==a.height))||(c=this.V,c=!(c==b||c&&b&&c.top==b.top&&c.right==b.right&&c.bottom==b.bottom&&c.left==b.left));c&&(this.T=a,this.V=b,$w(this))};function Zw(a,b,c){var d=vt(a);c=c?d.listen:d.ua;c.call(d,b,"action",a.Ne);c.call(d,b,"highlight",a.Sg);c.call(d,b,"unhighlight",a.Tg)}function Yw(a,b){var c=vt(a);(b?c.listen:c.ua).call(c,a.n(),"keydown",a.kh)}
h.Sg=function(a){var b=this.n();null!=a.target.n()&&(St(b,"activedescendant",a.target.n().id),St(b,"owns",a.target.n().id))};h.kh=function(a){iu(this,32)&&ku(this)&&this.h&&this.h.za&&a.l()};h.Tg=function(){if(!Mu(this.h)){var a=this.n();St(a,"activedescendant","");St(a,"owns","")}};ou("goog-menu-button",function(){return new Xw(null)});G||jc&&qc("1.9.3");function ax(a){a||eh();Md.call(this)}B(ax,Md);ax.prototype.set=function(a,b){Md.prototype.set.call(this,a,b);return this};function bx(a,b,c,d){return a.set(b.key,b.caption,c,d)}ax.prototype.render=function(){};ax.prototype.n=function(){return null};var cx={key:"ok",caption:"OK"},dx={key:"cancel",caption:"Cancel"},ex={key:"yes",caption:"Yes"},fx={key:"no",caption:"No"},gx={key:"save",caption:"Save"},hx={key:"continue",caption:"Continue"};
"undefined"!=typeof document&&(bx(new ax,cx,!0,!0),bx(bx(new ax,cx,!0),dx,!1,!0),bx(bx(new ax,ex,!0),fx,!1,!0),bx(bx(bx(new ax,ex),fx,!0),dx,!1,!0),bx(bx(bx(new ax,hx),gx),dx,!0,!0));function ix(){this.h=[]}B(ix,ww);da(ix);ix.prototype.xa=function(a){var b=ix.m.xa.call(this,a);Wt(b,"goog-submenu");jx(this,a,b);return b};ix.prototype.pa=function(a,b){b=ix.m.pa.call(this,a,b);Wt(b,"goog-submenu");jx(this,a,b);var c=ih(document,"div","goog-menu",b);if(c.length){var d=new Iw(a.g),c=c[0];R(c,!1);a.g.g.body.appendChild(c);zt(d,c);kx(a,d)}return b};ix.prototype.Nb=function(a,b){var c=this.ya(a),d=c&&c.lastChild;ix.m.Nb.call(this,a,b);d&&c.lastChild!=d&&Vt(d,"goog-submenu-arrow")&&c.appendChild(d)};
ix.prototype.Hd=function(a){ix.m.Hd.call(this,a);var b=a.X(),c=ih(a.g.g,"span","goog-submenu-arrow",b)[0];lx(a,c);c!=b.lastChild&&b.appendChild(c);a=a.n();St(a,"haspopup","true")};function jx(a,b,c){var d=b.g.s("span");d.className="goog-submenu-arrow";lx(b,d);a.ya(c).appendChild(d)}function lx(a,b){Ct(a)?(Wt(b,"goog-submenu-arrow-rtl"),vh(b,"\u25c4")):(Yt(b,"goog-submenu-arrow-rtl"),vh(b,"\u25ba"))};function mx(a,b,c,d){Dw.call(this,a,b,c,d||ix.W())}B(mx,Dw);h=mx.prototype;h.Nc=null;h.kf=null;h.Zf=!1;h.ta=null;h.yd=!1;h.L=function(){mx.m.L.call(this);vt(this).listen(this.getParent(),"hide",this.gg);this.ta&&nx(this,this.ta,!0)};h.Ba=function(){vt(this).ua(this.getParent(),"hide",this.gg);this.ta&&(nx(this,this.ta,!1),this.yd||(this.ta.Ba(),rh(this.ta.n())));mx.m.Ba.call(this)};h.J=function(){this.ta&&!this.yd&&this.ta.ma();this.ta=null;mx.m.J.call(this)};
h.Ha=function(a,b){mx.m.Ha.call(this,a);b&&(ox(this).nb=!0);a||(this.Nc&&r.clearTimeout(this.Nc),this.Nc=Kf(this.xb,218,this))};h.jf=function(){var a=this.getParent();a&&Mu(a)==this&&(px(this,!0),qx(this))};h.xb=function(){var a=this.ta;a&&a.getParent()==this&&(px(this,!1),At(a,function(a){"function"==typeof a.xb&&a.xb()}))};function rx(a){a.Nc&&r.clearTimeout(a.Nc);a.kf&&r.clearTimeout(a.kf)}h.Ob=function(a,b){var c=mx.m.Ob.call(this,a,b);c&&!this.Fa&&this.xb();return c};
function qx(a){At(a.getParent(),function(a){a!=this&&"function"==typeof a.xb&&(a.xb(),rx(a))},a)}h.Ra=function(a){var b=a.g,c=Ct(this)?37:39,d=Ct(this)?39:37;if(!this.Zf){if(!this.isEnabled()||b!=c&&b!=this.bf)return!1;this.jf();Nu(ox(this));rx(this)}else if(!ox(this).Ra(a))if(b==d)this.xb();else return!1;a.preventDefault();return!0};h.Hh=function(){this.ta.getParent()==this&&(rx(this),this.Dc.Ha(this),qx(this))};h.gg=function(a){a.target==this.Dc&&(this.xb(),rx(this))};
h.Xc=function(a){this.isEnabled()&&(rx(this),this.kf=Kf(this.jf,218,this));mx.m.Xc.call(this,a)};h.pb=function(a){rx(this);if(iu(this,8))return mx.m.pb.call(this,a);this.jf();return!0};
function px(a,b){a.dispatchEvent(tt(64,b));var c=ox(a);if(b!=c.za){b&&(c.$||c.render(),c.Jb(-1));a.Zf=b;var d=a.n();b?Wt(d,"goog-submenu-open"):Yt(d,"goog-submenu-open");c.hc(b);if(b){var c=new Nw(a.n(),6,!1),d=ox(a),e=d.n();d.za||(e.style.visibility="hidden",R(e,!0));c.i(e,4);d.za||(R(e,!1),e.style.visibility="visible")}}}function nx(a,b,c){var d=vt(a);(c?d.listen:d.ua).call(d,b,"enter",a.Hh)}h.wc=function(){return ox(this).wc()};
function ox(a){a.ta?a.yd&&a.ta.getParent()!=a&&wt(a.ta,a):kx(a,new Iw(a.g));a.ta.n()||a.ta.Q();return a.ta}function kx(a,b){var c=a.ta;b!=c&&(c&&(a.xb(),a.$&&nx(a,c,!1)),a.ta=b,a.yd=!1,b&&(wt(b,a),b.hc(!1,!0),b.md=!1,Ru(b,!1),a.$&&nx(a,b,!0)))}h.wb=function(a){return ox(this).wb(a)};ou("goog-submenu",function(){return new mx(null)});function sx(a){this.h=a;this.g=null}sx.prototype.logger=Q("ydn.crm.ui.gmail.Template");sx.prototype.t=function(){return this.h};function tx(a){if("FORM"!=a.tagName)return null;for(a=a.nextElementSibling;a&&"TABLE"!=a.tagName;)a=a.nextElementSibling;return a}function ux(a){a=Ch(a,"table");a=Ch(a.parentElement,"table");return Ch(a.parentElement,"table").querySelector("form")}
function vx(a,b){if(!a)return null;var c=b||To,d=ux(a);if(!d)return M(c,"Gmail header FORM not found"),null;d=d.querySelector("textarea[name=to]");if(!d)return M(c,"To textarea not found."),null;d=d.parentElement.querySelector("span[email]");return d?d?d.getAttribute("email"):null:(M(c,"email span not found in TO element"),null)}
sx.prototype.i=function(a){if(a.target instanceof Dw){var b=a.target.t();a=this.t();if(b){var c=vx(this.g,this.logger),d=!1;c||(c=Gv(a),d=!!c);c?wx(this,b.id,c).w(function(a){var f=ux(this.g),g=f.querySelector('input[name="subjectbox"]'),k=tx(f).querySelector('div[aria-label="Message Body"]');d&&(f.querySelector('textarea[name="to"]').value=c);g.value=b.name;f=document.createElement("span");f.innerHTML=a;k.appendChild(f)},function(a){throw a;},this):window.alert("A valid recipient email address is required in To input field.")}else window.open(aw(a)+
"/index.php?module=EmailTemplates&action=EditView&return_module=EmailTemplates&return_action=DetailView",$(a))}};
function xx(a,b){var c=new fh(b.ownerDocument);if(a.g)a.g.parentElement!=b&&(a.g.parentElement&&a.g.parentElement.removeChild(a.g),c=c.s("span"),c.className="crm-template inj",c.appendChild(a.g),b.insertBefore(c,b.firstElementChild));else{a.g=b;var d=new Iw(c),e=new Xw("$t",d,null,c);e.Ia("Insert SugarCRM template");yx(a,function(a){for(var b=[],c=0;c<a.length;c++)-1==b.indexOf(a[c].type)&&b.push(a[c].type);for(c=0;c<b.length;c++)if(b[c]){for(var e=new mx(b[c],null,d.g),m=0;m<a.length;m++)if(a[m].type==
b[c]){var n=new Dw(a[m].name,a[m]);ox(e).M(n,!0)}d.M(e,!0)}for(m=0;m<a.length;m++)a[m].type||(n=new Dw(a[m].name,a[m]),d.M(n,!0));d.M(new Hw,!0);d.M(new Dw("New template...",null),!0)},a);c=c.s("span");c.className="crm-template inj";b.insertBefore(c,b.firstElementChild);e.render(c);Yc(d,"action",a.i,!0,a)}}
function yx(a,b,c){cw(a.t(),"EmailTemplates",void 0,void 0,void 0,200).w(function(a){a=a[0];for(var e=[],f=0;f<a.result.length;f++){var g=a.result[f],k=g.body_html;e.push({id:g.id,name:g.name,type:g.type||"",mi:0<=k.indexOf("$contact_name")||0<=k.indexOf("$contact_account_name")})}b.call(c,e)},function(a){throw a;},a)}
function wx(a,b,c){var d=a.t();if(v(c))return d.send("query",[{store:"Contacts",index:"ydn$emails",key:c,limit:1},{store:"Leads",index:"ydn$emails",key:c,limit:1}]).B(function(a){var c=null;a[0].result[0]?c=new qr($(d),"Contacts",a[0].result[0]):a[1].result[0]&&(c=new qr($(d),"Leads",a[1].result[0]));a=c?new pv(d,c):null;return wx(this,b,a)},a);if(!v(b)||16>b.length)throw Error("valid template id required, but "+b+" found.");return d.send("get",{module:"EmailTemplates",id:b}).B(function(a){a=a.body_html;
if(v(a)){var d=this.t().j;if(d&&d.g){var g;g=this.t().o.Users;for(var k in g.module_fields)g=d.value(k),v(g)&&(a=a.replace(new RegExp("\\$user_"+k,"g"),g))}else M(this.logger,"Login user info not available");if(c&&rv(c))for(k in d=ev(c),d.module_fields)g=c.value(k),v(g)&&(a=a.replace(new RegExp("\\$contact_"+k,"g"),g));return a}throw Error("Template record: "+b+" does not have body_html");},a)};function zx(a,b){var c=a.type;if(t(c))switch(c.toLowerCase()){case "checkbox":case "radio":a.checked=b?"checked":null;break;case "select-one":a.selectedIndex=-1;if(v(b))for(var d=0;c=a.options[d];d++)if(c.value==b){c.selected=!0;break}break;case "select-multiple":c=b;v(c)&&(c=[c]);for(var e=0;d=a.options[e];e++)if(d.selected=!1,c)for(var f,g=0;f=c[g];g++)d.value==f&&(d.selected=!0);break;default:a.value=null!=b?b:""}};function Ax(){}da(Ax);Ax.prototype.A=function(){return"field"};function Bx(a){var b=dv(a);a="ydnf-"+(a.parent.module.Y()+"-"+a.g);if("enum"==b.type&&b.options&&!document.getElementById(a)){var c=document.createElement("datalist");c.id=a;for(var d in b.options)d&&(b=document.createElement("option"),b.setAttribute("value",d),c.appendChild(b));document.body.appendChild(c)}return a}
Ax.prototype.refresh=function(a,b){R(a,!!b);if(b){var c=fv(b),d=v(c)?!ya(c):null!=c,e=a.querySelector(".value");"LABEL"==e.tagName||"SPAN"==e.tagName||"DIV"==e.tagName?e.textContent=d?c:"":("bool"!=iv(b)||ga(c)||(c="1"==c||"on"==c?!0:!1),zx(e,c));d?a.classList.remove("empty"):a.classList.add("empty")}};function Cx(a,b,c){Y.call(this,c);this.h=b||Ax.W();this.qa(a)}B(Cx,Y);
Cx.prototype.Q=function(){var a=this.h,b=this.t(),c=this.g,d=c.s("div");d.classList.add(a.A());this.Z=d;var e,f,g=hv(b);e=iv(b);var k;k=(k=dv(b))?!!k.calculated:!1;"bool"==e?(f="ydn:"+(rt.W().g++).toString(36),e=c.s("input",{type:"checkbox",id:f}),f=c.s("label",{"for":f},g),k&&e.setAttribute("disabled","true")):"text"==e?e=c.s("TEXTAREA"):"enum"==e?(e=c.s("input",{"class":"enum",type:"text"}),e.setAttribute("list",Bx(b))):(e=c.s("div","value"),k||e.setAttribute("contenteditable","true"));e.classList.add("value");
d.classList.add(a.A());d.setAttribute("name",b.g);d.appendChild(e);f?d.appendChild(f):e.setAttribute("title",g)};Cx.prototype.refresh=function(){this.h.refresh(this.n(),this.t())};Cx.prototype.P=function(){return fv(this.t())};function Dx(){this.i=0}var Ex=new Dx;Dx.prototype.render=function(){};Dx.prototype.h=function(){return++this.i};Dx.prototype.fa=function(){return this.i};function Fx(){this.i=0;this.g=document.createElement("div");var a=document.createElement("div");a.className="statusbar";this.g.className="message";a.appendChild(this.g)}B(Fx,Dx);Fx.prototype.render=function(a){a.appendChild(this.g.parentElement)};
Fx.prototype.h=function(a,b){var c=Fx.m.h.call(this,a,b);this.g.g=a;b?this.g.classList.add("error"):this.g.classList.remove("error");return c};function Gx(a,b){Y.call(this,b);this.qa(a)}B(Gx,Y);Gx.prototype.A=function(){return"record-body"};Gx.prototype.Q=function(){Gx.m.Q.call(this);var a=this.n();a.classList.add(this.A());a.classList.add("view")};
Gx.prototype.h=function(a,b){for(var c=uv(this.t())||{},d=0;d<Bt(this);d++)for(var e=Z(this,d),f=e.t(),g=0;g<b.length;g++){var k=b[g];if(lv(f,k)){var l;a:{for(var m=0;m<Bt(e);m++)if(l=Z(e,m),l.t().g==k)break a;l=null}if(l){m=c;var n=l;l=n.X().querySelector(".value");"LABEL"==l.tagName||"SPAN"==l.tagName||"DIV"==l.tagName?l=l.textContent.trim():"INPUT"==l.tagName&&"checkbox"==l.type?(n=fv(n.t()),l=ga(n)?l.checked?!0:!1:"on"==n||"off"==n?l.checked?"on":"off":l.checked?"1":"0"):l=l.value.trim();m[k]=
l}}}return c};Gx.prototype.refresh=function(){for(var a=0;a<Bt(this);a++)Z(this,a).refresh()};function Hx(){}da(Hx);Hx.prototype.A=function(){return"record-group"};
Hx.prototype.g=function(a){var b=a.g,c=b.s("div",this.A()),d=b.s("div"),e=b.s("div","content");c.appendChild(d);c.appendChild(e);a.Z=c;c.setAttribute("name",a.t().g);for(var d=a.t(),e=kv(d),f=Ax.W(),g=0;g<e.length;g++){var k=mv(d,e[g]),k=new Cx(k,f,b);a.M(k,!0)}a=d.module;b=a.parent.p||null;a=x(b)?Ic(b,["modules",a.Y()]):null;(a=x(a)?Ic(a,["groups",d.g]):null)?d=a.normallyHide:(d=d.g,d=/address/i.test(d)?!1:0<=["email","name","phone"].indexOf(d)?!1:!0);d&&c.classList.add("normally-hide");return c};function Ix(){}B(Ix,Hx);da(Ix);Ix.prototype.A=function(){return"address"};Ix.prototype.g=function(a){var b=a.g,c=b.s("div",this.A()),d=a.t();c.setAttribute("name",d.g);c.classList.add("record-group");var e=b.s("details"),f=b.s("summary");f.textContent=ov(d);c.appendChild(f);var g=b.s("div","content");e.appendChild(f);e.appendChild(g);c.appendChild(e);a.Z=c;e=kv(d);for(f=0;f<e.length;f++)g=mv(d,e[f]),g=new Cx(g,null,b),a.M(g,!0);return c};function Jx(){}B(Jx,$t);da(Jx);Jx.prototype.A=function(){return"field"};function Kx(a){var b=dv(a);a="ydnf-"+(a.parent.module.Y()+"-"+a.g);if("enum"==b.type&&b.options&&!document.getElementById(a)){var c=document.createElement("datalist");c.id=a;for(var d in b.options)d&&(b=document.createElement("option"),b.setAttribute("value",d),c.appendChild(b));document.body.appendChild(c)}return a}
Jx.prototype.xa=function(a){var b=Jx.m.xa.call(this,a);a.Z=b;var c=a.t();a=a.g;var d,e,f=hv(c);d=iv(c);"bool"==d?(d=a.s("input",{"class":"value",type:"checkbox",disabled:"1"}),e=a.s("span","name")):"enum"==d?(d=a.s("input",{"class":"value enum",type:"text",disabled:"1"}),d.setAttribute("list",Kx(c))):(d=a.s("label","value"),e=a.s("sup","name"));b.classList.add(this.A());b.setAttribute("name",c.g);b.appendChild(d);e&&(e.textContent=f,b.appendChild(e));return b};
Jx.prototype.refresh=function(a,b){R(a,!!b);if(b){var c=fv(b),d=v(c)?!ya(c):null!=c,e=a.querySelector(".value");"LABEL"==e.tagName?e.textContent=d?c:"":zx(e,c);d?a.classList.remove("empty"):a.classList.add("empty")}};function Lx(a,b,c){qu.call(this,null,b,c);ru(this,!1);tu(this);this.tb&=-256;wu(this,32,!1);wu(this,8,!1);this.qa(a)}B(Lx,qu);mu(Lx,Jx);Lx.prototype.refresh=function(){this.i.refresh(this.n(),this.t())};mu(Lx,Jx);function Mx(a,b,c){Y.call(this,c);this.h=b||new Hx;this.qa(a)}B(Mx,Y);Mx.prototype.Q=function(){this.h.g(this)};Mx.prototype.X=function(){return hh("content",this.n())};Mx.prototype.refresh=function(){for(var a=0;a<Bt(this);a++)Z(this,a).refresh()};function Nx(a,b){var c=Ix.W();Mx.call(this,a,c,b)}B(Nx,Mx);Nx.prototype.X=function(){return this.n().querySelector(".content")};Nx.prototype.L=function(){vt(this).listen(this.n().querySelector("summary"),"click",this.i)};Nx.prototype.i=function(a){var b=a.target.parentElement;"DETAILS"==b.tagName&&(a.target.textContent=b.hasAttribute("open")?Ox(this):ov(this.t()))};
function Ox(a){a=a.t();var b=nv(a,"primary_address_country")||nv(a,"alt_address_country"),c=nv(a,"primary_address_city")||nv(a,"alt_address_city"),d=nv(a,"primary_address_state")||nv(a,"alt_address_state"),e=nv(a,"primary_address_postalcode")||nv(a,"alt_address_postalcode"),f="";b&&(f+=fv(b));d&&gv(d)?f=e&&gv(e)?fv(d)+" "+fv(e)+", "+f:f+(" "+fv(d)):e&&gv(e)&&(f+=" "+fv(e));f||(b=nv(a,"primary_address_street")||nv(a,"alt_address_street"))&&(f=fv(b));f||(b=nv(a,"alt_address_street_2")||nv(a,"alt_address_street_2"))&&
(f=fv(b));c&&gv(c)&&(f=fv(c)+" "+f);return f||ov(a)}Nx.prototype.refresh=function(){this.n().querySelector("summary").textContent=Ox(this);for(var a=0;a<Bt(this);a++)Z(this,a).refresh()};function Px(){}B(Px,Hx);da(Px);Px.prototype.A=function(){return"email"};Px.prototype.g=function(a){var b=a.g,c=b.s("div",this.A()),d=a.t();c.setAttribute("name",d.g);c.classList.add("record-group");var e=b.s("div");e.setAttribute("title",ov(d));c.appendChild(e);b=b.s("div","content");c.appendChild(e);c.appendChild(b);return a.Z=c};
function Qx(a,b,c,d,e,f){b?(a.textContent=c||b,a.setAttribute("name",b),b="",d&&(b+=" primary"),e&&(b+=" optout"),f&&(b+=" deleted"),a.className=b):(a.textContent="",a.className="empty")}
Px.prototype.refresh=function(a){var b=a.n(),c=a.t();R(b,!!c);if(c){var b=a.g,d=mv(c,"email"),e=d?d.Qc():null,d=u(e);a=a.X();if(d){for(d=0;d<e.length;d++){var c=e[d],f=a.children[d];f||(f=b.s("SPAN"),a.appendChild(f));c&&Qx(f,c.email_address,void 0,"1"==c.primary_address?!0:!1,"1"==c.opt_out?!0:!1,"1"==c.deleted?!0:!1)}for(d=a.childElementCount-1;d>=e.length;d--)a.removeChild(a.children[d])}else{e=kv(c);for(d=0;d<e.length;d++){var g=e[d],f=a.children[d];f||(f=b.s("SPAN"),a.appendChild(f));(g=mv(c,
g))&&Qx(f,fv(g))}for(d=a.childElementCount-1;d>=e.length;d--)a.removeChild(a.children[d])}}};function Rx(a,b){var c=Px.W();Mx.call(this,a,c,b)}B(Rx,Mx);Rx.prototype.X=function(){return hh("content",this.n())};Rx.prototype.refresh=function(){this.h.refresh(this)};function Sx(){}B(Sx,Hx);da(Sx);Sx.prototype.A=function(){return"list"};Sx.prototype.g=function(a){var b=a.g,c=b.s("div",this.A()),d=a.t();c.setAttribute("name",d.g);c.classList.add("record-group");var e=b.s("div");e.setAttribute("title",ov(d));c.appendChild(e);var f=b.s("div","content");c.appendChild(e);c.appendChild(f);a.Z=c;e=kv(d);for(f=0;f<e.length;f++){var g=mv(d,e[f]),g=new Cx(g,null,b);a.M(g,!0)}return c};function Tx(a,b){var c=Sx.W();Mx.call(this,a,c,b)}B(Tx,Mx);Tx.prototype.X=function(){return hh("content",this.n())};Tx.prototype.refresh=function(){for(var a=0;a<Bt(this);a++)Z(this,a).refresh()};function Ux(){}B(Ux,Hx);da(Ux);Ux.prototype.A=function(){return"name"};
Ux.prototype.g=function(a){var b=a.g,c=b.s("div",this.A()),d=a.t();c.setAttribute("name",d.g);c.classList.add("record-group");var e=b.s("div");e.setAttribute("title",ov(d));c.appendChild(e);var f=b.s("div","content");c.appendChild(e);c.appendChild(f);a.Z=c;kv(d);lv(d,"salutation")&&(e=mv(d,"salutation"),e=new Cx(e,null,b),a.M(e,!0));lv(d,"first_name")&&a.M(new Cx(mv(d,"first_name"),null,b),!0);lv(d,"last_name")&&a.M(new Cx(mv(d,"last_name"),null,b),!0);return c};function Vx(a,b){var c=Ux.W();Mx.call(this,a,c,b)}B(Vx,Mx);Vx.prototype.X=function(){return hh("content",this.n())};Vx.prototype.refresh=function(){for(var a=0;a<Bt(this);a++)Z(this,a).refresh()};function Wx(a,b){Gx.call(this,a,b)}B(Wx,Gx);Wx.prototype.Q=function(){Wx.m.Q.call(this);this.n();var a=this.g,b=this.t(),c=[],d=ev(b),e;for(e in d.module_fields){var f=d.module_fields[e].group;-1==c.indexOf(f)&&c.push(f)}d=Hx.W();for(e=0;e<c.length;e++){var f=c[e],g,k=wv(b,f);/address/i.test(f)?g=new Nx(k,a):"email"==f?g=new Rx(k,a):"phone"==f?g=new Tx(k,a):"name"==f?g=new Vx(k,a):g=new Mx(k,d,a);this.M(g,!0)}};function Xx(){}da(Xx);function Yx(a){return a.querySelector(".record-footer")}function Zx(a){var b;b=a.n().querySelector(".record-footer div.message");b.textContent="";b.classList.remove("error");a=a.n().querySelector(".record-footer button[name=save]");a.textContent="Save";a.removeAttribute("disabled")};function $x(){}da($x);
$x.prototype.refresh=function(a){var b=a.t(),c=b.Y(),d;d=a.n().querySelector(".record-header .title");a=a.n().querySelector(".record-header .link");rv(b)?(d.textContent=b.g.g?xr(b.g):"",d.href=rr(b.g),d.target=$(b.parent),b instanceof zv?(a.textContent="",Lv(b)?(a.classList.add("synced"),a.setAttribute("title","Gmail contact "+aq(Iv(b))+" is synced with SugarCRM "+c+" "+b.H())):(a.classList.remove("synced"),!b.h&&rv(b)&&Jv(b.getParent())?(a.textContent="link",a.setAttribute("title","Link Gmail contact "+
aq(Iv(b))+" with SugarCRM "+c+" "+b.H())):(a.textContent="export",a.setAttribute("title","Export SugarCRM "+c+" "+b.H()+" to Gmail My Contact"))),R(a,!0)):R(a,!1)):(d.textContent="",d.href="")};function ay(a){return a.querySelector(".record-header")};function by(a,b){Gx.call(this,a,b)}B(by,Gx);by.prototype.Q=function(){by.m.Q.call(this);var a=this.g,b=this.t(),c=wv(b,"name"),b=wv(b,""),c=mv(c,"name"),b=mv(b,"description");this.M(new Cx(c,null,a),!0);this.M(new Cx(b,null,a),!0)};by.prototype.h=function(a){var b=uv(this.t())||{},c=Z(this,0).h(),d=Z(this,1).h();if(!c)return Ex.h("Note title required.",!0),null;b.name=c;b.description=d;if(a=a.p)a=a.t(),b.parent_type=a.Y(),b.parent_id=a.H(),b.parent_name=a.value("name");return b};function cy(a,b){Y.call(this,b);this.qa(a)}B(cy,Y);cy.prototype.A=function(){return"secondary"};cy.prototype.Q=function(){cy.m.Q.call(this);this.n().classList.add(this.A())};cy.prototype.L=function(){cy.m.L.call(this);var a=this.t();if(0<=Nq.indexOf(a.Y())){var b=vt(this);b.listen(a,"module-change",this.h);b.listen(a,"record-change",this.h);this.h()}};
cy.prototype.h=function(){for(;this.Ea&&0!=this.Ea.length;){var a=Z(this,0);this.removeChild(a,!0);a.ma()}a=this.t();if(rv(a)){var b=a.parent,a=[{store:"Notes",index:"parent",reverse:!0,keyRange:Ij([a.Y(),a.H()])}];b.send("query",a).w(function(a){for(var d=0;d<a.length;d++){var e=a[d];e.result&&0<e.result.length&&(e=new pv(this.t().parent,new qr($(b),"Notes",e.result[0])),e=new dy(e,this.g),this.M(e,!0))}},function(a){throw a;},this)}};function dy(a,b,c){Y.call(this,b);this.qa(a);this.p=c||null;this.l=$x.W();this.h=ey(this);this.o=new cy(a,b);Xx.W();this.i=new MutationObserver(this.Gh.bind(this));this.j=[]}B(dy,Y);dy.prototype.logger=Q("ydn.crm.ui.sugar.record.Record");dy.prototype.A=function(){return"record-panel"};function ey(a){var b=a.t();a=a.g;return"Notes"==b.Y()?new by(b,a):new Wx(b,a)}dy.prototype.X=function(){return this.n().querySelector(".content")};
dy.prototype.Q=function(){dy.m.Q.call(this);var a=this.n(),b=this.g;a.className=this.A()+" "+this.t().Y();var c=b.s("div","record-header"),d=b.s("div","content");a.appendChild(c);a.appendChild(d);var c=ay(this.n()),d=this.g,e=this.t().Y(),f=d.s("div");c.appendChild(f);var g=d.s("a","title"),e=d.s("span","icon",e.substr(0,2)),k=d.s("a",{href:"#link","class":"link"});f.appendChild(e);f.appendChild(g);f.appendChild(k);g=d.s("div","toolbar");g.appendChild(d.s("a",{name:"Notes","class":"new-item",href:"#new-Notes"},
"Add Note"));g.appendChild(d.s("a",{name:"edit",href:"#edit"},"edit"));g.appendChild(d.s("a",{name:"detail",href:"#detail"},"Detail"));c.appendChild(f);c.appendChild(g);this.M(this.h,!0);this.M(this.o,!0);b=b.s("div","record-footer");a.appendChild(b);d=this.g;a=Yx(this.n());b=d.s("button",{type:"button",name:"save"},"Save");c=d.s("button",{type:"button",name:"cancel"},"Cancel");d=d.s("div","message");a.appendChild(b);a.appendChild(c);a.appendChild(d)};
var fy={childList:!1,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:["value"]};h=dy.prototype;
h.L=function(){dy.m.L.call(this);var a=vt(this),b=this.t();a.listen(b,"click",this.Xf,!1);var c=this.n().querySelector(".record-footer");a.listen(c,"click",this.fh,!0);a.listen(b,"module-change",this.Xf);a.listen(b,Av,this.Yf);a.listen(b,"record-change",this.Yf);a.listen(b,"record-update",this.th);b=this.n().querySelector(".record-header");a.listen(b,"click",this.gh,!1);a.listen(this.n(),"dblclick",this.$g,!1);gy(this)};
h.Gh=function(a){window.console.log(a);this.h.n().classList.contains("edit")||hy(this,!0);for(var b=0;b<a.length;b++){var c=a[b].target instanceof Element?a[b].target:a[b].target.parentElement;c.classList.contains("value")&&(c=Ch(c,null,"field"))&&(c=c.getAttribute("name"))&&-1==this.j.indexOf(c)&&this.j.push(c)}};
h.gh=function(a){this.n().classList.add("activated");var b=a.target.getAttribute("name");if(a.target.classList.contains("new-item"))a.preventDefault(),iy(this,Lq[Lq.indexOf(b)]);else if(a.target.classList.contains("link")){a.preventDefault();var c=a.target;c.classList.contains("synced")?N(this.logger,"record in sync"):(a=this.t(),a instanceof zv&&(!a.h&&rv(a)&&Jv(a.getParent())?(c.textContent="...",Rv(a).w(function(){c.textContent=""},function(a){c.textContent="error";throw a;},this)):(c.textContent=
"...",Pv(a).w(function(){c.textContent=""},function(a){c.textContent="error";throw a;},this))))}else"detail"==b?jy(this,a):"edit"==b&&(a.preventDefault(),a=this.h.n().classList.contains("edit"),hy(this,!a))};h.$g=function(){};
function hy(a,b){var c=a.h;b?(c.n().classList.add("edit"),c.n().classList.remove("view")):(c.n().classList.remove("edit"),c.n().classList.add("view"));c=Yx(a.n());b?(c.classList.add("edit"),c.classList.remove("view")):(c.classList.remove("edit"),c.classList.add("view"));b?a.n().classList.remove("empty"):rv(a.t())?a.h.refresh():a.n().classList.add("empty")}
h.fh=function(a){var b=a.target.getAttribute("name");"save"==b?ky(this,a):"cancel"==b&&(this.i.disconnect(),hy(this,!1),this.i.observe(this.h.X(),fy))};
function ky(a,b){var c=a.t(),d=b.target,e=0==a.j.length?null:a.h.h(a,a.j);e?(d.textContent="saving...",d.setAttribute("disabled","1"),c.save(e).w(function(){Ex.h("saved",void 0);this.i.disconnect();hy(this,!1);this.i.observe(this.h.X(),fy);d.textContent="Save";d.removeAttribute("disabled")},function(a){d.textContent="Save";Ex.h("error saving "+a.message,!0)},a)):Ex.h("data not modified",void 0)}
function jy(a,b){b.preventDefault();var c=a.n(),d=a.h.n(),c=c.querySelector("a[name=detail]");"detail"!=c.textContent?(c.textContent="detail",d.classList.remove("detail")):(c.textContent="less",d.classList.add("detail"))}function iy(a,b){var c=a.t().parent,c=new pv(c,new qr($(c),b)),c=new dy(c,a.g,a);a.o.M(c,!0);hy(c,!0)}h.Xf=function(){this.i.disconnect();gy(this);this.removeChild(this.h,!0);this.h.ma();this.h=ey(this);this.kd(this.h,0,!0);this.h.refresh();this.i.observe(this.h.X(),fy)};
h.Yf=function(){this.i.disconnect();gy(this);this.i.observe(this.h.X(),fy)};h.th=function(){this.i.disconnect();this.refresh();this.i.observe(this.h.X(),fy)};
function gy(a){var b=a.t(),c=a.n();hy(a,!1);var d=a.l,e=a.n().querySelector("a[name=detail]");e.textContent="Detail";R(e,!0);for(var e=0<=Oq.indexOf(a.t().Y()),f=a.n().querySelectorAll(".new-item"),g=f.length-1;0<=g;g--)R(f[g],e);e=a.t().Y();f=ay(a.n());hh("icon",f).textContent=e.substring(0,2);e=f.querySelector("a[name=edit]");R(e,!1);d.refresh(a);Zx(a);d=a.h.n();d.classList.add("view");d.classList.remove("edit");a.h.refresh();c.className=rv(b)?a.A()+" "+b.Y():a.A()+" "+b.Y()+" empty"}
h.Ba=function(){dy.m.Ba.call(this);this.i.disconnect()};h.refresh=function(){rv(this.t())?this.n().classList.remove("empty"):this.n().classList.add("empty");this.l.refresh(this);Zx(this);this.h.refresh();this.j.length=0};h.toString=function(){return"ydn.crm.ui.sugar.record.Record:"+this.t()};function jw(){kd.call(this);this.h=this.g=null}B(jw,kd);jw.prototype.J=function(){this.g&&(this.g.ma(),this.h=this.g=null)};function kw(a,b){a.h=b;a.g=new Ff(a);a.g.listen(b,"click",a.i,!0)}jw.prototype.n=function(){return this.h};jw.prototype.i=function(a){var b=this.n(),c=this.n();(c.classList.contains("error")?ly:c.href?"n":"v")==ly?(a.preventDefault(),b.textContent="Error reported, thanks.",b.removeAttribute("href"),b.removeAttribute("title"),b.classList.remove("error")):this.dispatchEvent(a)};
var ly="e";function mw(a,b,c,d){a=a.n();a.classList.remove("error");c?a.href=c:a.removeAttribute("href");b?(a.textContent=b,R(a,!0)):R(a,!1);d?a.setAttribute("title",d):a.removeAttribute("title")}function qw(a,b,c){a=a.n();a.classList.add("error");a.href="#error";a.textContent="error";b&&b instanceof Error&&(b=b.name+": "+b.message);a.setAttribute("title","Click to report error"+(b?" for "+b:""));c&&Ed().send("log-bug",c)};function my(a,b){Y.call(this,b);this.qa(a);this.h=new jw;this.i=new jw}B(my,Y);h=my.prototype;h.logger=Q("ydn.crm.ui.GDataPanel");h.X=function(){return hh("gdata-content",this.n())};
h.Q=function(){my.m.Q.call(this);var a=this.n(),b=this.t(),c=b.Y(),d=this.g,e=d.s("div","record-root");a.appendChild(e);var a=d.s("div","gdata-header"),f=d.s("div","gdata-content");e.appendChild(a);e.appendChild(f);e.classList.add(c);d.s("span",{"class":"icon"},c.substr(0,2));c=d.s("a",{"class":"import",href:"#import"},"Add to "+c);c.style.zIndex=1E3;c=d.s("div",{"class":"import"},c);a.appendChild(c);b=new dy(b,d);this.M(b,!0)};
h.L=function(){my.m.L.call(this);var a=this.n(),b=vt(this),c=this.t();kw(this.h,ih(document,"A","import",a)[0]);b.listen(this.h,"click",this.jh,!1);b.listen(this.i,"click",this.nh,!1);b.listen(c,[Av],this.Wf);b.listen(c,"record-change",this.Wf)};
h.Wf=function(){var a,b;b=this.t();var c=hh("gdata-header",this.n());if(rv(b))R(c,!1);else{R(c,!0);a=this.t();var d=Iv(a),e=a.Y(),f="Add to "+e;b="Add current contact "+Kv(a)+" to SugarCRM "+e;rv(a)?(b=f="",d&&!Lv(a)&&aq(d)):!(d=Iv(a))||d instanceof xv||(f="Import to "+e,b="Import existing gmail contact "+Kv(a)+" to SugarCRM "+e);a=f;c.querySelector(".import").querySelector("a");a?(R(c,!0),mw(this.h,a,"#import",b)):R(c,!1)}};
h.nh=function(){var a=this.t();mw(this.i,"Linking...");Rv(a).w(function(){mw(this.i,"Done.");this.dispatchEvent(new H("record-change"))},function(a){a=a instanceof Error?a.name+" "+a.message:x(a)?Th(a):a;var c;c=this.n();c=Ch(c,null,"sidebar");qw(this.i,a,{"class":"RecordHeader",method:"handleLinkClick",context:"link",html:c?c.outerHTML:"",error:a})},this)};
h.jh=function(){var a=this.t();mw(this.h,"Adding... to "+a.Y());var b;Iv(a)?(b=Mv(a),b=b.B(function(){mw(this.h,"Linking GData and SugarCRM...");return Rv(a)},this)):b=Nv(a);b.w(function(){mw(this.h,null);this.dispatchEvent(new H("change",this))},function(a){a=a instanceof Error?a.name+" "+a.message:x(a)?Th(a):a;var b;b=this.n();b=Ch(b,null,"sidebar");qw(this.h,a,{"class":"RecordHeader",method:"handleImportClick",context:"link",html:b?b.outerHTML:"",error:a})},this)};function ny(){}B(ny,Ew);da(ny);ny.prototype.xa=function(a){return a.g.s("div",this.A()+" goog-inline-block","\u00a0")};ny.prototype.pa=function(a,b){b=ny.m.pa.call(this,a,b);Wt(b,"goog-inline-block");return b};ny.prototype.A=function(){return"goog-toolbar-separator"};function oy(){this.g="toolbar"}B(oy,Bu);da(oy);oy.prototype.Pc=function(a){return"HR"==a.tagName?new Fw(ny.W()):oy.m.Pc.call(this,a)};oy.prototype.A=function(){return"goog-toolbar"};oy.prototype.Nf=function(){return Gu};function py(a,b,c){Iu.call(this,b,a||oy.W(),c)}B(py,Iu);function qy(a){kd.call(this);this.g=[];ry(this,a)}B(qy,kd);qy.prototype.h=null;function ry(a,b){b&&(tb(b,function(a){sy(a,!1)},a),Fb(a.g,b))}qy.prototype.wc=function(){return Eb(this.g)};function ty(a){var b=a.h;return b?sb(a.g,b):-1}qy.prototype.clear=function(){Bb(this.g);this.h=null};qy.prototype.J=function(){qy.m.J.call(this);delete this.g;this.h=null};function sy(a,b){a&&"function"==typeof a.Gc&&a.Gc(b)};function uy(a,b,c,d,e){Xw.call(this,a,b,c,d,e||new Gw("listbox"));this.p=this.ra();this.G=null}B(uy,Xw);h=uy.prototype;h.na=null;h.L=function(){uy.m.L.call(this);vy(this);wy(this)};h.$b=function(a){uy.m.$b.call(this,a);(a=this.zb())?(this.p=a,vy(this)):xy(this)||this.na&&yy(this,this.na.g[0]||null)};h.J=function(){uy.m.J.call(this);this.na&&(this.na.ma(),this.na=null);this.p=null};h.Ne=function(a){yy(this,a.target);uy.m.Ne.call(this,a);a.l();this.dispatchEvent("action")};
h.uh=function(){var a=xy(this);uy.m.Rf.call(this,a&&a.P());vy(this)};h.Vc=function(a){var b=uy.m.Vc.call(this,a);a!=b&&(this.na&&this.na.clear(),a&&(this.na?At(a,function(a){zy(a);var b=this.na,e=b.g.length;a&&(sy(a,!1),Gb(b.g,e,0,a))},this):Ay(this,a)));return b};function yy(a,b){if(a.na){var c=xy(a),d=a.na;b!=d.h&&(sy(d.h,!1),d.h=b,sy(b,!0));d.dispatchEvent("select");b!=c&&a.dispatchEvent("change")}}
h.Rf=function(a){if(null!=a&&this.na)for(var b=0,c;c=this.na.g[b]||null;b++)if(c&&"function"==typeof c.P&&c.P()==a){yy(this,c);return}yy(this,null)};h.P=function(){var a=xy(this);return a?a.P():null};function xy(a){return a.na?a.na.h:null}function Ay(a,b){a.na=new qy;b&&At(b,function(a){zy(a);var b=this.na,e=b.g.length;a&&(sy(a,!1),Gb(b.g,e,0,a))},a);wy(a)}function wy(a){a.na&&vt(a).listen(a.na,"select",a.uh)}
function vy(a){var b=xy(a),c=b?b.zb():a.p;a.i.Nb(a.n(),c);a.Fb=c;(c=a.i.ya(a.n()))&&a.g.Eh(c)&&(null==a.G&&(a.G=Tt(c)),a=(b=b?b.n():null)?Tt(b):a.G,St(c,"label",a))}function zy(a){a.Uf=a instanceof Dw?"option":"separator"}h.oa=function(a,b){uy.m.oa.call(this,a,b);ju(this,64)&&(this.h||this.Vc(new Iw(this.g,this.ca)),(this.h||null).Jb(this.na?ty(this.na):-1))};ou("goog-select",function(){return new uy(null)});function By(){}B(By,Ww);da(By);By.prototype.A=function(){return"goog-toolbar-menu-button"};function Cy(a,b,c,d){uy.call(this,a,b,c||By.W(),d)}B(Cy,uy);ou("goog-toolbar-select",function(){return new Cy(null)});function Dy(){}B(Dy,$t);da(Dy);h=Dy.prototype;h.ic=function(){};function Ey(a,b,c,d){var e=d.s("div",a.A()+"-inner-box"),f=d.s("div",a.A()+"-clear","\u00d7");a=d.s("div",a.A()+"-outer-box",[e,f]);d.appendChild(b,a);d.appendChild(e,c)}h.pa=function(a,b){var c=a.g,d=b;b=c.s("div","goog-inline-block");c.Dh(b,d);Ey(this,b,d,c);Dy.m.pa.call(this,a,b);a.Fb=d.value;return b};
h.xa=function(a){var b=a.g,c=b.s("div","goog-inline-block "+cu(this,a).join(" "));a=b.s("input",{type:"text",value:a.ra()||"",disabled:!a.isEnabled()});Ey(this,c,a,b);return c};h.Gd=function(a){return"INPUT"==a.tagName&&(!a.type||"TEXT"==a.type.toUpperCase())};h.ya=function(a){if(a)a:{a=a.getElementsByTagName("input");for(var b=0;b<a.length;++b){var c=a[b];if(!c.type||"TEXT"==c.type.toUpperCase()){a=c;break a}}a=null}else a=null;return a};h.Tf=function(a){return this.ya(a.n())};h.Me=ca;h.Le=function(a){return a.isEnabled()};
h.zc=ca;h.S=function(a,b,c){Dy.m.S.call(this,a,b,c);1==b&&(a=this.ya(a.n()))&&(a.disabled=c)};h.ib=ca;h.Nb=function(a,b){var c=this.ya(a);c&&(c.value=b)};h.ra=function(a){return(a=this.ya(a))?a.value:null};h.A=function(){return"wgui-textinput"};function Fy(a,b,c){qu.call(this,a,b||Dy.W(),c);ru(this,!1);tu(this);this.tb&=-256;wu(this,32,!1);a||(this.Fb="")}B(Fy,qu);h=Fy.prototype;h.L=function(){Fy.m.L.call(this);var a=ku(this);if(a){var b=this.j||(this.j=new It);Jt(b,a);vt(this).listen(b,"key",this.Ra)}(a=hh(this.i.A()+"-clear",this.n()))&&vt(this).listen(a,"click",this.Yg)};h.Yg=function(a){a.preventDefault();this.i.Nb(this.n(),"");this.Fb="";this.dispatchEvent(new H("action",this))};h.ra=function(){return this.n()?this.i.ra(this.n()):null};
h.P=function(){return this.ra()};h.zb=function(){return this.ra()||""};function Gy(a,b){this.result=b;pv.call(this,a,new qr($(a),b.storeName,b.record));this.g.g||Hy(this)}B(Gy,pv);function Hy(a){a.parent.send("query",[{store:a.result.storeName,index:"id",key:a.result.primaryKey}]).B(function(a){a=a[0].result;a[0]&&this.qb(new qr($(this.parent),Lq[Lq.indexOf(this.result.storeName)],a[0]))},a)}function Iy(a,b){b&&(a.result=b,b.record?a.qb(new qr($(a.parent),b.storeName,b.record)):b.storeName&&t(b.primaryKey)&&Hy(a))}
Gy.prototype.clear=function(){this.Pa()||(this.qb(null),this.result=null)};Gy.prototype.toString=function(){return"ydn.crm.sugar.model.ResultRecord:"+this.g};Gy.prototype.Pa=function(){return!rv(this)&&!this.result};function Jy(a,b){Y.call(this,a);this.qa(b);this.i=new Y(a);this.h=null;this.j=[];this.l=0}B(Jy,Y);h=Jy.prototype;h.A=function(){return"search-panel"};
h.Q=function(){Jy.m.Q.call(this);var a=this.g,b=this.n();b.classList.add(this.A());var c=a.s("div","header");b.appendChild(c);this.h=new py(null,null,a);for(var d=new Iw(a),e=0;e<Mq.length;e++)d.M(new Dw(Mq[e]),!0);e=new Cy("Module",d,null,a);this.h.M(e,!0);d=new Fy("");this.h.M(d,!0);this.h.render(c);e.Ob(!1);a=a.s("div","content");b.appendChild(a);this.M(this.i,!0);d.n().querySelector("input").setAttribute("placeholder","Search name, email, id, etc...")};
h.L=function(){Jy.m.L.call(this);var a=Z(this.h,1);vt(this).listen(a,"action",this.Yh,!0)};function Ky(a,b){if(b){for(var c=Bt(a.i),d=0;d<c;d++){var e=Z(a.i,d).t();if(e.Pa()){Iy(e,b);return}}30<c?(e=Z(a.i,0).t(),Iy(e,b)):(c=new Gy(a.t(),b),c=new dy(c,a.g),a.i.M(c,!0))}}
function Ly(a,b,c,d){cw(a.t(),b,c,d,!0).w(function(a){a=a[0];if(a.result[0]){var b=a.result[0];Ky(this,{storeName:Lq[Lq.indexOf(a.store)],primaryKey:b.id,record:b,value:d,tokens:[{keyPath:c}]})}My(this)},function(a){My(this);throw a;},a)}function Ny(a){var b=a+0.1,c=["rgb(255, 255, 255) 0%"];99>a&&(c[1]="rgb(135, 224, 253) "+a.toFixed(1)+"%",c[2]="rgb(255, 255, 255) "+b.toFixed(1)+"%");c.push("rgb(255, 255, 255) 100%");return"linear-gradient(to right, "+c.join(", ")+")"}
function Oy(a,b){0==a.l&&(a.l=b);var c=100*(a.l-b)/a.l,d=Z(a.h,1).n();ih(document,"input",null,d)[0].style.background=Ny(c)}
function My(a){var b=a.j[0];if(b){b.Ka++;Oy(a,4*(a.j.length-1)+(4-b.Ka));var c=a.t();0==b.Ka?Ly(a,b.module,"id",b.Ta):1==b.Ka?Ly(a,b.module,"ydn$emails",b.Ta):2==b.Ka?(c=b.Ta.match(/\d/g),3>(c?c.length:0)?My(a):Ly(a,b.module,"ydn$phones",b.Ta)):3==b.Ka?dw(c,b.module,b.Ta).w(function(a){a=a[0].fullTextResult;for(var b=a.length||0,c=0;c<b;c++)Ky(this,a[c]);My(this)},function(a){throw a;},a):(a.j.shift(),0<a.j.length&&My(a))}}
h.Yh=function(){for(var a=Z(this.h,1).ra(),b=Bt(this.i)-1;0<=b;b--)Z(this.i,b).t().clear();this.l=0;if(a&&(a=a.trim(),2<=a.length)){b=(b=xy(Z(this.h,0)))?b.zb():null;this.j.length=0;if(b)this.j[0]={module:b,Ta:a,Ka:-1};else for(b=0;b<Mq.length;b++)this.j[b]={module:Mq[b],Ta:a,Ka:-1};My(this)}};h.X=function(){return hh("content",this.n())};var Py;function Qy(a){var b=A(),c=Math.floor((b-a)/6E4),b=!1;0>c&&(b=!0,c*=-1);if(60>c)return Py(c,b,0);c=Math.floor(c/60);if(24>c)return Py(c,b,1);c=new Date(A());c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);c=Math.ceil((c.getTime()-a)/864E5);b&&(c*=-1);return 14>c?Py(c,b,2):""}
Py=function(a,b,c){var d=ne(a);return b||0!=c?b&&0==c?1==a?"in "+(d+" minute"):"in "+(d+" minutes"):b||1!=c?b&&1==c?1==a?"in "+(d+" hour"):"in "+(d+" hours"):b||2!=c?b&&2==c?1==a?"in "+(d+" day"):"in "+(d+" days"):"":1==a?d+" day ago":d+" days ago":1==a?d+" hour ago":d+" hours ago":1==a?d+" minute ago":d+" minutes ago"};function Ry(a,b){Y.call(this,b);this.qa(a)}B(Ry,Y);h=Ry.prototype;h.A=function(){return"detail-panel"};h.Q=function(){Ry.m.Q.call(this);var a=this.g,b=this.n();b.classList.add(this.A());b.appendChild(a.s("div","header"));b.appendChild(a.s("div","content"))};h.X=function(){return this.n().querySelector(".content")};h.L=function(){Ry.m.L.call(this)};h.clear=function(){this.X().innerHTML="";this.n().querySelector(".header").innerHTML=""};
function Sy(a,b){var c=a.t().j.H(),d=Dr(new Date),c=S.bound([c,d],[c,"\uffff"]);return{store:Qq[b],index:vr(Qq[b]),keyRange:c}}
function Ty(a){a.n();a.t().send("activity-stream").w(function(a){var c=this.g,d=c.s("span");if(0<a.length)c=ur(a[a.length-1].date_modified),c=Qy(c.getTime())||c.toLocaleDateString(),d.textContent=a.length+" records updated since "+c;else{d.appendChild(Eh(c,"No activity? Have you "));var e=c.s("a",{href:chrome.extension.getURL("setup.html")},"setup");d.appendChild(e);d.appendChild(Eh(c,"?"))}Uy(this,d);for(d=0;d<a.length;d++){var c=a[d],e=this.g,f=$(this.t()),g=c._module,k=new qr(f,g,c),l=e.s("div",
"icon",c._module.substr(0,2)),m=e.s("span"),n=k.value("modified_user_id"),p=k.value("created_by");n?(f=e.s("a",{href:Rq(f,"Users",n),target:"_blank"},k.value("modified_user_name")),m.appendChild(f),m.appendChild(Eh(e," "))):p&&(f=e.s("a",{href:Rq(f,"Users",p),target:"_blank"},k.value("created_by_name")),m.appendChild(f),m.appendChild(Eh(e," ")));m.appendChild(Eh(e,c.date_modified==c.date_entered?"created ":"updated "));k=e.s("a",{href:rr(k),target:"_blank"},k.value("name"));m.appendChild(k);g=g.replace(/ies$/,
"y").replace(/s$/,"");m.appendChild(Eh(e," "+g+""));g=ur(c.date_modified);g=Qy(g.getTime())||"on "+g.toLocaleDateString();m.appendChild(Eh(e," "+g+"."));e=e.s("div",null,[l,m]);e.className="detail-item record-header "+c._module;this.X().appendChild(e)}},function(a){throw a;},a)}function Uy(a,b){var c=a.n().querySelector(".header");c.innerHTML="";c.appendChild(b);var d=a.g.s("div","close");d.innerHTML="&#x25B2";d.setAttribute("title","Close");d.setAttribute("name","close");c.appendChild(d)}
function Vy(a,b){var c=Sy(a,b);a.t().send("values",c).w(function(a){var c=this.g.s("span"),f=Qq[b];c.textContent=a.length+" upcoming "+f;Uy(this,c);for(c=0;c<a.length;c++){var g=a[c],k=f,l=this.g,m=new qr($(this.t()),k,g),n=l.s("span"),k="Calls"==k?"call":"Tasks"==k?"finish":"Meetings"==k?"meet":"Opportunities"==k?"close":"do",k=k.charAt(0).toUpperCase()+k.substr(1)+" ";n.appendChild(Eh(l,k));k=l.s("a",{href:rr(m),target:"_blank"},m.value("name"));n.appendChild(k);m=m.g?ur(m.g[wr(m.module)]):new Date("NaN");
m=Qy(m.getTime())||"on "+m.toLocaleDateString();n.appendChild(Eh(l," "+m+"."));l=l.s("div",null,[n]);l.className="detail-item record-header "+g._module;this.X().appendChild(l)}},function(a){throw a;},a)};function Wy(a,b){Y.call(this,b);this.qa(a);this.h=new Zu(Xu,void 0,b);this.i=new Ry(a,b)}B(Wy,Y);h=Wy.prototype;h.A=function(){return"activity-panel"};h.Q=function(){Wy.m.Q.call(this);var a=this.g,b=this.n();ah(b,this.A());this.M(this.h,!0);b=a.s("div");b=new Au(b);b.Ia("Activity feed");this.h.M(b,!0);b.X().classList.add("activity-feed");for(b=0;b<Qq.length;b++){var c=a.s("div",null,Qq[b].substr(0,2)),c=new Au(c);c.Ia(Qq[b]);this.h.M(c,!0);c.X().classList.add(Qq[b]);c.Ob(!1)}this.M(this.i,!0)};
h.L=function(){Wy.m.L.call(this);var a=this.t(),b=vt(this);b.listen(a,"login",this.pg);b.listen(this.h,"select",this.yh);b.listen(this.h,"unselect",this.zh);b.listen(this.i.n(),"click",this.ah);R(this.n(),!1);a.isLogin()&&this.pg()};h.ah=function(a){"close"==a.target.getAttribute("name")&&(a=this.h,a.oc(Z(a,-1)))};h.zh=function(){this.i.clear()};h.yh=function(){var a;a=this.h;a=Dt(a,a.$a);0==a?Ty(this.i):Vy(this.i,a-1)};
h.pg=function(){var a=this;setTimeout(function(){Xy(a)},2E3);setTimeout(function(){Yy(a)},3E3)};function Xy(a){a.t().send("activity-stream").w(function(a){if(0<a.length){var c=ur(a[a.length-1].date_modified);R(this.n(),!0);a=a.length;var d=Z(this.h,0),e=d.X().firstElementChild;0<a?(e.textContent=a,c=Qy(c.getTime())||c.toLocaleDateString(),d.Ia(a+" records updated since "+c)):(e.textContent="Fe",d.Ia(""))}},function(a){throw a;},a)}
function Yy(a,b){var c=b||0;if(!(c>=Qq.length)){var d=Sy(a.i,c);a.t().send("keys",d).w(function(a){Yy(this,c+1);R(this.n(),!0);var b=Qq[c];a=a.length;var d=Z(this.h,Qq.indexOf(b)+1),k=d.X().firstElementChild;a?(k.textContent=a,d.Ia(a+" upcoming "+b),d.Ob(!0)):(k.textContent=b.substr(0,2),d.Ia(""),d.Ob(!1))},function(a){throw a;},a)}};function Zy(a,b){Y.call(this,b);this.qa(a)}B(Zy,Y);h=Zy.prototype;h.logger=Q("ydn.crm.ui.sugar.Header");h.A=function(){return"sugar-header"};h.X=function(){return this.n().querySelector(".sugar-header-content")};
h.Q=function(){Zy.m.Q.call(this);var a=this.n(),b=this.t(),c=this.g;ah(a,this.A());var d=c.s("a");d.textContent=$(b);d.href=aw(b);d=c.s("div",{"class":"main-title",title:"SugarCRM"},[d]);a.appendChild(d);var d=[],e=chrome.extension.getURL("option-page.html")+"#credentials",e=chrome.extension.getURL("host-permission.html")+"?"+$(b),e=c.s("a",{href:e,target:"host-permission"},"Grant host permission");e.setAttribute("title","Your permission is required to connect your server from this extension. Without permission request to server will be slow.");
d.push(e);d=c.s("div",{"class":"host-permission"},d);a.appendChild(d);var e=c.s("input",{name:"username",type:"text"}),e=c.s("div",null,[e]),f=c.s("input",{name:"password",type:"password"}),f=c.s("div",null,[f]),g=c.s("div","message"),e=c.s("div","login-form",[e,f,g]);R(d,!b.g.hostPermission);R(e,!b.isLogin());a.appendChild(e);a.appendChild(c.s("div","sugar-header-content"));a=new Jy(c,b);this.M(a,!0);b=new Wy(b,c);this.M(b,!0)};
h.L=function(){Zy.m.L.call(this);var a=this.n(),b=vt(this),c=this.n().querySelector(".host-permission"),a=a.querySelector(".login-form"),a=new It(a);b.listen(a,"key",this.Xh);c=c.querySelector("a");b.listen(c,"click",Do,!0);b.listen(this.t(),"hag",this.ih)};h.ih=function(){var a=this.n().querySelector(".host-permission");R(a,!this.t().g.hostPermission)};
h.Xh=function(a){if(13==a.g){var b=this.n().querySelector(".login-form"),c=this.t();a=b.querySelector("input[name=username]").value;var d=b.querySelector("input[name=password]").value,e=b.querySelector(".message");e.textContent="logging in...";bw(c,a,d).w(function(){c.isLogin()?(e.textContent="",R(b,!1)):e.textContent="login failed"},function(a){e.textContent="Error: "+a},this)}};function $y(a,b){Y.call(this,b);this.qa(a);this.i=new sw(a);tw(this.i);this.h=Pq.map(function(c){c=new zv(a,c);return new my(c,b)})}B($y,Y);h=$y.prototype;h.A=function(){return"sugar-panel"};h.X=function(){return this.n().querySelector(".sugar-panel-content")};
h.Q=function(){$y.m.Q.call(this);var a=this.g,b=this.n();ah(b,this.A());var c=a.s("div"),d=a.s("div","sugar-panel-content");b.appendChild(c);b.appendChild(d);R(d,!1);(new Zy(this.t(),a)).render(c);for(a=0;a<this.h.length;a++)this.M(this.h[a],!0)};h.L=function(){$y.m.L.call(this);vt(this).listen(this.t(),[Av],this.rh)};h.rh=function(){var a=!!Gv(this.t());R(this.X(),a)};h.logger=Q("ydn.crm.ui.sugar.SugarPanel");function az(){this.g=null;var a=Ed().send("user-setting").B(function(){},this),b=Ed().send("login-info").w(function(a){a||M(this.logger,"login fail");this.g=a},function(){this.g=null;M(this.logger,"login fail")},this);this.i=Mm([a,b])}var bz;az.prototype.logger=Q("ydn.crm.inj.UserSetting");function rw(){bz||(bz=new az);return bz}az.prototype.Rb=function(){return this.i};az.prototype.j=function(){return this.g.email};
az.prototype.h=function(a){var b=Ed("sugarcrm",a);return Vb(this.i).B(function(){return b.send("info-module").B(function(a){if(u(a))for(var b=0;b<a.length;b++)cz(a[b]);else cz(a);return a},this)},this)};
function cz(a){var b="",c="",d;for(d in a.module_fields){var e=a.module_fields[d];0<="created_by created_by_name date_entered date_modified deleted modified_user_id modified_by_name id".split(" ").indexOf(d)&&(e.calculated=!0);if(0<=["salutation","name","last_name","first_name","full_name"].indexOf(d))e.group="name";else if(/^email\d?$/.test(d))e.group="email";else if(/^phone?/.test(d))e.group="phone";else if(!e.group&&va(d,b)){e.group=c;continue}b=d;c=e.group}for(d in a.link_fields)b=a.link_fields[d],
"contact"!=d||b.module||(b.module="Contacts")};function dz(a){Y.call(this,a)}B(dz,Y);dz.prototype.Q=function(){dz.m.Q.call(this);var a=this.n(),b=this.g;ah(a,"sugarcrm-link-panel");b=b.createElement("a");b.textContent="Setup SugarCRM";b.href=chrome.extension.getURL("setup.html");b.className="sugarcrm-setup-link";a.appendChild(b);R(a,!1)};dz.prototype.qa=function(a){dz.m.qa.call(this,a);a=u(a)&&0<a.length;R(this.n(),!a)};function ez(a){Y.call(this,a);this.i=rw();this.h=null}B(ez,Y);h=ez.prototype;h.A=function(){return"inj"};h.Q=function(){ez.m.Q.call(this);this.n().classList.add(this.A());var a=new dz;this.M(a,!0)};h.L=function(){ez.m.L.call(this);vt(this).listen(Bd(),"list-sugarcrm",this.Wg)};h.Wg=function(a){"list-sugarcrm"==a.type&&(a=a.h.data.map(function(a){return{domain:a}}),fz(this,a))};h.logger=Q("ydn.crm.ui.SidebarPanel");
function gz(a,b){var c=b.domain;return a.i.h(c).B(function(a){a=new fw(b,a,this.i.g.email);!this.h&&a.isLogin()&&(N(this.logger,"compose template initialized."),this.h=new sx(a));for(var e=0;e<Bt(this);e++){var f=Z(this,e);if(f instanceof $y&&$(f.t())==c){N(this.logger,"sugar panel already exist created");return}}a=new $y(a,this.g);N(this.logger,"sugar panel "+c+" created");this.M(a,!0)},a)}
function hz(a,b){for(var c=Bt(a),d=0;d<c;d++){var e=Z(a,d);e instanceof $y&&(e=e.t(),b?e.update(b.g,b.h,null):e.update(null,null,null))}}h.lf=function(a){0==Bt(this)?this.init().B(function(){hz(this,a)},this):hz(this,a)};function iz(a,b){for(var c=1;c<Bt(a);c++){var d=Z(a,c);if(d instanceof $y&&$(d.t())==b)return!0}return!1}
function fz(a,b){Z(a,0).qa(b);for(var c=[],d=Bt(a)-1;0<d;d--){var e=Z(a,d);e instanceof $y&&!b.some(function(a){return a.domain==$(e.t())})&&(zf(a.logger,"disposing sugar panel "+$(e.t())),e.t().ma(),a.removeChild(e,!0))}for(d=0;d<b.length;d++)if(!iz(a,b[d].domain)){zf(a.logger,"adding sugar panel "+b[d].domain);var f=b[d];f.userName?c.push(gz(a,f)):(f=Ed("sugarcrm",f.domain),c.push(f.send("about").B(function(a){return gz(this,a)},a)))}return Mm(c)}
h.init=function(){return 1<Bt(this)?$b():Ed().send("list-sugarcrm").B(function(a){return fz(this,a)},this)};function jz(){this.g=this.h=null}jz.prototype.init=function(a){this.h=a;a=document.getElementById("user-login");Yc(a,"click",function(a){a.preventDefault();window.open(a.target.href,void 0,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=600, height=400, top="+(screen.height/2-200)+", left="+(screen.width/2-300));return!0},!0,this)};
function kz(a,b){if(!b||b instanceof Error)a.g=null;else if(a.g=b,a.h){var c=document.getElementById("user-login"),d=document.getElementById("user-name"),e=hh("login-message",a.h);b instanceof Error?(e.textContent=b.message,R(e,!0),R(c,!1)):a.g.is_login?(c.href=a.g.logout_url,c.textContent="logout",d.textContent=a.g.email,R(e,!1),R(c,!1)):(c.href=a.g.login_url,c.textContent="login",c.style.display="",d.textContent="",R(e,!0),R(c,!0))}};function lz(){this.h=document.createElement("div");document.body.appendChild(this.h);R(this.h,!1);this.j=new Hf(400);Yc(this.j,Jf,this.Bh,!0,this);this.i=0;this.u="";Cd("gmail");this.g=new ez;this.g.render(this.h);this.p=!1;var a=this.history=new qt,b=fe(new Sd(document.location.href))+"/";a.Mh=b;Yc(this.history,"navigate",this.hh,!1,this);this.C=null;this.l=!1;new Zu;this.o=new jz}h=lz.prototype;h.logger=Q("ydn.crm.inj.App");h.isLogin=function(){return this.l};
h.Bh=function(){this.i++;this.u!=location.href&&(M(this.logger,"url already changed"),this.j.stop());40<this.i&&(M(this.logger,"sniff give up after "+this.i),this.j.stop());var a;this.g.n();a=(a=document.querySelector('table[role="presentation"]'))?a.querySelector("tr").children[2].querySelector("table"):null;if(a&&!this.p){for(var b,c=a,d=0;4>d;d++)if(c&&c.parentElement&&(c=c.parentElement,c.nextElementSibling&&"DIV"==c.nextElementSibling.tagName)){var c=c.parentElement,d=c.lastElementChild,e=!!d.querySelector("a[href]");
b=document.createElement("div");e&&c.parentElement.contains(d)?c.parentElement.insertBefore(b,d):c.appendChild(b);break}b||(M(this.logger,"usual root position is not available, locating on second best position"),c=a.ownerDocument,b=c.createElement("td"),b.setAttribute("colspan","2"),c=c.createElement("tr"),c.className="widget-topraw",c.appendChild(b),(a.querySelector("tbody")||a).appendChild(c));c=this.h;c.parentElement&&c.parentElement.removeChild(c);b.appendChild(c);R(c,!0);this.p=!0;R(this.h,!0)}a:if(c=
5<this.i,b=a.querySelector("img[jid]")){for(a=b.getAttribute("jid");b&&"TD"!=b.tagName;)b=b.parentElement;b=b.nextElementSibling.querySelector("span[title]").getAttribute("title");a=new bv(a,b)}else{if(c&&(a=a.querySelector("span[title]"))&&(b=a.getAttribute("title").trim(),0<b.length&&(a=document.querySelector('span[name="'+b+'"][email]')))){a=a.getAttribute("email");a=new bv(a,b);break a}a=null}a&&(this.j.stop(),this.g.lf(a))};
h.hh=function(a){if(a.h!=this.C&&(this.C=a.h,!/^contact/.test(a.h)))if(/compose=new$/.test(a.h)){a=this.g;if(a.h){a=a.h;var b=document.querySelector('form[enctype="multipart/form-data"]');b?(b=(b=tx(b))?(b=b.querySelector("tbody").lastElementChild.firstElementChild.firstElementChild.firstElementChild.lastElementChild.querySelector("table"))?b.querySelector("td:last-child"):null:null,b?(xx(a,b),a=!0):(M(a.logger,"compose toolbar not found."),a=!1)):(M(a.logger,"compose FORM element not found."),a=
!1)}else M(a.logger,"SugarCRM instance not ready."),a=!1;P(this.logger,"inject compose "+(a?"ok":"fail"))}else/\w+\/[\w\d]{10,18}$/.test(a.h)&&(P(this.logger,"updating sidebar"),this.i=0,this.u=location.href,this.p=!1,this.g.lf(null),If(this.j))};
h.init=function(){N(this.logger,"init "+this);mz(this);var a=window.setInterval(function(){document.querySelector('a[href="http://mail.google.com/mail/help/terms.html"]')&&window.clearTimeout(a)},500);window.setTimeout(function(){window.clearTimeout(a)},15E3)};h.toString=function(){return"inj.Main:0.8.9"};
function mz(a){Ed().send("login-info").w(function(a){a:{if(a&&a.email){P(this.logger,"user "+a.email+" login");this.l=!0;var c=this.o.g;if(c&&c.email==a.email)break a;this.g.init();this.history.setEnabled(!0)}else this.l&&(this.l=!1,this.history.setEnabled(!1));kz(this.o,a)}},function(a){M(this.logger,a.name+" "+a.message);kz(this.o,a)},a)}h.Vh=function(){return{sidebar:this.g,setting:this.o}};pa("ydn.debug.log",hj);pa("ydn.crm.version","0.8.9");pa("runInjApp",function(){Xo();var a=new lz;a.init();return a});pa("runEventApp",function(){Xo();var a=new kt;a.init();it(a);return a});pa("ydn.crm.ui.StatusBar",Dx);pa("ydn.crm.ui.SimpleStatusBar",Fx);Dx.instance=Ex;kt.prototype.xp=kt.prototype.T;lz.prototype.xp=lz.prototype.Vh;function nz(a,b){Y.call(this,a);this.qa(b);this.i=new Y(a);this.h=null;this.j=[];this.l=0}B(nz,Y);h=nz.prototype;h.A=function(){return"browse-panel"};h.Q=function(){nz.m.Q.call(this);var a=this.g,b=this.n(),c=a.s("div","header");b.appendChild(c);b.className=this.A();this.h=new py(null,null,a);for(var d=new Iw(a),e=0;e<Mq.length;e++)d.M(new Dw(Mq[e]),!0);d=new Cy("Module",d,null,a);this.h.M(d,!0);this.h.M(new Fy(""),!0);this.h.render(c);a=a.s("div","content");b.appendChild(a);this.M(this.i,!0)};
h.L=function(){nz.m.L.call(this);var a=Z(this.h,1);vt(this).listen(a,"action",this.Wh,!0)};function oz(a,b){if(b){for(var c=Bt(a.i),d=0;d<c;d++){var e=Z(a.i,d).t();if(e.Pa()){Iy(e,b);return}}30<c?(e=Z(a.i,0).t(),Iy(e,b)):(c=new Gy(a.t(),b),c=new dy(c,a.g),a.i.M(c,!0))}}
function pz(a,b,c,d){cw(a.t(),b,c,d,!0).w(function(a){a=a[0];if(a.result[0]){var b=a.result[0];oz(this,{storeName:Lq[Lq.indexOf(a.store)],primaryKey:b.id,record:b,value:d,tokens:[{keyPath:c}]})}qz(this)},function(a){qz(this);throw a;},a)}function rz(a,b){0==a.l&&(a.l=b);var c=100*(a.l-b)/a.l,d=Z(a.h,1).n();ih(document,"input",null,d)[0].style.background=Ny(c)}
function qz(a){var b=a.j[0];if(b){b.Ka++;rz(a,4*(a.j.length-1)+(4-b.Ka));var c=a.t();0==b.Ka?pz(a,b.module,"id",b.Ta):1==b.Ka?pz(a,b.module,"ydn$emails",b.Ta):2==b.Ka?(c=b.Ta.match(/\d/g),3>(c?c.length:0)?qz(a):pz(a,b.module,"ydn$phones",b.Ta)):3==b.Ka?dw(c,b.module,b.Ta).w(function(a){a=a[0].fullTextResult;for(var b=a.length||0,c=0;c<b;c++)oz(this,a[c]);qz(this)},function(a){throw a;},a):(a.j.shift(),0<a.j.length&&qz(a))}}
h.Wh=function(){for(var a=Z(this.h,1).ra(),b=Bt(this.i)-1;0<=b;b--)Z(this.i,b).t().clear();this.l=0;if(a&&(a=a.trim(),2<=a.length)){b=(b=xy(Z(this.h,0)))?b.zb():null;this.j.length=0;if(b)this.j[0]={module:b,Ta:a,Ka:-1};else for(b=0;b<Mq.length;b++)this.j[b]={module:Mq[b],Ta:a,Ka:-1};qz(this)}};h.X=function(){return hh("content",this.n())};function sz(a,b,c){Dw.call(this,a,b,c);wu(this,8,!0);if(a=this.n())b=this.i,a&&(Rt(a,"menuitemradio"),zw(b,this,a,!0))}B(sz,Dw);sz.prototype.pb=function(){return this.dispatchEvent("action")};ou("goog-option",function(){return new sz(null)});function tz(){}B(tz,Uw);da(tz);tz.prototype.A=function(){return"goog-toolbar-button"};function uz(a,b,c){Tw.call(this,a,b||tz.W(),c)}B(uz,Tw);ou("goog-toolbar-button",function(){return new uz(null)});function vz(a,b,c,d){Xw.call(this,a,b,c||By.W(),d)}B(vz,Xw);ou("goog-toolbar-menu-button",function(){return new vz(null)});function wz(a,b){Fw.call(this,a||ny.W(),b)}B(wz,Fw);ou("goog-toolbar-separator",function(){return new wz});function xz(a,b,c){Tw.call(this,a,b||Uw.W(),c);wu(this,16,!0)}B(xz,Tw);ou("goog-toggle-button",function(){return new xz(null)});function yz(a,b,c){xz.call(this,a,b||tz.W(),c)}B(yz,xz);ou("goog-toolbar-toggle-button",function(){return new yz(null)});function zz(){}B(zz,$t);da(zz);zz.prototype.A=function(){return"record"};zz.prototype.xa=function(a){return zz.m.xa.call(this,a)};function Az(a,b){qu.call(this,null,null,a);this.qa(b)}B(Az,qu);mu(Az,zz);function Bz(a,b){Y.call(this,a);this.qa(b);this.i=new Y(a);this.h=new Y(a)}B(Bz,Y);Bz.prototype.X=function(){return hh("content",this.n())};
Bz.prototype.Q=function(){Bz.m.Q.call(this);var a=this.n(),b;x('<div class="goog-toolbar"><div title="Select base record type" class="goog-toolbar-select">Base record<div class="goog-menu" name="base-record"><div class="goog-option" name="gmail-contact">Gmail Contacts</div><div class="goog-option" name="Contacts">Contacts</div><div class="goog-option" name="Leads">Leads</div></div></div><div title="Sort order" class="goog-toolbar-select">Sort by<div class="goog-menu" name="sort-by"><div class="goog-option" name="modified">modified</div><div class="goog-option" name="id">id</div><div class="goog-option" name="name">name</div></div></div></div><div class="content"></div>')?(Sa('Soy template output is unsafe for use as HTML: <div class="goog-toolbar"><div title="Select base record type" class="goog-toolbar-select">Base record<div class="goog-menu" name="base-record"><div class="goog-option" name="gmail-contact">Gmail Contacts</div><div class="goog-option" name="Contacts">Contacts</div><div class="goog-option" name="Leads">Leads</div></div></div><div title="Sort order" class="goog-toolbar-select">Sort by<div class="goog-menu" name="sort-by"><div class="goog-option" name="modified">modified</div><div class="goog-option" name="id">id</div><div class="goog-option" name="name">name</div></div></div></div><div class="content"></div>'),
b="zSoyz"):b='<div class="goog-toolbar"><div title="Select base record type" class="goog-toolbar-select">Base record<div class="goog-menu" name="base-record"><div class="goog-option" name="gmail-contact">Gmail Contacts</div><div class="goog-option" name="Contacts">Contacts</div><div class="goog-option" name="Leads">Leads</div></div></div><div title="Sort order" class="goog-toolbar-select">Sort by<div class="goog-menu" name="sort-by"><div class="goog-option" name="modified">modified</div><div class="goog-option" name="id">id</div><div class="goog-option" name="name">name</div></div></div></div><div class="content"></div>';
a.innerHTML=b;zt(new py,hh("goog-toolbar",a));this.M(this.i,!0);this.M(this.h,!0);R(this.h.n(),!1)};Bz.prototype.L=function(){Bz.m.L.call(this);this.n()};Bz.prototype.refresh=function(){};pa("ydn.crm.sugar.model.Sugar",Xv);pa("ydn.crm.ui.SidebarPanel",ez);pa("ydn.crm.ui.sugar.SyncPanel",Bz);pa("ydn.crm.ui.sugar.SearchPanel",Jy);pa("ydn.crm.ui.sugar.BrowsePanel",nz);pa("ydn.crm.inj.UserSetting",az);az.getInstance=rw;az.prototype.getModuleInfo=az.prototype.h;az.prototype.getGmail=az.prototype.j;
Xv.list=function(){var a=rw();return Ed().send("list-sugarcrm").B(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.isLogin&&c.push(a.h(e.domain).B(function(a){return new Xv(this,a)},e))}return Mm(c)})};ez.prototype.update=ez.prototype.lf;pa("ydn.msg.Pipe",yd);pa("ydn.msg.initPipe",Cd);pa("ydn.msg.getChannel",Ed);yd.prototype.listen=yd.prototype.listen;yd.prototype.getChannel=yd.prototype.j;md.prototype.send=md.prototype.send;pa("goog.async.Deferred",C);C.prototype.addCallback=C.prototype.B;C.prototype.addErrback=C.prototype.Ic;C.prototype.addBoth=C.prototype.ea;C.prototype.addCallbacks=C.prototype.w;})();

            //# sourceMappingURL=https://ydn-src-1.storage.googleapis.com/jsc/ydn.crm-0.8.9.js.map
        